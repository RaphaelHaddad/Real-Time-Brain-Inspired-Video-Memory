nohup: ignoring input
2025-11-30 21:40:18,347 - __main__ - INFO - Loading configuration from: config/base_config.yaml
2025-11-30 21:40:18,349 - __main__ - INFO - Building knowledge graph from: /home/viture-ai/Documents/Real-Time-Brain-Inspired-Video-Memory/data/outputs/vlm_output.json
2025-11-30 21:40:18,438 - src.components.neo4j_handler - INFO - Initialized Neo4j handler for run UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:40:18,459 - src.components.llm_injector - INFO - Initialized LLMInjector (chunking: True)
2025-11-30 21:40:18,566 - src.components.pre_llm_injector - INFO - Initialized PreLLMInjector: chunk_size=296, overlap=16, parallel=2, max_triplets_per_chunk=6, subgraph_extraction=False
2025-11-30 21:40:18,567 - src.components.global_refiner - INFO - Initialized GlobalRefiner with max_tokens=4000
2025-11-30 21:40:18,567 - src.pipeline.kg_builder - INFO - Initialized KG Builder with run UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961 (hierarchical extraction: True)
2025-11-30 21:40:18,567 - src.pipeline.kg_builder - INFO - Starting knowledge graph construction from: /home/viture-ai/Documents/Real-Time-Brain-Inspired-Video-Memory/data/outputs/vlm_output.json
2025-11-30 21:40:18,568 - src.pipeline.kg_builder - INFO - Reset logs directory: /home/viture-ai/Documents/Real-Time-Brain-Inspired-Video-Memory/logs
Processing KG batches:   0%|          | 0/72 [00:00<?, ?it/s]2025-11-30 21:40:18,570 - src.pipeline.kg_builder - INFO - Processing batch 1/72 (3 items)
2025-11-30 21:40:18,570 - src.pipeline.kg_builder - DEBUG - Batch 1 current_video_time: 00:09-00:14
2025-11-30 21:40:18,623 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 0
- Total Relationships: 0
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:40:18,623 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:40:18,623 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_0 ~221 words, content: Time: 00:00-00:04 Content: The video sequence captures a scene within a laboratory environment, focusing on a person and their interaction with the surroundings. - **Initial...
2025-11-30 21:40:18,623 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_1 ~237 words, content: , looking directly at it. They are still holding the smartphone. The laboratory setting remains consistent, with the glass cabinet, the door, and the equipment...
2025-11-30 21:40:18,624 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_2 ~196 words, content: up as if to show it. - In the final frame, the man is still holding the paper and looking at the camera. The man...
2025-11-30 21:40:18,624 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_3 ~181 words, content: This indicates the document is a report for a chemistry experiment, possibly using augmented reality technology. The person holding the paper is wearing a blue...
2025-11-30 21:40:18,624 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:40:18,624 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_0) (~221 words) with timeout=5.0s retries=3
2025-11-30 21:40:19,763 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:40:19,763 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:40:19,764 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_1) (~237 words) with timeout=5.0s retries=3
2025-11-30 21:40:20,733 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:40:20,733 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:40:20,733 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_2) (~196 words) with timeout=5.0s retries=3
2025-11-30 21:40:25,740 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 21:40:27,612 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 2)
2025-11-30 21:40:27,612 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:40:27,612 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_3) (~181 words) with timeout=5.0s retries=3
2025-11-30 21:40:28,645 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:40:28,645 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:40:28,646 - src.components.pre_llm_injector - INFO - Extracted 21 local triplets from 4 chunks
2025-11-30 21:40:28,646 - src.pipeline.kg_builder - INFO - Pre-extraction: 21 triplets in 10.02s
2025-11-30 21:40:28,646 - src.components.global_refiner - INFO - Capping refinement input: 21 → 15 triplets
2025-11-30 21:40:28,646 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 0
- Total Relationships: 0
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Cream-Colored Sweater", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Jeans", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_0"]}, {"head": "Person", "relation": "Holds", "tail": "Smartphone", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_1"]}, {"head": "Person", "relation": "Stands Near", "tail": "Laboratory Table", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_0"]}, {"head": "Laboratory Table", "relation": "Contains", "tail": "Precision Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_0"]}, {"head": "Laboratory Table", "relation": "Contains", "tail": "Red-Capped Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_0"]}, {"head": "Person", "relation": "Stands In", "tail": "Laboratory", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_2"]}, {"head": "Person", "relation": "Interacts With", "tail": "Equipment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_1"]}, {"head": "Person", "relation": "Looks At", "tail": "Camera", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_2"]}, {"head": "Person", "relation": "Holds", "tail": "Paper", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Balance_Scale", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_1"]}, {"head": "Person", "relation": "Holds", "tail": "Document", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_2"]}, {"head": "Document", "relation": "Has Title", "tail": "Ar_Glasses_Training_Chemistry_Experiment_Report_Simplified_Version", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "White_Cabinets", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Black_Counterboard", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_0_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:40:28,647 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~250 words, ~325 tokens)
2025-11-30 21:40:28,647 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:40:32,340 - src.components.global_refiner - DEBUG - LLM call completed in 3.69s
2025-11-30 21:40:32,340 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Cream-Colored Sweater', [0]], ['Person', 'wears', 'Blue Jeans', [0]], ['Person', 'holds', 'Smartphone', [0, 1]], ['Person', 'stands_near', 'Laboratory Table', [0]], ['Laboratory Table', 'contains', 'Precision Balance', [0]], ['Laboratory Table', 'contains', 'Red-Capped Bottle', [0]], ['Person', 'stands_in', 'Laboratory', [1, 2]], ['Person', 'interacts_with', 'Equipment', [1]], ['Person', 'looks_at', 'Camera', [1, 2]], ['Person', 'holds', 'Paper', [1]]]
2025-11-30 21:40:32,340 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Cream-Colored Sweater",
    [
      0
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Jeans",
    [
      0
    ]
  ],
  [
    "Person",
    "holds",
    "Smartphone",
    [
      0,
      1
    ]
  ],
  [
    "Person",
    "stands_near",
    "Laboratory Table",
    [
      0
    ]
  ],
  [
    "Laboratory Table",
    "contains",
    "Precision Balance",
    [
      0
    ]
  ],
  [
    "Laboratory Table",
    "contains",
    "Red-Capped Bottle",
    [
      0
    ]
  ],
  [
    "Person",
    "stands_in",
    "Laboratory",
    [
      1,
      2
    ]
  ],
  [
    "Person",
    "interacts_with",
    "Equipment",
    [
      1
    ]
  ],
  [
    "Person",
    "looks_at",
    "Camera",
    [
      1,
      2
    ]
  ],
  [
    "Person",
    "holds",
    "Paper",
    [
      1
    ]
  ]
]
2025-11-30 21:40:32,340 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 3.69s, LLM: 3.69s)
2025-11-30 21:40:32,340 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 3.69s
2025-11-30 21:40:32,340 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:40:32,340 - src.pipeline.kg_builder - INFO - Pushing batch 1/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:40:32,340 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:40:32,631 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:40:32,631 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:40:32,631 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:40:32,631 - src.components.neo4j_handler - INFO - Batch injected in 0.29s (triplets: 0.29s, indexes: 0.00s)
2025-11-30 21:40:32,632 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 4, 'with_embedding': 0, 'linked_chunks': 3}
2025-11-30 21:40:32,632 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:40:32,634 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 15 nodes
2025-11-30 21:40:32,635 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 14 nodes
2025-11-30 21:40:32,640 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 15, 'relationship_count': 26, 'density': 0.1238, 'avg_degree': 3.4667, 'avg_unique_neighbors': 3.4667, 'global_efficiency': 0.5381, 'avg_path_length': 1.8462, 'avg_degree_centrality': 0.2476, 'max_degree_centrality': 0.7857, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.011, 'degree_assortativity': -0.635, 'graph_robustness': 0.9231, 'diameter_estimate': 3, 'clustering_coefficient': 0.3329, 'weakly_connected_components': 2, 'largest_wcc_size': 14, 'pagerank_top10_percent': 79.4, 'louvain_communities': 3, 'louvain_modularity': 0.2478, 'label_entropy': 1.4183, 'computational_time': 0.007564865984022617}
2025-11-30 21:40:32,640 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 0, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510032.6405098, 'total_time': 14.06968967197463, 'aggregation': 2.496992237865925e-06, 'network_info': 0.05235930299386382, 'llm_extraction': 13.717147145071067, 'data_cleaning': 1.8988968804478645e-05, 'neo4j_injection': 0.29139062494505197, 'embedding_time': 0, 'indexing_time': 0.003072043997235596, 'graph_injection_time': 0.2881616820814088, 'acs_metrics': {'node_count': 15, 'relationship_count': 26, 'density': 0.1238, 'avg_degree': 3.4667, 'avg_unique_neighbors': 3.4667, 'global_efficiency': 0.5381, 'avg_path_length': 1.8462, 'avg_degree_centrality': 0.2476, 'max_degree_centrality': 0.7857, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.011, 'degree_assortativity': -0.635, 'graph_robustness': 0.9231, 'diameter_estimate': 3, 'clustering_coefficient': 0.3329, 'weakly_connected_components': 2, 'largest_wcc_size': 14, 'pagerank_top10_percent': 79.4, 'louvain_communities': 3, 'louvain_modularity': 0.2478, 'label_entropy': 1.4183, 'computational_time': 0.007564865984022617}, 'retrieval_queries': []}
2025-11-30 21:40:32,640 - src.pipeline.kg_builder - DEBUG - Batch 0 metrics: {
  "batch_idx": 0,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510032.6405098,
  "total_time": 14.06968967197463,
  "aggregation": 2.496992237865925e-06,
  "network_info": 0.05235930299386382,
  "llm_extraction": 13.717147145071067,
  "data_cleaning": 1.8988968804478645e-05,
  "neo4j_injection": 0.29139062494505197,
  "embedding_time": 0,
  "indexing_time": 0.003072043997235596,
  "graph_injection_time": 0.2881616820814088,
  "acs_metrics": {
    "node_count": 15,
    "relationship_count": 26,
    "density": 0.1238,
    "avg_degree": 3.4667,
    "avg_unique_neighbors": 3.4667,
    "global_efficiency": 0.5381,
    "avg_path_length": 1.8462,
    "avg_degree_centrality": 0.2476,
    "max_degree_centrality": 0.7857,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.011,
    "degree_assortativity": -0.635,
    "graph_robustness": 0.9231,
    "diameter_estimate": 3,
    "clustering_coefficient": 0.3329,
    "weakly_connected_components": 2,
    "largest_wcc_size": 14,
    "pagerank_top10_percent": 79.4,
    "louvain_communities": 3,
    "louvain_modularity": 0.2478,
    "label_entropy": 1.4183,
    "computational_time": 0.007564865984022617
  },
  "retrieval_queries": []
}
2025-11-30 21:40:32,640 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:40:32,640 - src.pipeline.kg_builder - INFO - Batch 1 timings - Agg: 0.00s, NetInfo: 0.05s, LLM: 13.72s, Clean: 0.00s, Neo4j: 0.29s, ACS: 0.01s
2025-11-30 21:40:32,640 - src.pipeline.kg_builder - INFO - Batch 1 completed in 14.07s
Processing KG batches:   1%|▏         | 1/72 [00:14<16:38, 14.07s/it]2025-11-30 21:40:32,641 - src.pipeline.kg_builder - INFO - Processing batch 2/72 (3 items)
2025-11-30 21:40:32,641 - src.pipeline.kg_builder - DEBUG - Batch 2 current_video_time: 00:24-00:29
2025-11-30 21:40:32,646 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 15
- Total Relationships: 10
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:40:32,646 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:40:32,646 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0 ~221 words, content: Time: 00:14-00:19 Content: The video sequence captures a scene within a laboratory or research facility, focusing on a person and their surroundings. The camera's movement...
2025-11-30 21:40:32,647 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1 ~200 words, content: , possibly a balance or a sample holder. The background shows more of the lab's white cabinetry and a stack of cardboard boxes. The overall...
2025-11-30 21:40:32,647 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_2 ~195 words, content: and components, including a syringe, a small container, and a pen. To the left, a tall, white, glass-fronted cabinet is open, revealing shelves stocked with...
2025-11-30 21:40:32,647 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_3 ~215 words, content: 学实验报告 (简版)" (AR Glasses Training Chemistry Experiment Report (Brief Version)). This document appears to be a guide for the experiment, which involves the synthesis of...
2025-11-30 21:40:32,647 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_4 ~91 words, content: data. The use of AR glasses suggests that the experiment is being conducted as part of a training program, where the user can see instructions...
2025-11-30 21:40:32,647 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:40:32,647 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0) (~221 words) with timeout=5.0s retries=3
2025-11-30 21:40:37,654 - src.components.pre_llm_injector - WARNING - Chunk 0 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 21:40:43,160 - src.components.pre_llm_injector - WARNING - Chunk 0 timed out after 5.0s (attempt 2/4), retrying...
2025-11-30 21:40:49,167 - src.components.pre_llm_injector - WARNING - Chunk 0 timed out after 5.0s (attempt 3/4), retrying...
2025-11-30 21:40:51,864 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 4)
2025-11-30 21:40:51,864 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:40:51,864 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1) (~200 words) with timeout=5.0s retries=3
2025-11-30 21:40:53,203 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:40:53,203 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:40:53,203 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_2) (~195 words) with timeout=5.0s retries=3
2025-11-30 21:40:58,209 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 21:41:03,717 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 2/4), retrying...
2025-11-30 21:41:09,724 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 3/4), retrying...
2025-11-30 21:41:16,232 - src.components.pre_llm_injector - WARNING - ⚠️ Chunk 2 TIMED OUT after 5.0s on final attempt. Skipping.
2025-11-30 21:41:16,232 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 0 triplets
2025-11-30 21:41:16,233 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_3) (~215 words) with timeout=5.0s retries=3
2025-11-30 21:41:17,265 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:41:17,265 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:41:17,266 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_4) (~91 words) with timeout=5.0s retries=3
2025-11-30 21:41:18,253 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:41:18,253 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:41:18,253 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 5 chunks
2025-11-30 21:41:18,254 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 45.61s
2025-11-30 21:41:18,254 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 21:41:18,254 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 15
- Total Relationships: 10
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Turtleneck_Sweater", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0"]}, {"head": "Person", "relation": "Wears", "tail": "Jeans", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0"]}, {"head": "Person", "relation": "Stands", "tail": "In_Lab", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0"]}, {"head": "Camera", "relation": "Pans", "tail": "Right", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0"]}, {"head": "Camera", "relation": "Reveals", "tail": "Countertop", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0"]}, {"head": "Countertop", "relation": "Holds", "tail": "White_Bottle_With_Red_Cap", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0"]}, {"head": "Person", "relation": "Stands In", "tail": "Laboratory", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Workbench", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1"]}, {"head": "Workbench", "relation": "Holds", "tail": "White_Bottle_With_Red_Cap", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1"]}, {"head": "Workbench", "relation": "Holds", "tail": "Paper_With_Handwritten_Notes", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1"]}, {"head": "Workbench", "relation": "Holds", "tail": "Box_Like_Apparatus", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1"]}, {"head": "Laboratory", "relation": "Has", "tail": "White_Cabinetry", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1"]}, {"head": "Person", "relation": "Uses", "tail": "Ar_Glasses", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_3"]}, {"head": "Person", "relation": "Holds", "tail": "Pen", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_3"]}, {"head": "Pen", "relation": "Writes On", "tail": "Report", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:41:18,254 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~237 words, ~308 tokens)
2025-11-30 21:41:18,254 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:41:29,413 - src.components.global_refiner - DEBUG - LLM call completed in 11.16s
2025-11-30 21:41:29,413 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Turtleneck_Sweater', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0']], ['Person', 'wears', 'Jeans', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0']], ['Person', 'stands_in', 'Laboratory', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1']], ['Camera', 'pans', 'Right', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0']], ['Camera', 'reveals', 'Countertop', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0']], ['Countertop', 'holds', 'White_Bottle_With_Red_Cap', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0']], ['Laboratory', 'contains', 'Workbench', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1']], ['Workbench', 'holds', 'White_Bottle_With_Red_Cap', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1']], ['Workbench', 'holds', 'Paper_With_Handwritten_Notes', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1']], ['Workbench', 'holds', 'Box_Like_Apparatus', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1']]]
2025-11-30 21:41:29,413 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Turtleneck_Sweater",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Jeans",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0"
    ]
  ],
  [
    "Person",
    "stands_in",
    "Laboratory",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1"
    ]
  ],
  [
    "Camera",
    "pans",
    "Right",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0"
    ]
  ],
  [
    "Camera",
    "reveals",
    "Countertop",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0"
    ]
  ],
  [
    "Countertop",
    "holds",
    "White_Bottle_With_Red_Cap",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_0"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Workbench",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1"
    ]
  ],
  [
    "Workbench",
    "holds",
    "White_Bottle_With_Red_Cap",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1"
    ]
  ],
  [
    "Workbench",
    "holds",
    "Paper_With_Handwritten_Notes",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1"
    ]
  ],
  [
    "Workbench",
    "holds",
    "Box_Like_Apparatus",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_1_1"
    ]
  ]
]
2025-11-30 21:41:29,413 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.16s, LLM: 11.16s)
2025-11-30 21:41:29,413 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.16s
2025-11-30 21:41:29,413 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:41:29,413 - src.pipeline.kg_builder - INFO - Pushing batch 2/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:41:29,414 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:41:29,556 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:41:29,556 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:41:29,556 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:41:29,557 - src.components.neo4j_handler - INFO - Batch injected in 0.14s (triplets: 0.14s, indexes: 0.01s)
2025-11-30 21:41:29,558 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 9, 'with_embedding': 0, 'linked_chunks': 5}
2025-11-30 21:41:29,558 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:41:29,560 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 28 nodes
2025-11-30 21:41:29,560 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 24 nodes
2025-11-30 21:41:29,564 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 28, 'relationship_count': 48, 'density': 0.0635, 'avg_degree': 3.4286, 'avg_unique_neighbors': 3.4286, 'global_efficiency': 0.3818, 'avg_path_length': 2.2355, 'avg_degree_centrality': 0.127, 'max_degree_centrality': 0.5556, 'avg_betweenness_centrality': 0.0011, 'max_betweenness_centrality': 0.0093, 'degree_assortativity': -0.4842, 'graph_robustness': 0.8333, 'diameter_estimate': 4, 'clustering_coefficient': 0.2919, 'weakly_connected_components': 5, 'largest_wcc_size': 24, 'pagerank_top10_percent': 59.02, 'louvain_communities': 8, 'louvain_modularity': 0.3913, 'label_entropy': 1.453, 'computational_time': 0.006428244058042765}
2025-11-30 21:41:29,564 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 1, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510089.5646353, 'total_time': 56.92356176802423, 'aggregation': 4.691071808338165e-06, 'network_info': 0.005157366977073252, 'llm_extraction': 56.76742188807111, 'data_cleaning': 2.719694748520851e-05, 'neo4j_injection': 0.14315174403600395, 'embedding_time': 0, 'indexing_time': 0.00523272599093616, 'graph_injection_time': 0.13764165400061756, 'acs_metrics': {'node_count': 28, 'relationship_count': 48, 'density': 0.0635, 'avg_degree': 3.4286, 'avg_unique_neighbors': 3.4286, 'global_efficiency': 0.3818, 'avg_path_length': 2.2355, 'avg_degree_centrality': 0.127, 'max_degree_centrality': 0.5556, 'avg_betweenness_centrality': 0.0011, 'max_betweenness_centrality': 0.0093, 'degree_assortativity': -0.4842, 'graph_robustness': 0.8333, 'diameter_estimate': 4, 'clustering_coefficient': 0.2919, 'weakly_connected_components': 5, 'largest_wcc_size': 24, 'pagerank_top10_percent': 59.02, 'louvain_communities': 8, 'louvain_modularity': 0.3913, 'label_entropy': 1.453, 'computational_time': 0.006428244058042765}, 'retrieval_queries': []}
2025-11-30 21:41:29,564 - src.pipeline.kg_builder - DEBUG - Batch 1 metrics: {
  "batch_idx": 1,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510089.5646353,
  "total_time": 56.92356176802423,
  "aggregation": 4.691071808338165e-06,
  "network_info": 0.005157366977073252,
  "llm_extraction": 56.76742188807111,
  "data_cleaning": 2.719694748520851e-05,
  "neo4j_injection": 0.14315174403600395,
  "embedding_time": 0,
  "indexing_time": 0.00523272599093616,
  "graph_injection_time": 0.13764165400061756,
  "acs_metrics": {
    "node_count": 28,
    "relationship_count": 48,
    "density": 0.0635,
    "avg_degree": 3.4286,
    "avg_unique_neighbors": 3.4286,
    "global_efficiency": 0.3818,
    "avg_path_length": 2.2355,
    "avg_degree_centrality": 0.127,
    "max_degree_centrality": 0.5556,
    "avg_betweenness_centrality": 0.0011,
    "max_betweenness_centrality": 0.0093,
    "degree_assortativity": -0.4842,
    "graph_robustness": 0.8333,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.2919,
    "weakly_connected_components": 5,
    "largest_wcc_size": 24,
    "pagerank_top10_percent": 59.02,
    "louvain_communities": 8,
    "louvain_modularity": 0.3913,
    "label_entropy": 1.453,
    "computational_time": 0.006428244058042765
  },
  "retrieval_queries": []
}
2025-11-30 21:41:29,564 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:41:29,564 - src.pipeline.kg_builder - INFO - Batch 2 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 56.77s, Clean: 0.00s, Neo4j: 0.14s, ACS: 0.01s
2025-11-30 21:41:29,565 - src.pipeline.kg_builder - INFO - Batch 2 completed in 56.92s
Processing KG batches:   3%|▎         | 2/72 [01:10<45:49, 39.28s/it]2025-11-30 21:41:29,565 - src.pipeline.kg_builder - INFO - Processing batch 3/72 (3 items)
2025-11-30 21:41:29,565 - src.pipeline.kg_builder - DEBUG - Batch 3 current_video_time: 00:39-00:44
2025-11-30 21:41:29,573 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 28
- Total Relationships: 19
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:41:29,574 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:41:29,574 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0 ~177 words, content: Time: 00:29-00:34 Content: The video captures a scene in a laboratory setting where a person is conducting a chemistry experiment. The central focus is on...
2025-11-30 21:41:29,574 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1 ~205 words, content: or the product of the reaction. - A white, circular device with multiple holes, possibly a multi-well plate or a component of the experimental setup....
2025-11-30 21:41:29,574 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_2 ~204 words, content: the report, which is laid out on the table. The report details an experiment to produce hydrogen gas by reacting aluminum with sodium hydroxide. The...
2025-11-30 21:41:29,574 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_3 ~193 words, content: , protected by a blue nitrile glove, as they write on a printed document titled "AR 眼镜训练用化学实验报告 (简版)" (AR Glasses Training Chemistry Experiment Report -...
2025-11-30 21:41:29,574 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:41:29,574 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0) (~177 words) with timeout=5.0s retries=3
2025-11-30 21:41:30,693 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:41:30,693 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:41:30,693 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1) (~205 words) with timeout=5.0s retries=3
2025-11-30 21:41:32,077 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:41:32,077 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:41:32,077 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_2) (~204 words) with timeout=5.0s retries=3
2025-11-30 21:41:33,147 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:41:33,148 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:41:33,148 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_3) (~193 words) with timeout=5.0s retries=3
2025-11-30 21:41:34,392 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:41:34,393 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:41:34,393 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 4 chunks
2025-11-30 21:41:34,393 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 4.82s
2025-11-30 21:41:34,393 - src.components.global_refiner - INFO - Capping refinement input: 22 → 15 triplets
2025-11-30 21:41:34,393 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 28
- Total Relationships: 19
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_2"]}, {"head": "Person", "relation": "Holds", "tail": "White Marker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0"]}, {"head": "Person", "relation": "Writes", "tail": "Document", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_3"]}, {"head": "Document", "relation": "Contains", "tail": "Chemical Reaction Report", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0"]}, {"head": "Test Tube", "relation": "Has", "tail": "Blue Cap", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0"]}, {"head": "Laboratory Table", "relation": "Contains", "tail": "Test Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1"]}, {"head": "Person", "relation": "Fills Out", "tail": "Chemistry Experiment Report", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1"]}, {"head": "Chemistry Experiment Report", "relation": "Is Laid On", "tail": "Lab Bench", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "White Circular Device", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Black Elongated Case", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Roll Of Tape", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1"]}, {"head": "Person", "relation": "Writes On", "tail": "Report", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_2"]}, {"head": "Report", "relation": "Contains", "tail": "Experiment Purpose", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_2"]}, {"head": "Report", "relation": "Contains", "tail": "Experiment Principle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:41:34,394 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~268 words, ~348 tokens)
2025-11-30 21:41:34,394 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:41:52,198 - src.components.global_refiner - DEBUG - LLM call completed in 17.80s
2025-11-30 21:41:52,199 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue Nitrile Glove', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_2']], ['Person', 'wears', 'Blue Nitrile Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1']], ['Person', 'holds', 'White Marker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0']], ['Person', 'writes', 'Document', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_3']], ['Document', 'contains', 'Chemical Reaction Report', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0']], ['Test Tube', 'has', 'Blue Cap', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0']], ['Laboratory Table', 'contains', 'Test Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0']], ['Person', 'fills_out', 'Chemistry Experiment Report', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1']], ['Chemistry Experiment Report', 'is_laid_on', 'Lab Bench', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1']], ['Lab Bench', 'contains', 'White Circular Device', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1']], ['Lab Bench', 'contains', 'Black Elongated Case', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1']], ['Lab Bench', 'contains', 'Roll Of Tape', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1']], ['Person', 'writes_on', 'Report', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_2']], ['Report', 'contains', 'Experiment Purpose', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_2']], ['Report', 'contains', 'Experiment Principle', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_2']]]
2025-11-30 21:41:52,199 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue Nitrile Glove",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Nitrile Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1"
    ]
  ],
  [
    "Person",
    "holds",
    "White Marker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0"
    ]
  ],
  [
    "Person",
    "writes",
    "Document",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_3"
    ]
  ],
  [
    "Document",
    "contains",
    "Chemical Reaction Report",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0"
    ]
  ],
  [
    "Test Tube",
    "has",
    "Blue Cap",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0"
    ]
  ],
  [
    "Laboratory Table",
    "contains",
    "Test Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_0"
    ]
  ],
  [
    "Person",
    "fills_out",
    "Chemistry Experiment Report",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1"
    ]
  ],
  [
    "Chemistry Experiment Report",
    "is_laid_on",
    "Lab Bench",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1"
    ]
  ],
  [
    "Lab Bench",
    "contains",
    "White Circular Device",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1"
    ]
  ],
  [
    "Lab Bench",
    "contains",
    "Black Elongated Case",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1"
    ]
  ],
  [
    "Lab Bench",
    "contains",
    "Roll Of Tape",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_1"
    ]
  ],
  [
    "Person",
    "writes_on",
    "Report",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_2"
    ]
  ],
  [
    "Report",
    "contains",
    "Experiment Purpose",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_2"
    ]
  ],
  [
    "Report",
    "contains",
    "Experiment Principle",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_2_2"
    ]
  ]
]
2025-11-30 21:41:52,199 - src.components.global_refiner - INFO - Refinement complete: 15 → 15 triplets (total: 17.81s, LLM: 17.80s)
2025-11-30 21:41:52,199 - src.pipeline.kg_builder - INFO - Global refinement: 15 triplets in 17.81s
2025-11-30 21:41:52,199 - src.pipeline.kg_builder - INFO - Using 15 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:41:52,199 - src.pipeline.kg_builder - INFO - Pushing batch 3/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:41:52,199 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:41:52,402 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:41:52,402 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:41:52,402 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:41:52,402 - src.components.neo4j_handler - INFO - Batch injected in 0.20s (triplets: 0.20s, indexes: 0.00s)
2025-11-30 21:41:52,403 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 13, 'with_embedding': 0, 'linked_chunks': 9}
2025-11-30 21:41:52,403 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:41:52,407 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 47 nodes
2025-11-30 21:41:52,409 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 43 nodes
2025-11-30 21:41:52,415 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 47, 'relationship_count': 85, 'density': 0.0393, 'avg_degree': 3.617, 'avg_unique_neighbors': 3.617, 'global_efficiency': 0.3774, 'avg_path_length': 2.536, 'avg_degree_centrality': 0.0786, 'max_degree_centrality': 0.5435, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0031, 'degree_assortativity': -0.399, 'graph_robustness': 0.8471, 'diameter_estimate': 4, 'clustering_coefficient': 0.324, 'weakly_connected_components': 5, 'largest_wcc_size': 43, 'pagerank_top10_percent': 48.31, 'louvain_communities': 10, 'louvain_modularity': 0.4983, 'label_entropy': 1.4254, 'computational_time': 0.012062340043485165}
2025-11-30 21:41:52,415 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 2, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510112.4157798, 'total_time': 22.850693264976144, 'aggregation': 7.314025424420834e-06, 'network_info': 0.008355995989404619, 'llm_extraction': 22.625864313915372, 'data_cleaning': 3.36390221491456e-05, 'neo4j_injection': 0.20297144004143775, 'embedding_time': 0, 'indexing_time': 0.002454239991493523, 'graph_injection_time': 0.20026353793218732, 'acs_metrics': {'node_count': 47, 'relationship_count': 85, 'density': 0.0393, 'avg_degree': 3.617, 'avg_unique_neighbors': 3.617, 'global_efficiency': 0.3774, 'avg_path_length': 2.536, 'avg_degree_centrality': 0.0786, 'max_degree_centrality': 0.5435, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0031, 'degree_assortativity': -0.399, 'graph_robustness': 0.8471, 'diameter_estimate': 4, 'clustering_coefficient': 0.324, 'weakly_connected_components': 5, 'largest_wcc_size': 43, 'pagerank_top10_percent': 48.31, 'louvain_communities': 10, 'louvain_modularity': 0.4983, 'label_entropy': 1.4254, 'computational_time': 0.012062340043485165}, 'retrieval_queries': []}
2025-11-30 21:41:52,415 - src.pipeline.kg_builder - DEBUG - Batch 2 metrics: {
  "batch_idx": 2,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510112.4157798,
  "total_time": 22.850693264976144,
  "aggregation": 7.314025424420834e-06,
  "network_info": 0.008355995989404619,
  "llm_extraction": 22.625864313915372,
  "data_cleaning": 3.36390221491456e-05,
  "neo4j_injection": 0.20297144004143775,
  "embedding_time": 0,
  "indexing_time": 0.002454239991493523,
  "graph_injection_time": 0.20026353793218732,
  "acs_metrics": {
    "node_count": 47,
    "relationship_count": 85,
    "density": 0.0393,
    "avg_degree": 3.617,
    "avg_unique_neighbors": 3.617,
    "global_efficiency": 0.3774,
    "avg_path_length": 2.536,
    "avg_degree_centrality": 0.0786,
    "max_degree_centrality": 0.5435,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0031,
    "degree_assortativity": -0.399,
    "graph_robustness": 0.8471,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.324,
    "weakly_connected_components": 5,
    "largest_wcc_size": 43,
    "pagerank_top10_percent": 48.31,
    "louvain_communities": 10,
    "louvain_modularity": 0.4983,
    "label_entropy": 1.4254,
    "computational_time": 0.012062340043485165
  },
  "retrieval_queries": []
}
2025-11-30 21:41:52,416 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:41:52,416 - src.pipeline.kg_builder - INFO - Batch 3 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 22.63s, Clean: 0.00s, Neo4j: 0.20s, ACS: 0.01s
2025-11-30 21:41:52,416 - src.pipeline.kg_builder - INFO - Batch 3 completed in 22.85s
Processing KG batches:   4%|▍         | 3/72 [01:33<36:32, 31.78s/it]2025-11-30 21:41:52,416 - src.pipeline.kg_builder - INFO - Processing batch 4/72 (3 items)
2025-11-30 21:41:52,416 - src.pipeline.kg_builder - DEBUG - Batch 4 current_video_time: 00:54-00:59
2025-11-30 21:41:52,425 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 47
- Total Relationships: 34
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:41:52,426 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:41:52,426 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0 ~186 words, content: Time: 00:44-00:49 Content: The video sequence captures a person conducting a chemistry experiment in a laboratory setting, focusing on the preparation and documentation of a...
2025-11-30 21:41:52,426 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1 ~240 words, content: to a wider, slightly elevated view of the laboratory. This broader shot reveals more of the workspace, including a power strip with multiple plugs, a...
2025-11-30 21:41:52,426 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_2 ~241 words, content: , and a yellow box. A person wearing blue gloves is seen handling a piece of aluminum foil, which is likely being used to cover...
2025-11-30 21:41:52,426 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_3 ~164 words, content: :59 Content: The video sequence captures a person preparing to conduct a precise measurement in a laboratory setting. The scene is set in a well-equipped...
2025-11-30 21:41:52,426 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:41:52,426 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0) (~186 words) with timeout=5.0s retries=3
2025-11-30 21:41:53,884 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:41:53,884 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:41:53,884 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1) (~240 words) with timeout=5.0s retries=3
2025-11-30 21:41:54,891 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:41:54,891 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:41:54,891 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_2) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:41:56,106 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:41:56,107 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:41:56,107 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_3) (~164 words) with timeout=5.0s retries=3
2025-11-30 21:41:57,550 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:41:57,550 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:41:57,550 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-30 21:41:57,551 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 5.12s
2025-11-30 21:41:57,551 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 21:41:57,551 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 47
- Total Relationships: 34
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0"]}, {"head": "Person", "relation": "Writes On", "tail": "Chemistry_Experiment_Report", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0"]}, {"head": "Chemistry_Experiment_Report", "relation": "Contains", "tail": "Chemical_Equation", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0"]}, {"head": "Chemical_Equation", "relation": "Includes", "tail": "Aluminum", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0"]}, {"head": "Chemical_Equation", "relation": "Includes", "tail": "Sodium_Hydroxide", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0"]}, {"head": "Chemical_Equation", "relation": "Produces", "tail": "Hydrogen_Gas", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Equipment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Power Strip", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Balance Scale", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1"]}, {"head": "Document", "relation": "Is On", "tail": "Bench", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1"]}, {"head": "Person", "relation": "Wears", "tail": "Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1"]}, {"head": "Bench", "relation": "Contains", "tail": "Test Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_2"]}, {"head": "Person", "relation": "Handles", "tail": "Aluminum_Foil", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_2"]}, {"head": "Person", "relation": "Places", "tail": "Aluminum_Foil", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:41:57,551 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~240 words, ~312 tokens)
2025-11-30 21:41:57,551 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:42:08,817 - src.components.global_refiner - DEBUG - LLM call completed in 11.27s
2025-11-30 21:42:08,817 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0']], ['Person', 'writes_on', 'Chemistry_Experiment_Report', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0']], ['Chemistry_Experiment_Report', 'contains', 'Chemical_Equation', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0']], ['Chemical_Equation', 'includes', 'Aluminum', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0']], ['Chemical_Equation', 'includes', 'Sodium_Hydroxide', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0']], ['Chemical_Equation', 'produces', 'Hydrogen_Gas', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0']], ['Laboratory', 'contains', 'Equipment', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1']], ['Laboratory', 'contains', 'Power_Strips', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1']], ['Laboratory', 'contains', 'Balance_Scale', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1']], ['Document', 'is_on', 'Bench', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1']]]
2025-11-30 21:42:08,818 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0"
    ]
  ],
  [
    "Person",
    "writes_on",
    "Chemistry_Experiment_Report",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0"
    ]
  ],
  [
    "Chemistry_Experiment_Report",
    "contains",
    "Chemical_Equation",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0"
    ]
  ],
  [
    "Chemical_Equation",
    "includes",
    "Aluminum",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0"
    ]
  ],
  [
    "Chemical_Equation",
    "includes",
    "Sodium_Hydroxide",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0"
    ]
  ],
  [
    "Chemical_Equation",
    "produces",
    "Hydrogen_Gas",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_0"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Equipment",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Power_Strips",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Balance_Scale",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1"
    ]
  ],
  [
    "Document",
    "is_on",
    "Bench",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_3_1"
    ]
  ]
]
2025-11-30 21:42:08,818 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.27s, LLM: 11.27s)
2025-11-30 21:42:08,818 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.27s
2025-11-30 21:42:08,818 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:42:08,818 - src.pipeline.kg_builder - INFO - Pushing batch 4/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:42:08,818 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:42:08,914 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:42:08,914 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:42:08,914 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:42:08,914 - src.components.neo4j_handler - INFO - Batch injected in 0.10s (triplets: 0.09s, indexes: 0.00s)
2025-11-30 21:42:08,915 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 17, 'with_embedding': 0, 'linked_chunks': 11}
2025-11-30 21:42:08,915 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:42:08,919 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 60 nodes
2025-11-30 21:42:08,921 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 54 nodes
2025-11-30 21:42:08,927 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 60, 'relationship_count': 108, 'density': 0.0305, 'avg_degree': 3.6, 'avg_unique_neighbors': 3.6, 'global_efficiency': 0.3438, 'avg_path_length': 2.682, 'avg_degree_centrality': 0.061, 'max_degree_centrality': 0.4746, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0019, 'degree_assortativity': -0.3739, 'graph_robustness': 0.8056, 'diameter_estimate': 4, 'clustering_coefficient': 0.3201, 'weakly_connected_components': 7, 'largest_wcc_size': 54, 'pagerank_top10_percent': 44.49, 'louvain_communities': 14, 'louvain_modularity': 0.5325, 'label_entropy': 1.43, 'computational_time': 0.012049262993969023}
2025-11-30 21:42:08,927 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 3, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510128.9277258, 'total_time': 16.511371169006452, 'aggregation': 7.897964678704739e-06, 'network_info': 0.009448586963117123, 'llm_extraction': 16.392180628958158, 'data_cleaning': 1.9620987586677074e-05, 'neo4j_injection': 0.09624571399763227, 'embedding_time': 0, 'indexing_time': 0.003679190995171666, 'graph_injection_time': 0.09236454591155052, 'acs_metrics': {'node_count': 60, 'relationship_count': 108, 'density': 0.0305, 'avg_degree': 3.6, 'avg_unique_neighbors': 3.6, 'global_efficiency': 0.3438, 'avg_path_length': 2.682, 'avg_degree_centrality': 0.061, 'max_degree_centrality': 0.4746, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0019, 'degree_assortativity': -0.3739, 'graph_robustness': 0.8056, 'diameter_estimate': 4, 'clustering_coefficient': 0.3201, 'weakly_connected_components': 7, 'largest_wcc_size': 54, 'pagerank_top10_percent': 44.49, 'louvain_communities': 14, 'louvain_modularity': 0.5325, 'label_entropy': 1.43, 'computational_time': 0.012049262993969023}, 'retrieval_queries': []}
2025-11-30 21:42:08,927 - src.pipeline.kg_builder - DEBUG - Batch 3 metrics: {
  "batch_idx": 3,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510128.9277258,
  "total_time": 16.511371169006452,
  "aggregation": 7.897964678704739e-06,
  "network_info": 0.009448586963117123,
  "llm_extraction": 16.392180628958158,
  "data_cleaning": 1.9620987586677074e-05,
  "neo4j_injection": 0.09624571399763227,
  "embedding_time": 0,
  "indexing_time": 0.003679190995171666,
  "graph_injection_time": 0.09236454591155052,
  "acs_metrics": {
    "node_count": 60,
    "relationship_count": 108,
    "density": 0.0305,
    "avg_degree": 3.6,
    "avg_unique_neighbors": 3.6,
    "global_efficiency": 0.3438,
    "avg_path_length": 2.682,
    "avg_degree_centrality": 0.061,
    "max_degree_centrality": 0.4746,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0019,
    "degree_assortativity": -0.3739,
    "graph_robustness": 0.8056,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.3201,
    "weakly_connected_components": 7,
    "largest_wcc_size": 54,
    "pagerank_top10_percent": 44.49,
    "louvain_communities": 14,
    "louvain_modularity": 0.5325,
    "label_entropy": 1.43,
    "computational_time": 0.012049262993969023
  },
  "retrieval_queries": []
}
2025-11-30 21:42:08,928 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:42:08,928 - src.pipeline.kg_builder - INFO - Batch 4 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 16.39s, Clean: 0.00s, Neo4j: 0.10s, ACS: 0.01s
2025-11-30 21:42:08,928 - src.pipeline.kg_builder - INFO - Batch 4 completed in 16.51s
Processing KG batches:   6%|▌         | 4/72 [01:50<29:11, 25.75s/it]2025-11-30 21:42:08,928 - src.pipeline.kg_builder - INFO - Processing batch 5/72 (3 items)
2025-11-30 21:42:08,928 - src.pipeline.kg_builder - DEBUG - Batch 5 current_video_time: 01:09-01:14
2025-11-30 21:42:08,934 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 60
- Total Relationships: 44
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:42:08,934 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:42:08,934 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0 ~233 words, content: Time: 00:59-01:04 Content: The video sequence captures a series of actions performed by a person in a laboratory setting, focusing on the preparation of a...
2025-11-30 21:42:08,934 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1 ~241 words, content: they continue to use the pipette. The liquid is being carefully transferred into the beaker, which is still on the balance scale. The person's movements...
2025-11-30 21:42:08,934 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_2 ~236 words, content: and safety throughout the process. The sequence of actions, from weighing the beaker to transferring the liquid and stirring it, indicates a methodical approach to...
2025-11-30 21:42:08,934 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_3 ~225 words, content: and attention to detail. The overall atmosphere is one of concentration and scientific rigor. Time: 01:09-01:14 Content: The video sequence captures a series of actions...
2025-11-30 21:42:08,934 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_4 ~226 words, content: - **Frame 3:** The person's hands are now actively engaged in opening the bottle. The left hand holds the bottle while the right hand, also...
2025-11-30 21:42:08,934 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:42:08,935 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:42:10,071 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:42:10,072 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:42:10,072 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:42:11,246 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:42:11,246 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:42:11,247 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_2) (~236 words) with timeout=5.0s retries=3
2025-11-30 21:42:12,341 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:42:12,341 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:42:12,341 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_3) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:42:13,676 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:42:13,677 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:42:13,677 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_4) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:42:14,762 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:42:14,762 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:42:14,762 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 5 chunks
2025-11-30 21:42:14,762 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 5.83s
2025-11-30 21:42:14,763 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 21:42:14,763 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 60
- Total Relationships: 44
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_3"]}, {"head": "Person", "relation": "Handles", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_2"]}, {"head": "Beaker", "relation": "Is On", "tail": "Balance_Scale", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1"]}, {"head": "Person", "relation": "Closes", "tail": "Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1"]}, {"head": "Person", "relation": "Stirs", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1"]}, {"head": "Glass_Rod", "relation": "Is Used To Stir", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1"]}, {"head": "Person", "relation": "Uses", "tail": "Magnetic_Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_2"]}, {"head": "Person", "relation": "Uses", "tail": "Burette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_2"]}, {"head": "Person", "relation": "Uses", "tail": "Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_2"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_3", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_4"]}, {"head": "Person", "relation": "Holds", "tail": "White_Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:42:14,763 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~248 words, ~322 tokens)
2025-11-30 21:42:14,763 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:42:30,486 - src.components.global_refiner - DEBUG - LLM call completed in 15.72s
2025-11-30 21:42:30,486 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_3']], ['Person', 'handles', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_2']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_2']], ['Beaker', 'is_on', 'Balance_Scale', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1']], ['Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0']], ['Person', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0']], ['Liquid', 'is_transferred_to', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1']], ['Person', 'closes', 'Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1']], ['Person', 'stirs', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1']], ['Glass_Rod', 'is_used_to_stir', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1']]]
2025-11-30 21:42:30,486 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_3"
    ]
  ],
  [
    "Person",
    "handles",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_2"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Balance_Scale",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_0"
    ]
  ],
  [
    "Liquid",
    "is_transferred_to",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1"
    ]
  ],
  [
    "Person",
    "closes",
    "Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1"
    ]
  ],
  [
    "Person",
    "stirs",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1"
    ]
  ],
  [
    "Glass_Rod",
    "is_used_to_stir",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_4_1"
    ]
  ]
]
2025-11-30 21:42:30,487 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 15.72s, LLM: 15.72s)
2025-11-30 21:42:30,487 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 15.72s
2025-11-30 21:42:30,487 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:42:30,487 - src.pipeline.kg_builder - INFO - Pushing batch 5/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:42:30,487 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:42:30,640 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:42:30,640 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:42:30,640 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:42:30,640 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.15s, indexes: 0.00s)
2025-11-30 21:42:30,641 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 22, 'with_embedding': 0, 'linked_chunks': 15}
2025-11-30 21:42:30,641 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:42:30,645 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 70 nodes
2025-11-30 21:42:30,649 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 63 nodes
2025-11-30 21:42:30,656 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 70, 'relationship_count': 135, 'density': 0.028, 'avg_degree': 3.8571, 'avg_unique_neighbors': 3.8571, 'global_efficiency': 0.3481, 'avg_path_length': 2.6221, 'avg_degree_centrality': 0.0559, 'max_degree_centrality': 0.5217, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0018, 'degree_assortativity': -0.3611, 'graph_robustness': 0.8519, 'diameter_estimate': 4, 'clustering_coefficient': 0.3085, 'weakly_connected_components': 8, 'largest_wcc_size': 63, 'pagerank_top10_percent': 39.24, 'louvain_communities': 14, 'louvain_modularity': 0.5298, 'label_entropy': 1.449, 'computational_time': 0.015126502024941146}
2025-11-30 21:42:30,656 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 4, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510150.656843, 'total_time': 21.728626089985482, 'aggregation': 2.6650959625840187e-06, 'network_info': 0.005829625995829701, 'llm_extraction': 21.553024135995656, 'data_cleaning': 2.415408380329609e-05, 'neo4j_injection': 0.1532979819457978, 'embedding_time': 0, 'indexing_time': 0.004406800959259272, 'graph_injection_time': 0.14864894503261894, 'acs_metrics': {'node_count': 70, 'relationship_count': 135, 'density': 0.028, 'avg_degree': 3.8571, 'avg_unique_neighbors': 3.8571, 'global_efficiency': 0.3481, 'avg_path_length': 2.6221, 'avg_degree_centrality': 0.0559, 'max_degree_centrality': 0.5217, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0018, 'degree_assortativity': -0.3611, 'graph_robustness': 0.8519, 'diameter_estimate': 4, 'clustering_coefficient': 0.3085, 'weakly_connected_components': 8, 'largest_wcc_size': 63, 'pagerank_top10_percent': 39.24, 'louvain_communities': 14, 'louvain_modularity': 0.5298, 'label_entropy': 1.449, 'computational_time': 0.015126502024941146}, 'retrieval_queries': []}
2025-11-30 21:42:30,656 - src.pipeline.kg_builder - DEBUG - Batch 4 metrics: {
  "batch_idx": 4,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510150.656843,
  "total_time": 21.728626089985482,
  "aggregation": 2.6650959625840187e-06,
  "network_info": 0.005829625995829701,
  "llm_extraction": 21.553024135995656,
  "data_cleaning": 2.415408380329609e-05,
  "neo4j_injection": 0.1532979819457978,
  "embedding_time": 0,
  "indexing_time": 0.004406800959259272,
  "graph_injection_time": 0.14864894503261894,
  "acs_metrics": {
    "node_count": 70,
    "relationship_count": 135,
    "density": 0.028,
    "avg_degree": 3.8571,
    "avg_unique_neighbors": 3.8571,
    "global_efficiency": 0.3481,
    "avg_path_length": 2.6221,
    "avg_degree_centrality": 0.0559,
    "max_degree_centrality": 0.5217,
    "avg_betweenness_centrality": 0.0002,
    "max_betweenness_centrality": 0.0018,
    "degree_assortativity": -0.3611,
    "graph_robustness": 0.8519,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.3085,
    "weakly_connected_components": 8,
    "largest_wcc_size": 63,
    "pagerank_top10_percent": 39.24,
    "louvain_communities": 14,
    "louvain_modularity": 0.5298,
    "label_entropy": 1.449,
    "computational_time": 0.015126502024941146
  },
  "retrieval_queries": []
}
2025-11-30 21:42:30,657 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:42:30,657 - src.pipeline.kg_builder - INFO - Batch 5 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 21.55s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.02s
2025-11-30 21:42:30,657 - src.pipeline.kg_builder - INFO - Batch 5 completed in 21.73s
Processing KG batches:   7%|▋         | 5/72 [02:12<27:08, 24.30s/it]2025-11-30 21:42:30,657 - src.pipeline.kg_builder - INFO - Processing batch 6/72 (3 items)
2025-11-30 21:42:30,657 - src.pipeline.kg_builder - DEBUG - Batch 6 current_video_time: 01:24-01:29
2025-11-30 21:42:30,665 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 70
- Total Relationships: 53
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:42:30,665 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:42:30,665 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0 ~233 words, content: Time: 01:14-01:19 Content: The video captures a sequence of actions in a laboratory setting, focusing on a person preparing a chemical experiment. The scene is...
2025-11-30 21:42:30,665 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1 ~228 words, content: , star-shaped component at the top, which is connected by tubing to the beaker on the stirrer. This suggests a setup for a reaction that...
2025-11-30 21:42:30,665 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_2 ~203 words, content: - **Frame 2:** The scene shifts to a different area of the lab. A person, wearing a beige sweater, is holding a white plastic bottle....
2025-11-30 21:42:30,666 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_3 ~209 words, content: a well-organized laboratory with a glass-fronted storage cabinet filled with various chemicals and reagents. The overall environment is clean and orderly. In summary, the video...
2025-11-30 21:42:30,666 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_4 ~205 words, content: and can cause severe skin burns and eye damage. The background shows a laboratory environment with a glass-enclosed storage cabinet, a door, and a workbench....
2025-11-30 21:42:30,666 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_5 ~113 words, content: the bottle. The powder is then carefully transferred into a small, clear glass beaker that is resting on a digital balance scale. This indicates that...
2025-11-30 21:42:30,666 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:42:30,666 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:42:32,179 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:42:32,179 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:42:32,180 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1) (~228 words) with timeout=5.0s retries=3
2025-11-30 21:42:33,441 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:42:33,441 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:42:33,442 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_2) (~203 words) with timeout=5.0s retries=3
2025-11-30 21:42:34,703 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:42:34,703 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:42:34,704 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_3) (~209 words) with timeout=5.0s retries=3
2025-11-30 21:42:36,592 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:42:36,593 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:42:36,593 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_4) (~205 words) with timeout=5.0s retries=3
2025-11-30 21:42:37,811 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:42:37,811 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:42:37,812 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_5) (~113 words) with timeout=5.0s retries=3
2025-11-30 21:42:39,285 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:42:39,285 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:42:39,285 - src.components.pre_llm_injector - INFO - Extracted 35 local triplets from 6 chunks
2025-11-30 21:42:39,285 - src.pipeline.kg_builder - INFO - Pre-extraction: 35 triplets in 8.62s
2025-11-30 21:42:39,286 - src.components.global_refiner - INFO - Capping refinement input: 35 → 15 triplets
2025-11-30 21:42:39,287 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 70
- Total Relationships: 53
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Rod", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0"]}, {"head": "Magnetic_Stirrer", "relation": "Contains", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0"]}, {"head": "Magnetic_Stirrer", "relation": "Displays", "tail": "0.180", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0"]}, {"head": "Glass_Rod", "relation": "Stirs", "tail": "Reagent_Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0"]}, {"head": "Person", "relation": "Interacts With", "tail": "Equipment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1"]}, {"head": "Equipment", "relation": "Contains", "tail": "Magnetic_Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1"]}, {"head": "Magnetic_Stirrer", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1"]}, {"head": "Liquid", "relation": "Is Part Of", "tail": "Reaction_Vessel", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1"]}, {"head": "Person", "relation": "Wears", "tail": "Beige Sweater", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_2"]}, {"head": "Person", "relation": "Holds", "tail": "White Plastic Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_2"]}, {"head": "White Plastic Bottle", "relation": "Has Label", "tail": "General-Reagent", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_2"]}, {"head": "White Plastic Bottle", "relation": "Contains", "tail": "Sodium Hydroxide", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:42:39,287 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~248 words, ~322 tokens)
2025-11-30 21:42:39,287 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:42:51,402 - src.components.global_refiner - DEBUG - LLM call completed in 12.12s
2025-11-30 21:42:51,402 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Glove', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1']], ['Person', 'holds', 'Glass_Rod', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0']], ['Magnetic_Stirrer', 'contains', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0']], ['Beaker', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0']], ['Magnetic_Stirrer', 'displays', '0.180', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0']], ['Glass_Rod', 'stirs', 'Reagent_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0']], ['Person', 'interacts_with', 'Equipment', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1']], ['Equipment', 'contains', 'Magnetic_Stirrer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1']], ['Magnetic_Stirrer', 'holds', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1']], ['Beaker', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1']]]
2025-11-30 21:42:51,402 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Glove",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Rod",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "contains",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "displays",
    "0.180",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0"
    ]
  ],
  [
    "Glass_Rod",
    "stirs",
    "Reagent_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_0"
    ]
  ],
  [
    "Person",
    "interacts_with",
    "Equipment",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1"
    ]
  ],
  [
    "Equipment",
    "contains",
    "Magnetic_Stirrer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "holds",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_5_1"
    ]
  ]
]
2025-11-30 21:42:51,402 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 12.12s, LLM: 12.12s)
2025-11-30 21:42:51,402 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 12.12s
2025-11-30 21:42:51,402 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:42:51,403 - src.pipeline.kg_builder - INFO - Pushing batch 6/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:42:51,403 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:42:51,548 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:42:51,548 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:42:51,548 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:42:51,548 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.14s, indexes: 0.01s)
2025-11-30 21:42:51,549 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 28, 'with_embedding': 0, 'linked_chunks': 17}
2025-11-30 21:42:51,549 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:42:51,554 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 81 nodes
2025-11-30 21:42:51,558 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 70 nodes
2025-11-30 21:42:51,567 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 81, 'relationship_count': 157, 'density': 0.0242, 'avg_degree': 3.8765, 'avg_unique_neighbors': 3.8519, 'global_efficiency': 0.3186, 'avg_path_length': 2.6323, 'avg_degree_centrality': 0.0485, 'max_degree_centrality': 0.5, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0048, 'degree_assortativity': -0.3401, 'graph_robustness': 0.8726, 'diameter_estimate': 4, 'clustering_coefficient': 0.2915, 'weakly_connected_components': 12, 'largest_wcc_size': 70, 'pagerank_top10_percent': 35.51, 'louvain_communities': 18, 'louvain_modularity': 0.5094, 'label_entropy': 1.4651, 'computational_time': 0.018108002026565373}
2025-11-30 21:42:51,567 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 5, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510171.5678458, 'total_time': 20.910523255937733, 'aggregation': 7.4070412665605545e-06, 'network_info': 0.007784103974699974, 'llm_extraction': 20.737678126082756, 'data_cleaning': 2.5823013857007027e-05, 'neo4j_injection': 0.1456459549954161, 'embedding_time': 0, 'indexing_time': 0.006653935997746885, 'graph_injection_time': 0.1387228419771418, 'acs_metrics': {'node_count': 81, 'relationship_count': 157, 'density': 0.0242, 'avg_degree': 3.8765, 'avg_unique_neighbors': 3.8519, 'global_efficiency': 0.3186, 'avg_path_length': 2.6323, 'avg_degree_centrality': 0.0485, 'max_degree_centrality': 0.5, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0048, 'degree_assortativity': -0.3401, 'graph_robustness': 0.8726, 'diameter_estimate': 4, 'clustering_coefficient': 0.2915, 'weakly_connected_components': 12, 'largest_wcc_size': 70, 'pagerank_top10_percent': 35.51, 'louvain_communities': 18, 'louvain_modularity': 0.5094, 'label_entropy': 1.4651, 'computational_time': 0.018108002026565373}, 'retrieval_queries': []}
2025-11-30 21:42:51,567 - src.pipeline.kg_builder - DEBUG - Batch 5 metrics: {
  "batch_idx": 5,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510171.5678458,
  "total_time": 20.910523255937733,
  "aggregation": 7.4070412665605545e-06,
  "network_info": 0.007784103974699974,
  "llm_extraction": 20.737678126082756,
  "data_cleaning": 2.5823013857007027e-05,
  "neo4j_injection": 0.1456459549954161,
  "embedding_time": 0,
  "indexing_time": 0.006653935997746885,
  "graph_injection_time": 0.1387228419771418,
  "acs_metrics": {
    "node_count": 81,
    "relationship_count": 157,
    "density": 0.0242,
    "avg_degree": 3.8765,
    "avg_unique_neighbors": 3.8519,
    "global_efficiency": 0.3186,
    "avg_path_length": 2.6323,
    "avg_degree_centrality": 0.0485,
    "max_degree_centrality": 0.5,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0048,
    "degree_assortativity": -0.3401,
    "graph_robustness": 0.8726,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.2915,
    "weakly_connected_components": 12,
    "largest_wcc_size": 70,
    "pagerank_top10_percent": 35.51,
    "louvain_communities": 18,
    "louvain_modularity": 0.5094,
    "label_entropy": 1.4651,
    "computational_time": 0.018108002026565373
  },
  "retrieval_queries": []
}
2025-11-30 21:42:51,568 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:42:51,568 - src.pipeline.kg_builder - INFO - Batch 6 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 20.74s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.02s
2025-11-30 21:42:51,568 - src.pipeline.kg_builder - INFO - Batch 6 completed in 20.91s
Processing KG batches:   8%|▊         | 6/72 [02:32<25:27, 23.15s/it]2025-11-30 21:42:51,568 - src.pipeline.kg_builder - INFO - Processing batch 7/72 (3 items)
2025-11-30 21:42:51,568 - src.pipeline.kg_builder - DEBUG - Batch 7 current_video_time: 01:39-01:44
2025-11-30 21:42:51,576 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 81
- Total Relationships: 62
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:42:51,576 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:42:51,576 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0 ~214 words, content: Time: 01:29-01:34 Content: The video sequence captures a scientific procedure, likely a chemical experiment, taking place in a laboratory setting. The perspective is first-person, showing...
2025-11-30 21:42:51,576 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1 ~218 words, content: **Preparation for Addition:** The experimenter holds the white bottle, which is labeled as a "GENERAL REAGENT" and has hazard symbols, indicating it contains a chemical...
2025-11-30 21:42:51,576 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_2 ~221 words, content: opens the glass enclosure of the balance scale. They then use a small metal spatula to carefully scoop a white, powdery substance from the bottle....
2025-11-30 21:42:51,576 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_3 ~132 words, content: substance being added. - **Procedure:** The person uses a small metal spatula to scoop the powder from the bottle. The action is deliberate and controlled,...
2025-11-30 21:42:51,576 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:42:51,577 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0) (~214 words) with timeout=5.0s retries=3
2025-11-30 21:42:53,090 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:42:53,090 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:42:53,090 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1) (~218 words) with timeout=5.0s retries=3
2025-11-30 21:42:54,450 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:42:54,450 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:42:54,451 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_2) (~221 words) with timeout=5.0s retries=3
2025-11-30 21:42:55,790 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:42:55,790 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:42:55,790 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_3) (~132 words) with timeout=5.0s retries=3
2025-11-30 21:42:56,764 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:42:56,765 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:42:56,765 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-30 21:42:56,765 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 5.19s
2025-11-30 21:42:56,765 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 21:42:56,765 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 81
- Total Relationships: 62
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Experimenter", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0"]}, {"head": "Experimenter", "relation": "Holds", "tail": "White Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0"]}, {"head": "White Bottle", "relation": "Contains", "tail": "White Solid Substance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0"]}, {"head": "Beaker", "relation": "Is Placed In", "tail": "Precision Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0"]}, {"head": "Precision Balance", "relation": "Displays", "tail": "56.303 G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0"]}, {"head": "Experimenter", "relation": "Presses", "tail": "Button On Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0"]}, {"head": "Experimenter", "relation": "Holds", "tail": "Reagent Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1"]}, {"head": "Reagent Bottle", "relation": "Has Label", "tail": "General Reagent", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1"]}, {"head": "Reagent Bottle", "relation": "Has Hazard Symbols", "tail": "Chemical Hazard", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Balance Scale", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1"]}, {"head": "Experimenter", "relation": "Prepares To Add", "tail": "Chemical", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1"]}, {"head": "Person", "relation": "Observes", "tail": "Experiment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_2"]}, {"head": "Person", "relation": "Opens", "tail": "Glass_Enclosure", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_2"]}, {"head": "Person", "relation": "Uses", "tail": "Metal_Spatula", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:42:56,766 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~260 words, ~338 tokens)
2025-11-30 21:42:56,766 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:43:08,451 - src.components.global_refiner - DEBUG - LLM call completed in 11.68s
2025-11-30 21:43:08,451 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Experimenter', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0']], ['Experimenter', 'holds', 'White_Bottle', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0']], ['White_Bottle', 'contains', 'White_Solid_Substance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0']], ['Beaker', 'is_placed_in', 'Precision_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0']], ['Precision_Balance', 'displays', '56.303_G', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0']], ['Experimenter', 'presses', 'Button_On_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0']], ['Experimenter', 'holds', 'Reagent_Bottle', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1']], ['Reagent_Bottle', 'has_label', 'General_Reagent', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1']], ['Reagent_Bottle', 'has_hazard_symbols', 'Chemical_Hazard', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1']], ['Beaker', 'is_on', 'Balance_Scale', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1']]]
2025-11-30 21:43:08,451 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Experimenter",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0"
    ]
  ],
  [
    "Experimenter",
    "holds",
    "White_Bottle",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0"
    ]
  ],
  [
    "White_Bottle",
    "contains",
    "White_Solid_Substance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0"
    ]
  ],
  [
    "Beaker",
    "is_placed_in",
    "Precision_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0"
    ]
  ],
  [
    "Precision_Balance",
    "displays",
    "56.303_G",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0"
    ]
  ],
  [
    "Experimenter",
    "presses",
    "Button_On_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_0"
    ]
  ],
  [
    "Experimenter",
    "holds",
    "Reagent_Bottle",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1"
    ]
  ],
  [
    "Reagent_Bottle",
    "has_label",
    "General_Reagent",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1"
    ]
  ],
  [
    "Reagent_Bottle",
    "has_hazard_symbols",
    "Chemical_Hazard",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Balance_Scale",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_6_1"
    ]
  ]
]
2025-11-30 21:43:08,451 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.69s, LLM: 11.68s)
2025-11-30 21:43:08,451 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.69s
2025-11-30 21:43:08,451 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:43:08,451 - src.pipeline.kg_builder - INFO - Pushing batch 7/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:43:08,451 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:43:08,601 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:43:08,601 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:43:08,602 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:43:08,602 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.15s, indexes: 0.01s)
2025-11-30 21:43:08,603 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 32, 'with_embedding': 0, 'linked_chunks': 19}
2025-11-30 21:43:08,603 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:43:08,609 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 94 nodes
2025-11-30 21:43:08,615 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 81 nodes
2025-11-30 21:43:08,626 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 94, 'relationship_count': 180, 'density': 0.0206, 'avg_degree': 3.8298, 'avg_unique_neighbors': 3.8085, 'global_efficiency': 0.295, 'avg_path_length': 2.8756, 'avg_degree_centrality': 0.0412, 'max_degree_centrality': 0.4301, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0067, 'degree_assortativity': -0.3147, 'graph_robustness': 0.85, 'diameter_estimate': 5, 'clustering_coefficient': 0.2899, 'weakly_connected_components': 14, 'largest_wcc_size': 81, 'pagerank_top10_percent': 32.26, 'louvain_communities': 21, 'louvain_modularity': 0.5379, 'label_entropy': 1.4626, 'computational_time': 0.022936654975637794}
2025-11-30 21:43:08,626 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 6, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510188.6266534, 'total_time': 17.058299166033976, 'aggregation': 2.210959792137146e-06, 'network_info': 0.00795784208457917, 'llm_extraction': 16.875143330078572, 'data_cleaning': 2.7145957574248314e-05, 'neo4j_injection': 0.15061459701973945, 'embedding_time': 0, 'indexing_time': 0.005248222965747118, 'graph_injection_time': 0.14509242796339095, 'acs_metrics': {'node_count': 94, 'relationship_count': 180, 'density': 0.0206, 'avg_degree': 3.8298, 'avg_unique_neighbors': 3.8085, 'global_efficiency': 0.295, 'avg_path_length': 2.8756, 'avg_degree_centrality': 0.0412, 'max_degree_centrality': 0.4301, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0067, 'degree_assortativity': -0.3147, 'graph_robustness': 0.85, 'diameter_estimate': 5, 'clustering_coefficient': 0.2899, 'weakly_connected_components': 14, 'largest_wcc_size': 81, 'pagerank_top10_percent': 32.26, 'louvain_communities': 21, 'louvain_modularity': 0.5379, 'label_entropy': 1.4626, 'computational_time': 0.022936654975637794}, 'retrieval_queries': []}
2025-11-30 21:43:08,626 - src.pipeline.kg_builder - DEBUG - Batch 6 metrics: {
  "batch_idx": 6,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510188.6266534,
  "total_time": 17.058299166033976,
  "aggregation": 2.210959792137146e-06,
  "network_info": 0.00795784208457917,
  "llm_extraction": 16.875143330078572,
  "data_cleaning": 2.7145957574248314e-05,
  "neo4j_injection": 0.15061459701973945,
  "embedding_time": 0,
  "indexing_time": 0.005248222965747118,
  "graph_injection_time": 0.14509242796339095,
  "acs_metrics": {
    "node_count": 94,
    "relationship_count": 180,
    "density": 0.0206,
    "avg_degree": 3.8298,
    "avg_unique_neighbors": 3.8085,
    "global_efficiency": 0.295,
    "avg_path_length": 2.8756,
    "avg_degree_centrality": 0.0412,
    "max_degree_centrality": 0.4301,
    "avg_betweenness_centrality": 0.0002,
    "max_betweenness_centrality": 0.0067,
    "degree_assortativity": -0.3147,
    "graph_robustness": 0.85,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2899,
    "weakly_connected_components": 14,
    "largest_wcc_size": 81,
    "pagerank_top10_percent": 32.26,
    "louvain_communities": 21,
    "louvain_modularity": 0.5379,
    "label_entropy": 1.4626,
    "computational_time": 0.022936654975637794
  },
  "retrieval_queries": []
}
2025-11-30 21:43:08,627 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:43:08,627 - src.pipeline.kg_builder - INFO - Batch 7 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 16.88s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.02s
2025-11-30 21:43:08,627 - src.pipeline.kg_builder - INFO - Batch 7 completed in 17.06s
Processing KG batches:  10%|▉         | 7/72 [02:50<22:55, 21.16s/it]2025-11-30 21:43:08,627 - src.pipeline.kg_builder - INFO - Processing batch 8/72 (3 items)
2025-11-30 21:43:08,627 - src.pipeline.kg_builder - DEBUG - Batch 8 current_video_time: 01:54-01:59
2025-11-30 21:43:08,635 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 94
- Total Relationships: 71
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:43:08,636 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:43:08,636 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0 ~236 words, content: Time: 01:44-01:49 Content: The video shows a person in a laboratory setting performing a precise measurement. The scene is viewed from a first-person perspective, focusing...
2025-11-30 21:43:08,636 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1 ~229 words, content: from air currents. The person uses a small metal spatula to scoop the powder from a white container with a red lid. The powder is...
2025-11-30 21:43:08,636 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_2 ~91 words, content: , indicating a need for accuracy. - **Environment:** The scene is a laboratory, identifiable by the workbench, cabinets, and a fire extinguisher visible in the...
2025-11-30 21:43:08,636 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:43:08,636 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0) (~236 words) with timeout=5.0s retries=3
2025-11-30 21:43:10,121 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:43:10,121 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:43:10,122 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:43:11,401 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:43:11,401 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:43:11,402 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_2) (~91 words) with timeout=5.0s retries=3
2025-11-30 21:43:12,498 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:43:12,498 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:43:12,498 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 3 chunks
2025-11-30 21:43:12,499 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 3.86s
2025-11-30 21:43:12,499 - src.components.global_refiner - INFO - Capping refinement input: 17 → 15 triplets
2025-11-30 21:43:12,499 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 94
- Total Relationships: 71
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1"]}, {"head": "Person", "relation": "Holds", "tail": "White_Plastic_Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0"]}, {"head": "Person", "relation": "Uses", "tail": "Metal_Spatula", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0"]}, {"head": "Glass_Beaker", "relation": "Is On", "tail": "Balance_Scale", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0"]}, {"head": "Balance_Scale", "relation": "Is Inside", "tail": "Glass_Draft_Shield", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0"]}, {"head": "Person", "relation": "Holds", "tail": "Metal_Spatula", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1"]}, {"head": "Person", "relation": "Holds", "tail": "White_Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1"]}, {"head": "White_Container", "relation": "Contains", "tail": "Powder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1"]}, {"head": "Powder", "relation": "Is Transferred To", "tail": "Glass_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1"]}, {"head": "Glass_Beaker", "relation": "Is On", "tail": "Precision_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Workbench", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Cabinets", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Fire Extinguisher", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:43:12,499 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~242 words, ~315 tokens)
2025-11-30 21:43:12,499 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:43:24,579 - src.components.global_refiner - DEBUG - LLM call completed in 12.08s
2025-11-30 21:43:24,579 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1']], ['Person', 'holds', 'White_Plastic_Bottle', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0']], ['Person', 'uses', 'Metal_Spatula', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0']], ['Person', 'holds', 'Glass_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0']], ['Glass_Beaker', 'is_on', 'Balance_Scale', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0']], ['Balance_Scale', 'is_inside', 'Glass_Draft_Shield', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0']], ['Person', 'holds', 'Metal_Spatula', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1']], ['Person', 'holds', 'White_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1']], ['White_Container', 'contains', 'Powder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1']], ['Powder', 'is_transferred_to', 'Glass_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1']]]
2025-11-30 21:43:24,579 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1"
    ]
  ],
  [
    "Person",
    "holds",
    "White_Plastic_Bottle",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Metal_Spatula",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0"
    ]
  ],
  [
    "Glass_Beaker",
    "is_on",
    "Balance_Scale",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0"
    ]
  ],
  [
    "Balance_Scale",
    "is_inside",
    "Glass_Draft_Shield",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Metal_Spatula",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1"
    ]
  ],
  [
    "Person",
    "holds",
    "White_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1"
    ]
  ],
  [
    "White_Container",
    "contains",
    "Powder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1"
    ]
  ],
  [
    "Powder",
    "is_transferred_to",
    "Glass_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_7_1"
    ]
  ]
]
2025-11-30 21:43:24,579 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 12.08s, LLM: 12.08s)
2025-11-30 21:43:24,579 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 12.08s
2025-11-30 21:43:24,579 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:43:24,579 - src.pipeline.kg_builder - INFO - Pushing batch 8/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:43:24,580 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:43:24,719 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:43:24,719 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:43:24,720 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:43:24,720 - src.components.neo4j_handler - INFO - Batch injected in 0.14s (triplets: 0.14s, indexes: 0.01s)
2025-11-30 21:43:24,722 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 35, 'with_embedding': 0, 'linked_chunks': 21}
2025-11-30 21:43:24,722 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:43:24,728 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 103 nodes
2025-11-30 21:43:24,735 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 89 nodes
2025-11-30 21:43:24,748 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 103, 'relationship_count': 201, 'density': 0.0191, 'avg_degree': 3.9029, 'avg_unique_neighbors': 3.8835, 'global_efficiency': 0.2983, 'avg_path_length': 2.8389, 'avg_degree_centrality': 0.0383, 'max_degree_centrality': 0.451, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0067, 'degree_assortativity': -0.319, 'graph_robustness': 0.8557, 'diameter_estimate': 5, 'clustering_coefficient': 0.2885, 'weakly_connected_components': 15, 'largest_wcc_size': 89, 'pagerank_top10_percent': 29.39, 'louvain_communities': 22, 'louvain_modularity': 0.5443, 'label_entropy': 1.4623, 'computational_time': 0.026534135919064283}
2025-11-30 21:43:24,749 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 7, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510204.7490153, 'total_time': 16.121825644979253, 'aggregation': 2.4510081857442856e-06, 'network_info': 0.008647585986182094, 'llm_extraction': 15.943762666080147, 'data_cleaning': 2.6270980015397072e-05, 'neo4j_injection': 0.14064595801755786, 'embedding_time': 0, 'indexing_time': 0.00533138494938612, 'graph_injection_time': 0.13506334507837892, 'acs_metrics': {'node_count': 103, 'relationship_count': 201, 'density': 0.0191, 'avg_degree': 3.9029, 'avg_unique_neighbors': 3.8835, 'global_efficiency': 0.2983, 'avg_path_length': 2.8389, 'avg_degree_centrality': 0.0383, 'max_degree_centrality': 0.451, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0067, 'degree_assortativity': -0.319, 'graph_robustness': 0.8557, 'diameter_estimate': 5, 'clustering_coefficient': 0.2885, 'weakly_connected_components': 15, 'largest_wcc_size': 89, 'pagerank_top10_percent': 29.39, 'louvain_communities': 22, 'louvain_modularity': 0.5443, 'label_entropy': 1.4623, 'computational_time': 0.026534135919064283}, 'retrieval_queries': []}
2025-11-30 21:43:24,749 - src.pipeline.kg_builder - DEBUG - Batch 7 metrics: {
  "batch_idx": 7,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510204.7490153,
  "total_time": 16.121825644979253,
  "aggregation": 2.4510081857442856e-06,
  "network_info": 0.008647585986182094,
  "llm_extraction": 15.943762666080147,
  "data_cleaning": 2.6270980015397072e-05,
  "neo4j_injection": 0.14064595801755786,
  "embedding_time": 0,
  "indexing_time": 0.00533138494938612,
  "graph_injection_time": 0.13506334507837892,
  "acs_metrics": {
    "node_count": 103,
    "relationship_count": 201,
    "density": 0.0191,
    "avg_degree": 3.9029,
    "avg_unique_neighbors": 3.8835,
    "global_efficiency": 0.2983,
    "avg_path_length": 2.8389,
    "avg_degree_centrality": 0.0383,
    "max_degree_centrality": 0.451,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0067,
    "degree_assortativity": -0.319,
    "graph_robustness": 0.8557,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2885,
    "weakly_connected_components": 15,
    "largest_wcc_size": 89,
    "pagerank_top10_percent": 29.39,
    "louvain_communities": 22,
    "louvain_modularity": 0.5443,
    "label_entropy": 1.4623,
    "computational_time": 0.026534135919064283
  },
  "retrieval_queries": []
}
2025-11-30 21:43:24,749 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:43:24,749 - src.pipeline.kg_builder - INFO - Batch 8 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 15.94s, Clean: 0.00s, Neo4j: 0.14s, ACS: 0.03s
2025-11-30 21:43:24,749 - src.pipeline.kg_builder - INFO - Batch 8 completed in 16.12s
Processing KG batches:  11%|█         | 8/72 [03:06<20:51, 19.55s/it]2025-11-30 21:43:24,749 - src.pipeline.kg_builder - INFO - Processing batch 9/72 (3 items)
2025-11-30 21:43:24,749 - src.pipeline.kg_builder - DEBUG - Batch 9 current_video_time: 02:09-02:14
2025-11-30 21:43:24,759 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 103
- Total Relationships: 80
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:43:24,760 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:43:24,760 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0 ~222 words, content: Time: 01:59-02:04 Content: The video sequence captures a precise laboratory procedure, likely the weighing of a solid chemical. The scene is set in a laboratory...
2025-11-30 21:43:24,760 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1 ~222 words, content: **Final Steps:** After adding the desired amount of the substance, the person closes the glass draft shield. The video ends with the person having completed...
2025-11-30 21:43:24,760 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_2 ~209 words, content: spatula to carefully scoop the powder from the bottle and deposit it into the beaker. The digital display of the balance shows a reading of...
2025-11-30 21:43:24,760 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:43:24,760 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:43:26,256 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:43:26,256 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:43:26,256 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:43:27,222 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:43:27,223 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:43:27,223 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_2) (~209 words) with timeout=5.0s retries=3
2025-11-30 21:43:28,536 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:43:28,536 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:43:28,536 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 3 chunks
2025-11-30 21:43:28,536 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 3.78s
2025-11-30 21:43:28,537 - src.components.global_refiner - INFO - Capping refinement input: 17 → 15 triplets
2025-11-30 21:43:28,537 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 103
- Total Relationships: 80
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_2"]}, {"head": "Person", "relation": "Holds", "tail": "White_Plastic_Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0"]}, {"head": "Person", "relation": "Uses", "tail": "Metal_Spoon", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0"]}, {"head": "Person", "relation": "Adds", "tail": "White_Powder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0"]}, {"head": "White_Powder", "relation": "Is Transferred To", "tail": "Glass_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0"]}, {"head": "Glass_Beaker", "relation": "Is On", "tail": "Balance_Scale", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1"]}, {"head": "Person", "relation": "Uses", "tail": "Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1"]}, {"head": "Balance", "relation": "Contains", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1"]}, {"head": "Balance", "relation": "Contains", "tail": "Powder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1"]}, {"head": "Person", "relation": "Transfers", "tail": "Powder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Powder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1"]}, {"head": "Person", "relation": "Uses", "tail": "Spatula", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_2"]}, {"head": "Spatula", "relation": "Transfers", "tail": "Powder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_2"]}, {"head": "Powder", "relation": "Is Deposited In", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:43:28,537 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~243 words, ~316 tokens)
2025-11-30 21:43:28,537 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:43:40,211 - src.components.global_refiner - DEBUG - LLM call completed in 11.67s
2025-11-30 21:43:40,211 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1']], ['Person', 'holds', 'White_Plastic_Bottle', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0']], ['Person', 'uses', 'Metal_Spoon', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0']], ['Person', 'adds', 'White_Powder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0']], ['White_Powder', 'is_transferred_to', 'Glass_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0']], ['Glass_Beaker', 'is_on', 'Balance_Scale', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0']], ['Person', 'uses', 'Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1']], ['Balance', 'contains', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1']], ['Balance', 'contains', 'Powder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1']], ['Person', 'transfers', 'Powder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1']]]
2025-11-30 21:43:40,211 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1"
    ]
  ],
  [
    "Person",
    "holds",
    "White_Plastic_Bottle",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Metal_Spoon",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0"
    ]
  ],
  [
    "Person",
    "adds",
    "White_Powder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0"
    ]
  ],
  [
    "White_Powder",
    "is_transferred_to",
    "Glass_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0"
    ]
  ],
  [
    "Glass_Beaker",
    "is_on",
    "Balance_Scale",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1"
    ]
  ],
  [
    "Balance",
    "contains",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1"
    ]
  ],
  [
    "Balance",
    "contains",
    "Powder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1"
    ]
  ],
  [
    "Person",
    "transfers",
    "Powder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_8_1"
    ]
  ]
]
2025-11-30 21:43:40,211 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.67s, LLM: 11.67s)
2025-11-30 21:43:40,212 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.67s
2025-11-30 21:43:40,212 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:43:40,212 - src.pipeline.kg_builder - INFO - Pushing batch 9/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:43:40,212 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:43:40,320 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:43:40,320 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:43:40,321 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:43:40,321 - src.components.neo4j_handler - INFO - Batch injected in 0.11s (triplets: 0.11s, indexes: 0.00s)
2025-11-30 21:43:40,322 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 38, 'with_embedding': 0, 'linked_chunks': 23}
2025-11-30 21:43:40,322 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:43:40,329 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 109 nodes
2025-11-30 21:43:40,338 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 94 nodes
2025-11-30 21:43:40,353 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 109, 'relationship_count': 220, 'density': 0.0187, 'avg_degree': 4.0367, 'avg_unique_neighbors': 4.0183, 'global_efficiency': 0.3026, 'avg_path_length': 2.7769, 'avg_degree_centrality': 0.0374, 'max_degree_centrality': 0.4815, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0074, 'degree_assortativity': -0.3299, 'graph_robustness': 0.8636, 'diameter_estimate': 5, 'clustering_coefficient': 0.2894, 'weakly_connected_components': 16, 'largest_wcc_size': 94, 'pagerank_top10_percent': 27.68, 'louvain_communities': 23, 'louvain_modularity': 0.5223, 'label_entropy': 1.4664, 'computational_time': 0.031011420069262385}
2025-11-30 21:43:40,353 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 8, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510220.353469, 'total_time': 15.603906785021536, 'aggregation': 2.449960447847843e-06, 'network_info': 0.010073364013805985, 'llm_extraction': 15.45224039896857, 'data_cleaning': 1.2277043424546719e-05, 'neo4j_injection': 0.10915379808284342, 'embedding_time': 0, 'indexing_time': 0.003858497948385775, 'graph_injection_time': 0.10514020605478436, 'acs_metrics': {'node_count': 109, 'relationship_count': 220, 'density': 0.0187, 'avg_degree': 4.0367, 'avg_unique_neighbors': 4.0183, 'global_efficiency': 0.3026, 'avg_path_length': 2.7769, 'avg_degree_centrality': 0.0374, 'max_degree_centrality': 0.4815, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0074, 'degree_assortativity': -0.3299, 'graph_robustness': 0.8636, 'diameter_estimate': 5, 'clustering_coefficient': 0.2894, 'weakly_connected_components': 16, 'largest_wcc_size': 94, 'pagerank_top10_percent': 27.68, 'louvain_communities': 23, 'louvain_modularity': 0.5223, 'label_entropy': 1.4664, 'computational_time': 0.031011420069262385}, 'retrieval_queries': []}
2025-11-30 21:43:40,353 - src.pipeline.kg_builder - DEBUG - Batch 8 metrics: {
  "batch_idx": 8,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510220.353469,
  "total_time": 15.603906785021536,
  "aggregation": 2.449960447847843e-06,
  "network_info": 0.010073364013805985,
  "llm_extraction": 15.45224039896857,
  "data_cleaning": 1.2277043424546719e-05,
  "neo4j_injection": 0.10915379808284342,
  "embedding_time": 0,
  "indexing_time": 0.003858497948385775,
  "graph_injection_time": 0.10514020605478436,
  "acs_metrics": {
    "node_count": 109,
    "relationship_count": 220,
    "density": 0.0187,
    "avg_degree": 4.0367,
    "avg_unique_neighbors": 4.0183,
    "global_efficiency": 0.3026,
    "avg_path_length": 2.7769,
    "avg_degree_centrality": 0.0374,
    "max_degree_centrality": 0.4815,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0074,
    "degree_assortativity": -0.3299,
    "graph_robustness": 0.8636,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2894,
    "weakly_connected_components": 16,
    "largest_wcc_size": 94,
    "pagerank_top10_percent": 27.68,
    "louvain_communities": 23,
    "louvain_modularity": 0.5223,
    "label_entropy": 1.4664,
    "computational_time": 0.031011420069262385
  },
  "retrieval_queries": []
}
2025-11-30 21:43:40,353 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:43:40,353 - src.pipeline.kg_builder - INFO - Batch 9 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 15.45s, Clean: 0.00s, Neo4j: 0.11s, ACS: 0.03s
2025-11-30 21:43:40,353 - src.pipeline.kg_builder - INFO - Batch 9 completed in 15.60s
Processing KG batches:  12%|█▎        | 9/72 [03:21<19:14, 18.32s/it]2025-11-30 21:43:40,354 - src.pipeline.kg_builder - INFO - Processing batch 10/72 (3 items)
2025-11-30 21:43:40,354 - src.pipeline.kg_builder - DEBUG - Batch 10 current_video_time: 02:24-02:29
2025-11-30 21:43:40,363 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 109
- Total Relationships: 87
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:43:40,363 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:43:40,363 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0 ~203 words, content: Time: 02:14-02:19 Content: The video captures a precise laboratory procedure, likely the preparation of a chemical solution or a standard sample. The sequence of frames...
2025-11-30 21:43:40,363 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1 ~209 words, content: the white powder. The display shows `20.23`, indicating the final mass of the substance added to the beaker. - **Final Measurement (Frame 5):** The person...
2025-11-30 21:43:40,363 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_2 ~221 words, content: to carefully add a white, powdery substance into a glass beaker. The beaker is placed on a digital balance scale, a Mettler Toledo model, which...
2025-11-30 21:43:40,364 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_3 ~239 words, content: in the beaker after the addition. The person is in the process of completing the weighing step. In summary, the video documents the careful and...
2025-11-30 21:43:40,364 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_4 ~246 words, content: substance. The background shows a laboratory environment with various equipment and supplies, including a box labeled "Dell" and a yellow bag. In the second frame,...
2025-11-30 21:43:40,364 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_5 ~244 words, content: been measured. The person's right hand is placing the bottle on the table, while the left hand is holding the bottle. The beaker is still...
2025-11-30 21:43:40,364 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:43:40,364 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0) (~203 words) with timeout=5.0s retries=3
2025-11-30 21:43:41,867 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:43:41,868 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:43:41,868 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1) (~209 words) with timeout=5.0s retries=3
2025-11-30 21:43:43,118 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:43:43,119 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:43:43,119 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_2) (~221 words) with timeout=5.0s retries=3
2025-11-30 21:43:44,632 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:43:44,632 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:43:44,632 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_3) (~239 words) with timeout=5.0s retries=3
2025-11-30 21:43:46,076 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:43:46,076 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:43:46,076 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_4) (~246 words) with timeout=5.0s retries=3
2025-11-30 21:43:47,279 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:43:47,279 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:43:47,279 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_5) (~244 words) with timeout=5.0s retries=3
2025-11-30 21:43:48,460 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:43:48,460 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:43:48,460 - src.components.pre_llm_injector - INFO - Extracted 26 local triplets from 6 chunks
2025-11-30 21:43:48,460 - src.pipeline.kg_builder - INFO - Pre-extraction: 26 triplets in 8.10s
2025-11-30 21:43:48,461 - src.components.global_refiner - INFO - Capping refinement input: 26 → 15 triplets
2025-11-30 21:43:48,461 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 109
- Total Relationships: 87
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_3"]}, {"head": "Person", "relation": "Holds", "tail": "Metal_Spatula", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_2"]}, {"head": "Metal_Spatula", "relation": "Contains", "tail": "White_Powder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Analytical_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0"]}, {"head": "Analytical_Balance", "relation": "Displays", "tail": "Tare_Weight", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "White_Powder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0"]}, {"head": "Person", "relation": "Adds", "tail": "White Powder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1"]}, {"head": "Balance", "relation": "Displays", "tail": "80.14", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "White Powder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1"]}, {"head": "Person", "relation": "Holds", "tail": "Spatula", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_4"]}, {"head": "Balance", "relation": "Displays", "tail": "20.23", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_2"]}, {"head": "Person", "relation": "Holds", "tail": "White_Plastic_Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_3"]}, {"head": "White_Plastic_Bottle", "relation": "Contains", "tail": "White_Powder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:43:48,461 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~244 words, ~317 tokens)
2025-11-30 21:43:48,462 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:44:02,810 - src.components.global_refiner - DEBUG - LLM call completed in 14.35s
2025-11-30 21:44:02,810 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1']], ['Person', 'holds', 'Metal_Spatula', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_2']], ['Metal_Spatula', 'contains', 'White_Powder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0']], ['Beaker', 'is_on', 'Analytical_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0']], ['Analytical_Balance', 'displays', 'Tare_Weight', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0']], ['Beaker', 'contains', 'White_Powder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1']], ['Person', 'adds', 'White_Powder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1']], ['Balance', 'displays', '80.14', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1']], ['Balance', 'displays', '20.23', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1']], ['Person', 'holds', 'Spatula', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_4']]]
2025-11-30 21:44:02,810 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Metal_Spatula",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_2"
    ]
  ],
  [
    "Metal_Spatula",
    "contains",
    "White_Powder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Analytical_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0"
    ]
  ],
  [
    "Analytical_Balance",
    "displays",
    "Tare_Weight",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "White_Powder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1"
    ]
  ],
  [
    "Person",
    "adds",
    "White_Powder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1"
    ]
  ],
  [
    "Balance",
    "displays",
    "80.14",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1"
    ]
  ],
  [
    "Balance",
    "displays",
    "20.23",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Spatula",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_9_4"
    ]
  ]
]
2025-11-30 21:44:02,810 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 14.35s, LLM: 14.35s)
2025-11-30 21:44:02,811 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 14.35s
2025-11-30 21:44:02,811 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:44:02,811 - src.pipeline.kg_builder - INFO - Pushing batch 10/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:44:02,811 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:44:03,023 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:44:03,023 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:44:03,024 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:44:03,024 - src.components.neo4j_handler - INFO - Batch injected in 0.21s (triplets: 0.21s, indexes: 0.00s)
2025-11-30 21:44:03,024 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 44, 'with_embedding': 0, 'linked_chunks': 27}
2025-11-30 21:44:03,024 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:44:03,032 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 120 nodes
2025-11-30 21:44:03,043 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 103 nodes
2025-11-30 21:44:03,059 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 120, 'relationship_count': 246, 'density': 0.0172, 'avg_degree': 4.1, 'avg_unique_neighbors': 4.0833, 'global_efficiency': 0.2988, 'avg_path_length': 2.7714, 'avg_degree_centrality': 0.0345, 'max_degree_centrality': 0.479, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0086, 'degree_assortativity': -0.3069, 'graph_robustness': 0.8496, 'diameter_estimate': 5, 'clustering_coefficient': 0.287, 'weakly_connected_components': 18, 'largest_wcc_size': 103, 'pagerank_top10_percent': 25.39, 'louvain_communities': 26, 'louvain_modularity': 0.5126, 'label_entropy': 1.474, 'computational_time': 0.03483412798959762}
2025-11-30 21:44:03,059 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 9, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510243.059861, 'total_time': 22.70580323098693, 'aggregation': 3.832974471151829e-06, 'network_info': 0.009170906036160886, 'llm_extraction': 22.447706468985416, 'data_cleaning': 2.5484943762421608e-05, 'neo4j_injection': 0.2129338220693171, 'embedding_time': 0, 'indexing_time': 0.0041236389661207795, 'graph_injection_time': 0.20855981798376888, 'acs_metrics': {'node_count': 120, 'relationship_count': 246, 'density': 0.0172, 'avg_degree': 4.1, 'avg_unique_neighbors': 4.0833, 'global_efficiency': 0.2988, 'avg_path_length': 2.7714, 'avg_degree_centrality': 0.0345, 'max_degree_centrality': 0.479, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0086, 'degree_assortativity': -0.3069, 'graph_robustness': 0.8496, 'diameter_estimate': 5, 'clustering_coefficient': 0.287, 'weakly_connected_components': 18, 'largest_wcc_size': 103, 'pagerank_top10_percent': 25.39, 'louvain_communities': 26, 'louvain_modularity': 0.5126, 'label_entropy': 1.474, 'computational_time': 0.03483412798959762}, 'retrieval_queries': []}
2025-11-30 21:44:03,059 - src.pipeline.kg_builder - DEBUG - Batch 9 metrics: {
  "batch_idx": 9,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510243.059861,
  "total_time": 22.70580323098693,
  "aggregation": 3.832974471151829e-06,
  "network_info": 0.009170906036160886,
  "llm_extraction": 22.447706468985416,
  "data_cleaning": 2.5484943762421608e-05,
  "neo4j_injection": 0.2129338220693171,
  "embedding_time": 0,
  "indexing_time": 0.0041236389661207795,
  "graph_injection_time": 0.20855981798376888,
  "acs_metrics": {
    "node_count": 120,
    "relationship_count": 246,
    "density": 0.0172,
    "avg_degree": 4.1,
    "avg_unique_neighbors": 4.0833,
    "global_efficiency": 0.2988,
    "avg_path_length": 2.7714,
    "avg_degree_centrality": 0.0345,
    "max_degree_centrality": 0.479,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0086,
    "degree_assortativity": -0.3069,
    "graph_robustness": 0.8496,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.287,
    "weakly_connected_components": 18,
    "largest_wcc_size": 103,
    "pagerank_top10_percent": 25.39,
    "louvain_communities": 26,
    "louvain_modularity": 0.5126,
    "label_entropy": 1.474,
    "computational_time": 0.03483412798959762
  },
  "retrieval_queries": []
}
2025-11-30 21:44:03,060 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:44:03,060 - src.pipeline.kg_builder - INFO - Batch 10 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 22.45s, Clean: 0.00s, Neo4j: 0.21s, ACS: 0.03s
2025-11-30 21:44:03,060 - src.pipeline.kg_builder - INFO - Batch 10 completed in 22.71s
Processing KG batches:  14%|█▍        | 10/72 [03:44<20:19, 19.67s/it]2025-11-30 21:44:03,060 - src.pipeline.kg_builder - INFO - Processing batch 11/72 (3 items)
2025-11-30 21:44:03,060 - src.pipeline.kg_builder - DEBUG - Batch 11 current_video_time: 02:39-02:44
2025-11-30 21:44:03,067 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 120
- Total Relationships: 94
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:44:03,068 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:44:03,068 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0 ~235 words, content: Time: 02:29-02:34 Content: The video sequence captures a scientific procedure, likely a chemical experiment, being conducted in a laboratory setting. The process involves the precise...
2025-11-30 21:44:03,068 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1 ~229 words, content: a reading of "80.15 g". A hand wearing a blue glove is seen opening the glass door of the balance's draft shield. The beaker with...
2025-11-30 21:44:03,068 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_2 ~220 words, content: Time: 02:34-02:39 Content: The video sequence captures a scientific procedure, likely a titration or a similar chemical analysis, being performed in a laboratory setting. The...
2025-11-30 21:44:03,068 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_3 ~228 words, content: background reveals more of the laboratory, including a white door, a wall-mounted electrical panel with a high-voltage warning symbol, and a shelf with various items....
2025-11-30 21:44:03,068 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_4 ~225 words, content: conducted with precision, using an analytical balance to ensure accurate measurements. Time: 02:39-02:44 Content: The video captures a sequence of a laboratory procedure, likely a...
2025-11-30 21:44:03,068 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_5 ~114 words, content: has been added. The final reading on the balance is shown to be -56.30, which is a stable reading, indicating that the addition is complete....
2025-11-30 21:44:03,068 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:44:03,068 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0) (~235 words) with timeout=5.0s retries=3
2025-11-30 21:44:04,697 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:44:04,697 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:44:04,698 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:44:05,786 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:44:05,786 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:44:05,786 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_2) (~220 words) with timeout=5.0s retries=3
2025-11-30 21:44:07,339 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:44:07,339 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:44:07,340 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_3) (~228 words) with timeout=5.0s retries=3
2025-11-30 21:44:08,453 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:44:08,453 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:44:08,454 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_4) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:44:09,670 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:44:09,670 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:44:09,671 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_5) (~114 words) with timeout=5.0s retries=3
2025-11-30 21:44:10,828 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:44:10,828 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:44:10,829 - src.components.pre_llm_injector - INFO - Extracted 33 local triplets from 6 chunks
2025-11-30 21:44:10,829 - src.pipeline.kg_builder - INFO - Pre-extraction: 33 triplets in 7.76s
2025-11-30 21:44:10,830 - src.components.global_refiner - INFO - Capping refinement input: 33 → 15 triplets
2025-11-30 21:44:10,830 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 120
- Total Relationships: 94
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0"]}, {"head": "Person", "relation": "Holds", "tail": "White_Plastic_Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0"]}, {"head": "White_Plastic_Bottle", "relation": "Has", "tail": "Red_Cap", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0"]}, {"head": "White_Plastic_Bottle", "relation": "Contains", "tail": "Chemical_Substance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0"]}, {"head": "White_Plastic_Bottle", "relation": "Is On", "tail": "Laboratory_Bench", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "80.15_G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0"]}, {"head": "Hand", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1"]}, {"head": "Hand", "relation": "Opens", "tail": "Draft Shield", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Weighing Pan", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1"]}, {"head": "Hand", "relation": "Points To", "tail": "Display", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1"]}, {"head": "Hand", "relation": "Lifts", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "White Powder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_2"]}, {"head": "Glass_Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:44:10,830 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~242 words, ~315 tokens)
2025-11-30 21:44:10,830 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:44:22,370 - src.components.global_refiner - DEBUG - LLM call completed in 11.54s
2025-11-30 21:44:22,371 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Glove', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0']], ['Person', 'holds', 'White_Plastic_Bottle', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0']], ['White_Plastic_Bottle', 'has', 'Red_Cap', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0']], ['White_Plastic_Bottle', 'contains', 'Chemical_Substance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0']], ['White_Plastic_Bottle', 'is_on', 'Laboratory_Bench', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0']], ['Digital_Balance', 'displays', '80.15_G', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0']], ['Hand', 'wears', 'Blue_Glove', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1']], ['Hand', 'opens', 'Draft_Shield', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1']], ['Beaker', 'is_on', 'Weighing_Pan', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1']], ['Hand', 'points_to', 'Display', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1']]]
2025-11-30 21:44:22,371 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Glove",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0"
    ]
  ],
  [
    "Person",
    "holds",
    "White_Plastic_Bottle",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0"
    ]
  ],
  [
    "White_Plastic_Bottle",
    "has",
    "Red_Cap",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0"
    ]
  ],
  [
    "White_Plastic_Bottle",
    "contains",
    "Chemical_Substance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0"
    ]
  ],
  [
    "White_Plastic_Bottle",
    "is_on",
    "Laboratory_Bench",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "80.15_G",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_0"
    ]
  ],
  [
    "Hand",
    "wears",
    "Blue_Glove",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1"
    ]
  ],
  [
    "Hand",
    "opens",
    "Draft_Shield",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Weighing_Pan",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1"
    ]
  ],
  [
    "Hand",
    "points_to",
    "Display",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_10_1"
    ]
  ]
]
2025-11-30 21:44:22,371 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.54s, LLM: 11.54s)
2025-11-30 21:44:22,371 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.54s
2025-11-30 21:44:22,371 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:44:22,371 - src.pipeline.kg_builder - INFO - Pushing batch 11/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:44:22,371 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:44:22,505 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:44:22,506 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:44:22,506 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:44:22,506 - src.components.neo4j_handler - INFO - Batch injected in 0.13s (triplets: 0.13s, indexes: 0.00s)
2025-11-30 21:44:22,507 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 50, 'with_embedding': 0, 'linked_chunks': 29}
2025-11-30 21:44:22,507 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:44:22,515 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 136 nodes
2025-11-30 21:44:22,527 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 115 nodes
2025-11-30 21:44:22,547 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 136, 'relationship_count': 268, 'density': 0.0146, 'avg_degree': 3.9412, 'avg_unique_neighbors': 3.9265, 'global_efficiency': 0.277, 'avg_path_length': 2.9098, 'avg_degree_centrality': 0.0292, 'max_degree_centrality': 0.4296, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0103, 'degree_assortativity': -0.2825, 'graph_robustness': 0.8209, 'diameter_estimate': 5, 'clustering_coefficient': 0.2878, 'weakly_connected_components': 22, 'largest_wcc_size': 115, 'pagerank_top10_percent': 23.86, 'louvain_communities': 31, 'louvain_modularity': 0.5354, 'label_entropy': 1.4744, 'computational_time': 0.040369970025494695}
2025-11-30 21:44:22,547 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 10, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510262.547553, 'total_time': 19.487123352941126, 'aggregation': 2.930988557636738e-06, 'network_info': 0.007002996979281306, 'llm_extraction': 19.303733150009066, 'data_cleaning': 1.4455989003181458e-05, 'neo4j_injection': 0.1348791680065915, 'embedding_time': 0, 'indexing_time': 0.0032614859519526362, 'graph_injection_time': 0.13145192491356283, 'acs_metrics': {'node_count': 136, 'relationship_count': 268, 'density': 0.0146, 'avg_degree': 3.9412, 'avg_unique_neighbors': 3.9265, 'global_efficiency': 0.277, 'avg_path_length': 2.9098, 'avg_degree_centrality': 0.0292, 'max_degree_centrality': 0.4296, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0103, 'degree_assortativity': -0.2825, 'graph_robustness': 0.8209, 'diameter_estimate': 5, 'clustering_coefficient': 0.2878, 'weakly_connected_components': 22, 'largest_wcc_size': 115, 'pagerank_top10_percent': 23.86, 'louvain_communities': 31, 'louvain_modularity': 0.5354, 'label_entropy': 1.4744, 'computational_time': 0.040369970025494695}, 'retrieval_queries': []}
2025-11-30 21:44:22,547 - src.pipeline.kg_builder - DEBUG - Batch 10 metrics: {
  "batch_idx": 10,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510262.547553,
  "total_time": 19.487123352941126,
  "aggregation": 2.930988557636738e-06,
  "network_info": 0.007002996979281306,
  "llm_extraction": 19.303733150009066,
  "data_cleaning": 1.4455989003181458e-05,
  "neo4j_injection": 0.1348791680065915,
  "embedding_time": 0,
  "indexing_time": 0.0032614859519526362,
  "graph_injection_time": 0.13145192491356283,
  "acs_metrics": {
    "node_count": 136,
    "relationship_count": 268,
    "density": 0.0146,
    "avg_degree": 3.9412,
    "avg_unique_neighbors": 3.9265,
    "global_efficiency": 0.277,
    "avg_path_length": 2.9098,
    "avg_degree_centrality": 0.0292,
    "max_degree_centrality": 0.4296,
    "avg_betweenness_centrality": 0.0002,
    "max_betweenness_centrality": 0.0103,
    "degree_assortativity": -0.2825,
    "graph_robustness": 0.8209,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2878,
    "weakly_connected_components": 22,
    "largest_wcc_size": 115,
    "pagerank_top10_percent": 23.86,
    "louvain_communities": 31,
    "louvain_modularity": 0.5354,
    "label_entropy": 1.4744,
    "computational_time": 0.040369970025494695
  },
  "retrieval_queries": []
}
2025-11-30 21:44:22,548 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:44:22,548 - src.pipeline.kg_builder - INFO - Batch 11 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.30s, Clean: 0.00s, Neo4j: 0.13s, ACS: 0.04s
2025-11-30 21:44:22,548 - src.pipeline.kg_builder - INFO - Batch 11 completed in 19.49s
Processing KG batches:  15%|█▌        | 11/72 [04:03<19:56, 19.62s/it]2025-11-30 21:44:22,548 - src.pipeline.kg_builder - INFO - Processing batch 12/72 (3 items)
2025-11-30 21:44:22,548 - src.pipeline.kg_builder - DEBUG - Batch 12 current_video_time: 02:54-02:59
2025-11-30 21:44:22,555 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 136
- Total Relationships: 102
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:44:22,555 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:44:22,555 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0 ~230 words, content: Time: 02:44-02:49 Content: The video captures a laboratory procedure, likely a titration or a similar quantitative analysis, from a first-person perspective. The scene is set...
2025-11-30 21:44:22,555 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1 ~224 words, content: and a document with Chinese text, likely a lab protocol or experiment instructions. The overall context suggests a controlled and precise scientific experiment is in...
2025-11-30 21:44:22,555 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_2 ~233 words, content: . The digital display of the balance shows a negative weight of `-56.304 g`, which is the result of the tare function. The person is...
2025-11-30 21:44:22,555 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_3 ~224 words, content: , and then adding a solid substance to the beaker to measure its weight. This is a common procedure in chemistry for preparing solutions or...
2025-11-30 21:44:22,555 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_4 ~125 words, content: into a small, clear glass container, which is likely a conical flask or a beaker used for titration. This action is performed with precision, suggesting...
2025-11-30 21:44:22,555 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:44:22,556 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0) (~230 words) with timeout=5.0s retries=3
2025-11-30 21:44:23,712 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:44:23,713 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:44:23,713 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:44:24,864 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:44:24,864 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:44:24,865 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_2) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:44:25,907 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:44:25,907 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:44:25,907 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_3) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:44:27,169 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:44:27,169 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:44:27,170 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_4) (~125 words) with timeout=5.0s retries=3
2025-11-30 21:44:28,493 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:44:28,493 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:44:28,493 - src.components.pre_llm_injector - INFO - Extracted 26 local triplets from 5 chunks
2025-11-30 21:44:28,493 - src.pipeline.kg_builder - INFO - Pre-extraction: 26 triplets in 5.94s
2025-11-30 21:44:28,494 - src.components.global_refiner - INFO - Capping refinement input: 26 → 15 triplets
2025-11-30 21:44:28,494 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 136
- Total Relationships: 102
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_3"]}, {"head": "Person", "relation": "Adds", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0"]}, {"head": "Liquid", "relation": "Is Transferred By", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0"]}, {"head": "Beaker", "relation": "Is Placed On", "tail": "Digital Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_3"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0"]}, {"head": "Beaker", "relation": "Is Inside", "tail": "Draft Shield", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1"]}, {"head": "Person", "relation": "Uses", "tail": "Wash_Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_3"]}, {"head": "Beaker", "relation": "Is On", "tail": "Precision_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1"]}, {"head": "Precision_Balance", "relation": "Displays", "tail": "Negative_Weight", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1"]}, {"head": "Document", "relation": "Contains", "tail": "Chinese_Text", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_2"]}, {"head": "Balance", "relation": "Displays", "tail": "Negative_Weight", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_2"]}, {"head": "Person", "relation": "Adds", "tail": "Solid_Substance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:44:28,494 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~250 words, ~325 tokens)
2025-11-30 21:44:28,494 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:44:42,935 - src.components.global_refiner - DEBUG - LLM call completed in 14.44s
2025-11-30 21:44:42,935 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1']], ['Person', 'adds', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0']], ['Liquid', 'is_transferred_by', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0']], ['Beaker', 'is_placed_on', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_3']], ['Digital_Balance', 'measures', 'Mass', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0']], ['Beaker', 'is_inside', 'Draft_Shield', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0']], ['Person', 'uses', 'Wash_Bottle', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1']], ['Person', 'holds', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_3']], ['Beaker', 'is_on', 'Precision_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1']], ['Precision_Balance', 'displays', 'Negative_Weight', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1']]]
2025-11-30 21:44:42,936 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1"
    ]
  ],
  [
    "Person",
    "adds",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0"
    ]
  ],
  [
    "Liquid",
    "is_transferred_by",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0"
    ]
  ],
  [
    "Beaker",
    "is_placed_on",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_3"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Mass",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0"
    ]
  ],
  [
    "Beaker",
    "is_inside",
    "Draft_Shield",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Wash_Bottle",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_3"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Precision_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1"
    ]
  ],
  [
    "Precision_Balance",
    "displays",
    "Negative_Weight",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_11_1"
    ]
  ]
]
2025-11-30 21:44:42,936 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 14.44s, LLM: 14.44s)
2025-11-30 21:44:42,936 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 14.44s
2025-11-30 21:44:42,936 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:44:42,936 - src.pipeline.kg_builder - INFO - Pushing batch 12/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:44:42,936 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:44:43,061 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:44:43,062 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:44:43,062 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:44:43,062 - src.components.neo4j_handler - INFO - Batch injected in 0.13s (triplets: 0.12s, indexes: 0.00s)
2025-11-30 21:44:43,063 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 55, 'with_embedding': 0, 'linked_chunks': 33}
2025-11-30 21:44:43,063 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:44:43,072 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 144 nodes
2025-11-30 21:44:43,086 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 122 nodes
2025-11-30 21:44:43,106 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 144, 'relationship_count': 293, 'density': 0.0142, 'avg_degree': 4.0694, 'avg_unique_neighbors': 4.0417, 'global_efficiency': 0.2821, 'avg_path_length': 2.8515, 'avg_degree_centrality': 0.0285, 'max_degree_centrality': 0.4406, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0165, 'degree_assortativity': -0.2738, 'graph_robustness': 0.8055, 'diameter_estimate': 5, 'clustering_coefficient': 0.2857, 'weakly_connected_components': 23, 'largest_wcc_size': 122, 'pagerank_top10_percent': 22.12, 'louvain_communities': 31, 'louvain_modularity': 0.5277, 'label_entropy': 1.4797, 'computational_time': 0.043425236945040524}
2025-11-30 21:44:43,106 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 11, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510283.106959, 'total_time': 20.558798850979656, 'aggregation': 2.9529910534620285e-06, 'network_info': 0.007013133028522134, 'llm_extraction': 20.38085780304391, 'data_cleaning': 1.3886019587516785e-05, 'neo4j_injection': 0.12626617692876607, 'embedding_time': 0, 'indexing_time': 0.00372635992243886, 'graph_injection_time': 0.12236059096176177, 'acs_metrics': {'node_count': 144, 'relationship_count': 293, 'density': 0.0142, 'avg_degree': 4.0694, 'avg_unique_neighbors': 4.0417, 'global_efficiency': 0.2821, 'avg_path_length': 2.8515, 'avg_degree_centrality': 0.0285, 'max_degree_centrality': 0.4406, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0165, 'degree_assortativity': -0.2738, 'graph_robustness': 0.8055, 'diameter_estimate': 5, 'clustering_coefficient': 0.2857, 'weakly_connected_components': 23, 'largest_wcc_size': 122, 'pagerank_top10_percent': 22.12, 'louvain_communities': 31, 'louvain_modularity': 0.5277, 'label_entropy': 1.4797, 'computational_time': 0.043425236945040524}, 'retrieval_queries': []}
2025-11-30 21:44:43,107 - src.pipeline.kg_builder - DEBUG - Batch 11 metrics: {
  "batch_idx": 11,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510283.106959,
  "total_time": 20.558798850979656,
  "aggregation": 2.9529910534620285e-06,
  "network_info": 0.007013133028522134,
  "llm_extraction": 20.38085780304391,
  "data_cleaning": 1.3886019587516785e-05,
  "neo4j_injection": 0.12626617692876607,
  "embedding_time": 0,
  "indexing_time": 0.00372635992243886,
  "graph_injection_time": 0.12236059096176177,
  "acs_metrics": {
    "node_count": 144,
    "relationship_count": 293,
    "density": 0.0142,
    "avg_degree": 4.0694,
    "avg_unique_neighbors": 4.0417,
    "global_efficiency": 0.2821,
    "avg_path_length": 2.8515,
    "avg_degree_centrality": 0.0285,
    "max_degree_centrality": 0.4406,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0165,
    "degree_assortativity": -0.2738,
    "graph_robustness": 0.8055,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2857,
    "weakly_connected_components": 23,
    "largest_wcc_size": 122,
    "pagerank_top10_percent": 22.12,
    "louvain_communities": 31,
    "louvain_modularity": 0.5277,
    "label_entropy": 1.4797,
    "computational_time": 0.043425236945040524
  },
  "retrieval_queries": []
}
2025-11-30 21:44:43,107 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:44:43,107 - src.pipeline.kg_builder - INFO - Batch 12 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 20.38s, Clean: 0.00s, Neo4j: 0.13s, ACS: 0.04s
2025-11-30 21:44:43,107 - src.pipeline.kg_builder - INFO - Batch 12 completed in 20.56s
Processing KG batches:  17%|█▋        | 12/72 [04:24<19:54, 19.90s/it]2025-11-30 21:44:43,107 - src.pipeline.kg_builder - INFO - Processing batch 13/72 (3 items)
2025-11-30 21:44:43,107 - src.pipeline.kg_builder - DEBUG - Batch 13 current_video_time: 03:09-03:14
2025-11-30 21:44:43,114 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 144
- Total Relationships: 111
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:44:43,114 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:44:43,114 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0 ~214 words, content: Time: 02:59-03:04 Content: The sequence of images captures a laboratory procedure, likely the preparation of a chemical solution, from a first-person perspective. The setting is...
2025-11-30 21:44:43,114 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1 ~236 words, content: of liquid to achieve a desired concentration. - **Final Setup:** The final frame shows the beaker, now containing the solid and the added liquid, being...
2025-11-30 21:44:43,114 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_2 ~215 words, content: notes. The background features a door, a cabinet, and a wall with a warning sign. The overall scene suggests a controlled and precise scientific procedure....
2025-11-30 21:44:43,114 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_3 ~153 words, content: step. The balance's display changes to a negative value (`-56.302 g`), which is a common feature on analytical balances to tare or zero the scale...
2025-11-30 21:44:43,114 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:44:43,114 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0) (~214 words) with timeout=5.0s retries=3
2025-11-30 21:44:44,463 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:44:44,463 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:44:44,463 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1) (~236 words) with timeout=5.0s retries=3
2025-11-30 21:44:45,491 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:44:45,491 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:44:45,492 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_2) (~215 words) with timeout=5.0s retries=3
2025-11-30 21:44:47,183 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:44:47,183 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:44:47,183 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_3) (~153 words) with timeout=5.0s retries=3
2025-11-30 21:44:50,582 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:44:50,582 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:44:50,583 - src.components.pre_llm_injector - INFO - Extracted 20 local triplets from 4 chunks
2025-11-30 21:44:50,583 - src.pipeline.kg_builder - INFO - Pre-extraction: 20 triplets in 7.47s
2025-11-30 21:44:50,583 - src.components.global_refiner - INFO - Capping refinement input: 20 → 15 triplets
2025-11-30 21:44:50,583 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 144
- Total Relationships: 111
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_2"]}, {"head": "Person", "relation": "Places", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "5.302_G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0"]}, {"head": "Person", "relation": "Adds", "tail": "White_Powder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Solid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1"]}, {"head": "Person", "relation": "Holds", "tail": "White_Plastic_Squeeze_Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_2"]}, {"head": "Glass_Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_2"]}, {"head": "Glass_Beaker", "relation": "Contains", "tail": "White_Cloudy_Substance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:44:50,583 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~242 words, ~315 tokens)
2025-11-30 21:44:50,583 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:45:04,846 - src.components.global_refiner - DEBUG - LLM call completed in 14.26s
2025-11-30 21:45:04,846 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_2']], ['Person', 'places', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0']], ['Beaker', 'is_on', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0']], ['Digital_Balance', 'displays', '5.302_G', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0']], ['Person', 'adds', 'White_Powder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1']], ['Person', 'holds', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1']], ['Beaker', 'contains', 'Solid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_3']], ['Beaker', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_3']], ['Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1']]]
2025-11-30 21:45:04,846 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_2"
    ]
  ],
  [
    "Person",
    "places",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "5.302_G",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0"
    ]
  ],
  [
    "Person",
    "adds",
    "White_Powder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Solid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_3"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_12_1"
    ]
  ]
]
2025-11-30 21:45:04,846 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 14.26s, LLM: 14.26s)
2025-11-30 21:45:04,846 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 14.26s
2025-11-30 21:45:04,846 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:45:04,846 - src.pipeline.kg_builder - INFO - Pushing batch 13/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:45:04,846 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:45:05,147 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:45:05,147 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:45:05,148 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:45:05,148 - src.components.neo4j_handler - INFO - Batch injected in 0.30s (triplets: 0.29s, indexes: 0.01s)
2025-11-30 21:45:05,153 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 59, 'with_embedding': 0, 'linked_chunks': 37}
2025-11-30 21:45:05,153 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:45:05,169 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 150 nodes
2025-11-30 21:45:05,189 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 128 nodes
2025-11-30 21:45:05,219 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 150, 'relationship_count': 312, 'density': 0.014, 'avg_degree': 4.16, 'avg_unique_neighbors': 4.1333, 'global_efficiency': 0.2867, 'avg_path_length': 2.8382, 'avg_degree_centrality': 0.0279, 'max_degree_centrality': 0.443, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0179, 'degree_assortativity': -0.2632, 'graph_robustness': 0.8109, 'diameter_estimate': 5, 'clustering_coefficient': 0.2891, 'weakly_connected_components': 23, 'largest_wcc_size': 128, 'pagerank_top10_percent': 21.36, 'louvain_communities': 31, 'louvain_modularity': 0.5262, 'label_entropy': 1.4835, 'computational_time': 0.06632091093342751}
2025-11-30 21:45:05,219 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 12, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510305.2198052, 'total_time': 22.11224664398469, 'aggregation': 2.037966623902321e-06, 'network_info': 0.006531199091114104, 'llm_extraction': 21.7324649610091, 'data_cleaning': 2.2680964320898056e-05, 'neo4j_injection': 0.3019479620270431, 'embedding_time': 0, 'indexing_time': 0.008335391990840435, 'graph_injection_time': 0.29330709599889815, 'acs_metrics': {'node_count': 150, 'relationship_count': 312, 'density': 0.014, 'avg_degree': 4.16, 'avg_unique_neighbors': 4.1333, 'global_efficiency': 0.2867, 'avg_path_length': 2.8382, 'avg_degree_centrality': 0.0279, 'max_degree_centrality': 0.443, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0179, 'degree_assortativity': -0.2632, 'graph_robustness': 0.8109, 'diameter_estimate': 5, 'clustering_coefficient': 0.2891, 'weakly_connected_components': 23, 'largest_wcc_size': 128, 'pagerank_top10_percent': 21.36, 'louvain_communities': 31, 'louvain_modularity': 0.5262, 'label_entropy': 1.4835, 'computational_time': 0.06632091093342751}, 'retrieval_queries': []}
2025-11-30 21:45:05,219 - src.pipeline.kg_builder - DEBUG - Batch 12 metrics: {
  "batch_idx": 12,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510305.2198052,
  "total_time": 22.11224664398469,
  "aggregation": 2.037966623902321e-06,
  "network_info": 0.006531199091114104,
  "llm_extraction": 21.7324649610091,
  "data_cleaning": 2.2680964320898056e-05,
  "neo4j_injection": 0.3019479620270431,
  "embedding_time": 0,
  "indexing_time": 0.008335391990840435,
  "graph_injection_time": 0.29330709599889815,
  "acs_metrics": {
    "node_count": 150,
    "relationship_count": 312,
    "density": 0.014,
    "avg_degree": 4.16,
    "avg_unique_neighbors": 4.1333,
    "global_efficiency": 0.2867,
    "avg_path_length": 2.8382,
    "avg_degree_centrality": 0.0279,
    "max_degree_centrality": 0.443,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0179,
    "degree_assortativity": -0.2632,
    "graph_robustness": 0.8109,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2891,
    "weakly_connected_components": 23,
    "largest_wcc_size": 128,
    "pagerank_top10_percent": 21.36,
    "louvain_communities": 31,
    "louvain_modularity": 0.5262,
    "label_entropy": 1.4835,
    "computational_time": 0.06632091093342751
  },
  "retrieval_queries": []
}
2025-11-30 21:45:05,220 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:45:05,220 - src.pipeline.kg_builder - INFO - Batch 13 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 21.73s, Clean: 0.00s, Neo4j: 0.30s, ACS: 0.07s
2025-11-30 21:45:05,220 - src.pipeline.kg_builder - INFO - Batch 13 completed in 22.11s
Processing KG batches:  18%|█▊        | 13/72 [04:46<20:13, 20.57s/it]2025-11-30 21:45:05,220 - src.pipeline.kg_builder - INFO - Processing batch 14/72 (3 items)
2025-11-30 21:45:05,220 - src.pipeline.kg_builder - DEBUG - Batch 14 current_video_time: 03:24-03:29
2025-11-30 21:45:05,228 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 150
- Total Relationships: 115
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:45:05,229 - src.components.pre_llm_injector - DEBUG - Split content into 7 chunks (chunk_size=296, overlap=16)
2025-11-30 21:45:05,229 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0 ~211 words, content: Time: 03:14-03:19 Content: The video sequence captures a scientific procedure, likely a titration or a similar quantitative analysis, being performed in a laboratory setting. The...
2025-11-30 21:45:05,229 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1 ~236 words, content: or experiment instructions. - **Key Equipment:** The central focus is the analytical balance. The person's hands are positioned to place the beaker onto the balance's...
2025-11-30 21:45:05,229 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_2 ~248 words, content: fume hood. The primary activity involves the precise measurement and transfer of liquids, likely as part of a chemical synthesis or analysis process. In the...
2025-11-30 21:45:05,229 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_3 ~262 words, content: to a setup that includes a glass tube and a stand, which is used to hold the flask in place. The person is carefully handling...
2025-11-30 21:45:05,229 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_4 ~227 words, content: procedures involved in a laboratory setting. The use of protective gear, such as gloves, and the careful handling of equipment highlight the importance of safety...
2025-11-30 21:45:05,229 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_5 ~228 words, content: are using a pipette to transfer a liquid from the vial into the Erlenmeyer flask. The balance continues to display the negative weight, indicating the...
2025-11-30 21:45:05,229 - src.components.pre_llm_injector - DEBUG - Chunk[6] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_6 ~64 words, content: laboratory setting using a digital balance to precisely measure and add a substance to a flask. The negative weight on the balance indicates that the...
2025-11-30 21:45:05,229 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:45:05,229 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0) (~211 words) with timeout=5.0s retries=3
2025-11-30 21:45:06,629 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:45:06,629 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:45:06,629 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1) (~236 words) with timeout=5.0s retries=3
2025-11-30 21:45:07,760 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:45:07,760 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:45:07,760 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_2) (~248 words) with timeout=5.0s retries=3
2025-11-30 21:45:12,765 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 21:45:14,481 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 2)
2025-11-30 21:45:14,481 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:45:14,481 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_3) (~262 words) with timeout=5.0s retries=3
2025-11-30 21:45:15,578 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:45:15,578 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:45:15,578 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_4) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:45:16,824 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:45:16,824 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:45:16,824 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_5) (~228 words) with timeout=5.0s retries=3
2025-11-30 21:45:17,920 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:45:17,920 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:45:17,920 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 6 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_6) (~64 words) with timeout=5.0s retries=3
2025-11-30 21:45:19,077 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 6 (attempt 1)
2025-11-30 21:45:19,077 - src.components.pre_llm_injector - DEBUG - Chunk 6 returned 6 triplets
2025-11-30 21:45:19,077 - src.components.pre_llm_injector - INFO - Extracted 36 local triplets from 7 chunks
2025-11-30 21:45:19,077 - src.pipeline.kg_builder - INFO - Pre-extraction: 36 triplets in 13.85s
2025-11-30 21:45:19,078 - src.components.global_refiner - INFO - Capping refinement input: 36 → 15 triplets
2025-11-30 21:45:19,078 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 150
- Total Relationships: 115
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Precision_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0"]}, {"head": "Precision_Balance", "relation": "Displays", "tail": "Negative_Weight_Reading", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0"]}, {"head": "Laboratory_Bench", "relation": "Contains", "tail": "Equipment_And_Reagents", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0"]}, {"head": "Person", "relation": "Places", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1"]}, {"head": "Beaker", "relation": "Is Placed On", "tail": "Analytical Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1"]}, {"head": "Analytical Balance", "relation": "Has", "tail": "Glass Shield", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1"]}, {"head": "Person", "relation": "Uses", "tail": "Analytical Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1"]}, {"head": "Analytical Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_2"]}, {"head": "Person", "relation": "Uses", "tail": "Digital Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "-56.302 G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:45:19,078 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~251 words, ~326 tokens)
2025-11-30 21:45:19,078 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:45:33,715 - src.components.global_refiner - DEBUG - LLM call completed in 14.64s
2025-11-30 21:45:33,715 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_2']], ['Person', 'holds', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_2']], ['Beaker', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_2']], ['Beaker', 'is_on', 'Precision_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0']], ['Precision_Balance', 'displays', 'Negative_Weight_Reading', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0']], ['Laboratory_Bench', 'contains', 'Equipment_And_Reagents', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0']], ['Person', 'places', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1']], ['Beaker', 'is_placed_on', 'Analytical_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1']], ['Analytical_Balance', 'has', 'Glass_Shield', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1']], ['Person', 'uses', 'Analytical_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1']]]
2025-11-30 21:45:33,715 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_2"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Precision_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0"
    ]
  ],
  [
    "Precision_Balance",
    "displays",
    "Negative_Weight_Reading",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Equipment_And_Reagents",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_0"
    ]
  ],
  [
    "Person",
    "places",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1"
    ]
  ],
  [
    "Beaker",
    "is_placed_on",
    "Analytical_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1"
    ]
  ],
  [
    "Analytical_Balance",
    "has",
    "Glass_Shield",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Analytical_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_13_1"
    ]
  ]
]
2025-11-30 21:45:33,715 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 14.64s, LLM: 14.64s)
2025-11-30 21:45:33,715 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 14.64s
2025-11-30 21:45:33,716 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:45:33,716 - src.pipeline.kg_builder - INFO - Pushing batch 14/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:45:33,716 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:45:34,012 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:45:34,012 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:45:34,012 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:45:34,012 - src.components.neo4j_handler - INFO - Batch injected in 0.30s (triplets: 0.29s, indexes: 0.01s)
2025-11-30 21:45:34,014 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 66, 'with_embedding': 0, 'linked_chunks': 40}
2025-11-30 21:45:34,014 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:45:34,025 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 160 nodes
2025-11-30 21:45:34,041 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 134 nodes
2025-11-30 21:45:34,064 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 160, 'relationship_count': 332, 'density': 0.0131, 'avg_degree': 4.15, 'avg_unique_neighbors': 4.125, 'global_efficiency': 0.2769, 'avg_path_length': 2.8227, 'avg_degree_centrality': 0.0261, 'max_degree_centrality': 0.4403, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0085, 'degree_assortativity': -0.2505, 'graph_robustness': 0.8163, 'diameter_estimate': 5, 'clustering_coefficient': 0.2802, 'weakly_connected_components': 27, 'largest_wcc_size': 134, 'pagerank_top10_percent': 19.72, 'louvain_communities': 35, 'louvain_modularity': 0.5115, 'label_entropy': 1.4889, 'computational_time': 0.050795726012438536}
2025-11-30 21:45:34,065 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 13, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510334.065011, 'total_time': 28.8444008550141, 'aggregation': 4.110042937099934e-06, 'network_info': 0.007812791038304567, 'llm_extraction': 28.487348349997774, 'data_cleaning': 3.393890801817179e-05, 'neo4j_injection': 0.29681904695462435, 'embedding_time': 0, 'indexing_time': 0.007837712997570634, 'graph_injection_time': 0.2887149030575529, 'acs_metrics': {'node_count': 160, 'relationship_count': 332, 'density': 0.0131, 'avg_degree': 4.15, 'avg_unique_neighbors': 4.125, 'global_efficiency': 0.2769, 'avg_path_length': 2.8227, 'avg_degree_centrality': 0.0261, 'max_degree_centrality': 0.4403, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0085, 'degree_assortativity': -0.2505, 'graph_robustness': 0.8163, 'diameter_estimate': 5, 'clustering_coefficient': 0.2802, 'weakly_connected_components': 27, 'largest_wcc_size': 134, 'pagerank_top10_percent': 19.72, 'louvain_communities': 35, 'louvain_modularity': 0.5115, 'label_entropy': 1.4889, 'computational_time': 0.050795726012438536}, 'retrieval_queries': []}
2025-11-30 21:45:34,065 - src.pipeline.kg_builder - DEBUG - Batch 13 metrics: {
  "batch_idx": 13,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510334.065011,
  "total_time": 28.8444008550141,
  "aggregation": 4.110042937099934e-06,
  "network_info": 0.007812791038304567,
  "llm_extraction": 28.487348349997774,
  "data_cleaning": 3.393890801817179e-05,
  "neo4j_injection": 0.29681904695462435,
  "embedding_time": 0,
  "indexing_time": 0.007837712997570634,
  "graph_injection_time": 0.2887149030575529,
  "acs_metrics": {
    "node_count": 160,
    "relationship_count": 332,
    "density": 0.0131,
    "avg_degree": 4.15,
    "avg_unique_neighbors": 4.125,
    "global_efficiency": 0.2769,
    "avg_path_length": 2.8227,
    "avg_degree_centrality": 0.0261,
    "max_degree_centrality": 0.4403,
    "avg_betweenness_centrality": 0.0002,
    "max_betweenness_centrality": 0.0085,
    "degree_assortativity": -0.2505,
    "graph_robustness": 0.8163,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2802,
    "weakly_connected_components": 27,
    "largest_wcc_size": 134,
    "pagerank_top10_percent": 19.72,
    "louvain_communities": 35,
    "louvain_modularity": 0.5115,
    "label_entropy": 1.4889,
    "computational_time": 0.050795726012438536
  },
  "retrieval_queries": []
}
2025-11-30 21:45:34,065 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:45:34,065 - src.pipeline.kg_builder - INFO - Batch 14 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 28.49s, Clean: 0.00s, Neo4j: 0.30s, ACS: 0.05s
2025-11-30 21:45:34,065 - src.pipeline.kg_builder - INFO - Batch 14 completed in 28.84s
Processing KG batches:  19%|█▉        | 14/72 [05:15<22:18, 23.07s/it]2025-11-30 21:45:34,065 - src.pipeline.kg_builder - INFO - Processing batch 15/72 (3 items)
2025-11-30 21:45:34,065 - src.pipeline.kg_builder - DEBUG - Batch 15 current_video_time: 03:39-03:44
2025-11-30 21:45:34,072 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 160
- Total Relationships: 120
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:45:34,073 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:45:34,073 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0 ~211 words, content: Time: 03:29-03:34 Content: The sequence of images captures a detailed laboratory procedure, likely the preparation of a chemical solution. The perspective is first-person, showing the...
2025-11-30 21:45:34,073 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1 ~196 words, content: etric flask, possibly to add a reagent. In frame 5, the scientist is seen using a pipette to transfer a liquid from a beaker into...
2025-11-30 21:45:34,073 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_2 ~230 words, content: Content: The sequence of frames captures a detailed process in a laboratory setting, focusing on the precise measurement and transfer of a liquid. The scene...
2025-11-30 21:45:34,073 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_3 ~230 words, content: . Another person, dressed in a beige sweater and blue jeans, walks past in the background, indicating that the laboratory is active and not isolated....
2025-11-30 21:45:34,073 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_4 ~218 words, content: The reading on the balance fluctuates slightly, indicating the ongoing process of adding the liquid. - **Key Equipment and Environment:** - The person is wearing...
2025-11-30 21:45:34,073 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_5 ~33 words, content: , the pipette, and the balance highlights the importance of accuracy and precision in this scientific task. The entire sequence demonstrates a standard laboratory technique...
2025-11-30 21:45:34,073 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:45:34,073 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0) (~211 words) with timeout=5.0s retries=3
2025-11-30 21:45:35,405 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:45:35,405 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:45:35,406 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1) (~196 words) with timeout=5.0s retries=3
2025-11-30 21:45:36,519 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:45:36,519 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:45:36,520 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_2) (~230 words) with timeout=5.0s retries=3
2025-11-30 21:45:37,821 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:45:37,821 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:45:37,822 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_3) (~230 words) with timeout=5.0s retries=3
2025-11-30 21:45:38,922 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:45:38,922 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:45:38,923 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_4) (~218 words) with timeout=5.0s retries=3
2025-11-30 21:45:39,892 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:45:39,892 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:45:39,893 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_5) (~33 words) with timeout=5.0s retries=3
2025-11-30 21:45:41,321 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:45:41,321 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:45:41,321 - src.components.pre_llm_injector - INFO - Extracted 29 local triplets from 6 chunks
2025-11-30 21:45:41,321 - src.pipeline.kg_builder - INFO - Pre-extraction: 29 triplets in 7.25s
2025-11-30 21:45:41,322 - src.components.global_refiner - INFO - Capping refinement input: 29 → 15 triplets
2025-11-30 21:45:41,322 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 160
- Total Relationships: 120
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Scientist", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0"]}, {"head": "Scientist", "relation": "Holds", "tail": "Glass Vial", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0"]}, {"head": "Glass Vial", "relation": "Is Placed On", "tail": "Precision Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0"]}, {"head": "Scientist", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_3"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Volumetric Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0"]}, {"head": "Liquid", "relation": "Comes From", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1"]}, {"head": "Liquid", "relation": "Goes To", "tail": "Test Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1"]}, {"head": "Scientist", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_4"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_3", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_4"]}, {"head": "Liquid", "relation": "Is In", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_2"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_2"]}, {"head": "Person", "relation": "Walks Past", "tail": "Laboratory_Environment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:45:41,322 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~260 words, ~338 tokens)
2025-11-30 21:45:41,322 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:45:57,929 - src.components.global_refiner - DEBUG - LLM call completed in 16.61s
2025-11-30 21:45:57,930 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Scientist', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0']], ['Scientist', 'holds', 'Glass_Vial', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0']], ['Glass_Vial', 'is_placed_on', 'Precision_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0']], ['Scientist', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1']], ['Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_3']], ['Liquid', 'is_transferred_to', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0']], ['Liquid', 'comes_from', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1']], ['Liquid', 'goes_to', 'Test_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1']], ['Scientist', 'holds', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1']], ['Beaker', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_4']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_2']]]
2025-11-30 21:45:57,930 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Scientist",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0"
    ]
  ],
  [
    "Scientist",
    "holds",
    "Glass_Vial",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0"
    ]
  ],
  [
    "Glass_Vial",
    "is_placed_on",
    "Precision_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0"
    ]
  ],
  [
    "Scientist",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_3"
    ]
  ],
  [
    "Liquid",
    "is_transferred_to",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_0"
    ]
  ],
  [
    "Liquid",
    "comes_from",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1"
    ]
  ],
  [
    "Liquid",
    "goes_to",
    "Test_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1"
    ]
  ],
  [
    "Scientist",
    "holds",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_4"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_14_2"
    ]
  ]
]
2025-11-30 21:45:57,930 - src.components.global_refiner - INFO - Refinement complete: 15 → 11 triplets (total: 16.61s, LLM: 16.61s)
2025-11-30 21:45:57,930 - src.pipeline.kg_builder - INFO - Global refinement: 11 triplets in 16.61s
2025-11-30 21:45:57,930 - src.pipeline.kg_builder - INFO - Using 11 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:45:57,930 - src.pipeline.kg_builder - INFO - Pushing batch 15/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:45:57,930 - src.components.neo4j_handler - INFO - Adding 11 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:45:58,058 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:45:58,058 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:45:58,058 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:45:58,058 - src.components.neo4j_handler - INFO - Batch injected in 0.13s (triplets: 0.13s, indexes: 0.00s)
2025-11-30 21:45:58,059 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 72, 'with_embedding': 0, 'linked_chunks': 45}
2025-11-30 21:45:58,059 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:45:58,076 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 170 nodes
2025-11-30 21:45:58,101 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 143 nodes
2025-11-30 21:45:58,135 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 170, 'relationship_count': 360, 'density': 0.0125, 'avg_degree': 4.2353, 'avg_unique_neighbors': 4.2118, 'global_efficiency': 0.2763, 'avg_path_length': 2.8486, 'avg_degree_centrality': 0.0251, 'max_degree_centrality': 0.4201, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0151, 'degree_assortativity': -0.2359, 'graph_robustness': 0.8083, 'diameter_estimate': 5, 'clustering_coefficient': 0.2873, 'weakly_connected_components': 28, 'largest_wcc_size': 143, 'pagerank_top10_percent': 18.69, 'louvain_communities': 38, 'louvain_modularity': 0.5131, 'label_entropy': 1.4915, 'computational_time': 0.07571131794247776}
2025-11-30 21:45:58,135 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 14, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510358.1355298, 'total_time': 24.06987898296211, 'aggregation': 1.9799917936325073e-06, 'network_info': 0.006859089946374297, 'llm_extraction': 23.857589620980434, 'data_cleaning': 1.7552985809743404e-05, 'neo4j_injection': 0.12834452406968921, 'embedding_time': 0, 'indexing_time': 0.002268676063977182, 'graph_injection_time': 0.1258850550511852, 'acs_metrics': {'node_count': 170, 'relationship_count': 360, 'density': 0.0125, 'avg_degree': 4.2353, 'avg_unique_neighbors': 4.2118, 'global_efficiency': 0.2763, 'avg_path_length': 2.8486, 'avg_degree_centrality': 0.0251, 'max_degree_centrality': 0.4201, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0151, 'degree_assortativity': -0.2359, 'graph_robustness': 0.8083, 'diameter_estimate': 5, 'clustering_coefficient': 0.2873, 'weakly_connected_components': 28, 'largest_wcc_size': 143, 'pagerank_top10_percent': 18.69, 'louvain_communities': 38, 'louvain_modularity': 0.5131, 'label_entropy': 1.4915, 'computational_time': 0.07571131794247776}, 'retrieval_queries': []}
2025-11-30 21:45:58,135 - src.pipeline.kg_builder - DEBUG - Batch 14 metrics: {
  "batch_idx": 14,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510358.1355298,
  "total_time": 24.06987898296211,
  "aggregation": 1.9799917936325073e-06,
  "network_info": 0.006859089946374297,
  "llm_extraction": 23.857589620980434,
  "data_cleaning": 1.7552985809743404e-05,
  "neo4j_injection": 0.12834452406968921,
  "embedding_time": 0,
  "indexing_time": 0.002268676063977182,
  "graph_injection_time": 0.1258850550511852,
  "acs_metrics": {
    "node_count": 170,
    "relationship_count": 360,
    "density": 0.0125,
    "avg_degree": 4.2353,
    "avg_unique_neighbors": 4.2118,
    "global_efficiency": 0.2763,
    "avg_path_length": 2.8486,
    "avg_degree_centrality": 0.0251,
    "max_degree_centrality": 0.4201,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0151,
    "degree_assortativity": -0.2359,
    "graph_robustness": 0.8083,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2873,
    "weakly_connected_components": 28,
    "largest_wcc_size": 143,
    "pagerank_top10_percent": 18.69,
    "louvain_communities": 38,
    "louvain_modularity": 0.5131,
    "label_entropy": 1.4915,
    "computational_time": 0.07571131794247776
  },
  "retrieval_queries": []
}
2025-11-30 21:45:58,136 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:45:58,136 - src.pipeline.kg_builder - INFO - Batch 15 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 23.86s, Clean: 0.00s, Neo4j: 0.13s, ACS: 0.08s
2025-11-30 21:45:58,136 - src.pipeline.kg_builder - INFO - Batch 15 completed in 24.07s
Processing KG batches:  21%|██        | 15/72 [05:39<22:12, 23.37s/it]2025-11-30 21:45:58,136 - src.pipeline.kg_builder - INFO - Processing batch 16/72 (3 items)
2025-11-30 21:45:58,136 - src.pipeline.kg_builder - DEBUG - Batch 16 current_video_time: 03:54-03:59
2025-11-30 21:45:58,143 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 170
- Total Relationships: 128
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:45:58,144 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:45:58,144 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0 ~215 words, content: Time: 03:44-03:49 Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a precise liquid transfer. The person is using...
2025-11-30 21:45:58,144 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1 ~223 words, content: balance. The balance, a Mettler Toledo model, is actively being used to measure the mass of the liquid being transferred. The display on the balance...
2025-11-30 21:45:58,144 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_2 ~122 words, content: , which is resting on a digital balance. The digital balance, a Mettler Toledo model, is actively measuring the weight of the contents. The display...
2025-11-30 21:45:58,144 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:45:58,144 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0) (~215 words) with timeout=5.0s retries=3
2025-11-30 21:45:59,366 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:45:59,366 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:45:59,366 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1) (~223 words) with timeout=5.0s retries=3
2025-11-30 21:46:00,693 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:46:00,693 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:46:00,694 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_2) (~122 words) with timeout=5.0s retries=3
2025-11-30 21:46:02,064 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:46:02,064 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:46:02,064 - src.components.pre_llm_injector - INFO - Extracted 18 local triplets from 3 chunks
2025-11-30 21:46:02,064 - src.pipeline.kg_builder - INFO - Pre-extraction: 18 triplets in 3.92s
2025-11-30 21:46:02,064 - src.components.global_refiner - INFO - Capping refinement input: 18 → 15 triplets
2025-11-30 21:46:02,065 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 170
- Total Relationships: 128
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0"]}, {"head": "Liquid", "relation": "Is Added To", "tail": "Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Weight", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1"]}, {"head": "Glass Pipette", "relation": "Is Positioned Over", "tail": "Glass Volumetric Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1"]}, {"head": "Glass Volumetric Flask", "relation": "Rests On", "tail": "Digital Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "Negative Reading", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1"]}, {"head": "Flask", "relation": "Rests On", "tail": "Digital_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_2"]}, {"head": "Digital_Balance", "relation": "Measures", "tail": "Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_2"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Negative_Value", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:46:02,065 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~253 words, ~329 tokens)
2025-11-30 21:46:02,065 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:46:17,365 - src.components.global_refiner - DEBUG - LLM call completed in 15.30s
2025-11-30 21:46:17,366 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1']], ['Person', 'wears', 'Watch', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0']], ['Person', 'holds', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0']], ['Person', 'holds', 'Glass_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1']], ['Person', 'holds', 'Glass_Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1']], ['Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0']], ['Liquid', 'is_added_to', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0']], ['Glass_Pipette', 'is_positioned_over', 'Glass_Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1']], ['Glass_Volumetric_Flask', 'rests_on', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_2']], ['Digital_Balance', 'displays', 'Negative_Reading', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1']], ['Digital_Balance', 'measures', 'Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_2']], ['Digital_Balance', 'displays', 'Negative_Value', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_2']]]
2025-11-30 21:46:17,366 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0"
    ]
  ],
  [
    "Liquid",
    "is_added_to",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_0"
    ]
  ],
  [
    "Glass_Pipette",
    "is_positioned_over",
    "Glass_Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1"
    ]
  ],
  [
    "Glass_Volumetric_Flask",
    "rests_on",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Negative_Reading",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_1"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Negative_Value",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_15_2"
    ]
  ]
]
2025-11-30 21:46:17,366 - src.components.global_refiner - INFO - Refinement complete: 15 → 12 triplets (total: 15.30s, LLM: 15.30s)
2025-11-30 21:46:17,366 - src.pipeline.kg_builder - INFO - Global refinement: 12 triplets in 15.30s
2025-11-30 21:46:17,366 - src.pipeline.kg_builder - INFO - Using 12 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:46:17,366 - src.pipeline.kg_builder - INFO - Pushing batch 16/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:46:17,366 - src.components.neo4j_handler - INFO - Adding 12 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:46:17,550 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:46:17,550 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:46:17,550 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:46:17,550 - src.components.neo4j_handler - INFO - Batch injected in 0.18s (triplets: 0.18s, indexes: 0.01s)
2025-11-30 21:46:17,551 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 75, 'with_embedding': 0, 'linked_chunks': 48}
2025-11-30 21:46:17,551 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:46:17,564 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 179 nodes
2025-11-30 21:46:17,585 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 152 nodes
2025-11-30 21:46:17,614 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 179, 'relationship_count': 384, 'density': 0.0121, 'avg_degree': 4.2905, 'avg_unique_neighbors': 4.2682, 'global_efficiency': 0.2792, 'avg_path_length': 2.8727, 'avg_degree_centrality': 0.0241, 'max_degree_centrality': 0.4213, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0107, 'degree_assortativity': -0.2291, 'graph_robustness': 0.8125, 'diameter_estimate': 5, 'clustering_coefficient': 0.2898, 'weakly_connected_components': 28, 'largest_wcc_size': 152, 'pagerank_top10_percent': 17.68, 'louvain_communities': 37, 'louvain_modularity': 0.5183, 'label_entropy': 1.4905, 'computational_time': 0.06278725597076118}
2025-11-30 21:46:17,614 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 15, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510377.6148598, 'total_time': 19.478700481937267, 'aggregation': 1.9849976524710655e-06, 'network_info': 0.007713031023740768, 'llm_extraction': 19.22253189398907, 'data_cleaning': 2.7667032554745674e-05, 'neo4j_injection': 0.1841840649722144, 'embedding_time': 0, 'indexing_time': 0.006196424015797675, 'graph_injection_time': 0.17772985505871475, 'acs_metrics': {'node_count': 179, 'relationship_count': 384, 'density': 0.0121, 'avg_degree': 4.2905, 'avg_unique_neighbors': 4.2682, 'global_efficiency': 0.2792, 'avg_path_length': 2.8727, 'avg_degree_centrality': 0.0241, 'max_degree_centrality': 0.4213, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0107, 'degree_assortativity': -0.2291, 'graph_robustness': 0.8125, 'diameter_estimate': 5, 'clustering_coefficient': 0.2898, 'weakly_connected_components': 28, 'largest_wcc_size': 152, 'pagerank_top10_percent': 17.68, 'louvain_communities': 37, 'louvain_modularity': 0.5183, 'label_entropy': 1.4905, 'computational_time': 0.06278725597076118}, 'retrieval_queries': []}
2025-11-30 21:46:17,614 - src.pipeline.kg_builder - DEBUG - Batch 15 metrics: {
  "batch_idx": 15,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510377.6148598,
  "total_time": 19.478700481937267,
  "aggregation": 1.9849976524710655e-06,
  "network_info": 0.007713031023740768,
  "llm_extraction": 19.22253189398907,
  "data_cleaning": 2.7667032554745674e-05,
  "neo4j_injection": 0.1841840649722144,
  "embedding_time": 0,
  "indexing_time": 0.006196424015797675,
  "graph_injection_time": 0.17772985505871475,
  "acs_metrics": {
    "node_count": 179,
    "relationship_count": 384,
    "density": 0.0121,
    "avg_degree": 4.2905,
    "avg_unique_neighbors": 4.2682,
    "global_efficiency": 0.2792,
    "avg_path_length": 2.8727,
    "avg_degree_centrality": 0.0241,
    "max_degree_centrality": 0.4213,
    "avg_betweenness_centrality": 0.0002,
    "max_betweenness_centrality": 0.0107,
    "degree_assortativity": -0.2291,
    "graph_robustness": 0.8125,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2898,
    "weakly_connected_components": 28,
    "largest_wcc_size": 152,
    "pagerank_top10_percent": 17.68,
    "louvain_communities": 37,
    "louvain_modularity": 0.5183,
    "label_entropy": 1.4905,
    "computational_time": 0.06278725597076118
  },
  "retrieval_queries": []
}
2025-11-30 21:46:17,615 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:46:17,615 - src.pipeline.kg_builder - INFO - Batch 16 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.22s, Clean: 0.00s, Neo4j: 0.18s, ACS: 0.06s
2025-11-30 21:46:17,615 - src.pipeline.kg_builder - INFO - Batch 16 completed in 19.48s
Processing KG batches:  22%|██▏       | 16/72 [05:59<20:43, 22.20s/it]2025-11-30 21:46:17,615 - src.pipeline.kg_builder - INFO - Processing batch 17/72 (3 items)
2025-11-30 21:46:17,615 - src.pipeline.kg_builder - DEBUG - Batch 17 current_video_time: 04:09-04:14
2025-11-30 21:46:17,626 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 179
- Total Relationships: 137
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:46:17,626 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:46:17,626 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0 ~218 words, content: Time: 03:59-04:04 Content: In a laboratory setting, a person wearing blue nitrile gloves is performing a precise measurement. The scene is viewed from a first-person...
2025-11-30 21:46:17,626 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1 ~223 words, content: a first-person perspective, with the person's left arm, which has a watch with a black leather strap, visible in the foreground. The primary action involves...
2025-11-30 21:46:17,626 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2 ~222 words, content: person, whose arm and hand are visible, wearing blue nitrile gloves and a black watch. They are performing a quantitative transfer of a liquid using...
2025-11-30 21:46:17,626 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_3 ~56 words, content: the pipette is positioned directly above the flask's opening to ensure accurate transfer. The overall context suggests a methodical and precise scientific task, such as...
2025-11-30 21:46:17,626 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:46:17,626 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0) (~218 words) with timeout=5.0s retries=3
2025-11-30 21:46:19,111 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:46:19,111 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:46:19,111 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1) (~223 words) with timeout=5.0s retries=3
2025-11-30 21:46:20,311 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:46:20,311 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:46:20,311 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:46:21,376 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:46:21,376 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:46:21,376 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_3) (~56 words) with timeout=5.0s retries=3
2025-11-30 21:46:22,654 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:46:22,654 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:46:22,654 - src.components.pre_llm_injector - INFO - Extracted 21 local triplets from 4 chunks
2025-11-30 21:46:22,654 - src.pipeline.kg_builder - INFO - Pre-extraction: 21 triplets in 5.03s
2025-11-30 21:46:22,654 - src.components.global_refiner - INFO - Capping refinement input: 21 → 15 triplets
2025-11-30 21:46:22,655 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 179
- Total Relationships: 137
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0"]}, {"head": "Glass_Pipette", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0"]}, {"head": "Volumetric_Flask", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "-56.301_G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "Negative_Mass_Value", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1"]}, {"head": "Volumetric Flask", "relation": "Receives", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Volumetric Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:46:22,655 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~248 words, ~322 tokens)
2025-11-30 21:46:22,655 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:46:41,798 - src.components.global_refiner - DEBUG - LLM call completed in 19.14s
2025-11-30 21:46:41,798 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1']], ['Person', 'holds', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2']], ['Person', 'holds', 'Glass_Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0']], ['Person', 'holds', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2']], ['Glass_Pipette', 'transfers', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0']], ['Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2']], ['Beaker', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2']], ['Beaker', 'is_on', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1']], ['Volumetric_Flask', 'is_on', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0']], ['Digital_Balance', 'displays', '-56.301_G', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0']], ['Digital_Balance', 'displays', 'Negative_Mass_Value', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1']], ['Volumetric_Flask', 'receives', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1']], ['Liquid', 'is_transferred_to', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2']]]
2025-11-30 21:46:41,799 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2"
    ]
  ],
  [
    "Glass_Pipette",
    "transfers",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1"
    ]
  ],
  [
    "Volumetric_Flask",
    "is_on",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "-56.301_G",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Negative_Mass_Value",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1"
    ]
  ],
  [
    "Volumetric_Flask",
    "receives",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_1"
    ]
  ],
  [
    "Liquid",
    "is_transferred_to",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_16_2"
    ]
  ]
]
2025-11-30 21:46:41,799 - src.components.global_refiner - INFO - Refinement complete: 15 → 14 triplets (total: 19.14s, LLM: 19.14s)
2025-11-30 21:46:41,799 - src.pipeline.kg_builder - INFO - Global refinement: 14 triplets in 19.14s
2025-11-30 21:46:41,799 - src.pipeline.kg_builder - INFO - Using 14 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:46:41,799 - src.pipeline.kg_builder - INFO - Pushing batch 17/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:46:41,799 - src.components.neo4j_handler - INFO - Adding 14 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:46:41,989 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:46:41,989 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:46:41,990 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:46:41,990 - src.components.neo4j_handler - INFO - Batch injected in 0.19s (triplets: 0.19s, indexes: 0.00s)
2025-11-30 21:46:41,991 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 79, 'with_embedding': 0, 'linked_chunks': 51}
2025-11-30 21:46:41,991 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:46:42,005 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 185 nodes
2025-11-30 21:46:42,027 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 157 nodes
2025-11-30 21:46:42,058 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 185, 'relationship_count': 410, 'density': 0.012, 'avg_degree': 4.4324, 'avg_unique_neighbors': 4.4, 'global_efficiency': 0.2804, 'avg_path_length': 2.8542, 'avg_degree_centrality': 0.0241, 'max_degree_centrality': 0.4239, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0106, 'degree_assortativity': -0.2106, 'graph_robustness': 0.8171, 'diameter_estimate': 5, 'clustering_coefficient': 0.2889, 'weakly_connected_components': 29, 'largest_wcc_size': 157, 'pagerank_top10_percent': 17.16, 'louvain_communities': 38, 'louvain_modularity': 0.5054, 'label_entropy': 1.4923, 'computational_time': 0.06665675702970475}
2025-11-30 21:46:42,058 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 16, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510402.0584826, 'total_time': 24.44293716910761, 'aggregation': 2.3529864847660065e-06, 'network_info': 0.010398178943432868, 'llm_extraction': 24.173250291030854, 'data_cleaning': 3.0630966648459435e-05, 'neo4j_injection': 0.19082687597256154, 'embedding_time': 0, 'indexing_time': 0.004998057964257896, 'graph_injection_time': 0.18556868296582252, 'acs_metrics': {'node_count': 185, 'relationship_count': 410, 'density': 0.012, 'avg_degree': 4.4324, 'avg_unique_neighbors': 4.4, 'global_efficiency': 0.2804, 'avg_path_length': 2.8542, 'avg_degree_centrality': 0.0241, 'max_degree_centrality': 0.4239, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0106, 'degree_assortativity': -0.2106, 'graph_robustness': 0.8171, 'diameter_estimate': 5, 'clustering_coefficient': 0.2889, 'weakly_connected_components': 29, 'largest_wcc_size': 157, 'pagerank_top10_percent': 17.16, 'louvain_communities': 38, 'louvain_modularity': 0.5054, 'label_entropy': 1.4923, 'computational_time': 0.06665675702970475}, 'retrieval_queries': []}
2025-11-30 21:46:42,058 - src.pipeline.kg_builder - DEBUG - Batch 16 metrics: {
  "batch_idx": 16,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510402.0584826,
  "total_time": 24.44293716910761,
  "aggregation": 2.3529864847660065e-06,
  "network_info": 0.010398178943432868,
  "llm_extraction": 24.173250291030854,
  "data_cleaning": 3.0630966648459435e-05,
  "neo4j_injection": 0.19082687597256154,
  "embedding_time": 0,
  "indexing_time": 0.004998057964257896,
  "graph_injection_time": 0.18556868296582252,
  "acs_metrics": {
    "node_count": 185,
    "relationship_count": 410,
    "density": 0.012,
    "avg_degree": 4.4324,
    "avg_unique_neighbors": 4.4,
    "global_efficiency": 0.2804,
    "avg_path_length": 2.8542,
    "avg_degree_centrality": 0.0241,
    "max_degree_centrality": 0.4239,
    "avg_betweenness_centrality": 0.0002,
    "max_betweenness_centrality": 0.0106,
    "degree_assortativity": -0.2106,
    "graph_robustness": 0.8171,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2889,
    "weakly_connected_components": 29,
    "largest_wcc_size": 157,
    "pagerank_top10_percent": 17.16,
    "louvain_communities": 38,
    "louvain_modularity": 0.5054,
    "label_entropy": 1.4923,
    "computational_time": 0.06665675702970475
  },
  "retrieval_queries": []
}
2025-11-30 21:46:42,059 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:46:42,059 - src.pipeline.kg_builder - INFO - Batch 17 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 24.17s, Clean: 0.00s, Neo4j: 0.19s, ACS: 0.07s
2025-11-30 21:46:42,059 - src.pipeline.kg_builder - INFO - Batch 17 completed in 24.44s
Processing KG batches:  24%|██▎       | 17/72 [06:23<20:58, 22.88s/it]2025-11-30 21:46:42,059 - src.pipeline.kg_builder - INFO - Processing batch 18/72 (3 items)
2025-11-30 21:46:42,059 - src.pipeline.kg_builder - DEBUG - Batch 18 current_video_time: 04:24-04:29
2025-11-30 21:46:42,067 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 185
- Total Relationships: 142
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:46:42,068 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:46:42,068 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0 ~224 words, content: Time: 04:14-04:19 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a precise liquid transfer, performed with care and precision. The...
2025-11-30 21:46:42,068 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1 ~229 words, content: used to add a liquid to the beaker. The person's hands are steady, and the focus remains on the precise measurement of the liquid. The...
2025-11-30 21:46:42,068 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_2 ~218 words, content: aker. - **Equipment and Setup:** The central focus is the digital balance, which displays a reading of approximately $56.30$ grams. This indicates the person is...
2025-11-30 21:46:42,068 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_3 ~222 words, content: bench. A person, whose arm is visible, is using a pipette to transfer a liquid. The liquid is being added to a glass beaker that...
2025-11-30 21:46:42,068 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_4 ~106 words, content: - The background shows a typical lab environment with a glass-fronted cabinet, a door, and other equipment. - The digital balance's display changes slightly throughout...
2025-11-30 21:46:42,068 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:46:42,068 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:46:43,278 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:46:43,278 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:46:43,278 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:46:44,437 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:46:44,437 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:46:44,437 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_2) (~218 words) with timeout=5.0s retries=3
2025-11-30 21:46:45,398 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:46:45,398 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:46:45,398 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_3) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:46:46,646 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:46:46,646 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:46:46,647 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_4) (~106 words) with timeout=5.0s retries=3
2025-11-30 21:46:47,826 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:46:47,826 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:46:47,827 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 5 chunks
2025-11-30 21:46:47,827 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 5.76s
2025-11-30 21:46:47,827 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 21:46:47,827 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 185
- Total Relationships: 142
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_2"]}, {"head": "Beaker", "relation": "Placed On", "tail": "Digital_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Negative_Reading", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0"]}, {"head": "Person", "relation": "Wears", "tail": "Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1"]}, {"head": "Person", "relation": "Uses", "tail": "Wash_Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1"]}, {"head": "Digital_Balance", "relation": "Measures", "tail": "Liquid_Mass", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_2"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_2"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_2"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Document", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_2"]}, {"head": "Person", "relation": "Holds", "tail": "Squeeze Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_3"]}, {"head": "Liquid", "relation": "Is Added To", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:46:47,827 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~249 words, ~324 tokens)
2025-11-30 21:46:47,828 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:47:04,627 - src.components.global_refiner - DEBUG - LLM call completed in 16.80s
2025-11-30 21:47:04,627 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0']], ['Person', 'holds', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_3']], ['Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_3']], ['Beaker', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_2']], ['Beaker', 'placed_on', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0']], ['Digital_Balance', 'displays', 'Negative_Reading', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0']], ['Person', 'wears', 'Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1']], ['Person', 'uses', 'Wash_Bottle', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1']], ['Digital_Balance', 'measures', 'Liquid_Mass', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1']], ['Person', 'wears', 'Watch', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_2']]]
2025-11-30 21:47:04,627 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_3"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_2"
    ]
  ],
  [
    "Beaker",
    "placed_on",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Negative_Reading",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Wash_Bottle",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Liquid_Mass",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_17_2"
    ]
  ]
]
2025-11-30 21:47:04,627 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 16.80s, LLM: 16.80s)
2025-11-30 21:47:04,627 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 16.80s
2025-11-30 21:47:04,627 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:47:04,627 - src.pipeline.kg_builder - INFO - Pushing batch 18/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:47:04,627 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:47:04,796 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:47:04,796 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:47:04,796 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:47:04,796 - src.components.neo4j_handler - INFO - Batch injected in 0.17s (triplets: 0.16s, indexes: 0.00s)
2025-11-30 21:47:04,797 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 84, 'with_embedding': 0, 'linked_chunks': 55}
2025-11-30 21:47:04,797 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:47:04,811 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 192 nodes
2025-11-30 21:47:04,835 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 163 nodes
2025-11-30 21:47:04,869 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 192, 'relationship_count': 435, 'density': 0.0119, 'avg_degree': 4.5312, 'avg_unique_neighbors': 4.5, 'global_efficiency': 0.2828, 'avg_path_length': 2.8283, 'avg_degree_centrality': 0.0237, 'max_degree_centrality': 0.4346, 'avg_betweenness_centrality': 0.0001, 'max_betweenness_centrality': 0.0068, 'degree_assortativity': -0.207, 'graph_robustness': 0.7908, 'diameter_estimate': 5, 'clustering_coefficient': 0.2886, 'weakly_connected_components': 30, 'largest_wcc_size': 163, 'pagerank_top10_percent': 16.66, 'louvain_communities': 40, 'louvain_modularity': 0.4968, 'label_entropy': 1.4943, 'computational_time': 0.07157054205890745}
2025-11-30 21:47:04,869 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 17, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510424.869491, 'total_time': 22.81031556695234, 'aggregation': 2.522021532058716e-06, 'network_info': 0.008571739075705409, 'llm_extraction': 22.559744748985395, 'data_cleaning': 2.4360022507607937e-05, 'neo4j_injection': 0.16891511098947376, 'embedding_time': 0, 'indexing_time': 0.004077575984410942, 'graph_injection_time': 0.16457327303942293, 'acs_metrics': {'node_count': 192, 'relationship_count': 435, 'density': 0.0119, 'avg_degree': 4.5312, 'avg_unique_neighbors': 4.5, 'global_efficiency': 0.2828, 'avg_path_length': 2.8283, 'avg_degree_centrality': 0.0237, 'max_degree_centrality': 0.4346, 'avg_betweenness_centrality': 0.0001, 'max_betweenness_centrality': 0.0068, 'degree_assortativity': -0.207, 'graph_robustness': 0.7908, 'diameter_estimate': 5, 'clustering_coefficient': 0.2886, 'weakly_connected_components': 30, 'largest_wcc_size': 163, 'pagerank_top10_percent': 16.66, 'louvain_communities': 40, 'louvain_modularity': 0.4968, 'label_entropy': 1.4943, 'computational_time': 0.07157054205890745}, 'retrieval_queries': []}
2025-11-30 21:47:04,869 - src.pipeline.kg_builder - DEBUG - Batch 17 metrics: {
  "batch_idx": 17,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510424.869491,
  "total_time": 22.81031556695234,
  "aggregation": 2.522021532058716e-06,
  "network_info": 0.008571739075705409,
  "llm_extraction": 22.559744748985395,
  "data_cleaning": 2.4360022507607937e-05,
  "neo4j_injection": 0.16891511098947376,
  "embedding_time": 0,
  "indexing_time": 0.004077575984410942,
  "graph_injection_time": 0.16457327303942293,
  "acs_metrics": {
    "node_count": 192,
    "relationship_count": 435,
    "density": 0.0119,
    "avg_degree": 4.5312,
    "avg_unique_neighbors": 4.5,
    "global_efficiency": 0.2828,
    "avg_path_length": 2.8283,
    "avg_degree_centrality": 0.0237,
    "max_degree_centrality": 0.4346,
    "avg_betweenness_centrality": 0.0001,
    "max_betweenness_centrality": 0.0068,
    "degree_assortativity": -0.207,
    "graph_robustness": 0.7908,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2886,
    "weakly_connected_components": 30,
    "largest_wcc_size": 163,
    "pagerank_top10_percent": 16.66,
    "louvain_communities": 40,
    "louvain_modularity": 0.4968,
    "label_entropy": 1.4943,
    "computational_time": 0.07157054205890745
  },
  "retrieval_queries": []
}
2025-11-30 21:47:04,870 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:47:04,870 - src.pipeline.kg_builder - INFO - Batch 18 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 22.56s, Clean: 0.00s, Neo4j: 0.17s, ACS: 0.07s
2025-11-30 21:47:04,870 - src.pipeline.kg_builder - INFO - Batch 18 completed in 22.81s
Processing KG batches:  25%|██▌       | 18/72 [06:46<20:34, 22.86s/it]2025-11-30 21:47:04,870 - src.pipeline.kg_builder - INFO - Processing batch 19/72 (3 items)
2025-11-30 21:47:04,870 - src.pipeline.kg_builder - DEBUG - Batch 19 current_video_time: 04:39-04:44
2025-11-30 21:47:04,880 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 192
- Total Relationships: 145
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:47:04,881 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:47:04,881 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0 ~217 words, content: Time: 04:29-04:34 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a precise liquid transfer, performed by a person wearing blue...
2025-11-30 21:47:04,881 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1 ~200 words, content: a counter in the background. A sign with Chinese characters, "当心火灾" (Beware of fire), is visible on the wall, indicating a safety precaution. - **Procedure:**...
2025-11-30 21:47:04,881 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2 ~214 words, content: - A **volumetric flask**, which is a round-bottomed flask with a long neck, is positioned on the table to receive the liquid. - A **digital...
2025-11-30 21:47:04,881 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_3 ~197 words, content: **Primary Action:** A person wearing blue nitrile gloves is carefully pouring a clear liquid from a small, transparent glass beaker into a long, thin glass...
2025-11-30 21:47:04,881 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_4 ~106 words, content: to receive the liquid. The liquid is being dispensed into this flask. - **Other Lab Equipment:** In the background, there is a white shelving unit...
2025-11-30 21:47:04,881 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:47:04,881 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0) (~217 words) with timeout=5.0s retries=3
2025-11-30 21:47:06,032 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:47:06,032 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:47:06,032 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1) (~200 words) with timeout=5.0s retries=3
2025-11-30 21:47:07,186 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:47:07,186 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:47:07,186 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2) (~214 words) with timeout=5.0s retries=3
2025-11-30 21:47:08,657 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:47:08,657 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:47:08,658 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_3) (~197 words) with timeout=5.0s retries=3
2025-11-30 21:47:09,875 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:47:09,875 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:47:09,875 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_4) (~106 words) with timeout=5.0s retries=3
2025-11-30 21:47:10,987 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:47:10,987 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:47:10,988 - src.components.pre_llm_injector - INFO - Extracted 20 local triplets from 5 chunks
2025-11-30 21:47:10,988 - src.pipeline.kg_builder - INFO - Pre-extraction: 20 triplets in 6.11s
2025-11-30 21:47:10,988 - src.components.global_refiner - INFO - Capping refinement input: 20 → 15 triplets
2025-11-30 21:47:10,988 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 192
- Total Relationships: 145
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_3"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_3"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Mass_Reading", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0"]}, {"head": "Volumetric_Flask", "relation": "Receives", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1"]}, {"head": "Volumetric_Flask", "relation": "Is Positioned On", "tail": "Lab_Table", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Weight_Value", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2"]}, {"head": "Beaker", "relation": "Is Held Over", "tail": "Digital_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2"]}, {"head": "Lab_Table", "relation": "Contains", "tail": "Piece_Of_Paper", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_3"]}, {"head": "Pipette", "relation": "Dispenses", "tail": "Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_3"]}, {"head": "Liquid", "relation": "Is Dispensed Into", "tail": "Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:47:10,989 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~251 words, ~326 tokens)
2025-11-30 21:47:10,989 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:47:30,556 - src.components.global_refiner - DEBUG - LLM call completed in 19.57s
2025-11-30 21:47:30,556 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_3']], ['Person', 'holds', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_3']], ['Person', 'holds', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_3']], ['Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1']], ['Beaker', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1']], ['Digital_Balance', 'displays', 'Mass_Reading', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0']], ['Volumetric_Flask', 'receives', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1']], ['Volumetric_Flask', 'is_positioned_on', 'Lab_Table', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2']], ['Digital_Balance', 'displays', 'Weight_Value', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2']], ['Beaker', 'is_held_over', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2']]]
2025-11-30 21:47:30,557 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_3"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Mass_Reading",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_0"
    ]
  ],
  [
    "Volumetric_Flask",
    "receives",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_1"
    ]
  ],
  [
    "Volumetric_Flask",
    "is_positioned_on",
    "Lab_Table",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Weight_Value",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2"
    ]
  ],
  [
    "Beaker",
    "is_held_over",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_18_2"
    ]
  ]
]
2025-11-30 21:47:30,557 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 19.57s, LLM: 19.57s)
2025-11-30 21:47:30,557 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 19.57s
2025-11-30 21:47:30,557 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:47:30,557 - src.pipeline.kg_builder - INFO - Pushing batch 19/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:47:30,557 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:47:30,741 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:47:30,741 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:47:30,741 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:47:30,741 - src.components.neo4j_handler - INFO - Batch injected in 0.18s (triplets: 0.18s, indexes: 0.00s)
2025-11-30 21:47:30,742 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 89, 'with_embedding': 0, 'linked_chunks': 59}
2025-11-30 21:47:30,742 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:47:30,758 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 200 nodes
2025-11-30 21:47:30,784 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 170 nodes
2025-11-30 21:47:30,822 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 200, 'relationship_count': 462, 'density': 0.0116, 'avg_degree': 4.62, 'avg_unique_neighbors': 4.59, 'global_efficiency': 0.2845, 'avg_path_length': 2.8143, 'avg_degree_centrality': 0.0232, 'max_degree_centrality': 0.4372, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0108, 'degree_assortativity': -0.1904, 'graph_robustness': 0.7987, 'diameter_estimate': 5, 'clustering_coefficient': 0.289, 'weakly_connected_components': 31, 'largest_wcc_size': 170, 'pagerank_top10_percent': 16.07, 'louvain_communities': 41, 'louvain_modularity': 0.4818, 'label_entropy': 1.4956, 'computational_time': 0.07923133799340576}
2025-11-30 21:47:30,822 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 18, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510450.822294, 'total_time': 25.9520844159415, 'aggregation': 3.005960024893284e-06, 'network_info': 0.010383674991317093, 'llm_extraction': 25.67654032597784, 'data_cleaning': 2.554105594754219e-05, 'neo4j_injection': 0.18453274702187628, 'embedding_time': 0, 'indexing_time': 0.0044821989722549915, 'graph_injection_time': 0.17979362898040563, 'acs_metrics': {'node_count': 200, 'relationship_count': 462, 'density': 0.0116, 'avg_degree': 4.62, 'avg_unique_neighbors': 4.59, 'global_efficiency': 0.2845, 'avg_path_length': 2.8143, 'avg_degree_centrality': 0.0232, 'max_degree_centrality': 0.4372, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0108, 'degree_assortativity': -0.1904, 'graph_robustness': 0.7987, 'diameter_estimate': 5, 'clustering_coefficient': 0.289, 'weakly_connected_components': 31, 'largest_wcc_size': 170, 'pagerank_top10_percent': 16.07, 'louvain_communities': 41, 'louvain_modularity': 0.4818, 'label_entropy': 1.4956, 'computational_time': 0.07923133799340576}, 'retrieval_queries': []}
2025-11-30 21:47:30,822 - src.pipeline.kg_builder - DEBUG - Batch 18 metrics: {
  "batch_idx": 18,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510450.822294,
  "total_time": 25.9520844159415,
  "aggregation": 3.005960024893284e-06,
  "network_info": 0.010383674991317093,
  "llm_extraction": 25.67654032597784,
  "data_cleaning": 2.554105594754219e-05,
  "neo4j_injection": 0.18453274702187628,
  "embedding_time": 0,
  "indexing_time": 0.0044821989722549915,
  "graph_injection_time": 0.17979362898040563,
  "acs_metrics": {
    "node_count": 200,
    "relationship_count": 462,
    "density": 0.0116,
    "avg_degree": 4.62,
    "avg_unique_neighbors": 4.59,
    "global_efficiency": 0.2845,
    "avg_path_length": 2.8143,
    "avg_degree_centrality": 0.0232,
    "max_degree_centrality": 0.4372,
    "avg_betweenness_centrality": 0.0002,
    "max_betweenness_centrality": 0.0108,
    "degree_assortativity": -0.1904,
    "graph_robustness": 0.7987,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.289,
    "weakly_connected_components": 31,
    "largest_wcc_size": 170,
    "pagerank_top10_percent": 16.07,
    "louvain_communities": 41,
    "louvain_modularity": 0.4818,
    "label_entropy": 1.4956,
    "computational_time": 0.07923133799340576
  },
  "retrieval_queries": []
}
2025-11-30 21:47:30,822 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:47:30,822 - src.pipeline.kg_builder - INFO - Batch 19 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 25.68s, Clean: 0.00s, Neo4j: 0.18s, ACS: 0.08s
2025-11-30 21:47:30,822 - src.pipeline.kg_builder - INFO - Batch 19 completed in 25.95s
Processing KG batches:  26%|██▋       | 19/72 [07:12<21:00, 23.79s/it]2025-11-30 21:47:30,822 - src.pipeline.kg_builder - INFO - Processing batch 20/72 (3 items)
2025-11-30 21:47:30,823 - src.pipeline.kg_builder - DEBUG - Batch 20 current_video_time: 04:54-04:59
2025-11-30 21:47:30,834 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 200
- Total Relationships: 149
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:47:30,835 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:47:30,835 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0 ~214 words, content: Time: 04:44-04:49 Content: The video captures a detailed, first-person perspective of a precise laboratory procedure, likely the preparation of a solution. The sequence of actions...
2025-11-30 21:47:30,835 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1 ~225 words, content: **Step 2: Measuring and Transferring:** The person continues to use the pipette to draw liquid from the beaker. The beaker is then placed on the...
2025-11-30 21:47:30,835 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_2 ~222 words, content: . Time: 04:49-04:54 Content: The video sequence captures a detailed, first-person perspective of a precise laboratory procedure, likely a titration or a solution preparation step....
2025-11-30 21:47:30,835 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_3 ~226 words, content: ette." The liquid being used for the rinse is likely a solvent or a diluent, as indicated by the "10%" label on the wash bottle....
2025-11-30 21:47:30,835 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_4 ~146 words, content: achieve a specific weight. - **Equipment and Setup:** The experiment is taking place on a black laboratory bench. In addition to the balance and beaker,...
2025-11-30 21:47:30,835 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:47:30,835 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0) (~214 words) with timeout=5.0s retries=3
2025-11-30 21:47:32,102 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:47:32,102 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:47:32,103 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:47:33,115 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:47:33,116 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:47:33,116 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_2) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:47:34,393 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:47:34,393 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:47:34,394 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_3) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:47:39,399 - src.components.pre_llm_injector - WARNING - Chunk 3 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 21:47:41,262 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 2)
2025-11-30 21:47:41,262 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:47:41,262 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_4) (~146 words) with timeout=5.0s retries=3
2025-11-30 21:47:42,399 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:47:42,399 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:47:42,399 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 5 chunks
2025-11-30 21:47:42,399 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 11.56s
2025-11-30 21:47:42,400 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 21:47:42,400 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 200
- Total Relationships: 149
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_3"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_3"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0"]}, {"head": "Glass_Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_4"]}, {"head": "Volumetric Flask", "relation": "Receives", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1"]}, {"head": "Balance", "relation": "Measures", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1"]}, {"head": "Person", "relation": "Monitors", "tail": "Liquid Amount", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_4"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_2"]}, {"head": "Person", "relation": "Uses", "tail": "Wash_Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_2"]}, {"head": "Pipette", "relation": "Is Rinsed By", "tail": "Wash_Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:47:42,400 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~245 words, ~318 tokens)
2025-11-30 21:47:42,400 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:47:57,608 - src.components.global_refiner - DEBUG - LLM call completed in 15.21s
2025-11-30 21:47:57,608 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_3']], ['Person', 'wears', 'Watch', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_3']], ['Person', 'holds', 'Glass_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0']], ['Glass_Beaker', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1']], ['Pipette', 'transfers', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0']], ['Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1']], ['Beaker', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_4']], ['Volumetric_Flask', 'receives', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1']], ['Balance', 'measures', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1']]]
2025-11-30 21:47:57,608 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0"
    ]
  ],
  [
    "Glass_Beaker",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_0"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_4"
    ]
  ],
  [
    "Volumetric_Flask",
    "receives",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1"
    ]
  ],
  [
    "Balance",
    "measures",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_19_1"
    ]
  ]
]
2025-11-30 21:47:57,608 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 15.21s, LLM: 15.21s)
2025-11-30 21:47:57,608 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 15.21s
2025-11-30 21:47:57,608 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:47:57,608 - src.pipeline.kg_builder - INFO - Pushing batch 20/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:47:57,609 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:47:57,768 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:47:57,768 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:47:57,768 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:47:57,768 - src.components.neo4j_handler - INFO - Batch injected in 0.16s (triplets: 0.16s, indexes: 0.00s)
2025-11-30 21:47:57,769 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 94, 'with_embedding': 0, 'linked_chunks': 64}
2025-11-30 21:47:57,769 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:47:57,792 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 205 nodes
2025-11-30 21:47:57,832 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 175 nodes
2025-11-30 21:47:57,878 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 205, 'relationship_count': 484, 'density': 0.0116, 'avg_degree': 4.722, 'avg_unique_neighbors': 4.6927, 'global_efficiency': 0.2886, 'avg_path_length': 2.7951, 'avg_degree_centrality': 0.0231, 'max_degree_centrality': 0.4461, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0096, 'degree_assortativity': -0.188, 'graph_robustness': 0.8017, 'diameter_estimate': 5, 'clustering_coefficient': 0.2925, 'weakly_connected_components': 31, 'largest_wcc_size': 175, 'pagerank_top10_percent': 15.8, 'louvain_communities': 40, 'louvain_modularity': 0.466, 'label_entropy': 1.4975, 'computational_time': 0.10889743396546692}
2025-11-30 21:47:57,879 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 19, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510477.879057, 'total_time': 27.056062437943183, 'aggregation': 2.3890752345323563e-06, 'network_info': 0.011799862957559526, 'llm_extraction': 26.773918751976453, 'data_cleaning': 1.2523028999567032e-05, 'neo4j_injection': 0.1599671250442043, 'embedding_time': 0, 'indexing_time': 0.0028247000882402062, 'graph_injection_time': 0.1569706000154838, 'acs_metrics': {'node_count': 205, 'relationship_count': 484, 'density': 0.0116, 'avg_degree': 4.722, 'avg_unique_neighbors': 4.6927, 'global_efficiency': 0.2886, 'avg_path_length': 2.7951, 'avg_degree_centrality': 0.0231, 'max_degree_centrality': 0.4461, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0096, 'degree_assortativity': -0.188, 'graph_robustness': 0.8017, 'diameter_estimate': 5, 'clustering_coefficient': 0.2925, 'weakly_connected_components': 31, 'largest_wcc_size': 175, 'pagerank_top10_percent': 15.8, 'louvain_communities': 40, 'louvain_modularity': 0.466, 'label_entropy': 1.4975, 'computational_time': 0.10889743396546692}, 'retrieval_queries': []}
2025-11-30 21:47:57,879 - src.pipeline.kg_builder - DEBUG - Batch 19 metrics: {
  "batch_idx": 19,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510477.879057,
  "total_time": 27.056062437943183,
  "aggregation": 2.3890752345323563e-06,
  "network_info": 0.011799862957559526,
  "llm_extraction": 26.773918751976453,
  "data_cleaning": 1.2523028999567032e-05,
  "neo4j_injection": 0.1599671250442043,
  "embedding_time": 0,
  "indexing_time": 0.0028247000882402062,
  "graph_injection_time": 0.1569706000154838,
  "acs_metrics": {
    "node_count": 205,
    "relationship_count": 484,
    "density": 0.0116,
    "avg_degree": 4.722,
    "avg_unique_neighbors": 4.6927,
    "global_efficiency": 0.2886,
    "avg_path_length": 2.7951,
    "avg_degree_centrality": 0.0231,
    "max_degree_centrality": 0.4461,
    "avg_betweenness_centrality": 0.0002,
    "max_betweenness_centrality": 0.0096,
    "degree_assortativity": -0.188,
    "graph_robustness": 0.8017,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2925,
    "weakly_connected_components": 31,
    "largest_wcc_size": 175,
    "pagerank_top10_percent": 15.8,
    "louvain_communities": 40,
    "louvain_modularity": 0.466,
    "label_entropy": 1.4975,
    "computational_time": 0.10889743396546692
  },
  "retrieval_queries": []
}
2025-11-30 21:47:57,879 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:47:57,879 - src.pipeline.kg_builder - INFO - Batch 20 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 26.77s, Clean: 0.00s, Neo4j: 0.16s, ACS: 0.11s
2025-11-30 21:47:57,879 - src.pipeline.kg_builder - INFO - Batch 20 completed in 27.06s
Processing KG batches:  28%|██▊       | 20/72 [07:39<21:27, 24.77s/it]2025-11-30 21:47:57,879 - src.pipeline.kg_builder - INFO - Processing batch 21/72 (3 items)
2025-11-30 21:47:57,879 - src.pipeline.kg_builder - DEBUG - Batch 21 current_video_time: 05:09-05:14
2025-11-30 21:47:57,890 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 205
- Total Relationships: 152
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:47:57,890 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:47:57,890 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0 ~215 words, content: Time: 04:59-05:04 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a precise liquid transfer, performed by a person wearing blue...
2025-11-30 21:47:57,890 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1 ~230 words, content: ** The person then uses their right hand to pick up the beaker, which is still on the balance. They lift it slightly, likely to...
2025-11-30 21:47:57,890 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_2 ~224 words, content: aker into a larger, empty volumetric flask. This is a standard technique in analytical chemistry for preparing a solution of a specific concentration. - **Measurement:**...
2025-11-30 21:47:57,890 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_3 ~122 words, content: . The individual, wearing blue nitrile gloves, is carefully transferring a liquid from a small beaker into a volumetric flask. The process is being conducted...
2025-11-30 21:47:57,890 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:47:57,891 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0) (~215 words) with timeout=5.0s retries=3
2025-11-30 21:47:59,349 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:47:59,349 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:47:59,350 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1) (~230 words) with timeout=5.0s retries=3
2025-11-30 21:48:00,423 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:48:00,423 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:48:00,424 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_2) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:48:01,671 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:48:01,671 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:48:01,671 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_3) (~122 words) with timeout=5.0s retries=3
2025-11-30 21:48:02,979 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:48:02,979 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:48:02,979 - src.components.pre_llm_injector - INFO - Extracted 20 local triplets from 4 chunks
2025-11-30 21:48:02,979 - src.pipeline.kg_builder - INFO - Pre-extraction: 20 triplets in 5.09s
2025-11-30 21:48:02,980 - src.components.global_refiner - INFO - Capping refinement input: 20 → 15 triplets
2025-11-30 21:48:02,980 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 205
- Total Relationships: 152
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_3"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0"]}, {"head": "Person", "relation": "Holds", "tail": "Wash_Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0"]}, {"head": "Glass_Pipette", "relation": "Is Positioned Over", "tail": "Glass_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0"]}, {"head": "Glass_Beaker", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "630.1", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_3"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_2"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_2"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_2"]}, {"head": "Liquid", "relation": "Is Measured On", "tail": "Digital Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:48:02,980 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~248 words, ~322 tokens)
2025-11-30 21:48:02,980 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:48:17,473 - src.components.global_refiner - DEBUG - LLM call completed in 14.49s
2025-11-30 21:48:17,473 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_3']], ['Person', 'holds', 'Glass_Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0']], ['Person', 'holds', 'Wash_Bottle', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0']], ['Glass_Pipette', 'is_positioned_over', 'Glass_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0']], ['Glass_Beaker', 'is_on', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0']], ['Digital_Balance', 'displays', '630.1', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0']], ['Person', 'holds', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_3']], ['Beaker', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1']], ['Beaker', 'is_on', 'Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1']]]
2025-11-30 21:48:17,473 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Wash_Bottle",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0"
    ]
  ],
  [
    "Glass_Pipette",
    "is_positioned_over",
    "Glass_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0"
    ]
  ],
  [
    "Glass_Beaker",
    "is_on",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "630.1",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_20_1"
    ]
  ]
]
2025-11-30 21:48:17,473 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 14.49s, LLM: 14.49s)
2025-11-30 21:48:17,473 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 14.49s
2025-11-30 21:48:17,473 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:48:17,473 - src.pipeline.kg_builder - INFO - Pushing batch 21/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:48:17,473 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:48:17,633 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:48:17,633 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:48:17,633 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:48:17,633 - src.components.neo4j_handler - INFO - Batch injected in 0.16s (triplets: 0.16s, indexes: 0.00s)
2025-11-30 21:48:17,635 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 98, 'with_embedding': 0, 'linked_chunks': 68}
2025-11-30 21:48:17,635 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:48:17,652 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 210 nodes
2025-11-30 21:48:17,683 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 180 nodes
2025-11-30 21:48:17,726 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 210, 'relationship_count': 506, 'density': 0.0115, 'avg_degree': 4.819, 'avg_unique_neighbors': 4.781, 'global_efficiency': 0.2923, 'avg_path_length': 2.7786, 'avg_degree_centrality': 0.0231, 'max_degree_centrality': 0.4545, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0117, 'degree_assortativity': -0.1869, 'graph_robustness': 0.8043, 'diameter_estimate': 5, 'clustering_coefficient': 0.295, 'weakly_connected_components': 31, 'largest_wcc_size': 180, 'pagerank_top10_percent': 15.5, 'louvain_communities': 39, 'louvain_modularity': 0.4675, 'label_entropy': 1.4984, 'computational_time': 0.09129276301246136}
2025-11-30 21:48:17,726 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 20, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510497.7266476, 'total_time': 19.84685901796911, 'aggregation': 2.5889603421092033e-06, 'network_info': 0.01041091897059232, 'llm_extraction': 19.58329285099171, 'data_cleaning': 1.0655028745532036e-05, 'neo4j_injection': 0.16024301608558744, 'embedding_time': 0, 'indexing_time': 0.004868027986958623, 'graph_injection_time': 0.15522660606075078, 'acs_metrics': {'node_count': 210, 'relationship_count': 506, 'density': 0.0115, 'avg_degree': 4.819, 'avg_unique_neighbors': 4.781, 'global_efficiency': 0.2923, 'avg_path_length': 2.7786, 'avg_degree_centrality': 0.0231, 'max_degree_centrality': 0.4545, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0117, 'degree_assortativity': -0.1869, 'graph_robustness': 0.8043, 'diameter_estimate': 5, 'clustering_coefficient': 0.295, 'weakly_connected_components': 31, 'largest_wcc_size': 180, 'pagerank_top10_percent': 15.5, 'louvain_communities': 39, 'louvain_modularity': 0.4675, 'label_entropy': 1.4984, 'computational_time': 0.09129276301246136}, 'retrieval_queries': []}
2025-11-30 21:48:17,726 - src.pipeline.kg_builder - DEBUG - Batch 20 metrics: {
  "batch_idx": 20,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510497.7266476,
  "total_time": 19.84685901796911,
  "aggregation": 2.5889603421092033e-06,
  "network_info": 0.01041091897059232,
  "llm_extraction": 19.58329285099171,
  "data_cleaning": 1.0655028745532036e-05,
  "neo4j_injection": 0.16024301608558744,
  "embedding_time": 0,
  "indexing_time": 0.004868027986958623,
  "graph_injection_time": 0.15522660606075078,
  "acs_metrics": {
    "node_count": 210,
    "relationship_count": 506,
    "density": 0.0115,
    "avg_degree": 4.819,
    "avg_unique_neighbors": 4.781,
    "global_efficiency": 0.2923,
    "avg_path_length": 2.7786,
    "avg_degree_centrality": 0.0231,
    "max_degree_centrality": 0.4545,
    "avg_betweenness_centrality": 0.0002,
    "max_betweenness_centrality": 0.0117,
    "degree_assortativity": -0.1869,
    "graph_robustness": 0.8043,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.295,
    "weakly_connected_components": 31,
    "largest_wcc_size": 180,
    "pagerank_top10_percent": 15.5,
    "louvain_communities": 39,
    "louvain_modularity": 0.4675,
    "label_entropy": 1.4984,
    "computational_time": 0.09129276301246136
  },
  "retrieval_queries": []
}
2025-11-30 21:48:17,727 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:48:17,727 - src.pipeline.kg_builder - INFO - Batch 21 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.58s, Clean: 0.00s, Neo4j: 0.16s, ACS: 0.09s
2025-11-30 21:48:17,727 - src.pipeline.kg_builder - INFO - Batch 21 completed in 19.85s
Processing KG batches:  29%|██▉       | 21/72 [07:59<19:47, 23.29s/it]2025-11-30 21:48:17,727 - src.pipeline.kg_builder - INFO - Processing batch 22/72 (3 items)
2025-11-30 21:48:17,727 - src.pipeline.kg_builder - DEBUG - Batch 22 current_video_time: 05:24-05:29
2025-11-30 21:48:17,738 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 210
- Total Relationships: 157
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:48:17,739 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:48:17,739 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0 ~222 words, content: Time: 05:14-05:19 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a solution preparation, performed by a scientist wearing blue nitrile...
2025-11-30 21:48:17,739 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1 ~247 words, content: **Frame 3:** The perspective changes to a wider shot, showing more of the laboratory bench. The person is now using a pipette to transfer liquid...
2025-11-30 21:48:17,739 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2 ~225 words, content: suggests that the procedure requires high accuracy, possibly for preparing a standard solution or conducting a titration. The person is carefully handling the equipment and...
2025-11-30 21:48:17,739 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_3 ~228 words, content: - **Final Action:** After the liquid has been added, the person removes the pipette from the beaker. The beaker is then lifted and placed onto...
2025-11-30 21:48:17,739 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_4 ~184 words, content: involves a person wearing blue nitrile gloves, who is carefully handling laboratory equipment. The process begins with the person using a pipette to transfer a...
2025-11-30 21:48:17,739 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:48:17,739 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:48:19,091 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:48:19,091 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:48:19,092 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1) (~247 words) with timeout=5.0s retries=3
2025-11-30 21:48:20,180 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:48:20,180 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:48:20,181 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:48:21,506 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:48:21,506 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:48:21,506 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_3) (~228 words) with timeout=5.0s retries=3
2025-11-30 21:48:22,676 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:48:22,676 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:48:22,676 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_4) (~184 words) with timeout=5.0s retries=3
2025-11-30 21:48:23,983 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:48:23,983 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:48:23,983 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 5 chunks
2025-11-30 21:48:23,983 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 6.24s
2025-11-30 21:48:23,983 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 21:48:23,984 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 210
- Total Relationships: 157
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_4"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_4"]}, {"head": "Liquid", "relation": "Is In", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_4"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "-56.301_G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_4"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1"]}, {"head": "Digital Balance", "relation": "Is Used By", "tail": "Person", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Volumetric Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2"]}, {"head": "Person", "relation": "Holds", "tail": "Wash_Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2"]}, {"head": "Glass_Pipette", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2"]}, {"head": "Wash_Bottle", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:48:23,984 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~249 words, ~324 tokens)
2025-11-30 21:48:23,984 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:48:45,653 - src.components.global_refiner - DEBUG - LLM call completed in 21.67s
2025-11-30 21:48:45,653 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_4']], ['Person', 'holds', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0']], ['Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_4']], ['Liquid', 'is_in', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0']], ['Beaker', 'is_on', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_4']], ['Digital_Balance', 'displays', '-56.301_G', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_4']], ['Person', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1']], ['Digital_Balance', 'is_used_by', 'Person', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1']], ['Lab_Bench', 'contains', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1']], ['Lab_Bench', 'contains', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1']], ['Person', 'holds', 'Glass_Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2']], ['Person', 'holds', 'Wash_Bottle', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2']], ['Glass_Pipette', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2']], ['Wash_Bottle', 'dispenses', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2']]]
2025-11-30 21:48:45,653 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_4"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_4"
    ]
  ],
  [
    "Liquid",
    "is_in",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_4"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "-56.301_G",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_4"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1"
    ]
  ],
  [
    "Digital_Balance",
    "is_used_by",
    "Person",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Wash_Bottle",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2"
    ]
  ],
  [
    "Glass_Pipette",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2"
    ]
  ],
  [
    "Wash_Bottle",
    "dispenses",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_21_2"
    ]
  ]
]
2025-11-30 21:48:45,653 - src.components.global_refiner - INFO - Refinement complete: 15 → 15 triplets (total: 21.67s, LLM: 21.67s)
2025-11-30 21:48:45,653 - src.pipeline.kg_builder - INFO - Global refinement: 15 triplets in 21.67s
2025-11-30 21:48:45,653 - src.pipeline.kg_builder - INFO - Using 15 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:48:45,653 - src.pipeline.kg_builder - INFO - Pushing batch 22/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:48:45,653 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:48:45,841 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:48:45,841 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:48:45,842 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:48:45,842 - src.components.neo4j_handler - INFO - Batch injected in 0.19s (triplets: 0.19s, indexes: 0.00s)
2025-11-30 21:48:45,843 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 103, 'with_embedding': 0, 'linked_chunks': 72}
2025-11-30 21:48:45,843 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:48:45,869 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 216 nodes
2025-11-30 21:48:45,915 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 185 nodes
2025-11-30 21:48:45,964 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 216, 'relationship_count': 536, 'density': 0.0115, 'avg_degree': 4.963, 'avg_unique_neighbors': 4.9259, 'global_efficiency': 0.2951, 'avg_path_length': 2.7398, 'avg_degree_centrality': 0.0231, 'max_degree_centrality': 0.4651, 'avg_betweenness_centrality': 0.0009, 'max_betweenness_centrality': 0.0463, 'degree_assortativity': -0.175, 'graph_robustness': 0.8041, 'diameter_estimate': 5, 'clustering_coefficient': 0.2948, 'weakly_connected_components': 32, 'largest_wcc_size': 185, 'pagerank_top10_percent': 15.14, 'louvain_communities': 41, 'louvain_modularity': 0.4462, 'label_entropy': 1.4992, 'computational_time': 0.1205762280151248}
2025-11-30 21:48:45,964 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 21, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510525.9642787, 'total_time': 28.236860212055035, 'aggregation': 2.261018380522728e-06, 'network_info': 0.011395010049454868, 'llm_extraction': 27.91447615006473, 'data_cleaning': 1.2919073924422264e-05, 'neo4j_injection': 0.18870840698946267, 'embedding_time': 0, 'indexing_time': 0.0030603869818150997, 'graph_injection_time': 0.18549907999113202, 'acs_metrics': {'node_count': 216, 'relationship_count': 536, 'density': 0.0115, 'avg_degree': 4.963, 'avg_unique_neighbors': 4.9259, 'global_efficiency': 0.2951, 'avg_path_length': 2.7398, 'avg_degree_centrality': 0.0231, 'max_degree_centrality': 0.4651, 'avg_betweenness_centrality': 0.0009, 'max_betweenness_centrality': 0.0463, 'degree_assortativity': -0.175, 'graph_robustness': 0.8041, 'diameter_estimate': 5, 'clustering_coefficient': 0.2948, 'weakly_connected_components': 32, 'largest_wcc_size': 185, 'pagerank_top10_percent': 15.14, 'louvain_communities': 41, 'louvain_modularity': 0.4462, 'label_entropy': 1.4992, 'computational_time': 0.1205762280151248}, 'retrieval_queries': []}
2025-11-30 21:48:45,964 - src.pipeline.kg_builder - DEBUG - Batch 21 metrics: {
  "batch_idx": 21,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510525.9642787,
  "total_time": 28.236860212055035,
  "aggregation": 2.261018380522728e-06,
  "network_info": 0.011395010049454868,
  "llm_extraction": 27.91447615006473,
  "data_cleaning": 1.2919073924422264e-05,
  "neo4j_injection": 0.18870840698946267,
  "embedding_time": 0,
  "indexing_time": 0.0030603869818150997,
  "graph_injection_time": 0.18549907999113202,
  "acs_metrics": {
    "node_count": 216,
    "relationship_count": 536,
    "density": 0.0115,
    "avg_degree": 4.963,
    "avg_unique_neighbors": 4.9259,
    "global_efficiency": 0.2951,
    "avg_path_length": 2.7398,
    "avg_degree_centrality": 0.0231,
    "max_degree_centrality": 0.4651,
    "avg_betweenness_centrality": 0.0009,
    "max_betweenness_centrality": 0.0463,
    "degree_assortativity": -0.175,
    "graph_robustness": 0.8041,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2948,
    "weakly_connected_components": 32,
    "largest_wcc_size": 185,
    "pagerank_top10_percent": 15.14,
    "louvain_communities": 41,
    "louvain_modularity": 0.4462,
    "label_entropy": 1.4992,
    "computational_time": 0.1205762280151248
  },
  "retrieval_queries": []
}
2025-11-30 21:48:45,964 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:48:45,964 - src.pipeline.kg_builder - INFO - Batch 22 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 27.91s, Clean: 0.00s, Neo4j: 0.19s, ACS: 0.12s
2025-11-30 21:48:45,964 - src.pipeline.kg_builder - INFO - Batch 22 completed in 28.24s
Processing KG batches:  31%|███       | 22/72 [08:27<20:38, 24.78s/it]2025-11-30 21:48:45,965 - src.pipeline.kg_builder - INFO - Processing batch 23/72 (3 items)
2025-11-30 21:48:45,965 - src.pipeline.kg_builder - DEBUG - Batch 23 current_video_time: 05:39-05:44
2025-11-30 21:48:45,976 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 216
- Total Relationships: 163
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:48:45,977 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:48:45,977 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0 ~213 words, content: Time: 05:29-05:34 Content: The sequence of images captures a detailed laboratory procedure, likely a titration or a precise liquid transfer, performed by a person wearing...
2025-11-30 21:48:45,977 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1 ~220 words, content: A white bottle with a red cap, which appears to be a chemical reagent. The label is partially visible and shows hazard symbols, including a...
2025-11-30 21:48:45,977 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2 ~231 words, content: le gloves, performing a careful measurement. The person is using a pipette to transfer a liquid from a small, clear glass beaker into a larger,...
2025-11-30 21:48:45,977 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_3 ~109 words, content: pipette in their left hand and a small, clear glass beaker in their right hand. They are carefully using the pipette to draw liquid from...
2025-11-30 21:48:45,977 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:48:45,977 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0) (~213 words) with timeout=5.0s retries=3
2025-11-30 21:48:47,435 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:48:47,435 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:48:47,435 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1) (~220 words) with timeout=5.0s retries=3
2025-11-30 21:48:48,561 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:48:48,561 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:48:48,561 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2) (~231 words) with timeout=5.0s retries=3
2025-11-30 21:48:49,887 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:48:49,887 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:48:49,887 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_3) (~109 words) with timeout=5.0s retries=3
2025-11-30 21:48:51,140 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:48:51,140 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:48:51,140 - src.components.pre_llm_injector - INFO - Extracted 18 local triplets from 4 chunks
2025-11-30 21:48:51,140 - src.pipeline.kg_builder - INFO - Pre-extraction: 18 triplets in 5.16s
2025-11-30 21:48:51,140 - src.components.global_refiner - INFO - Capping refinement input: 18 → 15 triplets
2025-11-30 21:48:51,140 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 216
- Total Relationships: 163
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_3"]}, {"head": "Beaker", "relation": "Placed On", "tail": "Digital_Analytical_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0"]}, {"head": "Digital_Analytical_Balance", "relation": "Displays", "tail": "6.301_G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1"]}, {"head": "Liquid", "relation": "Is Added To", "tail": "Sample", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1"]}, {"head": "Sample", "relation": "Is Placed On", "tail": "Digital Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_3"]}, {"head": "Pipette", "relation": "Transfers Liquid To", "tail": "Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2"]}, {"head": "Digital_Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:48:51,140 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~252 words, ~328 tokens)
2025-11-30 21:48:51,140 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:49:12,373 - src.components.global_refiner - DEBUG - LLM call completed in 21.23s
2025-11-30 21:49:12,373 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2']], ['Person', 'holds', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_3']], ['Person', 'holds', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_3']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1']], ['Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1']], ['Pipette', 'transfers_liquid_to', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2']], ['Beaker', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_3']], ['Beaker', 'placed_on', 'Digital_Analytical_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0']], ['Digital_Analytical_Balance', 'displays', '6.301_G', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0']], ['Sample', 'is_placed_on', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1']], ['Digital_Balance', 'measures', 'Mass', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2']], ['Liquid', 'is_added_to', 'Sample', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1']], ['Volumetric_Flask', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2']]]
2025-11-30 21:49:12,373 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1"
    ]
  ],
  [
    "Pipette",
    "transfers_liquid_to",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_3"
    ]
  ],
  [
    "Beaker",
    "placed_on",
    "Digital_Analytical_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0"
    ]
  ],
  [
    "Digital_Analytical_Balance",
    "displays",
    "6.301_G",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_0"
    ]
  ],
  [
    "Sample",
    "is_placed_on",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Mass",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2"
    ]
  ],
  [
    "Liquid",
    "is_added_to",
    "Sample",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_1"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_22_2"
    ]
  ]
]
2025-11-30 21:49:12,373 - src.components.global_refiner - INFO - Refinement complete: 15 → 13 triplets (total: 21.23s, LLM: 21.23s)
2025-11-30 21:49:12,373 - src.pipeline.kg_builder - INFO - Global refinement: 13 triplets in 21.23s
2025-11-30 21:49:12,373 - src.pipeline.kg_builder - INFO - Using 13 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:49:12,373 - src.pipeline.kg_builder - INFO - Pushing batch 23/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:49:12,373 - src.components.neo4j_handler - INFO - Adding 13 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:49:12,583 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:49:12,583 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:49:12,584 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:49:12,584 - src.components.neo4j_handler - INFO - Batch injected in 0.21s (triplets: 0.21s, indexes: 0.00s)
2025-11-30 21:49:12,585 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 107, 'with_embedding': 0, 'linked_chunks': 76}
2025-11-30 21:49:12,585 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:49:12,612 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 223 nodes
2025-11-30 21:49:12,657 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 192 nodes
2025-11-30 21:49:12,706 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 223, 'relationship_count': 567, 'density': 0.0115, 'avg_degree': 5.0852, 'avg_unique_neighbors': 5.0493, 'global_efficiency': 0.2991, 'avg_path_length': 2.7287, 'avg_degree_centrality': 0.0229, 'max_degree_centrality': 0.4685, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.038, 'degree_assortativity': -0.1635, 'graph_robustness': 0.7954, 'diameter_estimate': 5, 'clustering_coefficient': 0.2969, 'weakly_connected_components': 32, 'largest_wcc_size': 192, 'pagerank_top10_percent': 14.67, 'louvain_communities': 41, 'louvain_modularity': 0.4455, 'label_entropy': 1.4994, 'computational_time': 0.1212672550464049}
2025-11-30 21:49:12,706 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 22, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510552.7068913, 'total_time': 26.74186402000487, 'aggregation': 2.268003299832344e-06, 'network_info': 0.01164372602943331, 'llm_extraction': 26.396884621004574, 'data_cleaning': 1.2026983313262463e-05, 'neo4j_injection': 0.21055326308123767, 'embedding_time': 0, 'indexing_time': 0.0030148120131343603, 'graph_injection_time': 0.20738217199686915, 'acs_metrics': {'node_count': 223, 'relationship_count': 567, 'density': 0.0115, 'avg_degree': 5.0852, 'avg_unique_neighbors': 5.0493, 'global_efficiency': 0.2991, 'avg_path_length': 2.7287, 'avg_degree_centrality': 0.0229, 'max_degree_centrality': 0.4685, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.038, 'degree_assortativity': -0.1635, 'graph_robustness': 0.7954, 'diameter_estimate': 5, 'clustering_coefficient': 0.2969, 'weakly_connected_components': 32, 'largest_wcc_size': 192, 'pagerank_top10_percent': 14.67, 'louvain_communities': 41, 'louvain_modularity': 0.4455, 'label_entropy': 1.4994, 'computational_time': 0.1212672550464049}, 'retrieval_queries': []}
2025-11-30 21:49:12,706 - src.pipeline.kg_builder - DEBUG - Batch 22 metrics: {
  "batch_idx": 22,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510552.7068913,
  "total_time": 26.74186402000487,
  "aggregation": 2.268003299832344e-06,
  "network_info": 0.01164372602943331,
  "llm_extraction": 26.396884621004574,
  "data_cleaning": 1.2026983313262463e-05,
  "neo4j_injection": 0.21055326308123767,
  "embedding_time": 0,
  "indexing_time": 0.0030148120131343603,
  "graph_injection_time": 0.20738217199686915,
  "acs_metrics": {
    "node_count": 223,
    "relationship_count": 567,
    "density": 0.0115,
    "avg_degree": 5.0852,
    "avg_unique_neighbors": 5.0493,
    "global_efficiency": 0.2991,
    "avg_path_length": 2.7287,
    "avg_degree_centrality": 0.0229,
    "max_degree_centrality": 0.4685,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.038,
    "degree_assortativity": -0.1635,
    "graph_robustness": 0.7954,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2969,
    "weakly_connected_components": 32,
    "largest_wcc_size": 192,
    "pagerank_top10_percent": 14.67,
    "louvain_communities": 41,
    "louvain_modularity": 0.4455,
    "label_entropy": 1.4994,
    "computational_time": 0.1212672550464049
  },
  "retrieval_queries": []
}
2025-11-30 21:49:12,707 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:49:12,707 - src.pipeline.kg_builder - INFO - Batch 23 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 26.40s, Clean: 0.00s, Neo4j: 0.21s, ACS: 0.12s
2025-11-30 21:49:12,707 - src.pipeline.kg_builder - INFO - Batch 23 completed in 26.74s
Processing KG batches:  32%|███▏      | 23/72 [08:54<20:42, 25.37s/it]2025-11-30 21:49:12,707 - src.pipeline.kg_builder - INFO - Processing batch 24/72 (3 items)
2025-11-30 21:49:12,707 - src.pipeline.kg_builder - DEBUG - Batch 24 current_video_time: 05:54-05:59
2025-11-30 21:49:12,718 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 223
- Total Relationships: 169
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:49:12,719 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:49:12,719 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0 ~213 words, content: Time: 05:44-05:49 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a precise weighing process, from a first-person perspective. The setting...
2025-11-30 21:49:12,719 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1 ~233 words, content: of the pipette and the beaker. The person's left hand, with the watch, is visible, and they are carefully controlling the flow of the liquid....
2025-11-30 21:49:12,719 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_2 ~219 words, content: added. Time: 05:49-05:54 Content: The video sequence captures a detailed laboratory procedure, likely the preparation of a solution, from a first-person perspective. The scene is...
2025-11-30 21:49:12,719 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_3 ~227 words, content: In summary, the video shows a person using a balance to accurately measure a liquid by adding it to a volumetric flask, a common technique...
2025-11-30 21:49:12,719 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_4 ~82 words, content: a window, and a cardboard box with a "小心易燃" (Caution: Flammable) warning sign. A printed document with Chinese text, likely a lab protocol, is also...
2025-11-30 21:49:12,719 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:49:12,719 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0) (~213 words) with timeout=5.0s retries=3
2025-11-30 21:49:13,966 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:49:13,966 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:49:13,966 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:49:14,999 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:49:14,999 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:49:14,999 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_2) (~219 words) with timeout=5.0s retries=3
2025-11-30 21:49:16,247 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:49:16,247 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:49:16,247 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_3) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:49:17,710 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:49:17,710 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:49:17,710 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_4) (~82 words) with timeout=5.0s retries=3
2025-11-30 21:49:18,849 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:49:18,849 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:49:18,849 - src.components.pre_llm_injector - INFO - Extracted 25 local triplets from 5 chunks
2025-11-30 21:49:18,849 - src.pipeline.kg_builder - INFO - Pre-extraction: 25 triplets in 6.13s
2025-11-30 21:49:18,849 - src.components.global_refiner - INFO - Capping refinement input: 25 → 15 triplets
2025-11-30 21:49:18,850 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 223
- Total Relationships: 169
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_2"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1"]}, {"head": "Pipette", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Negative_Weight", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0"]}, {"head": "Person", "relation": "Holds", "tail": "White Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1"]}, {"head": "White Bottle", "relation": "Has Label", "tail": "Blue Label", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1"]}, {"head": "Pipette", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1"]}, {"head": "Balance", "relation": "Displays", "tail": "Negative Weight", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_3"]}, {"head": "Person", "relation": "Holds", "tail": "Wash_Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_2"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:49:18,850 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~246 words, ~320 tokens)
2025-11-30 21:49:18,850 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:49:32,410 - src.components.global_refiner - DEBUG - LLM call completed in 13.56s
2025-11-30 21:49:32,410 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_2']], ['Person', 'holds', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1']], ['Person', 'holds', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1']], ['Pipette', 'dispenses', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0']], ['Beaker', 'is_on', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0']], ['Digital_Balance', 'displays', 'Negative_Weight', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0']], ['Person', 'holds', 'White_Bottle', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1']], ['White_Bottle', 'has_label', 'Blue_Label', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1']], ['Pipette', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1']], ['Balance', 'displays', 'Negative_Weight', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1']]]
2025-11-30 21:49:32,410 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1"
    ]
  ],
  [
    "Pipette",
    "dispenses",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Negative_Weight",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_0"
    ]
  ],
  [
    "Person",
    "holds",
    "White_Bottle",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1"
    ]
  ],
  [
    "White_Bottle",
    "has_label",
    "Blue_Label",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1"
    ]
  ],
  [
    "Pipette",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1"
    ]
  ],
  [
    "Balance",
    "displays",
    "Negative_Weight",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_23_1"
    ]
  ]
]
2025-11-30 21:49:32,410 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 13.56s, LLM: 13.56s)
2025-11-30 21:49:32,410 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 13.56s
2025-11-30 21:49:32,410 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:49:32,410 - src.pipeline.kg_builder - INFO - Pushing batch 24/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:49:32,410 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:49:32,566 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:49:32,566 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:49:32,566 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:49:32,566 - src.components.neo4j_handler - INFO - Batch injected in 0.16s (triplets: 0.15s, indexes: 0.00s)
2025-11-30 21:49:32,568 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 112, 'with_embedding': 0, 'linked_chunks': 79}
2025-11-30 21:49:32,568 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:49:32,596 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 229 nodes
2025-11-30 21:49:32,644 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 196 nodes
2025-11-30 21:49:32,697 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 229, 'relationship_count': 588, 'density': 0.0113, 'avg_degree': 5.1354, 'avg_unique_neighbors': 5.1004, 'global_efficiency': 0.2978, 'avg_path_length': 2.702, 'avg_degree_centrality': 0.0225, 'max_degree_centrality': 0.4737, 'avg_betweenness_centrality': 0.0011, 'max_betweenness_centrality': 0.0581, 'degree_assortativity': -0.1639, 'graph_robustness': 0.7976, 'diameter_estimate': 5, 'clustering_coefficient': 0.2929, 'weakly_connected_components': 34, 'largest_wcc_size': 196, 'pagerank_top10_percent': 14.25, 'louvain_communities': 44, 'louvain_modularity': 0.4301, 'label_entropy': 1.4998, 'computational_time': 0.128960159025155}
2025-11-30 21:49:32,697 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 23, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510572.6972575, 'total_time': 19.989580670022406, 'aggregation': 3.3349497243762016e-06, 'network_info': 0.01083872199524194, 'llm_extraction': 19.69202023104299, 'data_cleaning': 9.797047823667526e-06, 'neo4j_injection': 0.15616180701181293, 'embedding_time': 0, 'indexing_time': 0.0026056149508804083, 'graph_injection_time': 0.15339438198134303, 'acs_metrics': {'node_count': 229, 'relationship_count': 588, 'density': 0.0113, 'avg_degree': 5.1354, 'avg_unique_neighbors': 5.1004, 'global_efficiency': 0.2978, 'avg_path_length': 2.702, 'avg_degree_centrality': 0.0225, 'max_degree_centrality': 0.4737, 'avg_betweenness_centrality': 0.0011, 'max_betweenness_centrality': 0.0581, 'degree_assortativity': -0.1639, 'graph_robustness': 0.7976, 'diameter_estimate': 5, 'clustering_coefficient': 0.2929, 'weakly_connected_components': 34, 'largest_wcc_size': 196, 'pagerank_top10_percent': 14.25, 'louvain_communities': 44, 'louvain_modularity': 0.4301, 'label_entropy': 1.4998, 'computational_time': 0.128960159025155}, 'retrieval_queries': []}
2025-11-30 21:49:32,697 - src.pipeline.kg_builder - DEBUG - Batch 23 metrics: {
  "batch_idx": 23,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510572.6972575,
  "total_time": 19.989580670022406,
  "aggregation": 3.3349497243762016e-06,
  "network_info": 0.01083872199524194,
  "llm_extraction": 19.69202023104299,
  "data_cleaning": 9.797047823667526e-06,
  "neo4j_injection": 0.15616180701181293,
  "embedding_time": 0,
  "indexing_time": 0.0026056149508804083,
  "graph_injection_time": 0.15339438198134303,
  "acs_metrics": {
    "node_count": 229,
    "relationship_count": 588,
    "density": 0.0113,
    "avg_degree": 5.1354,
    "avg_unique_neighbors": 5.1004,
    "global_efficiency": 0.2978,
    "avg_path_length": 2.702,
    "avg_degree_centrality": 0.0225,
    "max_degree_centrality": 0.4737,
    "avg_betweenness_centrality": 0.0011,
    "max_betweenness_centrality": 0.0581,
    "degree_assortativity": -0.1639,
    "graph_robustness": 0.7976,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2929,
    "weakly_connected_components": 34,
    "largest_wcc_size": 196,
    "pagerank_top10_percent": 14.25,
    "louvain_communities": 44,
    "louvain_modularity": 0.4301,
    "label_entropy": 1.4998,
    "computational_time": 0.128960159025155
  },
  "retrieval_queries": []
}
2025-11-30 21:49:32,697 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:49:32,698 - src.pipeline.kg_builder - INFO - Batch 24 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.69s, Clean: 0.00s, Neo4j: 0.16s, ACS: 0.13s
2025-11-30 21:49:32,698 - src.pipeline.kg_builder - INFO - Batch 24 completed in 19.99s
Processing KG batches:  33%|███▎      | 24/72 [09:14<19:00, 23.75s/it]2025-11-30 21:49:32,698 - src.pipeline.kg_builder - INFO - Processing batch 25/72 (3 items)
2025-11-30 21:49:32,698 - src.pipeline.kg_builder - DEBUG - Batch 25 current_video_time: 06:09-06:14
2025-11-30 21:49:32,708 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 229
- Total Relationships: 175
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:49:32,709 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:49:32,709 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0 ~224 words, content: Time: 05:59-06:04 Content: The video sequence captures a first-person perspective of a laboratory procedure, likely a titration or solution preparation, taking place on a black...
2025-11-30 21:49:32,709 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1 ~229 words, content: - **Other Objects:** A white bottle with a red cap, likely containing a chemical reagent, sits on the bench. A printed document with Chinese text,...
2025-11-30 21:49:32,709 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_2 ~226 words, content: On the table, there is a white bottle with a red cap, a box of aluminum foil, a pen, and a document with handwritten notes....
2025-11-30 21:49:32,709 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_3 ~234 words, content: overall atmosphere suggests a methodical and careful approach to the experiment. In summary, the video depicts a detailed and precise laboratory procedure, likely involving the...
2025-11-30 21:49:32,709 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_4 ~28 words, content: liquid level in the volumetric flask is accurate. The camera remains relatively stable, focusing on the hand and the flask, with slight movements that follow...
2025-11-30 21:49:32,709 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:49:32,709 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:49:34,062 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:49:34,062 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:49:34,062 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:49:35,229 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:49:35,229 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:49:35,229 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_2) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:49:40,235 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 21:49:45,740 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 2/4), retrying...
2025-11-30 21:49:51,747 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 3/4), retrying...
2025-11-30 21:49:58,255 - src.components.pre_llm_injector - WARNING - ⚠️ Chunk 2 TIMED OUT after 5.0s on final attempt. Skipping.
2025-11-30 21:49:58,255 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 0 triplets
2025-11-30 21:49:58,256 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_3) (~234 words) with timeout=5.0s retries=3
2025-11-30 21:49:59,625 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:49:59,625 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:49:59,625 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_4) (~28 words) with timeout=5.0s retries=3
2025-11-30 21:50:00,650 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:50:00,650 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:50:00,650 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 5 chunks
2025-11-30 21:50:00,650 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 27.94s
2025-11-30 21:50:00,650 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 21:50:00,650 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 229
- Total Relationships: 175
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0"]}, {"head": "Person", "relation": "Wears", "tail": "Gold_Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_3"]}, {"head": "Person", "relation": "Uses", "tail": "Squeeze_Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0"]}, {"head": "Digital_Analytical_Balance", "relation": "Measures", "tail": "Mass_Of_Contents", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0"]}, {"head": "Person", "relation": "Holds", "tail": "Squeeze Bottle", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1"]}, {"head": "Squeeze Bottle", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1"]}, {"head": "Liquid", "relation": "Enters", "tail": "Volumetric Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1"]}, {"head": "Person", "relation": "Uses", "tail": "Digital Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1"]}, {"head": "Volumetric Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1"]}, {"head": "Person", "relation": "Lifts", "tail": "Volumetric Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_3"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_3"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:50:00,650 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~242 words, ~315 tokens)
2025-11-30 21:50:00,650 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:50:13,024 - src.components.global_refiner - DEBUG - LLM call completed in 12.37s
2025-11-30 21:50:13,024 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0']], ['Person', 'wears', 'Gold_Watch', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0']], ['Person', 'holds', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_3']], ['Person', 'uses', 'Squeeze_Bottle', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0']], ['Volumetric_Flask', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0']], ['Digital_Analytical_Balance', 'measures', 'Mass_Of_Contents', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0']], ['Person', 'holds', 'Squeeze_Bottle', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1']], ['Squeeze_Bottle', 'dispenses', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1']], ['Liquid', 'enters', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1']], ['Person', 'uses', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1']]]
2025-11-30 21:50:13,024 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Gold_Watch",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Squeeze_Bottle",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0"
    ]
  ],
  [
    "Digital_Analytical_Balance",
    "measures",
    "Mass_Of_Contents",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Squeeze_Bottle",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1"
    ]
  ],
  [
    "Squeeze_Bottle",
    "dispenses",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1"
    ]
  ],
  [
    "Liquid",
    "enters",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_24_1"
    ]
  ]
]
2025-11-30 21:50:13,024 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 12.37s, LLM: 12.37s)
2025-11-30 21:50:13,024 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 12.37s
2025-11-30 21:50:13,024 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:50:13,024 - src.pipeline.kg_builder - INFO - Pushing batch 25/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:50:13,024 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:50:13,170 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:50:13,171 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:50:13,171 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:50:13,171 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.14s, indexes: 0.00s)
2025-11-30 21:50:13,172 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 117, 'with_embedding': 0, 'linked_chunks': 82}
2025-11-30 21:50:13,172 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:50:13,192 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 237 nodes
2025-11-30 21:50:13,233 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 202 nodes
2025-11-30 21:50:13,288 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 237, 'relationship_count': 609, 'density': 0.0109, 'avg_degree': 5.1392, 'avg_unique_neighbors': 5.097, 'global_efficiency': 0.2965, 'avg_path_length': 2.6881, 'avg_degree_centrality': 0.0218, 'max_degree_centrality': 0.4873, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0403, 'degree_assortativity': -0.1768, 'graph_robustness': 0.798, 'diameter_estimate': 5, 'clustering_coefficient': 0.2963, 'weakly_connected_components': 36, 'largest_wcc_size': 202, 'pagerank_top10_percent': 13.81, 'louvain_communities': 46, 'louvain_modularity': 0.4222, 'label_entropy': 1.4999, 'computational_time': 0.11654511198867112}
2025-11-30 21:50:13,289 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 24, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510613.2890017, 'total_time': 40.59079327492509, 'aggregation': 2.391054295003414e-06, 'network_info': 0.010493191075511277, 'llm_extraction': 40.31549133500084, 'data_cleaning': 1.108401920646429e-05, 'neo4j_injection': 0.14691655791830271, 'embedding_time': 0, 'indexing_time': 0.004101898986846209, 'graph_injection_time': 0.14266694302204996, 'acs_metrics': {'node_count': 237, 'relationship_count': 609, 'density': 0.0109, 'avg_degree': 5.1392, 'avg_unique_neighbors': 5.097, 'global_efficiency': 0.2965, 'avg_path_length': 2.6881, 'avg_degree_centrality': 0.0218, 'max_degree_centrality': 0.4873, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0403, 'degree_assortativity': -0.1768, 'graph_robustness': 0.798, 'diameter_estimate': 5, 'clustering_coefficient': 0.2963, 'weakly_connected_components': 36, 'largest_wcc_size': 202, 'pagerank_top10_percent': 13.81, 'louvain_communities': 46, 'louvain_modularity': 0.4222, 'label_entropy': 1.4999, 'computational_time': 0.11654511198867112}, 'retrieval_queries': []}
2025-11-30 21:50:13,289 - src.pipeline.kg_builder - DEBUG - Batch 24 metrics: {
  "batch_idx": 24,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510613.2890017,
  "total_time": 40.59079327492509,
  "aggregation": 2.391054295003414e-06,
  "network_info": 0.010493191075511277,
  "llm_extraction": 40.31549133500084,
  "data_cleaning": 1.108401920646429e-05,
  "neo4j_injection": 0.14691655791830271,
  "embedding_time": 0,
  "indexing_time": 0.004101898986846209,
  "graph_injection_time": 0.14266694302204996,
  "acs_metrics": {
    "node_count": 237,
    "relationship_count": 609,
    "density": 0.0109,
    "avg_degree": 5.1392,
    "avg_unique_neighbors": 5.097,
    "global_efficiency": 0.2965,
    "avg_path_length": 2.6881,
    "avg_degree_centrality": 0.0218,
    "max_degree_centrality": 0.4873,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.0403,
    "degree_assortativity": -0.1768,
    "graph_robustness": 0.798,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2963,
    "weakly_connected_components": 36,
    "largest_wcc_size": 202,
    "pagerank_top10_percent": 13.81,
    "louvain_communities": 46,
    "louvain_modularity": 0.4222,
    "label_entropy": 1.4999,
    "computational_time": 0.11654511198867112
  },
  "retrieval_queries": []
}
2025-11-30 21:50:13,289 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:50:13,289 - src.pipeline.kg_builder - INFO - Batch 25 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 40.32s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.12s
2025-11-30 21:50:13,289 - src.pipeline.kg_builder - INFO - Batch 25 completed in 40.59s
Processing KG batches:  35%|███▍      | 25/72 [09:54<22:33, 28.81s/it]2025-11-30 21:50:13,289 - src.pipeline.kg_builder - INFO - Processing batch 26/72 (3 items)
2025-11-30 21:50:13,289 - src.pipeline.kg_builder - DEBUG - Batch 26 current_video_time: 06:24-06:29
2025-11-30 21:50:13,301 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 237
- Total Relationships: 183
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:50:13,301 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:50:13,301 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0 ~202 words, content: Time: 06:14-06:19 Content: The video captures a close-up, first-person perspective of a laboratory procedure, likely the preparation of a solution. The scene is set in...
2025-11-30 21:50:13,301 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1 ~209 words, content: reaction is complete. - **Balance:** A digital analytical balance is visible in the background, which is used for precise weighing of chemicals. - **Chemical Containers:**...
2025-11-30 21:50:13,301 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_2 ~242 words, content: laboratory setting. The frames show a person, wearing a blue nitrile glove, handling laboratory equipment with precision. - **In the first four frames**, the focus...
2025-11-30 21:50:13,301 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_3 ~238 words, content: flask, likely as part of a chemical experiment. The sequence transitions from a close-up of the precise action to a wider shot of the laboratory,...
2025-11-30 21:50:13,301 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_4 ~249 words, content: background includes a cabinet with various items, and the overall environment remains consistent with a laboratory setting. - In the third frame, the camera angle...
2025-11-30 21:50:13,301 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_5 ~214 words, content: - In the final frame, the camera angle changes to show a different part of the laboratory. The balance scale is still visible, but now...
2025-11-30 21:50:13,301 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:50:13,301 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0) (~202 words) with timeout=5.0s retries=3
2025-11-30 21:50:14,768 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:50:14,768 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:50:14,769 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1) (~209 words) with timeout=5.0s retries=3
2025-11-30 21:50:16,283 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:50:16,283 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:50:16,284 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_2) (~242 words) with timeout=5.0s retries=3
2025-11-30 21:50:17,725 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:50:17,725 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:50:17,726 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_3) (~238 words) with timeout=5.0s retries=3
2025-11-30 21:50:18,828 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:50:18,828 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:50:18,829 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_4) (~249 words) with timeout=5.0s retries=3
2025-11-30 21:50:19,978 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:50:19,978 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:50:19,978 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_5) (~214 words) with timeout=5.0s retries=3
2025-11-30 21:50:21,078 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:50:21,078 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:50:21,078 - src.components.pre_llm_injector - INFO - Extracted 30 local triplets from 6 chunks
2025-11-30 21:50:21,078 - src.pipeline.kg_builder - INFO - Pre-extraction: 30 triplets in 7.78s
2025-11-30 21:50:21,079 - src.components.global_refiner - INFO - Capping refinement input: 30 → 15 triplets
2025-11-30 21:50:21,079 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 237
- Total Relationships: 183
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_2"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_2"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_2"]}, {"head": "Burette", "relation": "Dispenses", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0"]}, {"head": "Burette", "relation": "Is Above", "tail": "Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1"]}, {"head": "Digital Analytical Balance", "relation": "Is Used For", "tail": "Precise Weighing", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1"]}, {"head": "White Bottle", "relation": "Has Label", "tail": "Corrosive Hazard Symbol", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1"]}, {"head": "Volumetric Flask", "relation": "Receives", "tail": "Liquid From Burette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Glass Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Pen", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1"]}, {"head": "Person", "relation": "Uses", "tail": "Laboratory_Bench", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_2"]}, {"head": "Laboratory_Bench", "relation": "Contains", "tail": "Digital_Scale", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_2"]}, {"head": "Laboratory_Bench", "relation": "Contains", "tail": "Magnetic_Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:50:21,079 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~256 words, ~333 tokens)
2025-11-30 21:50:21,079 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:50:35,370 - src.components.global_refiner - DEBUG - LLM call completed in 14.29s
2025-11-30 21:50:35,370 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Glove', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_2']], ['Person', 'holds', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_2']], ['Volumetric_Flask', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_2']], ['Burette', 'dispenses', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0']], ['Burette', 'is_above', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0']], ['Person', 'wears', 'Watch', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0']], ['Digital_Analytical_Balance', 'is_used_for', 'Precise_Weighing', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1']], ['White_Bottle', 'has_label', 'Corrosive_Hazard_Symbol', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1']], ['Volumetric_Flask', 'receives', 'Liquid_From_Burette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1']], ['Lab_Table', 'contains', 'Glass_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1']]]
2025-11-30 21:50:35,370 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Glove",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_2"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_2"
    ]
  ],
  [
    "Burette",
    "dispenses",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0"
    ]
  ],
  [
    "Burette",
    "is_above",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_0"
    ]
  ],
  [
    "Digital_Analytical_Balance",
    "is_used_for",
    "Precise_Weighing",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1"
    ]
  ],
  [
    "White_Bottle",
    "has_label",
    "Corrosive_Hazard_Symbol",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1"
    ]
  ],
  [
    "Volumetric_Flask",
    "receives",
    "Liquid_From_Burette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1"
    ]
  ],
  [
    "Lab_Table",
    "contains",
    "Glass_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_25_1"
    ]
  ]
]
2025-11-30 21:50:35,370 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 14.29s, LLM: 14.29s)
2025-11-30 21:50:35,370 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 14.29s
2025-11-30 21:50:35,370 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:50:35,371 - src.pipeline.kg_builder - INFO - Pushing batch 26/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:50:35,371 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:50:35,520 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:50:35,520 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:50:35,520 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:50:35,520 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.15s, indexes: 0.00s)
2025-11-30 21:50:35,522 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 123, 'with_embedding': 0, 'linked_chunks': 85}
2025-11-30 21:50:35,522 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:50:35,542 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 247 nodes
2025-11-30 21:50:35,586 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 209 nodes
2025-11-30 21:50:35,644 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 247, 'relationship_count': 634, 'density': 0.0104, 'avg_degree': 5.1336, 'avg_unique_neighbors': 5.0931, 'global_efficiency': 0.2903, 'avg_path_length': 2.7056, 'avg_degree_centrality': 0.0209, 'max_degree_centrality': 0.4756, 'avg_betweenness_centrality': 0.0009, 'max_betweenness_centrality': 0.0512, 'degree_assortativity': -0.1801, 'graph_robustness': 0.8044, 'diameter_estimate': 5, 'clustering_coefficient': 0.2924, 'weakly_connected_components': 39, 'largest_wcc_size': 209, 'pagerank_top10_percent': 13.37, 'louvain_communities': 49, 'louvain_modularity': 0.4231, 'label_entropy': 1.5, 'computational_time': 0.12213724001776427}
2025-11-30 21:50:35,644 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 25, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510635.6444004, 'total_time': 22.35459867399186, 'aggregation': 2.440996468067169e-06, 'network_info': 0.011101139010861516, 'llm_extraction': 22.06992499693297, 'data_cleaning': 1.1131982319056988e-05, 'neo4j_injection': 0.14964477403555065, 'embedding_time': 0, 'indexing_time': 0.0032987289596349, 'graph_injection_time': 0.14620959502644837, 'acs_metrics': {'node_count': 247, 'relationship_count': 634, 'density': 0.0104, 'avg_degree': 5.1336, 'avg_unique_neighbors': 5.0931, 'global_efficiency': 0.2903, 'avg_path_length': 2.7056, 'avg_degree_centrality': 0.0209, 'max_degree_centrality': 0.4756, 'avg_betweenness_centrality': 0.0009, 'max_betweenness_centrality': 0.0512, 'degree_assortativity': -0.1801, 'graph_robustness': 0.8044, 'diameter_estimate': 5, 'clustering_coefficient': 0.2924, 'weakly_connected_components': 39, 'largest_wcc_size': 209, 'pagerank_top10_percent': 13.37, 'louvain_communities': 49, 'louvain_modularity': 0.4231, 'label_entropy': 1.5, 'computational_time': 0.12213724001776427}, 'retrieval_queries': []}
2025-11-30 21:50:35,644 - src.pipeline.kg_builder - DEBUG - Batch 25 metrics: {
  "batch_idx": 25,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510635.6444004,
  "total_time": 22.35459867399186,
  "aggregation": 2.440996468067169e-06,
  "network_info": 0.011101139010861516,
  "llm_extraction": 22.06992499693297,
  "data_cleaning": 1.1131982319056988e-05,
  "neo4j_injection": 0.14964477403555065,
  "embedding_time": 0,
  "indexing_time": 0.0032987289596349,
  "graph_injection_time": 0.14620959502644837,
  "acs_metrics": {
    "node_count": 247,
    "relationship_count": 634,
    "density": 0.0104,
    "avg_degree": 5.1336,
    "avg_unique_neighbors": 5.0931,
    "global_efficiency": 0.2903,
    "avg_path_length": 2.7056,
    "avg_degree_centrality": 0.0209,
    "max_degree_centrality": 0.4756,
    "avg_betweenness_centrality": 0.0009,
    "max_betweenness_centrality": 0.0512,
    "degree_assortativity": -0.1801,
    "graph_robustness": 0.8044,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2924,
    "weakly_connected_components": 39,
    "largest_wcc_size": 209,
    "pagerank_top10_percent": 13.37,
    "louvain_communities": 49,
    "louvain_modularity": 0.4231,
    "label_entropy": 1.5,
    "computational_time": 0.12213724001776427
  },
  "retrieval_queries": []
}
2025-11-30 21:50:35,645 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:50:35,645 - src.pipeline.kg_builder - INFO - Batch 26 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 22.07s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.12s
2025-11-30 21:50:35,645 - src.pipeline.kg_builder - INFO - Batch 26 completed in 22.35s
Processing KG batches:  36%|███▌      | 26/72 [10:17<20:36, 26.87s/it]2025-11-30 21:50:35,645 - src.pipeline.kg_builder - INFO - Processing batch 27/72 (3 items)
2025-11-30 21:50:35,645 - src.pipeline.kg_builder - DEBUG - Batch 27 current_video_time: 06:39-06:44
2025-11-30 21:50:35,658 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 247
- Total Relationships: 190
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:50:35,658 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:50:35,658 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0 ~229 words, content: Time: 06:29-06:34 Content: The sequence of images captures a laboratory procedure, likely the preparation of a chemical solution. The scene is set on a black...
2025-11-30 21:50:35,658 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1 ~225 words, content: is being added to a container that is already on the balance. The overall context implies that a precise amount of a chemical is being...
2025-11-30 21:50:35,658 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_2 ~224 words, content: , is positioned nearby, indicating that the solution is being weighed as part of the process. The person's left wrist, adorned with a watch, is...
2025-11-30 21:50:35,658 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_3 ~145 words, content: This flask, which has a long neck and a flat bottom, is already partially filled with a clear liquid. The person is using the pipette...
2025-11-30 21:50:35,658 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:50:35,659 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:50:36,824 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:50:36,824 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:50:36,824 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:50:38,216 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:50:38,216 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:50:38,216 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_2) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:50:39,608 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:50:39,608 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:50:39,608 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_3) (~145 words) with timeout=5.0s retries=3
2025-11-30 21:50:40,707 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:50:40,708 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:50:40,708 - src.components.pre_llm_injector - INFO - Extracted 21 local triplets from 4 chunks
2025-11-30 21:50:40,708 - src.pipeline.kg_builder - INFO - Pre-extraction: 21 triplets in 5.05s
2025-11-30 21:50:40,708 - src.components.global_refiner - INFO - Capping refinement input: 21 → 15 triplets
2025-11-30 21:50:40,708 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 247
- Total Relationships: 190
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_2"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0"]}, {"head": "Person", "relation": "Adds", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_3"]}, {"head": "Balance", "relation": "Displays", "tail": "Negative_Mass", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Magnetic_Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1"]}, {"head": "Person", "relation": "Uses", "tail": "Glass_Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1"]}, {"head": "Glass_Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1"]}, {"head": "Liquid", "relation": "Is Added To", "tail": "Glass_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Weight_Measurement", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_2"]}, {"head": "Pipette", "relation": "Is Inside", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_2"]}, {"head": "Beaker", "relation": "Is Transferred To", "tail": "Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:50:40,708 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~244 words, ~317 tokens)
2025-11-30 21:50:40,708 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:50:54,366 - src.components.global_refiner - DEBUG - LLM call completed in 13.66s
2025-11-30 21:50:54,366 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_2']], ['Person', 'holds', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0']], ['Person', 'adds', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0']], ['Beaker', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_3']], ['Balance', 'displays', 'Negative_Mass', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0']], ['Beaker', 'is_on', 'Magnetic_Stirrer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0']], ['Person', 'holds', 'Glass_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1']], ['Person', 'uses', 'Glass_Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1']], ['Glass_Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1']], ['Liquid', 'is_added_to', 'Glass_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1']]]
2025-11-30 21:50:54,366 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0"
    ]
  ],
  [
    "Person",
    "adds",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_3"
    ]
  ],
  [
    "Balance",
    "displays",
    "Negative_Mass",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Magnetic_Stirrer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Glass_Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1"
    ]
  ],
  [
    "Glass_Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1"
    ]
  ],
  [
    "Liquid",
    "is_added_to",
    "Glass_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_26_1"
    ]
  ]
]
2025-11-30 21:50:54,366 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 13.66s, LLM: 13.66s)
2025-11-30 21:50:54,366 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 13.66s
2025-11-30 21:50:54,366 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:50:54,366 - src.pipeline.kg_builder - INFO - Pushing batch 27/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:50:54,367 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:50:54,581 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:50:54,581 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:50:54,581 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:50:54,581 - src.components.neo4j_handler - INFO - Batch injected in 0.21s (triplets: 0.21s, indexes: 0.00s)
2025-11-30 21:50:54,583 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 127, 'with_embedding': 0, 'linked_chunks': 89}
2025-11-30 21:50:54,583 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:50:54,614 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 252 nodes
2025-11-30 21:50:54,719 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 214 nodes
2025-11-30 21:50:54,779 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 252, 'relationship_count': 654, 'density': 0.0103, 'avg_degree': 5.1905, 'avg_unique_neighbors': 5.1429, 'global_efficiency': 0.2927, 'avg_path_length': 2.7006, 'avg_degree_centrality': 0.0207, 'max_degree_centrality': 0.4781, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0424, 'degree_assortativity': -0.1786, 'graph_robustness': 0.792, 'diameter_estimate': 5, 'clustering_coefficient': 0.2971, 'weakly_connected_components': 39, 'largest_wcc_size': 214, 'pagerank_top10_percent': 13.16, 'louvain_communities': 49, 'louvain_modularity': 0.421, 'label_entropy': 1.5, 'computational_time': 0.1963180520106107}
2025-11-30 21:50:54,779 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 26, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510654.7795885, 'total_time': 19.134345517959446, 'aggregation': 2.3890752345323563e-06, 'network_info': 0.01288359402678907, 'llm_extraction': 18.70867405901663, 'data_cleaning': 1.0108924470841885e-05, 'neo4j_injection': 0.2149652459193021, 'embedding_time': 0, 'indexing_time': 0.0035788429668173194, 'graph_injection_time': 0.21122876892331988, 'acs_metrics': {'node_count': 252, 'relationship_count': 654, 'density': 0.0103, 'avg_degree': 5.1905, 'avg_unique_neighbors': 5.1429, 'global_efficiency': 0.2927, 'avg_path_length': 2.7006, 'avg_degree_centrality': 0.0207, 'max_degree_centrality': 0.4781, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0424, 'degree_assortativity': -0.1786, 'graph_robustness': 0.792, 'diameter_estimate': 5, 'clustering_coefficient': 0.2971, 'weakly_connected_components': 39, 'largest_wcc_size': 214, 'pagerank_top10_percent': 13.16, 'louvain_communities': 49, 'louvain_modularity': 0.421, 'label_entropy': 1.5, 'computational_time': 0.1963180520106107}, 'retrieval_queries': []}
2025-11-30 21:50:54,779 - src.pipeline.kg_builder - DEBUG - Batch 26 metrics: {
  "batch_idx": 26,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510654.7795885,
  "total_time": 19.134345517959446,
  "aggregation": 2.3890752345323563e-06,
  "network_info": 0.01288359402678907,
  "llm_extraction": 18.70867405901663,
  "data_cleaning": 1.0108924470841885e-05,
  "neo4j_injection": 0.2149652459193021,
  "embedding_time": 0,
  "indexing_time": 0.0035788429668173194,
  "graph_injection_time": 0.21122876892331988,
  "acs_metrics": {
    "node_count": 252,
    "relationship_count": 654,
    "density": 0.0103,
    "avg_degree": 5.1905,
    "avg_unique_neighbors": 5.1429,
    "global_efficiency": 0.2927,
    "avg_path_length": 2.7006,
    "avg_degree_centrality": 0.0207,
    "max_degree_centrality": 0.4781,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.0424,
    "degree_assortativity": -0.1786,
    "graph_robustness": 0.792,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2971,
    "weakly_connected_components": 39,
    "largest_wcc_size": 214,
    "pagerank_top10_percent": 13.16,
    "louvain_communities": 49,
    "louvain_modularity": 0.421,
    "label_entropy": 1.5,
    "computational_time": 0.1963180520106107
  },
  "retrieval_queries": []
}
2025-11-30 21:50:54,780 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:50:54,780 - src.pipeline.kg_builder - INFO - Batch 27 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 18.71s, Clean: 0.00s, Neo4j: 0.21s, ACS: 0.20s
2025-11-30 21:50:54,780 - src.pipeline.kg_builder - INFO - Batch 27 completed in 19.13s
Processing KG batches:  38%|███▊      | 27/72 [10:36<18:24, 24.55s/it]2025-11-30 21:50:54,780 - src.pipeline.kg_builder - INFO - Processing batch 28/72 (3 items)
2025-11-30 21:50:54,780 - src.pipeline.kg_builder - DEBUG - Batch 28 current_video_time: 06:54-06:59
2025-11-30 21:50:54,791 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 252
- Total Relationships: 195
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:50:54,791 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:50:54,792 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0 ~224 words, content: Time: 06:44-06:49 Content: The video captures a sequence of actions in a laboratory setting, focusing on the preparation of a chemical solution. The scene is...
2025-11-30 21:50:54,792 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1 ~227 words, content: the table, which appears to be a reagent vial, and hold it in their right hand. The Erlenmeyer flask, now containing the transferred liquid, remains...
2025-11-30 21:50:54,792 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2 ~243 words, content: , working at a large black lab bench. The digital balance is prominently featured in the foreground, with its display showing a negative reading, which...
2025-11-30 21:50:54,792 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_3 ~233 words, content: adding a substance to the container, possibly to achieve a specific concentration or to prepare a solution. The surrounding lab environment remains unchanged, with various...
2025-11-30 21:50:54,792 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_4 ~241 words, content: Action Sequence:** The person carefully places the glass flask onto the balance. The digital display on the balance shows a reading of -56.302 g, which...
2025-11-30 21:50:54,792 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_5 ~28 words, content: laboratory setting, emphasizing the importance of precision and safety in scientific experiments. The person's actions are deliberate and careful, highlighting the attention to detail required...
2025-11-30 21:50:54,792 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:50:54,792 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:50:56,209 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:50:56,209 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:50:56,209 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:50:57,339 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:50:57,339 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:50:57,339 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2) (~243 words) with timeout=5.0s retries=3
2025-11-30 21:50:58,388 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:50:58,388 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:50:58,388 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_3) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:50:59,958 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:50:59,959 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:50:59,959 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_4) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:51:01,189 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:51:01,189 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:51:01,189 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_5) (~28 words) with timeout=5.0s retries=3
2025-11-30 21:51:02,143 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:51:02,143 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:51:02,143 - src.components.pre_llm_injector - INFO - Extracted 34 local triplets from 6 chunks
2025-11-30 21:51:02,143 - src.pipeline.kg_builder - INFO - Pre-extraction: 34 triplets in 7.35s
2025-11-30 21:51:02,143 - src.components.global_refiner - INFO - Capping refinement input: 34 → 15 triplets
2025-11-30 21:51:02,143 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 252
- Total Relationships: 195
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0"]}, {"head": "Person", "relation": "Holds", "tail": "Erlenmeyer_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0"]}, {"head": "Erlenmeyer_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0"]}, {"head": "Person", "relation": "Holds", "tail": "Reagent_Vial", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0"]}, {"head": "Person", "relation": "Holds", "tail": "Reagent Vial", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1"]}, {"head": "Person", "relation": "Holds", "tail": "Erlenmeyer Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1"]}, {"head": "Erlenmeyer Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Digital Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1"]}, {"head": "Person", "relation": "Handles", "tail": "Glass Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2"]}, {"head": "Glass Container", "relation": "Is Placed On", "tail": "Digital Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "Negative Reading", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2"]}, {"head": "Glass Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:51:02,143 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~250 words, ~325 tokens)
2025-11-30 21:51:02,143 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:51:19,449 - src.components.global_refiner - DEBUG - LLM call completed in 17.31s
2025-11-30 21:51:19,449 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0']], ['Person', 'holds', 'Erlenmeyer_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0']], ['Erlenmeyer_Flask', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2']], ['Pipette', 'transfers', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0']], ['Person', 'holds', 'Reagent_Vial', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1']], ['Erlenmeyer_Flask', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1']], ['Person', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1']], ['Lab_Bench', 'contains', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1']], ['Person', 'handles', 'Glass_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2']], ['Glass_Container', 'is_placed_on', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2']], ['Digital_Balance', 'displays', 'Negative_Reading', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2']], ['Glass_Container', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2']]]
2025-11-30 21:51:19,449 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Erlenmeyer_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0"
    ]
  ],
  [
    "Erlenmeyer_Flask",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Reagent_Vial",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1"
    ]
  ],
  [
    "Erlenmeyer_Flask",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_1"
    ]
  ],
  [
    "Person",
    "handles",
    "Glass_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2"
    ]
  ],
  [
    "Glass_Container",
    "is_placed_on",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Negative_Reading",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2"
    ]
  ],
  [
    "Glass_Container",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_27_2"
    ]
  ]
]
2025-11-30 21:51:19,449 - src.components.global_refiner - INFO - Refinement complete: 15 → 13 triplets (total: 17.31s, LLM: 17.31s)
2025-11-30 21:51:19,449 - src.pipeline.kg_builder - INFO - Global refinement: 13 triplets in 17.31s
2025-11-30 21:51:19,449 - src.pipeline.kg_builder - INFO - Using 13 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:51:19,449 - src.pipeline.kg_builder - INFO - Pushing batch 28/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:51:19,449 - src.components.neo4j_handler - INFO - Adding 13 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:51:19,603 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:51:19,603 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:51:19,603 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:51:19,603 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.15s, indexes: 0.00s)
2025-11-30 21:51:19,604 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 133, 'with_embedding': 0, 'linked_chunks': 92}
2025-11-30 21:51:19,604 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:51:19,637 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 261 nodes
2025-11-30 21:51:19,692 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 220 nodes
2025-11-30 21:51:19,759 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 261, 'relationship_count': 681, 'density': 0.01, 'avg_degree': 5.2184, 'avg_unique_neighbors': 5.1724, 'global_efficiency': 0.2901, 'avg_path_length': 2.6823, 'avg_degree_centrality': 0.0201, 'max_degree_centrality': 0.4846, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0427, 'degree_assortativity': -0.1962, 'graph_robustness': 0.859, 'diameter_estimate': 5, 'clustering_coefficient': 0.2928, 'weakly_connected_components': 42, 'largest_wcc_size': 220, 'pagerank_top10_percent': 12.74, 'louvain_communities': 52, 'louvain_modularity': 0.4264, 'label_entropy': 1.4999, 'computational_time': 0.1548188729211688}
2025-11-30 21:51:19,759 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 27, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510679.7596066, 'total_time': 24.97916292201262, 'aggregation': 2.2370368242263794e-06, 'network_info': 0.010933503974229097, 'llm_extraction': 24.65785943798255, 'data_cleaning': 1.0954099707305431e-05, 'neo4j_injection': 0.15400742390193045, 'embedding_time': 0, 'indexing_time': 0.0025777359260246158, 'graph_injection_time': 0.15128425601869822, 'acs_metrics': {'node_count': 261, 'relationship_count': 681, 'density': 0.01, 'avg_degree': 5.2184, 'avg_unique_neighbors': 5.1724, 'global_efficiency': 0.2901, 'avg_path_length': 2.6823, 'avg_degree_centrality': 0.0201, 'max_degree_centrality': 0.4846, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0427, 'degree_assortativity': -0.1962, 'graph_robustness': 0.859, 'diameter_estimate': 5, 'clustering_coefficient': 0.2928, 'weakly_connected_components': 42, 'largest_wcc_size': 220, 'pagerank_top10_percent': 12.74, 'louvain_communities': 52, 'louvain_modularity': 0.4264, 'label_entropy': 1.4999, 'computational_time': 0.1548188729211688}, 'retrieval_queries': []}
2025-11-30 21:51:19,759 - src.pipeline.kg_builder - DEBUG - Batch 27 metrics: {
  "batch_idx": 27,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510679.7596066,
  "total_time": 24.97916292201262,
  "aggregation": 2.2370368242263794e-06,
  "network_info": 0.010933503974229097,
  "llm_extraction": 24.65785943798255,
  "data_cleaning": 1.0954099707305431e-05,
  "neo4j_injection": 0.15400742390193045,
  "embedding_time": 0,
  "indexing_time": 0.0025777359260246158,
  "graph_injection_time": 0.15128425601869822,
  "acs_metrics": {
    "node_count": 261,
    "relationship_count": 681,
    "density": 0.01,
    "avg_degree": 5.2184,
    "avg_unique_neighbors": 5.1724,
    "global_efficiency": 0.2901,
    "avg_path_length": 2.6823,
    "avg_degree_centrality": 0.0201,
    "max_degree_centrality": 0.4846,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.0427,
    "degree_assortativity": -0.1962,
    "graph_robustness": 0.859,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2928,
    "weakly_connected_components": 42,
    "largest_wcc_size": 220,
    "pagerank_top10_percent": 12.74,
    "louvain_communities": 52,
    "louvain_modularity": 0.4264,
    "label_entropy": 1.4999,
    "computational_time": 0.1548188729211688
  },
  "retrieval_queries": []
}
2025-11-30 21:51:19,760 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:51:19,760 - src.pipeline.kg_builder - INFO - Batch 28 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 24.66s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.15s
2025-11-30 21:51:19,760 - src.pipeline.kg_builder - INFO - Batch 28 completed in 24.98s
Processing KG batches:  39%|███▉      | 28/72 [11:01<18:05, 24.68s/it]2025-11-30 21:51:19,760 - src.pipeline.kg_builder - INFO - Processing batch 29/72 (3 items)
2025-11-30 21:51:19,760 - src.pipeline.kg_builder - DEBUG - Batch 29 current_video_time: 07:08-07:13
2025-11-30 21:51:19,772 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 261
- Total Relationships: 203
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:51:19,773 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:51:19,773 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0 ~226 words, content: Time: 06:59-07:03 Content: The sequence of frames captures a person in a laboratory setting performing a precise task, likely related to preparing a chemical solution....
2025-11-30 21:51:19,773 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1 ~225 words, content: the Seal (Frame 4):** The person continues to hold the flask, now with the stopper fully in place. They are likely in the process of...
2025-11-30 21:51:19,773 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_2 ~226 words, content: the person holding a glass volumetric flask, which is a piece of laboratory glassware used to prepare a solution of precise concentration. The flask is...
2025-11-30 21:51:19,773 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_3 ~227 words, content: . In summary, the video shows a person in a lab, wearing protective gloves, preparing a solution by carefully adding a liquid to a volumetric...
2025-11-30 21:51:19,773 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_4 ~102 words, content: to adjust or secure the stopper. The camera angle shifts slightly, providing a clearer view of the person in the background, who remains focused on...
2025-11-30 21:51:19,773 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:51:19,773 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:51:21,077 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:51:21,077 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:51:21,077 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:51:22,084 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:51:22,084 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:51:22,085 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_2) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:51:23,266 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:51:23,266 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:51:23,266 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_3) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:51:24,250 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:51:24,250 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:51:24,250 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_4) (~102 words) with timeout=5.0s retries=3
2025-11-30 21:51:25,700 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:51:25,700 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:51:25,700 - src.components.pre_llm_injector - INFO - Extracted 27 local triplets from 5 chunks
2025-11-30 21:51:25,700 - src.pipeline.kg_builder - INFO - Pre-extraction: 27 triplets in 5.93s
2025-11-30 21:51:25,700 - src.components.global_refiner - INFO - Capping refinement input: 27 → 15 triplets
2025-11-30 21:51:25,701 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 261
- Total Relationships: 203
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0"]}, {"head": "Person", "relation": "Places", "tail": "Stopper", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_4"]}, {"head": "Person", "relation": "Checks", "tail": "Liquid_Level", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0"]}, {"head": "Person", "relation": "Holds", "tail": "Flask_Steady", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0"]}, {"head": "Person", "relation": "Holds", "tail": "Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1"]}, {"head": "Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1"]}, {"head": "Person", "relation": "Inverts", "tail": "Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1"]}, {"head": "Flask", "relation": "Has", "tail": "Stopper", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1"]}, {"head": "Person", "relation": "Holds", "tail": "Stopper", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1"]}, {"head": "Flask", "relation": "Is Used For", "tail": "Mixing", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_3"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_2"]}, {"head": "Volumetric Flask", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:51:25,701 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~242 words, ~315 tokens)
2025-11-30 21:51:25,701 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:51:37,586 - src.components.global_refiner - DEBUG - LLM call completed in 11.89s
2025-11-30 21:51:37,586 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0']], ['Person', 'holds', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0']], ['Person', 'places', 'Stopper', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0']], ['Volumetric_Flask', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_4']], ['Person', 'checks', 'Liquid_Level', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0']], ['Person', 'holds', 'Flask_Steady', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0']], ['Person', 'holds', 'Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1']], ['Flask', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1']], ['Person', 'inverts', 'Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1']], ['Flask', 'has', 'Stopper', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1']]]
2025-11-30 21:51:37,586 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0"
    ]
  ],
  [
    "Person",
    "places",
    "Stopper",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_4"
    ]
  ],
  [
    "Person",
    "checks",
    "Liquid_Level",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Flask_Steady",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1"
    ]
  ],
  [
    "Flask",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1"
    ]
  ],
  [
    "Person",
    "inverts",
    "Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1"
    ]
  ],
  [
    "Flask",
    "has",
    "Stopper",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_28_1"
    ]
  ]
]
2025-11-30 21:51:37,586 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.89s, LLM: 11.89s)
2025-11-30 21:51:37,586 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.89s
2025-11-30 21:51:37,586 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:51:37,586 - src.pipeline.kg_builder - INFO - Pushing batch 29/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:51:37,586 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:51:37,736 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:51:37,736 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:51:37,737 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:51:37,737 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.15s, indexes: 0.00s)
2025-11-30 21:51:37,738 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 138, 'with_embedding': 0, 'linked_chunks': 95}
2025-11-30 21:51:37,738 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:51:37,761 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 269 nodes
2025-11-30 21:51:37,815 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 226 nodes
2025-11-30 21:51:37,884 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 269, 'relationship_count': 700, 'density': 0.0097, 'avg_degree': 5.2045, 'avg_unique_neighbors': 5.1599, 'global_efficiency': 0.2893, 'avg_path_length': 2.6678, 'avg_degree_centrality': 0.0194, 'max_degree_centrality': 0.4925, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0407, 'degree_assortativity': -0.2063, 'graph_robustness': 0.7886, 'diameter_estimate': 5, 'clustering_coefficient': 0.2921, 'weakly_connected_components': 44, 'largest_wcc_size': 226, 'pagerank_top10_percent': 12.39, 'louvain_communities': 52, 'louvain_modularity': 0.4135, 'label_entropy': 1.4998, 'computational_time': 0.14597755495924503}
2025-11-30 21:51:37,884 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 28, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510697.8846707, 'total_time': 18.124183331034146, 'aggregation': 2.2989697754383087e-06, 'network_info': 0.012420470942743123, 'llm_extraction': 17.813547478057444, 'data_cleaning': 8.443021215498447e-06, 'neo4j_injection': 0.15078671707306057, 'embedding_time': 0, 'indexing_time': 0.00490688590798527, 'graph_injection_time': 0.1457398810889572, 'acs_metrics': {'node_count': 269, 'relationship_count': 700, 'density': 0.0097, 'avg_degree': 5.2045, 'avg_unique_neighbors': 5.1599, 'global_efficiency': 0.2893, 'avg_path_length': 2.6678, 'avg_degree_centrality': 0.0194, 'max_degree_centrality': 0.4925, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0407, 'degree_assortativity': -0.2063, 'graph_robustness': 0.7886, 'diameter_estimate': 5, 'clustering_coefficient': 0.2921, 'weakly_connected_components': 44, 'largest_wcc_size': 226, 'pagerank_top10_percent': 12.39, 'louvain_communities': 52, 'louvain_modularity': 0.4135, 'label_entropy': 1.4998, 'computational_time': 0.14597755495924503}, 'retrieval_queries': []}
2025-11-30 21:51:37,884 - src.pipeline.kg_builder - DEBUG - Batch 28 metrics: {
  "batch_idx": 28,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510697.8846707,
  "total_time": 18.124183331034146,
  "aggregation": 2.2989697754383087e-06,
  "network_info": 0.012420470942743123,
  "llm_extraction": 17.813547478057444,
  "data_cleaning": 8.443021215498447e-06,
  "neo4j_injection": 0.15078671707306057,
  "embedding_time": 0,
  "indexing_time": 0.00490688590798527,
  "graph_injection_time": 0.1457398810889572,
  "acs_metrics": {
    "node_count": 269,
    "relationship_count": 700,
    "density": 0.0097,
    "avg_degree": 5.2045,
    "avg_unique_neighbors": 5.1599,
    "global_efficiency": 0.2893,
    "avg_path_length": 2.6678,
    "avg_degree_centrality": 0.0194,
    "max_degree_centrality": 0.4925,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.0407,
    "degree_assortativity": -0.2063,
    "graph_robustness": 0.7886,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2921,
    "weakly_connected_components": 44,
    "largest_wcc_size": 226,
    "pagerank_top10_percent": 12.39,
    "louvain_communities": 52,
    "louvain_modularity": 0.4135,
    "label_entropy": 1.4998,
    "computational_time": 0.14597755495924503
  },
  "retrieval_queries": []
}
2025-11-30 21:51:37,885 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:51:37,885 - src.pipeline.kg_builder - INFO - Batch 29 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 17.81s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.15s
2025-11-30 21:51:37,885 - src.pipeline.kg_builder - INFO - Batch 29 completed in 18.12s
Processing KG batches:  40%|████      | 29/72 [11:19<16:16, 22.71s/it]2025-11-30 21:51:37,885 - src.pipeline.kg_builder - INFO - Processing batch 30/72 (3 items)
2025-11-30 21:51:37,885 - src.pipeline.kg_builder - DEBUG - Batch 30 current_video_time: 07:23-07:28
2025-11-30 21:51:37,894 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 269
- Total Relationships: 210
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:51:37,895 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:51:37,895 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0 ~241 words, content: Time: 07:13-07:18 Content: The video captures a scene in a laboratory setting, likely a chemistry or research lab, where a scientific procedure is being performed....
2025-11-30 21:51:37,895 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_1 ~225 words, content: precision, which is essential in scientific research. The video likely aims to document a specific scientific procedure, emphasizing the importance of careful handling and observation...
2025-11-30 21:51:37,895 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2 ~210 words, content: final frame shows the person's arm and a gold watch, confirming the first-person viewpoint. The overall atmosphere suggests a teaching or research demonstration. Time: 07:23-07:28...
2025-11-30 21:51:37,895 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:51:37,895 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:51:39,158 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:51:39,158 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:51:39,158 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_1) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:51:40,695 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:51:40,695 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:51:40,695 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2) (~210 words) with timeout=5.0s retries=3
2025-11-30 21:51:41,930 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:51:41,930 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:51:41,930 - src.components.pre_llm_injector - INFO - Extracted 15 local triplets from 3 chunks
2025-11-30 21:51:41,930 - src.pipeline.kg_builder - INFO - Pre-extraction: 15 triplets in 4.04s
2025-11-30 21:51:41,930 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 269
- Total Relationships: 210
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2"]}, {"head": "Person", "relation": "Handles", "tail": "Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0"]}, {"head": "Person", "relation": "Observes", "tail": "Observer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0"]}, {"head": "Observer", "relation": "Stands", "tail": "Background", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_1"]}, {"head": "Person", "relation": "Performs", "tail": "Scientific_Procedure", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_1"]}, {"head": "Man", "relation": "Observes", "tail": "Person", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_1"]}, {"head": "Man", "relation": "Wears", "tail": "Cream_Colored_Turtleneck_Sweater", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_1"]}, {"head": "Lab_Room", "relation": "Contains", "tail": "Fire_Extinguisher", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2"]}, {"head": "Person", "relation": "Performs", "tail": "Titration", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2"]}, {"head": "Observer", "relation": "Watches", "tail": "Scientific_Procedure", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "White_Cabinet", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:51:41,930 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~238 words, ~309 tokens)
2025-11-30 21:51:41,930 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:51:55,599 - src.components.global_refiner - DEBUG - LLM call completed in 13.67s
2025-11-30 21:51:55,599 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2']], ['Person', 'handles', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0']], ['Person', 'observes', 'Observer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0']], ['Observer', 'stands', 'Background', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0']], ['Volumetric_Flask', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_1']], ['Person', 'performs', 'Scientific_Procedure', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0']], ['Person', 'holds', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_1']], ['Person', 'holds', 'Glass_Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2']], ['Person', 'performs', 'Titration', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2']]]
2025-11-30 21:51:55,599 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2"
    ]
  ],
  [
    "Person",
    "handles",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0"
    ]
  ],
  [
    "Person",
    "observes",
    "Observer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0"
    ]
  ],
  [
    "Observer",
    "stands",
    "Background",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_1"
    ]
  ],
  [
    "Person",
    "performs",
    "Scientific_Procedure",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2"
    ]
  ],
  [
    "Person",
    "performs",
    "Titration",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_29_2"
    ]
  ]
]
2025-11-30 21:51:55,599 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 13.67s, LLM: 13.67s)
2025-11-30 21:51:55,599 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 13.67s
2025-11-30 21:51:55,599 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:51:55,599 - src.pipeline.kg_builder - INFO - Pushing batch 30/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:51:55,600 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:51:55,723 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:51:55,723 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:51:55,723 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:51:55,723 - src.components.neo4j_handler - INFO - Batch injected in 0.12s (triplets: 0.12s, indexes: 0.00s)
2025-11-30 21:51:55,724 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 141, 'with_embedding': 0, 'linked_chunks': 98}
2025-11-30 21:51:55,725 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:51:55,761 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 276 nodes
2025-11-30 21:51:55,824 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 233 nodes
2025-11-30 21:51:55,899 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 276, 'relationship_count': 721, 'density': 0.0095, 'avg_degree': 5.2246, 'avg_unique_neighbors': 5.1812, 'global_efficiency': 0.2931, 'avg_path_length': 2.655, 'avg_degree_centrality': 0.019, 'max_degree_centrality': 0.5055, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0361, 'degree_assortativity': -0.2166, 'graph_robustness': 0.7947, 'diameter_estimate': 5, 'clustering_coefficient': 0.2936, 'weakly_connected_components': 44, 'largest_wcc_size': 233, 'pagerank_top10_percent': 12.06, 'louvain_communities': 54, 'louvain_modularity': 0.4108, 'label_entropy': 1.4998, 'computational_time': 0.17479809501674026}
2025-11-30 21:51:55,899 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 29, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510715.8999743, 'total_time': 18.014424087945372, 'aggregation': 2.013053745031357e-06, 'network_info': 0.009037559037096798, 'llm_extraction': 17.705187601037323, 'data_cleaning': 9.482959285378456e-06, 'neo4j_injection': 0.12390095496084541, 'embedding_time': 0, 'indexing_time': 0.003406942938454449, 'graph_injection_time': 0.1203533629886806, 'acs_metrics': {'node_count': 276, 'relationship_count': 721, 'density': 0.0095, 'avg_degree': 5.2246, 'avg_unique_neighbors': 5.1812, 'global_efficiency': 0.2931, 'avg_path_length': 2.655, 'avg_degree_centrality': 0.019, 'max_degree_centrality': 0.5055, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0361, 'degree_assortativity': -0.2166, 'graph_robustness': 0.7947, 'diameter_estimate': 5, 'clustering_coefficient': 0.2936, 'weakly_connected_components': 44, 'largest_wcc_size': 233, 'pagerank_top10_percent': 12.06, 'louvain_communities': 54, 'louvain_modularity': 0.4108, 'label_entropy': 1.4998, 'computational_time': 0.17479809501674026}, 'retrieval_queries': []}
2025-11-30 21:51:55,900 - src.pipeline.kg_builder - DEBUG - Batch 29 metrics: {
  "batch_idx": 29,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510715.8999743,
  "total_time": 18.014424087945372,
  "aggregation": 2.013053745031357e-06,
  "network_info": 0.009037559037096798,
  "llm_extraction": 17.705187601037323,
  "data_cleaning": 9.482959285378456e-06,
  "neo4j_injection": 0.12390095496084541,
  "embedding_time": 0,
  "indexing_time": 0.003406942938454449,
  "graph_injection_time": 0.1203533629886806,
  "acs_metrics": {
    "node_count": 276,
    "relationship_count": 721,
    "density": 0.0095,
    "avg_degree": 5.2246,
    "avg_unique_neighbors": 5.1812,
    "global_efficiency": 0.2931,
    "avg_path_length": 2.655,
    "avg_degree_centrality": 0.019,
    "max_degree_centrality": 0.5055,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0361,
    "degree_assortativity": -0.2166,
    "graph_robustness": 0.7947,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2936,
    "weakly_connected_components": 44,
    "largest_wcc_size": 233,
    "pagerank_top10_percent": 12.06,
    "louvain_communities": 54,
    "louvain_modularity": 0.4108,
    "label_entropy": 1.4998,
    "computational_time": 0.17479809501674026
  },
  "retrieval_queries": []
}
2025-11-30 21:51:55,900 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:51:55,900 - src.pipeline.kg_builder - INFO - Batch 30 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 17.71s, Clean: 0.00s, Neo4j: 0.12s, ACS: 0.17s
2025-11-30 21:51:55,900 - src.pipeline.kg_builder - INFO - Batch 30 completed in 18.01s
Processing KG batches:  42%|████▏     | 30/72 [11:37<14:54, 21.30s/it]2025-11-30 21:51:55,900 - src.pipeline.kg_builder - INFO - Processing batch 31/72 (3 items)
2025-11-30 21:51:55,900 - src.pipeline.kg_builder - DEBUG - Batch 31 current_video_time: 07:38-07:43
2025-11-30 21:51:55,911 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 276
- Total Relationships: 216
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:51:55,912 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:51:55,912 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0 ~233 words, content: Time: 07:28-07:33 Content: The video captures a scene in a laboratory where a person is performing a precise liquid measurement. The sequence of frames shows...
2025-11-30 21:51:55,912 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1 ~229 words, content: the frame, observing the procedure. The overall context suggests that the person is preparing a solution of a specific concentration, a common task in chemistry...
2025-11-30 21:51:55,912 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_2 ~225 words, content: and the person is seen adjusting the settings on the device. This suggests that the next step in the experiment involves mixing the contents of...
2025-11-30 21:51:55,912 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_3 ~227 words, content: rile glove is holding a round-bottom flask, which is a type of laboratory glassware. The flask contains a clear liquid and is connected to a...
2025-11-30 21:51:55,912 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_4 ~53 words, content: person is now holding a different piece of glassware, possibly a pipette or a burette, and is preparing to use it. The scene suggests that...
2025-11-30 21:51:55,912 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:51:55,912 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:51:57,314 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:51:57,314 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:51:57,315 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:51:58,619 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:51:58,619 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:51:58,619 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_2) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:51:59,853 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:51:59,853 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:51:59,853 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_3) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:52:01,357 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:52:01,357 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:52:01,357 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_4) (~53 words) with timeout=5.0s retries=3
2025-11-30 21:52:02,405 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:52:02,405 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:52:02,405 - src.components.pre_llm_injector - INFO - Extracted 30 local triplets from 5 chunks
2025-11-30 21:52:02,405 - src.pipeline.kg_builder - INFO - Pre-extraction: 30 triplets in 6.49s
2025-11-30 21:52:02,405 - src.components.global_refiner - INFO - Capping refinement input: 30 → 15 triplets
2025-11-30 21:52:02,405 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 276
- Total Relationships: 216
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0"]}, {"head": "Person", "relation": "Performs", "tail": "Liquid_Measurement", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0"]}, {"head": "Person", "relation": "Checks", "tail": "Meniscus", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0"]}, {"head": "Person", "relation": "Looks At", "tail": "Meniscus", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1"]}, {"head": "Person", "relation": "Holds", "tail": "Round-Bottom Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1"]}, {"head": "Round-Bottom Flask", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1"]}, {"head": "Round-Bottom Flask", "relation": "Is Placed On", "tail": "Magnetic Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1"]}, {"head": "Person", "relation": "Wears", "tail": "Lab Coat", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_2"]}, {"head": "Person", "relation": "Holds", "tail": "Round_Bottom_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:52:02,405 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~247 words, ~321 tokens)
2025-11-30 21:52:02,405 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:52:13,852 - src.components.global_refiner - DEBUG - LLM call completed in 11.45s
2025-11-30 21:52:13,852 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0']], ['Person', 'holds', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0']], ['Person', 'performs', 'Liquid_Measurement', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0']], ['Volumetric_Flask', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0']], ['Person', 'checks', 'Meniscus', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0']], ['Person', 'looks_at', 'Meniscus', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1']], ['Person', 'holds', 'Round_Bottom_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1']], ['Round_Bottom_Flask', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1']]]
2025-11-30 21:52:13,852 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0"
    ]
  ],
  [
    "Person",
    "performs",
    "Liquid_Measurement",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0"
    ]
  ],
  [
    "Person",
    "checks",
    "Meniscus",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0"
    ]
  ],
  [
    "Person",
    "looks_at",
    "Meniscus",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Round_Bottom_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1"
    ]
  ],
  [
    "Round_Bottom_Flask",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_30_1"
    ]
  ]
]
2025-11-30 21:52:13,852 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.45s, LLM: 11.45s)
2025-11-30 21:52:13,852 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.45s
2025-11-30 21:52:13,852 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:52:13,852 - src.pipeline.kg_builder - INFO - Pushing batch 31/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:52:13,852 - src.components.neo4j_handler - INFO - Adding 9 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:52:14,001 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:52:14,001 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:52:14,001 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:52:14,001 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.15s, indexes: 0.00s)
2025-11-30 21:52:14,022 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 146, 'with_embedding': 0, 'linked_chunks': 100}
2025-11-30 21:52:14,022 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:52:14,059 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 284 nodes
2025-11-30 21:52:14,132 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 238 nodes
2025-11-30 21:52:14,207 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 284, 'relationship_count': 735, 'density': 0.0091, 'avg_degree': 5.1761, 'avg_unique_neighbors': 5.1338, 'global_efficiency': 0.2897, 'avg_path_length': 2.6445, 'avg_degree_centrality': 0.0183, 'max_degree_centrality': 0.5088, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.047, 'degree_assortativity': -0.2276, 'graph_robustness': 0.7946, 'diameter_estimate': 5, 'clustering_coefficient': 0.2917, 'weakly_connected_components': 47, 'largest_wcc_size': 238, 'pagerank_top10_percent': 11.74, 'louvain_communities': 57, 'louvain_modularity': 0.4033, 'label_entropy': 1.4997, 'computational_time': 0.18563320802059025}
2025-11-30 21:52:14,207 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 30, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510734.20789, 'total_time': 18.30695542693138, 'aggregation': 2.986053004860878e-06, 'network_info': 0.010608742013573647, 'llm_extraction': 17.940760653931648, 'data_cleaning': 1.015199813991785e-05, 'neo4j_injection': 0.14941176306456327, 'embedding_time': 0, 'indexing_time': 0.0034281889675185084, 'graph_injection_time': 0.145822528982535, 'acs_metrics': {'node_count': 284, 'relationship_count': 735, 'density': 0.0091, 'avg_degree': 5.1761, 'avg_unique_neighbors': 5.1338, 'global_efficiency': 0.2897, 'avg_path_length': 2.6445, 'avg_degree_centrality': 0.0183, 'max_degree_centrality': 0.5088, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.047, 'degree_assortativity': -0.2276, 'graph_robustness': 0.7946, 'diameter_estimate': 5, 'clustering_coefficient': 0.2917, 'weakly_connected_components': 47, 'largest_wcc_size': 238, 'pagerank_top10_percent': 11.74, 'louvain_communities': 57, 'louvain_modularity': 0.4033, 'label_entropy': 1.4997, 'computational_time': 0.18563320802059025}, 'retrieval_queries': []}
2025-11-30 21:52:14,207 - src.pipeline.kg_builder - DEBUG - Batch 30 metrics: {
  "batch_idx": 30,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510734.20789,
  "total_time": 18.30695542693138,
  "aggregation": 2.986053004860878e-06,
  "network_info": 0.010608742013573647,
  "llm_extraction": 17.940760653931648,
  "data_cleaning": 1.015199813991785e-05,
  "neo4j_injection": 0.14941176306456327,
  "embedding_time": 0,
  "indexing_time": 0.0034281889675185084,
  "graph_injection_time": 0.145822528982535,
  "acs_metrics": {
    "node_count": 284,
    "relationship_count": 735,
    "density": 0.0091,
    "avg_degree": 5.1761,
    "avg_unique_neighbors": 5.1338,
    "global_efficiency": 0.2897,
    "avg_path_length": 2.6445,
    "avg_degree_centrality": 0.0183,
    "max_degree_centrality": 0.5088,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.047,
    "degree_assortativity": -0.2276,
    "graph_robustness": 0.7946,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2917,
    "weakly_connected_components": 47,
    "largest_wcc_size": 238,
    "pagerank_top10_percent": 11.74,
    "louvain_communities": 57,
    "louvain_modularity": 0.4033,
    "label_entropy": 1.4997,
    "computational_time": 0.18563320802059025
  },
  "retrieval_queries": []
}
2025-11-30 21:52:14,208 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:52:14,208 - src.pipeline.kg_builder - INFO - Batch 31 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 17.94s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.19s
2025-11-30 21:52:14,208 - src.pipeline.kg_builder - INFO - Batch 31 completed in 18.31s
Processing KG batches:  43%|████▎     | 31/72 [11:55<13:56, 20.40s/it]2025-11-30 21:52:14,208 - src.pipeline.kg_builder - INFO - Processing batch 32/72 (3 items)
2025-11-30 21:52:14,208 - src.pipeline.kg_builder - DEBUG - Batch 32 current_video_time: 07:53-07:58
2025-11-30 21:52:14,221 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 284
- Total Relationships: 221
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:52:14,221 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:52:14,222 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0 ~235 words, content: Time: 07:43-07:48 Content: The video sequence captures a series of actions within a laboratory setting, focusing on a person conducting an experiment or a procedure....
2025-11-30 21:52:14,222 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1 ~235 words, content: involved in the experiment. The background shows a white cabinet with shelves containing various items, and a fire extinguisher is mounted on the wall, emphasizing...
2025-11-30 21:52:14,222 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_2 ~227 words, content: precision analytical balance, identified by the "METTLER TOLEDO" brand name. The process unfolds as follows: - **Initial Setup:** The person prepares a small piece of...
2025-11-30 21:52:14,222 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_3 ~226 words, content: , indicating adherence to safety protocols. The overall scene depicts a careful and methodical scientific procedure. Time: 07:53-07:58 Content: The sequence of frames captures a...
2025-11-30 21:52:14,222 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_4 ~143 words, content: .300 g`, which is a very slight change, suggesting the foil's weight is minimal. The person then opens the glass door of the balance again,...
2025-11-30 21:52:14,222 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:52:14,222 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0) (~235 words) with timeout=5.0s retries=3
2025-11-30 21:52:15,501 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:52:15,501 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:52:15,501 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1) (~235 words) with timeout=5.0s retries=3
2025-11-30 21:52:16,861 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:52:16,861 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:52:16,861 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_2) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:52:18,184 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:52:18,184 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:52:18,185 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_3) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:52:19,333 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:52:19,333 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:52:19,333 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_4) (~143 words) with timeout=5.0s retries=3
2025-11-30 21:52:20,545 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:52:20,545 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:52:20,545 - src.components.pre_llm_injector - INFO - Extracted 27 local triplets from 5 chunks
2025-11-30 21:52:20,545 - src.pipeline.kg_builder - INFO - Pre-extraction: 27 triplets in 6.32s
2025-11-30 21:52:20,546 - src.components.global_refiner - INFO - Capping refinement input: 27 → 15 triplets
2025-11-30 21:52:20,546 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 284
- Total Relationships: 221
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0"]}, {"head": "Person", "relation": "Handles", "tail": "Small Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0"]}, {"head": "Digital Scale", "relation": "Displays", "tail": "-5630.1", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0"]}, {"head": "Digital Scale", "relation": "Is On", "tail": "Black Countertop", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0"]}, {"head": "Person", "relation": "Interacts With", "tail": "Digital Scale", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1"]}, {"head": "Person", "relation": "Uses", "tail": "Analytical_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1"]}, {"head": "Analytical_Balance", "relation": "Is Made By", "tail": "Mettler_Toledo", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1"]}, {"head": "Person", "relation": "Handles", "tail": "Aluminum_Foil", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1"]}, {"head": "Lab", "relation": "Contains", "tail": "Fire_Extinguisher", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1"]}, {"head": "Lab", "relation": "Contains", "tail": "White_Cabinet", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1"]}, {"head": "Person", "relation": "Places", "tail": "Aluminum Foil", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_3"]}, {"head": "Aluminum Foil", "relation": "Is Inside", "tail": "Weighing Chamber", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_2"]}, {"head": "Weighing Chamber", "relation": "Has Status", "tail": "Tared", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_2"]}, {"head": "Person", "relation": "Places", "tail": "Sample", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:52:20,546 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~252 words, ~328 tokens)
2025-11-30 21:52:20,546 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:52:31,774 - src.components.global_refiner - DEBUG - LLM call completed in 11.23s
2025-11-30 21:52:31,775 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0']], ['Person', 'handles', 'Small Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0']], ['Digital Scale', 'displays', '-5630.1', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0']], ['Digital Scale', 'is_on', 'Black Countertop', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0']], ['Person', 'interacts_with', 'Digital Scale', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0']], ['Person', 'wears', 'Blue_Glove', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1']], ['Person', 'uses', 'Analytical_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1']], ['Analytical_Balance', 'is_made_by', 'Mettler_Toledo', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1']], ['Person', 'handles', 'Aluminum_Foil', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1']], ['Lab', 'contains', 'Fire_Extinguisher', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1']]]
2025-11-30 21:52:31,775 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0"
    ]
  ],
  [
    "Person",
    "handles",
    "Small Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0"
    ]
  ],
  [
    "Digital Scale",
    "displays",
    "-5630.1",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0"
    ]
  ],
  [
    "Digital Scale",
    "is_on",
    "Black Countertop",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0"
    ]
  ],
  [
    "Person",
    "interacts_with",
    "Digital Scale",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Glove",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Analytical_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1"
    ]
  ],
  [
    "Analytical_Balance",
    "is_made_by",
    "Mettler_Toledo",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1"
    ]
  ],
  [
    "Person",
    "handles",
    "Aluminum_Foil",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1"
    ]
  ],
  [
    "Lab",
    "contains",
    "Fire_Extinguisher",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_31_1"
    ]
  ]
]
2025-11-30 21:52:31,775 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.23s, LLM: 11.23s)
2025-11-30 21:52:31,775 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.23s
2025-11-30 21:52:31,775 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:52:31,775 - src.pipeline.kg_builder - INFO - Pushing batch 32/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:52:31,775 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:52:31,878 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:52:31,878 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:52:31,878 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:52:31,878 - src.components.neo4j_handler - INFO - Batch injected in 0.10s (triplets: 0.10s, indexes: 0.00s)
2025-11-30 21:52:31,880 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 151, 'with_embedding': 0, 'linked_chunks': 102}
2025-11-30 21:52:31,880 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:52:31,919 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 298 nodes
2025-11-30 21:52:31,997 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 249 nodes
2025-11-30 21:52:32,079 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 298, 'relationship_count': 757, 'density': 0.0086, 'avg_degree': 5.0805, 'avg_unique_neighbors': 5.0403, 'global_efficiency': 0.2871, 'avg_path_length': 2.6466, 'avg_degree_centrality': 0.0171, 'max_degree_centrality': 0.5084, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0461, 'degree_assortativity': -0.2363, 'graph_robustness': 0.7979, 'diameter_estimate': 5, 'clustering_coefficient': 0.2919, 'weakly_connected_components': 50, 'largest_wcc_size': 249, 'pagerank_top10_percent': 11.47, 'louvain_communities': 59, 'louvain_modularity': 0.4148, 'label_entropy': 1.4999, 'computational_time': 0.1990255470154807}
2025-11-30 21:52:32,079 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 31, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510752.0795014, 'total_time': 17.87072738399729, 'aggregation': 2.359040081501007e-06, 'network_info': 0.012598109082318842, 'llm_extraction': 17.553870258037932, 'data_cleaning': 2.7560978196561337e-05, 'neo4j_injection': 0.10346793395001441, 'embedding_time': 0, 'indexing_time': 0.002464127028360963, 'graph_injection_time': 0.10073494096286595, 'acs_metrics': {'node_count': 298, 'relationship_count': 757, 'density': 0.0086, 'avg_degree': 5.0805, 'avg_unique_neighbors': 5.0403, 'global_efficiency': 0.2871, 'avg_path_length': 2.6466, 'avg_degree_centrality': 0.0171, 'max_degree_centrality': 0.5084, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0461, 'degree_assortativity': -0.2363, 'graph_robustness': 0.7979, 'diameter_estimate': 5, 'clustering_coefficient': 0.2919, 'weakly_connected_components': 50, 'largest_wcc_size': 249, 'pagerank_top10_percent': 11.47, 'louvain_communities': 59, 'louvain_modularity': 0.4148, 'label_entropy': 1.4999, 'computational_time': 0.1990255470154807}, 'retrieval_queries': []}
2025-11-30 21:52:32,079 - src.pipeline.kg_builder - DEBUG - Batch 31 metrics: {
  "batch_idx": 31,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510752.0795014,
  "total_time": 17.87072738399729,
  "aggregation": 2.359040081501007e-06,
  "network_info": 0.012598109082318842,
  "llm_extraction": 17.553870258037932,
  "data_cleaning": 2.7560978196561337e-05,
  "neo4j_injection": 0.10346793395001441,
  "embedding_time": 0,
  "indexing_time": 0.002464127028360963,
  "graph_injection_time": 0.10073494096286595,
  "acs_metrics": {
    "node_count": 298,
    "relationship_count": 757,
    "density": 0.0086,
    "avg_degree": 5.0805,
    "avg_unique_neighbors": 5.0403,
    "global_efficiency": 0.2871,
    "avg_path_length": 2.6466,
    "avg_degree_centrality": 0.0171,
    "max_degree_centrality": 0.5084,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0461,
    "degree_assortativity": -0.2363,
    "graph_robustness": 0.7979,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2919,
    "weakly_connected_components": 50,
    "largest_wcc_size": 249,
    "pagerank_top10_percent": 11.47,
    "louvain_communities": 59,
    "louvain_modularity": 0.4148,
    "label_entropy": 1.4999,
    "computational_time": 0.1990255470154807
  },
  "retrieval_queries": []
}
2025-11-30 21:52:32,080 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:52:32,080 - src.pipeline.kg_builder - INFO - Batch 32 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 17.55s, Clean: 0.00s, Neo4j: 0.10s, ACS: 0.20s
2025-11-30 21:52:32,080 - src.pipeline.kg_builder - INFO - Batch 32 completed in 17.87s
Processing KG batches:  44%|████▍     | 32/72 [12:13<13:05, 19.64s/it]2025-11-30 21:52:32,080 - src.pipeline.kg_builder - INFO - Processing batch 33/72 (3 items)
2025-11-30 21:52:32,080 - src.pipeline.kg_builder - DEBUG - Batch 33 current_video_time: 08:08-08:13
2025-11-30 21:52:32,092 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 298
- Total Relationships: 230
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:52:32,092 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:52:32,092 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0 ~212 words, content: Time: 07:58-08:03 Content: The video sequence captures a scientific procedure, likely a chemical experiment, being conducted in a laboratory setting. The perspective is first-person, showing...
2025-11-30 21:52:32,092 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1 ~226 words, content: positive weight, indicating the mass of the substance that was added to the beaker. The final reading on the display is $0.191$ grams, which is...
2025-11-30 21:52:32,092 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_2 ~238 words, content: the measurement. The person then carefully places a small, circular piece of aluminum foil onto the weighing pan. After closing the draft shield, the balance's...
2025-11-30 21:52:32,092 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_3 ~232 words, content: precise measurement in a laboratory setting. The scene is set on a black laboratory bench, with various pieces of equipment and materials arranged around the...
2025-11-30 21:52:32,092 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_4 ~84 words, content: the bench. This suggests the next step in the procedure might involve using the foil, perhaps to cover the sample or to prepare for the...
2025-11-30 21:52:32,092 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:52:32,093 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0) (~212 words) with timeout=5.0s retries=3
2025-11-30 21:52:33,337 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:52:33,337 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:52:33,337 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:52:34,755 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:52:34,755 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:52:34,755 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_2) (~238 words) with timeout=5.0s retries=3
2025-11-30 21:52:38,978 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:52:38,979 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:52:38,979 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_3) (~232 words) with timeout=5.0s retries=3
2025-11-30 21:52:40,284 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:52:40,284 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:52:40,285 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_4) (~84 words) with timeout=5.0s retries=3
2025-11-30 21:52:41,688 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:52:41,688 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:52:41,688 - src.components.pre_llm_injector - INFO - Extracted 27 local triplets from 5 chunks
2025-11-30 21:52:41,688 - src.pipeline.kg_builder - INFO - Pre-extraction: 27 triplets in 9.60s
2025-11-30 21:52:41,689 - src.components.global_refiner - INFO - Capping refinement input: 27 → 15 triplets
2025-11-30 21:52:41,689 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 298
- Total Relationships: 230
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Researcher", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0"]}, {"head": "Researcher", "relation": "Opens", "tail": "Glass Draft Shield", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0"]}, {"head": "Researcher", "relation": "Places", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Analytical Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0"]}, {"head": "Researcher", "relation": "Adds", "tail": "White Powder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0"]}, {"head": "Analytical Balance", "relation": "Displays", "tail": "Weight Measurement", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0"]}, {"head": "Analytical Balance", "relation": "Displays", "tail": "0.191 Grams", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_3"]}, {"head": "Person", "relation": "Opens", "tail": "Draft Shield", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_2"]}, {"head": "Person", "relation": "Places", "tail": "Aluminum Foil", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_2"]}, {"head": "Analytical Balance", "relation": "Contains", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1"]}, {"head": "Beaker", "relation": "Has Mass", "tail": "0.191 Grams", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1"]}, {"head": "Aluminum Foil", "relation": "Has Mass", "tail": "0.193 G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_2"]}, {"head": "Balance", "relation": "Displays", "tail": "0.193 G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_2"]}, {"head": "Draft Shield", "relation": "Is Closed", "tail": "Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:52:41,689 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~262 words, ~341 tokens)
2025-11-30 21:52:41,689 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:52:55,374 - src.components.global_refiner - DEBUG - LLM call completed in 13.69s
2025-11-30 21:52:55,375 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Researcher', 'wears', 'Blue Nitrile Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0']], ['Researcher', 'opens', 'Glass Draft Shield', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0']], ['Researcher', 'places', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0']], ['Beaker', 'is_on', 'Analytical Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0']], ['Researcher', 'adds', 'White Powder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0']], ['Analytical Balance', 'displays', 'Weight Measurement', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0']], ['Analytical Balance', 'displays', '0.191 Grams', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1']], ['Person', 'wears', 'Blue Nitrile Glove', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_3']], ['Person', 'opens', 'Draft Shield', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_2']], ['Person', 'places', 'Aluminum Foil', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_2']]]
2025-11-30 21:52:55,375 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Researcher",
    "wears",
    "Blue Nitrile Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0"
    ]
  ],
  [
    "Researcher",
    "opens",
    "Glass Draft Shield",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0"
    ]
  ],
  [
    "Researcher",
    "places",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Analytical Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0"
    ]
  ],
  [
    "Researcher",
    "adds",
    "White Powder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0"
    ]
  ],
  [
    "Analytical Balance",
    "displays",
    "Weight Measurement",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_0"
    ]
  ],
  [
    "Analytical Balance",
    "displays",
    "0.191 Grams",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Nitrile Glove",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_3"
    ]
  ],
  [
    "Person",
    "opens",
    "Draft Shield",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_2"
    ]
  ],
  [
    "Person",
    "places",
    "Aluminum Foil",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_32_2"
    ]
  ]
]
2025-11-30 21:52:55,375 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 13.69s, LLM: 13.69s)
2025-11-30 21:52:55,375 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 13.69s
2025-11-30 21:52:55,375 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:52:55,375 - src.pipeline.kg_builder - INFO - Pushing batch 33/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:52:55,375 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:52:55,485 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:52:55,485 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:52:55,485 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:52:55,485 - src.components.neo4j_handler - INFO - Batch injected in 0.11s (triplets: 0.11s, indexes: 0.00s)
2025-11-30 21:52:55,486 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 156, 'with_embedding': 0, 'linked_chunks': 106}
2025-11-30 21:52:55,486 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:52:55,527 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 311 nodes
2025-11-30 21:52:55,606 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 261 nodes
2025-11-30 21:52:55,696 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 311, 'relationship_count': 784, 'density': 0.0081, 'avg_degree': 5.0418, 'avg_unique_neighbors': 5.0032, 'global_efficiency': 0.2869, 'avg_path_length': 2.6736, 'avg_degree_centrality': 0.0163, 'max_degree_centrality': 0.5032, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0562, 'degree_assortativity': -0.2347, 'graph_robustness': 0.8036, 'diameter_estimate': 5, 'clustering_coefficient': 0.2914, 'weakly_connected_components': 51, 'largest_wcc_size': 261, 'pagerank_top10_percent': 10.93, 'louvain_communities': 60, 'louvain_modularity': 0.4279, 'label_entropy': 1.5, 'computational_time': 0.20937488100025803}
2025-11-30 21:52:55,696 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 32, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510775.6965404, 'total_time': 23.616109451046214, 'aggregation': 2.477085217833519e-06, 'network_info': 0.011757272994145751, 'llm_extraction': 23.28298947296571, 'data_cleaning': 1.7949030734598637e-05, 'neo4j_injection': 0.11021895392332226, 'embedding_time': 0, 'indexing_time': 0.0025532509898766875, 'graph_injection_time': 0.10745448106899858, 'acs_metrics': {'node_count': 311, 'relationship_count': 784, 'density': 0.0081, 'avg_degree': 5.0418, 'avg_unique_neighbors': 5.0032, 'global_efficiency': 0.2869, 'avg_path_length': 2.6736, 'avg_degree_centrality': 0.0163, 'max_degree_centrality': 0.5032, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0562, 'degree_assortativity': -0.2347, 'graph_robustness': 0.8036, 'diameter_estimate': 5, 'clustering_coefficient': 0.2914, 'weakly_connected_components': 51, 'largest_wcc_size': 261, 'pagerank_top10_percent': 10.93, 'louvain_communities': 60, 'louvain_modularity': 0.4279, 'label_entropy': 1.5, 'computational_time': 0.20937488100025803}, 'retrieval_queries': []}
2025-11-30 21:52:55,696 - src.pipeline.kg_builder - DEBUG - Batch 32 metrics: {
  "batch_idx": 32,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510775.6965404,
  "total_time": 23.616109451046214,
  "aggregation": 2.477085217833519e-06,
  "network_info": 0.011757272994145751,
  "llm_extraction": 23.28298947296571,
  "data_cleaning": 1.7949030734598637e-05,
  "neo4j_injection": 0.11021895392332226,
  "embedding_time": 0,
  "indexing_time": 0.0025532509898766875,
  "graph_injection_time": 0.10745448106899858,
  "acs_metrics": {
    "node_count": 311,
    "relationship_count": 784,
    "density": 0.0081,
    "avg_degree": 5.0418,
    "avg_unique_neighbors": 5.0032,
    "global_efficiency": 0.2869,
    "avg_path_length": 2.6736,
    "avg_degree_centrality": 0.0163,
    "max_degree_centrality": 0.5032,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0562,
    "degree_assortativity": -0.2347,
    "graph_robustness": 0.8036,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2914,
    "weakly_connected_components": 51,
    "largest_wcc_size": 261,
    "pagerank_top10_percent": 10.93,
    "louvain_communities": 60,
    "louvain_modularity": 0.4279,
    "label_entropy": 1.5,
    "computational_time": 0.20937488100025803
  },
  "retrieval_queries": []
}
2025-11-30 21:52:55,697 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:52:55,697 - src.pipeline.kg_builder - INFO - Batch 33 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 23.28s, Clean: 0.00s, Neo4j: 0.11s, ACS: 0.21s
2025-11-30 21:52:55,697 - src.pipeline.kg_builder - INFO - Batch 33 completed in 23.62s
Processing KG batches:  46%|████▌     | 33/72 [12:37<13:32, 20.84s/it]2025-11-30 21:52:55,697 - src.pipeline.kg_builder - INFO - Processing batch 34/72 (3 items)
2025-11-30 21:52:55,697 - src.pipeline.kg_builder - DEBUG - Batch 34 current_video_time: 08:23-08:28
2025-11-30 21:52:55,709 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 311
- Total Relationships: 239
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:52:55,709 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:52:55,709 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0 ~245 words, content: Time: 08:13-08:18 Content: The video sequence captures a series of actions within a laboratory setting, focusing on a person conducting an experiment. The scene is...
2025-11-30 21:52:55,709 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1 ~236 words, content: the contents of the container are not contaminated. The surrounding area includes a blue stand with a glass tube, a beaker, and a pair of...
2025-11-30 21:52:55,709 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_2 ~248 words, content: the camera provides a wide view of the lab. A person wearing blue gloves is seen interacting with a piece of equipment, possibly a balance...
2025-11-30 21:52:55,709 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_3 ~245 words, content: and other lab equipment remain in the foreground, but the primary action is the documentation of the experiment. Overall, the video depicts a scientific procedure...
2025-11-30 21:52:55,709 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_4 ~221 words, content: A glass container is placed on a magnetic stirrer, which is actively mixing a liquid. The stirrer is connected to a power source, and the...
2025-11-30 21:52:55,709 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:52:55,709 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0) (~245 words) with timeout=5.0s retries=3
2025-11-30 21:52:56,750 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:52:56,750 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:52:56,751 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1) (~236 words) with timeout=5.0s retries=3
2025-11-30 21:52:57,857 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:52:57,857 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:52:57,858 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_2) (~248 words) with timeout=5.0s retries=3
2025-11-30 21:52:58,891 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:52:58,891 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:52:58,892 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_3) (~245 words) with timeout=5.0s retries=3
2025-11-30 21:53:00,061 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:53:00,062 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:53:00,062 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_4) (~221 words) with timeout=5.0s retries=3
2025-11-30 21:53:01,345 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:53:01,346 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:53:01,346 - src.components.pre_llm_injector - INFO - Extracted 28 local triplets from 5 chunks
2025-11-30 21:53:01,346 - src.pipeline.kg_builder - INFO - Pre-extraction: 28 triplets in 5.64s
2025-11-30 21:53:01,346 - src.components.global_refiner - INFO - Capping refinement input: 28 → 15 triplets
2025-11-30 21:53:01,347 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 311
- Total Relationships: 239
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0"]}, {"head": "Person", "relation": "Handles", "tail": "Aluminum Foil", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1"]}, {"head": "Person", "relation": "Interacts With", "tail": "Balance Scale", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0"]}, {"head": "Balance Scale", "relation": "Measures", "tail": "Mass", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0"]}, {"head": "Person", "relation": "Covers", "tail": "Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0"]}, {"head": "Container", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1"]}, {"head": "Person", "relation": "Works At", "tail": "Countertop", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1"]}, {"head": "Balance Scale", "relation": "Is Located On", "tail": "Countertop", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1"]}, {"head": "Lab", "relation": "Contains", "tail": "Glass Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1"]}, {"head": "Lab", "relation": "Contains", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1"]}, {"head": "Camera", "relation": "Provides", "tail": "Wide_View", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_2"]}, {"head": "Person", "relation": "Interacts With", "tail": "Balance_Scale", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_2"]}, {"head": "Person", "relation": "Holds", "tail": "Smartphone", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:53:01,347 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~251 words, ~326 tokens)
2025-11-30 21:53:01,347 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:53:14,003 - src.components.global_refiner - DEBUG - LLM call completed in 12.66s
2025-11-30 21:53:14,003 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue Glove', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0']], ['Person', 'handles', 'Aluminum Foil', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1']], ['Person', 'interacts_with', 'Balance Scale', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0']], ['Balance Scale', 'measures', 'Mass', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0']], ['Person', 'covers', 'Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0']], ['Container', 'is_on', 'Magnetic Stirrer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0']], ['Person', 'wears', 'Blue Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_2']], ['Person', 'works_at', 'Countertop', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1']], ['Balance Scale', 'is_located_on', 'Countertop', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1']], ['Lab', 'contains', 'Glass Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1']]]
2025-11-30 21:53:14,004 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue Glove",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0"
    ]
  ],
  [
    "Person",
    "handles",
    "Aluminum Foil",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1"
    ]
  ],
  [
    "Person",
    "interacts_with",
    "Balance Scale",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0"
    ]
  ],
  [
    "Balance Scale",
    "measures",
    "Mass",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0"
    ]
  ],
  [
    "Person",
    "covers",
    "Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0"
    ]
  ],
  [
    "Container",
    "is_on",
    "Magnetic Stirrer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_2"
    ]
  ],
  [
    "Person",
    "works_at",
    "Countertop",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1"
    ]
  ],
  [
    "Balance Scale",
    "is_located_on",
    "Countertop",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1"
    ]
  ],
  [
    "Lab",
    "contains",
    "Glass Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_33_1"
    ]
  ]
]
2025-11-30 21:53:14,004 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 12.66s, LLM: 12.66s)
2025-11-30 21:53:14,004 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 12.66s
2025-11-30 21:53:14,004 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:53:14,004 - src.pipeline.kg_builder - INFO - Pushing batch 34/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:53:14,004 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:53:14,132 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:53:14,132 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:53:14,132 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:53:14,132 - src.components.neo4j_handler - INFO - Batch injected in 0.13s (triplets: 0.13s, indexes: 0.00s)
2025-11-30 21:53:14,133 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 161, 'with_embedding': 0, 'linked_chunks': 109}
2025-11-30 21:53:14,133 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:53:14,176 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 320 nodes
2025-11-30 21:53:14,256 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 268 nodes
2025-11-30 21:53:14,350 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 320, 'relationship_count': 807, 'density': 0.0079, 'avg_degree': 5.0438, 'avg_unique_neighbors': 5.0062, 'global_efficiency': 0.2862, 'avg_path_length': 2.6675, 'avg_degree_centrality': 0.0158, 'max_degree_centrality': 0.5078, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0488, 'degree_assortativity': -0.2399, 'graph_robustness': 0.8017, 'diameter_estimate': 5, 'clustering_coefficient': 0.2876, 'weakly_connected_components': 53, 'largest_wcc_size': 268, 'pagerank_top10_percent': 10.4, 'louvain_communities': 62, 'louvain_modularity': 0.4234, 'label_entropy': 1.5, 'computational_time': 0.21692966297268867}
2025-11-30 21:53:14,351 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 33, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510794.3510041, 'total_time': 18.653539455030113, 'aggregation': 2.600019797682762e-06, 'network_info': 0.011517635895870626, 'llm_extraction': 18.2951512549771, 'data_cleaning': 2.6977970264852047e-05, 'neo4j_injection': 0.12841955199837685, 'embedding_time': 0, 'indexing_time': 0.002220808994024992, 'graph_injection_time': 0.12592921301256865, 'acs_metrics': {'node_count': 320, 'relationship_count': 807, 'density': 0.0079, 'avg_degree': 5.0438, 'avg_unique_neighbors': 5.0062, 'global_efficiency': 0.2862, 'avg_path_length': 2.6675, 'avg_degree_centrality': 0.0158, 'max_degree_centrality': 0.5078, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0488, 'degree_assortativity': -0.2399, 'graph_robustness': 0.8017, 'diameter_estimate': 5, 'clustering_coefficient': 0.2876, 'weakly_connected_components': 53, 'largest_wcc_size': 268, 'pagerank_top10_percent': 10.4, 'louvain_communities': 62, 'louvain_modularity': 0.4234, 'label_entropy': 1.5, 'computational_time': 0.21692966297268867}, 'retrieval_queries': []}
2025-11-30 21:53:14,351 - src.pipeline.kg_builder - DEBUG - Batch 33 metrics: {
  "batch_idx": 33,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510794.3510041,
  "total_time": 18.653539455030113,
  "aggregation": 2.600019797682762e-06,
  "network_info": 0.011517635895870626,
  "llm_extraction": 18.2951512549771,
  "data_cleaning": 2.6977970264852047e-05,
  "neo4j_injection": 0.12841955199837685,
  "embedding_time": 0,
  "indexing_time": 0.002220808994024992,
  "graph_injection_time": 0.12592921301256865,
  "acs_metrics": {
    "node_count": 320,
    "relationship_count": 807,
    "density": 0.0079,
    "avg_degree": 5.0438,
    "avg_unique_neighbors": 5.0062,
    "global_efficiency": 0.2862,
    "avg_path_length": 2.6675,
    "avg_degree_centrality": 0.0158,
    "max_degree_centrality": 0.5078,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0488,
    "degree_assortativity": -0.2399,
    "graph_robustness": 0.8017,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2876,
    "weakly_connected_components": 53,
    "largest_wcc_size": 268,
    "pagerank_top10_percent": 10.4,
    "louvain_communities": 62,
    "louvain_modularity": 0.4234,
    "label_entropy": 1.5,
    "computational_time": 0.21692966297268867
  },
  "retrieval_queries": []
}
2025-11-30 21:53:14,351 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:53:14,351 - src.pipeline.kg_builder - INFO - Batch 34 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 18.30s, Clean: 0.00s, Neo4j: 0.13s, ACS: 0.22s
2025-11-30 21:53:14,351 - src.pipeline.kg_builder - INFO - Batch 34 completed in 18.65s
Processing KG batches:  47%|████▋     | 34/72 [12:55<12:46, 20.18s/it]2025-11-30 21:53:14,352 - src.pipeline.kg_builder - INFO - Processing batch 35/72 (3 items)
2025-11-30 21:53:14,352 - src.pipeline.kg_builder - DEBUG - Batch 35 current_video_time: 08:38-08:43
2025-11-30 21:53:14,363 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 320
- Total Relationships: 248
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:53:14,363 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:53:14,363 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0 ~235 words, content: Time: 08:28-08:33 Content: The video captures a sequence of actions in a laboratory setting, focusing on a chemical experiment. The scene is set on a...
2025-11-30 21:53:14,364 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1 ~224 words, content: show the person continuing to use the pipette to transfer the liquid. The test tube is held steady, and the liquid is being drawn into...
2025-11-30 21:53:14,364 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_2 ~223 words, content: with precision, suggesting a controlled experiment. The person's hands are the primary focus, demonstrating careful handling of the chemicals. - **Final State:** After the transfer,...
2025-11-30 21:53:14,364 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_3 ~226 words, content: weighing balance or a stir plate. - **Transfer to a Volumetric Flask:** The researcher then carefully transfers the liquid from the small vial into a...
2025-11-30 21:53:14,364 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_4 ~71 words, content: which might contain a reagent. In summary, the video shows a researcher meticulously preparing a chemical solution in a laboratory setting. The process involves precise...
2025-11-30 21:53:14,364 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:53:14,364 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0) (~235 words) with timeout=5.0s retries=3
2025-11-30 21:53:15,554 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:53:15,554 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:53:15,555 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:53:16,895 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:53:16,895 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:53:16,896 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_2) (~223 words) with timeout=5.0s retries=3
2025-11-30 21:53:18,011 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:53:18,011 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:53:18,011 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_3) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:53:19,313 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:53:19,313 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:53:19,314 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_4) (~71 words) with timeout=5.0s retries=3
2025-11-30 21:53:20,632 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:53:20,633 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:53:20,633 - src.components.pre_llm_injector - INFO - Extracted 27 local triplets from 5 chunks
2025-11-30 21:53:20,633 - src.pipeline.kg_builder - INFO - Pre-extraction: 27 triplets in 6.27s
2025-11-30 21:53:20,633 - src.components.global_refiner - INFO - Capping refinement input: 27 → 15 triplets
2025-11-30 21:53:20,634 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 320
- Total Relationships: 248
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Lab Bench", "relation": "Contains", "tail": "Glass Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0"]}, {"head": "Glass Flask", "relation": "Connected To", "tail": "Flexible Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0"]}, {"head": "Flexible Tube", "relation": "Connected To", "tail": "Plastic Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Test Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1"]}, {"head": "Person", "relation": "Holds", "tail": "Test_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1"]}, {"head": "Test_Tube", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1"]}, {"head": "Test_Tube", "relation": "Is Transferred To", "tail": "Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1"]}, {"head": "Person", "relation": "Holds", "tail": "Test Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_2"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_2"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_2"]}, {"head": "Test Tube", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:53:20,634 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~254 words, ~330 tokens)
2025-11-30 21:53:20,634 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:53:35,306 - src.components.global_refiner - DEBUG - LLM call completed in 14.67s
2025-11-30 21:53:35,306 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Lab_Bench', 'contains', 'Glass_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0']], ['Glass_Flask', 'connected_to', 'Flexible_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0']], ['Flexible_Tube', 'connected_to', 'Plastic_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_2']], ['Person', 'holds', 'Glass_Test_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1']], ['Person', 'holds', 'Test_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_2']], ['Test_Tube', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1']], ['Person', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1']], ['Test_Tube', 'is_transferred_to', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1']]]
2025-11-30 21:53:35,306 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Lab_Bench",
    "contains",
    "Glass_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0"
    ]
  ],
  [
    "Glass_Flask",
    "connected_to",
    "Flexible_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0"
    ]
  ],
  [
    "Flexible_Tube",
    "connected_to",
    "Plastic_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Test_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Test_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_2"
    ]
  ],
  [
    "Test_Tube",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1"
    ]
  ],
  [
    "Test_Tube",
    "is_transferred_to",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_34_1"
    ]
  ]
]
2025-11-30 21:53:35,307 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 14.67s, LLM: 14.67s)
2025-11-30 21:53:35,307 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 14.67s
2025-11-30 21:53:35,307 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:53:35,307 - src.pipeline.kg_builder - INFO - Pushing batch 35/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:53:35,307 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:53:35,451 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:53:35,451 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:53:35,451 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:53:35,451 - src.components.neo4j_handler - INFO - Batch injected in 0.14s (triplets: 0.14s, indexes: 0.01s)
2025-11-30 21:53:35,454 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 166, 'with_embedding': 0, 'linked_chunks': 112}
2025-11-30 21:53:35,454 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:53:35,485 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 329 nodes
2025-11-30 21:53:35,565 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 275 nodes
2025-11-30 21:53:35,662 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 329, 'relationship_count': 832, 'density': 0.0077, 'avg_degree': 5.0578, 'avg_unique_neighbors': 5.0213, 'global_efficiency': 0.2849, 'avg_path_length': 2.6679, 'avg_degree_centrality': 0.0154, 'max_degree_centrality': 0.5091, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0395, 'degree_assortativity': -0.2399, 'graph_robustness': 0.8113, 'diameter_estimate': 5, 'clustering_coefficient': 0.2863, 'weakly_connected_components': 55, 'largest_wcc_size': 275, 'pagerank_top10_percent': 10.11, 'louvain_communities': 66, 'louvain_modularity': 0.4267, 'label_entropy': 1.5, 'computational_time': 0.20797111396677792}
2025-11-30 21:53:35,662 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 34, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510815.6627173, 'total_time': 21.310714347986504, 'aggregation': 2.640997990965843e-06, 'network_info': 0.011353787034749985, 'llm_extraction': 20.94370397296734, 'data_cleaning': 2.318702172487974e-05, 'neo4j_injection': 0.14451588899828494, 'embedding_time': 0, 'indexing_time': 0.0064510899828746915, 'graph_injection_time': 0.1378193130949512, 'acs_metrics': {'node_count': 329, 'relationship_count': 832, 'density': 0.0077, 'avg_degree': 5.0578, 'avg_unique_neighbors': 5.0213, 'global_efficiency': 0.2849, 'avg_path_length': 2.6679, 'avg_degree_centrality': 0.0154, 'max_degree_centrality': 0.5091, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0395, 'degree_assortativity': -0.2399, 'graph_robustness': 0.8113, 'diameter_estimate': 5, 'clustering_coefficient': 0.2863, 'weakly_connected_components': 55, 'largest_wcc_size': 275, 'pagerank_top10_percent': 10.11, 'louvain_communities': 66, 'louvain_modularity': 0.4267, 'label_entropy': 1.5, 'computational_time': 0.20797111396677792}, 'retrieval_queries': []}
2025-11-30 21:53:35,662 - src.pipeline.kg_builder - DEBUG - Batch 34 metrics: {
  "batch_idx": 34,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510815.6627173,
  "total_time": 21.310714347986504,
  "aggregation": 2.640997990965843e-06,
  "network_info": 0.011353787034749985,
  "llm_extraction": 20.94370397296734,
  "data_cleaning": 2.318702172487974e-05,
  "neo4j_injection": 0.14451588899828494,
  "embedding_time": 0,
  "indexing_time": 0.0064510899828746915,
  "graph_injection_time": 0.1378193130949512,
  "acs_metrics": {
    "node_count": 329,
    "relationship_count": 832,
    "density": 0.0077,
    "avg_degree": 5.0578,
    "avg_unique_neighbors": 5.0213,
    "global_efficiency": 0.2849,
    "avg_path_length": 2.6679,
    "avg_degree_centrality": 0.0154,
    "max_degree_centrality": 0.5091,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0395,
    "degree_assortativity": -0.2399,
    "graph_robustness": 0.8113,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2863,
    "weakly_connected_components": 55,
    "largest_wcc_size": 275,
    "pagerank_top10_percent": 10.11,
    "louvain_communities": 66,
    "louvain_modularity": 0.4267,
    "label_entropy": 1.5,
    "computational_time": 0.20797111396677792
  },
  "retrieval_queries": []
}
2025-11-30 21:53:35,663 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:53:35,663 - src.pipeline.kg_builder - INFO - Batch 35 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 20.94s, Clean: 0.00s, Neo4j: 0.14s, ACS: 0.21s
2025-11-30 21:53:35,663 - src.pipeline.kg_builder - INFO - Batch 35 completed in 21.31s
Processing KG batches:  49%|████▊     | 35/72 [13:17<12:39, 20.52s/it]2025-11-30 21:53:35,663 - src.pipeline.kg_builder - INFO - Processing batch 36/72 (3 items)
2025-11-30 21:53:35,663 - src.pipeline.kg_builder - DEBUG - Batch 36 current_video_time: 08:53-08:58
2025-11-30 21:53:35,674 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 329
- Total Relationships: 255
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:53:35,675 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:53:35,675 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0 ~235 words, content: Time: 08:43-08:48 Content: The video sequence captures a series of actions within a laboratory setting, focusing on a person conducting an experiment. The environment is...
2025-11-30 21:53:35,675 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1 ~240 words, content: - In the third frame, the person is seen adjusting a piece of equipment, possibly a pipette or a similar device, which is connected to...
2025-11-30 21:53:35,675 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_2 ~249 words, content: scientific experiment. The scene begins with a close-up of a laboratory bench, where a person wearing blue gloves is handling a glass container. The bench...
2025-11-30 21:53:35,675 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_3 ~233 words, content: video suggests a professional and organized laboratory setting, with a focus on scientific research and experimentation. In summary, the video depicts a laboratory scene where...
2025-11-30 21:53:35,675 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_4 ~119 words, content: The balance's digital display shows "0.0000 g", indicating it has been tared. The person then uses a metal spatula to transfer a white solid from...
2025-11-30 21:53:35,675 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:53:35,675 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0) (~235 words) with timeout=5.0s retries=3
2025-11-30 21:53:37,003 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:53:37,003 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:53:37,003 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1) (~240 words) with timeout=5.0s retries=3
2025-11-30 21:53:37,979 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:53:37,979 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:53:37,979 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_2) (~249 words) with timeout=5.0s retries=3
2025-11-30 21:53:39,015 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:53:39,015 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:53:39,015 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_3) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:53:40,324 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:53:40,324 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:53:40,324 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_4) (~119 words) with timeout=5.0s retries=3
2025-11-30 21:53:41,563 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:53:41,564 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:53:41,564 - src.components.pre_llm_injector - INFO - Extracted 28 local triplets from 5 chunks
2025-11-30 21:53:41,564 - src.pipeline.kg_builder - INFO - Pre-extraction: 28 triplets in 5.89s
2025-11-30 21:53:41,564 - src.components.global_refiner - INFO - Capping refinement input: 28 → 15 triplets
2025-11-30 21:53:41,565 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 329
- Total Relationships: 255
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0"]}, {"head": "Person", "relation": "Handles", "tail": "Test_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0"]}, {"head": "Person", "relation": "Interacts With", "tail": "Magnetic_Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0"]}, {"head": "Magnetic_Stirrer", "relation": "Contains", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0"]}, {"head": "Person", "relation": "Adjusts", "tail": "Magnetic_Stirrer_Settings", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0"]}, {"head": "Person", "relation": "Handles", "tail": "Equipment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1"]}, {"head": "Person", "relation": "Handles", "tail": "Glass Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_2"]}, {"head": "Equipment", "relation": "Connected To", "tail": "Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_2"]}, {"head": "Person", "relation": "Reaches For", "tail": "Glass Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "Equipment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1"]}, {"head": "Person", "relation": "Wears", "tail": "Beige Sweater", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_2"]}, {"head": "Person", "relation": "Stands Near", "tail": "Glass Cabinet", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_2"]}, {"head": "Person", "relation": "Observes", "tail": "Experiment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:53:41,565 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~247 words, ~321 tokens)
2025-11-30 21:53:41,565 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:53:54,383 - src.components.global_refiner - DEBUG - LLM call completed in 12.82s
2025-11-30 21:53:54,383 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0']], ['Person', 'handles', 'Test_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0']], ['Person', 'interacts_with', 'Magnetic_Stirrer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0']], ['Magnetic_Stirrer', 'contains', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0']], ['Beaker', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0']], ['Person', 'adjusts', 'Magnetic_Stirrer_Settings', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0']], ['Person', 'handles', 'Equipment', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1']], ['Person', 'handles', 'Glass_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_2']], ['Equipment', 'connected_to', 'Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1']], ['Person', 'wears', 'Blue_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_2']]]
2025-11-30 21:53:54,383 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0"
    ]
  ],
  [
    "Person",
    "handles",
    "Test_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0"
    ]
  ],
  [
    "Person",
    "interacts_with",
    "Magnetic_Stirrer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "contains",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0"
    ]
  ],
  [
    "Person",
    "adjusts",
    "Magnetic_Stirrer_Settings",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_0"
    ]
  ],
  [
    "Person",
    "handles",
    "Equipment",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1"
    ]
  ],
  [
    "Person",
    "handles",
    "Glass_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_2"
    ]
  ],
  [
    "Equipment",
    "connected_to",
    "Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_35_2"
    ]
  ]
]
2025-11-30 21:53:54,383 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 12.82s, LLM: 12.82s)
2025-11-30 21:53:54,383 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 12.82s
2025-11-30 21:53:54,383 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:53:54,383 - src.pipeline.kg_builder - INFO - Pushing batch 36/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:53:54,383 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:53:54,485 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:53:54,485 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:53:54,486 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:53:54,486 - src.components.neo4j_handler - INFO - Batch injected in 0.10s (triplets: 0.10s, indexes: 0.00s)
2025-11-30 21:53:54,487 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 171, 'with_embedding': 0, 'linked_chunks': 115}
2025-11-30 21:53:54,487 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:53:54,534 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 337 nodes
2025-11-30 21:53:54,625 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 281 nodes
2025-11-30 21:53:54,726 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 337, 'relationship_count': 851, 'density': 0.0075, 'avg_degree': 5.0504, 'avg_unique_neighbors': 5.0148, 'global_efficiency': 0.2842, 'avg_path_length': 2.6592, 'avg_degree_centrality': 0.015, 'max_degree_centrality': 0.5149, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0248, 'degree_assortativity': -0.2432, 'graph_robustness': 0.8061, 'diameter_estimate': 5, 'clustering_coefficient': 0.2852, 'weakly_connected_components': 57, 'largest_wcc_size': 281, 'pagerank_top10_percent': 9.9, 'louvain_communities': 69, 'louvain_modularity': 0.4346, 'label_entropy': 1.4999, 'computational_time': 0.23894061101600528}
2025-11-30 21:53:54,727 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 35, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510834.7270622, 'total_time': 19.063374146004207, 'aggregation': 2.5170156732201576e-06, 'network_info': 0.011076449998654425, 'llm_extraction': 18.708715038956143, 'data_cleaning': 2.475106157362461e-05, 'neo4j_injection': 0.10251352901104838, 'embedding_time': 0, 'indexing_time': 0.0023914140183478594, 'graph_injection_time': 0.09983390395063907, 'acs_metrics': {'node_count': 337, 'relationship_count': 851, 'density': 0.0075, 'avg_degree': 5.0504, 'avg_unique_neighbors': 5.0148, 'global_efficiency': 0.2842, 'avg_path_length': 2.6592, 'avg_degree_centrality': 0.015, 'max_degree_centrality': 0.5149, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0248, 'degree_assortativity': -0.2432, 'graph_robustness': 0.8061, 'diameter_estimate': 5, 'clustering_coefficient': 0.2852, 'weakly_connected_components': 57, 'largest_wcc_size': 281, 'pagerank_top10_percent': 9.9, 'louvain_communities': 69, 'louvain_modularity': 0.4346, 'label_entropy': 1.4999, 'computational_time': 0.23894061101600528}, 'retrieval_queries': []}
2025-11-30 21:53:54,727 - src.pipeline.kg_builder - DEBUG - Batch 35 metrics: {
  "batch_idx": 35,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510834.7270622,
  "total_time": 19.063374146004207,
  "aggregation": 2.5170156732201576e-06,
  "network_info": 0.011076449998654425,
  "llm_extraction": 18.708715038956143,
  "data_cleaning": 2.475106157362461e-05,
  "neo4j_injection": 0.10251352901104838,
  "embedding_time": 0,
  "indexing_time": 0.0023914140183478594,
  "graph_injection_time": 0.09983390395063907,
  "acs_metrics": {
    "node_count": 337,
    "relationship_count": 851,
    "density": 0.0075,
    "avg_degree": 5.0504,
    "avg_unique_neighbors": 5.0148,
    "global_efficiency": 0.2842,
    "avg_path_length": 2.6592,
    "avg_degree_centrality": 0.015,
    "max_degree_centrality": 0.5149,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0248,
    "degree_assortativity": -0.2432,
    "graph_robustness": 0.8061,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2852,
    "weakly_connected_components": 57,
    "largest_wcc_size": 281,
    "pagerank_top10_percent": 9.9,
    "louvain_communities": 69,
    "louvain_modularity": 0.4346,
    "label_entropy": 1.4999,
    "computational_time": 0.23894061101600528
  },
  "retrieval_queries": []
}
2025-11-30 21:53:54,727 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:53:54,727 - src.pipeline.kg_builder - INFO - Batch 36 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 18.71s, Clean: 0.00s, Neo4j: 0.10s, ACS: 0.24s
2025-11-30 21:53:54,727 - src.pipeline.kg_builder - INFO - Batch 36 completed in 19.06s
Processing KG batches:  50%|█████     | 36/72 [13:36<12:03, 20.08s/it]2025-11-30 21:53:54,728 - src.pipeline.kg_builder - INFO - Processing batch 37/72 (3 items)
2025-11-30 21:53:54,728 - src.pipeline.kg_builder - DEBUG - Batch 37 current_video_time: 09:08-09:13
2025-11-30 21:53:54,734 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 337
- Total Relationships: 261
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:53:54,735 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:53:54,735 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0 ~221 words, content: Time: 08:58-09:03 Content: The video sequence captures a detailed laboratory procedure, likely a chemical synthesis or analysis, performed by a scientist wearing blue nitrile gloves....
2025-11-30 21:53:54,735 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1 ~224 words, content: The presence of the magnetic stirrer in the background indicates that the contents of the flask will be mixed, likely to ensure homogeneity or to...
2025-11-30 21:53:54,735 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_2 ~208 words, content: steady, while their right hand controls the vial, tilting it to pour the liquid. This action is being performed with great care to ensure an...
2025-11-30 21:53:54,735 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_3 ~221 words, content: laboratory setting with a white door, a wall-mounted electrical panel with a high-voltage warning sign, and cardboard boxes. The overall environment suggests a controlled and...
2025-11-30 21:53:54,735 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_4 ~69 words, content: process. The digital scale in the background displays a reading of "0.18," which could be the mass of a substance being weighed, possibly the reagent...
2025-11-30 21:53:54,735 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:53:54,735 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0) (~221 words) with timeout=5.0s retries=3
2025-11-30 21:53:56,271 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:53:56,271 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:53:56,271 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:53:57,489 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:53:57,489 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:53:57,490 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_2) (~208 words) with timeout=5.0s retries=3
2025-11-30 21:53:58,553 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:53:58,553 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:53:58,554 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_3) (~221 words) with timeout=5.0s retries=3
2025-11-30 21:53:59,744 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:53:59,744 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:53:59,745 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_4) (~69 words) with timeout=5.0s retries=3
2025-11-30 21:54:00,773 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:54:00,773 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:54:00,774 - src.components.pre_llm_injector - INFO - Extracted 28 local triplets from 5 chunks
2025-11-30 21:54:00,774 - src.pipeline.kg_builder - INFO - Pre-extraction: 28 triplets in 6.04s
2025-11-30 21:54:00,774 - src.components.global_refiner - INFO - Capping refinement input: 28 → 15 triplets
2025-11-30 21:54:00,774 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 337
- Total Relationships: 261
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Scientist", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0"]}, {"head": "Scientist", "relation": "Holds", "tail": "Glass_Cylinder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0"]}, {"head": "Scientist", "relation": "Holds", "tail": "Round_Bottom_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0"]}, {"head": "Magnetic_Stirrer", "relation": "Mixes", "tail": "Solution", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0"]}, {"head": "Analytical_Balance", "relation": "Displays", "tail": "0.0000_G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0"]}, {"head": "Glass_Cylinder", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0"]}, {"head": "Scientist", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1"]}, {"head": "Scientist", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1"]}, {"head": "Liquid", "relation": "Is In", "tail": "Graduated Cylinder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1"]}, {"head": "Graduated Cylinder", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1"]}, {"head": "Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1"]}, {"head": "Magnetic Stirrer", "relation": "Is Used To", "tail": "Mix Contents", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1"]}, {"head": "Person", "relation": "Holds", "tail": "Vial", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_2"]}, {"head": "Person", "relation": "Controls", "tail": "Burette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_2"]}, {"head": "Burette", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:54:00,775 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~245 words, ~318 tokens)
2025-11-30 21:54:00,775 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:54:13,149 - src.components.global_refiner - DEBUG - LLM call completed in 12.37s
2025-11-30 21:54:13,149 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Scientist', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1']], ['Scientist', 'holds', 'Glass_Cylinder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0']], ['Scientist', 'holds', 'Round_Bottom_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0']], ['Scientist', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1']], ['Magnetic_Stirrer', 'mixes', 'Solution', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0']], ['Analytical_Balance', 'displays', '0.0000_G', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0']], ['Glass_Cylinder', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0']], ['Liquid', 'is_in', 'Graduated_Cylinder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1']], ['Graduated_Cylinder', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1']], ['Flask', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1']]]
2025-11-30 21:54:13,149 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Scientist",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1"
    ]
  ],
  [
    "Scientist",
    "holds",
    "Glass_Cylinder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0"
    ]
  ],
  [
    "Scientist",
    "holds",
    "Round_Bottom_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0"
    ]
  ],
  [
    "Scientist",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "mixes",
    "Solution",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0"
    ]
  ],
  [
    "Analytical_Balance",
    "displays",
    "0.0000_G",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0"
    ]
  ],
  [
    "Glass_Cylinder",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_0"
    ]
  ],
  [
    "Liquid",
    "is_in",
    "Graduated_Cylinder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1"
    ]
  ],
  [
    "Graduated_Cylinder",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1"
    ]
  ],
  [
    "Flask",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_36_1"
    ]
  ]
]
2025-11-30 21:54:13,149 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 12.38s, LLM: 12.37s)
2025-11-30 21:54:13,149 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 12.38s
2025-11-30 21:54:13,149 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:54:13,150 - src.pipeline.kg_builder - INFO - Pushing batch 37/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:54:13,150 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:54:13,247 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:54:13,247 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:54:13,247 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:54:13,247 - src.components.neo4j_handler - INFO - Batch injected in 0.10s (triplets: 0.09s, indexes: 0.00s)
2025-11-30 21:54:13,248 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 176, 'with_embedding': 0, 'linked_chunks': 117}
2025-11-30 21:54:13,248 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:54:13,282 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 346 nodes
2025-11-30 21:54:13,370 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 287 nodes
2025-11-30 21:54:13,475 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 346, 'relationship_count': 873, 'density': 0.0073, 'avg_degree': 5.0462, 'avg_unique_neighbors': 5.0058, 'global_efficiency': 0.2799, 'avg_path_length': 2.6716, 'avg_degree_centrality': 0.0146, 'max_degree_centrality': 0.5014, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0331, 'degree_assortativity': -0.2385, 'graph_robustness': 0.7984, 'diameter_estimate': 5, 'clustering_coefficient': 0.2835, 'weakly_connected_components': 60, 'largest_wcc_size': 287, 'pagerank_top10_percent': 9.64, 'louvain_communities': 73, 'louvain_modularity': 0.4302, 'label_entropy': 1.4999, 'computational_time': 0.22694936906918883}
2025-11-30 21:54:13,475 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 36, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510853.475721, 'total_time': 18.74764381290879, 'aggregation': 2.4780165404081345e-06, 'network_info': 0.006819548085331917, 'llm_extraction': 18.41493900504429, 'data_cleaning': 1.332792453467846e-05, 'neo4j_injection': 0.0974644449306652, 'embedding_time': 0, 'indexing_time': 0.0026217219419777393, 'graph_injection_time': 0.09468527790158987, 'acs_metrics': {'node_count': 346, 'relationship_count': 873, 'density': 0.0073, 'avg_degree': 5.0462, 'avg_unique_neighbors': 5.0058, 'global_efficiency': 0.2799, 'avg_path_length': 2.6716, 'avg_degree_centrality': 0.0146, 'max_degree_centrality': 0.5014, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0331, 'degree_assortativity': -0.2385, 'graph_robustness': 0.7984, 'diameter_estimate': 5, 'clustering_coefficient': 0.2835, 'weakly_connected_components': 60, 'largest_wcc_size': 287, 'pagerank_top10_percent': 9.64, 'louvain_communities': 73, 'louvain_modularity': 0.4302, 'label_entropy': 1.4999, 'computational_time': 0.22694936906918883}, 'retrieval_queries': []}
2025-11-30 21:54:13,475 - src.pipeline.kg_builder - DEBUG - Batch 36 metrics: {
  "batch_idx": 36,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510853.475721,
  "total_time": 18.74764381290879,
  "aggregation": 2.4780165404081345e-06,
  "network_info": 0.006819548085331917,
  "llm_extraction": 18.41493900504429,
  "data_cleaning": 1.332792453467846e-05,
  "neo4j_injection": 0.0974644449306652,
  "embedding_time": 0,
  "indexing_time": 0.0026217219419777393,
  "graph_injection_time": 0.09468527790158987,
  "acs_metrics": {
    "node_count": 346,
    "relationship_count": 873,
    "density": 0.0073,
    "avg_degree": 5.0462,
    "avg_unique_neighbors": 5.0058,
    "global_efficiency": 0.2799,
    "avg_path_length": 2.6716,
    "avg_degree_centrality": 0.0146,
    "max_degree_centrality": 0.5014,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0331,
    "degree_assortativity": -0.2385,
    "graph_robustness": 0.7984,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2835,
    "weakly_connected_components": 60,
    "largest_wcc_size": 287,
    "pagerank_top10_percent": 9.64,
    "louvain_communities": 73,
    "louvain_modularity": 0.4302,
    "label_entropy": 1.4999,
    "computational_time": 0.22694936906918883
  },
  "retrieval_queries": []
}
2025-11-30 21:54:13,476 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:54:13,476 - src.pipeline.kg_builder - INFO - Batch 37 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 18.41s, Clean: 0.00s, Neo4j: 0.10s, ACS: 0.23s
2025-11-30 21:54:13,476 - src.pipeline.kg_builder - INFO - Batch 37 completed in 18.75s
Processing KG batches:  51%|█████▏    | 37/72 [13:54<11:28, 19.68s/it]2025-11-30 21:54:13,476 - src.pipeline.kg_builder - INFO - Processing batch 38/72 (3 items)
2025-11-30 21:54:13,476 - src.pipeline.kg_builder - DEBUG - Batch 38 current_video_time: 09:23-09:28
2025-11-30 21:54:13,489 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 346
- Total Relationships: 269
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:54:13,489 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:54:13,489 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0 ~224 words, content: Time: 09:13-09:18 Content: The video sequence captures a detailed laboratory procedure, likely a chemical titration or solution preparation, performed by a person wearing blue nitrile...
2025-11-30 21:54:13,489 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1 ~231 words, content: step in the procedure is to weigh the cylinder to determine the exact mass of the liquid that was added. This is a critical step...
2025-11-30 21:54:13,489 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_2 ~222 words, content: Mettler Toledo model, is visible on the left, with its display showing "0.000 g," suggesting it is used for weighing. To the right, a white...
2025-11-30 21:54:13,489 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_3 ~225 words, content: **Initial Setup**: The person, wearing blue nitrile gloves, is handling laboratory glassware. Their left hand holds a tall, graduated cylinder, which contains a clear liquid....
2025-11-30 21:54:13,489 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_4 ~46 words, content: In summary, the video shows a person in a laboratory setting, using a pipette to transfer a liquid from one container to another, likely as...
2025-11-30 21:54:13,489 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:54:13,489 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:54:15,023 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:54:15,023 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:54:15,023 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1) (~231 words) with timeout=5.0s retries=3
2025-11-30 21:54:16,069 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:54:16,069 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:54:16,070 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_2) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:54:17,363 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:54:17,363 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:54:17,364 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_3) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:54:18,708 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:54:18,708 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:54:18,708 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_4) (~46 words) with timeout=5.0s retries=3
2025-11-30 21:54:19,754 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:54:19,754 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:54:19,754 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 5 chunks
2025-11-30 21:54:19,754 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 6.27s
2025-11-30 21:54:19,754 - src.components.global_refiner - INFO - Capping refinement input: 22 → 15 triplets
2025-11-30 21:54:19,754 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 346
- Total Relationships: 269
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_3"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated_Cylinder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_3"]}, {"head": "Graduated_Cylinder", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_3"]}, {"head": "Person", "relation": "Uses", "tail": "Digital_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "0.000_G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0"]}, {"head": "Graduated_Cylinder", "relation": "Is Held Over", "tail": "Digital_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated Cylinder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_3", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_4"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1"]}, {"head": "Graduated Cylinder", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1"]}, {"head": "Mettler Toledo", "relation": "Displays", "tail": "0.000 G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_2"]}, {"head": "Magnetic Stirrer", "relation": "Has", "tail": "Glass Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_2"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:54:19,754 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~254 words, ~330 tokens)
2025-11-30 21:54:19,754 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:54:39,570 - src.components.global_refiner - DEBUG - LLM call completed in 19.82s
2025-11-30 21:54:39,570 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_3']], ['Person', 'holds', 'Graduated_Cylinder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_3']], ['Graduated_Cylinder', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_3']], ['Graduated_Cylinder', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_3', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_4']], ['Person', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1']], ['Digital_Balance', 'displays', '0.000_G', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0']], ['Mettler_Toledo', 'displays', '0.000_G', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_2']], ['Digital_Balance', 'measures', 'Mass', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1']], ['Graduated_Cylinder', 'is_held_over', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0']], ['Lab_Bench', 'contains', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_2']]]
2025-11-30 21:54:39,570 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Graduated_Cylinder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_3"
    ]
  ],
  [
    "Graduated_Cylinder",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_3"
    ]
  ],
  [
    "Graduated_Cylinder",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_3",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_4"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "0.000_G",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0"
    ]
  ],
  [
    "Mettler_Toledo",
    "displays",
    "0.000_G",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_2"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Mass",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_1"
    ]
  ],
  [
    "Graduated_Cylinder",
    "is_held_over",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_0"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_37_2"
    ]
  ]
]
2025-11-30 21:54:39,570 - src.components.global_refiner - INFO - Refinement complete: 15 → 11 triplets (total: 19.82s, LLM: 19.82s)
2025-11-30 21:54:39,571 - src.pipeline.kg_builder - INFO - Global refinement: 11 triplets in 19.82s
2025-11-30 21:54:39,571 - src.pipeline.kg_builder - INFO - Using 11 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:54:39,571 - src.pipeline.kg_builder - INFO - Pushing batch 38/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:54:39,571 - src.components.neo4j_handler - INFO - Adding 11 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:54:39,756 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:54:39,756 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:54:39,757 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:54:39,757 - src.components.neo4j_handler - INFO - Batch injected in 0.19s (triplets: 0.18s, indexes: 0.00s)
2025-11-30 21:54:39,758 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 181, 'with_embedding': 0, 'linked_chunks': 122}
2025-11-30 21:54:39,758 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:54:39,793 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 352 nodes
2025-11-30 21:54:39,885 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 293 nodes
2025-11-30 21:54:39,998 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 352, 'relationship_count': 905, 'density': 0.0073, 'avg_degree': 5.142, 'avg_unique_neighbors': 5.1023, 'global_efficiency': 0.2832, 'avg_path_length': 2.6572, 'avg_degree_centrality': 0.0146, 'max_degree_centrality': 0.51, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0289, 'degree_assortativity': -0.239, 'graph_robustness': 0.7978, 'diameter_estimate': 5, 'clustering_coefficient': 0.2811, 'weakly_connected_components': 60, 'largest_wcc_size': 293, 'pagerank_top10_percent': 9.47, 'louvain_communities': 70, 'louvain_modularity': 0.4101, 'label_entropy': 1.4997, 'computational_time': 0.2396569959819317}
2025-11-30 21:54:39,998 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 37, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510879.9983644, 'total_time': 26.521630833041854, 'aggregation': 2.6399502530694008e-06, 'network_info': 0.012240426964126527, 'llm_extraction': 26.081935585010797, 'data_cleaning': 1.6749021597206593e-05, 'neo4j_injection': 0.18630625994410366, 'embedding_time': 0, 'indexing_time': 0.0046728820307180285, 'graph_injection_time': 0.18144011800177395, 'acs_metrics': {'node_count': 352, 'relationship_count': 905, 'density': 0.0073, 'avg_degree': 5.142, 'avg_unique_neighbors': 5.1023, 'global_efficiency': 0.2832, 'avg_path_length': 2.6572, 'avg_degree_centrality': 0.0146, 'max_degree_centrality': 0.51, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0289, 'degree_assortativity': -0.239, 'graph_robustness': 0.7978, 'diameter_estimate': 5, 'clustering_coefficient': 0.2811, 'weakly_connected_components': 60, 'largest_wcc_size': 293, 'pagerank_top10_percent': 9.47, 'louvain_communities': 70, 'louvain_modularity': 0.4101, 'label_entropy': 1.4997, 'computational_time': 0.2396569959819317}, 'retrieval_queries': []}
2025-11-30 21:54:39,998 - src.pipeline.kg_builder - DEBUG - Batch 37 metrics: {
  "batch_idx": 37,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510879.9983644,
  "total_time": 26.521630833041854,
  "aggregation": 2.6399502530694008e-06,
  "network_info": 0.012240426964126527,
  "llm_extraction": 26.081935585010797,
  "data_cleaning": 1.6749021597206593e-05,
  "neo4j_injection": 0.18630625994410366,
  "embedding_time": 0,
  "indexing_time": 0.0046728820307180285,
  "graph_injection_time": 0.18144011800177395,
  "acs_metrics": {
    "node_count": 352,
    "relationship_count": 905,
    "density": 0.0073,
    "avg_degree": 5.142,
    "avg_unique_neighbors": 5.1023,
    "global_efficiency": 0.2832,
    "avg_path_length": 2.6572,
    "avg_degree_centrality": 0.0146,
    "max_degree_centrality": 0.51,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0289,
    "degree_assortativity": -0.239,
    "graph_robustness": 0.7978,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2811,
    "weakly_connected_components": 60,
    "largest_wcc_size": 293,
    "pagerank_top10_percent": 9.47,
    "louvain_communities": 70,
    "louvain_modularity": 0.4101,
    "label_entropy": 1.4997,
    "computational_time": 0.2396569959819317
  },
  "retrieval_queries": []
}
2025-11-30 21:54:39,999 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:54:39,999 - src.pipeline.kg_builder - INFO - Batch 38 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 26.08s, Clean: 0.00s, Neo4j: 0.19s, ACS: 0.24s
2025-11-30 21:54:39,999 - src.pipeline.kg_builder - INFO - Batch 38 completed in 26.52s
Processing KG batches:  53%|█████▎    | 38/72 [14:21<12:18, 21.74s/it]2025-11-30 21:54:39,999 - src.pipeline.kg_builder - INFO - Processing batch 39/72 (3 items)
2025-11-30 21:54:39,999 - src.pipeline.kg_builder - DEBUG - Batch 39 current_video_time: 09:38-09:43
2025-11-30 21:54:40,006 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 352
- Total Relationships: 274
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:54:40,007 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:54:40,007 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0 ~217 words, content: Time: 09:28-09:33 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a precise liquid transfer, performed by a scientist. The scene...
2025-11-30 21:54:40,007 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1 ~236 words, content: used for weighing. - **Final Adjustment (Frame 3):** The person has now lifted the graduated cylinder, holding it up for a final inspection. The liquid...
2025-11-30 21:54:40,007 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2 ~239 words, content: is conducted with care and precision, which is essential in a laboratory setting. The person is likely preparing a solution of a specific concentration, a...
2025-11-30 21:54:40,007 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_3 ~232 words, content: person is wearing a blue glove on their right hand and a black glove on their left hand. The video ends with the person still...
2025-11-30 21:54:40,007 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_4 ~123 words, content: critical to the experiment's outcome. - **Progression of the Procedure:** The person continues to add the clear liquid from the pipette into the volumetric flask....
2025-11-30 21:54:40,007 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:54:40,007 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0) (~217 words) with timeout=5.0s retries=3
2025-11-30 21:54:41,400 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:54:41,400 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:54:41,400 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1) (~236 words) with timeout=5.0s retries=3
2025-11-30 21:54:42,440 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:54:42,440 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:54:42,441 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2) (~239 words) with timeout=5.0s retries=3
2025-11-30 21:54:43,694 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:54:43,694 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:54:43,694 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_3) (~232 words) with timeout=5.0s retries=3
2025-11-30 21:54:44,937 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:54:44,937 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:54:44,937 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_4) (~123 words) with timeout=5.0s retries=3
2025-11-30 21:54:46,294 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:54:46,294 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:54:46,294 - src.components.pre_llm_injector - INFO - Extracted 26 local triplets from 5 chunks
2025-11-30 21:54:46,294 - src.pipeline.kg_builder - INFO - Pre-extraction: 26 triplets in 6.29s
2025-11-30 21:54:46,295 - src.components.global_refiner - INFO - Capping refinement input: 26 → 15 triplets
2025-11-30 21:54:46,295 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 352
- Total Relationships: 274
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated_Cylinder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2"]}, {"head": "Glass_Pipette", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0"]}, {"head": "Graduated_Cylinder", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2"]}, {"head": "Person", "relation": "Uses", "tail": "Digital_Scale", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated Cylinder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1"]}, {"head": "Person", "relation": "Observes", "tail": "Liquid Level", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1"]}, {"head": "Graduated Cylinder", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Vial", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Glass_Vial", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:54:46,295 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~246 words, ~320 tokens)
2025-11-30 21:54:46,295 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:55:00,591 - src.components.global_refiner - DEBUG - LLM call completed in 14.30s
2025-11-30 21:55:00,591 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2']], ['Person', 'holds', 'Glass_Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0']], ['Person', 'holds', 'Graduated_Cylinder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2']], ['Glass_Pipette', 'transfers', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0']], ['Graduated_Cylinder', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2']], ['Person', 'uses', 'Digital_Scale', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0']], ['Person', 'holds', 'Graduated_Cylinder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1']], ['Person', 'observes', 'Liquid_Level', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1']], ['Graduated_Cylinder', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2']]]
2025-11-30 21:55:00,591 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Graduated_Cylinder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2"
    ]
  ],
  [
    "Glass_Pipette",
    "transfers",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0"
    ]
  ],
  [
    "Graduated_Cylinder",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Digital_Scale",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Graduated_Cylinder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1"
    ]
  ],
  [
    "Person",
    "observes",
    "Liquid_Level",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1"
    ]
  ],
  [
    "Graduated_Cylinder",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_38_2"
    ]
  ]
]
2025-11-30 21:55:00,592 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 14.30s, LLM: 14.30s)
2025-11-30 21:55:00,592 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 14.30s
2025-11-30 21:55:00,592 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:55:00,592 - src.pipeline.kg_builder - INFO - Pushing batch 39/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:55:00,592 - src.components.neo4j_handler - INFO - Adding 9 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:55:00,679 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:55:00,679 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:55:00,680 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:55:00,680 - src.components.neo4j_handler - INFO - Batch injected in 0.09s (triplets: 0.08s, indexes: 0.00s)
2025-11-30 21:55:00,681 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 186, 'with_embedding': 0, 'linked_chunks': 125}
2025-11-30 21:55:00,681 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:55:00,717 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 358 nodes
2025-11-30 21:55:00,812 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 297 nodes
2025-11-30 21:55:00,979 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 358, 'relationship_count': 922, 'density': 0.0072, 'avg_degree': 5.1508, 'avg_unique_neighbors': 5.1117, 'global_efficiency': 0.282, 'avg_path_length': 2.6496, 'avg_degree_centrality': 0.0144, 'max_degree_centrality': 0.5126, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.033, 'degree_assortativity': -0.2391, 'graph_robustness': 0.8059, 'diameter_estimate': 5, 'clustering_coefficient': 0.2795, 'weakly_connected_components': 62, 'largest_wcc_size': 297, 'pagerank_top10_percent': 9.35, 'louvain_communities': 72, 'louvain_modularity': 0.4191, 'label_entropy': 1.4994, 'computational_time': 0.29790390201378614}
2025-11-30 21:55:00,979 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 38, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510900.9797032, 'total_time': 20.98031647200696, 'aggregation': 2.2939639165997505e-06, 'network_info': 0.007379801012575626, 'llm_extraction': 20.585190540063195, 'data_cleaning': 1.2996955774724483e-05, 'neo4j_injection': 0.088160554994829, 'embedding_time': 0, 'indexing_time': 0.0029990000184625387, 'graph_injection_time': 0.08498902304563671, 'acs_metrics': {'node_count': 358, 'relationship_count': 922, 'density': 0.0072, 'avg_degree': 5.1508, 'avg_unique_neighbors': 5.1117, 'global_efficiency': 0.282, 'avg_path_length': 2.6496, 'avg_degree_centrality': 0.0144, 'max_degree_centrality': 0.5126, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.033, 'degree_assortativity': -0.2391, 'graph_robustness': 0.8059, 'diameter_estimate': 5, 'clustering_coefficient': 0.2795, 'weakly_connected_components': 62, 'largest_wcc_size': 297, 'pagerank_top10_percent': 9.35, 'louvain_communities': 72, 'louvain_modularity': 0.4191, 'label_entropy': 1.4994, 'computational_time': 0.29790390201378614}, 'retrieval_queries': []}
2025-11-30 21:55:00,979 - src.pipeline.kg_builder - DEBUG - Batch 38 metrics: {
  "batch_idx": 38,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510900.9797032,
  "total_time": 20.98031647200696,
  "aggregation": 2.2939639165997505e-06,
  "network_info": 0.007379801012575626,
  "llm_extraction": 20.585190540063195,
  "data_cleaning": 1.2996955774724483e-05,
  "neo4j_injection": 0.088160554994829,
  "embedding_time": 0,
  "indexing_time": 0.0029990000184625387,
  "graph_injection_time": 0.08498902304563671,
  "acs_metrics": {
    "node_count": 358,
    "relationship_count": 922,
    "density": 0.0072,
    "avg_degree": 5.1508,
    "avg_unique_neighbors": 5.1117,
    "global_efficiency": 0.282,
    "avg_path_length": 2.6496,
    "avg_degree_centrality": 0.0144,
    "max_degree_centrality": 0.5126,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.033,
    "degree_assortativity": -0.2391,
    "graph_robustness": 0.8059,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2795,
    "weakly_connected_components": 62,
    "largest_wcc_size": 297,
    "pagerank_top10_percent": 9.35,
    "louvain_communities": 72,
    "louvain_modularity": 0.4191,
    "label_entropy": 1.4994,
    "computational_time": 0.29790390201378614
  },
  "retrieval_queries": []
}
2025-11-30 21:55:00,980 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:55:00,980 - src.pipeline.kg_builder - INFO - Batch 39 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 20.59s, Clean: 0.00s, Neo4j: 0.09s, ACS: 0.30s
2025-11-30 21:55:00,980 - src.pipeline.kg_builder - INFO - Batch 39 completed in 20.98s
Processing KG batches:  54%|█████▍    | 39/72 [14:42<11:49, 21.51s/it]2025-11-30 21:55:00,980 - src.pipeline.kg_builder - INFO - Processing batch 40/72 (3 items)
2025-11-30 21:55:00,980 - src.pipeline.kg_builder - DEBUG - Batch 40 current_video_time: 09:53-09:58
2025-11-30 21:55:00,987 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 358
- Total Relationships: 276
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:55:00,987 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:55:00,987 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0 ~222 words, content: Time: 09:43-09:48 Content: The video sequence captures a detailed laboratory procedure, likely the preparation of a chemical solution, from a first-person perspective. The scene is...
2025-11-30 21:55:00,987 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1 ~235 words, content: **Final Transfer:** In the final frames, the person is again seen pouring a liquid from a small test tube into the larger flask. This action...
2025-11-30 21:55:00,987 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_2 ~225 words, content: contributing to the context of a scientific experiment. The overall action is one of meticulous measurement and preparation. Time: 09:53-09:58 Content: The video sequence captures...
2025-11-30 21:55:00,987 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_3 ~227 words, content: . - **Frame 3:** The person has placed the volumetric flask back on the balance. The display now shows a non-zero value, indicating that the...
2025-11-30 21:55:00,987 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:55:00,987 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:55:02,311 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:55:02,311 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:55:02,311 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1) (~235 words) with timeout=5.0s retries=3
2025-11-30 21:55:03,596 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:55:03,596 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:55:03,596 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_2) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:55:05,049 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:55:05,049 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:55:05,050 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_3) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:55:06,056 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:55:06,057 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:55:06,057 - src.components.pre_llm_injector - INFO - Extracted 20 local triplets from 4 chunks
2025-11-30 21:55:06,057 - src.pipeline.kg_builder - INFO - Pre-extraction: 20 triplets in 5.07s
2025-11-30 21:55:06,057 - src.components.global_refiner - INFO - Capping refinement input: 20 → 15 triplets
2025-11-30 21:55:06,057 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 358
- Total Relationships: 276
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_2"]}, {"head": "Person", "relation": "Holds", "tail": "Test_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_2"]}, {"head": "Person", "relation": "Uses", "tail": "Digital_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "0.0000_G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid_To_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1"]}, {"head": "Glass_Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1"]}, {"head": "Digital_Balance", "relation": "Is On", "tail": "Lab_Bench", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Digital_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_2"]}, {"head": "Volumetric_Flask", "relation": "Is On", "tail": "Precision_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_2"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_2"]}, {"head": "Precision_Balance", "relation": "Displays", "tail": "0.000_G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_2"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:55:06,058 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~242 words, ~315 tokens)
2025-11-30 21:55:06,058 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:55:20,493 - src.components.global_refiner - DEBUG - LLM call completed in 14.44s
2025-11-30 21:55:20,493 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_2']], ['Person', 'holds', 'Test_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0']], ['Person', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_2']], ['Person', 'transfers', 'Liquid_To_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0']], ['Person', 'uses', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0']], ['Digital_Balance', 'displays', '0.0000_G', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0']], ['Digital_Balance', 'is_on', 'Lab_Bench', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1']], ['Lab_Bench', 'contains', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1']], ['Person', 'holds', 'Glass_Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1']], ['Glass_Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1']]]
2025-11-30 21:55:20,493 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Test_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_2"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid_To_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "0.0000_G",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_0"
    ]
  ],
  [
    "Digital_Balance",
    "is_on",
    "Lab_Bench",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1"
    ]
  ],
  [
    "Glass_Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_39_1"
    ]
  ]
]
2025-11-30 21:55:20,493 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 14.44s, LLM: 14.44s)
2025-11-30 21:55:20,493 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 14.44s
2025-11-30 21:55:20,493 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:55:20,494 - src.pipeline.kg_builder - INFO - Pushing batch 40/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:55:20,494 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:55:20,654 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:55:20,654 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:55:20,654 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:55:20,654 - src.components.neo4j_handler - INFO - Batch injected in 0.16s (triplets: 0.16s, indexes: 0.00s)
2025-11-30 21:55:20,655 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 190, 'with_embedding': 0, 'linked_chunks': 128}
2025-11-30 21:55:20,655 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:55:20,691 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 363 nodes
2025-11-30 21:55:20,789 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 301 nodes
2025-11-30 21:55:20,903 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 363, 'relationship_count': 941, 'density': 0.0072, 'avg_degree': 5.1846, 'avg_unique_neighbors': 5.1405, 'global_efficiency': 0.2827, 'avg_path_length': 2.6395, 'avg_degree_centrality': 0.0143, 'max_degree_centrality': 0.5166, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.025, 'degree_assortativity': -0.2408, 'graph_robustness': 0.8002, 'diameter_estimate': 5, 'clustering_coefficient': 0.2784, 'weakly_connected_components': 63, 'largest_wcc_size': 301, 'pagerank_top10_percent': 9.24, 'louvain_communities': 73, 'louvain_modularity': 0.4059, 'label_entropy': 1.4992, 'computational_time': 0.24839810701087117}
2025-11-30 21:55:20,904 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 39, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510920.9040353, 'total_time': 19.92328660900239, 'aggregation': 2.346932888031006e-06, 'network_info': 0.006161123048514128, 'llm_extraction': 19.506901655113325, 'data_cleaning': 2.4279928766191006e-05, 'neo4j_injection': 0.16030392900574952, 'embedding_time': 0, 'indexing_time': 0.0036771820159628987, 'graph_injection_time': 0.15637422201689333, 'acs_metrics': {'node_count': 363, 'relationship_count': 941, 'density': 0.0072, 'avg_degree': 5.1846, 'avg_unique_neighbors': 5.1405, 'global_efficiency': 0.2827, 'avg_path_length': 2.6395, 'avg_degree_centrality': 0.0143, 'max_degree_centrality': 0.5166, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.025, 'degree_assortativity': -0.2408, 'graph_robustness': 0.8002, 'diameter_estimate': 5, 'clustering_coefficient': 0.2784, 'weakly_connected_components': 63, 'largest_wcc_size': 301, 'pagerank_top10_percent': 9.24, 'louvain_communities': 73, 'louvain_modularity': 0.4059, 'label_entropy': 1.4992, 'computational_time': 0.24839810701087117}, 'retrieval_queries': []}
2025-11-30 21:55:20,904 - src.pipeline.kg_builder - DEBUG - Batch 39 metrics: {
  "batch_idx": 39,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510920.9040353,
  "total_time": 19.92328660900239,
  "aggregation": 2.346932888031006e-06,
  "network_info": 0.006161123048514128,
  "llm_extraction": 19.506901655113325,
  "data_cleaning": 2.4279928766191006e-05,
  "neo4j_injection": 0.16030392900574952,
  "embedding_time": 0,
  "indexing_time": 0.0036771820159628987,
  "graph_injection_time": 0.15637422201689333,
  "acs_metrics": {
    "node_count": 363,
    "relationship_count": 941,
    "density": 0.0072,
    "avg_degree": 5.1846,
    "avg_unique_neighbors": 5.1405,
    "global_efficiency": 0.2827,
    "avg_path_length": 2.6395,
    "avg_degree_centrality": 0.0143,
    "max_degree_centrality": 0.5166,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.025,
    "degree_assortativity": -0.2408,
    "graph_robustness": 0.8002,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2784,
    "weakly_connected_components": 63,
    "largest_wcc_size": 301,
    "pagerank_top10_percent": 9.24,
    "louvain_communities": 73,
    "louvain_modularity": 0.4059,
    "label_entropy": 1.4992,
    "computational_time": 0.24839810701087117
  },
  "retrieval_queries": []
}
2025-11-30 21:55:20,904 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:55:20,904 - src.pipeline.kg_builder - INFO - Batch 40 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.51s, Clean: 0.00s, Neo4j: 0.16s, ACS: 0.25s
2025-11-30 21:55:20,904 - src.pipeline.kg_builder - INFO - Batch 40 completed in 19.92s
Processing KG batches:  56%|█████▌    | 40/72 [15:02<11:13, 21.03s/it]2025-11-30 21:55:20,905 - src.pipeline.kg_builder - INFO - Processing batch 41/72 (3 items)
2025-11-30 21:55:20,905 - src.pipeline.kg_builder - DEBUG - Batch 41 current_video_time: 10:08-10:13
2025-11-30 21:55:20,917 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 363
- Total Relationships: 279
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:55:20,917 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:55:20,917 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0 ~209 words, content: Time: 09:58-10:03 Content: The video sequence captures a detailed laboratory procedure, likely a chemical titration or solution preparation, from a first-person perspective. The scene is...
2025-11-30 21:55:20,917 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1 ~224 words, content: , which is a METTLER TOLEDO model, is visible in the background, indicating that the procedure may involve weighing the liquid to ensure accuracy. The...
2025-11-30 21:55:20,917 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_2 ~233 words, content: tte, filled with a clear liquid. The person is carefully adjusting the liquid level in the burette, a common step in titration experiments to ensure...
2025-11-30 21:55:20,917 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_3 ~207 words, content: of precision and accuracy in laboratory work. In summary, the video shows a person preparing a solution for a titration experiment. They carefully adjust the...
2025-11-30 21:55:20,917 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_4 ~170 words, content: markings. - **Pipette:** Used to transfer a precise volume of liquid from the flask to the burette. - **Round-Bottom Flask:** Contains a clear liquid and...
2025-11-30 21:55:20,917 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:55:20,917 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0) (~209 words) with timeout=5.0s retries=3
2025-11-30 21:55:22,132 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:55:22,132 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:55:22,132 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:55:23,179 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:55:23,179 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:55:23,180 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_2) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:55:24,178 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:55:24,178 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:55:24,179 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_3) (~207 words) with timeout=5.0s retries=3
2025-11-30 21:55:25,266 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:55:25,266 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:55:25,267 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_4) (~170 words) with timeout=5.0s retries=3
2025-11-30 21:55:26,659 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:55:26,659 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:55:26,659 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 5 chunks
2025-11-30 21:55:26,659 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 5.74s
2025-11-30 21:55:26,660 - src.components.global_refiner - INFO - Capping refinement input: 22 → 15 triplets
2025-11-30 21:55:26,660 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 363
- Total Relationships: 279
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_3"]}, {"head": "Person", "relation": "Holds", "tail": "Burette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_3"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0"]}, {"head": "Burette", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_3"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0"]}, {"head": "Person", "relation": "Wears", "tail": "Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1"]}, {"head": "Person", "relation": "Handles", "tail": "Burette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "Digital Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1"]}, {"head": "Digital Balance", "relation": "Is Used For", "tail": "Weighing", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1"]}, {"head": "Person", "relation": "Performs", "tail": "Liquid Transfer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1"]}, {"head": "Person", "relation": "Adjusts", "tail": "Burette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_2"]}, {"head": "Burette", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_3", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:55:26,660 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~248 words, ~322 tokens)
2025-11-30 21:55:26,660 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:55:40,942 - src.components.global_refiner - DEBUG - LLM call completed in 14.28s
2025-11-30 21:55:40,942 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_3']], ['Person', 'holds', 'Burette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_3']], ['Person', 'holds', 'Volumetric_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0']], ['Burette', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_3']], ['Volumetric_Flask', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0']], ['Person', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0']], ['Person', 'wears', 'Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1']], ['Person', 'handles', 'Burette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1']], ['Lab_Environment', 'contains', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1']], ['Digital_Balance', 'is_used_for', 'Weighing', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1']]]
2025-11-30 21:55:40,942 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Burette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0"
    ]
  ],
  [
    "Burette",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_3"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1"
    ]
  ],
  [
    "Person",
    "handles",
    "Burette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1"
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1"
    ]
  ],
  [
    "Digital_Balance",
    "is_used_for",
    "Weighing",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_40_1"
    ]
  ]
]
2025-11-30 21:55:40,942 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 14.28s, LLM: 14.28s)
2025-11-30 21:55:40,942 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 14.28s
2025-11-30 21:55:40,942 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:55:40,942 - src.pipeline.kg_builder - INFO - Pushing batch 41/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:55:40,942 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:55:41,093 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:55:41,093 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:55:41,094 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:55:41,094 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.15s, indexes: 0.01s)
2025-11-30 21:55:41,095 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 195, 'with_embedding': 0, 'linked_chunks': 131}
2025-11-30 21:55:41,095 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:55:41,132 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 371 nodes
2025-11-30 21:55:41,235 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 307 nodes
2025-11-30 21:55:41,360 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 371, 'relationship_count': 962, 'density': 0.007, 'avg_degree': 5.186, 'avg_unique_neighbors': 5.1429, 'global_efficiency': 0.2821, 'avg_path_length': 2.6323, 'avg_degree_centrality': 0.014, 'max_degree_centrality': 0.5189, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0357, 'degree_assortativity': -0.2441, 'graph_robustness': 0.7983, 'diameter_estimate': 5, 'clustering_coefficient': 0.2783, 'weakly_connected_components': 65, 'largest_wcc_size': 307, 'pagerank_top10_percent': 9.06, 'louvain_communities': 75, 'louvain_modularity': 0.4075, 'label_entropy': 1.4991, 'computational_time': 0.2651640430558473}
2025-11-30 21:55:41,360 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 40, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510941.3607342, 'total_time': 20.455675417091697, 'aggregation': 2.4479813873767853e-06, 'network_info': 0.011848564958199859, 'llm_extraction': 20.025606700917706, 'data_cleaning': 2.466596197336912e-05, 'neo4j_injection': 0.15143260196782649, 'embedding_time': 0, 'indexing_time': 0.005174302030354738, 'graph_injection_time': 0.14599711901973933, 'acs_metrics': {'node_count': 371, 'relationship_count': 962, 'density': 0.007, 'avg_degree': 5.186, 'avg_unique_neighbors': 5.1429, 'global_efficiency': 0.2821, 'avg_path_length': 2.6323, 'avg_degree_centrality': 0.014, 'max_degree_centrality': 0.5189, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0357, 'degree_assortativity': -0.2441, 'graph_robustness': 0.7983, 'diameter_estimate': 5, 'clustering_coefficient': 0.2783, 'weakly_connected_components': 65, 'largest_wcc_size': 307, 'pagerank_top10_percent': 9.06, 'louvain_communities': 75, 'louvain_modularity': 0.4075, 'label_entropy': 1.4991, 'computational_time': 0.2651640430558473}, 'retrieval_queries': []}
2025-11-30 21:55:41,360 - src.pipeline.kg_builder - DEBUG - Batch 40 metrics: {
  "batch_idx": 40,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510941.3607342,
  "total_time": 20.455675417091697,
  "aggregation": 2.4479813873767853e-06,
  "network_info": 0.011848564958199859,
  "llm_extraction": 20.025606700917706,
  "data_cleaning": 2.466596197336912e-05,
  "neo4j_injection": 0.15143260196782649,
  "embedding_time": 0,
  "indexing_time": 0.005174302030354738,
  "graph_injection_time": 0.14599711901973933,
  "acs_metrics": {
    "node_count": 371,
    "relationship_count": 962,
    "density": 0.007,
    "avg_degree": 5.186,
    "avg_unique_neighbors": 5.1429,
    "global_efficiency": 0.2821,
    "avg_path_length": 2.6323,
    "avg_degree_centrality": 0.014,
    "max_degree_centrality": 0.5189,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0357,
    "degree_assortativity": -0.2441,
    "graph_robustness": 0.7983,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2783,
    "weakly_connected_components": 65,
    "largest_wcc_size": 307,
    "pagerank_top10_percent": 9.06,
    "louvain_communities": 75,
    "louvain_modularity": 0.4075,
    "label_entropy": 1.4991,
    "computational_time": 0.2651640430558473
  },
  "retrieval_queries": []
}
2025-11-30 21:55:41,361 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:55:41,361 - src.pipeline.kg_builder - INFO - Batch 41 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 20.03s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.27s
2025-11-30 21:55:41,361 - src.pipeline.kg_builder - INFO - Batch 41 completed in 20.46s
Processing KG batches:  57%|█████▋    | 41/72 [15:22<10:46, 20.86s/it]2025-11-30 21:55:41,361 - src.pipeline.kg_builder - INFO - Processing batch 42/72 (3 items)
2025-11-30 21:55:41,361 - src.pipeline.kg_builder - DEBUG - Batch 42 current_video_time: 10:23-10:28
2025-11-30 21:55:41,369 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 371
- Total Relationships: 285
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:55:41,369 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:55:41,369 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0 ~220 words, content: Time: 10:13-10:18 Content: The sequence of frames captures a precise laboratory procedure, likely a titration or the preparation of a solution, from a first-person perspective....
2025-11-30 21:55:41,369 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1 ~227 words, content: clear. The action is deliberate and controlled, suggesting a need for precision. - **Final Adjustment:** The person continues to add the liquid from the pipette...
2025-11-30 21:55:41,370 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_2 ~229 words, content: The person's right hand is using a pipette to add a clear liquid drop by drop into the graduated cylinder. The liquid being added is...
2025-11-30 21:55:41,370 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_3 ~226 words, content: digital balance, a magnetic stirrer, and a volumetric flask. - **Initial Action:** The primary focus is on a person wearing blue nitrile gloves, who is...
2025-11-30 21:55:41,370 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_4 ~54 words, content: is one of concentration and precision, highlighting the importance of accuracy in scientific research. In summary, the video shows a detailed and methodical process of...
2025-11-30 21:55:41,370 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:55:41,370 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0) (~220 words) with timeout=5.0s retries=3
2025-11-30 21:55:42,712 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:55:42,712 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:55:42,712 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:55:43,904 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:55:43,904 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:55:43,904 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_2) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:55:45,284 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:55:45,284 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:55:45,285 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_3) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:55:46,487 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:55:46,487 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:55:46,488 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_4) (~54 words) with timeout=5.0s retries=3
2025-11-30 21:55:47,574 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:55:47,574 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:55:47,574 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 5 chunks
2025-11-30 21:55:47,575 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 6.21s
2025-11-30 21:55:47,575 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 21:55:47,575 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 371
- Total Relationships: 285
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_3"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated_Cylinder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_3"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0"]}, {"head": "Graduated_Cylinder", "relation": "Receives", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1"]}, {"head": "Person", "relation": "Adds", "tail": "Liquid_To_Graduated_Cylinder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0"]}, {"head": "Pipette", "relation": "Delivers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1"]}, {"head": "Person", "relation": "Controls", "tail": "Liquid_Transfer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_2"]}, {"head": "Pipette", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_2"]}, {"head": "Liquid", "relation": "Enters", "tail": "Graduated_Cylinder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_2"]}, {"head": "Person", "relation": "Observes", "tail": "Graduated_Cylinder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_2"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "0.000_G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_2"]}, {"head": "Magnetic_Stirrer", "relation": "Has", "tail": "Glass_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_2"]}, {"head": "Person", "relation": "Stands Near", "tail": "Digital_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:55:47,575 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~243 words, ~316 tokens)
2025-11-30 21:55:47,575 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:56:04,321 - src.components.global_refiner - DEBUG - LLM call completed in 16.75s
2025-11-30 21:56:04,321 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_3']], ['Person', 'holds', 'Graduated_Cylinder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_3']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_3']], ['Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0']], ['Graduated_Cylinder', 'receives', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1']], ['Person', 'adds', 'Liquid_To_Graduated_Cylinder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0']], ['Pipette', 'delivers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1']], ['Person', 'controls', 'Liquid_Transfer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1']], ['Person', 'holds', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_2']], ['Pipette', 'dispenses', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_2']]]
2025-11-30 21:56:04,321 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Graduated_Cylinder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_3"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0"
    ]
  ],
  [
    "Graduated_Cylinder",
    "receives",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1"
    ]
  ],
  [
    "Person",
    "adds",
    "Liquid_To_Graduated_Cylinder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_0"
    ]
  ],
  [
    "Pipette",
    "delivers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1"
    ]
  ],
  [
    "Person",
    "controls",
    "Liquid_Transfer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_2"
    ]
  ],
  [
    "Pipette",
    "dispenses",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_41_2"
    ]
  ]
]
2025-11-30 21:56:04,322 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 16.75s, LLM: 16.75s)
2025-11-30 21:56:04,322 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 16.75s
2025-11-30 21:56:04,322 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:56:04,322 - src.pipeline.kg_builder - INFO - Pushing batch 42/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:56:04,322 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:56:04,491 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:56:04,491 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:56:04,491 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:56:04,491 - src.components.neo4j_handler - INFO - Batch injected in 0.17s (triplets: 0.16s, indexes: 0.00s)
2025-11-30 21:56:04,492 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 200, 'with_embedding': 0, 'linked_chunks': 135}
2025-11-30 21:56:04,492 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:56:04,532 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 378 nodes
2025-11-30 21:56:04,640 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 313 nodes
2025-11-30 21:56:04,771 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 378, 'relationship_count': 983, 'density': 0.0069, 'avg_degree': 5.2011, 'avg_unique_neighbors': 5.1587, 'global_efficiency': 0.2833, 'avg_path_length': 2.622, 'avg_degree_centrality': 0.0138, 'max_degree_centrality': 0.5252, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0358, 'degree_assortativity': -0.2469, 'graph_robustness': 0.8006, 'diameter_estimate': 5, 'clustering_coefficient': 0.2798, 'weakly_connected_components': 66, 'largest_wcc_size': 313, 'pagerank_top10_percent': 8.92, 'louvain_communities': 77, 'louvain_modularity': 0.3949, 'label_entropy': 1.4988, 'computational_time': 0.27843038097489625}
2025-11-30 21:56:04,771 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 41, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510964.771238, 'total_time': 23.409387113060802, 'aggregation': 3.0170194804668427e-06, 'network_info': 0.007469094009138644, 'llm_extraction': 22.95274729200173, 'data_cleaning': 2.4225912056863308e-05, 'neo4j_injection': 0.16912805009633303, 'embedding_time': 0, 'indexing_time': 0.004289997974410653, 'graph_injection_time': 0.16458806896116585, 'acs_metrics': {'node_count': 378, 'relationship_count': 983, 'density': 0.0069, 'avg_degree': 5.2011, 'avg_unique_neighbors': 5.1587, 'global_efficiency': 0.2833, 'avg_path_length': 2.622, 'avg_degree_centrality': 0.0138, 'max_degree_centrality': 0.5252, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0358, 'degree_assortativity': -0.2469, 'graph_robustness': 0.8006, 'diameter_estimate': 5, 'clustering_coefficient': 0.2798, 'weakly_connected_components': 66, 'largest_wcc_size': 313, 'pagerank_top10_percent': 8.92, 'louvain_communities': 77, 'louvain_modularity': 0.3949, 'label_entropy': 1.4988, 'computational_time': 0.27843038097489625}, 'retrieval_queries': []}
2025-11-30 21:56:04,771 - src.pipeline.kg_builder - DEBUG - Batch 41 metrics: {
  "batch_idx": 41,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510964.771238,
  "total_time": 23.409387113060802,
  "aggregation": 3.0170194804668427e-06,
  "network_info": 0.007469094009138644,
  "llm_extraction": 22.95274729200173,
  "data_cleaning": 2.4225912056863308e-05,
  "neo4j_injection": 0.16912805009633303,
  "embedding_time": 0,
  "indexing_time": 0.004289997974410653,
  "graph_injection_time": 0.16458806896116585,
  "acs_metrics": {
    "node_count": 378,
    "relationship_count": 983,
    "density": 0.0069,
    "avg_degree": 5.2011,
    "avg_unique_neighbors": 5.1587,
    "global_efficiency": 0.2833,
    "avg_path_length": 2.622,
    "avg_degree_centrality": 0.0138,
    "max_degree_centrality": 0.5252,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0358,
    "degree_assortativity": -0.2469,
    "graph_robustness": 0.8006,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2798,
    "weakly_connected_components": 66,
    "largest_wcc_size": 313,
    "pagerank_top10_percent": 8.92,
    "louvain_communities": 77,
    "louvain_modularity": 0.3949,
    "label_entropy": 1.4988,
    "computational_time": 0.27843038097489625
  },
  "retrieval_queries": []
}
2025-11-30 21:56:04,772 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:56:04,772 - src.pipeline.kg_builder - INFO - Batch 42 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 22.95s, Clean: 0.00s, Neo4j: 0.17s, ACS: 0.28s
2025-11-30 21:56:04,772 - src.pipeline.kg_builder - INFO - Batch 42 completed in 23.41s
Processing KG batches:  58%|█████▊    | 42/72 [15:46<10:48, 21.63s/it]2025-11-30 21:56:04,772 - src.pipeline.kg_builder - INFO - Processing batch 43/72 (3 items)
2025-11-30 21:56:04,772 - src.pipeline.kg_builder - DEBUG - Batch 43 current_video_time: 10:38-10:43
2025-11-30 21:56:04,782 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 378
- Total Relationships: 289
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:56:04,783 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:56:04,783 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0 ~222 words, content: Time: 10:28-10:33 Content: The video captures a detailed, first-person perspective of a precise laboratory procedure, likely a titration or the preparation of a solution. The...
2025-11-30 21:56:04,783 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1 ~222 words, content: graduated cylinder, ensuring it is stable and properly aligned. The left hand, which is also wearing a black wristwatch, holds the cylinder firmly. The right...
2025-11-30 21:56:04,783 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2 ~222 words, content: and precise, suggesting the importance of accurate measurement. The surrounding environment provides context for the experiment: - To the left, a white bottle with a...
2025-11-30 21:56:04,783 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_3 ~198 words, content: pipette to transfer a clear liquid from a small vial into a larger, empty volumetric flask. The work is being done on a black countertop,...
2025-11-30 21:56:04,783 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:56:04,783 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:56:06,202 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:56:06,202 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:56:06,202 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:56:07,277 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:56:07,277 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:56:07,277 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:56:08,612 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:56:08,612 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:56:08,612 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_3) (~198 words) with timeout=5.0s retries=3
2025-11-30 21:56:09,799 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:56:09,799 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:56:09,799 - src.components.pre_llm_injector - INFO - Extracted 19 local triplets from 4 chunks
2025-11-30 21:56:09,799 - src.pipeline.kg_builder - INFO - Pre-extraction: 19 triplets in 5.02s
2025-11-30 21:56:09,800 - src.components.global_refiner - INFO - Capping refinement input: 19 → 15 triplets
2025-11-30 21:56:09,800 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 378
- Total Relationships: 289
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated_Cylinder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1"]}, {"head": "Pipette", "relation": "Adds", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0"]}, {"head": "Graduated_Cylinder", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0"]}, {"head": "Graduated_Cylinder", "relation": "Rests On", "tail": "Analytical_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated Cylinder", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_3"]}, {"head": "Graduated Cylinder", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1"]}, {"head": "Person", "relation": "Makes", "tail": "Final Adjustments", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Dark Opaque Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "0.000 G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2"]}, {"head": "Magnetic Stirrer", "relation": "Has", "tail": "Glass Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:56:09,800 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~252 words, ~328 tokens)
2025-11-30 21:56:09,800 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:56:26,730 - src.components.global_refiner - DEBUG - LLM call completed in 16.93s
2025-11-30 21:56:26,730 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2']], ['Person', 'holds', 'Graduated_Cylinder', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1']], ['Person', 'holds', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_3']], ['Pipette', 'adds', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0']], ['Graduated_Cylinder', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0']], ['Graduated_Cylinder', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1']], ['Graduated_Cylinder', 'rests_on', 'Analytical_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0']], ['Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_3']], ['Beaker', 'contains', 'Dark_Opaque_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2']], ['Digital_Balance', 'displays', '0.000_G', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2']]]
2025-11-30 21:56:26,730 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Graduated_Cylinder",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_3"
    ]
  ],
  [
    "Pipette",
    "adds",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0"
    ]
  ],
  [
    "Graduated_Cylinder",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0"
    ]
  ],
  [
    "Graduated_Cylinder",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_1"
    ]
  ],
  [
    "Graduated_Cylinder",
    "rests_on",
    "Analytical_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_0"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Dark_Opaque_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "0.000_G",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_42_2"
    ]
  ]
]
2025-11-30 21:56:26,730 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 16.93s, LLM: 16.93s)
2025-11-30 21:56:26,730 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 16.93s
2025-11-30 21:56:26,730 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:56:26,731 - src.pipeline.kg_builder - INFO - Pushing batch 43/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:56:26,731 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:56:26,906 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:56:26,906 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:56:26,906 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:56:26,906 - src.components.neo4j_handler - INFO - Batch injected in 0.18s (triplets: 0.17s, indexes: 0.01s)
2025-11-30 21:56:26,908 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 204, 'with_embedding': 0, 'linked_chunks': 139}
2025-11-30 21:56:26,908 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:56:26,949 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 383 nodes
2025-11-30 21:56:27,061 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 318 nodes
2025-11-30 21:56:27,195 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 383, 'relationship_count': 1007, 'density': 0.0069, 'avg_degree': 5.2585, 'avg_unique_neighbors': 5.2167, 'global_efficiency': 0.2854, 'avg_path_length': 2.6154, 'avg_degree_centrality': 0.0138, 'max_degree_centrality': 0.5288, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.036, 'degree_assortativity': -0.2428, 'graph_robustness': 0.7964, 'diameter_estimate': 5, 'clustering_coefficient': 0.2813, 'weakly_connected_components': 66, 'largest_wcc_size': 318, 'pagerank_top10_percent': 8.82, 'louvain_communities': 76, 'louvain_modularity': 0.4015, 'label_entropy': 1.4985, 'computational_time': 0.28683185391128063}
2025-11-30 21:56:27,195 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 42, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764510987.1953368, 'total_time': 22.423012915067375, 'aggregation': 2.5649787858128548e-06, 'network_info': 0.010449955007061362, 'llm_extraction': 21.94797732902225, 'data_cleaning': 2.456200309097767e-05, 'neo4j_injection': 0.17571854696143419, 'embedding_time': 0, 'indexing_time': 0.00527633388992399, 'graph_injection_time': 0.17019106005318463, 'acs_metrics': {'node_count': 383, 'relationship_count': 1007, 'density': 0.0069, 'avg_degree': 5.2585, 'avg_unique_neighbors': 5.2167, 'global_efficiency': 0.2854, 'avg_path_length': 2.6154, 'avg_degree_centrality': 0.0138, 'max_degree_centrality': 0.5288, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.036, 'degree_assortativity': -0.2428, 'graph_robustness': 0.7964, 'diameter_estimate': 5, 'clustering_coefficient': 0.2813, 'weakly_connected_components': 66, 'largest_wcc_size': 318, 'pagerank_top10_percent': 8.82, 'louvain_communities': 76, 'louvain_modularity': 0.4015, 'label_entropy': 1.4985, 'computational_time': 0.28683185391128063}, 'retrieval_queries': []}
2025-11-30 21:56:27,195 - src.pipeline.kg_builder - DEBUG - Batch 42 metrics: {
  "batch_idx": 42,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764510987.1953368,
  "total_time": 22.423012915067375,
  "aggregation": 2.5649787858128548e-06,
  "network_info": 0.010449955007061362,
  "llm_extraction": 21.94797732902225,
  "data_cleaning": 2.456200309097767e-05,
  "neo4j_injection": 0.17571854696143419,
  "embedding_time": 0,
  "indexing_time": 0.00527633388992399,
  "graph_injection_time": 0.17019106005318463,
  "acs_metrics": {
    "node_count": 383,
    "relationship_count": 1007,
    "density": 0.0069,
    "avg_degree": 5.2585,
    "avg_unique_neighbors": 5.2167,
    "global_efficiency": 0.2854,
    "avg_path_length": 2.6154,
    "avg_degree_centrality": 0.0138,
    "max_degree_centrality": 0.5288,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.036,
    "degree_assortativity": -0.2428,
    "graph_robustness": 0.7964,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2813,
    "weakly_connected_components": 66,
    "largest_wcc_size": 318,
    "pagerank_top10_percent": 8.82,
    "louvain_communities": 76,
    "louvain_modularity": 0.4015,
    "label_entropy": 1.4985,
    "computational_time": 0.28683185391128063
  },
  "retrieval_queries": []
}
2025-11-30 21:56:27,196 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:56:27,196 - src.pipeline.kg_builder - INFO - Batch 43 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 21.95s, Clean: 0.00s, Neo4j: 0.18s, ACS: 0.29s
2025-11-30 21:56:27,196 - src.pipeline.kg_builder - INFO - Batch 43 completed in 22.42s
Processing KG batches:  60%|█████▉    | 43/72 [16:08<10:34, 21.87s/it]2025-11-30 21:56:27,196 - src.pipeline.kg_builder - INFO - Processing batch 44/72 (3 items)
2025-11-30 21:56:27,196 - src.pipeline.kg_builder - DEBUG - Batch 44 current_video_time: 10:53-10:58
2025-11-30 21:56:27,208 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 383
- Total Relationships: 292
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:56:27,208 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:56:27,208 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0 ~217 words, content: Time: 10:43-10:48 Content: The video sequence captures a detailed laboratory procedure, likely a chemical preparation or analysis, performed by a person wearing blue nitrile gloves....
2025-11-30 21:56:27,208 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1 ~230 words, content: an empty container before tare. This suggests the person has just tared the balance, setting the weight of the empty vial to zero. The person...
2025-11-30 21:56:27,208 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_2 ~230 words, content: nitrile gloves is handling a small, clear glass vial. In the foreground, a digital analytical balance is visible, with its display reading "0.000". To the...
2025-11-30 21:56:27,208 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_3 ~220 words, content: . The digital balance is on the left, and the magnetic stirrer is in the center. A person's hand, wearing a blue glove, is seen...
2025-11-30 21:56:27,208 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_4 ~217 words, content: the left, a digital balance scale is visible, with its display reading `0.000`. To the right, a magnetic stirrer holds a beaker, and a burette...
2025-11-30 21:56:27,209 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_5 ~82 words, content: , remains in place, indicating that the experiment is ongoing. The overall atmosphere is one of concentration and precision, typical of a scientific research environment....
2025-11-30 21:56:27,209 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:56:27,209 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0) (~217 words) with timeout=5.0s retries=3
2025-11-30 21:56:28,609 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:56:28,610 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:56:28,610 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1) (~230 words) with timeout=5.0s retries=3
2025-11-30 21:56:29,895 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:56:29,895 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:56:29,896 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_2) (~230 words) with timeout=5.0s retries=3
2025-11-30 21:56:31,203 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:56:31,204 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:56:31,204 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_3) (~220 words) with timeout=5.0s retries=3
2025-11-30 21:56:32,443 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:56:32,443 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:56:32,443 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_4) (~217 words) with timeout=5.0s retries=3
2025-11-30 21:56:33,792 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:56:33,792 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:56:33,793 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_5) (~82 words) with timeout=5.0s retries=3
2025-11-30 21:56:34,886 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:56:34,886 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:56:34,886 - src.components.pre_llm_injector - INFO - Extracted 33 local triplets from 6 chunks
2025-11-30 21:56:34,886 - src.pipeline.kg_builder - INFO - Pre-extraction: 33 triplets in 7.68s
2025-11-30 21:56:34,887 - src.components.global_refiner - INFO - Capping refinement input: 33 → 15 triplets
2025-11-30 21:56:34,887 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 383
- Total Relationships: 292
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0"]}, {"head": "Person", "relation": "Handles", "tail": "Glass_Vial", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0"]}, {"head": "Glass_Vial", "relation": "Is Placed On", "tail": "Digital_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Zero_Grams", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0"]}, {"head": "Person", "relation": "Moves", "tail": "Glass_Vial", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0"]}, {"head": "Glass_Vial", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_4"]}, {"head": "Person", "relation": "Holds", "tail": "Vial", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1"]}, {"head": "Vial", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1"]}, {"head": "Vial", "relation": "Is Placed On", "tail": "Digital Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "0.000 G", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1"]}, {"head": "Person", "relation": "Performs", "tail": "Weighing Procedure", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Vial", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "0.000", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_4"]}, {"head": "Glass Vial", "relation": "Contains", "tail": "White Solid Substance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:56:34,888 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~252 words, ~328 tokens)
2025-11-30 21:56:34,888 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:56:53,165 - src.components.global_refiner - DEBUG - LLM call completed in 18.28s
2025-11-30 21:56:53,165 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_4']], ['Person', 'handles', 'Glass_Vial', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0']], ['Glass_Vial', 'is_placed_on', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_2']], ['Digital_Balance', 'displays', 'Zero_Grams', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0']], ['Digital_Balance', 'displays', '0.000_G', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_4']], ['Person', 'moves', 'Glass_Vial', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0']], ['Glass_Vial', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0']], ['Person', 'holds', 'Vial', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1']], ['Vial', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1']], ['Person', 'performs', 'Weighing_Procedure', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1']], ['Person', 'holds', 'Glass_Vial', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_2']], ['Glass_Vial', 'contains', 'White_Solid_Substance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_2']]]
2025-11-30 21:56:53,165 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_4"
    ]
  ],
  [
    "Person",
    "handles",
    "Glass_Vial",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0"
    ]
  ],
  [
    "Glass_Vial",
    "is_placed_on",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Zero_Grams",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "0.000_G",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_4"
    ]
  ],
  [
    "Person",
    "moves",
    "Glass_Vial",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0"
    ]
  ],
  [
    "Glass_Vial",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Vial",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1"
    ]
  ],
  [
    "Vial",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1"
    ]
  ],
  [
    "Person",
    "performs",
    "Weighing_Procedure",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Vial",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_2"
    ]
  ],
  [
    "Glass_Vial",
    "contains",
    "White_Solid_Substance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_43_2"
    ]
  ]
]
2025-11-30 21:56:53,166 - src.components.global_refiner - INFO - Refinement complete: 15 → 12 triplets (total: 18.28s, LLM: 18.28s)
2025-11-30 21:56:53,166 - src.pipeline.kg_builder - INFO - Global refinement: 12 triplets in 18.28s
2025-11-30 21:56:53,166 - src.pipeline.kg_builder - INFO - Using 12 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:56:53,166 - src.pipeline.kg_builder - INFO - Pushing batch 44/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:56:53,166 - src.components.neo4j_handler - INFO - Adding 12 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:56:53,363 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:56:53,363 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:56:53,364 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:56:53,364 - src.components.neo4j_handler - INFO - Batch injected in 0.20s (triplets: 0.19s, indexes: 0.00s)
2025-11-30 21:56:53,365 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 210, 'with_embedding': 0, 'linked_chunks': 143}
2025-11-30 21:56:53,365 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:56:53,406 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 392 nodes
2025-11-30 21:56:53,521 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 325 nodes
2025-11-30 21:56:53,657 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 392, 'relationship_count': 1038, 'density': 0.0068, 'avg_degree': 5.2959, 'avg_unique_neighbors': 5.2551, 'global_efficiency': 0.2861, 'avg_path_length': 2.5984, 'avg_degree_centrality': 0.0135, 'max_degree_centrality': 0.5345, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0438, 'degree_assortativity': -0.2479, 'graph_robustness': 0.7929, 'diameter_estimate': 5, 'clustering_coefficient': 0.2798, 'weakly_connected_components': 68, 'largest_wcc_size': 325, 'pagerank_top10_percent': 8.63, 'louvain_communities': 79, 'louvain_modularity': 0.3988, 'label_entropy': 1.4982, 'computational_time': 0.2925632391124964}
2025-11-30 21:56:53,658 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 43, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511013.6580772, 'total_time': 26.461630717967637, 'aggregation': 2.8349459171295166e-06, 'network_info': 0.011748895049095154, 'llm_extraction': 25.957755804993212, 'data_cleaning': 2.0000035874545574e-05, 'neo4j_injection': 0.1979890379589051, 'embedding_time': 0, 'indexing_time': 0.003580427961423993, 'graph_injection_time': 0.19420934189110994, 'acs_metrics': {'node_count': 392, 'relationship_count': 1038, 'density': 0.0068, 'avg_degree': 5.2959, 'avg_unique_neighbors': 5.2551, 'global_efficiency': 0.2861, 'avg_path_length': 2.5984, 'avg_degree_centrality': 0.0135, 'max_degree_centrality': 0.5345, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0438, 'degree_assortativity': -0.2479, 'graph_robustness': 0.7929, 'diameter_estimate': 5, 'clustering_coefficient': 0.2798, 'weakly_connected_components': 68, 'largest_wcc_size': 325, 'pagerank_top10_percent': 8.63, 'louvain_communities': 79, 'louvain_modularity': 0.3988, 'label_entropy': 1.4982, 'computational_time': 0.2925632391124964}, 'retrieval_queries': []}
2025-11-30 21:56:53,658 - src.pipeline.kg_builder - DEBUG - Batch 43 metrics: {
  "batch_idx": 43,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511013.6580772,
  "total_time": 26.461630717967637,
  "aggregation": 2.8349459171295166e-06,
  "network_info": 0.011748895049095154,
  "llm_extraction": 25.957755804993212,
  "data_cleaning": 2.0000035874545574e-05,
  "neo4j_injection": 0.1979890379589051,
  "embedding_time": 0,
  "indexing_time": 0.003580427961423993,
  "graph_injection_time": 0.19420934189110994,
  "acs_metrics": {
    "node_count": 392,
    "relationship_count": 1038,
    "density": 0.0068,
    "avg_degree": 5.2959,
    "avg_unique_neighbors": 5.2551,
    "global_efficiency": 0.2861,
    "avg_path_length": 2.5984,
    "avg_degree_centrality": 0.0135,
    "max_degree_centrality": 0.5345,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0438,
    "degree_assortativity": -0.2479,
    "graph_robustness": 0.7929,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2798,
    "weakly_connected_components": 68,
    "largest_wcc_size": 325,
    "pagerank_top10_percent": 8.63,
    "louvain_communities": 79,
    "louvain_modularity": 0.3988,
    "label_entropy": 1.4982,
    "computational_time": 0.2925632391124964
  },
  "retrieval_queries": []
}
2025-11-30 21:56:53,659 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:56:53,659 - src.pipeline.kg_builder - INFO - Batch 44 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 25.96s, Clean: 0.00s, Neo4j: 0.20s, ACS: 0.29s
2025-11-30 21:56:53,659 - src.pipeline.kg_builder - INFO - Batch 44 completed in 26.46s
Processing KG batches:  61%|██████    | 44/72 [16:35<10:50, 23.24s/it]2025-11-30 21:56:53,659 - src.pipeline.kg_builder - INFO - Processing batch 45/72 (3 items)
2025-11-30 21:56:53,659 - src.pipeline.kg_builder - DEBUG - Batch 45 current_video_time: 11:08-11:13
2025-11-30 21:56:53,669 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 392
- Total Relationships: 302
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:56:53,669 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:56:53,669 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0 ~223 words, content: Time: 10:58-11:03 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a similar chemical analysis, performed by a person wearing blue...
2025-11-30 21:56:53,669 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1 ~222 words, content: , a glass beaker on a stirrer, and a burette clamped to a stand on the right. Other items like a bottle with a red...
2025-11-30 21:56:53,669 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_2 ~217 words, content: experiment is taking place on a black laboratory bench. The setup includes: - A glass beaker on an electronic balance. - A blue magnetic stirrer...
2025-11-30 21:56:53,669 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_3 ~225 words, content: presence of a stirrer, a stand with a tube, and other equipment suggests a chemical synthesis or a reaction setup. Another person is observing the...
2025-11-30 21:56:53,669 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_4 ~163 words, content: . The camera angle changes again, showing more of the lab environment, including white cabinets and a fire extinguisher in the background. The person's hand...
2025-11-30 21:56:53,669 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:56:53,670 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0) (~223 words) with timeout=5.0s retries=3
2025-11-30 21:56:55,052 - src.components.pre_llm_injector - DEBUG - Extracted 5 triplets from chunk 0 (attempt 1)
2025-11-30 21:56:55,052 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 5 triplets
2025-11-30 21:56:55,052 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:56:56,076 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:56:56,076 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:56:56,077 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_2) (~217 words) with timeout=5.0s retries=3
2025-11-30 21:56:57,180 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:56:57,181 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:56:57,181 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_3) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:56:58,464 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:56:58,464 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:56:58,465 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_4) (~163 words) with timeout=5.0s retries=3
2025-11-30 21:56:59,551 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:56:59,552 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:56:59,552 - src.components.pre_llm_injector - INFO - Extracted 26 local triplets from 5 chunks
2025-11-30 21:56:59,552 - src.pipeline.kg_builder - INFO - Pre-extraction: 26 triplets in 5.88s
2025-11-30 21:56:59,552 - src.components.global_refiner - INFO - Capping refinement input: 26 → 15 triplets
2025-11-30 21:56:59,552 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 392
- Total Relationships: 302
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_3"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Vial", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_3"]}, {"head": "Glass_Vial", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0"]}, {"head": "Device", "relation": "Displays", "tail": "0.352", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0"]}, {"head": "Device", "relation": "Has", "tail": "Green_Light", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0"]}, {"head": "Person", "relation": "Holds", "tail": "Vial", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_4"]}, {"head": "Vial", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1"]}, {"head": "Person", "relation": "Pours", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Electronic_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1"]}, {"head": "Electronic_Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1"]}, {"head": "Person", "relation": "Performs", "tail": "Experiment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_2"]}, {"head": "Beaker", "relation": "Is On", "tail": "Electronic Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_2"]}, {"head": "Magnetic Stirrer", "relation": "Is Inside", "tail": "Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_2"]}, {"head": "Metal Stand", "relation": "Holds", "tail": "Glass Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:56:59,553 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~245 words, ~318 tokens)
2025-11-30 21:56:59,553 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:57:13,838 - src.components.global_refiner - DEBUG - LLM call completed in 14.28s
2025-11-30 21:57:13,838 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_3']], ['Person', 'holds', 'Glass_Vial', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_3']], ['Glass_Vial', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0']], ['Device', 'displays', '0.352', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0']], ['Device', 'has', 'Green_Light', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0']], ['Person', 'holds', 'Vial', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_4']], ['Vial', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1']], ['Person', 'pours', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1']], ['Beaker', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1']], ['Beaker', 'is_on', 'Electronic_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_2']]]
2025-11-30 21:57:13,838 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Vial",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_3"
    ]
  ],
  [
    "Glass_Vial",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0"
    ]
  ],
  [
    "Device",
    "displays",
    "0.352",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0"
    ]
  ],
  [
    "Device",
    "has",
    "Green_Light",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Vial",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_4"
    ]
  ],
  [
    "Vial",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1"
    ]
  ],
  [
    "Person",
    "pours",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Electronic_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_44_2"
    ]
  ]
]
2025-11-30 21:57:13,838 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 14.29s, LLM: 14.28s)
2025-11-30 21:57:13,838 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 14.29s
2025-11-30 21:57:13,838 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:57:13,838 - src.pipeline.kg_builder - INFO - Pushing batch 45/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:57:13,839 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:57:13,973 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:57:13,973 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:57:13,973 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:57:13,973 - src.components.neo4j_handler - INFO - Batch injected in 0.13s (triplets: 0.13s, indexes: 0.00s)
2025-11-30 21:57:13,975 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 215, 'with_embedding': 0, 'linked_chunks': 148}
2025-11-30 21:57:13,975 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:57:14,037 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 401 nodes
2025-11-30 21:57:14,159 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 334 nodes
2025-11-30 21:57:14,304 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 401, 'relationship_count': 1060, 'density': 0.0066, 'avg_degree': 5.2868, 'avg_unique_neighbors': 5.2469, 'global_efficiency': 0.2876, 'avg_path_length': 2.6085, 'avg_degree_centrality': 0.0132, 'max_degree_centrality': 0.5325, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0283, 'degree_assortativity': -0.2431, 'graph_robustness': 0.7943, 'diameter_estimate': 5, 'clustering_coefficient': 0.2816, 'weakly_connected_components': 68, 'largest_wcc_size': 334, 'pagerank_top10_percent': 8.45, 'louvain_communities': 80, 'louvain_modularity': 0.4, 'label_entropy': 1.4981, 'computational_time': 0.32920415699481964}
2025-11-30 21:57:14,304 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 44, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511034.304715, 'total_time': 20.645508872927167, 'aggregation': 2.347049303352833e-06, 'network_info': 0.009877297910861671, 'llm_extraction': 20.16949196800124, 'data_cleaning': 2.6299036107957363e-05, 'neo4j_injection': 0.13506470795255154, 'embedding_time': 0, 'indexing_time': 0.002643505926243961, 'graph_injection_time': 0.1321414930280298, 'acs_metrics': {'node_count': 401, 'relationship_count': 1060, 'density': 0.0066, 'avg_degree': 5.2868, 'avg_unique_neighbors': 5.2469, 'global_efficiency': 0.2876, 'avg_path_length': 2.6085, 'avg_degree_centrality': 0.0132, 'max_degree_centrality': 0.5325, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0283, 'degree_assortativity': -0.2431, 'graph_robustness': 0.7943, 'diameter_estimate': 5, 'clustering_coefficient': 0.2816, 'weakly_connected_components': 68, 'largest_wcc_size': 334, 'pagerank_top10_percent': 8.45, 'louvain_communities': 80, 'louvain_modularity': 0.4, 'label_entropy': 1.4981, 'computational_time': 0.32920415699481964}, 'retrieval_queries': []}
2025-11-30 21:57:14,304 - src.pipeline.kg_builder - DEBUG - Batch 44 metrics: {
  "batch_idx": 44,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511034.304715,
  "total_time": 20.645508872927167,
  "aggregation": 2.347049303352833e-06,
  "network_info": 0.009877297910861671,
  "llm_extraction": 20.16949196800124,
  "data_cleaning": 2.6299036107957363e-05,
  "neo4j_injection": 0.13506470795255154,
  "embedding_time": 0,
  "indexing_time": 0.002643505926243961,
  "graph_injection_time": 0.1321414930280298,
  "acs_metrics": {
    "node_count": 401,
    "relationship_count": 1060,
    "density": 0.0066,
    "avg_degree": 5.2868,
    "avg_unique_neighbors": 5.2469,
    "global_efficiency": 0.2876,
    "avg_path_length": 2.6085,
    "avg_degree_centrality": 0.0132,
    "max_degree_centrality": 0.5325,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0283,
    "degree_assortativity": -0.2431,
    "graph_robustness": 0.7943,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2816,
    "weakly_connected_components": 68,
    "largest_wcc_size": 334,
    "pagerank_top10_percent": 8.45,
    "louvain_communities": 80,
    "louvain_modularity": 0.4,
    "label_entropy": 1.4981,
    "computational_time": 0.32920415699481964
  },
  "retrieval_queries": []
}
2025-11-30 21:57:14,305 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:57:14,305 - src.pipeline.kg_builder - INFO - Batch 45 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 20.17s, Clean: 0.00s, Neo4j: 0.14s, ACS: 0.33s
2025-11-30 21:57:14,305 - src.pipeline.kg_builder - INFO - Batch 45 completed in 20.65s
Processing KG batches:  62%|██████▎   | 45/72 [16:55<10:06, 22.47s/it]2025-11-30 21:57:14,305 - src.pipeline.kg_builder - INFO - Processing batch 46/72 (3 items)
2025-11-30 21:57:14,305 - src.pipeline.kg_builder - DEBUG - Batch 46 current_video_time: 11:23-11:28
2025-11-30 21:57:14,315 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 401
- Total Relationships: 306
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:57:14,315 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:57:14,315 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0 ~240 words, content: Time: 11:13-11:18 Content: The video captures a sequence of actions in a laboratory setting, focusing on a person conducting a chemical experiment. The scene is...
2025-11-30 21:57:14,315 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_1 ~231 words, content: and a beige sweater. This person appears to be assisting or observing the experiment, adding to the collaborative nature of the work. The laboratory environment...
2025-11-30 21:57:14,315 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_2 ~222 words, content: person is using a long, white, flexible tube, which is being inserted into the glassware. The right hand holds the tube in place while the...
2025-11-30 21:57:14,315 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_3 ~87 words, content: by the "D LAB" logo visible on the device. The person's left hand, which is adorned with a gold and black watch, is holding the...
2025-11-30 21:57:14,315 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:57:14,316 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0) (~240 words) with timeout=5.0s retries=3
2025-11-30 21:57:15,539 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:57:15,539 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:57:15,539 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_1) (~231 words) with timeout=5.0s retries=3
2025-11-30 21:57:16,691 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:57:16,691 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:57:16,692 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_2) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:57:21,698 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 21:57:27,205 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 2/4), retrying...
2025-11-30 21:57:33,212 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 3/4), retrying...
2025-11-30 21:57:39,720 - src.components.pre_llm_injector - WARNING - ⚠️ Chunk 2 TIMED OUT after 5.0s on final attempt. Skipping.
2025-11-30 21:57:39,720 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 0 triplets
2025-11-30 21:57:39,721 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_3) (~87 words) with timeout=5.0s retries=3
2025-11-30 21:57:40,875 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:57:40,875 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:57:40,875 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 4 chunks
2025-11-30 21:57:40,875 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 26.56s
2025-11-30 21:57:40,875 - src.components.global_refiner - INFO - Capping refinement input: 17 → 15 triplets
2025-11-30 21:57:40,875 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 401
- Total Relationships: 306
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_1"]}, {"head": "Person", "relation": "Wears", "tail": "Gold_Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Vial", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0"]}, {"head": "Person", "relation": "Holds", "tail": "Aluminum_Foil", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0"]}, {"head": "Person", "relation": "Uses", "tail": "White_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0"]}, {"head": "Person", "relation": "Uses", "tail": "Blue_Apparatus", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0"]}, {"head": "Person", "relation": "Performs", "tail": "Task", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Component", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_1"]}, {"head": "Glass_Component", "relation": "Is Connected To", "tail": "Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_1"]}, {"head": "Flask", "relation": "Is On", "tail": "White_Tray", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Equipment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_1"]}, {"head": "Person", "relation": "Holds", "tail": "Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_3"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_3"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_3"]}, {"head": "Flask", "relation": "Is Held By", "tail": "Person", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:57:40,875 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~241 words, ~313 tokens)
2025-11-30 21:57:40,875 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:57:52,759 - src.components.global_refiner - DEBUG - LLM call completed in 11.88s
2025-11-30 21:57:52,759 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_1']], ['Person', 'wears', 'Gold_Watch', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0']], ['Person', 'wears', 'Watch', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_3']], ['Person', 'holds', 'Glass_Vial', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0']], ['Person', 'holds', 'Aluminum_Foil', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0']], ['Person', 'holds', 'Glass_Component', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_1']], ['Person', 'holds', 'Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_3']], ['Person', 'holds', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_3']], ['Person', 'uses', 'White_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0']], ['Person', 'uses', 'Blue_Apparatus', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0']]]
2025-11-30 21:57:52,759 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Gold_Watch",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Vial",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Aluminum_Foil",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Component",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_3"
    ]
  ],
  [
    "Person",
    "uses",
    "White_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Blue_Apparatus",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_45_0"
    ]
  ]
]
2025-11-30 21:57:52,760 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.88s, LLM: 11.88s)
2025-11-30 21:57:52,760 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.88s
2025-11-30 21:57:52,760 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:57:52,760 - src.pipeline.kg_builder - INFO - Pushing batch 46/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:57:52,760 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:57:52,900 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:57:52,900 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:57:52,900 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:57:52,900 - src.components.neo4j_handler - INFO - Batch injected in 0.14s (triplets: 0.13s, indexes: 0.01s)
2025-11-30 21:57:52,902 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 219, 'with_embedding': 0, 'linked_chunks': 151}
2025-11-30 21:57:52,902 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:57:52,948 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 408 nodes
2025-11-30 21:57:53,075 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 340 nodes
2025-11-30 21:57:53,225 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 408, 'relationship_count': 1077, 'density': 0.0065, 'avg_degree': 5.2794, 'avg_unique_neighbors': 5.2402, 'global_efficiency': 0.2886, 'avg_path_length': 2.6001, 'avg_degree_centrality': 0.013, 'max_degree_centrality': 0.5381, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0521, 'degree_assortativity': -0.2487, 'graph_robustness': 0.7939, 'diameter_estimate': 5, 'clustering_coefficient': 0.2813, 'weakly_connected_components': 69, 'largest_wcc_size': 340, 'pagerank_top10_percent': 8.31, 'louvain_communities': 79, 'louvain_modularity': 0.399, 'label_entropy': 1.498, 'computational_time': 0.3234041150426492}
2025-11-30 21:57:53,225 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 45, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511073.225906, 'total_time': 38.920031995046884, 'aggregation': 2.461019903421402e-06, 'network_info': 0.009366867016069591, 'llm_extraction': 38.44478168198839, 'data_cleaning': 2.2185035049915314e-05, 'neo4j_injection': 0.14036135596688837, 'embedding_time': 0, 'indexing_time': 0.005752447061240673, 'graph_injection_time': 0.13433536794036627, 'acs_metrics': {'node_count': 408, 'relationship_count': 1077, 'density': 0.0065, 'avg_degree': 5.2794, 'avg_unique_neighbors': 5.2402, 'global_efficiency': 0.2886, 'avg_path_length': 2.6001, 'avg_degree_centrality': 0.013, 'max_degree_centrality': 0.5381, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0521, 'degree_assortativity': -0.2487, 'graph_robustness': 0.7939, 'diameter_estimate': 5, 'clustering_coefficient': 0.2813, 'weakly_connected_components': 69, 'largest_wcc_size': 340, 'pagerank_top10_percent': 8.31, 'louvain_communities': 79, 'louvain_modularity': 0.399, 'label_entropy': 1.498, 'computational_time': 0.3234041150426492}, 'retrieval_queries': []}
2025-11-30 21:57:53,225 - src.pipeline.kg_builder - DEBUG - Batch 45 metrics: {
  "batch_idx": 45,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511073.225906,
  "total_time": 38.920031995046884,
  "aggregation": 2.461019903421402e-06,
  "network_info": 0.009366867016069591,
  "llm_extraction": 38.44478168198839,
  "data_cleaning": 2.2185035049915314e-05,
  "neo4j_injection": 0.14036135596688837,
  "embedding_time": 0,
  "indexing_time": 0.005752447061240673,
  "graph_injection_time": 0.13433536794036627,
  "acs_metrics": {
    "node_count": 408,
    "relationship_count": 1077,
    "density": 0.0065,
    "avg_degree": 5.2794,
    "avg_unique_neighbors": 5.2402,
    "global_efficiency": 0.2886,
    "avg_path_length": 2.6001,
    "avg_degree_centrality": 0.013,
    "max_degree_centrality": 0.5381,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0521,
    "degree_assortativity": -0.2487,
    "graph_robustness": 0.7939,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2813,
    "weakly_connected_components": 69,
    "largest_wcc_size": 340,
    "pagerank_top10_percent": 8.31,
    "louvain_communities": 79,
    "louvain_modularity": 0.399,
    "label_entropy": 1.498,
    "computational_time": 0.3234041150426492
  },
  "retrieval_queries": []
}
2025-11-30 21:57:53,226 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:57:53,226 - src.pipeline.kg_builder - INFO - Batch 46 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 38.44s, Clean: 0.00s, Neo4j: 0.14s, ACS: 0.32s
2025-11-30 21:57:53,226 - src.pipeline.kg_builder - INFO - Batch 46 completed in 38.92s
Processing KG batches:  64%|██████▍   | 46/72 [17:34<11:52, 27.40s/it]2025-11-30 21:57:53,227 - src.pipeline.kg_builder - INFO - Processing batch 47/72 (3 items)
2025-11-30 21:57:53,227 - src.pipeline.kg_builder - DEBUG - Batch 47 current_video_time: 11:38-11:43
2025-11-30 21:57:53,234 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 408
- Total Relationships: 310
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:57:53,234 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:57:53,234 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0 ~226 words, content: Time: 11:28-11:33 Content: The video captures a scientific procedure being performed in a laboratory setting. The sequence of events unfolds as follows: - **Initial Setup:**...
2025-11-30 21:57:53,234 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1 ~233 words, content: - **Broader Context:** The camera pulls back further, revealing more of the laboratory. The entire apparatus, including the balance, the flask, and the tubing, is...
2025-11-30 21:57:53,234 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_2 ~233 words, content: of laboratory equipment. This equipment includes a glass flask, which is being held in place by a clamp attached to a metal stand. The flask...
2025-11-30 21:57:53,234 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_3 ~238 words, content: stirring process is ongoing. In summary, the video shows a controlled laboratory experiment where a liquid is being transferred from a flask, which is being...
2025-11-30 21:57:53,234 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_4 ~88 words, content: with a clear liquid. The final frames show the tube submerged in the liquid within the measuring cup, indicating that the liquid is being pumped...
2025-11-30 21:57:53,234 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:57:53,235 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:57:54,915 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:57:54,915 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:57:54,915 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:57:56,116 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:57:56,116 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:57:56,117 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_2) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:57:57,435 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:57:57,435 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:57:57,435 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_3) (~238 words) with timeout=5.0s retries=3
2025-11-30 21:57:58,777 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:57:58,777 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:57:58,777 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_4) (~88 words) with timeout=5.0s retries=3
2025-11-30 21:57:59,922 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:57:59,922 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:57:59,922 - src.components.pre_llm_injector - INFO - Extracted 29 local triplets from 5 chunks
2025-11-30 21:57:59,922 - src.pipeline.kg_builder - INFO - Pre-extraction: 29 triplets in 6.69s
2025-11-30 21:57:59,923 - src.components.global_refiner - INFO - Capping refinement input: 29 → 15 triplets
2025-11-30 21:57:59,923 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 408
- Total Relationships: 310
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Erlenmeyer_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0"]}, {"head": "Person", "relation": "Wears", "tail": "Gold_Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0"]}, {"head": "Glass_Erlenmeyer_Flask", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Liquid_Mass", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Glass_Erlenmeyer_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0"]}, {"head": "Camera", "relation": "Pulls Back", "tail": "Laboratory", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1"]}, {"head": "Apparatus", "relation": "Includes", "tail": "Balance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_4"]}, {"head": "Apparatus", "relation": "Includes", "tail": "Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1"]}, {"head": "Apparatus", "relation": "Includes", "tail": "Tubing", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1"]}, {"head": "Tubing", "relation": "Is Routed Over", "tail": "Metal_Stand", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1"]}, {"head": "Person", "relation": "Adjusts", "tail": "Apparatus", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1"]}, {"head": "Flask", "relation": "Is Held By", "tail": "Clamp", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_2"]}, {"head": "Flask", "relation": "Is On", "tail": "Magnetic_Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_2"]}, {"head": "Magnetic_Stirrer", "relation": "Displays", "tail": "0970", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:57:59,923 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~245 words, ~318 tokens)
2025-11-30 21:57:59,923 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:58:12,234 - src.components.global_refiner - DEBUG - LLM call completed in 12.31s
2025-11-30 21:58:12,235 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0']], ['Person', 'holds', 'Glass_Erlenmeyer_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0']], ['Person', 'wears', 'Gold_Watch', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0']], ['Glass_Erlenmeyer_Flask', 'is_on', 'Digital_Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0']], ['Digital_Balance', 'displays', 'Liquid_Mass', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0']], ['Liquid', 'is_transferred_to', 'Glass_Erlenmeyer_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0']], ['Camera', 'pulls_back', 'Laboratory', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1']], ['Apparatus', 'includes', 'Balance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_4']], ['Apparatus', 'includes', 'Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1']], ['Apparatus', 'includes', 'Tubing', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1']]]
2025-11-30 21:58:12,235 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Erlenmeyer_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Gold_Watch",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0"
    ]
  ],
  [
    "Glass_Erlenmeyer_Flask",
    "is_on",
    "Digital_Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Liquid_Mass",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0"
    ]
  ],
  [
    "Liquid",
    "is_transferred_to",
    "Glass_Erlenmeyer_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_0"
    ]
  ],
  [
    "Camera",
    "pulls_back",
    "Laboratory",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1"
    ]
  ],
  [
    "Apparatus",
    "includes",
    "Balance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_4"
    ]
  ],
  [
    "Apparatus",
    "includes",
    "Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1"
    ]
  ],
  [
    "Apparatus",
    "includes",
    "Tubing",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_46_1"
    ]
  ]
]
2025-11-30 21:58:12,235 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 12.31s, LLM: 12.31s)
2025-11-30 21:58:12,235 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 12.31s
2025-11-30 21:58:12,235 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:58:12,235 - src.pipeline.kg_builder - INFO - Pushing batch 47/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:58:12,235 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:58:12,388 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:58:12,388 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:58:12,388 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:58:12,388 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.15s, indexes: 0.00s)
2025-11-30 21:58:12,390 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 224, 'with_embedding': 0, 'linked_chunks': 154}
2025-11-30 21:58:12,390 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:58:12,436 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 416 nodes
2025-11-30 21:58:12,574 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 346 nodes
2025-11-30 21:58:12,737 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 416, 'relationship_count': 1099, 'density': 0.0064, 'avg_degree': 5.2837, 'avg_unique_neighbors': 5.2452, 'global_efficiency': 0.2862, 'avg_path_length': 2.6134, 'avg_degree_centrality': 0.0127, 'max_degree_centrality': 0.5325, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0616, 'degree_assortativity': -0.2436, 'graph_robustness': 0.7907, 'diameter_estimate': 5, 'clustering_coefficient': 0.2803, 'weakly_connected_components': 71, 'largest_wcc_size': 346, 'pagerank_top10_percent': 8.14, 'louvain_communities': 84, 'louvain_modularity': 0.3979, 'label_entropy': 1.4979, 'computational_time': 0.34772586601320654}
2025-11-30 21:58:12,738 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 46, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511092.7380407, 'total_time': 19.510978897102177, 'aggregation': 2.7299392968416214e-06, 'network_info': 0.007029322907328606, 'llm_extraction': 19.0010098220082, 'data_cleaning': 1.7666025087237358e-05, 'neo4j_injection': 0.1535041210008785, 'embedding_time': 0, 'indexing_time': 0.00446503097191453, 'graph_injection_time': 0.14884285000152886, 'acs_metrics': {'node_count': 416, 'relationship_count': 1099, 'density': 0.0064, 'avg_degree': 5.2837, 'avg_unique_neighbors': 5.2452, 'global_efficiency': 0.2862, 'avg_path_length': 2.6134, 'avg_degree_centrality': 0.0127, 'max_degree_centrality': 0.5325, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0616, 'degree_assortativity': -0.2436, 'graph_robustness': 0.7907, 'diameter_estimate': 5, 'clustering_coefficient': 0.2803, 'weakly_connected_components': 71, 'largest_wcc_size': 346, 'pagerank_top10_percent': 8.14, 'louvain_communities': 84, 'louvain_modularity': 0.3979, 'label_entropy': 1.4979, 'computational_time': 0.34772586601320654}, 'retrieval_queries': []}
2025-11-30 21:58:12,738 - src.pipeline.kg_builder - DEBUG - Batch 46 metrics: {
  "batch_idx": 46,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511092.7380407,
  "total_time": 19.510978897102177,
  "aggregation": 2.7299392968416214e-06,
  "network_info": 0.007029322907328606,
  "llm_extraction": 19.0010098220082,
  "data_cleaning": 1.7666025087237358e-05,
  "neo4j_injection": 0.1535041210008785,
  "embedding_time": 0,
  "indexing_time": 0.00446503097191453,
  "graph_injection_time": 0.14884285000152886,
  "acs_metrics": {
    "node_count": 416,
    "relationship_count": 1099,
    "density": 0.0064,
    "avg_degree": 5.2837,
    "avg_unique_neighbors": 5.2452,
    "global_efficiency": 0.2862,
    "avg_path_length": 2.6134,
    "avg_degree_centrality": 0.0127,
    "max_degree_centrality": 0.5325,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0616,
    "degree_assortativity": -0.2436,
    "graph_robustness": 0.7907,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2803,
    "weakly_connected_components": 71,
    "largest_wcc_size": 346,
    "pagerank_top10_percent": 8.14,
    "louvain_communities": 84,
    "louvain_modularity": 0.3979,
    "label_entropy": 1.4979,
    "computational_time": 0.34772586601320654
  },
  "retrieval_queries": []
}
2025-11-30 21:58:12,739 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:58:12,739 - src.pipeline.kg_builder - INFO - Batch 47 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.00s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.35s
2025-11-30 21:58:12,739 - src.pipeline.kg_builder - INFO - Batch 47 completed in 19.51s
Processing KG batches:  65%|██████▌   | 47/72 [17:54<10:25, 25.03s/it]2025-11-30 21:58:12,739 - src.pipeline.kg_builder - INFO - Processing batch 48/72 (3 items)
2025-11-30 21:58:12,739 - src.pipeline.kg_builder - DEBUG - Batch 48 current_video_time: 11:53-11:58
2025-11-30 21:58:12,748 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 416
- Total Relationships: 318
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:58:12,748 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:58:12,748 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0 ~241 words, content: Time: 11:43-11:48 Content: The video captures a scene in a laboratory or workshop setting, focusing on a scientific experiment involving fluid transfer. The camera is...
2025-11-30 21:58:12,748 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1 ~226 words, content: plastic bag containing small components, and a glass rod. The overall impression is that of an active workspace where an experiment is in progress. Time:...
2025-11-30 21:58:12,748 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_2 ~233 words, content: **Final Scene (Frames 4-5):** The camera settles on a clear view of the experiment. A glass beaker is positioned on a white, electronic device, which...
2025-11-30 21:58:12,748 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_3 ~168 words, content: , which is part of a setup that appears to be a gas delivery system. The camera angle shifts slightly, providing a broader view of...
2025-11-30 21:58:12,748 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:58:12,748 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:58:13,702 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:58:13,702 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:58:13,702 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:58:14,907 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:58:14,908 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:58:14,908 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_2) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:58:16,242 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:58:16,242 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:58:16,242 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_3) (~168 words) with timeout=5.0s retries=3
2025-11-30 21:58:17,331 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:58:17,331 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:58:17,331 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-30 21:58:17,331 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 4.58s
2025-11-30 21:58:17,331 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 21:58:17,331 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 416
- Total Relationships: 318
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0"]}, {"head": "Pump", "relation": "Connected To", "tail": "Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0"]}, {"head": "Tube", "relation": "Inserted Into", "tail": "Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0"]}, {"head": "Container", "relation": "Contains", "tail": "Water", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0"]}, {"head": "Workbench", "relation": "Holds", "tail": "Pump", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0"]}, {"head": "Workbench", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0"]}, {"head": "Plastic Bag", "relation": "Contains", "tail": "Small Components", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1"]}, {"head": "Glass Rod", "relation": "Is Part Of", "tail": "Experiment Setup", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1"]}, {"head": "Lab Bench", "relation": "Holds", "tail": "Plastic Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1"]}, {"head": "Plastic Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1"]}, {"head": "Glass Beaker", "relation": "Contains", "tail": "Red Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1"]}, {"head": "Lab Bench", "relation": "Holds", "tail": "Glass Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Foamy Substance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_2"]}, {"head": "Tube", "relation": "Is Inserted In", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:58:17,331 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~255 words, ~332 tokens)
2025-11-30 21:58:17,331 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:58:28,343 - src.components.global_refiner - DEBUG - LLM call completed in 11.01s
2025-11-30 21:58:28,343 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Pump', 'connected_to', 'Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0']], ['Tube', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0']], ['Tube', 'inserted_into', 'Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0']], ['Container', 'contains', 'Water', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0']], ['Workbench', 'holds', 'Pump', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0']], ['Workbench', 'holds', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0']], ['Plastic_Bag', 'contains', 'Small_Components', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1']], ['Glass_Rod', 'is_part_of', 'Experiment_Setup', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1']], ['Lab_Bench', 'holds', 'Plastic_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1']], ['Plastic_Container', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1']]]
2025-11-30 21:58:28,344 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Pump",
    "connected_to",
    "Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0"
    ]
  ],
  [
    "Tube",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0"
    ]
  ],
  [
    "Tube",
    "inserted_into",
    "Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0"
    ]
  ],
  [
    "Container",
    "contains",
    "Water",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0"
    ]
  ],
  [
    "Workbench",
    "holds",
    "Pump",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0"
    ]
  ],
  [
    "Workbench",
    "holds",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_0"
    ]
  ],
  [
    "Plastic_Bag",
    "contains",
    "Small_Components",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1"
    ]
  ],
  [
    "Glass_Rod",
    "is_part_of",
    "Experiment_Setup",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1"
    ]
  ],
  [
    "Lab_Bench",
    "holds",
    "Plastic_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1"
    ]
  ],
  [
    "Plastic_Container",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_47_1"
    ]
  ]
]
2025-11-30 21:58:28,344 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.01s, LLM: 11.01s)
2025-11-30 21:58:28,344 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.01s
2025-11-30 21:58:28,344 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:58:28,344 - src.pipeline.kg_builder - INFO - Pushing batch 48/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:58:28,344 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:58:28,444 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:58:28,444 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:58:28,445 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:58:28,445 - src.components.neo4j_handler - INFO - Batch injected in 0.10s (triplets: 0.10s, indexes: 0.00s)
2025-11-30 21:58:28,446 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 228, 'with_embedding': 0, 'linked_chunks': 156}
2025-11-30 21:58:28,446 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:58:28,518 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 426 nodes
2025-11-30 21:58:28,657 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 354 nodes
2025-11-30 21:58:28,821 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 426, 'relationship_count': 1123, 'density': 0.0062, 'avg_degree': 5.2723, 'avg_unique_neighbors': 5.2347, 'global_efficiency': 0.2835, 'avg_path_length': 2.6374, 'avg_degree_centrality': 0.0124, 'max_degree_centrality': 0.52, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.065, 'degree_assortativity': -0.2348, 'graph_robustness': 0.7943, 'diameter_estimate': 5, 'clustering_coefficient': 0.2791, 'weakly_connected_components': 73, 'largest_wcc_size': 354, 'pagerank_top10_percent': 7.9, 'louvain_communities': 86, 'louvain_modularity': 0.4034, 'label_entropy': 1.4982, 'computational_time': 0.37468990101478994}
2025-11-30 21:58:28,821 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 47, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511108.8214035, 'total_time': 16.082188111031428, 'aggregation': 2.3229513317346573e-06, 'network_info': 0.008748821914196014, 'llm_extraction': 15.596089655999094, 'data_cleaning': 2.529006451368332e-05, 'neo4j_injection': 0.10079967393539846, 'embedding_time': 0, 'indexing_time': 0.002797110006213188, 'graph_injection_time': 0.09773881000000983, 'acs_metrics': {'node_count': 426, 'relationship_count': 1123, 'density': 0.0062, 'avg_degree': 5.2723, 'avg_unique_neighbors': 5.2347, 'global_efficiency': 0.2835, 'avg_path_length': 2.6374, 'avg_degree_centrality': 0.0124, 'max_degree_centrality': 0.52, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.065, 'degree_assortativity': -0.2348, 'graph_robustness': 0.7943, 'diameter_estimate': 5, 'clustering_coefficient': 0.2791, 'weakly_connected_components': 73, 'largest_wcc_size': 354, 'pagerank_top10_percent': 7.9, 'louvain_communities': 86, 'louvain_modularity': 0.4034, 'label_entropy': 1.4982, 'computational_time': 0.37468990101478994}, 'retrieval_queries': []}
2025-11-30 21:58:28,821 - src.pipeline.kg_builder - DEBUG - Batch 47 metrics: {
  "batch_idx": 47,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511108.8214035,
  "total_time": 16.082188111031428,
  "aggregation": 2.3229513317346573e-06,
  "network_info": 0.008748821914196014,
  "llm_extraction": 15.596089655999094,
  "data_cleaning": 2.529006451368332e-05,
  "neo4j_injection": 0.10079967393539846,
  "embedding_time": 0,
  "indexing_time": 0.002797110006213188,
  "graph_injection_time": 0.09773881000000983,
  "acs_metrics": {
    "node_count": 426,
    "relationship_count": 1123,
    "density": 0.0062,
    "avg_degree": 5.2723,
    "avg_unique_neighbors": 5.2347,
    "global_efficiency": 0.2835,
    "avg_path_length": 2.6374,
    "avg_degree_centrality": 0.0124,
    "max_degree_centrality": 0.52,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.065,
    "degree_assortativity": -0.2348,
    "graph_robustness": 0.7943,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2791,
    "weakly_connected_components": 73,
    "largest_wcc_size": 354,
    "pagerank_top10_percent": 7.9,
    "louvain_communities": 86,
    "louvain_modularity": 0.4034,
    "label_entropy": 1.4982,
    "computational_time": 0.37468990101478994
  },
  "retrieval_queries": []
}
2025-11-30 21:58:28,822 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:58:28,822 - src.pipeline.kg_builder - INFO - Batch 48 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 15.60s, Clean: 0.00s, Neo4j: 0.10s, ACS: 0.37s
2025-11-30 21:58:28,822 - src.pipeline.kg_builder - INFO - Batch 48 completed in 16.08s
Processing KG batches:  67%|██████▋   | 48/72 [18:10<08:56, 22.35s/it]2025-11-30 21:58:28,822 - src.pipeline.kg_builder - INFO - Processing batch 49/72 (3 items)
2025-11-30 21:58:28,822 - src.pipeline.kg_builder - DEBUG - Batch 49 current_video_time: 12:08-12:13
2025-11-30 21:58:28,833 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 426
- Total Relationships: 328
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:58:28,834 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:58:28,834 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0 ~247 words, content: Time: 11:58-12:03 Content: The video sequence captures a scientific experiment being conducted in a laboratory setting. The scene is set on a black laboratory bench,...
2025-11-30 21:58:28,834 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_1 ~241 words, content: a well-equipped laboratory. - The video captures the process of a scientific experiment, with the equipment and materials being used to conduct the experiment. The...
2025-11-30 21:58:28,834 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_2 ~227 words, content: rer, a blue stand holds a metal rod, which is part of a larger apparatus, possibly for titration or another measurement. Other items on the...
2025-11-30 21:58:28,834 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_3 ~132 words, content: next stage of the process. The flexible tube, which was initially in the flask, is now shown extending across the lab bench. It is being...
2025-11-30 21:58:28,834 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:58:28,834 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0) (~247 words) with timeout=5.0s retries=3
2025-11-30 21:58:29,942 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:58:29,942 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:58:29,943 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_1) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:58:31,289 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:58:31,289 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:58:31,289 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_2) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:58:32,747 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:58:32,748 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:58:32,748 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_3) (~132 words) with timeout=5.0s retries=3
2025-11-30 21:58:33,794 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:58:33,795 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:58:33,795 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-30 21:58:33,795 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 4.96s
2025-11-30 21:58:33,795 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 21:58:33,795 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 426
- Total Relationships: 328
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Laboratory Bench", "relation": "Contains", "tail": "Plastic Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0"]}, {"head": "Plastic Container", "relation": "Contains", "tail": "Water", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0"]}, {"head": "Equipment", "relation": "Connected To", "tail": "Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0"]}, {"head": "Equipment", "relation": "Has", "tail": "Digital Display", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0"]}, {"head": "Glass Container", "relation": "Placed On", "tail": "Equipment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0"]}, {"head": "Liquid", "relation": "Stirred By", "tail": "Magnetic Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Equipment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Materials", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_1"]}, {"head": "Erlenmeyer Flask", "relation": "Is Part Of", "tail": "Chemical Experiment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_1"]}, {"head": "Magnetic Stirrer", "relation": "Is Used In", "tail": "Chemical Experiment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_1"]}, {"head": "Hot Plate", "relation": "Provides", "tail": "Heat", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_1"]}, {"head": "Condenser", "relation": "Is Connected To", "tail": "Erlenmeyer Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_1"]}, {"head": "Glass Flask", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_2"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_2"]}, {"head": "Magnetic Stirrer", "relation": "Is Operating", "tail": "Glass Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:58:33,796 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~264 words, ~343 tokens)
2025-11-30 21:58:33,796 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:58:44,948 - src.components.global_refiner - DEBUG - LLM call completed in 11.15s
2025-11-30 21:58:44,948 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Laboratory', 'contains', 'Equipment', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_1']], ['Laboratory', 'contains', 'Materials', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_1']], ['Equipment', 'connected_to', 'Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0']], ['Equipment', 'has', 'Digital_Display', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0']], ['Glass_Container', 'placed_on', 'Equipment', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0']], ['Plastic_Container', 'contains', 'Water', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0']], ['Laboratory_Bench', 'contains', 'Plastic_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0']], ['Glass_Flask', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_2']], ['Glass_Flask', 'is_on', 'Magnetic_Stirrer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_2']], ['Magnetic_Stirrer', 'is_operating', 'Glass_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_2']]]
2025-11-30 21:58:44,948 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Laboratory",
    "contains",
    "Equipment",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_1"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Materials",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_1"
    ]
  ],
  [
    "Equipment",
    "connected_to",
    "Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0"
    ]
  ],
  [
    "Equipment",
    "has",
    "Digital_Display",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0"
    ]
  ],
  [
    "Glass_Container",
    "placed_on",
    "Equipment",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0"
    ]
  ],
  [
    "Plastic_Container",
    "contains",
    "Water",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Plastic_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_0"
    ]
  ],
  [
    "Glass_Flask",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_2"
    ]
  ],
  [
    "Glass_Flask",
    "is_on",
    "Magnetic_Stirrer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_2"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "is_operating",
    "Glass_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_48_2"
    ]
  ]
]
2025-11-30 21:58:44,948 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.15s, LLM: 11.15s)
2025-11-30 21:58:44,948 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.15s
2025-11-30 21:58:44,948 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:58:44,948 - src.pipeline.kg_builder - INFO - Pushing batch 49/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:58:44,948 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:58:45,097 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:58:45,097 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:58:45,098 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:58:45,098 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.15s, indexes: 0.00s)
2025-11-30 21:58:45,099 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 232, 'with_embedding': 0, 'linked_chunks': 159}
2025-11-30 21:58:45,099 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:58:45,150 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 432 nodes
2025-11-30 21:58:45,297 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 359 nodes
2025-11-30 21:58:45,468 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 432, 'relationship_count': 1144, 'density': 0.0061, 'avg_degree': 5.2963, 'avg_unique_neighbors': 5.2546, 'global_efficiency': 0.282, 'avg_path_length': 2.6518, 'avg_degree_centrality': 0.0123, 'max_degree_centrality': 0.5128, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0748, 'degree_assortativity': -0.2283, 'graph_robustness': 0.7937, 'diameter_estimate': 5, 'clustering_coefficient': 0.2775, 'weakly_connected_components': 74, 'largest_wcc_size': 359, 'pagerank_top10_percent': 7.74, 'louvain_communities': 86, 'louvain_modularity': 0.4109, 'label_entropy': 1.498, 'computational_time': 0.3690630020573735}
2025-11-30 21:58:45,468 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 48, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511125.4688761, 'total_time': 16.646272346028127, 'aggregation': 2.582091838121414e-06, 'network_info': 0.010949424002319574, 'llm_extraction': 16.114642931963317, 'data_cleaning': 1.3452954590320587e-05, 'neo4j_injection': 0.1499770029913634, 'embedding_time': 0, 'indexing_time': 0.004155419999733567, 'graph_injection_time': 0.1456538230413571, 'acs_metrics': {'node_count': 432, 'relationship_count': 1144, 'density': 0.0061, 'avg_degree': 5.2963, 'avg_unique_neighbors': 5.2546, 'global_efficiency': 0.282, 'avg_path_length': 2.6518, 'avg_degree_centrality': 0.0123, 'max_degree_centrality': 0.5128, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0748, 'degree_assortativity': -0.2283, 'graph_robustness': 0.7937, 'diameter_estimate': 5, 'clustering_coefficient': 0.2775, 'weakly_connected_components': 74, 'largest_wcc_size': 359, 'pagerank_top10_percent': 7.74, 'louvain_communities': 86, 'louvain_modularity': 0.4109, 'label_entropy': 1.498, 'computational_time': 0.3690630020573735}, 'retrieval_queries': []}
2025-11-30 21:58:45,468 - src.pipeline.kg_builder - DEBUG - Batch 48 metrics: {
  "batch_idx": 48,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511125.4688761,
  "total_time": 16.646272346028127,
  "aggregation": 2.582091838121414e-06,
  "network_info": 0.010949424002319574,
  "llm_extraction": 16.114642931963317,
  "data_cleaning": 1.3452954590320587e-05,
  "neo4j_injection": 0.1499770029913634,
  "embedding_time": 0,
  "indexing_time": 0.004155419999733567,
  "graph_injection_time": 0.1456538230413571,
  "acs_metrics": {
    "node_count": 432,
    "relationship_count": 1144,
    "density": 0.0061,
    "avg_degree": 5.2963,
    "avg_unique_neighbors": 5.2546,
    "global_efficiency": 0.282,
    "avg_path_length": 2.6518,
    "avg_degree_centrality": 0.0123,
    "max_degree_centrality": 0.5128,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.0748,
    "degree_assortativity": -0.2283,
    "graph_robustness": 0.7937,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2775,
    "weakly_connected_components": 74,
    "largest_wcc_size": 359,
    "pagerank_top10_percent": 7.74,
    "louvain_communities": 86,
    "louvain_modularity": 0.4109,
    "label_entropy": 1.498,
    "computational_time": 0.3690630020573735
  },
  "retrieval_queries": []
}
2025-11-30 21:58:45,469 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:58:45,469 - src.pipeline.kg_builder - INFO - Batch 49 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 16.11s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.37s
2025-11-30 21:58:45,470 - src.pipeline.kg_builder - INFO - Batch 49 completed in 16.65s
Processing KG batches:  68%|██████▊   | 49/72 [18:26<07:54, 20.64s/it]2025-11-30 21:58:45,470 - src.pipeline.kg_builder - INFO - Processing batch 50/72 (3 items)
2025-11-30 21:58:45,470 - src.pipeline.kg_builder - DEBUG - Batch 50 current_video_time: 12:23-12:28
2025-11-30 21:58:45,482 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 432
- Total Relationships: 336
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:58:45,483 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:58:45,483 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0 ~245 words, content: Time: 12:13-12:18 Content: The video captures a sequence of events in a laboratory setting, focusing on a scientific experiment involving a chemical reaction or a...
2025-11-30 21:58:45,483 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1 ~244 words, content: water. This suggests that the experiment involves a chemical reaction or a process that produces a gas or a liquid that needs to be collected...
2025-11-30 21:58:45,483 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_2 ~244 words, content: , a digital device with a control panel, is actively stirring the contents of the flask. The digital display on this device shows a reading...
2025-11-30 21:58:45,483 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_3 ~207 words, content: captures a continuous process in a laboratory setting, focusing on a chemical experiment involving a reflux or distillation setup. The camera's perspective shifts slightly across...
2025-11-30 21:58:45,483 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_4 ~206 words, content: In the background, there are white **cabinets** and a **glass-enclosed cabinet** (a fume hood or a storage cabinet) with various items on shelves. - The...
2025-11-30 21:58:45,483 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_5 ~54 words, content: shows a laboratory experiment where a chemical reaction is being conducted in a round-bottom flask. The setup is designed to heat the mixture, vaporize a...
2025-11-30 21:58:45,483 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:58:45,483 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0) (~245 words) with timeout=5.0s retries=3
2025-11-30 21:58:46,578 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:58:46,578 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:58:46,579 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1) (~244 words) with timeout=5.0s retries=3
2025-11-30 21:58:48,205 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:58:48,205 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:58:48,206 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_2) (~244 words) with timeout=5.0s retries=3
2025-11-30 21:58:49,241 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:58:49,241 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:58:49,241 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_3) (~207 words) with timeout=5.0s retries=3
2025-11-30 21:58:50,914 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:58:50,914 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:58:50,915 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_4) (~206 words) with timeout=5.0s retries=3
2025-11-30 21:58:51,959 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:58:51,959 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:58:51,960 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_5) (~54 words) with timeout=5.0s retries=3
2025-11-30 21:58:53,082 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:58:53,083 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:58:53,083 - src.components.pre_llm_injector - INFO - Extracted 33 local triplets from 6 chunks
2025-11-30 21:58:53,083 - src.pipeline.kg_builder - INFO - Pre-extraction: 33 triplets in 7.60s
2025-11-30 21:58:53,084 - src.components.global_refiner - INFO - Capping refinement input: 33 → 15 triplets
2025-11-30 21:58:53,084 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 432
- Total Relationships: 336
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Laboratory Table", "relation": "Contains", "tail": "Equipment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0"]}, {"head": "Equipment", "relation": "Includes", "tail": "Plastic Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0"]}, {"head": "Plastic Container", "relation": "Contains", "tail": "Water", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1"]}, {"head": "Glass Container", "relation": "Connected To", "tail": "Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0"]}, {"head": "Tube", "relation": "Connected To", "tail": "Glass Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0"]}, {"head": "Glass Container", "relation": "Placed On", "tail": "White Device", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0"]}, {"head": "Glass Erlenmeyer Flask", "relation": "Contains", "tail": "White Foamy Substance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1"]}, {"head": "Glass Erlenmeyer Flask", "relation": "Is Connected To", "tail": "Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1"]}, {"head": "Tube", "relation": "Leads To", "tail": "Plastic Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1"]}, {"head": "Glass Erlenmeyer Flask", "relation": "Is Placed On", "tail": "Digital Device", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1"]}, {"head": "Digital Device", "relation": "Stirs", "tail": "Glass Erlenmeyer Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1"]}, {"head": "Digital Device", "relation": "Stirs", "tail": "Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_2"]}, {"head": "Flask", "relation": "Contains", "tail": "Foam", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_2"]}, {"head": "Flask", "relation": "Has", "tail": "Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_2"]}, {"head": "Tube", "relation": "Connects", "tail": "Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:58:53,084 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~265 words, ~344 tokens)
2025-11-30 21:58:53,084 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:59:05,440 - src.components.global_refiner - DEBUG - LLM call completed in 12.36s
2025-11-30 21:59:05,440 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Laboratory_Table', 'contains', 'Equipment', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0']], ['Equipment', 'includes', 'Plastic_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0']], ['Plastic_Container', 'contains', 'Water', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1']], ['Glass_Container', 'connected_to', 'Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0']], ['Tube', 'connected_to', 'Glass_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0']], ['Glass_Container', 'placed_on', 'White_Device', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0']], ['Glass_Erlenmeyer_Flask', 'contains', 'White_Foamy_Substance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1']], ['Glass_Erlenmeyer_Flask', 'is_connected_to', 'Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1']], ['Tube', 'leads_to', 'Plastic_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1']], ['Glass_Erlenmeyer_Flask', 'is_placed_on', 'Digital_Device', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1']]]
2025-11-30 21:59:05,440 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Laboratory_Table",
    "contains",
    "Equipment",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0"
    ]
  ],
  [
    "Equipment",
    "includes",
    "Plastic_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0"
    ]
  ],
  [
    "Plastic_Container",
    "contains",
    "Water",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1"
    ]
  ],
  [
    "Glass_Container",
    "connected_to",
    "Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0"
    ]
  ],
  [
    "Tube",
    "connected_to",
    "Glass_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0"
    ]
  ],
  [
    "Glass_Container",
    "placed_on",
    "White_Device",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_0"
    ]
  ],
  [
    "Glass_Erlenmeyer_Flask",
    "contains",
    "White_Foamy_Substance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1"
    ]
  ],
  [
    "Glass_Erlenmeyer_Flask",
    "is_connected_to",
    "Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1"
    ]
  ],
  [
    "Tube",
    "leads_to",
    "Plastic_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1"
    ]
  ],
  [
    "Glass_Erlenmeyer_Flask",
    "is_placed_on",
    "Digital_Device",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_49_1"
    ]
  ]
]
2025-11-30 21:59:05,440 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 12.36s, LLM: 12.36s)
2025-11-30 21:59:05,440 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 12.36s
2025-11-30 21:59:05,440 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:59:05,441 - src.pipeline.kg_builder - INFO - Pushing batch 50/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:59:05,441 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:59:05,565 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:59:05,565 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:59:05,566 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:59:05,566 - src.components.neo4j_handler - INFO - Batch injected in 0.13s (triplets: 0.12s, indexes: 0.01s)
2025-11-30 21:59:05,567 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 238, 'with_embedding': 0, 'linked_chunks': 161}
2025-11-30 21:59:05,567 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:59:05,619 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 442 nodes
2025-11-30 21:59:05,769 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 365 nodes
2025-11-30 21:59:05,948 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 442, 'relationship_count': 1166, 'density': 0.006, 'avg_degree': 5.276, 'avg_unique_neighbors': 5.2308, 'global_efficiency': 0.2766, 'avg_path_length': 2.6707, 'avg_degree_centrality': 0.012, 'max_degree_centrality': 0.5011, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0717, 'degree_assortativity': -0.2252, 'graph_robustness': 0.7925, 'diameter_estimate': 5, 'clustering_coefficient': 0.2762, 'weakly_connected_components': 78, 'largest_wcc_size': 365, 'pagerank_top10_percent': 7.57, 'louvain_communities': 90, 'louvain_modularity': 0.4176, 'label_entropy': 1.4979, 'computational_time': 0.38064885593485087}
2025-11-30 21:59:05,948 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 49, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511145.9485703, 'total_time': 20.4784849450225, 'aggregation': 2.396991476416588e-06, 'network_info': 0.012658096966333687, 'llm_extraction': 19.95807381393388, 'data_cleaning': 2.0001083612442017e-05, 'neo4j_injection': 0.1251510059228167, 'embedding_time': 0, 'indexing_time': 0.005354466964490712, 'graph_injection_time': 0.11959489400032908, 'acs_metrics': {'node_count': 442, 'relationship_count': 1166, 'density': 0.006, 'avg_degree': 5.276, 'avg_unique_neighbors': 5.2308, 'global_efficiency': 0.2766, 'avg_path_length': 2.6707, 'avg_degree_centrality': 0.012, 'max_degree_centrality': 0.5011, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0717, 'degree_assortativity': -0.2252, 'graph_robustness': 0.7925, 'diameter_estimate': 5, 'clustering_coefficient': 0.2762, 'weakly_connected_components': 78, 'largest_wcc_size': 365, 'pagerank_top10_percent': 7.57, 'louvain_communities': 90, 'louvain_modularity': 0.4176, 'label_entropy': 1.4979, 'computational_time': 0.38064885593485087}, 'retrieval_queries': []}
2025-11-30 21:59:05,948 - src.pipeline.kg_builder - DEBUG - Batch 49 metrics: {
  "batch_idx": 49,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511145.9485703,
  "total_time": 20.4784849450225,
  "aggregation": 2.396991476416588e-06,
  "network_info": 0.012658096966333687,
  "llm_extraction": 19.95807381393388,
  "data_cleaning": 2.0001083612442017e-05,
  "neo4j_injection": 0.1251510059228167,
  "embedding_time": 0,
  "indexing_time": 0.005354466964490712,
  "graph_injection_time": 0.11959489400032908,
  "acs_metrics": {
    "node_count": 442,
    "relationship_count": 1166,
    "density": 0.006,
    "avg_degree": 5.276,
    "avg_unique_neighbors": 5.2308,
    "global_efficiency": 0.2766,
    "avg_path_length": 2.6707,
    "avg_degree_centrality": 0.012,
    "max_degree_centrality": 0.5011,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0717,
    "degree_assortativity": -0.2252,
    "graph_robustness": 0.7925,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2762,
    "weakly_connected_components": 78,
    "largest_wcc_size": 365,
    "pagerank_top10_percent": 7.57,
    "louvain_communities": 90,
    "louvain_modularity": 0.4176,
    "label_entropy": 1.4979,
    "computational_time": 0.38064885593485087
  },
  "retrieval_queries": []
}
2025-11-30 21:59:05,949 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:59:05,949 - src.pipeline.kg_builder - INFO - Batch 50 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.96s, Clean: 0.00s, Neo4j: 0.13s, ACS: 0.38s
2025-11-30 21:59:05,949 - src.pipeline.kg_builder - INFO - Batch 50 completed in 20.48s
Processing KG batches:  69%|██████▉   | 50/72 [18:47<07:33, 20.59s/it]2025-11-30 21:59:05,949 - src.pipeline.kg_builder - INFO - Processing batch 51/72 (3 items)
2025-11-30 21:59:05,949 - src.pipeline.kg_builder - DEBUG - Batch 51 current_video_time: 12:38-12:43
2025-11-30 21:59:05,958 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 442
- Total Relationships: 345
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:59:05,958 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:59:05,958 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0 ~234 words, content: Time: 12:28-12:33 Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a procedure on a black lab bench. The...
2025-11-30 21:59:05,958 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1 ~240 words, content: guide the tube, ensuring it is properly positioned within the container. The surrounding environment is a laboratory setting. To the left, there is a blue...
2025-11-30 21:59:05,958 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_2 ~24 words, content:  a glass cylinder holding pens and tools. The overall action appears to be the transfer of liquid or the setup for a chemical process.
2025-11-30 21:59:05,958 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:59:05,958 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0) (~234 words) with timeout=5.0s retries=3
2025-11-30 21:59:07,553 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:59:07,553 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:59:07,553 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1) (~240 words) with timeout=5.0s retries=3
2025-11-30 21:59:08,481 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:59:08,481 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:59:08,481 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_2) (~24 words) with timeout=5.0s retries=3
2025-11-30 21:59:09,696 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:59:09,696 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:59:09,697 - src.components.pre_llm_injector - INFO - Extracted 18 local triplets from 3 chunks
2025-11-30 21:59:09,697 - src.pipeline.kg_builder - INFO - Pre-extraction: 18 triplets in 3.74s
2025-11-30 21:59:09,697 - src.components.global_refiner - INFO - Capping refinement input: 18 → 15 triplets
2025-11-30 21:59:09,697 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 442
- Total Relationships: 345
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0"]}, {"head": "Person", "relation": "Manipulates", "tail": "Translucent_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0"]}, {"head": "Translucent_Tube", "relation": "Is Connected To", "tail": "Equipment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0"]}, {"head": "Translucent_Tube", "relation": "Is Inserted Into", "tail": "Clear_Plastic_Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0"]}, {"head": "Clear_Plastic_Container", "relation": "Is Inside", "tail": "White_Plastic_Measuring_Jug", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0"]}, {"head": "Person", "relation": "Holds", "tail": "Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0"]}, {"head": "Person", "relation": "Holds", "tail": "Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1"]}, {"head": "Person", "relation": "Holds", "tail": "Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1"]}, {"head": "Tube", "relation": "Is Inserted Into", "tail": "Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1"]}, {"head": "Watch", "relation": "Has Color", "tail": "Gold", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1"]}, {"head": "Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1"]}, {"head": "Glass Cylinder", "relation": "Holds", "tail": "Pens And Tools", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_2"]}, {"head": "Glass Cylinder", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_2"]}, {"head": "Person", "relation": "Performs", "tail": "Transfer Of Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:59:09,697 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~249 words, ~324 tokens)
2025-11-30 21:59:09,697 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:59:25,091 - src.components.global_refiner - DEBUG - LLM call completed in 15.39s
2025-11-30 21:59:25,091 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0']], ['Person', 'manipulates', 'Translucent_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0']], ['Translucent_Tube', 'is_connected_to', 'Equipment', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0']], ['Translucent_Tube', 'is_inserted_into', 'Clear_Plastic_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0']], ['Clear_Plastic_Container', 'is_inside', 'White_Plastic_Measuring_Jug', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0']], ['Person', 'holds', 'Watch', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1']], ['Person', 'holds', 'Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1']], ['Person', 'wears', 'Watch', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1']], ['Watch', 'has_color', 'Gold', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1']], ['Container', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1']], ['Glass_Cylinder', 'holds', 'Pens_And_Tools', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_2']], ['Glass_Cylinder', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_2']], ['Person', 'performs', 'Transfer_Of_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_2']]]
2025-11-30 21:59:25,091 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0"
    ]
  ],
  [
    "Person",
    "manipulates",
    "Translucent_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0"
    ]
  ],
  [
    "Translucent_Tube",
    "is_connected_to",
    "Equipment",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0"
    ]
  ],
  [
    "Translucent_Tube",
    "is_inserted_into",
    "Clear_Plastic_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0"
    ]
  ],
  [
    "Clear_Plastic_Container",
    "is_inside",
    "White_Plastic_Measuring_Jug",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Watch",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1"
    ]
  ],
  [
    "Watch",
    "has_color",
    "Gold",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1"
    ]
  ],
  [
    "Container",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_1"
    ]
  ],
  [
    "Glass_Cylinder",
    "holds",
    "Pens_And_Tools",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_2"
    ]
  ],
  [
    "Glass_Cylinder",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_2"
    ]
  ],
  [
    "Person",
    "performs",
    "Transfer_Of_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_50_2"
    ]
  ]
]
2025-11-30 21:59:25,091 - src.components.global_refiner - INFO - Refinement complete: 15 → 13 triplets (total: 15.39s, LLM: 15.39s)
2025-11-30 21:59:25,091 - src.pipeline.kg_builder - INFO - Global refinement: 13 triplets in 15.39s
2025-11-30 21:59:25,091 - src.pipeline.kg_builder - INFO - Using 13 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:59:25,091 - src.pipeline.kg_builder - INFO - Pushing batch 51/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:59:25,091 - src.components.neo4j_handler - INFO - Adding 13 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:59:25,213 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:59:25,214 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:59:25,214 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:59:25,214 - src.components.neo4j_handler - INFO - Batch injected in 0.12s (triplets: 0.12s, indexes: 0.00s)
2025-11-30 21:59:25,216 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 241, 'with_embedding': 0, 'linked_chunks': 164}
2025-11-30 21:59:25,216 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:59:25,267 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 451 nodes
2025-11-30 21:59:25,420 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 374 nodes
2025-11-30 21:59:25,642 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 451, 'relationship_count': 1193, 'density': 0.0059, 'avg_degree': 5.2905, 'avg_unique_neighbors': 5.2461, 'global_efficiency': 0.2786, 'avg_path_length': 2.6723, 'avg_degree_centrality': 0.0118, 'max_degree_centrality': 0.5044, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.043, 'degree_assortativity': -0.2219, 'graph_robustness': 0.7946, 'diameter_estimate': 5, 'clustering_coefficient': 0.2778, 'weakly_connected_components': 78, 'largest_wcc_size': 374, 'pagerank_top10_percent': 7.4, 'louvain_communities': 89, 'louvain_modularity': 0.4222, 'label_entropy': 1.4983, 'computational_time': 0.4264249859843403}
2025-11-30 21:59:25,642 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 50, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511165.6427379, 'total_time': 19.69291698199231, 'aggregation': 2.782093361020088e-06, 'network_info': 0.008425754960626364, 'llm_extraction': 19.133164194063284, 'data_cleaning': 1.8237042240798473e-05, 'neo4j_injection': 0.12293964298442006, 'embedding_time': 0, 'indexing_time': 0.004967167973518372, 'graph_injection_time': 0.1177903669886291, 'acs_metrics': {'node_count': 451, 'relationship_count': 1193, 'density': 0.0059, 'avg_degree': 5.2905, 'avg_unique_neighbors': 5.2461, 'global_efficiency': 0.2786, 'avg_path_length': 2.6723, 'avg_degree_centrality': 0.0118, 'max_degree_centrality': 0.5044, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.043, 'degree_assortativity': -0.2219, 'graph_robustness': 0.7946, 'diameter_estimate': 5, 'clustering_coefficient': 0.2778, 'weakly_connected_components': 78, 'largest_wcc_size': 374, 'pagerank_top10_percent': 7.4, 'louvain_communities': 89, 'louvain_modularity': 0.4222, 'label_entropy': 1.4983, 'computational_time': 0.4264249859843403}, 'retrieval_queries': []}
2025-11-30 21:59:25,642 - src.pipeline.kg_builder - DEBUG - Batch 50 metrics: {
  "batch_idx": 50,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511165.6427379,
  "total_time": 19.69291698199231,
  "aggregation": 2.782093361020088e-06,
  "network_info": 0.008425754960626364,
  "llm_extraction": 19.133164194063284,
  "data_cleaning": 1.8237042240798473e-05,
  "neo4j_injection": 0.12293964298442006,
  "embedding_time": 0,
  "indexing_time": 0.004967167973518372,
  "graph_injection_time": 0.1177903669886291,
  "acs_metrics": {
    "node_count": 451,
    "relationship_count": 1193,
    "density": 0.0059,
    "avg_degree": 5.2905,
    "avg_unique_neighbors": 5.2461,
    "global_efficiency": 0.2786,
    "avg_path_length": 2.6723,
    "avg_degree_centrality": 0.0118,
    "max_degree_centrality": 0.5044,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.043,
    "degree_assortativity": -0.2219,
    "graph_robustness": 0.7946,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2778,
    "weakly_connected_components": 78,
    "largest_wcc_size": 374,
    "pagerank_top10_percent": 7.4,
    "louvain_communities": 89,
    "louvain_modularity": 0.4222,
    "label_entropy": 1.4983,
    "computational_time": 0.4264249859843403
  },
  "retrieval_queries": []
}
2025-11-30 21:59:25,643 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:59:25,643 - src.pipeline.kg_builder - INFO - Batch 51 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.13s, Clean: 0.00s, Neo4j: 0.12s, ACS: 0.43s
2025-11-30 21:59:25,643 - src.pipeline.kg_builder - INFO - Batch 51 completed in 19.69s
Processing KG batches:  71%|███████   | 51/72 [19:07<07:06, 20.32s/it]2025-11-30 21:59:25,643 - src.pipeline.kg_builder - INFO - Processing batch 52/72 (3 items)
2025-11-30 21:59:25,643 - src.pipeline.kg_builder - DEBUG - Batch 52 current_video_time: 12:53-12:58
2025-11-30 21:59:25,650 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 451
- Total Relationships: 356
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:59:25,650 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:59:25,650 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0 ~232 words, content: Time: 12:43-12:48 Content: The video captures a close-up, first-person view of a laboratory procedure being performed on a black countertop. The central action involves a...
2025-11-30 21:59:25,650 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1 ~227 words, content: a controlled scientific or medical procedure. The focus is on the precise transfer of a substance, likely a reagent or a sample, into a container...
2025-11-30 21:59:25,650 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_2 ~241 words, content: view of a person's hands, protected by blue nitrile gloves. The person is holding a long, flexible, translucent tube. They are carefully inserting the end...
2025-11-30 21:59:25,650 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_3 ~121 words, content: system. The person's hands are still engaged, ensuring the tube is properly positioned. The background shows a well-equipped laboratory with white cabinets, shelves filled with...
2025-11-30 21:59:25,650 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:59:25,650 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0) (~232 words) with timeout=5.0s retries=3
2025-11-30 21:59:27,155 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:59:27,155 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:59:27,155 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:59:28,438 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:59:28,439 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:59:28,439 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_2) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:59:30,136 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:59:30,136 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:59:30,136 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_3) (~121 words) with timeout=5.0s retries=3
2025-11-30 21:59:31,103 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:59:31,103 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:59:31,103 - src.components.pre_llm_injector - INFO - Extracted 19 local triplets from 4 chunks
2025-11-30 21:59:31,104 - src.pipeline.kg_builder - INFO - Pre-extraction: 19 triplets in 5.45s
2025-11-30 21:59:31,104 - src.components.global_refiner - INFO - Capping refinement input: 19 → 15 triplets
2025-11-30 21:59:31,104 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 451
- Total Relationships: 356
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1"]}, {"head": "Person", "relation": "Uses", "tail": "Translucent_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1"]}, {"head": "Translucent_Tube", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1"]}, {"head": "Clear_Liquid", "relation": "Flows Into", "tail": "Glass_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0"]}, {"head": "Glass_Beaker", "relation": "Is On", "tail": "Black_Counterboard", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0"]}, {"head": "Glass_Beaker", "relation": "Receives", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1"]}, {"head": "Person", "relation": "Holds", "tail": "Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_2"]}, {"head": "Translucent_Tube", "relation": "Is Inserted Into", "tail": "Clear_Plastic_Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_2"]}, {"head": "Clear_Plastic_Container", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_2"]}, {"head": "Translucent_Tube", "relation": "Connects To", "tail": "Yellow_Apparatus", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_2"]}, {"head": "Yellow_Apparatus", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_2"]}, {"head": "Person", "relation": "Handles", "tail": "Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_3"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:59:31,104 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~245 words, ~318 tokens)
2025-11-30 21:59:31,104 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 21:59:47,364 - src.components.global_refiner - DEBUG - LLM call completed in 16.26s
2025-11-30 21:59:47,365 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_2']], ['Person', 'holds', 'Glass_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1']], ['Person', 'uses', 'Translucent_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1']], ['Translucent_Tube', 'transfers', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1']], ['Clear_Liquid', 'flows_into', 'Glass_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0']], ['Glass_Beaker', 'is_on', 'Black_Counterboard', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0']], ['Glass_Beaker', 'receives', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1']], ['Person', 'holds', 'Watch', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_3']], ['Person', 'holds', 'Translucent_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_2']], ['Translucent_Tube', 'is_inserted_into', 'Clear_Plastic_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_2']]]
2025-11-30 21:59:47,365 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Translucent_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1"
    ]
  ],
  [
    "Translucent_Tube",
    "transfers",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1"
    ]
  ],
  [
    "Clear_Liquid",
    "flows_into",
    "Glass_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0"
    ]
  ],
  [
    "Glass_Beaker",
    "is_on",
    "Black_Counterboard",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_0"
    ]
  ],
  [
    "Glass_Beaker",
    "receives",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Watch",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Translucent_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_2"
    ]
  ],
  [
    "Translucent_Tube",
    "is_inserted_into",
    "Clear_Plastic_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_51_2"
    ]
  ]
]
2025-11-30 21:59:47,365 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 16.26s, LLM: 16.26s)
2025-11-30 21:59:47,365 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 16.26s
2025-11-30 21:59:47,365 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:59:47,365 - src.pipeline.kg_builder - INFO - Pushing batch 52/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 21:59:47,365 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:59:47,516 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:59:47,516 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:59:47,516 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:59:47,516 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.15s, indexes: 0.00s)
2025-11-30 21:59:47,518 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 245, 'with_embedding': 0, 'linked_chunks': 168}
2025-11-30 21:59:47,518 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:59:47,594 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 456 nodes
2025-11-30 21:59:47,756 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 379 nodes
2025-11-30 21:59:47,945 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 456, 'relationship_count': 1214, 'density': 0.0059, 'avg_degree': 5.3246, 'avg_unique_neighbors': 5.2763, 'global_efficiency': 0.2801, 'avg_path_length': 2.6687, 'avg_degree_centrality': 0.0117, 'max_degree_centrality': 0.5077, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0536, 'degree_assortativity': -0.2216, 'graph_robustness': 0.7957, 'diameter_estimate': 5, 'clustering_coefficient': 0.278, 'weakly_connected_components': 78, 'largest_wcc_size': 379, 'pagerank_top10_percent': 7.33, 'louvain_communities': 90, 'louvain_modularity': 0.4219, 'label_entropy': 1.498, 'computational_time': 0.427179844933562}
2025-11-30 21:59:47,945 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 51, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511187.9457617, 'total_time': 22.301793809980154, 'aggregation': 2.5329645723104477e-06, 'network_info': 0.006049240007996559, 'llm_extraction': 21.715324921999127, 'data_cleaning': 2.6289955712854862e-05, 'neo4j_injection': 0.15127578808460385, 'embedding_time': 0, 'indexing_time': 0.0049527500523254275, 'graph_injection_time': 0.1460550610208884, 'acs_metrics': {'node_count': 456, 'relationship_count': 1214, 'density': 0.0059, 'avg_degree': 5.3246, 'avg_unique_neighbors': 5.2763, 'global_efficiency': 0.2801, 'avg_path_length': 2.6687, 'avg_degree_centrality': 0.0117, 'max_degree_centrality': 0.5077, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0536, 'degree_assortativity': -0.2216, 'graph_robustness': 0.7957, 'diameter_estimate': 5, 'clustering_coefficient': 0.278, 'weakly_connected_components': 78, 'largest_wcc_size': 379, 'pagerank_top10_percent': 7.33, 'louvain_communities': 90, 'louvain_modularity': 0.4219, 'label_entropy': 1.498, 'computational_time': 0.427179844933562}, 'retrieval_queries': []}
2025-11-30 21:59:47,945 - src.pipeline.kg_builder - DEBUG - Batch 51 metrics: {
  "batch_idx": 51,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511187.9457617,
  "total_time": 22.301793809980154,
  "aggregation": 2.5329645723104477e-06,
  "network_info": 0.006049240007996559,
  "llm_extraction": 21.715324921999127,
  "data_cleaning": 2.6289955712854862e-05,
  "neo4j_injection": 0.15127578808460385,
  "embedding_time": 0,
  "indexing_time": 0.0049527500523254275,
  "graph_injection_time": 0.1460550610208884,
  "acs_metrics": {
    "node_count": 456,
    "relationship_count": 1214,
    "density": 0.0059,
    "avg_degree": 5.3246,
    "avg_unique_neighbors": 5.2763,
    "global_efficiency": 0.2801,
    "avg_path_length": 2.6687,
    "avg_degree_centrality": 0.0117,
    "max_degree_centrality": 0.5077,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0536,
    "degree_assortativity": -0.2216,
    "graph_robustness": 0.7957,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.278,
    "weakly_connected_components": 78,
    "largest_wcc_size": 379,
    "pagerank_top10_percent": 7.33,
    "louvain_communities": 90,
    "louvain_modularity": 0.4219,
    "label_entropy": 1.498,
    "computational_time": 0.427179844933562
  },
  "retrieval_queries": []
}
2025-11-30 21:59:47,946 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 21:59:47,946 - src.pipeline.kg_builder - INFO - Batch 52 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 21.72s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.43s
2025-11-30 21:59:47,946 - src.pipeline.kg_builder - INFO - Batch 52 completed in 22.30s
Processing KG batches:  72%|███████▏  | 52/72 [19:29<06:58, 20.92s/it]2025-11-30 21:59:47,947 - src.pipeline.kg_builder - INFO - Processing batch 53/72 (3 items)
2025-11-30 21:59:47,947 - src.pipeline.kg_builder - DEBUG - Batch 53 current_video_time: 13:08-13:13
2025-11-30 21:59:47,957 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 456
- Total Relationships: 362
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 21:59:47,957 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:59:47,958 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0 ~241 words, content: Time: 12:58-13:03 Content: The video captures a sequence of actions in a laboratory setting, focusing on a person performing a procedure involving a long, flexible...
2025-11-30 21:59:47,958 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1 ~240 words, content: are several power outlets, a glass beaker with pens and tools, a green bag of wipes, and a container with cotton balls. The background shows...
2025-11-30 21:59:47,958 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_2 ~207 words, content: with various items, including a blue foam block, a roll of tape, electrical cords, a glass beaker holding pens and scissors, a container of cotton...
2025-11-30 21:59:47,958 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 21:59:47,958 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:59:49,645 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:59:49,645 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:59:49,645 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1) (~240 words) with timeout=5.0s retries=3
2025-11-30 21:59:50,988 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:59:50,988 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:59:50,989 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_2) (~207 words) with timeout=5.0s retries=3
2025-11-30 21:59:52,390 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:59:52,390 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:59:52,390 - src.components.pre_llm_injector - INFO - Extracted 16 local triplets from 3 chunks
2025-11-30 21:59:52,390 - src.pipeline.kg_builder - INFO - Pre-extraction: 16 triplets in 4.43s
2025-11-30 21:59:52,390 - src.components.global_refiner - INFO - Capping refinement input: 16 → 15 triplets
2025-11-30 21:59:52,390 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 456
- Total Relationships: 362
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_2"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_2"]}, {"head": "Translucent_Tube", "relation": "Is Connected To", "tail": "Yellow_Apparatus", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0"]}, {"head": "Yellow_Apparatus", "relation": "Is Mounted On", "tail": "Metal_Stand", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0"]}, {"head": "Person", "relation": "Guides", "tail": "Translucent_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0"]}, {"head": "Translucent_Tube", "relation": "Is Inserted Into", "tail": "Clear_Plastic_Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1"]}, {"head": "Person", "relation": "Holds", "tail": "Clear Plastic Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1"]}, {"head": "Person", "relation": "Guides", "tail": "Translucent Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1"]}, {"head": "Translucent Tube", "relation": "Is Connected To", "tail": "Metal Stand", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1"]}, {"head": "Translucent Tube", "relation": "Is Connected To", "tail": "Yellow Clamp", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Glass Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_2"]}, {"head": "Translucent_Tube", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_2"]}, {"head": "Glass_Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 21:59:52,391 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~258 words, ~335 tokens)
2025-11-30 21:59:52,391 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:00:06,426 - src.components.global_refiner - DEBUG - LLM call completed in 14.04s
2025-11-30 22:00:06,426 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_2']], ['Person', 'holds', 'Translucent_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1']], ['Person', 'holds', 'Clear_Plastic_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1']], ['Person', 'holds', 'Glass_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_2']], ['Translucent_Tube', 'is_connected_to', 'Yellow_Apparatus', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0']], ['Translucent_Tube', 'is_connected_to', 'Metal_Stand', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1']], ['Translucent_Tube', 'is_connected_to', 'Yellow_Clamp', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1']], ['Translucent_Tube', 'is_inserted_into', 'Clear_Plastic_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0']], ['Translucent_Tube', 'transfers', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_2']], ['Yellow_Apparatus', 'is_mounted_on', 'Metal_Stand', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0']]]
2025-11-30 22:00:06,426 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Translucent_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Clear_Plastic_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_2"
    ]
  ],
  [
    "Translucent_Tube",
    "is_connected_to",
    "Yellow_Apparatus",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0"
    ]
  ],
  [
    "Translucent_Tube",
    "is_connected_to",
    "Metal_Stand",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1"
    ]
  ],
  [
    "Translucent_Tube",
    "is_connected_to",
    "Yellow_Clamp",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_1"
    ]
  ],
  [
    "Translucent_Tube",
    "is_inserted_into",
    "Clear_Plastic_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0"
    ]
  ],
  [
    "Translucent_Tube",
    "transfers",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_2"
    ]
  ],
  [
    "Yellow_Apparatus",
    "is_mounted_on",
    "Metal_Stand",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_52_0"
    ]
  ]
]
2025-11-30 22:00:06,426 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 14.04s, LLM: 14.04s)
2025-11-30 22:00:06,426 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 14.04s
2025-11-30 22:00:06,427 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:00:06,427 - src.pipeline.kg_builder - INFO - Pushing batch 53/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:00:06,427 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:00:06,575 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:00:06,575 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:00:06,575 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:00:06,575 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.14s, indexes: 0.00s)
2025-11-30 22:00:06,576 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 248, 'with_embedding': 0, 'linked_chunks': 171}
2025-11-30 22:00:06,576 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:00:06,630 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 462 nodes
2025-11-30 22:00:06,794 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 385 nodes
2025-11-30 22:00:06,983 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 462, 'relationship_count': 1236, 'density': 0.0058, 'avg_degree': 5.3506, 'avg_unique_neighbors': 5.303, 'global_efficiency': 0.2815, 'avg_path_length': 2.6696, 'avg_degree_centrality': 0.0116, 'max_degree_centrality': 0.5098, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0432, 'degree_assortativity': -0.2181, 'graph_robustness': 0.7945, 'diameter_estimate': 5, 'clustering_coefficient': 0.279, 'weakly_connected_components': 78, 'largest_wcc_size': 385, 'pagerank_top10_percent': 7.23, 'louvain_communities': 89, 'louvain_modularity': 0.4196, 'label_entropy': 1.498, 'computational_time': 0.4063215870410204}
2025-11-30 22:00:06,983 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 52, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511206.983319, 'total_time': 19.036275984020904, 'aggregation': 2.9869843274354935e-06, 'network_info': 0.01047132397070527, 'llm_extraction': 18.469333131914027, 'data_cleaning': 1.4296034350991249e-05, 'neo4j_injection': 0.1483721029944718, 'embedding_time': 0, 'indexing_time': 0.004839582019485533, 'graph_injection_time': 0.1433677029563114, 'acs_metrics': {'node_count': 462, 'relationship_count': 1236, 'density': 0.0058, 'avg_degree': 5.3506, 'avg_unique_neighbors': 5.303, 'global_efficiency': 0.2815, 'avg_path_length': 2.6696, 'avg_degree_centrality': 0.0116, 'max_degree_centrality': 0.5098, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0432, 'degree_assortativity': -0.2181, 'graph_robustness': 0.7945, 'diameter_estimate': 5, 'clustering_coefficient': 0.279, 'weakly_connected_components': 78, 'largest_wcc_size': 385, 'pagerank_top10_percent': 7.23, 'louvain_communities': 89, 'louvain_modularity': 0.4196, 'label_entropy': 1.498, 'computational_time': 0.4063215870410204}, 'retrieval_queries': []}
2025-11-30 22:00:06,983 - src.pipeline.kg_builder - DEBUG - Batch 52 metrics: {
  "batch_idx": 52,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511206.983319,
  "total_time": 19.036275984020904,
  "aggregation": 2.9869843274354935e-06,
  "network_info": 0.01047132397070527,
  "llm_extraction": 18.469333131914027,
  "data_cleaning": 1.4296034350991249e-05,
  "neo4j_injection": 0.1483721029944718,
  "embedding_time": 0,
  "indexing_time": 0.004839582019485533,
  "graph_injection_time": 0.1433677029563114,
  "acs_metrics": {
    "node_count": 462,
    "relationship_count": 1236,
    "density": 0.0058,
    "avg_degree": 5.3506,
    "avg_unique_neighbors": 5.303,
    "global_efficiency": 0.2815,
    "avg_path_length": 2.6696,
    "avg_degree_centrality": 0.0116,
    "max_degree_centrality": 0.5098,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0432,
    "degree_assortativity": -0.2181,
    "graph_robustness": 0.7945,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.279,
    "weakly_connected_components": 78,
    "largest_wcc_size": 385,
    "pagerank_top10_percent": 7.23,
    "louvain_communities": 89,
    "louvain_modularity": 0.4196,
    "label_entropy": 1.498,
    "computational_time": 0.4063215870410204
  },
  "retrieval_queries": []
}
2025-11-30 22:00:06,984 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:00:06,984 - src.pipeline.kg_builder - INFO - Batch 53 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 18.47s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.41s
2025-11-30 22:00:06,984 - src.pipeline.kg_builder - INFO - Batch 53 completed in 19.04s
Processing KG batches:  74%|███████▎  | 53/72 [19:48<06:26, 20.35s/it]2025-11-30 22:00:06,984 - src.pipeline.kg_builder - INFO - Processing batch 54/72 (3 items)
2025-11-30 22:00:06,984 - src.pipeline.kg_builder - DEBUG - Batch 54 current_video_time: 13:23-13:28
2025-11-30 22:00:06,993 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 462
- Total Relationships: 367
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:00:06,993 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 22:00:06,993 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0 ~226 words, content: Time: 13:13-13:18 Content: The video shows a person conducting a laboratory procedure, likely a rinsing or washing step, from a first-person perspective. The individual, wearing...
2025-11-30 22:00:06,993 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1 ~225 words, content: , the video captures a precise laboratory technique where a glass container is being rinsed or washed using a liquid transfer method, resulting in a...
2025-11-30 22:00:06,993 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_2 ~227 words, content: . The person in the foreground continues to hold the white tube, which is now positioned over the large jug. The workbench is cluttered with...
2025-11-30 22:00:06,993 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:00:06,993 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0) (~226 words) with timeout=5.0s retries=3
2025-11-30 22:00:08,490 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:00:08,490 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:00:08,490 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1) (~225 words) with timeout=5.0s retries=3
2025-11-30 22:00:09,763 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:00:09,763 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:00:09,763 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_2) (~227 words) with timeout=5.0s retries=3
2025-11-30 22:00:10,736 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:00:10,737 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:00:10,737 - src.components.pre_llm_injector - INFO - Extracted 18 local triplets from 3 chunks
2025-11-30 22:00:10,737 - src.pipeline.kg_builder - INFO - Pre-extraction: 18 triplets in 3.74s
2025-11-30 22:00:10,737 - src.components.global_refiner - INFO - Capping refinement input: 18 → 15 triplets
2025-11-30 22:00:10,737 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 462
- Total Relationships: 367
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0"]}, {"head": "Pipette_Tube", "relation": "Is Inserted Into", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0"]}, {"head": "Person", "relation": "Submerges", "tail": "Glass_Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0"]}, {"head": "Glass_Container", "relation": "Is Rinsed In", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1"]}, {"head": "Person", "relation": "Holds", "tail": "White_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1"]}, {"head": "Person", "relation": "Holds", "tail": "Clear_Plastic_Jug", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1"]}, {"head": "Person", "relation": "Wears", "tail": "Black_Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1"]}, {"head": "Person", "relation": "Holds", "tail": "Small_Clear_Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1"]}, {"head": "Person", "relation": "Manipulates", "tail": "White_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1"]}, {"head": "Person", "relation": "Holds", "tail": "Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_2"]}, {"head": "Person", "relation": "Wears", "tail": "Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_2"]}, {"head": "Tube", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:00:10,738 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~239 words, ~311 tokens)
2025-11-30 22:00:10,738 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:00:22,223 - src.components.global_refiner - DEBUG - LLM call completed in 11.49s
2025-11-30 22:00:22,224 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0']], ['Person', 'holds', 'Pipette_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0']], ['Pipette_Tube', 'is_inserted_into', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0']], ['Beaker', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0']], ['Person', 'submerges', 'Glass_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0']], ['Glass_Container', 'is_rinsed_in', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1']], ['Person', 'holds', 'White_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1']], ['Person', 'holds', 'Clear_Plastic_Jug', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1']], ['Person', 'wears', 'Black_Watch', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1']]]
2025-11-30 22:00:22,224 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0"
    ]
  ],
  [
    "Pipette_Tube",
    "is_inserted_into",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0"
    ]
  ],
  [
    "Person",
    "submerges",
    "Glass_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0"
    ]
  ],
  [
    "Glass_Container",
    "is_rinsed_in",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1"
    ]
  ],
  [
    "Person",
    "holds",
    "White_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Clear_Plastic_Jug",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Black_Watch",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_53_1"
    ]
  ]
]
2025-11-30 22:00:22,224 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.49s, LLM: 11.49s)
2025-11-30 22:00:22,224 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.49s
2025-11-30 22:00:22,224 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:00:22,224 - src.pipeline.kg_builder - INFO - Pushing batch 54/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:00:22,224 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:00:22,337 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:00:22,337 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:00:22,337 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:00:22,337 - src.components.neo4j_handler - INFO - Batch injected in 0.11s (triplets: 0.11s, indexes: 0.00s)
2025-11-30 22:00:22,339 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 251, 'with_embedding': 0, 'linked_chunks': 173}
2025-11-30 22:00:22,339 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:00:22,417 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 468 nodes
2025-11-30 22:00:22,584 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 390 nodes
2025-11-30 22:00:22,780 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 468, 'relationship_count': 1252, 'density': 0.0057, 'avg_degree': 5.3504, 'avg_unique_neighbors': 5.3034, 'global_efficiency': 0.2822, 'avg_path_length': 2.6606, 'avg_degree_centrality': 0.0115, 'max_degree_centrality': 0.5139, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0427, 'degree_assortativity': -0.2235, 'graph_robustness': 0.7963, 'diameter_estimate': 5, 'clustering_coefficient': 0.279, 'weakly_connected_components': 79, 'largest_wcc_size': 390, 'pagerank_top10_percent': 7.14, 'louvain_communities': 91, 'louvain_modularity': 0.4197, 'label_entropy': 1.4981, 'computational_time': 0.44126208301167935}
2025-11-30 22:00:22,780 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 53, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511222.7805858, 'total_time': 15.795998579007573, 'aggregation': 2.2810418158769608e-06, 'network_info': 0.008397586992941797, 'llm_extraction': 15.231291602016427, 'data_cleaning': 2.1968968212604523e-05, 'neo4j_injection': 0.11324409092776477, 'embedding_time': 0, 'indexing_time': 0.003922617994248867, 'graph_injection_time': 0.10908648394979537, 'acs_metrics': {'node_count': 468, 'relationship_count': 1252, 'density': 0.0057, 'avg_degree': 5.3504, 'avg_unique_neighbors': 5.3034, 'global_efficiency': 0.2822, 'avg_path_length': 2.6606, 'avg_degree_centrality': 0.0115, 'max_degree_centrality': 0.5139, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0427, 'degree_assortativity': -0.2235, 'graph_robustness': 0.7963, 'diameter_estimate': 5, 'clustering_coefficient': 0.279, 'weakly_connected_components': 79, 'largest_wcc_size': 390, 'pagerank_top10_percent': 7.14, 'louvain_communities': 91, 'louvain_modularity': 0.4197, 'label_entropy': 1.4981, 'computational_time': 0.44126208301167935}, 'retrieval_queries': []}
2025-11-30 22:00:22,780 - src.pipeline.kg_builder - DEBUG - Batch 53 metrics: {
  "batch_idx": 53,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511222.7805858,
  "total_time": 15.795998579007573,
  "aggregation": 2.2810418158769608e-06,
  "network_info": 0.008397586992941797,
  "llm_extraction": 15.231291602016427,
  "data_cleaning": 2.1968968212604523e-05,
  "neo4j_injection": 0.11324409092776477,
  "embedding_time": 0,
  "indexing_time": 0.003922617994248867,
  "graph_injection_time": 0.10908648394979537,
  "acs_metrics": {
    "node_count": 468,
    "relationship_count": 1252,
    "density": 0.0057,
    "avg_degree": 5.3504,
    "avg_unique_neighbors": 5.3034,
    "global_efficiency": 0.2822,
    "avg_path_length": 2.6606,
    "avg_degree_centrality": 0.0115,
    "max_degree_centrality": 0.5139,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0427,
    "degree_assortativity": -0.2235,
    "graph_robustness": 0.7963,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.279,
    "weakly_connected_components": 79,
    "largest_wcc_size": 390,
    "pagerank_top10_percent": 7.14,
    "louvain_communities": 91,
    "louvain_modularity": 0.4197,
    "label_entropy": 1.4981,
    "computational_time": 0.44126208301167935
  },
  "retrieval_queries": []
}
2025-11-30 22:00:22,781 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:00:22,781 - src.pipeline.kg_builder - INFO - Batch 54 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 15.23s, Clean: 0.00s, Neo4j: 0.11s, ACS: 0.44s
2025-11-30 22:00:22,781 - src.pipeline.kg_builder - INFO - Batch 54 completed in 15.80s
Processing KG batches:  75%|███████▌  | 54/72 [20:04<05:41, 18.99s/it]2025-11-30 22:00:22,781 - src.pipeline.kg_builder - INFO - Processing batch 55/72 (3 items)
2025-11-30 22:00:22,781 - src.pipeline.kg_builder - DEBUG - Batch 55 current_video_time: 13:38-13:43
2025-11-30 22:00:22,790 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 468
- Total Relationships: 374
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:00:22,791 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 22:00:22,791 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0 ~227 words, content: Time: 13:28-13:33 Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a procedure on a black lab bench. The...
2025-11-30 22:00:22,791 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1 ~225 words, content: with their right hand and a long, translucent pipette with their left. They are carefully inserting the pipette into the beaker, which contains a clear...
2025-11-30 22:00:22,791 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_2 ~236 words, content: first-person perspective. A person wearing blue nitrile gloves is holding a long, flexible, translucent tube. They are carefully inserting this tube into a large, clear...
2025-11-30 22:00:22,791 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_3 ~77 words, content: a stand. The tube is being used to transfer the white liquid from the beaker into a glass container that is on the white stirrer....
2025-11-30 22:00:22,791 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:00:22,791 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0) (~227 words) with timeout=5.0s retries=3
2025-11-30 22:00:24,196 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:00:24,196 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:00:24,196 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1) (~225 words) with timeout=5.0s retries=3
2025-11-30 22:00:25,210 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:00:25,210 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:00:25,211 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_2) (~236 words) with timeout=5.0s retries=3
2025-11-30 22:00:26,735 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:00:26,736 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:00:26,736 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_3) (~77 words) with timeout=5.0s retries=3
2025-11-30 22:00:27,739 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 22:00:27,740 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 22:00:27,740 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 4 chunks
2025-11-30 22:00:27,740 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 4.95s
2025-11-30 22:00:27,740 - src.components.global_refiner - INFO - Capping refinement input: 22 → 15 triplets
2025-11-30 22:00:27,741 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 468
- Total Relationships: 374
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_2"]}, {"head": "Person", "relation": "Holds", "tail": "Clear_Plastic_Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0"]}, {"head": "Person", "relation": "Holds", "tail": "Long_Translucent_Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0"]}, {"head": "Person", "relation": "Performs", "tail": "Procedure", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Clear_Plastic_Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Long_Translucent_Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_3"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_2"]}, {"head": "Translucent_Tube", "relation": "Is Inserted Into", "tail": "Clear_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_2"]}, {"head": "Clear_Beaker", "relation": "Contains", "tail": "Cloudy_White_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:00:27,741 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~240 words, ~312 tokens)
2025-11-30 22:00:27,741 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:00:39,767 - src.components.global_refiner - DEBUG - LLM call completed in 12.03s
2025-11-30 22:00:39,767 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_2']], ['Person', 'holds', 'Clear_Plastic_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0']], ['Person', 'holds', 'Long_Translucent_Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0']], ['Person', 'performs', 'Procedure', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0']], ['Lab_Bench', 'contains', 'Clear_Plastic_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0']], ['Lab_Bench', 'contains', 'Long_Translucent_Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0']], ['Person', 'holds', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1']], ['Person', 'holds', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1']], ['Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1']]]
2025-11-30 22:00:39,767 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Clear_Plastic_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Long_Translucent_Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0"
    ]
  ],
  [
    "Person",
    "performs",
    "Procedure",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Clear_Plastic_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Long_Translucent_Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_54_1"
    ]
  ]
]
2025-11-30 22:00:39,767 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 12.03s, LLM: 12.03s)
2025-11-30 22:00:39,768 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 12.03s
2025-11-30 22:00:39,768 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:00:39,768 - src.pipeline.kg_builder - INFO - Pushing batch 55/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:00:39,768 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:00:39,883 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:00:39,884 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:00:39,884 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:00:39,884 - src.components.neo4j_handler - INFO - Batch injected in 0.12s (triplets: 0.11s, indexes: 0.00s)
2025-11-30 22:00:39,885 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 255, 'with_embedding': 0, 'linked_chunks': 176}
2025-11-30 22:00:39,885 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:00:39,941 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 474 nodes
2025-11-30 22:00:40,117 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 395 nodes
2025-11-30 22:00:40,318 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 474, 'relationship_count': 1268, 'density': 0.0057, 'avg_degree': 5.3502, 'avg_unique_neighbors': 5.3038, 'global_efficiency': 0.2829, 'avg_path_length': 2.653, 'avg_degree_centrality': 0.0113, 'max_degree_centrality': 0.518, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0517, 'degree_assortativity': -0.2261, 'graph_robustness': 0.7957, 'diameter_estimate': 5, 'clustering_coefficient': 0.2797, 'weakly_connected_components': 80, 'largest_wcc_size': 395, 'pagerank_top10_percent': 7.06, 'louvain_communities': 93, 'louvain_modularity': 0.4186, 'label_entropy': 1.4979, 'computational_time': 0.43305048800539225}
2025-11-30 22:00:40,318 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 54, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511240.3186147, 'total_time': 17.536792730912566, 'aggregation': 2.408982254564762e-06, 'network_info': 0.008865733980201185, 'llm_extraction': 16.977300142054446, 'data_cleaning': 2.441194374114275e-05, 'neo4j_injection': 0.11609657609369606, 'embedding_time': 0, 'indexing_time': 0.003292851964943111, 'graph_injection_time': 0.1124823100399226, 'acs_metrics': {'node_count': 474, 'relationship_count': 1268, 'density': 0.0057, 'avg_degree': 5.3502, 'avg_unique_neighbors': 5.3038, 'global_efficiency': 0.2829, 'avg_path_length': 2.653, 'avg_degree_centrality': 0.0113, 'max_degree_centrality': 0.518, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0517, 'degree_assortativity': -0.2261, 'graph_robustness': 0.7957, 'diameter_estimate': 5, 'clustering_coefficient': 0.2797, 'weakly_connected_components': 80, 'largest_wcc_size': 395, 'pagerank_top10_percent': 7.06, 'louvain_communities': 93, 'louvain_modularity': 0.4186, 'label_entropy': 1.4979, 'computational_time': 0.43305048800539225}, 'retrieval_queries': []}
2025-11-30 22:00:40,318 - src.pipeline.kg_builder - DEBUG - Batch 54 metrics: {
  "batch_idx": 54,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511240.3186147,
  "total_time": 17.536792730912566,
  "aggregation": 2.408982254564762e-06,
  "network_info": 0.008865733980201185,
  "llm_extraction": 16.977300142054446,
  "data_cleaning": 2.441194374114275e-05,
  "neo4j_injection": 0.11609657609369606,
  "embedding_time": 0,
  "indexing_time": 0.003292851964943111,
  "graph_injection_time": 0.1124823100399226,
  "acs_metrics": {
    "node_count": 474,
    "relationship_count": 1268,
    "density": 0.0057,
    "avg_degree": 5.3502,
    "avg_unique_neighbors": 5.3038,
    "global_efficiency": 0.2829,
    "avg_path_length": 2.653,
    "avg_degree_centrality": 0.0113,
    "max_degree_centrality": 0.518,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0517,
    "degree_assortativity": -0.2261,
    "graph_robustness": 0.7957,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2797,
    "weakly_connected_components": 80,
    "largest_wcc_size": 395,
    "pagerank_top10_percent": 7.06,
    "louvain_communities": 93,
    "louvain_modularity": 0.4186,
    "label_entropy": 1.4979,
    "computational_time": 0.43305048800539225
  },
  "retrieval_queries": []
}
2025-11-30 22:00:40,319 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:00:40,319 - src.pipeline.kg_builder - INFO - Batch 55 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 16.98s, Clean: 0.00s, Neo4j: 0.12s, ACS: 0.43s
2025-11-30 22:00:40,319 - src.pipeline.kg_builder - INFO - Batch 55 completed in 17.54s
Processing KG batches:  76%|███████▋  | 55/72 [20:21<05:15, 18.55s/it]2025-11-30 22:00:40,319 - src.pipeline.kg_builder - INFO - Processing batch 56/72 (3 items)
2025-11-30 22:00:40,319 - src.pipeline.kg_builder - DEBUG - Batch 56 current_video_time: 13:53-13:58
2025-11-30 22:00:40,327 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 474
- Total Relationships: 378
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:00:40,327 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 22:00:40,327 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0 ~233 words, content: Time: 13:43-13:48 Content: The sequence of images captures a laboratory procedure involving the transfer of a liquid using a pipette. The setting is a well-equipped...
2025-11-30 22:00:40,327 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1 ~243 words, content: Content: The video sequence captures a scientific experiment being conducted in a laboratory setting. The scene begins with a close-up view of a person's hands,...
2025-11-30 22:00:40,327 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_2 ~222 words, content: is one of focused concentration, with the individual fully engaged in the task at hand. The video effectively conveys the meticulous nature of laboratory work,...
2025-11-30 22:00:40,327 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_3 ~115 words, content: lab environment, including the glass cabinet and other equipment, remains visible, providing context for the experiment. - **Introduction of the Scientist (Frame 4):** A person...
2025-11-30 22:00:40,327 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:00:40,327 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0) (~233 words) with timeout=5.0s retries=3
2025-11-30 22:00:41,528 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:00:41,528 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:00:41,528 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1) (~243 words) with timeout=5.0s retries=3
2025-11-30 22:00:42,956 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:00:42,956 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:00:42,956 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_2) (~222 words) with timeout=5.0s retries=3
2025-11-30 22:00:44,144 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:00:44,144 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:00:44,144 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_3) (~115 words) with timeout=5.0s retries=3
2025-11-30 22:00:45,259 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 22:00:45,259 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 22:00:45,259 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 4 chunks
2025-11-30 22:00:45,259 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 4.93s
2025-11-30 22:00:45,259 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 22:00:45,260 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 474
- Total Relationships: 378
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0"]}, {"head": "Liquid", "relation": "Is", "tail": "White_Viscous", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0"]}, {"head": "Pipette", "relation": "Is Connected To", "tail": "Vacuum_System", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1"]}, {"head": "Liquid", "relation": "Is In", "tail": "Glass_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1"]}, {"head": "Glass_Flask", "relation": "Is On", "tail": "Magnetic_Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1"]}, {"head": "Magnetic_Stirrer", "relation": "Rotates", "tail": "Stir_Bar", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1"]}, {"head": "Glass_Beaker", "relation": "Is On", "tail": "Digital_Scale", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Glass Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_2"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_2"]}, {"head": "Person", "relation": "Holds", "tail": "Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:00:45,260 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~247 words, ~321 tokens)
2025-11-30 22:00:45,260 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:00:58,227 - src.components.global_refiner - DEBUG - LLM call completed in 12.97s
2025-11-30 22:00:58,227 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_2']], ['Person', 'wears', 'Watch', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0']], ['Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0']], ['Liquid', 'is', 'White_Viscous', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0']], ['Pipette', 'is_connected_to', 'Vacuum_System', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0']], ['Person', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1']], ['Liquid', 'is_in', 'Glass_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1']], ['Glass_Flask', 'is_on', 'Magnetic_Stirrer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_2']], ['Magnetic_Stirrer', 'rotates', 'Stir_Bar', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1']]]
2025-11-30 22:00:58,227 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0"
    ]
  ],
  [
    "Liquid",
    "is",
    "White_Viscous",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0"
    ]
  ],
  [
    "Pipette",
    "is_connected_to",
    "Vacuum_System",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_0"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1"
    ]
  ],
  [
    "Liquid",
    "is_in",
    "Glass_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1"
    ]
  ],
  [
    "Glass_Flask",
    "is_on",
    "Magnetic_Stirrer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_2"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "rotates",
    "Stir_Bar",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_55_1"
    ]
  ]
]
2025-11-30 22:00:58,227 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 12.97s, LLM: 12.97s)
2025-11-30 22:00:58,227 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 12.97s
2025-11-30 22:00:58,227 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:00:58,227 - src.pipeline.kg_builder - INFO - Pushing batch 56/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:00:58,228 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:00:58,387 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:00:58,387 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:00:58,388 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:00:58,388 - src.components.neo4j_handler - INFO - Batch injected in 0.16s (triplets: 0.16s, indexes: 0.00s)
2025-11-30 22:00:58,389 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 259, 'with_embedding': 0, 'linked_chunks': 179}
2025-11-30 22:00:58,389 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:00:58,469 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 481 nodes
2025-11-30 22:00:58,652 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 401 nodes
2025-11-30 22:00:58,861 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 481, 'relationship_count': 1288, 'density': 0.0056, 'avg_degree': 5.3555, 'avg_unique_neighbors': 5.3098, 'global_efficiency': 0.283, 'avg_path_length': 2.6536, 'avg_degree_centrality': 0.0112, 'max_degree_centrality': 0.5167, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0471, 'degree_assortativity': -0.2236, 'graph_robustness': 0.7919, 'diameter_estimate': 5, 'clustering_coefficient': 0.2804, 'weakly_connected_components': 81, 'largest_wcc_size': 401, 'pagerank_top10_percent': 6.97, 'louvain_communities': 93, 'louvain_modularity': 0.4213, 'label_entropy': 1.4979, 'computational_time': 0.4716124499682337}
2025-11-30 22:00:58,861 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 55, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511258.8617058, 'total_time': 18.541844559949823, 'aggregation': 2.3060711100697517e-06, 'network_info': 0.0070937309646978974, 'llm_extraction': 17.900739958975464, 'data_cleaning': 2.4775974452495575e-05, 'neo4j_injection': 0.160475843003951, 'embedding_time': 0, 'indexing_time': 0.003943027928471565, 'graph_injection_time': 0.15626838302705437, 'acs_metrics': {'node_count': 481, 'relationship_count': 1288, 'density': 0.0056, 'avg_degree': 5.3555, 'avg_unique_neighbors': 5.3098, 'global_efficiency': 0.283, 'avg_path_length': 2.6536, 'avg_degree_centrality': 0.0112, 'max_degree_centrality': 0.5167, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0471, 'degree_assortativity': -0.2236, 'graph_robustness': 0.7919, 'diameter_estimate': 5, 'clustering_coefficient': 0.2804, 'weakly_connected_components': 81, 'largest_wcc_size': 401, 'pagerank_top10_percent': 6.97, 'louvain_communities': 93, 'louvain_modularity': 0.4213, 'label_entropy': 1.4979, 'computational_time': 0.4716124499682337}, 'retrieval_queries': []}
2025-11-30 22:00:58,861 - src.pipeline.kg_builder - DEBUG - Batch 55 metrics: {
  "batch_idx": 55,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511258.8617058,
  "total_time": 18.541844559949823,
  "aggregation": 2.3060711100697517e-06,
  "network_info": 0.0070937309646978974,
  "llm_extraction": 17.900739958975464,
  "data_cleaning": 2.4775974452495575e-05,
  "neo4j_injection": 0.160475843003951,
  "embedding_time": 0,
  "indexing_time": 0.003943027928471565,
  "graph_injection_time": 0.15626838302705437,
  "acs_metrics": {
    "node_count": 481,
    "relationship_count": 1288,
    "density": 0.0056,
    "avg_degree": 5.3555,
    "avg_unique_neighbors": 5.3098,
    "global_efficiency": 0.283,
    "avg_path_length": 2.6536,
    "avg_degree_centrality": 0.0112,
    "max_degree_centrality": 0.5167,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0471,
    "degree_assortativity": -0.2236,
    "graph_robustness": 0.7919,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2804,
    "weakly_connected_components": 81,
    "largest_wcc_size": 401,
    "pagerank_top10_percent": 6.97,
    "louvain_communities": 93,
    "louvain_modularity": 0.4213,
    "label_entropy": 1.4979,
    "computational_time": 0.4716124499682337
  },
  "retrieval_queries": []
}
2025-11-30 22:00:58,862 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:00:58,862 - src.pipeline.kg_builder - INFO - Batch 56 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 17.90s, Clean: 0.00s, Neo4j: 0.16s, ACS: 0.47s
2025-11-30 22:00:58,862 - src.pipeline.kg_builder - INFO - Batch 56 completed in 18.54s
Processing KG batches:  78%|███████▊  | 56/72 [20:40<04:56, 18.55s/it]2025-11-30 22:00:58,862 - src.pipeline.kg_builder - INFO - Processing batch 57/72 (3 items)
2025-11-30 22:00:58,862 - src.pipeline.kg_builder - DEBUG - Batch 57 current_video_time: 14:07-14:12
2025-11-30 22:00:58,872 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 481
- Total Relationships: 382
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:00:58,872 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 22:00:58,872 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0 ~236 words, content: Time: 13:58-14:03 Content: The video captures a sequence of actions in a laboratory setting, focusing on a chemical experiment. The scene is set on a...
2025-11-30 22:00:58,872 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1 ~223 words, content: , likely the preparation of a chemical solution or the initiation of a reaction that requires controlled conditions, such as heating and reflux. The person's...
2025-11-30 22:00:58,872 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_2 ~238 words, content: a closer, first-person perspective, showing a person's hands wearing blue nitrile gloves. The person is actively handling a white plastic beaker. The long tube from...
2025-11-30 22:00:58,872 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_3 ~255 words, content: with a clamp is visible to the left. - The second frame provides a closer view of the container and the tube. The person's hand...
2025-11-30 22:00:58,872 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_4 ~21 words, content:  is using a yellow apparatus with multiple tubes and clamps. The lab is well-equipped with various pieces of equipment and supplies.
2025-11-30 22:00:58,872 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:00:58,873 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0) (~236 words) with timeout=5.0s retries=3
2025-11-30 22:01:00,283 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:01:00,283 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:01:00,283 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1) (~223 words) with timeout=5.0s retries=3
2025-11-30 22:01:01,969 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:01:01,969 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:01:01,969 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_2) (~238 words) with timeout=5.0s retries=3
2025-11-30 22:01:03,537 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:01:03,537 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:01:03,538 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_3) (~255 words) with timeout=5.0s retries=3
2025-11-30 22:01:04,710 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 22:01:04,710 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 22:01:04,711 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_4) (~21 words) with timeout=5.0s retries=3
2025-11-30 22:01:05,800 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 22:01:05,800 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 22:01:05,800 - src.components.pre_llm_injector - INFO - Extracted 29 local triplets from 5 chunks
2025-11-30 22:01:05,800 - src.pipeline.kg_builder - INFO - Pre-extraction: 29 triplets in 6.93s
2025-11-30 22:01:05,800 - src.components.global_refiner - INFO - Capping refinement input: 29 → 15 triplets
2025-11-30 22:01:05,800 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 481
- Total Relationships: 382
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0"]}, {"head": "Person", "relation": "Pours", "tail": "Clear Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0"]}, {"head": "Clear Liquid", "relation": "Flows Into", "tail": "Translucent Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Heated Magnetic Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0"]}, {"head": "Reflux Condenser", "relation": "Is Above", "tail": "Glass Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0"]}, {"head": "Glass Flask", "relation": "Is Connected To", "tail": "Reflux Condenser", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0"]}, {"head": "Person", "relation": "Wears", "tail": "Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1"]}, {"head": "Reaction Apparatus", "relation": "Contains", "tail": "Round_Bottom_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1"]}, {"head": "Round_Bottom_Flask", "relation": "Is On", "tail": "Magnetic_Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1"]}, {"head": "Magnetic_Stirrer", "relation": "Is On", "tail": "Hot_Plate", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1"]}, {"head": "Reaction_Apparatus", "relation": "Is Connected To", "tail": "Schlenk_Line", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1"]}, {"head": "Schlenk_Line", "relation": "Is Mounted On", "tail": "Stand", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_2"]}, {"head": "Person", "relation": "Holds", "tail": "White_Plastic_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_2"]}, {"head": "Long_Tube", "relation": "Delivers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:01:05,800 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~259 words, ~337 tokens)
2025-11-30 22:01:05,800 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:01:18,457 - src.components.global_refiner - DEBUG - LLM call completed in 12.66s
2025-11-30 22:01:18,457 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_2']], ['Person', 'pours', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0']], ['Clear_Liquid', 'flows_into', 'Translucent_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0']], ['Glass_Flask', 'is_on', 'Heated_Magnetic_Stirrer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0']], ['Reflux_Condenser', 'is_above', 'Glass_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0']], ['Glass_Flask', 'is_connected_to', 'Reflux_Condenser', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0']], ['Person', 'wears', 'Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1']], ['Reaction_Apparatus', 'contains', 'Round_Bottom_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1']], ['Round_Bottom_Flask', 'is_on', 'Magnetic_Stirrer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1']], ['Magnetic_Stirrer', 'is_on', 'Hot_Plate', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1']]]
2025-11-30 22:01:18,458 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_2"
    ]
  ],
  [
    "Person",
    "pours",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0"
    ]
  ],
  [
    "Clear_Liquid",
    "flows_into",
    "Translucent_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0"
    ]
  ],
  [
    "Glass_Flask",
    "is_on",
    "Heated_Magnetic_Stirrer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0"
    ]
  ],
  [
    "Reflux_Condenser",
    "is_above",
    "Glass_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0"
    ]
  ],
  [
    "Glass_Flask",
    "is_connected_to",
    "Reflux_Condenser",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1"
    ]
  ],
  [
    "Reaction_Apparatus",
    "contains",
    "Round_Bottom_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1"
    ]
  ],
  [
    "Round_Bottom_Flask",
    "is_on",
    "Magnetic_Stirrer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "is_on",
    "Hot_Plate",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_56_1"
    ]
  ]
]
2025-11-30 22:01:18,458 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 12.66s, LLM: 12.66s)
2025-11-30 22:01:18,458 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 12.66s
2025-11-30 22:01:18,458 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:01:18,458 - src.pipeline.kg_builder - INFO - Pushing batch 57/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:01:18,458 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:01:18,633 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:01:18,634 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:01:18,634 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:01:18,634 - src.components.neo4j_handler - INFO - Batch injected in 0.18s (triplets: 0.17s, indexes: 0.00s)
2025-11-30 22:01:18,635 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 264, 'with_embedding': 0, 'linked_chunks': 182}
2025-11-30 22:01:18,635 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:01:18,716 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 491 nodes
2025-11-30 22:01:18,906 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 409 nodes
2025-11-30 22:01:19,123 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 491, 'relationship_count': 1311, 'density': 0.0054, 'avg_degree': 5.3401, 'avg_unique_neighbors': 5.2912, 'global_efficiency': 0.2815, 'avg_path_length': 2.6627, 'avg_degree_centrality': 0.0109, 'max_degree_centrality': 0.5143, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0442, 'degree_assortativity': -0.215, 'graph_robustness': 0.7918, 'diameter_estimate': 5, 'clustering_coefficient': 0.2834, 'weakly_connected_components': 83, 'largest_wcc_size': 409, 'pagerank_top10_percent': 6.81, 'louvain_communities': 96, 'louvain_modularity': 0.43, 'label_entropy': 1.4979, 'computational_time': 0.4878066909732297}
2025-11-30 22:01:19,123 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 56, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511279.1237795, 'total_time': 20.260807200917043, 'aggregation': 2.249958924949169e-06, 'network_info': 0.00920594809576869, 'llm_extraction': 19.586052233935334, 'data_cleaning': 2.560601569712162e-05, 'neo4j_injection': 0.17584928695578128, 'embedding_time': 0, 'indexing_time': 0.0028311109635978937, 'graph_injection_time': 0.1727639470482245, 'acs_metrics': {'node_count': 491, 'relationship_count': 1311, 'density': 0.0054, 'avg_degree': 5.3401, 'avg_unique_neighbors': 5.2912, 'global_efficiency': 0.2815, 'avg_path_length': 2.6627, 'avg_degree_centrality': 0.0109, 'max_degree_centrality': 0.5143, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0442, 'degree_assortativity': -0.215, 'graph_robustness': 0.7918, 'diameter_estimate': 5, 'clustering_coefficient': 0.2834, 'weakly_connected_components': 83, 'largest_wcc_size': 409, 'pagerank_top10_percent': 6.81, 'louvain_communities': 96, 'louvain_modularity': 0.43, 'label_entropy': 1.4979, 'computational_time': 0.4878066909732297}, 'retrieval_queries': []}
2025-11-30 22:01:19,123 - src.pipeline.kg_builder - DEBUG - Batch 56 metrics: {
  "batch_idx": 56,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511279.1237795,
  "total_time": 20.260807200917043,
  "aggregation": 2.249958924949169e-06,
  "network_info": 0.00920594809576869,
  "llm_extraction": 19.586052233935334,
  "data_cleaning": 2.560601569712162e-05,
  "neo4j_injection": 0.17584928695578128,
  "embedding_time": 0,
  "indexing_time": 0.0028311109635978937,
  "graph_injection_time": 0.1727639470482245,
  "acs_metrics": {
    "node_count": 491,
    "relationship_count": 1311,
    "density": 0.0054,
    "avg_degree": 5.3401,
    "avg_unique_neighbors": 5.2912,
    "global_efficiency": 0.2815,
    "avg_path_length": 2.6627,
    "avg_degree_centrality": 0.0109,
    "max_degree_centrality": 0.5143,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0442,
    "degree_assortativity": -0.215,
    "graph_robustness": 0.7918,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2834,
    "weakly_connected_components": 83,
    "largest_wcc_size": 409,
    "pagerank_top10_percent": 6.81,
    "louvain_communities": 96,
    "louvain_modularity": 0.43,
    "label_entropy": 1.4979,
    "computational_time": 0.4878066909732297
  },
  "retrieval_queries": []
}
2025-11-30 22:01:19,125 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:01:19,125 - src.pipeline.kg_builder - INFO - Batch 57 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.59s, Clean: 0.00s, Neo4j: 0.18s, ACS: 0.49s
2025-11-30 22:01:19,125 - src.pipeline.kg_builder - INFO - Batch 57 completed in 20.26s
Processing KG batches:  79%|███████▉  | 57/72 [21:00<04:45, 19.06s/it]2025-11-30 22:01:19,125 - src.pipeline.kg_builder - INFO - Processing batch 58/72 (3 items)
2025-11-30 22:01:19,125 - src.pipeline.kg_builder - DEBUG - Batch 58 current_video_time: 14:22-14:27
2025-11-30 22:01:19,135 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 491
- Total Relationships: 390
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:01:19,135 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 22:01:19,135 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0 ~238 words, content: Time: 14:12-14:17 Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a procedure on a black lab bench. The...
2025-11-30 22:01:19,135 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1 ~229 words, content: The laboratory environment is well-equipped, with various pieces of equipment and supplies visible in the background. The person's actions are methodical and precise, indicating a...
2025-11-30 22:01:19,135 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_2 ~235 words, content: yellow, multi-way manifold (a Schlenk line). This manifold is mounted on a metal stand and is used to control the flow of inert gas (like...
2025-11-30 22:01:19,135 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_3 ~94 words, content: to transfer liquid from the white container into a glass flask. The flask is being held by the person's hand, and the tube is being...
2025-11-30 22:01:19,136 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:01:19,136 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0) (~238 words) with timeout=5.0s retries=3
2025-11-30 22:01:20,407 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:01:20,407 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:01:20,407 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1) (~229 words) with timeout=5.0s retries=3
2025-11-30 22:01:21,874 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:01:21,874 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:01:21,875 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_2) (~235 words) with timeout=5.0s retries=3
2025-11-30 22:01:23,330 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:01:23,330 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:01:23,330 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_3) (~94 words) with timeout=5.0s retries=3
2025-11-30 22:01:24,437 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 22:01:24,437 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 22:01:24,437 - src.components.pre_llm_injector - INFO - Extracted 21 local triplets from 4 chunks
2025-11-30 22:01:24,437 - src.pipeline.kg_builder - INFO - Pre-extraction: 21 triplets in 5.30s
2025-11-30 22:01:24,437 - src.components.global_refiner - INFO - Capping refinement input: 21 → 15 triplets
2025-11-30 22:01:24,438 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 491
- Total Relationships: 390
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1"]}, {"head": "Person", "relation": "Handles", "tail": "Flexible_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0"]}, {"head": "Flexible_Tube", "relation": "Is Connected To", "tail": "Vacuum_System", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0"]}, {"head": "Flexible_Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0"]}, {"head": "Flask", "relation": "Is On", "tail": "Balance_Scale", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0"]}, {"head": "Person", "relation": "Holds", "tail": "Flexible_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_2"]}, {"head": "Flexible_Tube", "relation": "Connects To", "tail": "Schlenk_Line", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_2"]}, {"head": "Schlenk_Line", "relation": "Is Part Of", "tail": "Laboratory_Equipment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1"]}, {"head": "Laboratory_Environment", "relation": "Contains", "tail": "Lab_Bench", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1"]}, {"head": "Lab_Bench", "relation": "Holds", "tail": "Glass_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_2"]}, {"head": "Schlenk_Line", "relation": "Controls", "tail": "Inert_Gas", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_2"]}, {"head": "Glass_Flask", "relation": "Is Held By", "tail": "Clamp", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_2"]}, {"head": "Clamp", "relation": "Is Attached To", "tail": "Metal_Stand", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:01:24,438 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~248 words, ~322 tokens)
2025-11-30 22:01:24,438 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:01:38,239 - src.components.global_refiner - DEBUG - LLM call completed in 13.80s
2025-11-30 22:01:38,239 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1']], ['Person', 'handles', 'Flexible_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0']], ['Flexible_Tube', 'is_connected_to', 'Vacuum_System', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0']], ['Flexible_Tube', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0']], ['Flask', 'is_on', 'Balance_Scale', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0']], ['Person', 'holds', 'Flexible_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_2']], ['Flexible_Tube', 'connects_to', 'Schlenk_Line', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_2']], ['Schlenk_Line', 'is_part_of', 'Laboratory_Equipment', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1']], ['Laboratory_Environment', 'contains', 'Lab_Bench', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1']]]
2025-11-30 22:01:38,239 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1"
    ]
  ],
  [
    "Person",
    "handles",
    "Flexible_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0"
    ]
  ],
  [
    "Flexible_Tube",
    "is_connected_to",
    "Vacuum_System",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0"
    ]
  ],
  [
    "Flexible_Tube",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0"
    ]
  ],
  [
    "Flask",
    "is_on",
    "Balance_Scale",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Flexible_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_2"
    ]
  ],
  [
    "Flexible_Tube",
    "connects_to",
    "Schlenk_Line",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_2"
    ]
  ],
  [
    "Schlenk_Line",
    "is_part_of",
    "Laboratory_Equipment",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1"
    ]
  ],
  [
    "Laboratory_Environment",
    "contains",
    "Lab_Bench",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_57_1"
    ]
  ]
]
2025-11-30 22:01:38,239 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 13.80s, LLM: 13.80s)
2025-11-30 22:01:38,239 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 13.80s
2025-11-30 22:01:38,239 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:01:38,239 - src.pipeline.kg_builder - INFO - Pushing batch 58/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:01:38,239 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:01:38,408 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:01:38,408 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:01:38,409 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:01:38,409 - src.components.neo4j_handler - INFO - Batch injected in 0.17s (triplets: 0.16s, indexes: 0.01s)
2025-11-30 22:01:38,410 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 268, 'with_embedding': 0, 'linked_chunks': 185}
2025-11-30 22:01:38,410 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:01:38,478 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 498 nodes
2025-11-30 22:01:38,673 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 415 nodes
2025-11-30 22:01:38,896 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 498, 'relationship_count': 1336, 'density': 0.0054, 'avg_degree': 5.3655, 'avg_unique_neighbors': 5.3173, 'global_efficiency': 0.2818, 'avg_path_length': 2.662, 'avg_degree_centrality': 0.0108, 'max_degree_centrality': 0.5151, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0419, 'degree_assortativity': -0.2106, 'graph_robustness': 0.7927, 'diameter_estimate': 5, 'clustering_coefficient': 0.2823, 'weakly_connected_components': 84, 'largest_wcc_size': 415, 'pagerank_top10_percent': 6.72, 'louvain_communities': 97, 'louvain_modularity': 0.4241, 'label_entropy': 1.4979, 'computational_time': 0.4852939340053126}
2025-11-30 22:01:38,896 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 57, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511298.8964427, 'total_time': 19.771128123044036, 'aggregation': 2.6599736884236336e-06, 'network_info': 0.010058396961539984, 'llm_extraction': 19.10424400109332, 'data_cleaning': 1.9380939193069935e-05, 'neo4j_injection': 0.16949706908781081, 'embedding_time': 0, 'indexing_time': 0.005529019050300121, 'graph_injection_time': 0.1637474379967898, 'acs_metrics': {'node_count': 498, 'relationship_count': 1336, 'density': 0.0054, 'avg_degree': 5.3655, 'avg_unique_neighbors': 5.3173, 'global_efficiency': 0.2818, 'avg_path_length': 2.662, 'avg_degree_centrality': 0.0108, 'max_degree_centrality': 0.5151, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0419, 'degree_assortativity': -0.2106, 'graph_robustness': 0.7927, 'diameter_estimate': 5, 'clustering_coefficient': 0.2823, 'weakly_connected_components': 84, 'largest_wcc_size': 415, 'pagerank_top10_percent': 6.72, 'louvain_communities': 97, 'louvain_modularity': 0.4241, 'label_entropy': 1.4979, 'computational_time': 0.4852939340053126}, 'retrieval_queries': []}
2025-11-30 22:01:38,896 - src.pipeline.kg_builder - DEBUG - Batch 57 metrics: {
  "batch_idx": 57,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511298.8964427,
  "total_time": 19.771128123044036,
  "aggregation": 2.6599736884236336e-06,
  "network_info": 0.010058396961539984,
  "llm_extraction": 19.10424400109332,
  "data_cleaning": 1.9380939193069935e-05,
  "neo4j_injection": 0.16949706908781081,
  "embedding_time": 0,
  "indexing_time": 0.005529019050300121,
  "graph_injection_time": 0.1637474379967898,
  "acs_metrics": {
    "node_count": 498,
    "relationship_count": 1336,
    "density": 0.0054,
    "avg_degree": 5.3655,
    "avg_unique_neighbors": 5.3173,
    "global_efficiency": 0.2818,
    "avg_path_length": 2.662,
    "avg_degree_centrality": 0.0108,
    "max_degree_centrality": 0.5151,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0419,
    "degree_assortativity": -0.2106,
    "graph_robustness": 0.7927,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2823,
    "weakly_connected_components": 84,
    "largest_wcc_size": 415,
    "pagerank_top10_percent": 6.72,
    "louvain_communities": 97,
    "louvain_modularity": 0.4241,
    "label_entropy": 1.4979,
    "computational_time": 0.4852939340053126
  },
  "retrieval_queries": []
}
2025-11-30 22:01:38,897 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:01:38,897 - src.pipeline.kg_builder - INFO - Batch 58 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.10s, Clean: 0.00s, Neo4j: 0.17s, ACS: 0.49s
2025-11-30 22:01:38,897 - src.pipeline.kg_builder - INFO - Batch 58 completed in 19.77s
Processing KG batches:  81%|████████  | 58/72 [21:20<04:29, 19.28s/it]2025-11-30 22:01:38,897 - src.pipeline.kg_builder - INFO - Processing batch 59/72 (3 items)
2025-11-30 22:01:38,897 - src.pipeline.kg_builder - DEBUG - Batch 59 current_video_time: 14:37-14:42
2025-11-30 22:01:38,909 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 498
- Total Relationships: 398
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:01:38,910 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 22:01:38,910 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0 ~223 words, content: Time: 14:27-14:32 Content: The video shows a person conducting a laboratory procedure, likely a rinsing or washing step, from a first-person perspective. The scene is...
2025-11-30 22:01:38,910 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1 ~222 words, content: methodical and controlled process, such as preparing a solution or cleaning glassware. Time: 14:32-14:37 Content: The video begins with a close-up view of a laboratory...
2025-11-30 22:01:38,910 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_2 ~145 words, content: on a black laboratory bench. On the bench, a complex experimental setup is in progress. A long, flexible, translucent tube is connected to a yellow...
2025-11-30 22:01:38,910 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:01:38,910 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0) (~223 words) with timeout=5.0s retries=3
2025-11-30 22:01:40,539 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:01:40,539 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:01:40,540 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1) (~222 words) with timeout=5.0s retries=3
2025-11-30 22:01:41,691 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:01:41,691 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:01:41,692 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_2) (~145 words) with timeout=5.0s retries=3
2025-11-30 22:01:42,891 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:01:42,891 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:01:42,892 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 3 chunks
2025-11-30 22:01:42,892 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 3.98s
2025-11-30 22:01:42,892 - src.components.global_refiner - INFO - Capping refinement input: 17 → 15 triplets
2025-11-30 22:01:42,892 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 498
- Total Relationships: 398
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0"]}, {"head": "Translucent_Tube", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0"]}, {"head": "Clear_Liquid", "relation": "Flows Into", "tail": "White_Plastic_Measuring_Jug", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0"]}, {"head": "White_Plastic_Measuring_Jug", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0"]}, {"head": "Person", "relation": "Controls", "tail": "Flow_Of_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0"]}, {"head": "Plastic Tube", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1"]}, {"head": "Laboratory Bench", "relation": "Contains", "tail": "Measuring Cup", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1"]}, {"head": "Man", "relation": "Stands In", "tail": "Laboratory", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1"]}, {"head": "Man", "relation": "Wears", "tail": "Turtleneck Sweater", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1"]}, {"head": "Man", "relation": "Wears", "tail": "Jeans", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1"]}, {"head": "Laboratory Bench", "relation": "Contains", "tail": "Experimental Setup", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_2"]}, {"head": "Experimental Setup", "relation": "Includes", "tail": "Magnetic Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_2"]}, {"head": "Experimental Setup", "relation": "Includes", "tail": "Glass Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_2"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Heating Plate", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:01:42,892 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~251 words, ~326 tokens)
2025-11-30 22:01:42,892 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:01:54,546 - src.components.global_refiner - DEBUG - LLM call completed in 11.65s
2025-11-30 22:01:54,546 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0']], ['Person', 'holds', 'Translucent_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0']], ['Translucent_Tube', 'transfers', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0']], ['Clear_Liquid', 'flows_into', 'White_Plastic_Measuring_Jug', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0']], ['White_Plastic_Measuring_Jug', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0']], ['Person', 'controls', 'Flow_Of_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0']], ['Plastic_Tube', 'dispenses', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1']], ['Laboratory_Bench', 'contains', 'Measuring_Cup', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1']], ['Person', 'stands_in', 'Laboratory', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1']], ['Person', 'wears', 'Turtleneck_Sweater', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1']]]
2025-11-30 22:01:54,546 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Translucent_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0"
    ]
  ],
  [
    "Translucent_Tube",
    "transfers",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0"
    ]
  ],
  [
    "Clear_Liquid",
    "flows_into",
    "White_Plastic_Measuring_Jug",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0"
    ]
  ],
  [
    "White_Plastic_Measuring_Jug",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0"
    ]
  ],
  [
    "Person",
    "controls",
    "Flow_Of_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_0"
    ]
  ],
  [
    "Plastic_Tube",
    "dispenses",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Measuring_Cup",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1"
    ]
  ],
  [
    "Person",
    "stands_in",
    "Laboratory",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Turtleneck_Sweater",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_58_1"
    ]
  ]
]
2025-11-30 22:01:54,546 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.65s, LLM: 11.65s)
2025-11-30 22:01:54,546 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.65s
2025-11-30 22:01:54,546 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:01:54,546 - src.pipeline.kg_builder - INFO - Pushing batch 59/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:01:54,546 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:01:54,644 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:01:54,644 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:01:54,644 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:01:54,644 - src.components.neo4j_handler - INFO - Batch injected in 0.10s (triplets: 0.09s, indexes: 0.00s)
2025-11-30 22:01:54,645 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 271, 'with_embedding': 0, 'linked_chunks': 187}
2025-11-30 22:01:54,645 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:01:54,680 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 22:01:54,877 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 420 nodes
2025-11-30 22:01:54,902 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 504, 'relationship_count': 1354, 'density': 0.0053, 'avg_degree': 5.373, 'avg_unique_neighbors': 5.3214, 'global_efficiency': 0.2841, 'avg_path_length': 2.6608, 'avg_degree_centrality': 0.0107, 'max_degree_centrality': 0.5149, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.039, 'degree_assortativity': -0.2095, 'graph_robustness': 0.7903, 'diameter_estimate': 50, 'clustering_coefficient': 0.2815, 'weakly_connected_components': 85, 'largest_wcc_size': 420, 'pagerank_top10_percent': 6.57, 'louvain_communities': 98, 'louvain_modularity': 0.4241, 'label_entropy': 1.4979, 'computational_time': 0.2570746860001236}
2025-11-30 22:01:54,903 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 58, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511314.9031413, 'total_time': 16.00536468194332, 'aggregation': 2.3030443117022514e-06, 'network_info': 0.01191142899915576, 'llm_extraction': 15.63671854196582, 'data_cleaning': 1.041102223098278e-05, 'neo4j_injection': 0.09821206098422408, 'embedding_time': 0, 'indexing_time': 0.004198686103336513, 'graph_injection_time': 0.09386414499022067, 'acs_metrics': {'node_count': 504, 'relationship_count': 1354, 'density': 0.0053, 'avg_degree': 5.373, 'avg_unique_neighbors': 5.3214, 'global_efficiency': 0.2841, 'avg_path_length': 2.6608, 'avg_degree_centrality': 0.0107, 'max_degree_centrality': 0.5149, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.039, 'degree_assortativity': -0.2095, 'graph_robustness': 0.7903, 'diameter_estimate': 50, 'clustering_coefficient': 0.2815, 'weakly_connected_components': 85, 'largest_wcc_size': 420, 'pagerank_top10_percent': 6.57, 'louvain_communities': 98, 'louvain_modularity': 0.4241, 'label_entropy': 1.4979, 'computational_time': 0.2570746860001236}, 'retrieval_queries': []}
2025-11-30 22:01:54,903 - src.pipeline.kg_builder - DEBUG - Batch 58 metrics: {
  "batch_idx": 58,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511314.9031413,
  "total_time": 16.00536468194332,
  "aggregation": 2.3030443117022514e-06,
  "network_info": 0.01191142899915576,
  "llm_extraction": 15.63671854196582,
  "data_cleaning": 1.041102223098278e-05,
  "neo4j_injection": 0.09821206098422408,
  "embedding_time": 0,
  "indexing_time": 0.004198686103336513,
  "graph_injection_time": 0.09386414499022067,
  "acs_metrics": {
    "node_count": 504,
    "relationship_count": 1354,
    "density": 0.0053,
    "avg_degree": 5.373,
    "avg_unique_neighbors": 5.3214,
    "global_efficiency": 0.2841,
    "avg_path_length": 2.6608,
    "avg_degree_centrality": 0.0107,
    "max_degree_centrality": 0.5149,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.039,
    "degree_assortativity": -0.2095,
    "graph_robustness": 0.7903,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2815,
    "weakly_connected_components": 85,
    "largest_wcc_size": 420,
    "pagerank_top10_percent": 6.57,
    "louvain_communities": 98,
    "louvain_modularity": 0.4241,
    "label_entropy": 1.4979,
    "computational_time": 0.2570746860001236
  },
  "retrieval_queries": []
}
2025-11-30 22:01:54,904 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:01:54,904 - src.pipeline.kg_builder - INFO - Batch 59 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 15.64s, Clean: 0.00s, Neo4j: 0.10s, ACS: 0.26s
2025-11-30 22:01:54,904 - src.pipeline.kg_builder - INFO - Batch 59 completed in 16.01s
Processing KG batches:  82%|████████▏ | 59/72 [21:36<03:57, 18.30s/it]2025-11-30 22:01:54,904 - src.pipeline.kg_builder - INFO - Processing batch 60/72 (3 items)
2025-11-30 22:01:54,904 - src.pipeline.kg_builder - DEBUG - Batch 60 current_video_time: 14:52-14:57
2025-11-30 22:01:54,910 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 504
- Total Relationships: 403
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:01:54,911 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 22:01:54,911 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0 ~238 words, content: Time: 14:42-14:47 Content: The video shows a laboratory setting where a scientific procedure is in progress. The central focus is a long, flexible tube, which...
2025-11-30 22:01:54,911 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1 ~239 words, content: 52 Content: The video sequence captures a scientific experiment being conducted in a laboratory setting. The scene is set on a black laboratory bench, which...
2025-11-30 22:01:54,911 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_2 ~236 words, content: aker via the long tube. The liquid is being added slowly and steadily, indicating a controlled process. The entire setup is designed to ensure a...
2025-11-30 22:01:54,911 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_3 ~219 words, content: apparatus featuring a yellow, multi-armed clamp holding several tubes and a long, flexible tube. This entire assembly is mounted on a metal stand. The background...
2025-11-30 22:01:54,911 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_4 ~89 words, content: View (Frame 5):** The camera focuses on the end of the long, flexible tube, which is submerged in a white plastic beaker filled with a...
2025-11-30 22:01:54,911 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:01:54,911 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0) (~238 words) with timeout=5.0s retries=3
2025-11-30 22:01:56,159 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:01:56,159 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:01:56,159 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1) (~239 words) with timeout=5.0s retries=3
2025-11-30 22:01:57,359 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:01:57,359 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:01:57,359 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_2) (~236 words) with timeout=5.0s retries=3
2025-11-30 22:01:58,475 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:01:58,475 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:01:58,476 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_3) (~219 words) with timeout=5.0s retries=3
2025-11-30 22:01:59,540 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 22:01:59,541 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 22:01:59,541 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_4) (~89 words) with timeout=5.0s retries=3
2025-11-30 22:02:00,759 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 22:02:00,759 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 22:02:00,759 - src.components.pre_llm_injector - INFO - Extracted 29 local triplets from 5 chunks
2025-11-30 22:02:00,759 - src.pipeline.kg_builder - INFO - Pre-extraction: 29 triplets in 5.85s
2025-11-30 22:02:00,760 - src.components.global_refiner - INFO - Capping refinement input: 29 → 15 triplets
2025-11-30 22:02:00,760 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 504
- Total Relationships: 403
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Vacuum Filtration Setup", "relation": "Contains", "tail": "Flexible Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0"]}, {"head": "Flexible Tube", "relation": "Connects", "tail": "Blue Stand", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0"]}, {"head": "Flexible Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0"]}, {"head": "Liquid", "relation": "Flows Through", "tail": "Flexible Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0"]}, {"head": "Liquid", "relation": "Enters", "tail": "White Plastic Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0"]}, {"head": "White Plastic Beaker", "relation": "Rests On", "tail": "Laboratory Table", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0"]}, {"head": "Tube", "relation": "Connects", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1"]}, {"head": "Beaker", "relation": "Rests On", "tail": "Magnetic_Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1"]}, {"head": "Magnetic_Stirrer", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1"]}, {"head": "Tube", "relation": "Leads To", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1"]}, {"head": "Person", "relation": "Observes", "tail": "Experiment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_2"]}, {"head": "Flask", "relation": "Is Held By", "tail": "Clamp", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1"]}, {"head": "Flask", "relation": "Is Connected To", "tail": "Apparatus", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_2"]}, {"head": "Apparatus", "relation": "Contains", "tail": "Long Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_2"]}, {"head": "Liquid", "relation": "Is Added To", "tail": "Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:02:00,760 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~259 words, ~337 tokens)
2025-11-30 22:02:00,760 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:02:12,205 - src.components.global_refiner - DEBUG - LLM call completed in 11.44s
2025-11-30 22:02:12,205 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Vacuum_Filtration_Setup', 'contains', 'Flexible_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0']], ['Flexible_Tube', 'connects', 'Blue_Stand', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0']], ['Flexible_Tube', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0']], ['Liquid', 'flows_through', 'Flexible_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0']], ['Liquid', 'enters', 'White_Plastic_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0']], ['White_Plastic_Beaker', 'rests_on', 'Laboratory_Table', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0']], ['Tube', 'connects', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1']], ['Beaker', 'rests_on', 'Magnetic_Stirrer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1']], ['Magnetic_Stirrer', 'holds', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1']], ['Tube', 'leads_to', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1']]]
2025-11-30 22:02:12,206 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Vacuum_Filtration_Setup",
    "contains",
    "Flexible_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0"
    ]
  ],
  [
    "Flexible_Tube",
    "connects",
    "Blue_Stand",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0"
    ]
  ],
  [
    "Flexible_Tube",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0"
    ]
  ],
  [
    "Liquid",
    "flows_through",
    "Flexible_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0"
    ]
  ],
  [
    "Liquid",
    "enters",
    "White_Plastic_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0"
    ]
  ],
  [
    "White_Plastic_Beaker",
    "rests_on",
    "Laboratory_Table",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_0"
    ]
  ],
  [
    "Tube",
    "connects",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1"
    ]
  ],
  [
    "Beaker",
    "rests_on",
    "Magnetic_Stirrer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "holds",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1"
    ]
  ],
  [
    "Tube",
    "leads_to",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_59_1"
    ]
  ]
]
2025-11-30 22:02:12,206 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.45s, LLM: 11.44s)
2025-11-30 22:02:12,206 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.45s
2025-11-30 22:02:12,206 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:02:12,206 - src.pipeline.kg_builder - INFO - Pushing batch 60/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:02:12,206 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:02:12,322 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:02:12,322 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:02:12,323 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:02:12,323 - src.components.neo4j_handler - INFO - Batch injected in 0.12s (triplets: 0.11s, indexes: 0.00s)
2025-11-30 22:02:12,324 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 276, 'with_embedding': 0, 'linked_chunks': 189}
2025-11-30 22:02:12,324 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:02:12,357 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 22:02:12,568 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 425 nodes
2025-11-30 22:02:12,595 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 512, 'relationship_count': 1369, 'density': 0.0052, 'avg_degree': 5.3477, 'avg_unique_neighbors': 5.293, 'global_efficiency': 0.2734, 'avg_path_length': 2.6693, 'avg_degree_centrality': 0.0105, 'max_degree_centrality': 0.5068, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0421, 'degree_assortativity': -0.2066, 'graph_robustness': 0.8532, 'diameter_estimate': 50, 'clustering_coefficient': 0.2805, 'weakly_connected_components': 88, 'largest_wcc_size': 425, 'pagerank_top10_percent': 6.46, 'louvain_communities': 100, 'louvain_modularity': 0.4249, 'label_entropy': 1.4978, 'computational_time': 0.2715023249620572}
2025-11-30 22:02:12,595 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 59, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511332.5958092, 'total_time': 17.691344734979793, 'aggregation': 2.3349421098828316e-06, 'network_info': 0.006244251970201731, 'llm_extraction': 17.29549488297198, 'data_cleaning': 2.6126042939722538e-05, 'neo4j_injection': 0.11666990397498012, 'embedding_time': 0, 'indexing_time': 0.002868343028239906, 'graph_injection_time': 0.11354992701672018, 'acs_metrics': {'node_count': 512, 'relationship_count': 1369, 'density': 0.0052, 'avg_degree': 5.3477, 'avg_unique_neighbors': 5.293, 'global_efficiency': 0.2734, 'avg_path_length': 2.6693, 'avg_degree_centrality': 0.0105, 'max_degree_centrality': 0.5068, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0421, 'degree_assortativity': -0.2066, 'graph_robustness': 0.8532, 'diameter_estimate': 50, 'clustering_coefficient': 0.2805, 'weakly_connected_components': 88, 'largest_wcc_size': 425, 'pagerank_top10_percent': 6.46, 'louvain_communities': 100, 'louvain_modularity': 0.4249, 'label_entropy': 1.4978, 'computational_time': 0.2715023249620572}, 'retrieval_queries': []}
2025-11-30 22:02:12,595 - src.pipeline.kg_builder - DEBUG - Batch 59 metrics: {
  "batch_idx": 59,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511332.5958092,
  "total_time": 17.691344734979793,
  "aggregation": 2.3349421098828316e-06,
  "network_info": 0.006244251970201731,
  "llm_extraction": 17.29549488297198,
  "data_cleaning": 2.6126042939722538e-05,
  "neo4j_injection": 0.11666990397498012,
  "embedding_time": 0,
  "indexing_time": 0.002868343028239906,
  "graph_injection_time": 0.11354992701672018,
  "acs_metrics": {
    "node_count": 512,
    "relationship_count": 1369,
    "density": 0.0052,
    "avg_degree": 5.3477,
    "avg_unique_neighbors": 5.293,
    "global_efficiency": 0.2734,
    "avg_path_length": 2.6693,
    "avg_degree_centrality": 0.0105,
    "max_degree_centrality": 0.5068,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0421,
    "degree_assortativity": -0.2066,
    "graph_robustness": 0.8532,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2805,
    "weakly_connected_components": 88,
    "largest_wcc_size": 425,
    "pagerank_top10_percent": 6.46,
    "louvain_communities": 100,
    "louvain_modularity": 0.4249,
    "label_entropy": 1.4978,
    "computational_time": 0.2715023249620572
  },
  "retrieval_queries": []
}
2025-11-30 22:02:12,597 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:02:12,597 - src.pipeline.kg_builder - INFO - Batch 60 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 17.30s, Clean: 0.00s, Neo4j: 0.12s, ACS: 0.27s
2025-11-30 22:02:12,597 - src.pipeline.kg_builder - INFO - Batch 60 completed in 17.69s
Processing KG batches:  83%|████████▎ | 60/72 [21:54<03:37, 18.11s/it]2025-11-30 22:02:12,597 - src.pipeline.kg_builder - INFO - Processing batch 61/72 (3 items)
2025-11-30 22:02:12,597 - src.pipeline.kg_builder - DEBUG - Batch 61 current_video_time: 15:07-15:12
2025-11-30 22:02:12,603 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 512
- Total Relationships: 411
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:02:12,604 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 22:02:12,604 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0 ~232 words, content: Time: 14:57-15:02 Content: The video sequence captures a scientific procedure, likely a chemical experiment or a sample preparation process, taking place in a laboratory setting....
2025-11-30 22:02:12,604 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_1 ~235 words, content: . - **Frame 4:** The person continues to handle the tube, ensuring it is properly aligned. The liquid is being transferred from the beaker into...
2025-11-30 22:02:12,604 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_2 ~234 words, content: or transferring a solution. - **Frame 2:** The person adjusts the tube, which is now forming a large loop. The apparatus is positioned on a...
2025-11-30 22:02:12,604 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_3 ~108 words, content: flexible, transparent tube, which appears to be a pipette or a transfer tube. The person is carefully manipulating the tube, ensuring it is properly positioned...
2025-11-30 22:02:12,604 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:02:12,604 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0) (~232 words) with timeout=5.0s retries=3
2025-11-30 22:02:13,886 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:02:13,886 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:02:13,886 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_1) (~235 words) with timeout=5.0s retries=3
2025-11-30 22:02:15,522 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:02:15,522 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:02:15,523 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_2) (~234 words) with timeout=5.0s retries=3
2025-11-30 22:02:16,606 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:02:16,606 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:02:16,607 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_3) (~108 words) with timeout=5.0s retries=3
2025-11-30 22:02:17,537 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 22:02:17,537 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 22:02:17,537 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 4 chunks
2025-11-30 22:02:17,537 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 4.93s
2025-11-30 22:02:17,537 - src.components.global_refiner - INFO - Capping refinement input: 22 → 15 triplets
2025-11-30 22:02:17,538 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 512
- Total Relationships: 411
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_1"]}, {"head": "Person", "relation": "Holds", "tail": "Transparent_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0"]}, {"head": "Transparent_Tube", "relation": "Connects", "tail": "Glass_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0"]}, {"head": "Transparent_Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0"]}, {"head": "Liquid", "relation": "Flows Into", "tail": "White_Plastic_Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0"]}, {"head": "Person", "relation": "Adjusts", "tail": "Transparent_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0"]}, {"head": "Person", "relation": "Holds", "tail": "Flexible_White_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_1"]}, {"head": "Flexible_White_Tube", "relation": "Connects", "tail": "Yellow_And_Blue_Manifold", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_1"]}, {"head": "Yellow_And_Blue_Manifold", "relation": "Mounted On", "tail": "Metal_Stand", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_1"]}, {"head": "Flexible_White_Tube", "relation": "Submerged In", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_1"]}, {"head": "Clear_Liquid", "relation": "Contained In", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_2"]}, {"head": "Person", "relation": "Holds", "tail": "Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_2"]}, {"head": "Tube", "relation": "Is Connected To", "tail": "Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_2"]}, {"head": "Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:02:17,538 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~245 words, ~318 tokens)
2025-11-30 22:02:17,538 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:02:29,710 - src.components.global_refiner - DEBUG - LLM call completed in 12.17s
2025-11-30 22:02:29,710 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_2']], ['Person', 'holds', 'Transparent_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0']], ['Person', 'holds', 'Flexible_White_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_1']], ['Person', 'holds', 'Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_2']], ['Person', 'adjusts', 'Transparent_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0']], ['Transparent_Tube', 'connects', 'Glass_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0']], ['Transparent_Tube', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0']], ['Liquid', 'flows_into', 'White_Plastic_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0']], ['Flexible_White_Tube', 'connects', 'Yellow_And_Blue_Manifold', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_1']], ['Yellow_And_Blue_Manifold', 'mounted_on', 'Metal_Stand', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_1']]]
2025-11-30 22:02:29,710 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Transparent_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Flexible_White_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_2"
    ]
  ],
  [
    "Person",
    "adjusts",
    "Transparent_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0"
    ]
  ],
  [
    "Transparent_Tube",
    "connects",
    "Glass_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0"
    ]
  ],
  [
    "Transparent_Tube",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0"
    ]
  ],
  [
    "Liquid",
    "flows_into",
    "White_Plastic_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_0"
    ]
  ],
  [
    "Flexible_White_Tube",
    "connects",
    "Yellow_And_Blue_Manifold",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_1"
    ]
  ],
  [
    "Yellow_And_Blue_Manifold",
    "mounted_on",
    "Metal_Stand",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_60_1"
    ]
  ]
]
2025-11-30 22:02:29,710 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 12.17s, LLM: 12.17s)
2025-11-30 22:02:29,710 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 12.17s
2025-11-30 22:02:29,710 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:02:29,710 - src.pipeline.kg_builder - INFO - Pushing batch 61/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:02:29,710 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:02:29,846 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:02:29,846 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:02:29,847 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:02:29,847 - src.components.neo4j_handler - INFO - Batch injected in 0.14s (triplets: 0.13s, indexes: 0.00s)
2025-11-30 22:02:29,848 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 280, 'with_embedding': 0, 'linked_chunks': 192}
2025-11-30 22:02:29,848 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:02:29,946 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 22:02:30,162 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 432 nodes
2025-11-30 22:02:30,189 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 520, 'relationship_count': 1389, 'density': 0.0051, 'avg_degree': 5.3423, 'avg_unique_neighbors': 5.2885, 'global_efficiency': 0.2748, 'avg_path_length': 2.667, 'avg_degree_centrality': 0.0103, 'max_degree_centrality': 0.5087, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0289, 'degree_assortativity': -0.2066, 'graph_robustness': 0.8524, 'diameter_estimate': 50, 'clustering_coefficient': 0.2807, 'weakly_connected_components': 89, 'largest_wcc_size': 432, 'pagerank_top10_percent': 6.36, 'louvain_communities': 103, 'louvain_modularity': 0.4212, 'label_entropy': 1.4979, 'computational_time': 0.3412158109713346}
2025-11-30 22:02:30,189 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 60, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511350.1899006, 'total_time': 17.592706271912903, 'aggregation': 2.88989394903183e-06, 'network_info': 0.006447499035857618, 'llm_extraction': 17.10683223500382, 'data_cleaning': 1.9481987692415714e-05, 'neo4j_injection': 0.1364235549699515, 'embedding_time': 0, 'indexing_time': 0.0037390959914773703, 'graph_injection_time': 0.13247041800059378, 'acs_metrics': {'node_count': 520, 'relationship_count': 1389, 'density': 0.0051, 'avg_degree': 5.3423, 'avg_unique_neighbors': 5.2885, 'global_efficiency': 0.2748, 'avg_path_length': 2.667, 'avg_degree_centrality': 0.0103, 'max_degree_centrality': 0.5087, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0289, 'degree_assortativity': -0.2066, 'graph_robustness': 0.8524, 'diameter_estimate': 50, 'clustering_coefficient': 0.2807, 'weakly_connected_components': 89, 'largest_wcc_size': 432, 'pagerank_top10_percent': 6.36, 'louvain_communities': 103, 'louvain_modularity': 0.4212, 'label_entropy': 1.4979, 'computational_time': 0.3412158109713346}, 'retrieval_queries': []}
2025-11-30 22:02:30,189 - src.pipeline.kg_builder - DEBUG - Batch 60 metrics: {
  "batch_idx": 60,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511350.1899006,
  "total_time": 17.592706271912903,
  "aggregation": 2.88989394903183e-06,
  "network_info": 0.006447499035857618,
  "llm_extraction": 17.10683223500382,
  "data_cleaning": 1.9481987692415714e-05,
  "neo4j_injection": 0.1364235549699515,
  "embedding_time": 0,
  "indexing_time": 0.0037390959914773703,
  "graph_injection_time": 0.13247041800059378,
  "acs_metrics": {
    "node_count": 520,
    "relationship_count": 1389,
    "density": 0.0051,
    "avg_degree": 5.3423,
    "avg_unique_neighbors": 5.2885,
    "global_efficiency": 0.2748,
    "avg_path_length": 2.667,
    "avg_degree_centrality": 0.0103,
    "max_degree_centrality": 0.5087,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0289,
    "degree_assortativity": -0.2066,
    "graph_robustness": 0.8524,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2807,
    "weakly_connected_components": 89,
    "largest_wcc_size": 432,
    "pagerank_top10_percent": 6.36,
    "louvain_communities": 103,
    "louvain_modularity": 0.4212,
    "label_entropy": 1.4979,
    "computational_time": 0.3412158109713346
  },
  "retrieval_queries": []
}
2025-11-30 22:02:30,191 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:02:30,191 - src.pipeline.kg_builder - INFO - Batch 61 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 17.11s, Clean: 0.00s, Neo4j: 0.14s, ACS: 0.34s
2025-11-30 22:02:30,191 - src.pipeline.kg_builder - INFO - Batch 61 completed in 17.59s
Processing KG batches:  85%|████████▍ | 61/72 [22:11<03:17, 17.96s/it]2025-11-30 22:02:30,191 - src.pipeline.kg_builder - INFO - Processing batch 62/72 (3 items)
2025-11-30 22:02:30,191 - src.pipeline.kg_builder - DEBUG - Batch 62 current_video_time: 15:22-15:27
2025-11-30 22:02:30,202 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 520
- Total Relationships: 419
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:02:30,202 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 22:02:30,202 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0 ~217 words, content: Time: 15:12-15:17 Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a procedure on a black lab bench. The...
2025-11-30 22:02:30,202 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1 ~232 words, content: . Time: 15:17-15:22 Content: The video sequence captures a scientific procedure, likely a chemical experiment, taking place on a laboratory bench. The frames show a...
2025-11-30 22:02:30,202 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_2 ~239 words, content: pieces of equipment and glassware in the background. In summary, the video shows a chemical reaction that produces a gas. The gas is being collected...
2025-11-30 22:02:30,202 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_3 ~33 words, content: different perspectives of the experiment. In the final frame, a person with dark, curly hair is seen sitting at the bench, observing the experiment. The...
2025-11-30 22:02:30,202 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:02:30,202 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0) (~217 words) with timeout=5.0s retries=3
2025-11-30 22:02:31,863 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:02:31,863 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:02:31,863 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1) (~232 words) with timeout=5.0s retries=3
2025-11-30 22:02:32,986 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:02:32,986 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:02:32,987 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_2) (~239 words) with timeout=5.0s retries=3
2025-11-30 22:02:34,071 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:02:34,071 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:02:34,071 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_3) (~33 words) with timeout=5.0s retries=3
2025-11-30 22:02:35,058 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 22:02:35,059 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 22:02:35,059 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-30 22:02:35,059 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 4.86s
2025-11-30 22:02:35,059 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 22:02:35,060 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 520
- Total Relationships: 419
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0"]}, {"head": "Translucent_Tube", "relation": "Is Inserted Into", "tail": "Clear_Plastic_Measuring_Cup", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0"]}, {"head": "Clear_Plastic_Measuring_Cup", "relation": "Contains", "tail": "Transparent_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0"]}, {"head": "Person", "relation": "Uses", "tail": "Blue_Rectangular_Device", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0"]}, {"head": "Blue_Rectangular_Device", "relation": "Is On", "tail": "Lab_Bench", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0"]}, {"head": "Plastic Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1"]}, {"head": "Tube", "relation": "Delivers", "tail": "Substance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1"]}, {"head": "Inverted Beaker", "relation": "Collects", "tail": "Gas", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1"]}, {"head": "Tube", "relation": "Connects", "tail": "Plastic Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1"]}, {"head": "Plastic Container", "relation": "Is Part Of", "tail": "Experiment Setup", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1"]}, {"head": "Experiment Setup", "relation": "Is On", "tail": "Laboratory Bench", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1"]}, {"head": "Flask", "relation": "Is Heated On", "tail": "Magnetic Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_2"]}, {"head": "Tube", "relation": "Connects", "tail": "Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_2"]}, {"head": "Tube", "relation": "Delivers Gas To", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:02:35,060 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~253 words, ~329 tokens)
2025-11-30 22:02:35,060 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:02:46,720 - src.components.global_refiner - DEBUG - LLM call completed in 11.66s
2025-11-30 22:02:46,720 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0']], ['Person', 'holds', 'Translucent_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0']], ['Translucent_Tube', 'is_inserted_into', 'Clear_Plastic_Measuring_Cup', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0']], ['Clear_Plastic_Measuring_Cup', 'contains', 'Transparent_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0']], ['Person', 'uses', 'Blue_Rectangular_Device', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0']], ['Blue_Rectangular_Device', 'is_on', 'Lab_Bench', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0']], ['Plastic_Container', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1']], ['Tube', 'delivers', 'Substance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1']], ['Inverted_Beaker', 'collects', 'Gas', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1']], ['Tube', 'connects', 'Plastic_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1']]]
2025-11-30 22:02:46,720 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Translucent_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0"
    ]
  ],
  [
    "Translucent_Tube",
    "is_inserted_into",
    "Clear_Plastic_Measuring_Cup",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0"
    ]
  ],
  [
    "Clear_Plastic_Measuring_Cup",
    "contains",
    "Transparent_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Blue_Rectangular_Device",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0"
    ]
  ],
  [
    "Blue_Rectangular_Device",
    "is_on",
    "Lab_Bench",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_0"
    ]
  ],
  [
    "Plastic_Container",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1"
    ]
  ],
  [
    "Tube",
    "delivers",
    "Substance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1"
    ]
  ],
  [
    "Inverted_Beaker",
    "collects",
    "Gas",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1"
    ]
  ],
  [
    "Tube",
    "connects",
    "Plastic_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_61_1"
    ]
  ]
]
2025-11-30 22:02:46,720 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.66s, LLM: 11.66s)
2025-11-30 22:02:46,720 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.66s
2025-11-30 22:02:46,720 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:02:46,720 - src.pipeline.kg_builder - INFO - Pushing batch 62/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:02:46,720 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:02:46,831 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:02:46,831 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:02:46,832 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:02:46,832 - src.components.neo4j_handler - INFO - Batch injected in 0.11s (triplets: 0.11s, indexes: 0.00s)
2025-11-30 22:02:46,833 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 284, 'with_embedding': 0, 'linked_chunks': 194}
2025-11-30 22:02:46,833 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:02:46,884 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 22:02:47,112 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 440 nodes
2025-11-30 22:02:47,140 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 530, 'relationship_count': 1408, 'density': 0.005, 'avg_degree': 5.3132, 'avg_unique_neighbors': 5.2604, 'global_efficiency': 0.2725, 'avg_path_length': 2.6849, 'avg_degree_centrality': 0.01, 'max_degree_centrality': 0.5028, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0363, 'degree_assortativity': -0.2044, 'graph_robustness': 0.8544, 'diameter_estimate': 50, 'clustering_coefficient': 0.2809, 'weakly_connected_components': 91, 'largest_wcc_size': 440, 'pagerank_top10_percent': 6.22, 'louvain_communities': 103, 'louvain_modularity': 0.43, 'label_entropy': 1.4981, 'computational_time': 0.30737588892225176}
2025-11-30 22:02:47,141 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 61, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511367.141006, 'total_time': 16.94959666300565, 'aggregation': 2.125045284628868e-06, 'network_info': 0.010637111961841583, 'llm_extraction': 16.518465533968993, 'data_cleaning': 2.8446083888411522e-05, 'neo4j_injection': 0.11139428801834583, 'embedding_time': 0, 'indexing_time': 0.0025619849329814315, 'graph_injection_time': 0.10860939091071486, 'acs_metrics': {'node_count': 530, 'relationship_count': 1408, 'density': 0.005, 'avg_degree': 5.3132, 'avg_unique_neighbors': 5.2604, 'global_efficiency': 0.2725, 'avg_path_length': 2.6849, 'avg_degree_centrality': 0.01, 'max_degree_centrality': 0.5028, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0363, 'degree_assortativity': -0.2044, 'graph_robustness': 0.8544, 'diameter_estimate': 50, 'clustering_coefficient': 0.2809, 'weakly_connected_components': 91, 'largest_wcc_size': 440, 'pagerank_top10_percent': 6.22, 'louvain_communities': 103, 'louvain_modularity': 0.43, 'label_entropy': 1.4981, 'computational_time': 0.30737588892225176}, 'retrieval_queries': []}
2025-11-30 22:02:47,141 - src.pipeline.kg_builder - DEBUG - Batch 61 metrics: {
  "batch_idx": 61,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511367.141006,
  "total_time": 16.94959666300565,
  "aggregation": 2.125045284628868e-06,
  "network_info": 0.010637111961841583,
  "llm_extraction": 16.518465533968993,
  "data_cleaning": 2.8446083888411522e-05,
  "neo4j_injection": 0.11139428801834583,
  "embedding_time": 0,
  "indexing_time": 0.0025619849329814315,
  "graph_injection_time": 0.10860939091071486,
  "acs_metrics": {
    "node_count": 530,
    "relationship_count": 1408,
    "density": 0.005,
    "avg_degree": 5.3132,
    "avg_unique_neighbors": 5.2604,
    "global_efficiency": 0.2725,
    "avg_path_length": 2.6849,
    "avg_degree_centrality": 0.01,
    "max_degree_centrality": 0.5028,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0363,
    "degree_assortativity": -0.2044,
    "graph_robustness": 0.8544,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2809,
    "weakly_connected_components": 91,
    "largest_wcc_size": 440,
    "pagerank_top10_percent": 6.22,
    "louvain_communities": 103,
    "louvain_modularity": 0.43,
    "label_entropy": 1.4981,
    "computational_time": 0.30737588892225176
  },
  "retrieval_queries": []
}
2025-11-30 22:02:47,142 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:02:47,142 - src.pipeline.kg_builder - INFO - Batch 62 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 16.52s, Clean: 0.00s, Neo4j: 0.11s, ACS: 0.31s
2025-11-30 22:02:47,142 - src.pipeline.kg_builder - INFO - Batch 62 completed in 16.95s
Processing KG batches:  86%|████████▌ | 62/72 [22:28<02:56, 17.66s/it]2025-11-30 22:02:47,142 - src.pipeline.kg_builder - INFO - Processing batch 63/72 (3 items)
2025-11-30 22:02:47,142 - src.pipeline.kg_builder - DEBUG - Batch 63 current_video_time: 15:37-15:42
2025-11-30 22:02:47,155 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 530
- Total Relationships: 426
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:02:47,155 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 22:02:47,155 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0 ~225 words, content: Time: 15:27-15:32 Content: The video sequence captures a scientific experiment being conducted in a laboratory setting. The scene is set in a well-equipped lab with...
2025-11-30 22:02:47,155 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1 ~231 words, content: , showing the entire experimental setup. The person is still present, observing the experiment. The lab environment remains consistent, with the focus on the ongoing...
2025-11-30 22:02:47,155 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_2 ~220 words, content: Frame (4):** The camera then shifts to include a person in the frame. A man with long, dark, curly hair, wearing a light-colored sweater and...
2025-11-30 22:02:47,155 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_3 ~144 words, content: smile directed at the camera, suggesting a moment of happiness or satisfaction. - **Fourth Frame:** The person turns their head to their right, away from...
2025-11-30 22:02:47,155 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:02:47,156 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0) (~225 words) with timeout=5.0s retries=3
2025-11-30 22:02:48,437 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:02:48,437 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:02:48,437 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1) (~231 words) with timeout=5.0s retries=3
2025-11-30 22:02:49,749 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:02:49,749 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:02:49,749 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_2) (~220 words) with timeout=5.0s retries=3
2025-11-30 22:02:50,723 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:02:50,723 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:02:50,724 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_3) (~144 words) with timeout=5.0s retries=3
2025-11-30 22:02:51,919 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 22:02:51,919 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 22:02:51,919 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-30 22:02:51,919 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 4.76s
2025-11-30 22:02:51,920 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 22:02:51,920 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 530
- Total Relationships: 426
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Sits At", "tail": "Lab Bench", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0"]}, {"head": "Lab Bench", "relation": "Holds", "tail": "Glass Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0"]}, {"head": "Magnetic Stirrer", "relation": "Mixes", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0"]}, {"head": "Glass Flask", "relation": "Connected To", "tail": "Flexible Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0"]}, {"head": "Flexible Tube", "relation": "Part Of", "tail": "Vacuum Filtration Setup", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0"]}, {"head": "Scientist", "relation": "Conducts", "tail": "Experiment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1"]}, {"head": "Experiment", "relation": "Involves", "tail": "Vacuum Filtration Setup", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1"]}, {"head": "Vacuum Filtration Setup", "relation": "Includes", "tail": "Glass Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1"]}, {"head": "Vacuum Filtration Setup", "relation": "Includes", "tail": "Magnetic Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1"]}, {"head": "Scientist", "relation": "Observes", "tail": "Experiment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "Glass Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1"]}, {"head": "Person", "relation": "Wears", "tail": "Sweater", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_2"]}, {"head": "Person", "relation": "Wears", "tail": "Jeans", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_2"]}, {"head": "Person", "relation": "Sits On", "tail": "Floor", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:02:51,920 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~261 words, ~339 tokens)
2025-11-30 22:02:51,920 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:03:03,684 - src.components.global_refiner - DEBUG - LLM call completed in 11.76s
2025-11-30 22:03:03,684 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'sits_at', 'Lab_Bench', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0']], ['Lab_Bench', 'holds', 'Glass_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0']], ['Glass_Flask', 'is_on', 'Magnetic_Stirrer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0']], ['Magnetic_Stirrer', 'mixes', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0']], ['Glass_Flask', 'connected_to', 'Flexible_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0']], ['Flexible_Tube', 'part_of', 'Vacuum_Filtration_Setup', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0']], ['Scientist', 'conducts', 'Experiment', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1']], ['Experiment', 'involves', 'Vacuum_Filtration_Setup', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1']], ['Vacuum_Filtration_Setup', 'includes', 'Glass_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1']], ['Vacuum_Filtration_Setup', 'includes', 'Magnetic_Stirrer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1']]]
2025-11-30 22:03:03,684 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "sits_at",
    "Lab_Bench",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0"
    ]
  ],
  [
    "Lab_Bench",
    "holds",
    "Glass_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0"
    ]
  ],
  [
    "Glass_Flask",
    "is_on",
    "Magnetic_Stirrer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "mixes",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0"
    ]
  ],
  [
    "Glass_Flask",
    "connected_to",
    "Flexible_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0"
    ]
  ],
  [
    "Flexible_Tube",
    "part_of",
    "Vacuum_Filtration_Setup",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_0"
    ]
  ],
  [
    "Scientist",
    "conducts",
    "Experiment",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1"
    ]
  ],
  [
    "Experiment",
    "involves",
    "Vacuum_Filtration_Setup",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1"
    ]
  ],
  [
    "Vacuum_Filtration_Setup",
    "includes",
    "Glass_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1"
    ]
  ],
  [
    "Vacuum_Filtration_Setup",
    "includes",
    "Magnetic_Stirrer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_62_1"
    ]
  ]
]
2025-11-30 22:03:03,684 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.76s, LLM: 11.76s)
2025-11-30 22:03:03,684 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.76s
2025-11-30 22:03:03,684 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:03:03,684 - src.pipeline.kg_builder - INFO - Pushing batch 63/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:03:03,684 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:03:03,817 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:03:03,817 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:03:03,817 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:03:03,817 - src.components.neo4j_handler - INFO - Batch injected in 0.13s (triplets: 0.13s, indexes: 0.01s)
2025-11-30 22:03:03,819 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 288, 'with_embedding': 0, 'linked_chunks': 196}
2025-11-30 22:03:03,819 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:03:03,854 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 22:03:04,079 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 443 nodes
2025-11-30 22:03:04,107 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 535, 'relationship_count': 1427, 'density': 0.005, 'avg_degree': 5.3346, 'avg_unique_neighbors': 5.2785, 'global_efficiency': 0.2718, 'avg_path_length': 2.6861, 'avg_degree_centrality': 0.01, 'max_degree_centrality': 0.5019, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0388, 'degree_assortativity': -0.2007, 'graph_robustness': 0.8535, 'diameter_estimate': 50, 'clustering_coefficient': 0.2811, 'weakly_connected_components': 93, 'largest_wcc_size': 443, 'pagerank_top10_percent': 6.18, 'louvain_communities': 105, 'louvain_modularity': 0.4294, 'label_entropy': 1.4979, 'computational_time': 0.2886275459313765}
2025-11-30 22:03:04,108 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 62, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511384.108018, 'total_time': 16.965592370950617, 'aggregation': 2.9070070013403893e-06, 'network_info': 0.012677447055466473, 'llm_extraction': 16.52930080203805, 'data_cleaning': 2.126605249941349e-05, 'neo4j_injection': 0.1330090630799532, 'embedding_time': 0, 'indexing_time': 0.006422571954317391, 'graph_injection_time': 0.12635619495995343, 'acs_metrics': {'node_count': 535, 'relationship_count': 1427, 'density': 0.005, 'avg_degree': 5.3346, 'avg_unique_neighbors': 5.2785, 'global_efficiency': 0.2718, 'avg_path_length': 2.6861, 'avg_degree_centrality': 0.01, 'max_degree_centrality': 0.5019, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0388, 'degree_assortativity': -0.2007, 'graph_robustness': 0.8535, 'diameter_estimate': 50, 'clustering_coefficient': 0.2811, 'weakly_connected_components': 93, 'largest_wcc_size': 443, 'pagerank_top10_percent': 6.18, 'louvain_communities': 105, 'louvain_modularity': 0.4294, 'label_entropy': 1.4979, 'computational_time': 0.2886275459313765}, 'retrieval_queries': []}
2025-11-30 22:03:04,108 - src.pipeline.kg_builder - DEBUG - Batch 62 metrics: {
  "batch_idx": 62,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511384.108018,
  "total_time": 16.965592370950617,
  "aggregation": 2.9070070013403893e-06,
  "network_info": 0.012677447055466473,
  "llm_extraction": 16.52930080203805,
  "data_cleaning": 2.126605249941349e-05,
  "neo4j_injection": 0.1330090630799532,
  "embedding_time": 0,
  "indexing_time": 0.006422571954317391,
  "graph_injection_time": 0.12635619495995343,
  "acs_metrics": {
    "node_count": 535,
    "relationship_count": 1427,
    "density": 0.005,
    "avg_degree": 5.3346,
    "avg_unique_neighbors": 5.2785,
    "global_efficiency": 0.2718,
    "avg_path_length": 2.6861,
    "avg_degree_centrality": 0.01,
    "max_degree_centrality": 0.5019,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0388,
    "degree_assortativity": -0.2007,
    "graph_robustness": 0.8535,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2811,
    "weakly_connected_components": 93,
    "largest_wcc_size": 443,
    "pagerank_top10_percent": 6.18,
    "louvain_communities": 105,
    "louvain_modularity": 0.4294,
    "label_entropy": 1.4979,
    "computational_time": 0.2886275459313765
  },
  "retrieval_queries": []
}
2025-11-30 22:03:04,109 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:03:04,109 - src.pipeline.kg_builder - INFO - Batch 63 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 16.53s, Clean: 0.00s, Neo4j: 0.13s, ACS: 0.29s
2025-11-30 22:03:04,109 - src.pipeline.kg_builder - INFO - Batch 63 completed in 16.97s
Processing KG batches:  88%|████████▊ | 63/72 [22:45<02:37, 17.45s/it]2025-11-30 22:03:04,109 - src.pipeline.kg_builder - INFO - Processing batch 64/72 (3 items)
2025-11-30 22:03:04,109 - src.pipeline.kg_builder - DEBUG - Batch 64 current_video_time: 15:52-15:57
2025-11-30 22:03:04,119 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 535
- Total Relationships: 434
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:03:04,120 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 22:03:04,120 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0 ~216 words, content: Time: 15:42-15:47 Content: The video captures a scene in a well-equipped laboratory, focusing on a scientific experiment in progress. The sequence of frames provides a...
2025-11-30 22:03:04,120 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1 ~216 words, content: stand** holds a glass tube, which is connected by a long, flexible tube to a **beaker** filled with a clear liquid. This setup is typical...
2025-11-30 22:03:04,120 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_2 ~230 words, content: showing a person interacting with the environment and equipment. - The first frame provides a wide view of a laboratory. A black countertop is set...
2025-11-30 22:03:04,120 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_3 ~246 words, content: :52-15:57 Content: The video sequence captures a scientific experiment or procedure taking place in a laboratory setting. The frames show a person, likely a scientist...
2025-11-30 22:03:04,120 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:03:04,120 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0) (~216 words) with timeout=5.0s retries=3
2025-11-30 22:03:07,240 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:03:07,241 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:03:07,241 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1) (~216 words) with timeout=5.0s retries=3
2025-11-30 22:03:08,492 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:03:08,492 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:03:08,492 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_2) (~230 words) with timeout=5.0s retries=3
2025-11-30 22:03:09,447 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:03:09,447 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:03:09,448 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_3) (~246 words) with timeout=5.0s retries=3
2025-11-30 22:03:10,675 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 22:03:10,675 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 22:03:10,675 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-30 22:03:10,675 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 6.56s
2025-11-30 22:03:10,676 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 22:03:10,676 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 535
- Total Relationships: 434
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Stands In", "tail": "Laboratory", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0"]}, {"head": "Person", "relation": "Smiles At", "tail": "Camera", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Glass_Cabinets", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0"]}, {"head": "Glass_Cabinets", "relation": "Contain", "tail": "Bottles", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Laboratory_Bench", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0"]}, {"head": "Laboratory_Bench", "relation": "Contains", "tail": "Balance_Scale", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1"]}, {"head": "Glass Tube", "relation": "Connected To", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1"]}, {"head": "Flask", "relation": "Is Part Of", "tail": "Apparatus", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1"]}, {"head": "Apparatus", "relation": "Used For", "tail": "Reflux", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1"]}, {"head": "Apparatus", "relation": "Used For", "tail": "Distillation", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1"]}, {"head": "Person", "relation": "Enters", "tail": "Laboratory", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_2"]}, {"head": "Person", "relation": "Holds", "tail": "Smartphone", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_2"]}, {"head": "Person", "relation": "Walks", "tail": "Through Lab", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:03:10,676 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~246 words, ~320 tokens)
2025-11-30 22:03:10,676 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:03:21,741 - src.components.global_refiner - DEBUG - LLM call completed in 11.06s
2025-11-30 22:03:21,741 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'stands_in', 'Laboratory', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0']], ['Person', 'smiles_at', 'Camera', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0']], ['Laboratory', 'contains', 'Glass_Cabinets', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0']], ['Glass_Cabinets', 'contains', 'Bottles', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0']], ['Laboratory', 'contains', 'Laboratory_Bench', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0']], ['Laboratory_Bench', 'contains', 'Balance_Scale', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0']], ['Person', 'holds', 'Glass_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1']], ['Glass_Tube', 'connected_to', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1']], ['Beaker', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1']], ['Flask', 'is_part_of', 'Apparatus', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1']]]
2025-11-30 22:03:21,741 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "stands_in",
    "Laboratory",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0"
    ]
  ],
  [
    "Person",
    "smiles_at",
    "Camera",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Glass_Cabinets",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0"
    ]
  ],
  [
    "Glass_Cabinets",
    "contains",
    "Bottles",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Laboratory_Bench",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Balance_Scale",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1"
    ]
  ],
  [
    "Glass_Tube",
    "connected_to",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1"
    ]
  ],
  [
    "Flask",
    "is_part_of",
    "Apparatus",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_63_1"
    ]
  ]
]
2025-11-30 22:03:21,741 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.07s, LLM: 11.06s)
2025-11-30 22:03:21,741 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.07s
2025-11-30 22:03:21,741 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:03:21,741 - src.pipeline.kg_builder - INFO - Pushing batch 64/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:03:21,741 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:03:21,862 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:03:21,862 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:03:21,862 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:03:21,862 - src.components.neo4j_handler - INFO - Batch injected in 0.12s (triplets: 0.12s, indexes: 0.00s)
2025-11-30 22:03:21,863 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 292, 'with_embedding': 0, 'linked_chunks': 198}
2025-11-30 22:03:21,863 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:03:21,899 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 22:03:22,133 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 448 nodes
2025-11-30 22:03:22,162 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 542, 'relationship_count': 1447, 'density': 0.0049, 'avg_degree': 5.3395, 'avg_unique_neighbors': 5.2804, 'global_efficiency': 0.2712, 'avg_path_length': 2.6868, 'avg_degree_centrality': 0.0099, 'max_degree_centrality': 0.5009, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.037, 'degree_assortativity': -0.2005, 'graph_robustness': 0.8514, 'diameter_estimate': 50, 'clustering_coefficient': 0.2808, 'weakly_connected_components': 95, 'largest_wcc_size': 448, 'pagerank_top10_percent': 6.08, 'louvain_communities': 108, 'louvain_modularity': 0.4348, 'label_entropy': 1.4978, 'computational_time': 0.2992024220293388}
2025-11-30 22:03:22,163 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 63, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511402.1631207, 'total_time': 18.053716046037152, 'aggregation': 2.227025106549263e-06, 'network_info': 0.010146636050194502, 'llm_extraction': 17.621636954019777, 'data_cleaning': 1.3230019249022007e-05, 'neo4j_injection': 0.12104063702281564, 'embedding_time': 0, 'indexing_time': 0.0040784310549497604, 'graph_injection_time': 0.11679963301867247, 'acs_metrics': {'node_count': 542, 'relationship_count': 1447, 'density': 0.0049, 'avg_degree': 5.3395, 'avg_unique_neighbors': 5.2804, 'global_efficiency': 0.2712, 'avg_path_length': 2.6868, 'avg_degree_centrality': 0.0099, 'max_degree_centrality': 0.5009, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.037, 'degree_assortativity': -0.2005, 'graph_robustness': 0.8514, 'diameter_estimate': 50, 'clustering_coefficient': 0.2808, 'weakly_connected_components': 95, 'largest_wcc_size': 448, 'pagerank_top10_percent': 6.08, 'louvain_communities': 108, 'louvain_modularity': 0.4348, 'label_entropy': 1.4978, 'computational_time': 0.2992024220293388}, 'retrieval_queries': []}
2025-11-30 22:03:22,163 - src.pipeline.kg_builder - DEBUG - Batch 63 metrics: {
  "batch_idx": 63,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511402.1631207,
  "total_time": 18.053716046037152,
  "aggregation": 2.227025106549263e-06,
  "network_info": 0.010146636050194502,
  "llm_extraction": 17.621636954019777,
  "data_cleaning": 1.3230019249022007e-05,
  "neo4j_injection": 0.12104063702281564,
  "embedding_time": 0,
  "indexing_time": 0.0040784310549497604,
  "graph_injection_time": 0.11679963301867247,
  "acs_metrics": {
    "node_count": 542,
    "relationship_count": 1447,
    "density": 0.0049,
    "avg_degree": 5.3395,
    "avg_unique_neighbors": 5.2804,
    "global_efficiency": 0.2712,
    "avg_path_length": 2.6868,
    "avg_degree_centrality": 0.0099,
    "max_degree_centrality": 0.5009,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.037,
    "degree_assortativity": -0.2005,
    "graph_robustness": 0.8514,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2808,
    "weakly_connected_components": 95,
    "largest_wcc_size": 448,
    "pagerank_top10_percent": 6.08,
    "louvain_communities": 108,
    "louvain_modularity": 0.4348,
    "label_entropy": 1.4978,
    "computational_time": 0.2992024220293388
  },
  "retrieval_queries": []
}
2025-11-30 22:03:22,164 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:03:22,164 - src.pipeline.kg_builder - INFO - Batch 64 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 17.62s, Clean: 0.00s, Neo4j: 0.12s, ACS: 0.30s
2025-11-30 22:03:22,164 - src.pipeline.kg_builder - INFO - Batch 64 completed in 18.05s
Processing KG batches:  89%|████████▉ | 64/72 [23:03<02:21, 17.63s/it]2025-11-30 22:03:22,164 - src.pipeline.kg_builder - INFO - Processing batch 65/72 (3 items)
2025-11-30 22:03:22,164 - src.pipeline.kg_builder - DEBUG - Batch 65 current_video_time: 16:07-16:12
2025-11-30 22:03:22,175 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 542
- Total Relationships: 442
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:03:22,175 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 22:03:22,176 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0 ~240 words, content: Time: 15:57-16:02 Content: The video sequence captures a scientific procedure being performed in a laboratory setting. The scene is focused on a workbench where a...
2025-11-30 22:03:22,176 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1 ~240 words, content: with various pieces of equipment and materials. - **Initial Setup:** The video begins with a close-up view of a laboratory bench. A clear, flexible tube...
2025-11-30 22:03:22,176 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_2 ~233 words, content: tube is seen extending from the stirrer into the beaker, suggesting that the liquid is being mixed or stirred as it is added. - **Final...
2025-11-30 22:03:22,176 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_3 ~149 words, content: rod, likely a stir bar or a probe, is inserted into the liquid. The surrounding area is cluttered with various laboratory equipment, including a digital...
2025-11-30 22:03:22,176 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:03:22,176 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0) (~240 words) with timeout=5.0s retries=3
2025-11-30 22:03:23,544 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:03:23,544 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:03:23,544 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1) (~240 words) with timeout=5.0s retries=3
2025-11-30 22:03:24,671 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:03:24,672 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:03:24,672 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_2) (~233 words) with timeout=5.0s retries=3
2025-11-30 22:03:25,803 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:03:25,804 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:03:25,804 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_3) (~149 words) with timeout=5.0s retries=3
2025-11-30 22:03:26,914 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 22:03:26,914 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 22:03:26,914 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 4 chunks
2025-11-30 22:03:26,914 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 4.74s
2025-11-30 22:03:26,915 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 22:03:26,915 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 542
- Total Relationships: 442
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0"]}, {"head": "Person", "relation": "Holds", "tail": "Flexible_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0"]}, {"head": "Flexible_Tube", "relation": "Is Inserted Into", "tail": "Clear_Plastic_Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0"]}, {"head": "Clear_Plastic_Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0"]}, {"head": "Laboratory_Bench", "relation": "Contains", "tail": "Equipment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0"]}, {"head": "Person", "relation": "Performs", "tail": "Scientific_Procedure", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0"]}, {"head": "Tube", "relation": "Extends From", "tail": "Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1"]}, {"head": "Container", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1"]}, {"head": "Tube", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1"]}, {"head": "Tube", "relation": "Extends Into", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_2"]}, {"head": "Beaker", "relation": "Is On", "tail": "Laboratory_Bench", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1"]}, {"head": "Stirrer", "relation": "Stirs", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_2"]}, {"head": "Liquid", "relation": "Is Dispensed Into", "tail": "Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_2"]}, {"head": "Container", "relation": "Is On", "tail": "Laboratory_Bench", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:03:26,915 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~244 words, ~317 tokens)
2025-11-30 22:03:26,915 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:03:38,121 - src.components.global_refiner - DEBUG - LLM call completed in 11.21s
2025-11-30 22:03:38,121 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0']], ['Person', 'holds', 'Flexible_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0']], ['Flexible_Tube', 'is_inserted_into', 'Clear_Plastic_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0']], ['Clear_Plastic_Container', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0']], ['Laboratory_Bench', 'contains', 'Equipment', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0']], ['Person', 'performs', 'Scientific_Procedure', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0']], ['Tube', 'extends_from', 'Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1']], ['Container', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1']], ['Tube', 'transfers', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1']], ['Beaker', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1']]]
2025-11-30 22:03:38,121 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Flexible_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0"
    ]
  ],
  [
    "Flexible_Tube",
    "is_inserted_into",
    "Clear_Plastic_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0"
    ]
  ],
  [
    "Clear_Plastic_Container",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Equipment",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0"
    ]
  ],
  [
    "Person",
    "performs",
    "Scientific_Procedure",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_0"
    ]
  ],
  [
    "Tube",
    "extends_from",
    "Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1"
    ]
  ],
  [
    "Container",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1"
    ]
  ],
  [
    "Tube",
    "transfers",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_64_1"
    ]
  ]
]
2025-11-30 22:03:38,121 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.21s, LLM: 11.21s)
2025-11-30 22:03:38,122 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.21s
2025-11-30 22:03:38,122 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:03:38,122 - src.pipeline.kg_builder - INFO - Pushing batch 65/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:03:38,122 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:03:38,238 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:03:38,238 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:03:38,238 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:03:38,238 - src.components.neo4j_handler - INFO - Batch injected in 0.12s (triplets: 0.11s, indexes: 0.00s)
2025-11-30 22:03:38,239 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 296, 'with_embedding': 0, 'linked_chunks': 200}
2025-11-30 22:03:38,239 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:03:38,275 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 22:03:38,512 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 450 nodes
2025-11-30 22:03:38,540 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 546, 'relationship_count': 1464, 'density': 0.0049, 'avg_degree': 5.3626, 'avg_unique_neighbors': 5.304, 'global_efficiency': 0.2705, 'avg_path_length': 2.6843, 'avg_degree_centrality': 0.0098, 'max_degree_centrality': 0.4991, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0325, 'degree_assortativity': -0.1981, 'graph_robustness': 0.8531, 'diameter_estimate': 50, 'clustering_coefficient': 0.2795, 'weakly_connected_components': 97, 'largest_wcc_size': 450, 'pagerank_top10_percent': 6.06, 'louvain_communities': 110, 'louvain_modularity': 0.4309, 'label_entropy': 1.4974, 'computational_time': 0.3006308180047199}
2025-11-30 22:03:38,540 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 64, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511418.5407062, 'total_time': 16.376147550996393, 'aggregation': 2.693035639822483e-06, 'network_info': 0.010896502994000912, 'llm_extraction': 15.94644063396845, 'data_cleaning': 2.4194014258682728e-05, 'neo4j_injection': 0.11640277004335076, 'embedding_time': 0, 'indexing_time': 0.003657585009932518, 'graph_injection_time': 0.11249453097116202, 'acs_metrics': {'node_count': 546, 'relationship_count': 1464, 'density': 0.0049, 'avg_degree': 5.3626, 'avg_unique_neighbors': 5.304, 'global_efficiency': 0.2705, 'avg_path_length': 2.6843, 'avg_degree_centrality': 0.0098, 'max_degree_centrality': 0.4991, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0325, 'degree_assortativity': -0.1981, 'graph_robustness': 0.8531, 'diameter_estimate': 50, 'clustering_coefficient': 0.2795, 'weakly_connected_components': 97, 'largest_wcc_size': 450, 'pagerank_top10_percent': 6.06, 'louvain_communities': 110, 'louvain_modularity': 0.4309, 'label_entropy': 1.4974, 'computational_time': 0.3006308180047199}, 'retrieval_queries': []}
2025-11-30 22:03:38,540 - src.pipeline.kg_builder - DEBUG - Batch 64 metrics: {
  "batch_idx": 64,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511418.5407062,
  "total_time": 16.376147550996393,
  "aggregation": 2.693035639822483e-06,
  "network_info": 0.010896502994000912,
  "llm_extraction": 15.94644063396845,
  "data_cleaning": 2.4194014258682728e-05,
  "neo4j_injection": 0.11640277004335076,
  "embedding_time": 0,
  "indexing_time": 0.003657585009932518,
  "graph_injection_time": 0.11249453097116202,
  "acs_metrics": {
    "node_count": 546,
    "relationship_count": 1464,
    "density": 0.0049,
    "avg_degree": 5.3626,
    "avg_unique_neighbors": 5.304,
    "global_efficiency": 0.2705,
    "avg_path_length": 2.6843,
    "avg_degree_centrality": 0.0098,
    "max_degree_centrality": 0.4991,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0325,
    "degree_assortativity": -0.1981,
    "graph_robustness": 0.8531,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2795,
    "weakly_connected_components": 97,
    "largest_wcc_size": 450,
    "pagerank_top10_percent": 6.06,
    "louvain_communities": 110,
    "louvain_modularity": 0.4309,
    "label_entropy": 1.4974,
    "computational_time": 0.3006308180047199
  },
  "retrieval_queries": []
}
2025-11-30 22:03:38,541 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:03:38,542 - src.pipeline.kg_builder - INFO - Batch 65 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 15.95s, Clean: 0.00s, Neo4j: 0.12s, ACS: 0.30s
2025-11-30 22:03:38,542 - src.pipeline.kg_builder - INFO - Batch 65 completed in 16.38s
Processing KG batches:  90%|█████████ | 65/72 [23:19<02:00, 17.26s/it]2025-11-30 22:03:38,542 - src.pipeline.kg_builder - INFO - Processing batch 66/72 (3 items)
2025-11-30 22:03:38,542 - src.pipeline.kg_builder - DEBUG - Batch 66 current_video_time: 16:22-16:27
2025-11-30 22:03:38,549 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 546
- Total Relationships: 448
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:03:38,549 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 22:03:38,549 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0 ~238 words, content: Time: 16:12-16:17 Content: The video sequence captures a scientific experiment taking place in a laboratory setting. The scene begins with a person, who has curly...
2025-11-30 22:03:38,549 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1 ~239 words, content: of the equipment. The overall atmosphere of the video suggests a scientific experiment or a demonstration of a chemical process, with the person in the...
2025-11-30 22:03:38,549 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_2 ~161 words, content: Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a procedure on a black countertop. The central action involves...
2025-11-30 22:03:38,549 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:03:38,549 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0) (~238 words) with timeout=5.0s retries=3
2025-11-30 22:03:39,709 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:03:39,709 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:03:39,710 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1) (~239 words) with timeout=5.0s retries=3
2025-11-30 22:03:40,914 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:03:40,914 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:03:40,914 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_2) (~161 words) with timeout=5.0s retries=3
2025-11-30 22:03:42,236 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:03:42,236 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:03:42,237 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 3 chunks
2025-11-30 22:03:42,237 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 3.69s
2025-11-30 22:03:42,237 - src.components.global_refiner - INFO - Capping refinement input: 17 → 15 triplets
2025-11-30 22:03:42,237 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 546
- Total Relationships: 448
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Beige Sweater", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0"]}, {"head": "Person", "relation": "Handles", "tail": "Transparent Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0"]}, {"head": "Transparent Container", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0"]}, {"head": "Person", "relation": "Manipulates", "tail": "Glass Funnel", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0"]}, {"head": "Glass Funnel", "relation": "Is Submerged In", "tail": "Clear Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_2"]}, {"head": "Person", "relation": "Wears", "tail": "Black_Watch", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1"]}, {"head": "Person", "relation": "Manipulates", "tail": "Transparent_Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1"]}, {"head": "Transparent_Container", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1"]}, {"head": "Transparent_Container", "relation": "Contains", "tail": "White_Substance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1"]}, {"head": "Person", "relation": "Uses", "tail": "Equipment_Inside_Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1"]}, {"head": "Person", "relation": "Performs", "tail": "Procedure", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_2"]}, {"head": "Person", "relation": "Holds", "tail": "Test_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_2"]}, {"head": "Test_Tube", "relation": "Is Submerged In", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:03:42,237 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~248 words, ~322 tokens)
2025-11-30 22:03:42,237 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:03:54,308 - src.components.global_refiner - DEBUG - LLM call completed in 12.07s
2025-11-30 22:03:54,308 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Beige_Sweater', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0']], ['Person', 'wears', 'Blue_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0']], ['Person', 'handles', 'Transparent_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0']], ['Transparent_Container', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0']], ['Person', 'manipulates', 'Glass_Funnel', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0']], ['Glass_Funnel', 'is_submerged_in', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_2']], ['Person', 'wears', 'Black_Watch', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1']], ['Person', 'manipulates', 'Transparent_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1']], ['Transparent_Container', 'contains', 'Clear_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1']]]
2025-11-30 22:03:54,308 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Beige_Sweater",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0"
    ]
  ],
  [
    "Person",
    "handles",
    "Transparent_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0"
    ]
  ],
  [
    "Transparent_Container",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0"
    ]
  ],
  [
    "Person",
    "manipulates",
    "Glass_Funnel",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0"
    ]
  ],
  [
    "Glass_Funnel",
    "is_submerged_in",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Black_Watch",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1"
    ]
  ],
  [
    "Person",
    "manipulates",
    "Transparent_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1"
    ]
  ],
  [
    "Transparent_Container",
    "contains",
    "Clear_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_65_1"
    ]
  ]
]
2025-11-30 22:03:54,308 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 12.07s, LLM: 12.07s)
2025-11-30 22:03:54,308 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 12.07s
2025-11-30 22:03:54,308 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:03:54,308 - src.pipeline.kg_builder - INFO - Pushing batch 66/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:03:54,309 - src.components.neo4j_handler - INFO - Adding 9 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:03:54,416 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:03:54,416 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:03:54,417 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:03:54,417 - src.components.neo4j_handler - INFO - Batch injected in 0.11s (triplets: 0.10s, indexes: 0.01s)
2025-11-30 22:03:54,418 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 299, 'with_embedding': 0, 'linked_chunks': 203}
2025-11-30 22:03:54,418 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:03:54,455 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 22:03:54,697 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 456 nodes
2025-11-30 22:03:54,725 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 552, 'relationship_count': 1481, 'density': 0.0049, 'avg_degree': 5.3659, 'avg_unique_neighbors': 5.308, 'global_efficiency': 0.2759, 'avg_path_length': 2.6771, 'avg_degree_centrality': 0.0097, 'max_degree_centrality': 0.5045, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0396, 'degree_assortativity': -0.2031, 'graph_robustness': 0.8501, 'diameter_estimate': 50, 'clustering_coefficient': 0.2802, 'weakly_connected_components': 97, 'largest_wcc_size': 456, 'pagerank_top10_percent': 5.99, 'louvain_communities': 109, 'louvain_modularity': 0.4344, 'label_entropy': 1.4975, 'computational_time': 0.30698398395907134}
2025-11-30 22:03:54,725 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 65, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511434.7255473, 'total_time': 16.18341729801614, 'aggregation': 2.1080486476421356e-06, 'network_info': 0.006962431012652814, 'llm_extraction': 15.759641195996664, 'data_cleaning': 1.5828991308808327e-05, 'neo4j_injection': 0.10823708993848413, 'embedding_time': 0, 'indexing_time': 0.005219537997618318, 'graph_injection_time': 0.1028283319901675, 'acs_metrics': {'node_count': 552, 'relationship_count': 1481, 'density': 0.0049, 'avg_degree': 5.3659, 'avg_unique_neighbors': 5.308, 'global_efficiency': 0.2759, 'avg_path_length': 2.6771, 'avg_degree_centrality': 0.0097, 'max_degree_centrality': 0.5045, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0396, 'degree_assortativity': -0.2031, 'graph_robustness': 0.8501, 'diameter_estimate': 50, 'clustering_coefficient': 0.2802, 'weakly_connected_components': 97, 'largest_wcc_size': 456, 'pagerank_top10_percent': 5.99, 'louvain_communities': 109, 'louvain_modularity': 0.4344, 'label_entropy': 1.4975, 'computational_time': 0.30698398395907134}, 'retrieval_queries': []}
2025-11-30 22:03:54,725 - src.pipeline.kg_builder - DEBUG - Batch 65 metrics: {
  "batch_idx": 65,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511434.7255473,
  "total_time": 16.18341729801614,
  "aggregation": 2.1080486476421356e-06,
  "network_info": 0.006962431012652814,
  "llm_extraction": 15.759641195996664,
  "data_cleaning": 1.5828991308808327e-05,
  "neo4j_injection": 0.10823708993848413,
  "embedding_time": 0,
  "indexing_time": 0.005219537997618318,
  "graph_injection_time": 0.1028283319901675,
  "acs_metrics": {
    "node_count": 552,
    "relationship_count": 1481,
    "density": 0.0049,
    "avg_degree": 5.3659,
    "avg_unique_neighbors": 5.308,
    "global_efficiency": 0.2759,
    "avg_path_length": 2.6771,
    "avg_degree_centrality": 0.0097,
    "max_degree_centrality": 0.5045,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0396,
    "degree_assortativity": -0.2031,
    "graph_robustness": 0.8501,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2802,
    "weakly_connected_components": 97,
    "largest_wcc_size": 456,
    "pagerank_top10_percent": 5.99,
    "louvain_communities": 109,
    "louvain_modularity": 0.4344,
    "label_entropy": 1.4975,
    "computational_time": 0.30698398395907134
  },
  "retrieval_queries": []
}
2025-11-30 22:03:54,727 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:03:54,727 - src.pipeline.kg_builder - INFO - Batch 66 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 15.76s, Clean: 0.00s, Neo4j: 0.11s, ACS: 0.31s
2025-11-30 22:03:54,727 - src.pipeline.kg_builder - INFO - Batch 66 completed in 16.18s
Processing KG batches:  92%|█████████▏| 66/72 [23:36<01:41, 16.93s/it]2025-11-30 22:03:54,727 - src.pipeline.kg_builder - INFO - Processing batch 67/72 (3 items)
2025-11-30 22:03:54,727 - src.pipeline.kg_builder - DEBUG - Batch 67 current_video_time: 16:37-16:42
2025-11-30 22:03:54,734 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 552
- Total Relationships: 454
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:03:54,734 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 22:03:54,734 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0 ~229 words, content: Time: 16:27-16:32 Content: The video captures a sequence of actions in a laboratory setting, focusing on a person conducting a chemical experiment. The scene is...
2025-11-30 22:03:54,734 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1 ~232 words, content: The central activity involves a glass beaker, which contains a dark, cylindrical object, likely a sample or a filter. This beaker is placed on a...
2025-11-30 22:03:54,734 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_2 ~229 words, content: with the camera panning to the right, revealing more of the laboratory environment, including a blue base with a metal rod, which could be part...
2025-11-30 22:03:54,734 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_3 ~225 words, content: providing a wider view of the lab bench. The digital scale is now clearly identifiable as a "DUA" model. A person's hand, wearing a blue...
2025-11-30 22:03:54,734 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_4 ~81 words, content: a blue base, a roll of black tape, and other laboratory items. In summary, the video shows a laboratory experiment where a substance is being...
2025-11-30 22:03:54,735 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:03:54,735 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0) (~229 words) with timeout=5.0s retries=3
2025-11-30 22:03:55,827 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:03:55,827 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:03:55,828 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1) (~232 words) with timeout=5.0s retries=3
2025-11-30 22:03:57,566 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:03:57,567 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:03:57,567 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_2) (~229 words) with timeout=5.0s retries=3
2025-11-30 22:03:58,950 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:03:58,951 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:03:58,951 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_3) (~225 words) with timeout=5.0s retries=3
2025-11-30 22:04:00,234 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 22:04:00,235 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 22:04:00,235 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_4) (~81 words) with timeout=5.0s retries=3
2025-11-30 22:04:01,429 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 22:04:01,429 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 22:04:01,430 - src.components.pre_llm_injector - INFO - Extracted 30 local triplets from 5 chunks
2025-11-30 22:04:01,430 - src.pipeline.kg_builder - INFO - Pre-extraction: 30 triplets in 6.70s
2025-11-30 22:04:01,430 - src.components.global_refiner - INFO - Capping refinement input: 30 → 15 triplets
2025-11-30 22:04:01,430 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 552
- Total Relationships: 454
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0"]}, {"head": "Liquid", "relation": "Is In", "tail": "Transparent Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0"]}, {"head": "Transparent Container", "relation": "Is On", "tail": "Black Countertop", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Dark_Cylindrical_Object", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1"]}, {"head": "Beaker", "relation": "Placed On", "tail": "Magnetic_Stirrer_Or_Heating_Plate", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1"]}, {"head": "Magnetic_Stirrer_Or_Heating_Plate", "relation": "Placed On", "tail": "Digital_Scale", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1"]}, {"head": "Digital_Scale", "relation": "Displays", "tail": "0970", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1"]}, {"head": "Beaker", "relation": "Connected To", "tail": "White_Tube_Or_Rod", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1"]}, {"head": "Camera", "relation": "Pans To", "tail": "Right", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_2"]}, {"head": "Laboratory_Environment", "relation": "Contains", "tail": "Blue_Base", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_2"]}, {"head": "Blue_Base", "relation": "Has Part", "tail": "Metal_Rod", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:04:01,430 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~246 words, ~320 tokens)
2025-11-30 22:04:01,430 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:04:13,029 - src.components.global_refiner - DEBUG - LLM call completed in 11.60s
2025-11-30 22:04:13,029 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Glove', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1']], ['Person', 'holds', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0']], ['Pipette', 'transfers', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0']], ['Liquid', 'is_in', 'Transparent_Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0']], ['Transparent_Container', 'is_on', 'Black_Countertop', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0']], ['Beaker', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0']], ['Beaker', 'contains', 'Dark_Cylindrical_Object', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1']], ['Beaker', 'placed_on', 'Magnetic_Stirrer_Or_Heating_Plate', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1']], ['Magnetic_Stirrer_Or_Heating_Plate', 'placed_on', 'Digital_Scale', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1']], ['Digital_Scale', 'displays', '0970', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1']]]
2025-11-30 22:04:13,029 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Glove",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0"
    ]
  ],
  [
    "Liquid",
    "is_in",
    "Transparent_Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0"
    ]
  ],
  [
    "Transparent_Container",
    "is_on",
    "Black_Countertop",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Dark_Cylindrical_Object",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1"
    ]
  ],
  [
    "Beaker",
    "placed_on",
    "Magnetic_Stirrer_Or_Heating_Plate",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1"
    ]
  ],
  [
    "Magnetic_Stirrer_Or_Heating_Plate",
    "placed_on",
    "Digital_Scale",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1"
    ]
  ],
  [
    "Digital_Scale",
    "displays",
    "0970",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_66_1"
    ]
  ]
]
2025-11-30 22:04:13,029 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.60s, LLM: 11.60s)
2025-11-30 22:04:13,029 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.60s
2025-11-30 22:04:13,029 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:04:13,030 - src.pipeline.kg_builder - INFO - Pushing batch 67/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:04:13,030 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:04:13,171 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:04:13,171 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:04:13,171 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:04:13,171 - src.components.neo4j_handler - INFO - Batch injected in 0.14s (triplets: 0.14s, indexes: 0.00s)
2025-11-30 22:04:13,173 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 304, 'with_embedding': 0, 'linked_chunks': 205}
2025-11-30 22:04:13,173 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:04:13,228 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 22:04:13,474 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 462 nodes
2025-11-30 22:04:13,502 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 561, 'relationship_count': 1500, 'density': 0.0048, 'avg_degree': 5.3476, 'avg_unique_neighbors': 5.2906, 'global_efficiency': 0.2686, 'avg_path_length': 2.6814, 'avg_degree_centrality': 0.0095, 'max_degree_centrality': 0.5, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0329, 'degree_assortativity': -0.1996, 'graph_robustness': 0.85, 'diameter_estimate': 50, 'clustering_coefficient': 0.279, 'weakly_connected_components': 100, 'largest_wcc_size': 462, 'pagerank_top10_percent': 5.89, 'louvain_communities': 112, 'louvain_modularity': 0.4313, 'label_entropy': 1.4975, 'computational_time': 0.32920609891880304}
2025-11-30 22:04:13,503 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 66, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511453.503029, 'total_time': 18.77559694403317, 'aggregation': 2.3460015654563904e-06, 'network_info': 0.006838880013674498, 'llm_extraction': 18.29549110494554, 'data_cleaning': 2.5879940949380398e-05, 'neo4j_injection': 0.14199020608793944, 'embedding_time': 0, 'indexing_time': 0.004916066071018577, 'graph_injection_time': 0.13681394699960947, 'acs_metrics': {'node_count': 561, 'relationship_count': 1500, 'density': 0.0048, 'avg_degree': 5.3476, 'avg_unique_neighbors': 5.2906, 'global_efficiency': 0.2686, 'avg_path_length': 2.6814, 'avg_degree_centrality': 0.0095, 'max_degree_centrality': 0.5, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0329, 'degree_assortativity': -0.1996, 'graph_robustness': 0.85, 'diameter_estimate': 50, 'clustering_coefficient': 0.279, 'weakly_connected_components': 100, 'largest_wcc_size': 462, 'pagerank_top10_percent': 5.89, 'louvain_communities': 112, 'louvain_modularity': 0.4313, 'label_entropy': 1.4975, 'computational_time': 0.32920609891880304}, 'retrieval_queries': []}
2025-11-30 22:04:13,503 - src.pipeline.kg_builder - DEBUG - Batch 66 metrics: {
  "batch_idx": 66,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511453.503029,
  "total_time": 18.77559694403317,
  "aggregation": 2.3460015654563904e-06,
  "network_info": 0.006838880013674498,
  "llm_extraction": 18.29549110494554,
  "data_cleaning": 2.5879940949380398e-05,
  "neo4j_injection": 0.14199020608793944,
  "embedding_time": 0,
  "indexing_time": 0.004916066071018577,
  "graph_injection_time": 0.13681394699960947,
  "acs_metrics": {
    "node_count": 561,
    "relationship_count": 1500,
    "density": 0.0048,
    "avg_degree": 5.3476,
    "avg_unique_neighbors": 5.2906,
    "global_efficiency": 0.2686,
    "avg_path_length": 2.6814,
    "avg_degree_centrality": 0.0095,
    "max_degree_centrality": 0.5,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0329,
    "degree_assortativity": -0.1996,
    "graph_robustness": 0.85,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.279,
    "weakly_connected_components": 100,
    "largest_wcc_size": 462,
    "pagerank_top10_percent": 5.89,
    "louvain_communities": 112,
    "louvain_modularity": 0.4313,
    "label_entropy": 1.4975,
    "computational_time": 0.32920609891880304
  },
  "retrieval_queries": []
}
2025-11-30 22:04:13,504 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:04:13,504 - src.pipeline.kg_builder - INFO - Batch 67 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 18.30s, Clean: 0.00s, Neo4j: 0.14s, ACS: 0.33s
2025-11-30 22:04:13,504 - src.pipeline.kg_builder - INFO - Batch 67 completed in 18.78s
Processing KG batches:  93%|█████████▎| 67/72 [23:54<01:27, 17.49s/it]2025-11-30 22:04:13,504 - src.pipeline.kg_builder - INFO - Processing batch 68/72 (3 items)
2025-11-30 22:04:13,504 - src.pipeline.kg_builder - DEBUG - Batch 68 current_video_time: 16:52-16:57
2025-11-30 22:04:13,513 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 561
- Total Relationships: 460
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:04:13,513 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 22:04:13,513 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0 ~234 words, content: Time: 16:42-16:47 Content: The video shows a scientific experiment taking place in a laboratory setting. A person wearing blue gloves is using a pipette to...
2025-11-30 22:04:13,513 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1 ~237 words, content: a solution. The laboratory environment is visible in the background, featuring a white wall, a door, and a shelf with various items, including cardboard boxes...
2025-11-30 22:04:13,513 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_2 ~35 words, content: The final frame provides a wider view of the laboratory, highlighting the equipment and the organized workspace. The overall atmosphere is one of focused scientific...
2025-11-30 22:04:13,513 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:04:13,513 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0) (~234 words) with timeout=5.0s retries=3
2025-11-30 22:04:14,662 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:04:14,662 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:04:14,662 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1) (~237 words) with timeout=5.0s retries=3
2025-11-30 22:04:15,743 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:04:15,743 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:04:15,743 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_2) (~35 words) with timeout=5.0s retries=3
2025-11-30 22:04:16,751 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:04:16,751 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:04:16,751 - src.components.pre_llm_injector - INFO - Extracted 16 local triplets from 3 chunks
2025-11-30 22:04:16,751 - src.pipeline.kg_builder - INFO - Pre-extraction: 16 triplets in 3.24s
2025-11-30 22:04:16,751 - src.components.global_refiner - INFO - Capping refinement input: 16 → 15 triplets
2025-11-30 22:04:16,751 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 561
- Total Relationships: 460
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0"]}, {"head": "Pipette", "relation": "Adds", "tail": "Clear Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0"]}, {"head": "Clear Liquid", "relation": "Is Added To", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudy Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "White Precipitate", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1"]}, {"head": "Person", "relation": "Handles", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1"]}, {"head": "Magnetic Stirrer", "relation": "Mixes", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1"]}, {"head": "Woman", "relation": "Stands Near", "tail": "Glass Cabinet", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Equipment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Workspace", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_2"]}, {"head": "Workspace", "relation": "Is", "tail": "Organized", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_2"]}, {"head": "Laboratory", "relation": "Has", "tail": "Atmosphere", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_2"]}, {"head": "Atmosphere", "relation": "Is", "tail": "Focused", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:04:16,751 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~248 words, ~322 tokens)
2025-11-30 22:04:16,751 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:04:29,358 - src.components.global_refiner - DEBUG - LLM call completed in 12.61s
2025-11-30 22:04:29,358 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue Gloves', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0']], ['Person', 'uses', 'Pipette', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0']], ['Pipette', 'adds', 'Clear Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0']], ['Clear Liquid', 'is_added_to', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0']], ['Beaker', 'contains', 'Cloudy Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1']], ['Beaker', 'contains', 'White Precipitate', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0']], ['Person', 'wears', 'Blue Glove', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1']], ['Person', 'handles', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1']], ['Magnetic Stirrer', 'mixes', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1']], ['Laboratory', 'contains', 'Equipment', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_2']]]
2025-11-30 22:04:29,358 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue Gloves",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0"
    ]
  ],
  [
    "Pipette",
    "adds",
    "Clear Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0"
    ]
  ],
  [
    "Clear Liquid",
    "is_added_to",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Cloudy Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "White Precipitate",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Glove",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1"
    ]
  ],
  [
    "Person",
    "handles",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1"
    ]
  ],
  [
    "Magnetic Stirrer",
    "mixes",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Equipment",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_67_2"
    ]
  ]
]
2025-11-30 22:04:29,358 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 12.61s, LLM: 12.61s)
2025-11-30 22:04:29,358 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 12.61s
2025-11-30 22:04:29,358 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:04:29,359 - src.pipeline.kg_builder - INFO - Pushing batch 68/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:04:29,359 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:04:29,461 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:04:29,461 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:04:29,461 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:04:29,461 - src.components.neo4j_handler - INFO - Batch injected in 0.10s (triplets: 0.10s, indexes: 0.00s)
2025-11-30 22:04:29,462 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 307, 'with_embedding': 0, 'linked_chunks': 208}
2025-11-30 22:04:29,462 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:04:29,517 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 22:04:29,766 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 468 nodes
2025-11-30 22:04:29,794 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 567, 'relationship_count': 1522, 'density': 0.0047, 'avg_degree': 5.3686, 'avg_unique_neighbors': 5.3122, 'global_efficiency': 0.273, 'avg_path_length': 2.6815, 'avg_degree_centrality': 0.0095, 'max_degree_centrality': 0.4982, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0218, 'degree_assortativity': -0.1975, 'graph_robustness': 0.8502, 'diameter_estimate': 50, 'clustering_coefficient': 0.2787, 'weakly_connected_components': 100, 'largest_wcc_size': 468, 'pagerank_top10_percent': 5.85, 'louvain_communities': 113, 'louvain_modularity': 0.432, 'label_entropy': 1.4975, 'computational_time': 0.3320260039763525}
2025-11-30 22:04:29,795 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 67, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511469.795088, 'total_time': 16.29058387200348, 'aggregation': 2.483953721821308e-06, 'network_info': 0.00862305797636509, 'llm_extraction': 15.845699714962393, 'data_cleaning': 1.3393932022154331e-05, 'neo4j_injection': 0.10256195499096066, 'embedding_time': 0, 'indexing_time': 0.0026793150464072824, 'graph_injection_time': 0.09970670798793435, 'acs_metrics': {'node_count': 567, 'relationship_count': 1522, 'density': 0.0047, 'avg_degree': 5.3686, 'avg_unique_neighbors': 5.3122, 'global_efficiency': 0.273, 'avg_path_length': 2.6815, 'avg_degree_centrality': 0.0095, 'max_degree_centrality': 0.4982, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0218, 'degree_assortativity': -0.1975, 'graph_robustness': 0.8502, 'diameter_estimate': 50, 'clustering_coefficient': 0.2787, 'weakly_connected_components': 100, 'largest_wcc_size': 468, 'pagerank_top10_percent': 5.85, 'louvain_communities': 113, 'louvain_modularity': 0.432, 'label_entropy': 1.4975, 'computational_time': 0.3320260039763525}, 'retrieval_queries': []}
2025-11-30 22:04:29,795 - src.pipeline.kg_builder - DEBUG - Batch 67 metrics: {
  "batch_idx": 67,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511469.795088,
  "total_time": 16.29058387200348,
  "aggregation": 2.483953721821308e-06,
  "network_info": 0.00862305797636509,
  "llm_extraction": 15.845699714962393,
  "data_cleaning": 1.3393932022154331e-05,
  "neo4j_injection": 0.10256195499096066,
  "embedding_time": 0,
  "indexing_time": 0.0026793150464072824,
  "graph_injection_time": 0.09970670798793435,
  "acs_metrics": {
    "node_count": 567,
    "relationship_count": 1522,
    "density": 0.0047,
    "avg_degree": 5.3686,
    "avg_unique_neighbors": 5.3122,
    "global_efficiency": 0.273,
    "avg_path_length": 2.6815,
    "avg_degree_centrality": 0.0095,
    "max_degree_centrality": 0.4982,
    "avg_betweenness_centrality": 0.0002,
    "max_betweenness_centrality": 0.0218,
    "degree_assortativity": -0.1975,
    "graph_robustness": 0.8502,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2787,
    "weakly_connected_components": 100,
    "largest_wcc_size": 468,
    "pagerank_top10_percent": 5.85,
    "louvain_communities": 113,
    "louvain_modularity": 0.432,
    "label_entropy": 1.4975,
    "computational_time": 0.3320260039763525
  },
  "retrieval_queries": []
}
2025-11-30 22:04:29,796 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:04:29,796 - src.pipeline.kg_builder - INFO - Batch 68 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 15.85s, Clean: 0.00s, Neo4j: 0.10s, ACS: 0.33s
2025-11-30 22:04:29,796 - src.pipeline.kg_builder - INFO - Batch 68 completed in 16.29s
Processing KG batches:  94%|█████████▍| 68/72 [24:11<01:08, 17.13s/it]2025-11-30 22:04:29,796 - src.pipeline.kg_builder - INFO - Processing batch 69/72 (3 items)
2025-11-30 22:04:29,796 - src.pipeline.kg_builder - DEBUG - Batch 69 current_video_time: 17:07-17:12
2025-11-30 22:04:29,804 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 567
- Total Relationships: 465
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:04:29,805 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 22:04:29,805 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0 ~234 words, content: Time: 16:57-17:02 Content: The video sequence captures a series of events in a laboratory setting, focusing on a scientific experiment involving a magnetic stirrer and...
2025-11-30 22:04:29,805 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1 ~243 words, content: warning label. The person's hand is carefully manipulating the beaker, suggesting they are conducting a precise experiment. - **Frame 4:** The camera returns to a...
2025-11-30 22:04:29,805 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_2 ~228 words, content: supplies, and the person appears to be focused on their task. Time: 17:02-17:07 Content: The video captures a sequence of events in a laboratory setting,...
2025-11-30 22:04:29,805 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_3 ~232 words, content: . In summary, the video shows a person conducting a chemical experiment in a laboratory. The experiment involves mixing a substance in a beaker using...
2025-11-30 22:04:29,805 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_4 ~125 words, content: in the laboratory. He appears to be observing the experiment. His presence suggests that he might be a researcher or a student conducting the experiment....
2025-11-30 22:04:29,805 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:04:29,805 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0) (~234 words) with timeout=5.0s retries=3
2025-11-30 22:04:34,811 - src.components.pre_llm_injector - WARNING - Chunk 0 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 22:04:36,392 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 2)
2025-11-30 22:04:36,392 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:04:36,393 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1) (~243 words) with timeout=5.0s retries=3
2025-11-30 22:04:37,418 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:04:37,418 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:04:37,418 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_2) (~228 words) with timeout=5.0s retries=3
2025-11-30 22:04:38,415 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:04:38,415 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:04:38,415 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_3) (~232 words) with timeout=5.0s retries=3
2025-11-30 22:04:39,462 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 22:04:39,462 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 22:04:39,462 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_4) (~125 words) with timeout=5.0s retries=3
2025-11-30 22:04:40,403 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 22:04:40,403 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 22:04:40,404 - src.components.pre_llm_injector - INFO - Extracted 21 local triplets from 5 chunks
2025-11-30 22:04:40,404 - src.pipeline.kg_builder - INFO - Pre-extraction: 21 triplets in 10.60s
2025-11-30 22:04:40,404 - src.components.global_refiner - INFO - Capping refinement input: 21 → 15 triplets
2025-11-30 22:04:40,404 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 567
- Total Relationships: 465
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Beige Sweater", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_3"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Jeans", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0"]}, {"head": "Person", "relation": "Holds", "tail": "White Object", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0"]}, {"head": "Person", "relation": "Interacts With", "tail": "Magnetic Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0"]}, {"head": "Hand", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0"]}, {"head": "Hand", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0"]}, {"head": "Person", "relation": "Manipulates", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_3"]}, {"head": "Magnetic Stirrer", "relation": "Stirs", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_3"]}, {"head": "Person", "relation": "Interacts With", "tail": "Equipment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Equipment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_4"]}, {"head": "Person", "relation": "Conducts", "tail": "Experiment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_3", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_4"]}, {"head": "Equipment", "relation": "Mixes", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_2"]}, {"head": "Liquid", "relation": "Is In", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_2"]}, {"head": "Beaker", "relation": "Connected To", "tail": "Glass Apparatus", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:04:40,405 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~254 words, ~330 tokens)
2025-11-30 22:04:40,405 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:04:56,283 - src.components.global_refiner - DEBUG - LLM call completed in 15.88s
2025-11-30 22:04:56,283 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Beige Sweater', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_3']], ['Person', 'wears', 'Blue Jeans', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0']], ['Person', 'holds', 'White Object', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0']], ['Person', 'interacts_with', 'Magnetic Stirrer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0']], ['Hand', 'wears', 'Blue Glove', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0']], ['Hand', 'holds', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0']], ['Person', 'manipulates', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1']], ['Beaker', 'contains', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_3']], ['Magnetic Stirrer', 'stirs', 'Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_3']], ['Person', 'conducts', 'Experiment', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_2', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_3', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_4']]]
2025-11-30 22:04:56,283 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Beige Sweater",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Jeans",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0"
    ]
  ],
  [
    "Person",
    "holds",
    "White Object",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0"
    ]
  ],
  [
    "Person",
    "interacts_with",
    "Magnetic Stirrer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0"
    ]
  ],
  [
    "Hand",
    "wears",
    "Blue Glove",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0"
    ]
  ],
  [
    "Hand",
    "holds",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_0"
    ]
  ],
  [
    "Person",
    "manipulates",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_3"
    ]
  ],
  [
    "Magnetic Stirrer",
    "stirs",
    "Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_3"
    ]
  ],
  [
    "Person",
    "conducts",
    "Experiment",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_2",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_3",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_68_4"
    ]
  ]
]
2025-11-30 22:04:56,283 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 15.88s, LLM: 15.88s)
2025-11-30 22:04:56,283 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 15.88s
2025-11-30 22:04:56,283 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:04:56,283 - src.pipeline.kg_builder - INFO - Pushing batch 69/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:04:56,283 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:04:56,475 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:04:56,475 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:04:56,475 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:04:56,475 - src.components.neo4j_handler - INFO - Batch injected in 0.19s (triplets: 0.19s, indexes: 0.01s)
2025-11-30 22:04:56,477 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 312, 'with_embedding': 0, 'linked_chunks': 213}
2025-11-30 22:04:56,477 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:04:56,515 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 22:04:56,770 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 475 nodes
2025-11-30 22:04:56,799 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 574, 'relationship_count': 1551, 'density': 0.0047, 'avg_degree': 5.4042, 'avg_unique_neighbors': 5.3484, 'global_efficiency': 0.2757, 'avg_path_length': 2.6635, 'avg_degree_centrality': 0.0094, 'max_degree_centrality': 0.5079, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0319, 'degree_assortativity': -0.2023, 'graph_robustness': 0.8491, 'diameter_estimate': 50, 'clustering_coefficient': 0.279, 'weakly_connected_components': 100, 'largest_wcc_size': 475, 'pagerank_top10_percent': 5.73, 'louvain_communities': 112, 'louvain_modularity': 0.4247, 'label_entropy': 1.4973, 'computational_time': 0.3227610990870744}
2025-11-30 22:04:56,800 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 68, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511496.800006, 'total_time': 27.003384731011465, 'aggregation': 2.522021532058716e-06, 'network_info': 0.00799480895511806, 'llm_extraction': 26.47893842298072, 'data_cleaning': 3.321806434541941e-05, 'neo4j_injection': 0.19188041100278497, 'embedding_time': 0, 'indexing_time': 0.005069270962849259, 'graph_injection_time': 0.18655878398567438, 'acs_metrics': {'node_count': 574, 'relationship_count': 1551, 'density': 0.0047, 'avg_degree': 5.4042, 'avg_unique_neighbors': 5.3484, 'global_efficiency': 0.2757, 'avg_path_length': 2.6635, 'avg_degree_centrality': 0.0094, 'max_degree_centrality': 0.5079, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0319, 'degree_assortativity': -0.2023, 'graph_robustness': 0.8491, 'diameter_estimate': 50, 'clustering_coefficient': 0.279, 'weakly_connected_components': 100, 'largest_wcc_size': 475, 'pagerank_top10_percent': 5.73, 'louvain_communities': 112, 'louvain_modularity': 0.4247, 'label_entropy': 1.4973, 'computational_time': 0.3227610990870744}, 'retrieval_queries': []}
2025-11-30 22:04:56,800 - src.pipeline.kg_builder - DEBUG - Batch 68 metrics: {
  "batch_idx": 68,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511496.800006,
  "total_time": 27.003384731011465,
  "aggregation": 2.522021532058716e-06,
  "network_info": 0.00799480895511806,
  "llm_extraction": 26.47893842298072,
  "data_cleaning": 3.321806434541941e-05,
  "neo4j_injection": 0.19188041100278497,
  "embedding_time": 0,
  "indexing_time": 0.005069270962849259,
  "graph_injection_time": 0.18655878398567438,
  "acs_metrics": {
    "node_count": 574,
    "relationship_count": 1551,
    "density": 0.0047,
    "avg_degree": 5.4042,
    "avg_unique_neighbors": 5.3484,
    "global_efficiency": 0.2757,
    "avg_path_length": 2.6635,
    "avg_degree_centrality": 0.0094,
    "max_degree_centrality": 0.5079,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0319,
    "degree_assortativity": -0.2023,
    "graph_robustness": 0.8491,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.279,
    "weakly_connected_components": 100,
    "largest_wcc_size": 475,
    "pagerank_top10_percent": 5.73,
    "louvain_communities": 112,
    "louvain_modularity": 0.4247,
    "label_entropy": 1.4973,
    "computational_time": 0.3227610990870744
  },
  "retrieval_queries": []
}
2025-11-30 22:04:56,801 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:04:56,801 - src.pipeline.kg_builder - INFO - Batch 69 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 26.48s, Clean: 0.00s, Neo4j: 0.19s, ACS: 0.32s
2025-11-30 22:04:56,801 - src.pipeline.kg_builder - INFO - Batch 69 completed in 27.00s
Processing KG batches:  96%|█████████▌| 69/72 [24:38<01:00, 20.09s/it]2025-11-30 22:04:56,801 - src.pipeline.kg_builder - INFO - Processing batch 70/72 (3 items)
2025-11-30 22:04:56,801 - src.pipeline.kg_builder - DEBUG - Batch 70 current_video_time: 17:22-17:27
2025-11-30 22:04:56,816 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 574
- Total Relationships: 473
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:04:56,817 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 22:04:56,817 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0 ~226 words, content: Time: 17:12-17:17 Content: The video sequence captures a scene within a laboratory, focusing on a scientific experiment in progress. The setting is a well-equipped lab...
2025-11-30 22:04:56,817 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1 ~230 words, content: are methodical and suggest a controlled experiment. - **Initial Setup:** The scene is a laboratory with a black countertop. A person wearing a blue nitrile...
2025-11-30 22:04:56,817 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_2 ~216 words, content: The camera angle changes slightly, providing a closer view of the person's hand as they adjust the flask in the beaker. The focus remains on...
2025-11-30 22:04:56,817 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_3 ~97 words, content: fully immersed. - **Final State:** The vial is now completely submerged in the liquid. The hand remains in the beaker, holding the vial in place....
2025-11-30 22:04:56,817 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:04:56,817 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0) (~226 words) with timeout=5.0s retries=3
2025-11-30 22:04:57,812 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:04:57,812 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:04:57,812 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1) (~230 words) with timeout=5.0s retries=3
2025-11-30 22:04:59,554 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:04:59,554 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:04:59,554 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_2) (~216 words) with timeout=5.0s retries=3
2025-11-30 22:05:00,724 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:05:00,724 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:05:00,724 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_3) (~97 words) with timeout=5.0s retries=3
2025-11-30 22:05:01,800 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 22:05:01,800 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 22:05:01,800 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 4 chunks
2025-11-30 22:05:01,800 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 4.98s
2025-11-30 22:05:01,800 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 22:05:01,801 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 574
- Total Relationships: 473
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0"]}, {"head": "Person", "relation": "Handles", "tail": "Container", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0"]}, {"head": "Container", "relation": "Contains", "tail": "Substance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Substance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0"]}, {"head": "Person", "relation": "Adds", "tail": "Substance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0"]}, {"head": "Beaker", "relation": "Is Part Of", "tail": "Experimental_Setup", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1"]}, {"head": "Person", "relation": "Holds", "tail": "Round_Bottom_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1"]}, {"head": "Round_Bottom_Flask", "relation": "Is Connected To", "tail": "Flexible_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1"]}, {"head": "Flexible_Tube", "relation": "Leads To", "tail": "Clear_Plastic_Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1"]}, {"head": "Clear_Plastic_Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1"]}, {"head": "Person", "relation": "Submerges", "tail": "Round_Bottom_Flask", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1"]}, {"head": "Person", "relation": "Wears", "tail": "Glove", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_2"]}, {"head": "Person", "relation": "Holds", "tail": "Vial", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_2"]}, {"head": "Vial", "relation": "Is Submerged In", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:05:01,801 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~242 words, ~315 tokens)
2025-11-30 22:05:01,801 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:05:12,997 - src.components.global_refiner - DEBUG - LLM call completed in 11.20s
2025-11-30 22:05:12,997 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Glove', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0']], ['Person', 'handles', 'Container', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0']], ['Container', 'contains', 'Substance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0']], ['Beaker', 'contains', 'Substance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0']], ['Person', 'adds', 'Substance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0']], ['Beaker', 'is_part_of', 'Experimental_Setup', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0']], ['Person', 'wears', 'Blue_Nitrile_Glove', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1']], ['Person', 'holds', 'Round_Bottom_Flask', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1']], ['Round_Bottom_Flask', 'is_connected_to', 'Flexible_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1']], ['Flexible_Tube', 'leads_to', 'Clear_Plastic_Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1']]]
2025-11-30 22:05:12,997 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Glove",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0"
    ]
  ],
  [
    "Person",
    "handles",
    "Container",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0"
    ]
  ],
  [
    "Container",
    "contains",
    "Substance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Substance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0"
    ]
  ],
  [
    "Person",
    "adds",
    "Substance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0"
    ]
  ],
  [
    "Beaker",
    "is_part_of",
    "Experimental_Setup",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Glove",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Round_Bottom_Flask",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1"
    ]
  ],
  [
    "Round_Bottom_Flask",
    "is_connected_to",
    "Flexible_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1"
    ]
  ],
  [
    "Flexible_Tube",
    "leads_to",
    "Clear_Plastic_Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_69_1"
    ]
  ]
]
2025-11-30 22:05:12,997 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 11.20s, LLM: 11.20s)
2025-11-30 22:05:12,997 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 11.20s
2025-11-30 22:05:12,997 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:05:12,998 - src.pipeline.kg_builder - INFO - Pushing batch 70/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:05:12,998 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:05:13,094 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:05:13,094 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:05:13,094 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:05:13,094 - src.components.neo4j_handler - INFO - Batch injected in 0.10s (triplets: 0.09s, indexes: 0.00s)
2025-11-30 22:05:13,096 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 316, 'with_embedding': 0, 'linked_chunks': 215}
2025-11-30 22:05:13,096 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:05:13,135 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 22:05:13,459 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 479 nodes
2025-11-30 22:05:13,490 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 580, 'relationship_count': 1568, 'density': 0.0047, 'avg_degree': 5.4069, 'avg_unique_neighbors': 5.3517, 'global_efficiency': 0.275, 'avg_path_length': 2.6607, 'avg_degree_centrality': 0.0093, 'max_degree_centrality': 0.5078, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0317, 'degree_assortativity': -0.201, 'graph_robustness': 0.8495, 'diameter_estimate': 50, 'clustering_coefficient': 0.2782, 'weakly_connected_components': 102, 'largest_wcc_size': 479, 'pagerank_top10_percent': 5.67, 'louvain_communities': 114, 'louvain_modularity': 0.4284, 'label_entropy': 1.4971, 'computational_time': 0.3938224030425772}
2025-11-30 22:05:13,490 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 69, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511513.4905431, 'total_time': 16.688935469952412, 'aggregation': 1.925043761730194e-06, 'network_info': 0.015104651101864874, 'llm_extraction': 16.181101947906427, 'data_cleaning': 2.483697608113289e-05, 'neo4j_injection': 0.09686777193564922, 'embedding_time': 0, 'indexing_time': 0.004852954996749759, 'graph_injection_time': 0.09174276806879789, 'acs_metrics': {'node_count': 580, 'relationship_count': 1568, 'density': 0.0047, 'avg_degree': 5.4069, 'avg_unique_neighbors': 5.3517, 'global_efficiency': 0.275, 'avg_path_length': 2.6607, 'avg_degree_centrality': 0.0093, 'max_degree_centrality': 0.5078, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0317, 'degree_assortativity': -0.201, 'graph_robustness': 0.8495, 'diameter_estimate': 50, 'clustering_coefficient': 0.2782, 'weakly_connected_components': 102, 'largest_wcc_size': 479, 'pagerank_top10_percent': 5.67, 'louvain_communities': 114, 'louvain_modularity': 0.4284, 'label_entropy': 1.4971, 'computational_time': 0.3938224030425772}, 'retrieval_queries': []}
2025-11-30 22:05:13,490 - src.pipeline.kg_builder - DEBUG - Batch 69 metrics: {
  "batch_idx": 69,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511513.4905431,
  "total_time": 16.688935469952412,
  "aggregation": 1.925043761730194e-06,
  "network_info": 0.015104651101864874,
  "llm_extraction": 16.181101947906427,
  "data_cleaning": 2.483697608113289e-05,
  "neo4j_injection": 0.09686777193564922,
  "embedding_time": 0,
  "indexing_time": 0.004852954996749759,
  "graph_injection_time": 0.09174276806879789,
  "acs_metrics": {
    "node_count": 580,
    "relationship_count": 1568,
    "density": 0.0047,
    "avg_degree": 5.4069,
    "avg_unique_neighbors": 5.3517,
    "global_efficiency": 0.275,
    "avg_path_length": 2.6607,
    "avg_degree_centrality": 0.0093,
    "max_degree_centrality": 0.5078,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0317,
    "degree_assortativity": -0.201,
    "graph_robustness": 0.8495,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2782,
    "weakly_connected_components": 102,
    "largest_wcc_size": 479,
    "pagerank_top10_percent": 5.67,
    "louvain_communities": 114,
    "louvain_modularity": 0.4284,
    "label_entropy": 1.4971,
    "computational_time": 0.3938224030425772
  },
  "retrieval_queries": []
}
2025-11-30 22:05:13,491 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:05:13,491 - src.pipeline.kg_builder - INFO - Batch 70 timings - Agg: 0.00s, NetInfo: 0.02s, LLM: 16.18s, Clean: 0.00s, Neo4j: 0.10s, ACS: 0.39s
2025-11-30 22:05:13,492 - src.pipeline.kg_builder - INFO - Batch 70 completed in 16.69s
Processing KG batches:  97%|█████████▋| 70/72 [24:54<00:38, 19.07s/it]2025-11-30 22:05:13,492 - src.pipeline.kg_builder - INFO - Processing batch 71/72 (3 items)
2025-11-30 22:05:13,492 - src.pipeline.kg_builder - DEBUG - Batch 71 current_video_time: 17:37-17:42
2025-11-30 22:05:13,500 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 580
- Total Relationships: 480
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:05:13,500 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 22:05:13,500 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0 ~224 words, content: Time: 17:27-17:32 Content: The sequence of frames captures a scientific experiment being conducted in a laboratory setting. The overall process involves preparing a solution and...
2025-11-30 22:05:13,501 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1 ~237 words, content: is visible inside it. The white tube is now positioned to deliver a substance into this beaker. To the left, a Mettler Toledo analytical balance...
2025-11-30 22:05:13,501 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_2 ~216 words, content: shown is a step in a larger chemical synthesis or analysis. Time: 17:32-17:37 Content: The video captures a sequence of laboratory activities, likely a chemical...
2025-11-30 22:05:13,501 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_3 ~232 words, content: the camera as it moves from the close-up of the experiment to a broader view of the lab. - **Final Scene (Frame 4):** The camera...
2025-11-30 22:05:13,501 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_4 ~234 words, content: a chemical reaction is occurring, possibly the formation of a precipitate or a phase change. - **Continuation of the Process:** In the fourth frame, the...
2025-11-30 22:05:13,501 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_5 ~22 words, content:  from clear to cloudy white. The final frame shows this experiment in the context of a larger laboratory setup with other equipment.
2025-11-30 22:05:13,501 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:05:13,501 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0) (~224 words) with timeout=5.0s retries=3
2025-11-30 22:05:14,831 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:05:14,831 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:05:14,831 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1) (~237 words) with timeout=5.0s retries=3
2025-11-30 22:05:16,088 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:05:16,088 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:05:16,089 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_2) (~216 words) with timeout=5.0s retries=3
2025-11-30 22:05:17,438 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:05:17,439 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:05:17,439 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_3) (~232 words) with timeout=5.0s retries=3
2025-11-30 22:05:18,773 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 22:05:18,773 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 22:05:18,773 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_4) (~234 words) with timeout=5.0s retries=3
2025-11-30 22:05:20,019 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 22:05:20,019 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 22:05:20,020 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_5) (~22 words) with timeout=5.0s retries=3
2025-11-30 22:05:21,171 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 22:05:21,172 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 22:05:21,172 - src.components.pre_llm_injector - INFO - Extracted 32 local triplets from 6 chunks
2025-11-30 22:05:21,172 - src.pipeline.kg_builder - INFO - Pre-extraction: 32 triplets in 7.67s
2025-11-30 22:05:21,173 - src.components.global_refiner - INFO - Capping refinement input: 32 → 15 triplets
2025-11-30 22:05:21,173 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 580
- Total Relationships: 480
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_3", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_4"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudy_Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_3"]}, {"head": "Beaker", "relation": "Placed On", "tail": "Magnetic_Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0"]}, {"head": "Magnetic_Stirrer", "relation": "Contains", "tail": "Stir_Bar", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0"]}, {"head": "Person", "relation": "Uses", "tail": "Magnetic_Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0"]}, {"head": "Beaker", "relation": "Connected To", "tail": "White_Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Solution", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1"]}, {"head": "Magnetic Stirrer", "relation": "Controls", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1"]}, {"head": "White Tube", "relation": "Delivers", "tail": "Substance", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1"]}, {"head": "Analytical Balance", "relation": "Measures", "tail": "Chemicals", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1"]}, {"head": "Pipette", "relation": "Rests On", "tail": "Lab Table", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1"]}, {"head": "Solution", "relation": "Is Stirred By", "tail": "Magnetic Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_2", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_4"]}, {"head": "Beaker", "relation": "Contains", "tail": "Magnetic_Stir_Bar", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Rod", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:05:21,173 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~249 words, ~324 tokens)
2025-11-30 22:05:21,173 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:05:34,834 - src.components.global_refiner - DEBUG - LLM call completed in 13.66s
2025-11-30 22:05:34,834 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'holds', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_3', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_4']], ['Beaker', 'contains', 'Cloudy_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_3']], ['Beaker', 'placed_on', 'Magnetic_Stirrer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0']], ['Magnetic_Stirrer', 'contains', 'Stir_Bar', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0']], ['Person', 'uses', 'Magnetic_Stirrer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0']], ['Beaker', 'connected_to', 'White_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0']], ['Beaker', 'contains', 'Solution', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1']], ['Magnetic_Stirrer', 'controls', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1']], ['White_Tube', 'delivers', 'Substance', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1']], ['Analytical_Balance', 'measures', 'Chemicals', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1']]]
2025-11-30 22:05:34,835 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "holds",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_3",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_4"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Cloudy_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_3"
    ]
  ],
  [
    "Beaker",
    "placed_on",
    "Magnetic_Stirrer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "contains",
    "Stir_Bar",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Magnetic_Stirrer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0"
    ]
  ],
  [
    "Beaker",
    "connected_to",
    "White_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Solution",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "controls",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1"
    ]
  ],
  [
    "White_Tube",
    "delivers",
    "Substance",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1"
    ]
  ],
  [
    "Analytical_Balance",
    "measures",
    "Chemicals",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_70_1"
    ]
  ]
]
2025-11-30 22:05:34,835 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 13.66s, LLM: 13.66s)
2025-11-30 22:05:34,835 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 13.66s
2025-11-30 22:05:34,835 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:05:34,835 - src.pipeline.kg_builder - INFO - Pushing batch 71/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:05:34,835 - src.components.neo4j_handler - INFO - Adding 10 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 22:05:34,947 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:05:34,947 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:05:34,948 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:05:34,948 - src.components.neo4j_handler - INFO - Batch injected in 0.11s (triplets: 0.11s, indexes: 0.00s)
2025-11-30 22:05:34,949 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 322, 'with_embedding': 0, 'linked_chunks': 219}
2025-11-30 22:05:34,949 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:05:34,992 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 22:05:35,262 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 485 nodes
2025-11-30 22:05:35,293 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 588, 'relationship_count': 1591, 'density': 0.0046, 'avg_degree': 5.4116, 'avg_unique_neighbors': 5.3571, 'global_efficiency': 0.2738, 'avg_path_length': 2.659, 'avg_degree_centrality': 0.0092, 'max_degree_centrality': 0.506, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0443, 'degree_assortativity': -0.2016, 'graph_robustness': 0.8504, 'diameter_estimate': 50, 'clustering_coefficient': 0.2773, 'weakly_connected_components': 104, 'largest_wcc_size': 485, 'pagerank_top10_percent': 5.6, 'louvain_communities': 118, 'louvain_modularity': 0.4277, 'label_entropy': 1.4967, 'computational_time': 0.34409152704756707}
2025-11-30 22:05:35,293 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 70, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511535.2938466, 'total_time': 21.80173965904396, 'aggregation': 3.264984115958214e-06, 'network_info': 0.008196089998818934, 'llm_extraction': 21.334702746011317, 'data_cleaning': 1.7003039829432964e-05, 'neo4j_injection': 0.1129378880141303, 'embedding_time': 0, 'indexing_time': 0.003373980987817049, 'graph_injection_time': 0.10936307697556913, 'acs_metrics': {'node_count': 588, 'relationship_count': 1591, 'density': 0.0046, 'avg_degree': 5.4116, 'avg_unique_neighbors': 5.3571, 'global_efficiency': 0.2738, 'avg_path_length': 2.659, 'avg_degree_centrality': 0.0092, 'max_degree_centrality': 0.506, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0443, 'degree_assortativity': -0.2016, 'graph_robustness': 0.8504, 'diameter_estimate': 50, 'clustering_coefficient': 0.2773, 'weakly_connected_components': 104, 'largest_wcc_size': 485, 'pagerank_top10_percent': 5.6, 'louvain_communities': 118, 'louvain_modularity': 0.4277, 'label_entropy': 1.4967, 'computational_time': 0.34409152704756707}, 'retrieval_queries': []}
2025-11-30 22:05:35,293 - src.pipeline.kg_builder - DEBUG - Batch 70 metrics: {
  "batch_idx": 70,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511535.2938466,
  "total_time": 21.80173965904396,
  "aggregation": 3.264984115958214e-06,
  "network_info": 0.008196089998818934,
  "llm_extraction": 21.334702746011317,
  "data_cleaning": 1.7003039829432964e-05,
  "neo4j_injection": 0.1129378880141303,
  "embedding_time": 0,
  "indexing_time": 0.003373980987817049,
  "graph_injection_time": 0.10936307697556913,
  "acs_metrics": {
    "node_count": 588,
    "relationship_count": 1591,
    "density": 0.0046,
    "avg_degree": 5.4116,
    "avg_unique_neighbors": 5.3571,
    "global_efficiency": 0.2738,
    "avg_path_length": 2.659,
    "avg_degree_centrality": 0.0092,
    "max_degree_centrality": 0.506,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0443,
    "degree_assortativity": -0.2016,
    "graph_robustness": 0.8504,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2773,
    "weakly_connected_components": 104,
    "largest_wcc_size": 485,
    "pagerank_top10_percent": 5.6,
    "louvain_communities": 118,
    "louvain_modularity": 0.4277,
    "label_entropy": 1.4967,
    "computational_time": 0.34409152704756707
  },
  "retrieval_queries": []
}
2025-11-30 22:05:35,295 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:05:35,295 - src.pipeline.kg_builder - INFO - Batch 71 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 21.33s, Clean: 0.00s, Neo4j: 0.11s, ACS: 0.34s
2025-11-30 22:05:35,295 - src.pipeline.kg_builder - INFO - Batch 71 completed in 21.80s
Processing KG batches:  99%|█████████▊| 71/72 [25:16<00:19, 19.89s/it]2025-11-30 22:05:35,295 - src.pipeline.kg_builder - INFO - Processing batch 72/72 (2 items)
2025-11-30 22:05:35,295 - src.pipeline.kg_builder - DEBUG - Batch 72 current_video_time: 17:47-17:52
2025-11-30 22:05:35,307 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 588
- Total Relationships: 489
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.

2025-11-30 22:05:35,307 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 22:05:35,307 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0 ~228 words, content: Time: 17:42-17:47 Content: The video sequence captures a scientific experiment taking place in a laboratory setting. The scene is set on a black laboratory bench,...
2025-11-30 22:05:35,307 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1 ~229 words, content: of the Process (Frame 4):** The camera angle changes slightly, but the focus remains on the beaker with the cloudy liquid. The person's hand continues...
2025-11-30 22:05:35,307 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_2 ~226 words, content: actively mixing a liquid in a glass beaker, which is held in place by a clamp. To the right, a blue stand holds a magnetic...
2025-11-30 22:05:35,307 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_3 ~157 words, content: seen extending over the stirrer, and the clamp holding the beaker is visible. The blue stand with the magnetic stir bar is in the foreground....
2025-11-30 22:05:35,307 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-30 22:05:35,307 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0) (~228 words) with timeout=5.0s retries=3
2025-11-30 22:05:36,568 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 22:05:36,568 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 22:05:36,568 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1) (~229 words) with timeout=5.0s retries=3
2025-11-30 22:05:37,837 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 22:05:37,837 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 22:05:37,838 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_2) (~226 words) with timeout=5.0s retries=3
2025-11-30 22:05:39,166 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 22:05:39,166 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 22:05:39,166 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_3) (~157 words) with timeout=5.0s retries=3
2025-11-30 22:05:40,249 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 22:05:40,249 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 22:05:40,249 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 4 chunks
2025-11-30 22:05:40,249 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 4.94s
2025-11-30 22:05:40,250 - src.components.global_refiner - INFO - Capping refinement input: 22 → 15 triplets
2025-11-30 22:05:40,250 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 588
- Total Relationships: 489
- Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Beaker", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudy Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1", "93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_2"]}, {"head": "Person", "relation": "Holds", "tail": "Flexible Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0"]}, {"head": "Flexible Tube", "relation": "Is Inserted Into", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0"]}, {"head": "Beaker", "relation": "Is Part Of", "tail": "Scientific Experiment", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0"]}, {"head": "Laboratory Bench", "relation": "Contains", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0"]}, {"head": "Person", "relation": "Holds", "tail": "Tube", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1"]}, {"head": "Magnetic Stirrer", "relation": "Is On", "tail": "Lab Table", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "High-Voltage Warning Sign", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1"]}, {"head": "Tube", "relation": "Is Connected To", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_2"]}, {"head": "Person", "relation": "Submerges", "tail": "Rectangular Device", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_2"]}, {"head": "Rectangular Device", "relation": "Is Submerged In", "tail": "Cloudy Liquid", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_2"]}, {"head": "Magnetic Stirrer", "relation": "Holds", "tail": "Beaker", "source_chunks": ["93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 10 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-30 22:05:40,250 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~265 words, ~344 tokens)
2025-11-30 22:05:40,250 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-30 22:05:54,025 - src.components.global_refiner - DEBUG - LLM call completed in 13.78s
2025-11-30 22:05:54,025 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Beaker', 'is_on', 'Magnetic_Stirrer', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1']], ['Beaker', 'contains', 'Cloudy_Liquid', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1', '93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_2']], ['Person', 'holds', 'Flexible_Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0']], ['Flexible_Tube', 'is_inserted_into', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0']], ['Beaker', 'is_part_of', 'Scientific_Experiment', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0']], ['Laboratory_Bench', 'contains', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0']], ['Person', 'holds', 'Tube', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1']], ['Tube', 'is_connected_to', 'Beaker', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1']], ['Magnetic_Stirrer', 'is_on', 'Lab_Table', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1']], ['Lab_Environment', 'contains', 'High_Voltage_Warning_Sign', ['93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1']]]
2025-11-30 22:05:54,026 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Beaker",
    "is_on",
    "Magnetic_Stirrer",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Cloudy_Liquid",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1",
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Flexible_Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0"
    ]
  ],
  [
    "Flexible_Tube",
    "is_inserted_into",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0"
    ]
  ],
  [
    "Beaker",
    "is_part_of",
    "Scientific_Experiment",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Tube",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1"
    ]
  ],
  [
    "Tube",
    "is_connected_to",
    "Beaker",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "is_on",
    "Lab_Table",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1"
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "High_Voltage_Warning_Sign",
    [
      "93e9c82e-95d6-4864-8ac1-2ae70edfd961_71_1"
    ]
  ]
]
2025-11-30 22:05:54,026 - src.components.global_refiner - INFO - Refinement complete: 15 → 10 triplets (total: 13.78s, LLM: 13.78s)
2025-11-30 22:05:54,026 - src.pipeline.kg_builder - INFO - Global refinement: 10 triplets in 13.78s
2025-11-30 22:05:54,026 - src.pipeline.kg_builder - INFO - Using 10 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 22:05:54,026 - src.pipeline.kg_builder - INFO - Pushing batch 72/72 to graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:05:54,026 - src.components.neo4j_handler - INFO - Adding 10 triplets + 2 chunks to graph (hybrid mode)
2025-11-30 22:05:54,174 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 22:05:54,174 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 22:05:54,175 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 22:05:54,175 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.14s, indexes: 0.00s)
2025-11-30 22:05:54,177 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 326, 'with_embedding': 0, 'linked_chunks': 222}
2025-11-30 22:05:54,177 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 22:05:54,216 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 22:05:54,498 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 490 nodes
2025-11-30 22:05:54,530 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 594, 'relationship_count': 1613, 'density': 0.0046, 'avg_degree': 5.431, 'avg_unique_neighbors': 5.3771, 'global_efficiency': 0.2778, 'avg_path_length': 2.6567, 'avg_degree_centrality': 0.0092, 'max_degree_centrality': 0.5042, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0483, 'degree_assortativity': -0.2012, 'graph_robustness': 0.8462, 'diameter_estimate': 50, 'clustering_coefficient': 0.2766, 'weakly_connected_components': 105, 'largest_wcc_size': 490, 'pagerank_top10_percent': 5.54, 'louvain_communities': 117, 'louvain_modularity': 0.4269, 'label_entropy': 1.4966, 'computational_time': 0.35332584206480533}
2025-11-30 22:05:54,530 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 71, 'run_uuid': '93e9c82e-95d6-4864-8ac1-2ae70edfd961', 'timestamp': 1764511554.5306442, 'total_time': 19.235336638987064, 'aggregation': 2.2300519049167633e-06, 'network_info': 0.011707257013767958, 'llm_extraction': 18.71913125005085, 'data_cleaning': 2.2414023987948895e-05, 'neo4j_injection': 0.14887526305392385, 'embedding_time': 0, 'indexing_time': 0.004399879020638764, 'graph_injection_time': 0.14424145000521094, 'acs_metrics': {'node_count': 594, 'relationship_count': 1613, 'density': 0.0046, 'avg_degree': 5.431, 'avg_unique_neighbors': 5.3771, 'global_efficiency': 0.2778, 'avg_path_length': 2.6567, 'avg_degree_centrality': 0.0092, 'max_degree_centrality': 0.5042, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0483, 'degree_assortativity': -0.2012, 'graph_robustness': 0.8462, 'diameter_estimate': 50, 'clustering_coefficient': 0.2766, 'weakly_connected_components': 105, 'largest_wcc_size': 490, 'pagerank_top10_percent': 5.54, 'louvain_communities': 117, 'louvain_modularity': 0.4269, 'label_entropy': 1.4966, 'computational_time': 0.35332584206480533}, 'retrieval_queries': []}
2025-11-30 22:05:54,530 - src.pipeline.kg_builder - DEBUG - Batch 71 metrics: {
  "batch_idx": 71,
  "run_uuid": "93e9c82e-95d6-4864-8ac1-2ae70edfd961",
  "timestamp": 1764511554.5306442,
  "total_time": 19.235336638987064,
  "aggregation": 2.2300519049167633e-06,
  "network_info": 0.011707257013767958,
  "llm_extraction": 18.71913125005085,
  "data_cleaning": 2.2414023987948895e-05,
  "neo4j_injection": 0.14887526305392385,
  "embedding_time": 0,
  "indexing_time": 0.004399879020638764,
  "graph_injection_time": 0.14424145000521094,
  "acs_metrics": {
    "node_count": 594,
    "relationship_count": 1613,
    "density": 0.0046,
    "avg_degree": 5.431,
    "avg_unique_neighbors": 5.3771,
    "global_efficiency": 0.2778,
    "avg_path_length": 2.6567,
    "avg_degree_centrality": 0.0092,
    "max_degree_centrality": 0.5042,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0483,
    "degree_assortativity": -0.2012,
    "graph_robustness": 0.8462,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2766,
    "weakly_connected_components": 105,
    "largest_wcc_size": 490,
    "pagerank_top10_percent": 5.54,
    "louvain_communities": 117,
    "louvain_modularity": 0.4269,
    "label_entropy": 1.4966,
    "computational_time": 0.35332584206480533
  },
  "retrieval_queries": []
}
2025-11-30 22:05:54,532 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/93e9c82e-95d6-4864-8ac1-2ae70edfd961_batch_metrics_kg.json
2025-11-30 22:05:54,532 - src.pipeline.kg_builder - INFO - Batch 72 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 18.72s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.35s
2025-11-30 22:05:54,532 - src.pipeline.kg_builder - INFO - Batch 72 completed in 19.24s
Processing KG batches: 100%|██████████| 72/72 [25:35<00:00, 19.69s/it]2025-11-30 22:05:54,533 - src.core.metrics - INFO - Metrics saved to: metrics/kg_93e9c82e-95d6-4864-8ac1-2ae70edfd961.json
2025-11-30 22:05:54,533 - src.pipeline.kg_builder - INFO - Knowledge graph construction completed successfully!
2025-11-30 22:05:54,533 - src.pipeline.kg_builder - INFO - Graph UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
2025-11-30 22:05:54,533 - src.pipeline.kg_builder - INFO - Total batches processed: 72
2025-11-30 22:05:54,533 - src.pipeline.kg_builder - INFO - Hierarchical extraction enabled: chunk_size=296, parallel=2
Processing KG batches: 100%|██████████| 72/72 [25:35<00:00, 21.33s/it]
2025-11-30 22:05:54,534 - __main__ - INFO - Knowledge graph construction completed with UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
Knowledge graph construction completed with UUID: 93e9c82e-95d6-4864-8ac1-2ae70edfd961
