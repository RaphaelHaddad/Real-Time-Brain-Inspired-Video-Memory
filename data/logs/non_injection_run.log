2025-11-24 14:28:02,092 - __main__ - INFO - Loading configuration from: config/base_config.yaml
2025-11-24 14:28:02,094 - __main__ - INFO - Building knowledge graph from: data/outputs/vlm_output.json
2025-11-24 14:28:02,187 - src.components.neo4j_handler - INFO - Initialized Neo4j handler for run UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:28:02,209 - src.components.llm_injector - INFO - Initialized LLMInjector (chunking: True)
2025-11-24 14:28:02,323 - src.components.pre_llm_injector - INFO - Initialized PreLLMInjector: chunk_size=296, overlap=16, parallel=2, max_triplets_per_chunk=6, subgraph_extraction=False
2025-11-24 14:28:02,324 - src.components.global_refiner - INFO - Initialized GlobalRefiner with max_tokens=2000
2025-11-24 14:28:02,324 - src.pipeline.kg_builder - INFO - Initialized KG Builder with run UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63 (hierarchical extraction: True)
2025-11-24 14:28:02,325 - src.pipeline.kg_builder - INFO - Starting knowledge graph construction from: data/outputs/vlm_output.json
2025-11-24 14:28:02,325 - src.pipeline.kg_builder - INFO - Reset logs directory: /home/viture-ai/Documents/Real-Time-Brain-Inspired-Video-Memory/logs
Processing KG batches:   0%|          | 0/72 [00:00<?, ?it/s]2025-11-24 14:28:02,327 - src.pipeline.kg_builder - INFO - Processing batch 1/72 (3 items)
2025-11-24 14:28:02,327 - src.pipeline.kg_builder - DEBUG - Batch 1 current_video_time: 00:09-00:14
2025-11-24 14:28:02,378 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 0
- Total Relationships: 0
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:28:02,379 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 14:28:02,379 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_0 ~221 words, content: Time: 00:00-00:04 Content: The video sequence captures a scene within a laboratory environment, focusing on a person and their interaction with the surroundings. - **Initial...
2025-11-24 14:28:02,379 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_1 ~237 words, content: , looking directly at it. They are still holding the smartphone. The laboratory setting remains consistent, with the glass cabinet, the door, and the equipment...
2025-11-24 14:28:02,379 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_2 ~196 words, content: up as if to show it. - In the final frame, the man is still holding the paper and looking at the camera. The man...
2025-11-24 14:28:02,379 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_3 ~181 words, content: This indicates the document is a report for a chemistry experiment, possibly using augmented reality technology. The person holding the paper is wearing a blue...
2025-11-24 14:28:02,380 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:28:02,380 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_0) (~221 words) with timeout=5.0s retries=3
2025-11-24 14:28:03,515 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:28:03,515 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:28:03,516 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_1) (~237 words) with timeout=5.0s retries=3
2025-11-24 14:28:04,528 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:28:04,529 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:28:04,529 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_2) (~196 words) with timeout=5.0s retries=3
2025-11-24 14:28:05,787 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:28:05,788 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:28:05,788 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_3) (~181 words) with timeout=5.0s retries=3
2025-11-24 14:28:06,800 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:28:06,801 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:28:06,801 - src.components.pre_llm_injector - INFO - Extracted 21 local triplets from 4 chunks
2025-11-24 14:28:06,801 - src.pipeline.kg_builder - INFO - Pre-extraction: 21 triplets in 4.42s
2025-11-24 14:28:06,801 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 0
- Total Relationships: 0
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Cream-Colored Sweater", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_0"]}, {"head": "Person", "relation": "Holds", "tail": "Smartphone", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_1"]}, {"head": "Person", "relation": "Stands Near", "tail": "Laboratory Table", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_0"]}, {"head": "Laboratory Table", "relation": "Contains", "tail": "Precision Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_0"]}, {"head": "Laboratory Table", "relation": "Contains", "tail": "Red-Capped Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_0"]}, {"head": "Person", "relation": "Looks At", "tail": "Smartphone", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_0"]}, {"head": "Person", "relation": "Stands In", "tail": "Laboratory", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_2"]}, {"head": "Person", "relation": "Interacts With", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Glass Cabinet", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Balance Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_1"]}, {"head": "Person", "relation": "Looks At", "tail": "Camera", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_2"]}, {"head": "Person", "relation": "Holds", "tail": "Document", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_2"]}, {"head": "Document", "relation": "Has Title", "tail": "Ar Glasses Training Chemistry Experiment Report (Simplified Version)", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "White Cabinets", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Black Countertop", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_2"]}, {"head": "Document", "relation": "Is On", "tail": "Lab Table", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_3"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_3"]}, {"head": "Person", "relation": "Stands", "tail": "Lab Table", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_3"]}, {"head": "Person", "relation": "Has", "tail": "Arms Crossed", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_3"]}, {"head": "Person", "relation": "Observes", "tail": "Document", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_3"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Document", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_0_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:28:06,802 - src.components.global_refiner - DEBUG - Refining 21 triplets (prompt ~315 words, ~410 tokens)
2025-11-24 14:28:06,802 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:28:14,278 - src.components.global_refiner - DEBUG - LLM call completed in 7.48s
2025-11-24 14:28:14,278 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Cream-Colored Sweater', [0]], ['Person', 'holds', 'Smartphone', [0, 1]], ['Person', 'stands_near', 'Laboratory Table', [0]], ['Laboratory Table', 'contains', 'Precision Balance', [0]], ['Laboratory Table', 'contains', 'Red-Capped Bottle', [0]], ['Person', 'looks_at', 'Smartphone', [0]], ['Person', 'stands_in', 'Laboratory', [1, 2]], ['Person', 'interacts_with', 'Equipment', [1]], ['Laboratory', 'contains', 'Glass Cabinet', [1]], ['Laboratory', 'contains', 'Balance Scale', [1]], ['Person', 'looks_at', 'Camera', [1, 2]], ['Person', 'holds', 'Document', [2]], ['Document', 'has_title', 'Ar Glasses Training Chemistry Experiment Report (Simplified Version)', [2]], ['Laboratory', 'contains', 'White Cabinets', [2]], ['Laboratory', 'contains', 'Black Countertop', [2]], ['Document', 'is_on', 'Lab Table', [3]], ['Person', 'wears', 'Blue Glove', [3]], ['Person', 'stands', 'Lab Table', [3]], ['Person', 'has', 'Arms Crossed', [3]], ['Person', 'observes', 'Document', [3]], ['Lab Table', 'contains', 'Document', [3]]]
2025-11-24 14:28:14,278 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Cream-Colored Sweater",
    [
      0
    ]
  ],
  [
    "Person",
    "holds",
    "Smartphone",
    [
      0,
      1
    ]
  ],
  [
    "Person",
    "stands_near",
    "Laboratory Table",
    [
      0
    ]
  ],
  [
    "Laboratory Table",
    "contains",
    "Precision Balance",
    [
      0
    ]
  ],
  [
    "Laboratory Table",
    "contains",
    "Red-Capped Bottle",
    [
      0
    ]
  ],
  [
    "Person",
    "looks_at",
    "Smartphone",
    [
      0
    ]
  ],
  [
    "Person",
    "stands_in",
    "Laboratory",
    [
      1,
      2
    ]
  ],
  [
    "Person",
    "interacts_with",
    "Equipment",
    [
      1
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Glass Cabinet",
    [
      1
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Balance Scale",
    [
      1
    ]
  ],
  [
    "Person",
    "looks_at",
    "Camera",
    [
      1,
      2
    ]
  ],
  [
    "Person",
    "holds",
    "Document",
    [
      2
    ]
  ],
  [
    "Document",
    "has_title",
    "Ar Glasses Training Chemistry Experiment Report (Simplified Version)",
    [
      2
    ]
  ],
  [
    "Laboratory",
    "contains",
    "White Cabinets",
    [
      2
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Black Countertop",
    [
      2
    ]
  ],
  [
    "Document",
    "is_on",
    "Lab Table",
    [
      3
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Glove",
    [
      3
    ]
  ],
  [
    "Person",
    "stands",
    "Lab Table",
    [
      3
    ]
  ],
  [
    "Person",
    "has",
    "Arms Crossed",
    [
      3
    ]
  ],
  [
    "Person",
    "observes",
    "Document",
    [
      3
    ]
  ],
  [
    "Lab Table",
    "contains",
    "Document",
    [
      3
    ]
  ]
]
2025-11-24 14:28:14,278 - src.components.global_refiner - INFO - Refinement complete: 21 → 21 triplets (total: 7.48s, LLM: 7.48s)
2025-11-24 14:28:14,278 - src.pipeline.kg_builder - INFO - Global refinement: 21 triplets in 7.48s
2025-11-24 14:28:14,279 - src.pipeline.kg_builder - INFO - Using 21 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:28:14,279 - src.pipeline.kg_builder - INFO - Pushing batch 1/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:28:14,279 - src.components.neo4j_handler - INFO - Adding 21 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:28:14,448 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:28:14,448 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:28:14,448 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:28:14,448 - src.components.neo4j_handler - INFO - Batch injected in 0.17s (triplets: 0.17s, indexes: 0.00s)
2025-11-24 14:28:14,448 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:28:14,450 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 22 nodes
2025-11-24 14:28:14,451 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 18 nodes
2025-11-24 14:28:14,456 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 22, 'relationship_count': 19, 'density': 0.0411, 'avg_degree': 1.7273, 'avg_unique_neighbors': 1.6364, 'global_efficiency': 0.3102, 'avg_path_length': 2.4706, 'avg_degree_centrality': 0.0823, 'max_degree_centrality': 0.4762, 'avg_betweenness_centrality': 0.0009, 'max_betweenness_centrality': 0.0095, 'degree_assortativity': -0.116, 'graph_robustness': 0.8421, 'diameter_estimate': 4, 'clustering_coefficient': 0.0328, 'weakly_connected_components': 5, 'largest_wcc_size': 18, 'pagerank_top10_percent': 57.19, 'louvain_communities': 8, 'louvain_modularity': 0.4707, 'label_entropy': 1.342, 'computational_time': 0.007655802008230239}
2025-11-24 14:28:14,456 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 0, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763965694.4562924, 'total_time': 12.128373485000338, 'aggregation': 3.202003426849842e-06, 'network_info': 0.050661907996982336, 'llm_extraction': 11.900271063030232, 'data_cleaning': 2.6713998522609472e-05, 'neo4j_injection': 0.16946133598685265, 'embedding_time': 0, 'indexing_time': 0.001582273980602622, 'graph_injection_time': 0.16773442400153726, 'acs_metrics': {'node_count': 22, 'relationship_count': 19, 'density': 0.0411, 'avg_degree': 1.7273, 'avg_unique_neighbors': 1.6364, 'global_efficiency': 0.3102, 'avg_path_length': 2.4706, 'avg_degree_centrality': 0.0823, 'max_degree_centrality': 0.4762, 'avg_betweenness_centrality': 0.0009, 'max_betweenness_centrality': 0.0095, 'degree_assortativity': -0.116, 'graph_robustness': 0.8421, 'diameter_estimate': 4, 'clustering_coefficient': 0.0328, 'weakly_connected_components': 5, 'largest_wcc_size': 18, 'pagerank_top10_percent': 57.19, 'louvain_communities': 8, 'louvain_modularity': 0.4707, 'label_entropy': 1.342, 'computational_time': 0.007655802008230239}, 'retrieval_queries': []}
2025-11-24 14:28:14,456 - src.pipeline.kg_builder - DEBUG - Batch 0 metrics: {
  "batch_idx": 0,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763965694.4562924,
  "total_time": 12.128373485000338,
  "aggregation": 3.202003426849842e-06,
  "network_info": 0.050661907996982336,
  "llm_extraction": 11.900271063030232,
  "data_cleaning": 2.6713998522609472e-05,
  "neo4j_injection": 0.16946133598685265,
  "embedding_time": 0,
  "indexing_time": 0.001582273980602622,
  "graph_injection_time": 0.16773442400153726,
  "acs_metrics": {
    "node_count": 22,
    "relationship_count": 19,
    "density": 0.0411,
    "avg_degree": 1.7273,
    "avg_unique_neighbors": 1.6364,
    "global_efficiency": 0.3102,
    "avg_path_length": 2.4706,
    "avg_degree_centrality": 0.0823,
    "max_degree_centrality": 0.4762,
    "avg_betweenness_centrality": 0.0009,
    "max_betweenness_centrality": 0.0095,
    "degree_assortativity": -0.116,
    "graph_robustness": 0.8421,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.0328,
    "weakly_connected_components": 5,
    "largest_wcc_size": 18,
    "pagerank_top10_percent": 57.19,
    "louvain_communities": 8,
    "louvain_modularity": 0.4707,
    "label_entropy": 1.342,
    "computational_time": 0.007655802008230239
  },
  "retrieval_queries": []
}
2025-11-24 14:28:14,456 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:28:14,456 - src.pipeline.kg_builder - INFO - Batch 1 timings - Agg: 0.00s, NetInfo: 0.05s, LLM: 11.90s, Clean: 0.00s, Neo4j: 0.17s, ACS: 0.01s
2025-11-24 14:28:14,456 - src.pipeline.kg_builder - INFO - Batch 1 completed in 12.13s
Processing KG batches:   1%|▏         | 1/72 [00:12<14:21, 12.13s/it]2025-11-24 14:28:14,456 - src.pipeline.kg_builder - INFO - Processing batch 2/72 (3 items)
2025-11-24 14:28:14,456 - src.pipeline.kg_builder - DEBUG - Batch 2 current_video_time: 00:24-00:29
2025-11-24 14:28:14,462 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 22
- Total Relationships: 21
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:28:14,462 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:28:14,462 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0 ~221 words, content: Time: 00:14-00:19 Content: The video sequence captures a scene within a laboratory or research facility, focusing on a person and their surroundings. The camera's movement...
2025-11-24 14:28:14,462 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1 ~200 words, content: , possibly a balance or a sample holder. The background shows more of the lab's white cabinetry and a stack of cardboard boxes. The overall...
2025-11-24 14:28:14,462 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2 ~195 words, content: and components, including a syringe, a small container, and a pen. To the left, a tall, white, glass-fronted cabinet is open, revealing shelves stocked with...
2025-11-24 14:28:14,462 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3 ~215 words, content: 学实验报告 (简版)" (AR Glasses Training Chemistry Experiment Report (Brief Version)). This document appears to be a guide for the experiment, which involves the synthesis of...
2025-11-24 14:28:14,462 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_4 ~91 words, content: data. The use of AR glasses suggests that the experiment is being conducted as part of a training program, where the user can see instructions...
2025-11-24 14:28:14,462 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:28:14,463 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0) (~221 words) with timeout=5.0s retries=3
2025-11-24 14:28:17,609 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:28:17,610 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:28:17,610 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1) (~200 words) with timeout=5.0s retries=3
2025-11-24 14:28:18,741 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:28:18,742 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:28:18,742 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2) (~195 words) with timeout=5.0s retries=3
2025-11-24 14:28:23,748 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 1/4), retrying...
2025-11-24 14:28:29,255 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 2/4), retrying...
2025-11-24 14:28:35,262 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 3/4), retrying...
2025-11-24 14:28:40,458 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 4)
2025-11-24 14:28:40,459 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:28:40,459 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3) (~215 words) with timeout=5.0s retries=3
2025-11-24 14:28:41,688 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:28:41,689 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:28:41,689 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_4) (~91 words) with timeout=5.0s retries=3
2025-11-24 14:28:42,644 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:28:42,644 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:28:42,644 - src.components.pre_llm_injector - INFO - Extracted 29 local triplets from 5 chunks
2025-11-24 14:28:42,644 - src.pipeline.kg_builder - INFO - Pre-extraction: 29 triplets in 28.18s
2025-11-24 14:28:42,645 - src.components.global_refiner - INFO - Capping refinement input: 29 → 25 triplets
2025-11-24 14:28:42,645 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 22
- Total Relationships: 21
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Turtleneck_Sweater", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0"]}, {"head": "Person", "relation": "Wears", "tail": "Jeans", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0"]}, {"head": "Person", "relation": "Stands", "tail": "In_Laboratory", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0"]}, {"head": "Person", "relation": "Has", "tail": "Crossed_Arms", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0"]}, {"head": "Camera", "relation": "Pans", "tail": "To_The_Right", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0"]}, {"head": "Countertop", "relation": "Contains", "tail": "White_Bottle_With_Red_Cap", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0"]}, {"head": "Person", "relation": "Stands In", "tail": "Laboratory", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Workbench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1"]}, {"head": "Workbench", "relation": "Holds", "tail": "Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1"]}, {"head": "Workbench", "relation": "Holds", "tail": "Paper", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1"]}, {"head": "Workbench", "relation": "Holds", "tail": "Apparatus", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1"]}, {"head": "Apparatus", "relation": "Is Type Of", "tail": "Reaction_Chamber", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1"]}, {"head": "Syringe", "relation": "Is Part Of", "tail": "Components", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2"]}, {"head": "Small Container", "relation": "Is Part Of", "tail": "Components", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2"]}, {"head": "Pen", "relation": "Is Part Of", "tail": "Components", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2"]}, {"head": "Cabinet", "relation": "Contains", "tail": "Bottles", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2"]}, {"head": "Cabinet", "relation": "Contains", "tail": "Containers", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2"]}, {"head": "Cabinet", "relation": "Contains", "tail": "Lab Materials", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2"]}, {"head": "Person", "relation": "Uses", "tail": "Ar Glasses", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_4"]}, {"head": "Person", "relation": "Holds", "tail": "White Pen", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3"]}, {"head": "White Pen", "relation": "Writes On", "tail": "Experiment Report", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3"]}, {"head": "Electronic Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3"]}, {"head": "Aluminum Foil", "relation": "Is Reactant In", "tail": "Hydrogen Gas Synthesis", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3"]}, {"head": "Test Tube", "relation": "Contains", "tail": "Chemical Reagent", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3"]}, {"head": "Person", "relation": "Conducts", "tail": "Chemistry Experiment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:28:42,645 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~341 words, ~443 tokens)
2025-11-24 14:28:42,645 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:29:10,653 - src.components.global_refiner - DEBUG - LLM call completed in 28.01s
2025-11-24 14:29:10,653 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Turtleneck_Sweater', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0']], ['Person', 'wears', 'Jeans', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0']], ['Person', 'stands_in', 'Laboratory', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1']], ['Person', 'has', 'Crossed_Arms', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0']], ['Camera', 'pans', 'To_The_Right', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0']], ['Countertop', 'contains', 'White_Bottle_With_Red_Cap', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0']], ['Laboratory', 'contains', 'Workbench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1']], ['Workbench', 'holds', 'Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1']], ['Workbench', 'holds', 'Paper', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1']], ['Workbench', 'holds', 'Apparatus', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1']], ['Apparatus', 'is_type_of', 'Reaction_Chamber', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1']], ['Syringe', 'is_part_of', 'Components', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2']], ['Small_Container', 'is_part_of', 'Components', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2']], ['Pen', 'is_part_of', 'Components', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2']], ['Cabinet', 'contains', 'Bottles', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2']], ['Cabinet', 'contains', 'Containers', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2']], ['Cabinet', 'contains', 'Lab_Materials', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2']], ['Person', 'uses', 'Ar_Glasses', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_4']], ['Person', 'holds', 'White_Pen', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3']], ['White_Pen', 'writes_on', 'Experiment_Report', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3']], ['Electronic_Balance', 'measures', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3']], ['Aluminum_Foil', 'is_reactant_in', 'Hydrogen_Gas_Synthesis', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3']], ['Test_Tube', 'contains', 'Chemical_Reagent', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3']], ['Person', 'conducts', 'Chemistry_Experiment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_4']]]
2025-11-24 14:29:10,653 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Turtleneck_Sweater",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Jeans",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0"
    ]
  ],
  [
    "Person",
    "stands_in",
    "Laboratory",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1"
    ]
  ],
  [
    "Person",
    "has",
    "Crossed_Arms",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0"
    ]
  ],
  [
    "Camera",
    "pans",
    "To_The_Right",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0"
    ]
  ],
  [
    "Countertop",
    "contains",
    "White_Bottle_With_Red_Cap",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_0"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Workbench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1"
    ]
  ],
  [
    "Workbench",
    "holds",
    "Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1"
    ]
  ],
  [
    "Workbench",
    "holds",
    "Paper",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1"
    ]
  ],
  [
    "Workbench",
    "holds",
    "Apparatus",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1"
    ]
  ],
  [
    "Apparatus",
    "is_type_of",
    "Reaction_Chamber",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_1"
    ]
  ],
  [
    "Syringe",
    "is_part_of",
    "Components",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2"
    ]
  ],
  [
    "Small_Container",
    "is_part_of",
    "Components",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2"
    ]
  ],
  [
    "Pen",
    "is_part_of",
    "Components",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2"
    ]
  ],
  [
    "Cabinet",
    "contains",
    "Bottles",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2"
    ]
  ],
  [
    "Cabinet",
    "contains",
    "Containers",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2"
    ]
  ],
  [
    "Cabinet",
    "contains",
    "Lab_Materials",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Ar_Glasses",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_4"
    ]
  ],
  [
    "Person",
    "holds",
    "White_Pen",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3"
    ]
  ],
  [
    "White_Pen",
    "writes_on",
    "Experiment_Report",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3"
    ]
  ],
  [
    "Electronic_Balance",
    "measures",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3"
    ]
  ],
  [
    "Aluminum_Foil",
    "is_reactant_in",
    "Hydrogen_Gas_Synthesis",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3"
    ]
  ],
  [
    "Test_Tube",
    "contains",
    "Chemical_Reagent",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_3"
    ]
  ],
  [
    "Person",
    "conducts",
    "Chemistry_Experiment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_1_4"
    ]
  ]
]
2025-11-24 14:29:10,653 - src.components.global_refiner - INFO - Refinement complete: 25 → 24 triplets (total: 28.01s, LLM: 28.01s)
2025-11-24 14:29:10,653 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 28.01s
2025-11-24 14:29:10,653 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:29:10,653 - src.pipeline.kg_builder - INFO - Pushing batch 2/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:29:10,653 - src.components.neo4j_handler - INFO - Adding 24 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:29:10,877 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:29:10,877 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:29:10,877 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:29:10,877 - src.components.neo4j_handler - INFO - Batch injected in 0.22s (triplets: 0.22s, indexes: 0.00s)
2025-11-24 14:29:10,877 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:29:10,881 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 56 nodes
2025-11-24 14:29:10,883 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 43 nodes
2025-11-24 14:29:10,889 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 56, 'relationship_count': 78, 'density': 0.0253, 'avg_degree': 2.7857, 'avg_unique_neighbors': 2.75, 'global_efficiency': 0.2592, 'avg_path_length': 2.7475, 'avg_degree_centrality': 0.0506, 'max_degree_centrality': 0.3636, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.003, 'degree_assortativity': -0.3999, 'graph_robustness': 0.9103, 'diameter_estimate': 4, 'clustering_coefficient': 0.2691, 'weakly_connected_components': 6, 'largest_wcc_size': 43, 'pagerank_top10_percent': 44.46, 'louvain_communities': 10, 'louvain_modularity': 0.6627, 'label_entropy': 1.318, 'computational_time': 0.01218330196570605}
2025-11-24 14:29:10,889 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 1, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763965750.8898687, 'total_time': 56.43310741300229, 'aggregation': 3.8710422813892365e-06, 'network_info': 0.005428409029264003, 'llm_extraction': 56.191077928000595, 'data_cleaning': 1.860695192590356e-05, 'neo4j_injection': 0.22412948502460495, 'embedding_time': 0, 'indexing_time': 0.002804312971420586, 'graph_injection_time': 0.22117049299413338, 'acs_metrics': {'node_count': 56, 'relationship_count': 78, 'density': 0.0253, 'avg_degree': 2.7857, 'avg_unique_neighbors': 2.75, 'global_efficiency': 0.2592, 'avg_path_length': 2.7475, 'avg_degree_centrality': 0.0506, 'max_degree_centrality': 0.3636, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.003, 'degree_assortativity': -0.3999, 'graph_robustness': 0.9103, 'diameter_estimate': 4, 'clustering_coefficient': 0.2691, 'weakly_connected_components': 6, 'largest_wcc_size': 43, 'pagerank_top10_percent': 44.46, 'louvain_communities': 10, 'louvain_modularity': 0.6627, 'label_entropy': 1.318, 'computational_time': 0.01218330196570605}, 'retrieval_queries': []}
2025-11-24 14:29:10,889 - src.pipeline.kg_builder - DEBUG - Batch 1 metrics: {
  "batch_idx": 1,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763965750.8898687,
  "total_time": 56.43310741300229,
  "aggregation": 3.8710422813892365e-06,
  "network_info": 0.005428409029264003,
  "llm_extraction": 56.191077928000595,
  "data_cleaning": 1.860695192590356e-05,
  "neo4j_injection": 0.22412948502460495,
  "embedding_time": 0,
  "indexing_time": 0.002804312971420586,
  "graph_injection_time": 0.22117049299413338,
  "acs_metrics": {
    "node_count": 56,
    "relationship_count": 78,
    "density": 0.0253,
    "avg_degree": 2.7857,
    "avg_unique_neighbors": 2.75,
    "global_efficiency": 0.2592,
    "avg_path_length": 2.7475,
    "avg_degree_centrality": 0.0506,
    "max_degree_centrality": 0.3636,
    "avg_betweenness_centrality": 0.0002,
    "max_betweenness_centrality": 0.003,
    "degree_assortativity": -0.3999,
    "graph_robustness": 0.9103,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.2691,
    "weakly_connected_components": 6,
    "largest_wcc_size": 43,
    "pagerank_top10_percent": 44.46,
    "louvain_communities": 10,
    "louvain_modularity": 0.6627,
    "label_entropy": 1.318,
    "computational_time": 0.01218330196570605
  },
  "retrieval_queries": []
}
2025-11-24 14:29:10,890 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:29:10,890 - src.pipeline.kg_builder - INFO - Batch 2 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 56.19s, Clean: 0.00s, Neo4j: 0.22s, ACS: 0.01s
2025-11-24 14:29:10,890 - src.pipeline.kg_builder - INFO - Batch 2 completed in 56.43s
Processing KG batches:   3%|▎         | 2/72 [01:08<44:33, 38.19s/it]2025-11-24 14:29:10,890 - src.pipeline.kg_builder - INFO - Processing batch 3/72 (3 items)
2025-11-24 14:29:10,890 - src.pipeline.kg_builder - DEBUG - Batch 3 current_video_time: 00:39-00:44
2025-11-24 14:29:10,895 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 56
- Total Relationships: 44
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:29:10,895 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 14:29:10,895 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0 ~177 words, content: Time: 00:29-00:34 Content: The video captures a scene in a laboratory setting where a person is conducting a chemistry experiment. The central focus is on...
2025-11-24 14:29:10,895 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1 ~205 words, content: or the product of the reaction. - A white, circular device with multiple holes, possibly a multi-well plate or a component of the experimental setup....
2025-11-24 14:29:10,895 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2 ~204 words, content: the report, which is laid out on the table. The report details an experiment to produce hydrogen gas by reacting aluminum with sodium hydroxide. The...
2025-11-24 14:29:10,896 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3 ~193 words, content: , protected by a blue nitrile glove, as they write on a printed document titled "AR 眼镜训练用化学实验报告 (简版)" (AR Glasses Training Chemistry Experiment Report -...
2025-11-24 14:29:10,896 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:29:10,896 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0) (~177 words) with timeout=5.0s retries=3
2025-11-24 14:29:12,353 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:29:12,353 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:29:12,354 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1) (~205 words) with timeout=5.0s retries=3
2025-11-24 14:29:13,769 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:29:13,769 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:29:13,769 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2) (~204 words) with timeout=5.0s retries=3
2025-11-24 14:29:14,803 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:29:14,803 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:29:14,803 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3) (~193 words) with timeout=5.0s retries=3
2025-11-24 14:29:19,810 - src.components.pre_llm_injector - WARNING - Chunk 3 timed out after 5.0s (attempt 1/4), retrying...
2025-11-24 14:29:21,512 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 2)
2025-11-24 14:29:21,512 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:29:21,512 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 4 chunks
2025-11-24 14:29:21,512 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 10.62s
2025-11-24 14:29:21,512 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 56
- Total Relationships: 44
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2"]}, {"head": "Person", "relation": "Uses", "tail": "White Marker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0"]}, {"head": "Person", "relation": "Writes", "tail": "Document", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3"]}, {"head": "Document", "relation": "Contains", "tail": "Ar Glasses Training Chemistry Experiment Report (Simplified Version)", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0"]}, {"head": "Document", "relation": "Contains", "tail": "Balanced Chemical Equation", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0"]}, {"head": "Balanced Chemical Equation", "relation": "Describes", "tail": "Reaction Between Aluminum And Sodium Hydroxide", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1"]}, {"head": "Person", "relation": "Fills Out", "tail": "Chemistry Experiment Report", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1"]}, {"head": "Chemistry Experiment Report", "relation": "Is Laid On", "tail": "Lab Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "White Circular Device", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Black Elongated Case", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Roll Of Tape", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1"]}, {"head": "Person", "relation": "Writes On", "tail": "Report", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2"]}, {"head": "Report", "relation": "Contains", "tail": "Experiment Purpose", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2"]}, {"head": "Report", "relation": "Contains", "tail": "Experiment Principle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2"]}, {"head": "Report", "relation": "Contains", "tail": "Chemical Equation", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2"]}, {"head": "Report", "relation": "Contains", "tail": "Mass Value", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2"]}, {"head": "Person", "relation": "Wears", "tail": "Nitrile Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3"]}, {"head": "Person", "relation": "Uses", "tail": "Marker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3"]}, {"head": "Document", "relation": "Is Laid On", "tail": "Laboratory Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3"]}, {"head": "Laboratory Bench", "relation": "Contains", "tail": "Test Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3"]}, {"head": "Laboratory Bench", "relation": "Contains", "tail": "Electrical Outlet", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:29:21,512 - src.components.global_refiner - DEBUG - Refining 22 triplets (prompt ~344 words, ~447 tokens)
2025-11-24 14:29:21,513 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:29:48,025 - src.components.global_refiner - DEBUG - LLM call completed in 26.51s
2025-11-24 14:29:48,025 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue Nitrile Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2']], ['Person', 'uses', 'White Marker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0']], ['Person', 'writes', 'Document', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3']], ['Document', 'contains', 'Ar Glasses Training Chemistry Experiment Report (Simplified Version)', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0']], ['Document', 'contains', 'Balanced Chemical Equation', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0']], ['Balanced Chemical Equation', 'describes', 'Reaction Between Aluminum And Sodium Hydroxide', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0']], ['Person', 'wears', 'Blue Nitrile Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1']], ['Person', 'fills_out', 'Chemistry Experiment Report', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1']], ['Chemistry Experiment Report', 'is_laid_on', 'Lab Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1']], ['Lab Bench', 'contains', 'White Circular Device', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1']], ['Lab Bench', 'contains', 'Black Elongated Case', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1']], ['Lab Bench', 'contains', 'Roll Of Tape', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1']], ['Person', 'writes_on', 'Report', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2']], ['Report', 'contains', 'Experiment Purpose', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2']], ['Report', 'contains', 'Experiment Principle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2']], ['Report', 'contains', 'Chemical Equation', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2']], ['Report', 'contains', 'Mass Value', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2']], ['Person', 'wears', 'Nitrile Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3']], ['Person', 'uses', 'Marker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3']], ['Document', 'is_laid_on', 'Laboratory Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3']], ['Laboratory Bench', 'contains', 'Test Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3']], ['Laboratory Bench', 'contains', 'Electrical Outlet', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3']]]
2025-11-24 14:29:48,025 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue Nitrile Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2"
    ]
  ],
  [
    "Person",
    "uses",
    "White Marker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0"
    ]
  ],
  [
    "Person",
    "writes",
    "Document",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3"
    ]
  ],
  [
    "Document",
    "contains",
    "Ar Glasses Training Chemistry Experiment Report (Simplified Version)",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0"
    ]
  ],
  [
    "Document",
    "contains",
    "Balanced Chemical Equation",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0"
    ]
  ],
  [
    "Balanced Chemical Equation",
    "describes",
    "Reaction Between Aluminum And Sodium Hydroxide",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Nitrile Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1"
    ]
  ],
  [
    "Person",
    "fills_out",
    "Chemistry Experiment Report",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1"
    ]
  ],
  [
    "Chemistry Experiment Report",
    "is_laid_on",
    "Lab Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1"
    ]
  ],
  [
    "Lab Bench",
    "contains",
    "White Circular Device",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1"
    ]
  ],
  [
    "Lab Bench",
    "contains",
    "Black Elongated Case",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1"
    ]
  ],
  [
    "Lab Bench",
    "contains",
    "Roll Of Tape",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_1"
    ]
  ],
  [
    "Person",
    "writes_on",
    "Report",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2"
    ]
  ],
  [
    "Report",
    "contains",
    "Experiment Purpose",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2"
    ]
  ],
  [
    "Report",
    "contains",
    "Experiment Principle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2"
    ]
  ],
  [
    "Report",
    "contains",
    "Chemical Equation",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2"
    ]
  ],
  [
    "Report",
    "contains",
    "Mass Value",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Nitrile Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Marker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3"
    ]
  ],
  [
    "Document",
    "is_laid_on",
    "Laboratory Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3"
    ]
  ],
  [
    "Laboratory Bench",
    "contains",
    "Test Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3"
    ]
  ],
  [
    "Laboratory Bench",
    "contains",
    "Electrical Outlet",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_2_3"
    ]
  ]
]
2025-11-24 14:29:48,025 - src.components.global_refiner - INFO - Refinement complete: 22 → 22 triplets (total: 26.51s, LLM: 26.51s)
2025-11-24 14:29:48,025 - src.pipeline.kg_builder - INFO - Global refinement: 22 triplets in 26.51s
2025-11-24 14:29:48,026 - src.pipeline.kg_builder - INFO - Using 22 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:29:48,026 - src.pipeline.kg_builder - INFO - Pushing batch 3/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:29:48,026 - src.components.neo4j_handler - INFO - Adding 22 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:29:48,270 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:29:48,270 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:29:48,271 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:29:48,271 - src.components.neo4j_handler - INFO - Batch injected in 0.25s (triplets: 0.24s, indexes: 0.01s)
2025-11-24 14:29:48,271 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:29:48,277 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 80 nodes
2025-11-24 14:29:48,280 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 67 nodes
2025-11-24 14:29:48,287 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 80, 'relationship_count': 126, 'density': 0.0199, 'avg_degree': 3.15, 'avg_unique_neighbors': 3.125, 'global_efficiency': 0.2825, 'avg_path_length': 2.8607, 'avg_degree_centrality': 0.0399, 'max_degree_centrality': 0.3924, 'avg_betweenness_centrality': 0.0001, 'max_betweenness_centrality': 0.0023, 'degree_assortativity': -0.3576, 'graph_robustness': 0.8651, 'diameter_estimate': 4, 'clustering_coefficient': 0.3085, 'weakly_connected_components': 6, 'largest_wcc_size': 67, 'pagerank_top10_percent': 40.23, 'louvain_communities': 12, 'louvain_modularity': 0.6746, 'label_entropy': 1.3201, 'computational_time': 0.016306858975440264}
2025-11-24 14:29:48,287 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 2, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763965788.2877674, 'total_time': 37.39729538897518, 'aggregation': 7.2919647209346294e-06, 'network_info': 0.0046840180293656886, 'llm_extraction': 37.13063446700107, 'data_cleaning': 1.7629994545131922e-05, 'neo4j_injection': 0.24533539498224854, 'embedding_time': 0, 'indexing_time': 0.006672939984127879, 'graph_injection_time': 0.23851729300804436, 'acs_metrics': {'node_count': 80, 'relationship_count': 126, 'density': 0.0199, 'avg_degree': 3.15, 'avg_unique_neighbors': 3.125, 'global_efficiency': 0.2825, 'avg_path_length': 2.8607, 'avg_degree_centrality': 0.0399, 'max_degree_centrality': 0.3924, 'avg_betweenness_centrality': 0.0001, 'max_betweenness_centrality': 0.0023, 'degree_assortativity': -0.3576, 'graph_robustness': 0.8651, 'diameter_estimate': 4, 'clustering_coefficient': 0.3085, 'weakly_connected_components': 6, 'largest_wcc_size': 67, 'pagerank_top10_percent': 40.23, 'louvain_communities': 12, 'louvain_modularity': 0.6746, 'label_entropy': 1.3201, 'computational_time': 0.016306858975440264}, 'retrieval_queries': []}
2025-11-24 14:29:48,287 - src.pipeline.kg_builder - DEBUG - Batch 2 metrics: {
  "batch_idx": 2,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763965788.2877674,
  "total_time": 37.39729538897518,
  "aggregation": 7.2919647209346294e-06,
  "network_info": 0.0046840180293656886,
  "llm_extraction": 37.13063446700107,
  "data_cleaning": 1.7629994545131922e-05,
  "neo4j_injection": 0.24533539498224854,
  "embedding_time": 0,
  "indexing_time": 0.006672939984127879,
  "graph_injection_time": 0.23851729300804436,
  "acs_metrics": {
    "node_count": 80,
    "relationship_count": 126,
    "density": 0.0199,
    "avg_degree": 3.15,
    "avg_unique_neighbors": 3.125,
    "global_efficiency": 0.2825,
    "avg_path_length": 2.8607,
    "avg_degree_centrality": 0.0399,
    "max_degree_centrality": 0.3924,
    "avg_betweenness_centrality": 0.0001,
    "max_betweenness_centrality": 0.0023,
    "degree_assortativity": -0.3576,
    "graph_robustness": 0.8651,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.3085,
    "weakly_connected_components": 6,
    "largest_wcc_size": 67,
    "pagerank_top10_percent": 40.23,
    "louvain_communities": 12,
    "louvain_modularity": 0.6746,
    "label_entropy": 1.3201,
    "computational_time": 0.016306858975440264
  },
  "retrieval_queries": []
}
2025-11-24 14:29:48,288 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:29:48,288 - src.pipeline.kg_builder - INFO - Batch 3 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 37.13s, Clean: 0.00s, Neo4j: 0.25s, ACS: 0.02s
2025-11-24 14:29:48,288 - src.pipeline.kg_builder - INFO - Batch 3 completed in 37.40s
Processing KG batches:   4%|▍         | 3/72 [01:45<43:30, 37.83s/it]2025-11-24 14:29:48,288 - src.pipeline.kg_builder - INFO - Processing batch 4/72 (3 items)
2025-11-24 14:29:48,288 - src.pipeline.kg_builder - DEBUG - Batch 4 current_video_time: 00:54-00:59
2025-11-24 14:29:48,293 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 80
- Total Relationships: 66
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:29:48,293 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 14:29:48,294 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0 ~186 words, content: Time: 00:44-00:49 Content: The video sequence captures a person conducting a chemistry experiment in a laboratory setting, focusing on the preparation and documentation of a...
2025-11-24 14:29:48,294 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1 ~240 words, content: to a wider, slightly elevated view of the laboratory. This broader shot reveals more of the workspace, including a power strip with multiple plugs, a...
2025-11-24 14:29:48,294 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2 ~241 words, content: , and a yellow box. A person wearing blue gloves is seen handling a piece of aluminum foil, which is likely being used to cover...
2025-11-24 14:29:48,294 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3 ~164 words, content: :59 Content: The video sequence captures a person preparing to conduct a precise measurement in a laboratory setting. The scene is set in a well-equipped...
2025-11-24 14:29:48,294 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:29:48,294 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0) (~186 words) with timeout=5.0s retries=3
2025-11-24 14:29:49,984 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:29:49,984 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:29:49,984 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1) (~240 words) with timeout=5.0s retries=3
2025-11-24 14:29:51,078 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:29:51,078 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:29:51,078 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2) (~241 words) with timeout=5.0s retries=3
2025-11-24 14:29:52,215 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:29:52,215 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:29:52,216 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3) (~164 words) with timeout=5.0s retries=3
2025-11-24 14:29:53,605 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:29:53,605 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:29:53,605 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 4 chunks
2025-11-24 14:29:53,605 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 5.31s
2025-11-24 14:29:53,606 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 80
- Total Relationships: 66
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0"]}, {"head": "Person", "relation": "Writes On", "tail": "Chemistry_Experiment_Report", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0"]}, {"head": "Chemistry_Experiment_Report", "relation": "Contains", "tail": "Chemical_Equation", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0"]}, {"head": "Chemical_Equation", "relation": "Describes", "tail": "Reaction_Of_Aluminum_With_Sodium_Hydroxide", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Test_Tube_With_Blue_Cap", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Ar_Headset_Case", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Lab Table", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1"]}, {"head": "Lab Table", "relation": "Holds", "tail": "Test Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1"]}, {"head": "Lab Table", "relation": "Holds", "tail": "Document", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1"]}, {"head": "Document", "relation": "Contains", "tail": "Handwritten Notes", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1"]}, {"head": "Lab Table", "relation": "Holds", "tail": "Power Strip", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1"]}, {"head": "Power Strip", "relation": "Has", "tail": "Plugs", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2"]}, {"head": "Person", "relation": "Handles", "tail": "Aluminum Foil", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3"]}, {"head": "Person", "relation": "Places", "tail": "Aluminum Foil", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2"]}, {"head": "Aluminum Foil", "relation": "Is Used To", "tail": "Cover_Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3"]}, {"head": "Aluminum Foil", "relation": "Is Placed On", "tail": "Digital Balance Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3"]}, {"head": "Digital Balance Scale", "relation": "Is Enclosed In", "tail": "Transparent Glass Chamber", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3"]}, {"head": "Person", "relation": "Closes", "tail": "Glass Door Of Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3"]}, {"head": "Digital Balance Scale", "relation": "Is Used For", "tail": "Precise Measurement", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:29:53,606 - src.components.global_refiner - DEBUG - Refining 23 triplets (prompt ~336 words, ~437 tokens)
2025-11-24 14:29:53,606 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:30:19,760 - src.components.global_refiner - DEBUG - LLM call completed in 26.15s
2025-11-24 14:30:19,760 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3']], ['Person', 'writes_on', 'Chemistry_Experiment_Report', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0']], ['Chemistry_Experiment_Report', 'contains', 'Chemical_Equation', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0']], ['Chemical_Equation', 'describes', 'Reaction_Of_Aluminum_With_Sodium_Hydroxide', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0']], ['Lab_Bench', 'contains', 'Test_Tube_With_Blue_Cap', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0']], ['Lab_Bench', 'contains', 'Ar_Headset_Case', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0']], ['Laboratory', 'contains', 'Lab_Table', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1']], ['Lab_Table', 'holds', 'Test_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1']], ['Lab_Table', 'holds', 'Document', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1']], ['Document', 'contains', 'Handwritten_Notes', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1']], ['Lab_Table', 'holds', 'Power_Strips', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1']], ['Power_Strips', 'has', 'Plugs', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1']], ['Person', 'wears', 'Blue_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2']], ['Person', 'handles', 'Aluminum_Foil', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3']], ['Person', 'places', 'Aluminum_Foil', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2']], ['Aluminum_Foil', 'is_used_to', 'Cover_Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2']], ['Aluminum_Foil', 'is_placed_on', 'Digital_Balance_Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3']], ['Digital_Balance_Scale', 'is_enclosed_in', 'Transparent_Glass_Chamber', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3']], ['Person', 'closes', 'Glass_Door_Of_Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3']], ['Digital_Balance_Scale', 'is_used_for', 'Precise_Measurement', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3']]]
2025-11-24 14:30:19,760 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3"
    ]
  ],
  [
    "Person",
    "writes_on",
    "Chemistry_Experiment_Report",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0"
    ]
  ],
  [
    "Chemistry_Experiment_Report",
    "contains",
    "Chemical_Equation",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0"
    ]
  ],
  [
    "Chemical_Equation",
    "describes",
    "Reaction_Of_Aluminum_With_Sodium_Hydroxide",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Test_Tube_With_Blue_Cap",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Ar_Headset_Case",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_0"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Lab_Table",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1"
    ]
  ],
  [
    "Lab_Table",
    "holds",
    "Test_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1"
    ]
  ],
  [
    "Lab_Table",
    "holds",
    "Document",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1"
    ]
  ],
  [
    "Document",
    "contains",
    "Handwritten_Notes",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1"
    ]
  ],
  [
    "Lab_Table",
    "holds",
    "Power_Strips",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1"
    ]
  ],
  [
    "Power_Strips",
    "has",
    "Plugs",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2"
    ]
  ],
  [
    "Person",
    "handles",
    "Aluminum_Foil",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3"
    ]
  ],
  [
    "Person",
    "places",
    "Aluminum_Foil",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2"
    ]
  ],
  [
    "Aluminum_Foil",
    "is_used_to",
    "Cover_Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_2"
    ]
  ],
  [
    "Aluminum_Foil",
    "is_placed_on",
    "Digital_Balance_Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3"
    ]
  ],
  [
    "Digital_Balance_Scale",
    "is_enclosed_in",
    "Transparent_Glass_Chamber",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3"
    ]
  ],
  [
    "Person",
    "closes",
    "Glass_Door_Of_Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3"
    ]
  ],
  [
    "Digital_Balance_Scale",
    "is_used_for",
    "Precise_Measurement",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_3_3"
    ]
  ]
]
2025-11-24 14:30:19,760 - src.components.global_refiner - INFO - Refinement complete: 23 → 22 triplets (total: 26.15s, LLM: 26.15s)
2025-11-24 14:30:19,761 - src.pipeline.kg_builder - INFO - Global refinement: 22 triplets in 26.15s
2025-11-24 14:30:19,761 - src.pipeline.kg_builder - INFO - Using 22 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:30:19,761 - src.pipeline.kg_builder - INFO - Pushing batch 4/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:30:19,761 - src.components.neo4j_handler - INFO - Adding 22 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:30:19,999 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:30:19,999 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:30:19,999 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:30:19,999 - src.components.neo4j_handler - INFO - Batch injected in 0.24s (triplets: 0.23s, indexes: 0.00s)
2025-11-24 14:30:19,999 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:30:20,005 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 103 nodes
2025-11-24 14:30:20,012 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 90 nodes
2025-11-24 14:30:20,024 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 103, 'relationship_count': 175, 'density': 0.0167, 'avg_degree': 3.3981, 'avg_unique_neighbors': 3.3786, 'global_efficiency': 0.294, 'avg_path_length': 2.9411, 'avg_degree_centrality': 0.0333, 'max_degree_centrality': 0.3922, 'avg_betweenness_centrality': 0.0001, 'max_betweenness_centrality': 0.0038, 'degree_assortativity': -0.3324, 'graph_robustness': 0.8743, 'diameter_estimate': 5, 'clustering_coefficient': 0.3151, 'weakly_connected_components': 6, 'largest_wcc_size': 90, 'pagerank_top10_percent': 33.92, 'louvain_communities': 14, 'louvain_modularity': 0.6622, 'label_entropy': 1.3231, 'computational_time': 0.024944694014266133}
2025-11-24 14:30:20,024 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 3, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763965820.0246506, 'total_time': 31.736414609011263, 'aggregation': 3.0529918149113655e-06, 'network_info': 0.0051833660108968616, 'llm_extraction': 31.46748192596715, 'data_cleaning': 1.8911028746515512e-05, 'neo4j_injection': 0.23851149895926937, 'embedding_time': 0, 'indexing_time': 0.003361393988598138, 'graph_injection_time': 0.23499811498913914, 'acs_metrics': {'node_count': 103, 'relationship_count': 175, 'density': 0.0167, 'avg_degree': 3.3981, 'avg_unique_neighbors': 3.3786, 'global_efficiency': 0.294, 'avg_path_length': 2.9411, 'avg_degree_centrality': 0.0333, 'max_degree_centrality': 0.3922, 'avg_betweenness_centrality': 0.0001, 'max_betweenness_centrality': 0.0038, 'degree_assortativity': -0.3324, 'graph_robustness': 0.8743, 'diameter_estimate': 5, 'clustering_coefficient': 0.3151, 'weakly_connected_components': 6, 'largest_wcc_size': 90, 'pagerank_top10_percent': 33.92, 'louvain_communities': 14, 'louvain_modularity': 0.6622, 'label_entropy': 1.3231, 'computational_time': 0.024944694014266133}, 'retrieval_queries': []}
2025-11-24 14:30:20,024 - src.pipeline.kg_builder - DEBUG - Batch 3 metrics: {
  "batch_idx": 3,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763965820.0246506,
  "total_time": 31.736414609011263,
  "aggregation": 3.0529918149113655e-06,
  "network_info": 0.0051833660108968616,
  "llm_extraction": 31.46748192596715,
  "data_cleaning": 1.8911028746515512e-05,
  "neo4j_injection": 0.23851149895926937,
  "embedding_time": 0,
  "indexing_time": 0.003361393988598138,
  "graph_injection_time": 0.23499811498913914,
  "acs_metrics": {
    "node_count": 103,
    "relationship_count": 175,
    "density": 0.0167,
    "avg_degree": 3.3981,
    "avg_unique_neighbors": 3.3786,
    "global_efficiency": 0.294,
    "avg_path_length": 2.9411,
    "avg_degree_centrality": 0.0333,
    "max_degree_centrality": 0.3922,
    "avg_betweenness_centrality": 0.0001,
    "max_betweenness_centrality": 0.0038,
    "degree_assortativity": -0.3324,
    "graph_robustness": 0.8743,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.3151,
    "weakly_connected_components": 6,
    "largest_wcc_size": 90,
    "pagerank_top10_percent": 33.92,
    "louvain_communities": 14,
    "louvain_modularity": 0.6622,
    "label_entropy": 1.3231,
    "computational_time": 0.024944694014266133
  },
  "retrieval_queries": []
}
2025-11-24 14:30:20,024 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:30:20,025 - src.pipeline.kg_builder - INFO - Batch 4 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 31.47s, Clean: 0.00s, Neo4j: 0.24s, ACS: 0.03s
2025-11-24 14:30:20,025 - src.pipeline.kg_builder - INFO - Batch 4 completed in 31.74s
Processing KG batches:   6%|▌         | 4/72 [02:17<40:08, 35.42s/it]2025-11-24 14:30:20,025 - src.pipeline.kg_builder - INFO - Processing batch 5/72 (3 items)
2025-11-24 14:30:20,025 - src.pipeline.kg_builder - DEBUG - Batch 5 current_video_time: 01:09-01:14
2025-11-24 14:30:20,033 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 103
- Total Relationships: 88
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:30:20,033 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:30:20,033 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0 ~233 words, content: Time: 00:59-01:04 Content: The video sequence captures a series of actions performed by a person in a laboratory setting, focusing on the preparation of a...
2025-11-24 14:30:20,033 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1 ~241 words, content: they continue to use the pipette. The liquid is being carefully transferred into the beaker, which is still on the balance scale. The person's movements...
2025-11-24 14:30:20,033 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2 ~236 words, content: and safety throughout the process. The sequence of actions, from weighing the beaker to transferring the liquid and stirring it, indicates a methodical approach to...
2025-11-24 14:30:20,033 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3 ~225 words, content: and attention to detail. The overall atmosphere is one of concentration and scientific rigor. Time: 01:09-01:14 Content: The video sequence captures a series of actions...
2025-11-24 14:30:20,033 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4 ~226 words, content: - **Frame 3:** The person's hands are now actively engaged in opening the bottle. The left hand holds the bottle while the right hand, also...
2025-11-24 14:30:20,033 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:30:20,034 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0) (~233 words) with timeout=5.0s retries=3
2025-11-24 14:30:21,260 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:30:21,260 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:30:21,260 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1) (~241 words) with timeout=5.0s retries=3
2025-11-24 14:30:22,334 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:30:22,334 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:30:22,335 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2) (~236 words) with timeout=5.0s retries=3
2025-11-24 14:30:23,376 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:30:23,376 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:30:23,376 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3) (~225 words) with timeout=5.0s retries=3
2025-11-24 14:30:24,690 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:30:24,690 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:30:24,690 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4) (~226 words) with timeout=5.0s retries=3
2025-11-24 14:30:26,616 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:30:26,616 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:30:26,616 - src.components.pre_llm_injector - INFO - Extracted 25 local triplets from 5 chunks
2025-11-24 14:30:26,617 - src.pipeline.kg_builder - INFO - Pre-extraction: 25 triplets in 6.58s
2025-11-24 14:30:26,617 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 103
- Total Relationships: 88
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0"]}, {"head": "Person", "relation": "Handles", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2"]}, {"head": "Beaker", "relation": "Is On", "tail": "Balance_Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1"]}, {"head": "Person", "relation": "Closes", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1"]}, {"head": "Person", "relation": "Stirs", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3"]}, {"head": "Person", "relation": "Uses", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2"]}, {"head": "Person", "relation": "Uses", "tail": "Burette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2"]}, {"head": "Person", "relation": "Uses", "tail": "Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2"]}, {"head": "Person", "relation": "Handles", "tail": "Laboratory Glassware", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3"]}, {"head": "Person", "relation": "Holds", "tail": "White Bottle With Red Cap", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3"]}, {"head": "Person", "relation": "Interacts With", "tail": "Analytical Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3"]}, {"head": "Beaker", "relation": "Is On", "tail": "Black Countertop", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3"]}, {"head": "White Bottle With Red Cap", "relation": "Is On", "tail": "Black Countertop", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3"]}, {"head": "Person", "relation": "Wears", "tail": "Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4"]}, {"head": "Person", "relation": "Holds", "tail": "Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4"]}, {"head": "Person", "relation": "Holds", "tail": "Cap", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4"]}, {"head": "Bottle", "relation": "Contains", "tail": "White Powder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4"]}, {"head": "Bottle", "relation": "Is Opened By", "tail": "Person", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "Analytical Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:30:26,617 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~346 words, ~450 tokens)
2025-11-24 14:30:26,617 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:30:57,548 - src.components.global_refiner - DEBUG - LLM call completed in 30.93s
2025-11-24 14:30:57,548 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0']], ['Person', 'handles', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2']], ['Beaker', 'is_on', 'Balance_Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0']], ['Liquid', 'is_transferred_to', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1']], ['Person', 'closes', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1']], ['Person', 'stirs', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3']], ['Person', 'uses', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2']], ['Person', 'uses', 'Burette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2']], ['Person', 'uses', 'Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2']], ['Person', 'handles', 'Laboratory_Glassware', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3']], ['Person', 'holds', 'White_Bottle_With_Red_Cap', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3']], ['Person', 'interacts_with', 'Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3']], ['Beaker', 'is_on', 'Black_Countertop', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3']], ['White_Bottle_With_Red_Cap', 'is_on', 'Black_Countertop', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3']], ['Person', 'wears', 'Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4']], ['Person', 'holds', 'Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4']], ['Person', 'holds', 'Cap', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4']], ['Bottle', 'contains', 'White_Powder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4']], ['Bottle', 'is_opened_by', 'Person', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4']], ['Lab_Environment', 'contains', 'Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4']]]
2025-11-24 14:30:57,548 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0"
    ]
  ],
  [
    "Person",
    "handles",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Balance_Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0"
    ]
  ],
  [
    "Liquid",
    "is_transferred_to",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1"
    ]
  ],
  [
    "Person",
    "closes",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1"
    ]
  ],
  [
    "Person",
    "stirs",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Burette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2"
    ]
  ],
  [
    "Person",
    "handles",
    "Laboratory_Glassware",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3"
    ]
  ],
  [
    "Person",
    "holds",
    "White_Bottle_With_Red_Cap",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3"
    ]
  ],
  [
    "Person",
    "interacts_with",
    "Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Black_Countertop",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3"
    ]
  ],
  [
    "White_Bottle_With_Red_Cap",
    "is_on",
    "Black_Countertop",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4"
    ]
  ],
  [
    "Person",
    "holds",
    "Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4"
    ]
  ],
  [
    "Person",
    "holds",
    "Cap",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4"
    ]
  ],
  [
    "Bottle",
    "contains",
    "White_Powder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4"
    ]
  ],
  [
    "Bottle",
    "is_opened_by",
    "Person",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4"
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_4_4"
    ]
  ]
]
2025-11-24 14:30:57,548 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 30.93s, LLM: 30.93s)
2025-11-24 14:30:57,548 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 30.93s
2025-11-24 14:30:57,548 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:30:57,548 - src.pipeline.kg_builder - INFO - Pushing batch 5/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:30:57,548 - src.components.neo4j_handler - INFO - Adding 24 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:30:57,764 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:30:57,765 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:30:57,765 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:30:57,765 - src.components.neo4j_handler - INFO - Batch injected in 0.22s (triplets: 0.21s, indexes: 0.00s)
2025-11-24 14:30:57,765 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:30:57,778 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 121 nodes
2025-11-24 14:30:57,790 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 108 nodes
2025-11-24 14:30:57,811 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 121, 'relationship_count': 225, 'density': 0.0155, 'avg_degree': 3.719, 'avg_unique_neighbors': 3.6694, 'global_efficiency': 0.3161, 'avg_path_length': 2.8184, 'avg_degree_centrality': 0.031, 'max_degree_centrality': 0.4833, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.014, 'degree_assortativity': -0.3455, 'graph_robustness': 0.8622, 'diameter_estimate': 5, 'clustering_coefficient': 0.3173, 'weakly_connected_components': 6, 'largest_wcc_size': 108, 'pagerank_top10_percent': 28.35, 'louvain_communities': 15, 'louvain_modularity': 0.6224, 'label_entropy': 1.342, 'computational_time': 0.045690210012253374}
2025-11-24 14:30:57,811 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 4, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763965857.8112674, 'total_time': 37.786157091963105, 'aggregation': 2.7830246835947037e-06, 'network_info': 0.007967423007357866, 'llm_extraction': 37.515481242968235, 'data_cleaning': 5.789700662717223e-05, 'neo4j_injection': 0.21657117799622938, 'embedding_time': 0, 'indexing_time': 0.0027584899798966944, 'graph_injection_time': 0.21354117197915912, 'acs_metrics': {'node_count': 121, 'relationship_count': 225, 'density': 0.0155, 'avg_degree': 3.719, 'avg_unique_neighbors': 3.6694, 'global_efficiency': 0.3161, 'avg_path_length': 2.8184, 'avg_degree_centrality': 0.031, 'max_degree_centrality': 0.4833, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.014, 'degree_assortativity': -0.3455, 'graph_robustness': 0.8622, 'diameter_estimate': 5, 'clustering_coefficient': 0.3173, 'weakly_connected_components': 6, 'largest_wcc_size': 108, 'pagerank_top10_percent': 28.35, 'louvain_communities': 15, 'louvain_modularity': 0.6224, 'label_entropy': 1.342, 'computational_time': 0.045690210012253374}, 'retrieval_queries': []}
2025-11-24 14:30:57,811 - src.pipeline.kg_builder - DEBUG - Batch 4 metrics: {
  "batch_idx": 4,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763965857.8112674,
  "total_time": 37.786157091963105,
  "aggregation": 2.7830246835947037e-06,
  "network_info": 0.007967423007357866,
  "llm_extraction": 37.515481242968235,
  "data_cleaning": 5.789700662717223e-05,
  "neo4j_injection": 0.21657117799622938,
  "embedding_time": 0,
  "indexing_time": 0.0027584899798966944,
  "graph_injection_time": 0.21354117197915912,
  "acs_metrics": {
    "node_count": 121,
    "relationship_count": 225,
    "density": 0.0155,
    "avg_degree": 3.719,
    "avg_unique_neighbors": 3.6694,
    "global_efficiency": 0.3161,
    "avg_path_length": 2.8184,
    "avg_degree_centrality": 0.031,
    "max_degree_centrality": 0.4833,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.014,
    "degree_assortativity": -0.3455,
    "graph_robustness": 0.8622,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.3173,
    "weakly_connected_components": 6,
    "largest_wcc_size": 108,
    "pagerank_top10_percent": 28.35,
    "louvain_communities": 15,
    "louvain_modularity": 0.6224,
    "label_entropy": 1.342,
    "computational_time": 0.045690210012253374
  },
  "retrieval_queries": []
}
2025-11-24 14:30:57,811 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:30:57,811 - src.pipeline.kg_builder - INFO - Batch 5 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 37.52s, Clean: 0.00s, Neo4j: 0.22s, ACS: 0.05s
2025-11-24 14:30:57,811 - src.pipeline.kg_builder - INFO - Batch 5 completed in 37.79s
Processing KG batches:   7%|▋         | 5/72 [02:55<40:30, 36.28s/it]2025-11-24 14:30:57,811 - src.pipeline.kg_builder - INFO - Processing batch 6/72 (3 items)
2025-11-24 14:30:57,811 - src.pipeline.kg_builder - DEBUG - Batch 6 current_video_time: 01:24-01:29
2025-11-24 14:30:57,816 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 121
- Total Relationships: 109
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:30:57,817 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-24 14:30:57,817 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0 ~233 words, content: Time: 01:14-01:19 Content: The video captures a sequence of actions in a laboratory setting, focusing on a person preparing a chemical experiment. The scene is...
2025-11-24 14:30:57,817 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1 ~228 words, content: , star-shaped component at the top, which is connected by tubing to the beaker on the stirrer. This suggests a setup for a reaction that...
2025-11-24 14:30:57,817 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2 ~203 words, content: - **Frame 2:** The scene shifts to a different area of the lab. A person, wearing a beige sweater, is holding a white plastic bottle....
2025-11-24 14:30:57,817 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3 ~209 words, content: a well-organized laboratory with a glass-fronted storage cabinet filled with various chemicals and reagents. The overall environment is clean and orderly. In summary, the video...
2025-11-24 14:30:57,817 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_4 ~205 words, content: and can cause severe skin burns and eye damage. The background shows a laboratory environment with a glass-enclosed storage cabinet, a door, and a workbench....
2025-11-24 14:30:57,817 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_5 ~113 words, content: the bottle. The powder is then carefully transferred into a small, clear glass beaker that is resting on a digital balance scale. This indicates that...
2025-11-24 14:30:57,817 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:30:57,817 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0) (~233 words) with timeout=5.0s retries=3
2025-11-24 14:30:59,396 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:30:59,396 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:30:59,396 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1) (~228 words) with timeout=5.0s retries=3
2025-11-24 14:31:00,631 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:31:00,631 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:31:00,631 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2) (~203 words) with timeout=5.0s retries=3
2025-11-24 14:31:01,873 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:31:01,873 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:31:01,873 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3) (~209 words) with timeout=5.0s retries=3
2025-11-24 14:31:03,410 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:31:03,410 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:31:03,410 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_4) (~205 words) with timeout=5.0s retries=3
2025-11-24 14:31:04,468 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:31:04,468 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:31:04,469 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_5) (~113 words) with timeout=5.0s retries=3
2025-11-24 14:31:05,924 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-24 14:31:05,925 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-24 14:31:05,925 - src.components.pre_llm_injector - INFO - Extracted 36 local triplets from 6 chunks
2025-11-24 14:31:05,925 - src.pipeline.kg_builder - INFO - Pre-extraction: 36 triplets in 8.11s
2025-11-24 14:31:05,925 - src.components.global_refiner - INFO - Capping refinement input: 36 → 25 triplets
2025-11-24 14:31:05,925 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 121
- Total Relationships: 109
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0"]}, {"head": "Magnetic_Stirrer", "relation": "Contains", "tail": "Glass_Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0"]}, {"head": "Glass_Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0"]}, {"head": "Magnetic_Stirrer", "relation": "Displays", "tail": "0.180", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Rod", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0"]}, {"head": "Glass_Rod", "relation": "Stirs", "tail": "Small_Glass_Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1"]}, {"head": "Tubing", "relation": "Connects", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Reaction Mixture", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1"]}, {"head": "Person", "relation": "Adds", "tail": "Reagent", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1"]}, {"head": "Person", "relation": "Wears", "tail": "Beige Sweater", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2"]}, {"head": "Person", "relation": "Holds", "tail": "White Plastic Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2"]}, {"head": "White Plastic Bottle", "relation": "Contains", "tail": "Sodium Hydroxide", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2"]}, {"head": "Sodium Hydroxide", "relation": "Has Label", "tail": "General-Reagent", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2"]}, {"head": "Person", "relation": "Interacts With", "tail": "Precision Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Glass-Fronted Storage Cabinet", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3"]}, {"head": "Glass-Fronted Storage Cabinet", "relation": "Contains", "tail": "Chemicals And Reagents", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3"]}, {"head": "Laboratory Worker", "relation": "Handles", "tail": "Sodium Hydroxide", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3"]}, {"head": "Sodium Hydroxide", "relation": "Is Labeled As", "tail": "Corrosive", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3"]}, {"head": "Laboratory", "relation": "Has", "tail": "Fume Hood", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3"]}, {"head": "Person", "relation": "Holds", "tail": "Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:31:05,925 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~347 words, ~451 tokens)
2025-11-24 14:31:05,925 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:31:38,404 - src.components.global_refiner - DEBUG - LLM call completed in 32.48s
2025-11-24 14:31:38,404 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0']], ['Person', 'wears', 'Blue_Nitrile_Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1']], ['Person', 'wears', 'Beige_Sweater', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2']], ['Person', 'wears', 'Blue_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3']], ['Person', 'holds', 'Glass_Rod', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0']], ['Person', 'holds', 'White_Plastic_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2']], ['Person', 'holds', 'Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_4']], ['Person', 'adds', 'Reagent', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1']], ['Person', 'interacts_with', 'Precision_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2']], ['Person', 'handles', 'Sodium_Hydroxide', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3']], ['Magnetic_Stirrer', 'contains', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0']], ['Glass_Beaker', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0']], ['Magnetic_Stirrer', 'displays', '0.180', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0']], ['Beaker', 'is_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1']], ['Beaker', 'contains', 'Reaction_Mixture', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1']], ['Tubing', 'connects', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1']], ['Lab_Bench', 'contains', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1']], ['White_Plastic_Bottle', 'contains', 'Sodium_Hydroxide', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2']], ['Sodium_Hydroxide', 'has_label', 'General-Reagent', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2']], ['Sodium_Hydroxide', 'is_labeled_as', 'Corrosive', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3']], ['Laboratory', 'contains', 'Glass-Fronted_Storage_Cabinet', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3']], ['Glass-Fronted_Storage_Cabinet', 'contains', 'Chemicals_And_Reagents', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3']], ['Laboratory', 'has', 'Fume_Hood', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3']], ['Glass_Rod', 'stirs', 'Small_Glass_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0']], ['Laboratory', 'contains', 'Lab_Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3']], ['Beaker', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0']], ['Glass_Beaker', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0']]]
2025-11-24 14:31:38,404 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Beige_Sweater",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Rod",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0"
    ]
  ],
  [
    "Person",
    "holds",
    "White_Plastic_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_4"
    ]
  ],
  [
    "Person",
    "adds",
    "Reagent",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1"
    ]
  ],
  [
    "Person",
    "interacts_with",
    "Precision_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2"
    ]
  ],
  [
    "Person",
    "handles",
    "Sodium_Hydroxide",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "contains",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0"
    ]
  ],
  [
    "Glass_Beaker",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "displays",
    "0.180",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Reaction_Mixture",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1"
    ]
  ],
  [
    "Tubing",
    "connects",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1"
    ]
  ],
  [
    "White_Plastic_Bottle",
    "contains",
    "Sodium_Hydroxide",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2"
    ]
  ],
  [
    "Sodium_Hydroxide",
    "has_label",
    "General-Reagent",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_2"
    ]
  ],
  [
    "Sodium_Hydroxide",
    "is_labeled_as",
    "Corrosive",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Glass-Fronted_Storage_Cabinet",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3"
    ]
  ],
  [
    "Glass-Fronted_Storage_Cabinet",
    "contains",
    "Chemicals_And_Reagents",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3"
    ]
  ],
  [
    "Laboratory",
    "has",
    "Fume_Hood",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3"
    ]
  ],
  [
    "Glass_Rod",
    "stirs",
    "Small_Glass_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Lab_Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0"
    ]
  ],
  [
    "Glass_Beaker",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_5_0"
    ]
  ]
]
2025-11-24 14:31:38,404 - src.components.global_refiner - INFO - Refinement complete: 25 → 29 triplets (total: 32.48s, LLM: 32.48s)
2025-11-24 14:31:38,405 - src.pipeline.kg_builder - INFO - Global refinement: 29 triplets in 32.48s
2025-11-24 14:31:38,405 - src.pipeline.kg_builder - INFO - Using 29 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:31:38,405 - src.pipeline.kg_builder - INFO - Pushing batch 6/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:31:38,405 - src.components.neo4j_handler - INFO - Adding 26 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:31:38,615 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:31:38,615 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:31:38,615 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:31:38,615 - src.components.neo4j_handler - INFO - Batch injected in 0.21s (triplets: 0.21s, indexes: 0.00s)
2025-11-24 14:31:38,615 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:31:38,628 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 145 nodes
2025-11-24 14:31:38,647 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 131 nodes
2025-11-24 14:31:38,677 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 145, 'relationship_count': 282, 'density': 0.0135, 'avg_degree': 3.8897, 'avg_unique_neighbors': 3.8483, 'global_efficiency': 0.3211, 'avg_path_length': 2.8164, 'avg_degree_centrality': 0.027, 'max_degree_centrality': 0.4861, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0222, 'degree_assortativity': -0.3328, 'graph_robustness': 0.8227, 'diameter_estimate': 5, 'clustering_coefficient': 0.3251, 'weakly_connected_components': 7, 'largest_wcc_size': 131, 'pagerank_top10_percent': 24.3, 'louvain_communities': 15, 'louvain_modularity': 0.6025, 'label_entropy': 1.354, 'computational_time': 0.06239671795628965}
2025-11-24 14:31:38,677 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 5, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763965898.6779516, 'total_time': 40.86601777601754, 'aggregation': 4.883971996605396e-06, 'network_info': 0.004331045958679169, 'llm_extraction': 40.58855772600509, 'data_cleaning': 1.8435996025800705e-05, 'neo4j_injection': 0.21036027697846293, 'embedding_time': 0, 'indexing_time': 0.0023063039989210665, 'graph_injection_time': 0.20790384599240497, 'acs_metrics': {'node_count': 145, 'relationship_count': 282, 'density': 0.0135, 'avg_degree': 3.8897, 'avg_unique_neighbors': 3.8483, 'global_efficiency': 0.3211, 'avg_path_length': 2.8164, 'avg_degree_centrality': 0.027, 'max_degree_centrality': 0.4861, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0222, 'degree_assortativity': -0.3328, 'graph_robustness': 0.8227, 'diameter_estimate': 5, 'clustering_coefficient': 0.3251, 'weakly_connected_components': 7, 'largest_wcc_size': 131, 'pagerank_top10_percent': 24.3, 'louvain_communities': 15, 'louvain_modularity': 0.6025, 'label_entropy': 1.354, 'computational_time': 0.06239671795628965}, 'retrieval_queries': []}
2025-11-24 14:31:38,678 - src.pipeline.kg_builder - DEBUG - Batch 5 metrics: {
  "batch_idx": 5,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763965898.6779516,
  "total_time": 40.86601777601754,
  "aggregation": 4.883971996605396e-06,
  "network_info": 0.004331045958679169,
  "llm_extraction": 40.58855772600509,
  "data_cleaning": 1.8435996025800705e-05,
  "neo4j_injection": 0.21036027697846293,
  "embedding_time": 0,
  "indexing_time": 0.0023063039989210665,
  "graph_injection_time": 0.20790384599240497,
  "acs_metrics": {
    "node_count": 145,
    "relationship_count": 282,
    "density": 0.0135,
    "avg_degree": 3.8897,
    "avg_unique_neighbors": 3.8483,
    "global_efficiency": 0.3211,
    "avg_path_length": 2.8164,
    "avg_degree_centrality": 0.027,
    "max_degree_centrality": 0.4861,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0222,
    "degree_assortativity": -0.3328,
    "graph_robustness": 0.8227,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.3251,
    "weakly_connected_components": 7,
    "largest_wcc_size": 131,
    "pagerank_top10_percent": 24.3,
    "louvain_communities": 15,
    "louvain_modularity": 0.6025,
    "label_entropy": 1.354,
    "computational_time": 0.06239671795628965
  },
  "retrieval_queries": []
}
2025-11-24 14:31:38,678 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:31:38,678 - src.pipeline.kg_builder - INFO - Batch 6 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 40.59s, Clean: 0.00s, Neo4j: 0.21s, ACS: 0.06s
2025-11-24 14:31:38,678 - src.pipeline.kg_builder - INFO - Batch 6 completed in 40.87s
Processing KG batches:   8%|▊         | 6/72 [03:36<41:37, 37.84s/it]2025-11-24 14:31:38,678 - src.pipeline.kg_builder - INFO - Processing batch 7/72 (3 items)
2025-11-24 14:31:38,678 - src.pipeline.kg_builder - DEBUG - Batch 7 current_video_time: 01:39-01:44
2025-11-24 14:31:38,682 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 145
- Total Relationships: 132
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:31:38,682 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 14:31:38,682 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0 ~214 words, content: Time: 01:29-01:34 Content: The video sequence captures a scientific procedure, likely a chemical experiment, taking place in a laboratory setting. The perspective is first-person, showing...
2025-11-24 14:31:38,682 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1 ~218 words, content: **Preparation for Addition:** The experimenter holds the white bottle, which is labeled as a "GENERAL REAGENT" and has hazard symbols, indicating it contains a chemical...
2025-11-24 14:31:38,682 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2 ~221 words, content: opens the glass enclosure of the balance scale. They then use a small metal spatula to carefully scoop a white, powdery substance from the bottle....
2025-11-24 14:31:38,682 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3 ~132 words, content: substance being added. - **Procedure:** The person uses a small metal spatula to scoop the powder from the bottle. The action is deliberate and controlled,...
2025-11-24 14:31:38,683 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:31:38,683 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0) (~214 words) with timeout=5.0s retries=3
2025-11-24 14:31:40,158 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:31:40,158 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:31:40,158 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1) (~218 words) with timeout=5.0s retries=3
2025-11-24 14:31:41,491 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:31:41,491 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:31:41,491 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2) (~221 words) with timeout=5.0s retries=3
2025-11-24 14:31:42,775 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:31:42,775 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:31:42,776 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3) (~132 words) with timeout=5.0s retries=3
2025-11-24 14:31:43,730 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:31:43,730 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:31:43,730 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-24 14:31:43,730 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 5.05s
2025-11-24 14:31:43,730 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 145
- Total Relationships: 132
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Experimenter", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0"]}, {"head": "Experimenter", "relation": "Holds", "tail": "White Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0"]}, {"head": "White Bottle", "relation": "Contains", "tail": "White Solid Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Precision Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0"]}, {"head": "Precision Balance", "relation": "Displays", "tail": "56.303 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0"]}, {"head": "Experimenter", "relation": "Tares", "tail": "Precision Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0"]}, {"head": "Experimenter", "relation": "Holds", "tail": "Reagent Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1"]}, {"head": "Reagent Bottle", "relation": "Has Label", "tail": "General Reagent", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1"]}, {"head": "Reagent Bottle", "relation": "Has Hazard Symbols", "tail": "Chemical Hazard", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Balance Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1"]}, {"head": "Experimenter", "relation": "Prepares To Add", "tail": "Chemical", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1"]}, {"head": "Person", "relation": "Observes", "tail": "Experiment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2"]}, {"head": "Person", "relation": "Opens", "tail": "Glass Enclosure", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2"]}, {"head": "Person", "relation": "Uses", "tail": "Metal Spatula", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2"]}, {"head": "Person", "relation": "Transfers", "tail": "White Powdery Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2"]}, {"head": "White Powdery Substance", "relation": "Is Placed In", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital Balance Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2"]}, {"head": "Person", "relation": "Uses", "tail": "Spatula", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3"]}, {"head": "Spatula", "relation": "Scoops", "tail": "Powder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3"]}, {"head": "Powder", "relation": "Comes From", "tail": "Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3"]}, {"head": "Table", "relation": "Contains", "tail": "Pen", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3"]}, {"head": "Table", "relation": "Contains", "tail": "Paper", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:31:43,730 - src.components.global_refiner - DEBUG - Refining 24 triplets (prompt ~344 words, ~447 tokens)
2025-11-24 14:31:43,730 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:32:09,712 - src.components.global_refiner - DEBUG - LLM call completed in 25.98s
2025-11-24 14:32:09,712 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Experimenter', 'wears', 'Blue Nitrile Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0']], ['Experimenter', 'holds', 'White Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0']], ['White Bottle', 'contains', 'White Solid Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0']], ['Beaker', 'is_on', 'Precision Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0']], ['Precision Balance', 'displays', '56.303 G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0']], ['Experimenter', 'tare', 'Precision Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0']], ['Experimenter', 'holds', 'Reagent Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1']], ['Reagent Bottle', 'has_label', 'General Reagent', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1']], ['Reagent Bottle', 'has_hazard_symbols', 'Chemical Hazard', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1']], ['Beaker', 'is_on', 'Balance Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1']], ['Experimenter', 'prepares_to_add', 'Chemical', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1']], ['Person', 'observes', 'Experiment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1']], ['Person', 'wears', 'Blue Nitrile Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2']], ['Person', 'opens', 'Glass Enclosure', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2']], ['Person', 'uses', 'Metal Spatula', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2']], ['Person', 'transfers', 'White Powdery Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2']], ['White Powdery Substance', 'is_placed_in', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2']], ['Beaker', 'is_on', 'Digital Balance Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2']], ['Person', 'uses', 'Spatula', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3']], ['Spatula', 'scoops', 'Powder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3']], ['Powder', 'comes_from', 'Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3']], ['Person', 'wears', 'Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3']], ['Table', 'contains', 'Pen', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3']], ['Table', 'contains', 'Paper', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3']]]
2025-11-24 14:32:09,712 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Experimenter",
    "wears",
    "Blue Nitrile Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0"
    ]
  ],
  [
    "Experimenter",
    "holds",
    "White Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0"
    ]
  ],
  [
    "White Bottle",
    "contains",
    "White Solid Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Precision Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0"
    ]
  ],
  [
    "Precision Balance",
    "displays",
    "56.303 G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0"
    ]
  ],
  [
    "Experimenter",
    "tare",
    "Precision Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_0"
    ]
  ],
  [
    "Experimenter",
    "holds",
    "Reagent Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1"
    ]
  ],
  [
    "Reagent Bottle",
    "has_label",
    "General Reagent",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1"
    ]
  ],
  [
    "Reagent Bottle",
    "has_hazard_symbols",
    "Chemical Hazard",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Balance Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1"
    ]
  ],
  [
    "Experimenter",
    "prepares_to_add",
    "Chemical",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1"
    ]
  ],
  [
    "Person",
    "observes",
    "Experiment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Nitrile Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2"
    ]
  ],
  [
    "Person",
    "opens",
    "Glass Enclosure",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Metal Spatula",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2"
    ]
  ],
  [
    "Person",
    "transfers",
    "White Powdery Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2"
    ]
  ],
  [
    "White Powdery Substance",
    "is_placed_in",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital Balance Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Spatula",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3"
    ]
  ],
  [
    "Spatula",
    "scoops",
    "Powder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3"
    ]
  ],
  [
    "Powder",
    "comes_from",
    "Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3"
    ]
  ],
  [
    "Table",
    "contains",
    "Pen",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3"
    ]
  ],
  [
    "Table",
    "contains",
    "Paper",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_6_3"
    ]
  ]
]
2025-11-24 14:32:09,712 - src.components.global_refiner - INFO - Refinement complete: 24 → 24 triplets (total: 25.98s, LLM: 25.98s)
2025-11-24 14:32:09,712 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 25.98s
2025-11-24 14:32:09,712 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:32:09,712 - src.pipeline.kg_builder - INFO - Pushing batch 7/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:32:09,712 - src.components.neo4j_handler - INFO - Adding 24 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:32:09,991 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:32:09,991 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:32:09,992 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:32:09,992 - src.components.neo4j_handler - INFO - Batch injected in 0.28s (triplets: 0.28s, indexes: 0.00s)
2025-11-24 14:32:09,992 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:32:10,010 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 166 nodes
2025-11-24 14:32:10,047 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 161 nodes
2025-11-24 14:32:10,093 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 166, 'relationship_count': 336, 'density': 0.0123, 'avg_degree': 4.0482, 'avg_unique_neighbors': 4.012, 'global_efficiency': 0.3445, 'avg_path_length': 3.0924, 'avg_degree_centrality': 0.0245, 'max_degree_centrality': 0.4788, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.014, 'degree_assortativity': -0.3262, 'graph_robustness': 0.8214, 'diameter_estimate': 7, 'clustering_coefficient': 0.3259, 'weakly_connected_components': 6, 'largest_wcc_size': 161, 'pagerank_top10_percent': 21.08, 'louvain_communities': 16, 'louvain_modularity': 0.6074, 'label_entropy': 1.3536, 'computational_time': 0.10107603896176443}
2025-11-24 14:32:10,093 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 6, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763965930.0935166, 'total_time': 31.41504430101486, 'aggregation': 2.655026037245989e-06, 'network_info': 0.003884397039655596, 'llm_extraction': 31.030344411963597, 'data_cleaning': 1.824001083150506e-05, 'neo4j_injection': 0.2794283420080319, 'embedding_time': 0, 'indexing_time': 0.004145834012888372, 'graph_injection_time': 0.2751231149886735, 'acs_metrics': {'node_count': 166, 'relationship_count': 336, 'density': 0.0123, 'avg_degree': 4.0482, 'avg_unique_neighbors': 4.012, 'global_efficiency': 0.3445, 'avg_path_length': 3.0924, 'avg_degree_centrality': 0.0245, 'max_degree_centrality': 0.4788, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.014, 'degree_assortativity': -0.3262, 'graph_robustness': 0.8214, 'diameter_estimate': 7, 'clustering_coefficient': 0.3259, 'weakly_connected_components': 6, 'largest_wcc_size': 161, 'pagerank_top10_percent': 21.08, 'louvain_communities': 16, 'louvain_modularity': 0.6074, 'label_entropy': 1.3536, 'computational_time': 0.10107603896176443}, 'retrieval_queries': []}
2025-11-24 14:32:10,093 - src.pipeline.kg_builder - DEBUG - Batch 6 metrics: {
  "batch_idx": 6,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763965930.0935166,
  "total_time": 31.41504430101486,
  "aggregation": 2.655026037245989e-06,
  "network_info": 0.003884397039655596,
  "llm_extraction": 31.030344411963597,
  "data_cleaning": 1.824001083150506e-05,
  "neo4j_injection": 0.2794283420080319,
  "embedding_time": 0,
  "indexing_time": 0.004145834012888372,
  "graph_injection_time": 0.2751231149886735,
  "acs_metrics": {
    "node_count": 166,
    "relationship_count": 336,
    "density": 0.0123,
    "avg_degree": 4.0482,
    "avg_unique_neighbors": 4.012,
    "global_efficiency": 0.3445,
    "avg_path_length": 3.0924,
    "avg_degree_centrality": 0.0245,
    "max_degree_centrality": 0.4788,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.014,
    "degree_assortativity": -0.3262,
    "graph_robustness": 0.8214,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.3259,
    "weakly_connected_components": 6,
    "largest_wcc_size": 161,
    "pagerank_top10_percent": 21.08,
    "louvain_communities": 16,
    "louvain_modularity": 0.6074,
    "label_entropy": 1.3536,
    "computational_time": 0.10107603896176443
  },
  "retrieval_queries": []
}
2025-11-24 14:32:10,093 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:32:10,093 - src.pipeline.kg_builder - INFO - Batch 7 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 31.03s, Clean: 0.00s, Neo4j: 0.28s, ACS: 0.10s
2025-11-24 14:32:10,093 - src.pipeline.kg_builder - INFO - Batch 7 completed in 31.42s
Processing KG batches:  10%|▉         | 7/72 [04:07<38:42, 35.74s/it]2025-11-24 14:32:10,094 - src.pipeline.kg_builder - INFO - Processing batch 8/72 (3 items)
2025-11-24 14:32:10,094 - src.pipeline.kg_builder - DEBUG - Batch 8 current_video_time: 01:54-01:59
2025-11-24 14:32:10,098 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 166
- Total Relationships: 155
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:32:10,098 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-24 14:32:10,099 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0 ~236 words, content: Time: 01:44-01:49 Content: The video shows a person in a laboratory setting performing a precise measurement. The scene is viewed from a first-person perspective, focusing...
2025-11-24 14:32:10,099 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1 ~229 words, content: from air currents. The person uses a small metal spatula to scoop the powder from a white container with a red lid. The powder is...
2025-11-24 14:32:10,099 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2 ~91 words, content: , indicating a need for accuracy. - **Environment:** The scene is a laboratory, identifiable by the workbench, cabinets, and a fire extinguisher visible in the...
2025-11-24 14:32:10,099 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:32:10,099 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0) (~236 words) with timeout=5.0s retries=3
2025-11-24 14:32:11,306 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:32:11,306 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:32:11,306 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1) (~229 words) with timeout=5.0s retries=3
2025-11-24 14:32:12,455 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:32:12,455 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:32:12,455 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2) (~91 words) with timeout=5.0s retries=3
2025-11-24 14:32:13,582 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:32:13,582 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:32:13,582 - src.components.pre_llm_injector - INFO - Extracted 18 local triplets from 3 chunks
2025-11-24 14:32:13,582 - src.pipeline.kg_builder - INFO - Pre-extraction: 18 triplets in 3.48s
2025-11-24 14:32:13,583 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 166
- Total Relationships: 155
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0"]}, {"head": "Person", "relation": "Holds", "tail": "Plastic Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0"]}, {"head": "Person", "relation": "Uses", "tail": "Metal Spatula", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0"]}, {"head": "Plastic Bottle", "relation": "Contains", "tail": "White Powder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Balance Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0"]}, {"head": "Balance Scale", "relation": "Is Inside", "tail": "Glass Draft Shield", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1"]}, {"head": "Person", "relation": "Holds", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1"]}, {"head": "Person", "relation": "Uses", "tail": "Spatula", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1"]}, {"head": "Container", "relation": "Contains", "tail": "Powder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1"]}, {"head": "Powder", "relation": "Is Transferred To", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Workbench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Cabinets", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Fire Extinguisher", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2"]}, {"head": "Person", "relation": "Performs", "tail": "Weighing By Difference", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2"]}, {"head": "Glass Shield", "relation": "Prevents", "tail": "Powder Loss", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:32:13,583 - src.components.global_refiner - DEBUG - Refining 18 triplets (prompt ~279 words, ~363 tokens)
2025-11-24 14:32:13,583 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:32:33,070 - src.components.global_refiner - DEBUG - LLM call completed in 19.49s
2025-11-24 14:32:33,070 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1']], ['Person', 'holds', 'Plastic_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0']], ['Person', 'holds', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1']], ['Person', 'uses', 'Metal_Spatula', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0']], ['Person', 'uses', 'Spatula', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1']], ['Person', 'wears', 'Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2']], ['Plastic_Bottle', 'contains', 'White_Powder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0']], ['Container', 'contains', 'Powder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1']], ['Powder', 'is_transferred_to', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1']], ['Beaker', 'is_on', 'Balance_Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0']], ['Beaker', 'is_on', 'Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1']], ['Balance_Scale', 'is_inside', 'Glass_Draft_Shield', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0']], ['Glass_Draft_Shield', 'prevents', 'Powder_Loss', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2']], ['Laboratory', 'contains', 'Workbench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2']], ['Laboratory', 'contains', 'Cabinets', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2']], ['Laboratory', 'contains', 'Fire_Extinguisher', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2']], ['Person', 'performs', 'Weighing_By_Difference', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2']]]
2025-11-24 14:32:33,070 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Plastic_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Metal_Spatula",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Spatula",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2"
    ]
  ],
  [
    "Plastic_Bottle",
    "contains",
    "White_Powder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0"
    ]
  ],
  [
    "Container",
    "contains",
    "Powder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1"
    ]
  ],
  [
    "Powder",
    "is_transferred_to",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Balance_Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_1"
    ]
  ],
  [
    "Balance_Scale",
    "is_inside",
    "Glass_Draft_Shield",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_0"
    ]
  ],
  [
    "Glass_Draft_Shield",
    "prevents",
    "Powder_Loss",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Workbench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Cabinets",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Fire_Extinguisher",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2"
    ]
  ],
  [
    "Person",
    "performs",
    "Weighing_By_Difference",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_7_2"
    ]
  ]
]
2025-11-24 14:32:33,070 - src.components.global_refiner - INFO - Refinement complete: 18 → 17 triplets (total: 19.49s, LLM: 19.49s)
2025-11-24 14:32:33,070 - src.pipeline.kg_builder - INFO - Global refinement: 17 triplets in 19.49s
2025-11-24 14:32:33,070 - src.pipeline.kg_builder - INFO - Using 17 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:32:33,070 - src.pipeline.kg_builder - INFO - Pushing batch 8/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:32:33,071 - src.components.neo4j_handler - INFO - Adding 17 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:32:33,253 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:32:33,253 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:32:33,253 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:32:33,253 - src.components.neo4j_handler - INFO - Batch injected in 0.18s (triplets: 0.18s, indexes: 0.00s)
2025-11-24 14:32:33,253 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:32:33,267 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 177 nodes
2025-11-24 14:32:33,298 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 172 nodes
2025-11-24 14:32:33,339 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 177, 'relationship_count': 371, 'density': 0.0119, 'avg_degree': 4.1921, 'avg_unique_neighbors': 4.1582, 'global_efficiency': 0.3478, 'avg_path_length': 3.0656, 'avg_degree_centrality': 0.0238, 'max_degree_centrality': 0.483, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0069, 'degree_assortativity': -0.3244, 'graph_robustness': 0.8221, 'diameter_estimate': 7, 'clustering_coefficient': 0.3212, 'weakly_connected_components': 6, 'largest_wcc_size': 172, 'pagerank_top10_percent': 19.91, 'louvain_communities': 15, 'louvain_modularity': 0.5844, 'label_entropy': 1.3587, 'computational_time': 0.08629746199585497}
2025-11-24 14:32:33,339 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 7, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763965953.3399754, 'total_time': 23.245920917019248, 'aggregation': 2.9199873097240925e-06, 'network_info': 0.004507416975684464, 'llm_extraction': 22.9721990179969, 'data_cleaning': 1.2792006600648165e-05, 'neo4j_injection': 0.18262061901623383, 'embedding_time': 0, 'indexing_time': 0.004780793969985098, 'graph_injection_time': 0.17770109698176384, 'acs_metrics': {'node_count': 177, 'relationship_count': 371, 'density': 0.0119, 'avg_degree': 4.1921, 'avg_unique_neighbors': 4.1582, 'global_efficiency': 0.3478, 'avg_path_length': 3.0656, 'avg_degree_centrality': 0.0238, 'max_degree_centrality': 0.483, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0069, 'degree_assortativity': -0.3244, 'graph_robustness': 0.8221, 'diameter_estimate': 7, 'clustering_coefficient': 0.3212, 'weakly_connected_components': 6, 'largest_wcc_size': 172, 'pagerank_top10_percent': 19.91, 'louvain_communities': 15, 'louvain_modularity': 0.5844, 'label_entropy': 1.3587, 'computational_time': 0.08629746199585497}, 'retrieval_queries': []}
2025-11-24 14:32:33,340 - src.pipeline.kg_builder - DEBUG - Batch 7 metrics: {
  "batch_idx": 7,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763965953.3399754,
  "total_time": 23.245920917019248,
  "aggregation": 2.9199873097240925e-06,
  "network_info": 0.004507416975684464,
  "llm_extraction": 22.9721990179969,
  "data_cleaning": 1.2792006600648165e-05,
  "neo4j_injection": 0.18262061901623383,
  "embedding_time": 0,
  "indexing_time": 0.004780793969985098,
  "graph_injection_time": 0.17770109698176384,
  "acs_metrics": {
    "node_count": 177,
    "relationship_count": 371,
    "density": 0.0119,
    "avg_degree": 4.1921,
    "avg_unique_neighbors": 4.1582,
    "global_efficiency": 0.3478,
    "avg_path_length": 3.0656,
    "avg_degree_centrality": 0.0238,
    "max_degree_centrality": 0.483,
    "avg_betweenness_centrality": 0.0002,
    "max_betweenness_centrality": 0.0069,
    "degree_assortativity": -0.3244,
    "graph_robustness": 0.8221,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.3212,
    "weakly_connected_components": 6,
    "largest_wcc_size": 172,
    "pagerank_top10_percent": 19.91,
    "louvain_communities": 15,
    "louvain_modularity": 0.5844,
    "label_entropy": 1.3587,
    "computational_time": 0.08629746199585497
  },
  "retrieval_queries": []
}
2025-11-24 14:32:33,340 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:32:33,340 - src.pipeline.kg_builder - INFO - Batch 8 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 22.97s, Clean: 0.00s, Neo4j: 0.18s, ACS: 0.09s
2025-11-24 14:32:33,340 - src.pipeline.kg_builder - INFO - Batch 8 completed in 23.25s
Processing KG batches:  11%|█         | 8/72 [04:31<33:52, 31.76s/it]2025-11-24 14:32:33,340 - src.pipeline.kg_builder - INFO - Processing batch 9/72 (3 items)
2025-11-24 14:32:33,340 - src.pipeline.kg_builder - DEBUG - Batch 9 current_video_time: 02:09-02:14
2025-11-24 14:32:33,350 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 177
- Total Relationships: 167
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:32:33,350 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-24 14:32:33,350 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0 ~222 words, content: Time: 01:59-02:04 Content: The video sequence captures a precise laboratory procedure, likely the weighing of a solid chemical. The scene is set in a laboratory...
2025-11-24 14:32:33,350 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1 ~222 words, content: **Final Steps:** After adding the desired amount of the substance, the person closes the glass draft shield. The video ends with the person having completed...
2025-11-24 14:32:33,351 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2 ~209 words, content: spatula to carefully scoop the powder from the bottle and deposit it into the beaker. The digital display of the balance shows a reading of...
2025-11-24 14:32:33,351 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:32:33,351 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0) (~222 words) with timeout=5.0s retries=3
2025-11-24 14:32:34,838 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:32:34,838 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:32:34,838 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1) (~222 words) with timeout=5.0s retries=3
2025-11-24 14:32:35,913 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:32:35,913 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:32:35,914 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2) (~209 words) with timeout=5.0s retries=3
2025-11-24 14:32:37,107 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:32:37,107 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:32:37,107 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 3 chunks
2025-11-24 14:32:37,107 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 3.76s
2025-11-24 14:32:37,107 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 177
- Total Relationships: 167
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0"]}, {"head": "Person", "relation": "Holds", "tail": "White_Plastic_Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0"]}, {"head": "Person", "relation": "Uses", "tail": "Metal_Spoon", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0"]}, {"head": "Person", "relation": "Adds", "tail": "White_Powder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0"]}, {"head": "White_Powder", "relation": "Is Transferred To", "tail": "Glass_Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0"]}, {"head": "Glass_Beaker", "relation": "Is On", "tail": "Balance_Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2"]}, {"head": "Person", "relation": "Uses", "tail": "Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1"]}, {"head": "Balance", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "White Powder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1"]}, {"head": "Person", "relation": "Transfers", "tail": "White Powder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1"]}, {"head": "White Powder", "relation": "Is In", "tail": "Reagent Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1"]}, {"head": "Person", "relation": "Uses", "tail": "Spatula", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2"]}, {"head": "Spatula", "relation": "Transfers", "tail": "Powder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2"]}, {"head": "Powder", "relation": "Is Deposited In", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2"]}, {"head": "Beaker", "relation": "Is On", "tail": "Analytical Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2"]}, {"head": "Analytical Balance", "relation": "Displays", "tail": "Weight", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:32:37,107 - src.components.global_refiner - DEBUG - Refining 17 triplets (prompt ~267 words, ~347 tokens)
2025-11-24 14:32:37,107 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:32:56,188 - src.components.global_refiner - DEBUG - LLM call completed in 19.08s
2025-11-24 14:32:56,188 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2']], ['Person', 'holds', 'White_Plastic_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0']], ['Person', 'uses', 'Metal_Spoon', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0']], ['Person', 'adds', 'White_Powder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0']], ['White_Powder', 'is_transferred_to', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0']], ['Glass_Beaker', 'is_on', 'Balance_Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0']], ['Person', 'uses', 'Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1']], ['Balance', 'contains', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1']], ['Beaker', 'contains', 'White_Powder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1']], ['Person', 'transfers', 'White_Powder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1']], ['White_Powder', 'is_in', 'Reagent_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1']], ['Person', 'uses', 'Spatula', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2']], ['Spatula', 'transfers', 'Powder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2']], ['Powder', 'is_deposited_in', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2']], ['Beaker', 'is_on', 'Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2']], ['Analytical_Balance', 'displays', 'Weight', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2']]]
2025-11-24 14:32:56,188 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2"
    ]
  ],
  [
    "Person",
    "holds",
    "White_Plastic_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Metal_Spoon",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0"
    ]
  ],
  [
    "Person",
    "adds",
    "White_Powder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0"
    ]
  ],
  [
    "White_Powder",
    "is_transferred_to",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0"
    ]
  ],
  [
    "Glass_Beaker",
    "is_on",
    "Balance_Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1"
    ]
  ],
  [
    "Balance",
    "contains",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "White_Powder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1"
    ]
  ],
  [
    "Person",
    "transfers",
    "White_Powder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1"
    ]
  ],
  [
    "White_Powder",
    "is_in",
    "Reagent_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Spatula",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2"
    ]
  ],
  [
    "Spatula",
    "transfers",
    "Powder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2"
    ]
  ],
  [
    "Powder",
    "is_deposited_in",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2"
    ]
  ],
  [
    "Analytical_Balance",
    "displays",
    "Weight",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_8_2"
    ]
  ]
]
2025-11-24 14:32:56,188 - src.components.global_refiner - INFO - Refinement complete: 17 → 16 triplets (total: 19.08s, LLM: 19.08s)
2025-11-24 14:32:56,188 - src.pipeline.kg_builder - INFO - Global refinement: 16 triplets in 19.08s
2025-11-24 14:32:56,188 - src.pipeline.kg_builder - INFO - Using 16 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:32:56,188 - src.pipeline.kg_builder - INFO - Pushing batch 9/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:32:56,188 - src.components.neo4j_handler - INFO - Adding 16 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:32:56,318 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:32:56,318 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:32:56,319 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:32:56,319 - src.components.neo4j_handler - INFO - Batch injected in 0.13s (triplets: 0.12s, indexes: 0.01s)
2025-11-24 14:32:56,319 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:32:56,334 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 183 nodes
2025-11-24 14:32:56,368 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 178 nodes
2025-11-24 14:32:56,412 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 183, 'relationship_count': 400, 'density': 0.012, 'avg_degree': 4.3716, 'avg_unique_neighbors': 4.3388, 'global_efficiency': 0.3516, 'avg_path_length': 3.0373, 'avg_degree_centrality': 0.024, 'max_degree_centrality': 0.4945, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0167, 'degree_assortativity': -0.3162, 'graph_robustness': 0.825, 'diameter_estimate': 7, 'clustering_coefficient': 0.3195, 'weakly_connected_components': 6, 'largest_wcc_size': 178, 'pagerank_top10_percent': 19.19, 'louvain_communities': 16, 'louvain_modularity': 0.5647, 'label_entropy': 1.3685, 'computational_time': 0.09280126699013636}
2025-11-24 14:32:56,412 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 8, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763965976.4123907, 'total_time': 23.071888345992193, 'aggregation': 2.5400076992809772e-06, 'network_info': 0.009938155009876937, 'llm_extraction': 22.83812697295798, 'data_cleaning': 1.322402385994792e-05, 'neo4j_injection': 0.13070165598765016, 'embedding_time': 0, 'indexing_time': 0.005689519981388003, 'graph_injection_time': 0.12486724997870624, 'acs_metrics': {'node_count': 183, 'relationship_count': 400, 'density': 0.012, 'avg_degree': 4.3716, 'avg_unique_neighbors': 4.3388, 'global_efficiency': 0.3516, 'avg_path_length': 3.0373, 'avg_degree_centrality': 0.024, 'max_degree_centrality': 0.4945, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0167, 'degree_assortativity': -0.3162, 'graph_robustness': 0.825, 'diameter_estimate': 7, 'clustering_coefficient': 0.3195, 'weakly_connected_components': 6, 'largest_wcc_size': 178, 'pagerank_top10_percent': 19.19, 'louvain_communities': 16, 'louvain_modularity': 0.5647, 'label_entropy': 1.3685, 'computational_time': 0.09280126699013636}, 'retrieval_queries': []}
2025-11-24 14:32:56,412 - src.pipeline.kg_builder - DEBUG - Batch 8 metrics: {
  "batch_idx": 8,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763965976.4123907,
  "total_time": 23.071888345992193,
  "aggregation": 2.5400076992809772e-06,
  "network_info": 0.009938155009876937,
  "llm_extraction": 22.83812697295798,
  "data_cleaning": 1.322402385994792e-05,
  "neo4j_injection": 0.13070165598765016,
  "embedding_time": 0,
  "indexing_time": 0.005689519981388003,
  "graph_injection_time": 0.12486724997870624,
  "acs_metrics": {
    "node_count": 183,
    "relationship_count": 400,
    "density": 0.012,
    "avg_degree": 4.3716,
    "avg_unique_neighbors": 4.3388,
    "global_efficiency": 0.3516,
    "avg_path_length": 3.0373,
    "avg_degree_centrality": 0.024,
    "max_degree_centrality": 0.4945,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0167,
    "degree_assortativity": -0.3162,
    "graph_robustness": 0.825,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.3195,
    "weakly_connected_components": 6,
    "largest_wcc_size": 178,
    "pagerank_top10_percent": 19.19,
    "louvain_communities": 16,
    "louvain_modularity": 0.5647,
    "label_entropy": 1.3685,
    "computational_time": 0.09280126699013636
  },
  "retrieval_queries": []
}
2025-11-24 14:32:56,412 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:32:56,412 - src.pipeline.kg_builder - INFO - Batch 9 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 22.84s, Clean: 0.00s, Neo4j: 0.13s, ACS: 0.09s
2025-11-24 14:32:56,412 - src.pipeline.kg_builder - INFO - Batch 9 completed in 23.07s
Processing KG batches:  12%|█▎        | 9/72 [04:54<30:29, 29.04s/it]2025-11-24 14:32:56,412 - src.pipeline.kg_builder - INFO - Processing batch 10/72 (3 items)
2025-11-24 14:32:56,413 - src.pipeline.kg_builder - DEBUG - Batch 10 current_video_time: 02:24-02:29
2025-11-24 14:32:56,416 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 183
- Total Relationships: 179
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:32:56,417 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-24 14:32:56,417 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0 ~203 words, content: Time: 02:14-02:19 Content: The video captures a precise laboratory procedure, likely the preparation of a chemical solution or a standard sample. The sequence of frames...
2025-11-24 14:32:56,417 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1 ~209 words, content: the white powder. The display shows `20.23`, indicating the final mass of the substance added to the beaker. - **Final Measurement (Frame 5):** The person...
2025-11-24 14:32:56,417 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2 ~221 words, content: to carefully add a white, powdery substance into a glass beaker. The beaker is placed on a digital balance scale, a Mettler Toledo model, which...
2025-11-24 14:32:56,417 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3 ~239 words, content: in the beaker after the addition. The person is in the process of completing the weighing step. In summary, the video documents the careful and...
2025-11-24 14:32:56,417 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_4 ~246 words, content: substance. The background shows a laboratory environment with various equipment and supplies, including a box labeled "Dell" and a yellow bag. In the second frame,...
2025-11-24 14:32:56,417 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_5 ~244 words, content: been measured. The person's right hand is placing the bottle on the table, while the left hand is holding the bottle. The beaker is still...
2025-11-24 14:32:56,417 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:32:56,417 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0) (~203 words) with timeout=5.0s retries=3
2025-11-24 14:32:58,043 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:32:58,044 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:32:58,044 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1) (~209 words) with timeout=5.0s retries=3
2025-11-24 14:32:59,275 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:32:59,275 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:32:59,276 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2) (~221 words) with timeout=5.0s retries=3
2025-11-24 14:33:00,564 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:33:00,564 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:33:00,565 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3) (~239 words) with timeout=5.0s retries=3
2025-11-24 14:33:01,825 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:33:01,826 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:33:01,826 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_4) (~246 words) with timeout=5.0s retries=3
2025-11-24 14:33:03,051 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:33:03,051 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:33:03,052 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_5) (~244 words) with timeout=5.0s retries=3
2025-11-24 14:33:04,136 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-24 14:33:04,136 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-24 14:33:04,136 - src.components.pre_llm_injector - INFO - Extracted 30 local triplets from 6 chunks
2025-11-24 14:33:04,136 - src.pipeline.kg_builder - INFO - Pre-extraction: 30 triplets in 7.72s
2025-11-24 14:33:04,137 - src.components.global_refiner - INFO - Capping refinement input: 30 → 25 triplets
2025-11-24 14:33:04,137 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 183
- Total Relationships: 179
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0"]}, {"head": "Person", "relation": "Holds", "tail": "Metal_Spatula", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0"]}, {"head": "Metal_Spatula", "relation": "Contains", "tail": "White_Powder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Analytical_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0"]}, {"head": "Analytical_Balance", "relation": "Displays", "tail": "20.20", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0"]}, {"head": "Analytical_Balance", "relation": "Displays", "tail": "20.23", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0"]}, {"head": "Person", "relation": "Adds", "tail": "White Powder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1"]}, {"head": "Balance", "relation": "Displays", "tail": "80.14", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "White Powder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1"]}, {"head": "Person", "relation": "Holds", "tail": "Spatula", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_4"]}, {"head": "Balance", "relation": "Displays", "tail": "20.23", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2"]}, {"head": "Person", "relation": "Holds", "tail": "White Plastic Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3"]}, {"head": "White Plastic Bottle", "relation": "Contains", "tail": "White Powder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2"]}, {"head": "Person", "relation": "Uses", "tail": "Metal Spatula", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2"]}, {"head": "Metal Spatula", "relation": "Holds", "tail": "White Powder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2"]}, {"head": "Digital Balance Scale", "relation": "Displays", "tail": "80.14", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2"]}, {"head": "Person", "relation": "Uses", "tail": "Spatula", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_5"]}, {"head": "Person", "relation": "Transfers", "tail": "White Powdery Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "White Powdery Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass Of Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3"]}, {"head": "Person", "relation": "Holds", "tail": "Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_4", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_5"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_4", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_5"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:33:04,137 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~345 words, ~448 tokens)
2025-11-24 14:33:04,137 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:33:35,022 - src.components.global_refiner - DEBUG - LLM call completed in 30.89s
2025-11-24 14:33:35,023 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3']], ['Person', 'holds', 'Metal_Spatula', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0']], ['Metal_Spatula', 'contains', 'White_Powder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0']], ['Beaker', 'is_on', 'Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0']], ['Analytical_Balance', 'displays', '20.20', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0']], ['Analytical_Balance', 'displays', '20.23', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0']], ['Person', 'adds', 'White_Powder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1']], ['Balance', 'displays', '80.14', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1']], ['Beaker', 'contains', 'White_Powder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1']], ['Person', 'holds', 'Spatula', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_4']], ['Balance', 'displays', '20.23', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1']], ['Person', 'holds', 'White_Plastic_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3']], ['White_Plastic_Bottle', 'contains', 'White_Powder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2']], ['Person', 'uses', 'Metal_Spatula', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2']], ['Metal_Spatula', 'holds', 'White_Powder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2']], ['Digital_Balance_Scale', 'displays', '80.14', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2']], ['Person', 'uses', 'Spatula', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_5']], ['Person', 'transfers', 'White_Powdery_Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3']], ['Beaker', 'contains', 'White_Powdery_Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3']], ['Digital_Balance', 'measures', 'Mass_Of_Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3']], ['Person', 'holds', 'Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_4', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_5']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_4', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_5']], ['Beaker', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_4']]]
2025-11-24 14:33:35,023 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Metal_Spatula",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0"
    ]
  ],
  [
    "Metal_Spatula",
    "contains",
    "White_Powder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0"
    ]
  ],
  [
    "Analytical_Balance",
    "displays",
    "20.20",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0"
    ]
  ],
  [
    "Analytical_Balance",
    "displays",
    "20.23",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_0"
    ]
  ],
  [
    "Person",
    "adds",
    "White_Powder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1"
    ]
  ],
  [
    "Balance",
    "displays",
    "80.14",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "White_Powder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Spatula",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_4"
    ]
  ],
  [
    "Balance",
    "displays",
    "20.23",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_1"
    ]
  ],
  [
    "Person",
    "holds",
    "White_Plastic_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3"
    ]
  ],
  [
    "White_Plastic_Bottle",
    "contains",
    "White_Powder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Metal_Spatula",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2"
    ]
  ],
  [
    "Metal_Spatula",
    "holds",
    "White_Powder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2"
    ]
  ],
  [
    "Digital_Balance_Scale",
    "displays",
    "80.14",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Spatula",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_5"
    ]
  ],
  [
    "Person",
    "transfers",
    "White_Powdery_Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "White_Powdery_Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Mass_Of_Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_4",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_5"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_4",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_5"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_9_4"
    ]
  ]
]
2025-11-24 14:33:35,023 - src.components.global_refiner - INFO - Refinement complete: 25 → 23 triplets (total: 30.89s, LLM: 30.89s)
2025-11-24 14:33:35,023 - src.pipeline.kg_builder - INFO - Global refinement: 23 triplets in 30.89s
2025-11-24 14:33:35,023 - src.pipeline.kg_builder - INFO - Using 23 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:33:35,023 - src.pipeline.kg_builder - INFO - Pushing batch 10/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:33:35,023 - src.components.neo4j_handler - INFO - Adding 23 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:33:35,250 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:33:35,250 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:33:35,251 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:33:35,251 - src.components.neo4j_handler - INFO - Batch injected in 0.23s (triplets: 0.22s, indexes: 0.00s)
2025-11-24 14:33:35,251 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:33:35,268 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 195 nodes
2025-11-24 14:33:35,308 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 190 nodes
2025-11-24 14:33:35,359 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 195, 'relationship_count': 450, 'density': 0.0119, 'avg_degree': 4.6154, 'avg_unique_neighbors': 4.5846, 'global_efficiency': 0.3549, 'avg_path_length': 3.014, 'avg_degree_centrality': 0.0238, 'max_degree_centrality': 0.5, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0127, 'degree_assortativity': -0.2955, 'graph_robustness': 0.82, 'diameter_estimate': 7, 'clustering_coefficient': 0.3129, 'weakly_connected_components': 6, 'largest_wcc_size': 190, 'pagerank_top10_percent': 18.16, 'louvain_communities': 16, 'louvain_modularity': 0.5533, 'label_entropy': 1.3852, 'computational_time': 0.10830306599382311}
2025-11-24 14:33:35,359 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 9, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966015.359643, 'total_time': 38.94666151801357, 'aggregation': 4.167028237134218e-06, 'network_info': 0.0036270919954404235, 'llm_extraction': 38.60653649200685, 'data_cleaning': 1.605600118637085e-05, 'neo4j_injection': 0.22783726500347257, 'embedding_time': 0, 'indexing_time': 0.0037978909676894546, 'graph_injection_time': 0.2239006430027075, 'acs_metrics': {'node_count': 195, 'relationship_count': 450, 'density': 0.0119, 'avg_degree': 4.6154, 'avg_unique_neighbors': 4.5846, 'global_efficiency': 0.3549, 'avg_path_length': 3.014, 'avg_degree_centrality': 0.0238, 'max_degree_centrality': 0.5, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0127, 'degree_assortativity': -0.2955, 'graph_robustness': 0.82, 'diameter_estimate': 7, 'clustering_coefficient': 0.3129, 'weakly_connected_components': 6, 'largest_wcc_size': 190, 'pagerank_top10_percent': 18.16, 'louvain_communities': 16, 'louvain_modularity': 0.5533, 'label_entropy': 1.3852, 'computational_time': 0.10830306599382311}, 'retrieval_queries': []}
2025-11-24 14:33:35,359 - src.pipeline.kg_builder - DEBUG - Batch 9 metrics: {
  "batch_idx": 9,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966015.359643,
  "total_time": 38.94666151801357,
  "aggregation": 4.167028237134218e-06,
  "network_info": 0.0036270919954404235,
  "llm_extraction": 38.60653649200685,
  "data_cleaning": 1.605600118637085e-05,
  "neo4j_injection": 0.22783726500347257,
  "embedding_time": 0,
  "indexing_time": 0.0037978909676894546,
  "graph_injection_time": 0.2239006430027075,
  "acs_metrics": {
    "node_count": 195,
    "relationship_count": 450,
    "density": 0.0119,
    "avg_degree": 4.6154,
    "avg_unique_neighbors": 4.5846,
    "global_efficiency": 0.3549,
    "avg_path_length": 3.014,
    "avg_degree_centrality": 0.0238,
    "max_degree_centrality": 0.5,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0127,
    "degree_assortativity": -0.2955,
    "graph_robustness": 0.82,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.3129,
    "weakly_connected_components": 6,
    "largest_wcc_size": 190,
    "pagerank_top10_percent": 18.16,
    "louvain_communities": 16,
    "louvain_modularity": 0.5533,
    "label_entropy": 1.3852,
    "computational_time": 0.10830306599382311
  },
  "retrieval_queries": []
}
2025-11-24 14:33:35,360 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:33:35,360 - src.pipeline.kg_builder - INFO - Batch 10 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 38.61s, Clean: 0.00s, Neo4j: 0.23s, ACS: 0.11s
2025-11-24 14:33:35,360 - src.pipeline.kg_builder - INFO - Batch 10 completed in 38.95s
Processing KG batches:  14%|█▍        | 10/72 [05:33<33:10, 32.10s/it]2025-11-24 14:33:35,360 - src.pipeline.kg_builder - INFO - Processing batch 11/72 (3 items)
2025-11-24 14:33:35,360 - src.pipeline.kg_builder - DEBUG - Batch 11 current_video_time: 02:39-02:44
2025-11-24 14:33:35,365 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 195
- Total Relationships: 193
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:33:35,366 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-24 14:33:35,366 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0 ~235 words, content: Time: 02:29-02:34 Content: The video sequence captures a scientific procedure, likely a chemical experiment, being conducted in a laboratory setting. The process involves the precise...
2025-11-24 14:33:35,366 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1 ~229 words, content: a reading of "80.15 g". A hand wearing a blue glove is seen opening the glass door of the balance's draft shield. The beaker with...
2025-11-24 14:33:35,366 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2 ~220 words, content: Time: 02:34-02:39 Content: The video sequence captures a scientific procedure, likely a titration or a similar chemical analysis, being performed in a laboratory setting. The...
2025-11-24 14:33:35,366 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3 ~228 words, content: background reveals more of the laboratory, including a white door, a wall-mounted electrical panel with a high-voltage warning symbol, and a shelf with various items....
2025-11-24 14:33:35,366 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4 ~225 words, content: conducted with precision, using an analytical balance to ensure accurate measurements. Time: 02:39-02:44 Content: The video captures a sequence of a laboratory procedure, likely a...
2025-11-24 14:33:35,366 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_5 ~114 words, content: has been added. The final reading on the balance is shown to be -56.30, which is a stable reading, indicating that the addition is complete....
2025-11-24 14:33:35,366 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:33:35,366 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0) (~235 words) with timeout=5.0s retries=3
2025-11-24 14:33:36,661 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:33:36,661 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:33:36,661 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1) (~229 words) with timeout=5.0s retries=3
2025-11-24 14:33:38,123 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:33:38,123 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:33:38,124 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2) (~220 words) with timeout=5.0s retries=3
2025-11-24 14:33:39,554 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:33:39,555 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:33:39,555 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3) (~228 words) with timeout=5.0s retries=3
2025-11-24 14:33:40,718 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:33:40,718 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:33:40,718 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4) (~225 words) with timeout=5.0s retries=3
2025-11-24 14:33:41,700 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:33:41,700 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:33:41,700 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_5) (~114 words) with timeout=5.0s retries=3
2025-11-24 14:33:42,833 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-24 14:33:42,833 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-24 14:33:42,834 - src.components.pre_llm_injector - INFO - Extracted 30 local triplets from 6 chunks
2025-11-24 14:33:42,834 - src.pipeline.kg_builder - INFO - Pre-extraction: 30 triplets in 7.47s
2025-11-24 14:33:42,834 - src.components.global_refiner - INFO - Capping refinement input: 30 → 25 triplets
2025-11-24 14:33:42,834 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 195
- Total Relationships: 193
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0"]}, {"head": "Person", "relation": "Holds", "tail": "White Plastic Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0"]}, {"head": "White Plastic Bottle", "relation": "Has", "tail": "Red Cap", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0"]}, {"head": "White Plastic Bottle", "relation": "Contains", "tail": "Chemical Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "80.15 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1"]}, {"head": "Digital Balance", "relation": "Is Inside", "tail": "Draft Shield", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0"]}, {"head": "Hand Wearing Blue Glove", "relation": "Opens", "tail": "Draft Shield", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1"]}, {"head": "Beaker With White Powder", "relation": "Is On", "tail": "Weighing Pan", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1"]}, {"head": "Hand Not Gloved", "relation": "Points To", "tail": "Scale Display", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1"]}, {"head": "Person", "relation": "Lifts", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1"]}, {"head": "Beaker With White Powder", "relation": "Is Removed From", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2"]}, {"head": "Glass_Beaker", "relation": "Contains", "tail": "White_Powdery_Solid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2"]}, {"head": "Glass_Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2"]}, {"head": "Person", "relation": "Uses", "tail": "Analytical_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2"]}, {"head": "Analytical_Balance", "relation": "Displays", "tail": "0.01_G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_5"]}, {"head": "Beaker", "relation": "Contains", "tail": "White Solid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4"]}, {"head": "Person", "relation": "Adds", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4"]}, {"head": "Beaker", "relation": "Is On", "tail": "Analytical Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3"]}, {"head": "Analytical Balance", "relation": "Displays", "tail": "0.01 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3"]}, {"head": "Person", "relation": "Wears", "tail": "Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4"]}, {"head": "Beaker", "relation": "Contains", "tail": "Solid Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_5"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:33:42,834 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~362 words, ~471 tokens)
2025-11-24 14:33:42,834 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:34:16,194 - src.components.global_refiner - DEBUG - LLM call completed in 33.36s
2025-11-24 14:34:16,194 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4']], ['Person', 'holds', 'White_Plastic_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0']], ['White_Plastic_Bottle', 'has', 'Red_Cap', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0']], ['White_Plastic_Bottle', 'contains', 'Chemical_Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0']], ['Digital_Balance', 'displays', '80.15_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1']], ['Digital_Balance', 'is_inside', 'Draft_Shield', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0']], ['Hand_Wearing_Blue_Glove', 'opens', 'Draft_Shield', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1']], ['Beaker_With_White_Powder', 'is_on', 'Weighing_Pan', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1']], ['Hand_Not_Gloved', 'points_to', 'Scale_Display', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1']], ['Person', 'lifts', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1']], ['Beaker_With_White_Powder', 'is_removed_from', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1']], ['Person', 'holds', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2']], ['Glass_Beaker', 'contains', 'White_Powdery_Solid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2']], ['Glass_Beaker', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2']], ['Person', 'uses', 'Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2']], ['Analytical_Balance', 'displays', '0.01_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_5']], ['Beaker', 'contains', 'White_Solid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4']], ['Person', 'adds', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4']], ['Beaker', 'is_on', 'Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3']], ['Person', 'wears', 'Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4']], ['Beaker', 'contains', 'Solid_Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_5']]]
2025-11-24 14:34:16,194 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4"
    ]
  ],
  [
    "Person",
    "holds",
    "White_Plastic_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0"
    ]
  ],
  [
    "White_Plastic_Bottle",
    "has",
    "Red_Cap",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0"
    ]
  ],
  [
    "White_Plastic_Bottle",
    "contains",
    "Chemical_Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "80.15_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1"
    ]
  ],
  [
    "Digital_Balance",
    "is_inside",
    "Draft_Shield",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_0"
    ]
  ],
  [
    "Hand_Wearing_Blue_Glove",
    "opens",
    "Draft_Shield",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1"
    ]
  ],
  [
    "Beaker_With_White_Powder",
    "is_on",
    "Weighing_Pan",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1"
    ]
  ],
  [
    "Hand_Not_Gloved",
    "points_to",
    "Scale_Display",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1"
    ]
  ],
  [
    "Person",
    "lifts",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1"
    ]
  ],
  [
    "Beaker_With_White_Powder",
    "is_removed_from",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2"
    ]
  ],
  [
    "Glass_Beaker",
    "contains",
    "White_Powdery_Solid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2"
    ]
  ],
  [
    "Glass_Beaker",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2"
    ]
  ],
  [
    "Analytical_Balance",
    "displays",
    "0.01_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_5"
    ]
  ],
  [
    "Beaker",
    "contains",
    "White_Solid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4"
    ]
  ],
  [
    "Person",
    "adds",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Solid_Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_4",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_10_5"
    ]
  ]
]
2025-11-24 14:34:16,194 - src.components.global_refiner - INFO - Refinement complete: 25 → 23 triplets (total: 33.36s, LLM: 33.36s)
2025-11-24 14:34:16,194 - src.pipeline.kg_builder - INFO - Global refinement: 23 triplets in 33.36s
2025-11-24 14:34:16,194 - src.pipeline.kg_builder - INFO - Using 23 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:34:16,194 - src.pipeline.kg_builder - INFO - Pushing batch 11/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:34:16,194 - src.components.neo4j_handler - INFO - Adding 23 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:34:16,450 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:34:16,450 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:34:16,451 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:34:16,451 - src.components.neo4j_handler - INFO - Batch injected in 0.26s (triplets: 0.25s, indexes: 0.00s)
2025-11-24 14:34:16,451 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:34:16,469 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 215 nodes
2025-11-24 14:34:16,518 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 210 nodes
2025-11-24 14:34:16,579 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 215, 'relationship_count': 504, 'density': 0.011, 'avg_degree': 4.6884, 'avg_unique_neighbors': 4.6605, 'global_efficiency': 0.354, 'avg_path_length': 3.0206, 'avg_degree_centrality': 0.0219, 'max_degree_centrality': 0.4907, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0192, 'degree_assortativity': -0.277, 'graph_robustness': 0.8294, 'diameter_estimate': 7, 'clustering_coefficient': 0.3161, 'weakly_connected_components': 6, 'largest_wcc_size': 210, 'pagerank_top10_percent': 16.44, 'louvain_communities': 15, 'louvain_modularity': 0.5506, 'label_entropy': 1.3912, 'computational_time': 0.12834260205272585}
2025-11-24 14:34:16,579 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 10, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966056.579559, 'total_time': 41.21929814503528, 'aggregation': 2.7840142138302326e-06, 'network_info': 0.005174843012355268, 'llm_extraction': 40.82889093196718, 'data_cleaning': 1.6597972717136145e-05, 'neo4j_injection': 0.2565405130153522, 'embedding_time': 0, 'indexing_time': 0.0037050230312161148, 'graph_injection_time': 0.25269089901121333, 'acs_metrics': {'node_count': 215, 'relationship_count': 504, 'density': 0.011, 'avg_degree': 4.6884, 'avg_unique_neighbors': 4.6605, 'global_efficiency': 0.354, 'avg_path_length': 3.0206, 'avg_degree_centrality': 0.0219, 'max_degree_centrality': 0.4907, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0192, 'degree_assortativity': -0.277, 'graph_robustness': 0.8294, 'diameter_estimate': 7, 'clustering_coefficient': 0.3161, 'weakly_connected_components': 6, 'largest_wcc_size': 210, 'pagerank_top10_percent': 16.44, 'louvain_communities': 15, 'louvain_modularity': 0.5506, 'label_entropy': 1.3912, 'computational_time': 0.12834260205272585}, 'retrieval_queries': []}
2025-11-24 14:34:16,579 - src.pipeline.kg_builder - DEBUG - Batch 10 metrics: {
  "batch_idx": 10,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966056.579559,
  "total_time": 41.21929814503528,
  "aggregation": 2.7840142138302326e-06,
  "network_info": 0.005174843012355268,
  "llm_extraction": 40.82889093196718,
  "data_cleaning": 1.6597972717136145e-05,
  "neo4j_injection": 0.2565405130153522,
  "embedding_time": 0,
  "indexing_time": 0.0037050230312161148,
  "graph_injection_time": 0.25269089901121333,
  "acs_metrics": {
    "node_count": 215,
    "relationship_count": 504,
    "density": 0.011,
    "avg_degree": 4.6884,
    "avg_unique_neighbors": 4.6605,
    "global_efficiency": 0.354,
    "avg_path_length": 3.0206,
    "avg_degree_centrality": 0.0219,
    "max_degree_centrality": 0.4907,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0192,
    "degree_assortativity": -0.277,
    "graph_robustness": 0.8294,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.3161,
    "weakly_connected_components": 6,
    "largest_wcc_size": 210,
    "pagerank_top10_percent": 16.44,
    "louvain_communities": 15,
    "louvain_modularity": 0.5506,
    "label_entropy": 1.3912,
    "computational_time": 0.12834260205272585
  },
  "retrieval_queries": []
}
2025-11-24 14:34:16,580 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:34:16,580 - src.pipeline.kg_builder - INFO - Batch 11 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 40.83s, Clean: 0.00s, Neo4j: 0.26s, ACS: 0.13s
2025-11-24 14:34:16,580 - src.pipeline.kg_builder - INFO - Batch 11 completed in 41.22s
Processing KG batches:  15%|█▌        | 11/72 [06:14<35:28, 34.89s/it]2025-11-24 14:34:16,580 - src.pipeline.kg_builder - INFO - Processing batch 12/72 (3 items)
2025-11-24 14:34:16,580 - src.pipeline.kg_builder - DEBUG - Batch 12 current_video_time: 02:54-02:59
2025-11-24 14:34:16,585 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 215
- Total Relationships: 210
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:34:16,585 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:34:16,585 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0 ~230 words, content: Time: 02:44-02:49 Content: The video captures a laboratory procedure, likely a titration or a similar quantitative analysis, from a first-person perspective. The scene is set...
2025-11-24 14:34:16,585 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1 ~224 words, content: and a document with Chinese text, likely a lab protocol or experiment instructions. The overall context suggests a controlled and precise scientific experiment is in...
2025-11-24 14:34:16,585 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2 ~233 words, content: . The digital display of the balance shows a negative weight of `-56.304 g`, which is the result of the tare function. The person is...
2025-11-24 14:34:16,585 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3 ~224 words, content: , and then adding a solid substance to the beaker to measure its weight. This is a common procedure in chemistry for preparing solutions or...
2025-11-24 14:34:16,585 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_4 ~125 words, content: into a small, clear glass container, which is likely a conical flask or a beaker used for titration. This action is performed with precision, suggesting...
2025-11-24 14:34:16,585 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:34:16,586 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0) (~230 words) with timeout=5.0s retries=3
2025-11-24 14:34:17,696 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:34:17,696 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:34:17,696 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1) (~224 words) with timeout=5.0s retries=3
2025-11-24 14:34:18,880 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:34:18,880 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:34:18,880 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2) (~233 words) with timeout=5.0s retries=3
2025-11-24 14:34:19,887 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:34:19,887 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:34:19,887 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3) (~224 words) with timeout=5.0s retries=3
2025-11-24 14:34:21,139 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:34:21,139 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:34:21,139 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_4) (~125 words) with timeout=5.0s retries=3
2025-11-24 14:34:22,466 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:34:22,466 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:34:22,466 - src.components.pre_llm_injector - INFO - Extracted 27 local triplets from 5 chunks
2025-11-24 14:34:22,466 - src.pipeline.kg_builder - INFO - Pre-extraction: 27 triplets in 5.88s
2025-11-24 14:34:22,466 - src.components.global_refiner - INFO - Capping refinement input: 27 → 25 triplets
2025-11-24 14:34:22,466 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 215
- Total Relationships: 210
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3"]}, {"head": "Person", "relation": "Adds", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0"]}, {"head": "Liquid", "relation": "Is Added To", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0"]}, {"head": "Beaker", "relation": "Is Inside", "tail": "Draft Shield", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1"]}, {"head": "Person", "relation": "Uses", "tail": "Wash_Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3"]}, {"head": "Beaker", "relation": "Is On", "tail": "Analytical_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1"]}, {"head": "Analytical_Balance", "relation": "Displays", "tail": "Negative_Weight", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1"]}, {"head": "Document", "relation": "Contains", "tail": "Chinese_Text", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2"]}, {"head": "Balance", "relation": "Displays", "tail": "Negative_Weight", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2"]}, {"head": "Person", "relation": "Adds", "tail": "Solid_Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Solid_Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2"]}, {"head": "Balance", "relation": "Measures", "tail": "Substance_Weight", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudy Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3"]}, {"head": "Beaker", "relation": "Is Placed On", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "-56.20", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3"]}, {"head": "Person", "relation": "Pours", "tail": "Cloudy Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3"]}, {"head": "Person", "relation": "Handles", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_4"]}, {"head": "Beaker", "relation": "Is Transferred To", "tail": "Glass_Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_4"]}, {"head": "Glass_Container", "relation": "Is Type Of", "tail": "Conical_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_4"]}, {"head": "Glass_Container", "relation": "Is Used For", "tail": "Titration", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:34:22,466 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~340 words, ~442 tokens)
2025-11-24 14:34:22,466 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:34:51,940 - src.components.global_refiner - DEBUG - LLM call completed in 29.47s
2025-11-24 14:34:51,940 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3']], ['Person', 'adds', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0']], ['Liquid', 'is_added_to', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0']], ['Beaker', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0']], ['Digital_Balance', 'measures', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0']], ['Beaker', 'is_inside', 'Draft_Shield', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0']], ['Person', 'uses', 'Wash_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3']], ['Beaker', 'is_on', 'Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1']], ['Analytical_Balance', 'displays', 'Negative_Weight', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1']], ['Document', 'contains', 'Chinese_Text', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2']], ['Balance', 'displays', 'Negative_Weight', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2']], ['Person', 'adds', 'Solid_Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2']], ['Beaker', 'contains', 'Solid_Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2']], ['Balance', 'measures', 'Substance_Weight', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2']], ['Beaker', 'contains', 'Cloudy_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3']], ['Beaker', 'is_placed_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3']], ['Digital_Balance', 'displays', '-56.20', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3']], ['Person', 'pours', 'Cloudy_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3']], ['Person', 'handles', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_4']], ['Beaker', 'is_transferred_to', 'Glass_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_4']], ['Glass_Container', 'is_type_of', 'Conical_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_4']], ['Glass_Container', 'is_used_for', 'Titration', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_4']]]
2025-11-24 14:34:51,940 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3"
    ]
  ],
  [
    "Person",
    "adds",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0"
    ]
  ],
  [
    "Liquid",
    "is_added_to",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0"
    ]
  ],
  [
    "Beaker",
    "is_inside",
    "Draft_Shield",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Wash_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1"
    ]
  ],
  [
    "Analytical_Balance",
    "displays",
    "Negative_Weight",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1"
    ]
  ],
  [
    "Document",
    "contains",
    "Chinese_Text",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2"
    ]
  ],
  [
    "Balance",
    "displays",
    "Negative_Weight",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2"
    ]
  ],
  [
    "Person",
    "adds",
    "Solid_Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Solid_Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2"
    ]
  ],
  [
    "Balance",
    "measures",
    "Substance_Weight",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Cloudy_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3"
    ]
  ],
  [
    "Beaker",
    "is_placed_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "-56.20",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3"
    ]
  ],
  [
    "Person",
    "pours",
    "Cloudy_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_3"
    ]
  ],
  [
    "Person",
    "handles",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_4"
    ]
  ],
  [
    "Beaker",
    "is_transferred_to",
    "Glass_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_4"
    ]
  ],
  [
    "Glass_Container",
    "is_type_of",
    "Conical_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_4"
    ]
  ],
  [
    "Glass_Container",
    "is_used_for",
    "Titration",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_11_4"
    ]
  ]
]
2025-11-24 14:34:51,940 - src.components.global_refiner - INFO - Refinement complete: 25 → 24 triplets (total: 29.47s, LLM: 29.47s)
2025-11-24 14:34:51,940 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 29.47s
2025-11-24 14:34:51,940 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:34:51,940 - src.pipeline.kg_builder - INFO - Pushing batch 12/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:34:51,940 - src.components.neo4j_handler - INFO - Adding 24 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:34:52,149 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:34:52,149 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:34:52,149 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:34:52,149 - src.components.neo4j_handler - INFO - Batch injected in 0.21s (triplets: 0.20s, indexes: 0.01s)
2025-11-24 14:34:52,149 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:34:52,171 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 229 nodes
2025-11-24 14:34:52,228 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 224 nodes
2025-11-24 14:34:52,298 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 229, 'relationship_count': 551, 'density': 0.0106, 'avg_degree': 4.8122, 'avg_unique_neighbors': 4.786, 'global_efficiency': 0.3568, 'avg_path_length': 2.9981, 'avg_degree_centrality': 0.0211, 'max_degree_centrality': 0.4956, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.027, 'degree_assortativity': -0.2666, 'graph_robustness': 0.824, 'diameter_estimate': 7, 'clustering_coefficient': 0.317, 'weakly_connected_components': 6, 'largest_wcc_size': 224, 'pagerank_top10_percent': 15.26, 'louvain_communities': 18, 'louvain_modularity': 0.538, 'label_entropy': 1.3977, 'computational_time': 0.1488816569908522}
2025-11-24 14:34:52,298 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 11, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966092.2986836, 'total_time': 35.718491377017926, 'aggregation': 2.796994522213936e-06, 'network_info': 0.004974742012564093, 'llm_extraction': 35.35522602102719, 'data_cleaning': 1.6144011169672012e-05, 'neo4j_injection': 0.20909062400460243, 'embedding_time': 0, 'indexing_time': 0.005033902998548001, 'graph_injection_time': 0.2039147429750301, 'acs_metrics': {'node_count': 229, 'relationship_count': 551, 'density': 0.0106, 'avg_degree': 4.8122, 'avg_unique_neighbors': 4.786, 'global_efficiency': 0.3568, 'avg_path_length': 2.9981, 'avg_degree_centrality': 0.0211, 'max_degree_centrality': 0.4956, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.027, 'degree_assortativity': -0.2666, 'graph_robustness': 0.824, 'diameter_estimate': 7, 'clustering_coefficient': 0.317, 'weakly_connected_components': 6, 'largest_wcc_size': 224, 'pagerank_top10_percent': 15.26, 'louvain_communities': 18, 'louvain_modularity': 0.538, 'label_entropy': 1.3977, 'computational_time': 0.1488816569908522}, 'retrieval_queries': []}
2025-11-24 14:34:52,298 - src.pipeline.kg_builder - DEBUG - Batch 11 metrics: {
  "batch_idx": 11,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966092.2986836,
  "total_time": 35.718491377017926,
  "aggregation": 2.796994522213936e-06,
  "network_info": 0.004974742012564093,
  "llm_extraction": 35.35522602102719,
  "data_cleaning": 1.6144011169672012e-05,
  "neo4j_injection": 0.20909062400460243,
  "embedding_time": 0,
  "indexing_time": 0.005033902998548001,
  "graph_injection_time": 0.2039147429750301,
  "acs_metrics": {
    "node_count": 229,
    "relationship_count": 551,
    "density": 0.0106,
    "avg_degree": 4.8122,
    "avg_unique_neighbors": 4.786,
    "global_efficiency": 0.3568,
    "avg_path_length": 2.9981,
    "avg_degree_centrality": 0.0211,
    "max_degree_centrality": 0.4956,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.027,
    "degree_assortativity": -0.2666,
    "graph_robustness": 0.824,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.317,
    "weakly_connected_components": 6,
    "largest_wcc_size": 224,
    "pagerank_top10_percent": 15.26,
    "louvain_communities": 18,
    "louvain_modularity": 0.538,
    "label_entropy": 1.3977,
    "computational_time": 0.1488816569908522
  },
  "retrieval_queries": []
}
2025-11-24 14:34:52,299 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:34:52,299 - src.pipeline.kg_builder - INFO - Batch 12 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 35.36s, Clean: 0.00s, Neo4j: 0.21s, ACS: 0.15s
2025-11-24 14:34:52,299 - src.pipeline.kg_builder - INFO - Batch 12 completed in 35.72s
Processing KG batches:  17%|█▋        | 12/72 [06:49<35:08, 35.14s/it]2025-11-24 14:34:52,299 - src.pipeline.kg_builder - INFO - Processing batch 13/72 (3 items)
2025-11-24 14:34:52,299 - src.pipeline.kg_builder - DEBUG - Batch 13 current_video_time: 03:09-03:14
2025-11-24 14:34:52,304 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 229
- Total Relationships: 226
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:34:52,305 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 14:34:52,305 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_0 ~214 words, content: Time: 02:59-03:04 Content: The sequence of images captures a laboratory procedure, likely the preparation of a chemical solution, from a first-person perspective. The setting is...
2025-11-24 14:34:52,305 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1 ~236 words, content: of liquid to achieve a desired concentration. - **Final Setup:** The final frame shows the beaker, now containing the solid and the added liquid, being...
2025-11-24 14:34:52,305 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2 ~215 words, content: notes. The background features a door, a cabinet, and a wall with a warning sign. The overall scene suggests a controlled and precise scientific procedure....
2025-11-24 14:34:52,305 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3 ~153 words, content: step. The balance's display changes to a negative value (`-56.302 g`), which is a common feature on analytical balances to tare or zero the scale...
2025-11-24 14:34:52,305 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:34:52,305 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_0) (~214 words) with timeout=5.0s retries=3
2025-11-24 14:34:53,855 - src.components.pre_llm_injector - DEBUG - Extracted 3 triplets from chunk 0 (attempt 1)
2025-11-24 14:34:53,855 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 3 triplets
2025-11-24 14:34:53,855 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1) (~236 words) with timeout=5.0s retries=3
2025-11-24 14:34:54,949 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:34:54,950 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:34:54,950 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2) (~215 words) with timeout=5.0s retries=3
2025-11-24 14:34:56,191 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:34:56,191 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:34:56,192 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3) (~153 words) with timeout=5.0s retries=3
2025-11-24 14:35:01,198 - src.components.pre_llm_injector - WARNING - Chunk 3 timed out after 5.0s (attempt 1/4), retrying...
2025-11-24 14:35:02,686 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 2)
2025-11-24 14:35:02,686 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:35:02,686 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 4 chunks
2025-11-24 14:35:02,686 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 10.38s
2025-11-24 14:35:02,686 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 229
- Total Relationships: 226
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "5.302 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "White Powder And Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_0"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Solid Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "Final Weight", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2"]}, {"head": "Person", "relation": "Pours", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2"]}, {"head": "Beaker", "relation": "Is Placed On", "tail": "Digital_Analytical_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2"]}, {"head": "Digital_Analytical_Balance", "relation": "Displays", "tail": "Mass_Reading", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2"]}, {"head": "Person", "relation": "Performs", "tail": "Measurement", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3"]}, {"head": "Analytical Balance", "relation": "Displays", "tail": "Negative Value", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Solid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3"]}, {"head": "Person", "relation": "Adds", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3"]}, {"head": "Analytical Balance", "relation": "Measures", "tail": "Total Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:35:02,686 - src.components.global_refiner - DEBUG - Refining 17 triplets (prompt ~274 words, ~356 tokens)
2025-11-24 14:35:02,686 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:35:31,988 - src.components.global_refiner - DEBUG - LLM call completed in 29.30s
2025-11-24 14:35:31,989 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3']], ['Beaker', 'contains', 'White_Powder_And_Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_0']], ['Beaker', 'contains', 'Solid_Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3']], ['Beaker', 'contains', 'Solid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3']], ['Beaker', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1']], ['Beaker', 'is_placed_on', 'Digital_Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2']], ['Digital_Balance', 'displays', '5.302_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_0']], ['Digital_Analytical_Balance', 'displays', 'Mass_Reading', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2']], ['Analytical_Balance', 'displays', 'Negative_Value', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3']], ['Person', 'performs', 'Measurement', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3']], ['Person', 'pours', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2']], ['Person', 'adds', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3']], ['Analytical_Balance', 'measures', 'Total_Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3']], ['Digital_Balance', 'displays', 'Final_Weight', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1']], ['Beaker', 'contains', 'White_Powder_And_Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_0']], ['Beaker', 'contains', 'Solid_Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3']], ['Beaker', 'contains', 'Solid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3']], ['Digital_Balance', 'displays', '5.302_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_0']]]
2025-11-24 14:35:31,989 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "White_Powder_And_Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Solid_Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Solid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1"
    ]
  ],
  [
    "Beaker",
    "is_placed_on",
    "Digital_Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "5.302_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_0"
    ]
  ],
  [
    "Digital_Analytical_Balance",
    "displays",
    "Mass_Reading",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2"
    ]
  ],
  [
    "Analytical_Balance",
    "displays",
    "Negative_Value",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3"
    ]
  ],
  [
    "Person",
    "performs",
    "Measurement",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3"
    ]
  ],
  [
    "Person",
    "pours",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2"
    ]
  ],
  [
    "Person",
    "adds",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3"
    ]
  ],
  [
    "Analytical_Balance",
    "measures",
    "Total_Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Final_Weight",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "White_Powder_And_Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Solid_Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Solid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_3"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "5.302_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_12_0"
    ]
  ]
]
2025-11-24 14:35:31,989 - src.components.global_refiner - INFO - Refinement complete: 17 → 21 triplets (total: 29.30s, LLM: 29.30s)
2025-11-24 14:35:31,989 - src.pipeline.kg_builder - INFO - Global refinement: 21 triplets in 29.30s
2025-11-24 14:35:31,989 - src.pipeline.kg_builder - INFO - Using 21 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:35:31,989 - src.pipeline.kg_builder - INFO - Pushing batch 13/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:35:31,989 - src.components.neo4j_handler - INFO - Adding 16 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:35:32,172 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:35:32,172 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:35:32,172 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:35:32,172 - src.components.neo4j_handler - INFO - Batch injected in 0.18s (triplets: 0.18s, indexes: 0.01s)
2025-11-24 14:35:32,172 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:35:32,195 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 242 nodes
2025-11-24 14:35:32,259 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 237 nodes
2025-11-24 14:35:32,335 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 242, 'relationship_count': 586, 'density': 0.01, 'avg_degree': 4.843, 'avg_unique_neighbors': 4.8182, 'global_efficiency': 0.3572, 'avg_path_length': 2.9949, 'avg_degree_centrality': 0.0201, 'max_degree_centrality': 0.4896, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0215, 'degree_assortativity': -0.258, 'graph_robustness': 0.8259, 'diameter_estimate': 7, 'clustering_coefficient': 0.3208, 'weakly_connected_components': 6, 'largest_wcc_size': 237, 'pagerank_top10_percent': 14.46, 'louvain_communities': 18, 'louvain_modularity': 0.5348, 'label_entropy': 1.4007, 'computational_time': 0.16250368999317288}
2025-11-24 14:35:32,335 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 12, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966132.335289, 'total_time': 40.03596286900574, 'aggregation': 2.5319750420749187e-06, 'network_info': 0.005347154976334423, 'llm_extraction': 39.68442212801892, 'data_cleaning': 1.282297307625413e-05, 'neo4j_injection': 0.18338292400585487, 'embedding_time': 0, 'indexing_time': 0.005775962956249714, 'graph_injection_time': 0.17745910299709067, 'acs_metrics': {'node_count': 242, 'relationship_count': 586, 'density': 0.01, 'avg_degree': 4.843, 'avg_unique_neighbors': 4.8182, 'global_efficiency': 0.3572, 'avg_path_length': 2.9949, 'avg_degree_centrality': 0.0201, 'max_degree_centrality': 0.4896, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0215, 'degree_assortativity': -0.258, 'graph_robustness': 0.8259, 'diameter_estimate': 7, 'clustering_coefficient': 0.3208, 'weakly_connected_components': 6, 'largest_wcc_size': 237, 'pagerank_top10_percent': 14.46, 'louvain_communities': 18, 'louvain_modularity': 0.5348, 'label_entropy': 1.4007, 'computational_time': 0.16250368999317288}, 'retrieval_queries': []}
2025-11-24 14:35:32,335 - src.pipeline.kg_builder - DEBUG - Batch 12 metrics: {
  "batch_idx": 12,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966132.335289,
  "total_time": 40.03596286900574,
  "aggregation": 2.5319750420749187e-06,
  "network_info": 0.005347154976334423,
  "llm_extraction": 39.68442212801892,
  "data_cleaning": 1.282297307625413e-05,
  "neo4j_injection": 0.18338292400585487,
  "embedding_time": 0,
  "indexing_time": 0.005775962956249714,
  "graph_injection_time": 0.17745910299709067,
  "acs_metrics": {
    "node_count": 242,
    "relationship_count": 586,
    "density": 0.01,
    "avg_degree": 4.843,
    "avg_unique_neighbors": 4.8182,
    "global_efficiency": 0.3572,
    "avg_path_length": 2.9949,
    "avg_degree_centrality": 0.0201,
    "max_degree_centrality": 0.4896,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0215,
    "degree_assortativity": -0.258,
    "graph_robustness": 0.8259,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.3208,
    "weakly_connected_components": 6,
    "largest_wcc_size": 237,
    "pagerank_top10_percent": 14.46,
    "louvain_communities": 18,
    "louvain_modularity": 0.5348,
    "label_entropy": 1.4007,
    "computational_time": 0.16250368999317288
  },
  "retrieval_queries": []
}
2025-11-24 14:35:32,335 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:35:32,335 - src.pipeline.kg_builder - INFO - Batch 13 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 39.68s, Clean: 0.00s, Neo4j: 0.18s, ACS: 0.16s
2025-11-24 14:35:32,335 - src.pipeline.kg_builder - INFO - Batch 13 completed in 40.04s
Processing KG batches:  18%|█▊        | 13/72 [07:30<36:00, 36.63s/it]2025-11-24 14:35:32,335 - src.pipeline.kg_builder - INFO - Processing batch 14/72 (3 items)
2025-11-24 14:35:32,335 - src.pipeline.kg_builder - DEBUG - Batch 14 current_video_time: 03:24-03:29
2025-11-24 14:35:32,341 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 242
- Total Relationships: 236
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:35:32,342 - src.components.pre_llm_injector - DEBUG - Split content into 7 chunks (chunk_size=296, overlap=16)
2025-11-24 14:35:32,342 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0 ~211 words, content: Time: 03:14-03:19 Content: The video sequence captures a scientific procedure, likely a titration or a similar quantitative analysis, being performed in a laboratory setting. The...
2025-11-24 14:35:32,342 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1 ~236 words, content: or experiment instructions. - **Key Equipment:** The central focus is the analytical balance. The person's hands are positioned to place the beaker onto the balance's...
2025-11-24 14:35:32,342 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2 ~248 words, content: fume hood. The primary activity involves the precise measurement and transfer of liquids, likely as part of a chemical synthesis or analysis process. In the...
2025-11-24 14:35:32,342 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3 ~262 words, content: to a setup that includes a glass tube and a stand, which is used to hold the flask in place. The person is carefully handling...
2025-11-24 14:35:32,342 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_4 ~227 words, content: procedures involved in a laboratory setting. The use of protective gear, such as gloves, and the careful handling of equipment highlight the importance of safety...
2025-11-24 14:35:32,342 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_5 ~228 words, content: are using a pipette to transfer a liquid from the vial into the Erlenmeyer flask. The balance continues to display the negative weight, indicating the...
2025-11-24 14:35:32,342 - src.components.pre_llm_injector - DEBUG - Chunk[6] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_6 ~64 words, content: laboratory setting using a digital balance to precisely measure and add a substance to a flask. The negative weight on the balance indicates that the...
2025-11-24 14:35:32,342 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:35:32,342 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0) (~211 words) with timeout=5.0s retries=3
2025-11-24 14:35:33,442 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:35:33,442 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:35:33,442 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1) (~236 words) with timeout=5.0s retries=3
2025-11-24 14:35:34,559 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:35:34,559 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:35:34,560 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2) (~248 words) with timeout=5.0s retries=3
2025-11-24 14:35:35,793 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:35:35,793 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:35:35,793 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3) (~262 words) with timeout=5.0s retries=3
2025-11-24 14:35:36,921 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:35:36,921 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:35:36,921 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_4) (~227 words) with timeout=5.0s retries=3
2025-11-24 14:35:38,155 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:35:38,155 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:35:38,155 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_5) (~228 words) with timeout=5.0s retries=3
2025-11-24 14:35:39,305 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-24 14:35:39,305 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-24 14:35:39,305 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 6 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_6) (~64 words) with timeout=5.0s retries=3
2025-11-24 14:35:40,391 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 6 (attempt 1)
2025-11-24 14:35:40,391 - src.components.pre_llm_injector - DEBUG - Chunk 6 returned 6 triplets
2025-11-24 14:35:40,391 - src.components.pre_llm_injector - INFO - Extracted 36 local triplets from 7 chunks
2025-11-24 14:35:40,391 - src.pipeline.kg_builder - INFO - Pre-extraction: 36 triplets in 8.05s
2025-11-24 14:35:40,392 - src.components.global_refiner - INFO - Capping refinement input: 36 → 25 triplets
2025-11-24 14:35:40,392 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 242
- Total Relationships: 236
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0"]}, {"head": "Beaker", "relation": "Is Placed On", "tail": "Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0"]}, {"head": "Balance", "relation": "Displays", "tail": "Weight_Reading", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0"]}, {"head": "Person", "relation": "Places", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1"]}, {"head": "Beaker", "relation": "Is Placed On", "tail": "Analytical Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1"]}, {"head": "Analytical Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1"]}, {"head": "Person", "relation": "Prepares To Measure", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1"]}, {"head": "Lab", "relation": "Contains", "tail": "Analytical Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "-56.302 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2"]}, {"head": "Person", "relation": "Handles", "tail": "Glass Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3"]}, {"head": "Glass Flask", "relation": "Is Connected To", "tail": "Glass Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3"]}, {"head": "Glass Tube", "relation": "Is Held By", "tail": "Stand", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3"]}, {"head": "Person", "relation": "Adjusts", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3"]}, {"head": "Magnetic Stirrer", "relation": "Controls", "tail": "Mixing", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3"]}, {"head": "Person", "relation": "Wears", "tail": "Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_4", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_6"]}, {"head": "Person", "relation": "Holds", "tail": "Erlenmeyer Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_4"]}, {"head": "Erlenmeyer Flask", "relation": "Is On", "tail": "Digital Analytical Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_4"]}, {"head": "Digital Analytical Balance", "relation": "Displays", "tail": "Negative Weight", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:35:40,392 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~354 words, ~460 tokens)
2025-11-24 14:35:40,392 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:36:11,712 - src.components.global_refiner - DEBUG - LLM call completed in 31.32s
2025-11-24 14:36:11,712 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0']], ['Beaker', 'is_placed_on', 'Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0']], ['Balance', 'displays', 'Weight_Reading', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0']], ['Laboratory', 'contains', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0']], ['Person', 'places', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1']], ['Beaker', 'is_placed_on', 'Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1']], ['Analytical_Balance', 'measures', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1']], ['Person', 'prepares_to_measure', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1']], ['Lab', 'contains', 'Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2']], ['Beaker', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2']], ['Beaker', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2']], ['Digital_Balance', 'displays', '-56.302_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2']], ['Person', 'handles', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2']], ['Person', 'holds', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3']], ['Glass_Flask', 'is_connected_to', 'Glass_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3']], ['Glass_Tube', 'is_held_by', 'Stand', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3']], ['Person', 'adjusts', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3']], ['Magnetic_Stirrer', 'controls', 'Mixing', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3']], ['Person', 'wears', 'Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_4', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_6']], ['Person', 'holds', 'Erlenmeyer_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_4']], ['Erlenmeyer_Flask', 'is_on', 'Digital_Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_4']], ['Digital_Analytical_Balance', 'displays', 'Negative_Weight', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_4']]]
2025-11-24 14:36:11,713 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0"
    ]
  ],
  [
    "Beaker",
    "is_placed_on",
    "Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0"
    ]
  ],
  [
    "Balance",
    "displays",
    "Weight_Reading",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_0"
    ]
  ],
  [
    "Person",
    "places",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1"
    ]
  ],
  [
    "Beaker",
    "is_placed_on",
    "Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1"
    ]
  ],
  [
    "Analytical_Balance",
    "measures",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1"
    ]
  ],
  [
    "Person",
    "prepares_to_measure",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1"
    ]
  ],
  [
    "Lab",
    "contains",
    "Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "-56.302_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2"
    ]
  ],
  [
    "Person",
    "handles",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3"
    ]
  ],
  [
    "Glass_Flask",
    "is_connected_to",
    "Glass_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3"
    ]
  ],
  [
    "Glass_Tube",
    "is_held_by",
    "Stand",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3"
    ]
  ],
  [
    "Person",
    "adjusts",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "controls",
    "Mixing",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_4",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_6"
    ]
  ],
  [
    "Person",
    "holds",
    "Erlenmeyer_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_4"
    ]
  ],
  [
    "Erlenmeyer_Flask",
    "is_on",
    "Digital_Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_4"
    ]
  ],
  [
    "Digital_Analytical_Balance",
    "displays",
    "Negative_Weight",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_13_4"
    ]
  ]
]
2025-11-24 14:36:11,713 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 31.32s, LLM: 31.32s)
2025-11-24 14:36:11,713 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 31.32s
2025-11-24 14:36:11,713 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:36:11,713 - src.pipeline.kg_builder - INFO - Pushing batch 14/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:36:11,713 - src.components.neo4j_handler - INFO - Adding 25 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:36:11,973 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:36:11,973 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:36:11,974 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:36:11,974 - src.components.neo4j_handler - INFO - Batch injected in 0.26s (triplets: 0.26s, indexes: 0.00s)
2025-11-24 14:36:11,974 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:36:11,998 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 257 nodes
2025-11-24 14:36:12,071 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 251 nodes
2025-11-24 14:36:12,158 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 257, 'relationship_count': 634, 'density': 0.0096, 'avg_degree': 4.9339, 'avg_unique_neighbors': 4.9027, 'global_efficiency': 0.356, 'avg_path_length': 2.9821, 'avg_degree_centrality': 0.0193, 'max_degree_centrality': 0.4922, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0214, 'degree_assortativity': -0.2472, 'graph_robustness': 0.8407, 'diameter_estimate': 7, 'clustering_coefficient': 0.3196, 'weakly_connected_components': 7, 'largest_wcc_size': 251, 'pagerank_top10_percent': 13.58, 'louvain_communities': 17, 'louvain_modularity': 0.5197, 'label_entropy': 1.4109, 'computational_time': 0.1844323729746975}
2025-11-24 14:36:12,158 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 13, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966172.158973, 'total_time': 39.8230773829855, 'aggregation': 3.6180135793983936e-06, 'network_info': 0.005446461960673332, 'llm_extraction': 39.3716546560172, 'data_cleaning': 1.8717022612690926e-05, 'neo4j_injection': 0.2611706819734536, 'embedding_time': 0, 'indexing_time': 0.003133387945126742, 'graph_injection_time': 0.25789179204730317, 'acs_metrics': {'node_count': 257, 'relationship_count': 634, 'density': 0.0096, 'avg_degree': 4.9339, 'avg_unique_neighbors': 4.9027, 'global_efficiency': 0.356, 'avg_path_length': 2.9821, 'avg_degree_centrality': 0.0193, 'max_degree_centrality': 0.4922, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0214, 'degree_assortativity': -0.2472, 'graph_robustness': 0.8407, 'diameter_estimate': 7, 'clustering_coefficient': 0.3196, 'weakly_connected_components': 7, 'largest_wcc_size': 251, 'pagerank_top10_percent': 13.58, 'louvain_communities': 17, 'louvain_modularity': 0.5197, 'label_entropy': 1.4109, 'computational_time': 0.1844323729746975}, 'retrieval_queries': []}
2025-11-24 14:36:12,159 - src.pipeline.kg_builder - DEBUG - Batch 13 metrics: {
  "batch_idx": 13,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966172.158973,
  "total_time": 39.8230773829855,
  "aggregation": 3.6180135793983936e-06,
  "network_info": 0.005446461960673332,
  "llm_extraction": 39.3716546560172,
  "data_cleaning": 1.8717022612690926e-05,
  "neo4j_injection": 0.2611706819734536,
  "embedding_time": 0,
  "indexing_time": 0.003133387945126742,
  "graph_injection_time": 0.25789179204730317,
  "acs_metrics": {
    "node_count": 257,
    "relationship_count": 634,
    "density": 0.0096,
    "avg_degree": 4.9339,
    "avg_unique_neighbors": 4.9027,
    "global_efficiency": 0.356,
    "avg_path_length": 2.9821,
    "avg_degree_centrality": 0.0193,
    "max_degree_centrality": 0.4922,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0214,
    "degree_assortativity": -0.2472,
    "graph_robustness": 0.8407,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.3196,
    "weakly_connected_components": 7,
    "largest_wcc_size": 251,
    "pagerank_top10_percent": 13.58,
    "louvain_communities": 17,
    "louvain_modularity": 0.5197,
    "label_entropy": 1.4109,
    "computational_time": 0.1844323729746975
  },
  "retrieval_queries": []
}
2025-11-24 14:36:12,159 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:36:12,159 - src.pipeline.kg_builder - INFO - Batch 14 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 39.37s, Clean: 0.00s, Neo4j: 0.26s, ACS: 0.18s
2025-11-24 14:36:12,159 - src.pipeline.kg_builder - INFO - Batch 14 completed in 39.82s
Processing KG batches:  19%|█▉        | 14/72 [08:09<36:20, 37.59s/it]2025-11-24 14:36:12,159 - src.pipeline.kg_builder - INFO - Processing batch 15/72 (3 items)
2025-11-24 14:36:12,159 - src.pipeline.kg_builder - DEBUG - Batch 15 current_video_time: 03:39-03:44
2025-11-24 14:36:12,163 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 257
- Total Relationships: 254
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:36:12,164 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-24 14:36:12,164 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0 ~211 words, content: Time: 03:29-03:34 Content: The sequence of images captures a detailed laboratory procedure, likely the preparation of a chemical solution. The perspective is first-person, showing the...
2025-11-24 14:36:12,164 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1 ~196 words, content: etric flask, possibly to add a reagent. In frame 5, the scientist is seen using a pipette to transfer a liquid from a beaker into...
2025-11-24 14:36:12,164 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2 ~230 words, content: Content: The sequence of frames captures a detailed process in a laboratory setting, focusing on the precise measurement and transfer of a liquid. The scene...
2025-11-24 14:36:12,164 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3 ~230 words, content: . Another person, dressed in a beige sweater and blue jeans, walks past in the background, indicating that the laboratory is active and not isolated....
2025-11-24 14:36:12,164 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4 ~218 words, content: The reading on the balance fluctuates slightly, indicating the ongoing process of adding the liquid. - **Key Equipment and Environment:** - The person is wearing...
2025-11-24 14:36:12,164 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_5 ~33 words, content: , the pipette, and the balance highlights the importance of accuracy and precision in this scientific task. The entire sequence demonstrates a standard laboratory technique...
2025-11-24 14:36:12,164 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:36:12,164 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0) (~211 words) with timeout=5.0s retries=3
2025-11-24 14:36:13,518 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:36:13,518 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:36:13,518 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1) (~196 words) with timeout=5.0s retries=3
2025-11-24 14:36:14,625 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:36:14,625 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:36:14,625 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2) (~230 words) with timeout=5.0s retries=3
2025-11-24 14:36:15,876 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:36:15,876 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:36:15,877 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3) (~230 words) with timeout=5.0s retries=3
2025-11-24 14:36:16,920 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:36:16,920 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:36:16,920 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4) (~218 words) with timeout=5.0s retries=3
2025-11-24 14:36:17,852 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:36:17,852 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:36:17,852 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_5) (~33 words) with timeout=5.0s retries=3
2025-11-24 14:36:19,274 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-24 14:36:19,274 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-24 14:36:19,274 - src.components.pre_llm_injector - INFO - Extracted 27 local triplets from 6 chunks
2025-11-24 14:36:19,274 - src.pipeline.kg_builder - INFO - Pre-extraction: 27 triplets in 7.11s
2025-11-24 14:36:19,274 - src.components.global_refiner - INFO - Capping refinement input: 27 → 25 triplets
2025-11-24 14:36:19,274 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 257
- Total Relationships: 254
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Scientist", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0"]}, {"head": "Scientist", "relation": "Holds", "tail": "Glass Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0"]}, {"head": "Glass Vial", "relation": "Is Placed On", "tail": "Precision Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0"]}, {"head": "Scientist", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1"]}, {"head": "Pipette", "relation": "Transfers Liquid From", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3"]}, {"head": "Liquid", "relation": "Comes From", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1"]}, {"head": "Liquid", "relation": "Goes To", "tail": "Test Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1"]}, {"head": "Scientist", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3"]}, {"head": "Liquid", "relation": "Is In", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Volumetric_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2"]}, {"head": "Person", "relation": "Walks Past", "tail": "Other_Person", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4"]}, {"head": "Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4"]}, {"head": "Person", "relation": "Adds", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4"]}, {"head": "Pipette", "relation": "Is Used For", "tail": "Measuring_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_5"]}, {"head": "Balance", "relation": "Is Used For", "tail": "Measuring_Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_5"]}, {"head": "Solution", "relation": "Is Prepared By", "tail": "Laboratory_Technique", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_5"]}, {"head": "Laboratory_Technique", "relation": "Requires", "tail": "Accuracy", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_5"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:36:19,274 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~349 words, ~454 tokens)
2025-11-24 14:36:19,274 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:36:54,299 - src.components.global_refiner - DEBUG - LLM call completed in 35.02s
2025-11-24 14:36:54,299 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Scientist', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0']], ['Scientist', 'holds', 'Glass_Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0']], ['Glass_Vial', 'is_placed_on', 'Precision_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0']], ['Scientist', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1']], ['Pipette', 'transfers_liquid_from', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3']], ['Liquid', 'comes_from', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1']], ['Liquid', 'goes_to', 'Test_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1']], ['Scientist', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3']], ['Liquid', 'is_in', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2']], ['Liquid', 'is_transferred_to', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2']], ['Person', 'walks_past', 'Other_Person', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2']], ['Person', 'wears', 'Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4']], ['Balance', 'measures', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4']], ['Digital_Balance', 'measures', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4']], ['Person', 'adds', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4']], ['Lab_Bench', 'contains', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4']], ['Pipette', 'is_used_for', 'Measuring_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_5']], ['Balance', 'is_used_for', 'Measuring_Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_5']], ['Solution', 'is_prepared_by', 'Laboratory_Technique', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_5']], ['Laboratory_Technique', 'requires', 'Accuracy', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_5']]]
2025-11-24 14:36:54,299 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Scientist",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0"
    ]
  ],
  [
    "Scientist",
    "holds",
    "Glass_Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0"
    ]
  ],
  [
    "Glass_Vial",
    "is_placed_on",
    "Precision_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0"
    ]
  ],
  [
    "Scientist",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1"
    ]
  ],
  [
    "Pipette",
    "transfers_liquid_from",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3"
    ]
  ],
  [
    "Liquid",
    "comes_from",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1"
    ]
  ],
  [
    "Liquid",
    "goes_to",
    "Test_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1"
    ]
  ],
  [
    "Scientist",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3"
    ]
  ],
  [
    "Liquid",
    "is_in",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2"
    ]
  ],
  [
    "Liquid",
    "is_transferred_to",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2"
    ]
  ],
  [
    "Person",
    "walks_past",
    "Other_Person",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4"
    ]
  ],
  [
    "Balance",
    "measures",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4"
    ]
  ],
  [
    "Person",
    "adds",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_4"
    ]
  ],
  [
    "Pipette",
    "is_used_for",
    "Measuring_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_5"
    ]
  ],
  [
    "Balance",
    "is_used_for",
    "Measuring_Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_5"
    ]
  ],
  [
    "Solution",
    "is_prepared_by",
    "Laboratory_Technique",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_5"
    ]
  ],
  [
    "Laboratory_Technique",
    "requires",
    "Accuracy",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_14_5"
    ]
  ]
]
2025-11-24 14:36:54,299 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 35.02s, LLM: 35.02s)
2025-11-24 14:36:54,299 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 35.03s
2025-11-24 14:36:54,299 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:36:54,299 - src.pipeline.kg_builder - INFO - Pushing batch 15/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:36:54,299 - src.components.neo4j_handler - INFO - Adding 25 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:36:54,543 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:36:54,543 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:36:54,543 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:36:54,543 - src.components.neo4j_handler - INFO - Batch injected in 0.24s (triplets: 0.24s, indexes: 0.00s)
2025-11-24 14:36:54,543 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:36:54,581 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 272 nodes
2025-11-24 14:36:54,677 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 266 nodes
2025-11-24 14:36:54,775 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 272, 'relationship_count': 690, 'density': 0.0094, 'avg_degree': 5.0735, 'avg_unique_neighbors': 5.0441, 'global_efficiency': 0.3546, 'avg_path_length': 3.0041, 'avg_degree_centrality': 0.0187, 'max_degree_centrality': 0.4797, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0234, 'degree_assortativity': -0.2317, 'graph_robustness': 0.8565, 'diameter_estimate': 7, 'clustering_coefficient': 0.3189, 'weakly_connected_components': 7, 'largest_wcc_size': 266, 'pagerank_top10_percent': 12.74, 'louvain_communities': 17, 'louvain_modularity': 0.5068, 'label_entropy': 1.4169, 'computational_time': 0.23154818697366863}
2025-11-24 14:36:54,775 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 14, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966214.7751634, 'total_time': 42.6155189970159, 'aggregation': 2.666027285158634e-06, 'network_info': 0.00419734901515767, 'llm_extraction': 42.13567581103416, 'data_cleaning': 1.7211015801876783e-05, 'neo4j_injection': 0.24375128897372633, 'embedding_time': 0, 'indexing_time': 0.002615888020955026, 'graph_injection_time': 0.2409675300004892, 'acs_metrics': {'node_count': 272, 'relationship_count': 690, 'density': 0.0094, 'avg_degree': 5.0735, 'avg_unique_neighbors': 5.0441, 'global_efficiency': 0.3546, 'avg_path_length': 3.0041, 'avg_degree_centrality': 0.0187, 'max_degree_centrality': 0.4797, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0234, 'degree_assortativity': -0.2317, 'graph_robustness': 0.8565, 'diameter_estimate': 7, 'clustering_coefficient': 0.3189, 'weakly_connected_components': 7, 'largest_wcc_size': 266, 'pagerank_top10_percent': 12.74, 'louvain_communities': 17, 'louvain_modularity': 0.5068, 'label_entropy': 1.4169, 'computational_time': 0.23154818697366863}, 'retrieval_queries': []}
2025-11-24 14:36:54,775 - src.pipeline.kg_builder - DEBUG - Batch 14 metrics: {
  "batch_idx": 14,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966214.7751634,
  "total_time": 42.6155189970159,
  "aggregation": 2.666027285158634e-06,
  "network_info": 0.00419734901515767,
  "llm_extraction": 42.13567581103416,
  "data_cleaning": 1.7211015801876783e-05,
  "neo4j_injection": 0.24375128897372633,
  "embedding_time": 0,
  "indexing_time": 0.002615888020955026,
  "graph_injection_time": 0.2409675300004892,
  "acs_metrics": {
    "node_count": 272,
    "relationship_count": 690,
    "density": 0.0094,
    "avg_degree": 5.0735,
    "avg_unique_neighbors": 5.0441,
    "global_efficiency": 0.3546,
    "avg_path_length": 3.0041,
    "avg_degree_centrality": 0.0187,
    "max_degree_centrality": 0.4797,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0234,
    "degree_assortativity": -0.2317,
    "graph_robustness": 0.8565,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.3189,
    "weakly_connected_components": 7,
    "largest_wcc_size": 266,
    "pagerank_top10_percent": 12.74,
    "louvain_communities": 17,
    "louvain_modularity": 0.5068,
    "label_entropy": 1.4169,
    "computational_time": 0.23154818697366863
  },
  "retrieval_queries": []
}
2025-11-24 14:36:54,775 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:36:54,775 - src.pipeline.kg_builder - INFO - Batch 15 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 42.14s, Clean: 0.00s, Neo4j: 0.24s, ACS: 0.23s
2025-11-24 14:36:54,775 - src.pipeline.kg_builder - INFO - Batch 15 completed in 42.62s
Processing KG batches:  21%|██        | 15/72 [08:52<37:09, 39.11s/it]2025-11-24 14:36:54,775 - src.pipeline.kg_builder - INFO - Processing batch 16/72 (3 items)
2025-11-24 14:36:54,775 - src.pipeline.kg_builder - DEBUG - Batch 16 current_video_time: 03:54-03:59
2025-11-24 14:36:54,781 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 272
- Total Relationships: 272
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:36:54,782 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-24 14:36:54,782 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0 ~215 words, content: Time: 03:44-03:49 Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a precise liquid transfer. The person is using...
2025-11-24 14:36:54,782 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1 ~223 words, content: balance. The balance, a Mettler Toledo model, is actively being used to measure the mass of the liquid being transferred. The display on the balance...
2025-11-24 14:36:54,782 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2 ~122 words, content: , which is resting on a digital balance. The digital balance, a Mettler Toledo model, is actively measuring the weight of the contents. The display...
2025-11-24 14:36:54,782 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:36:54,782 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0) (~215 words) with timeout=5.0s retries=3
2025-11-24 14:36:56,034 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:36:56,034 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:36:56,034 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1) (~223 words) with timeout=5.0s retries=3
2025-11-24 14:36:57,324 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:36:57,324 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:36:57,325 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2) (~122 words) with timeout=5.0s retries=3
2025-11-24 14:36:58,660 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:36:58,660 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:36:58,660 - src.components.pre_llm_injector - INFO - Extracted 18 local triplets from 3 chunks
2025-11-24 14:36:58,660 - src.pipeline.kg_builder - INFO - Pre-extraction: 18 triplets in 3.88s
2025-11-24 14:36:58,661 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 272
- Total Relationships: 272
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0"]}, {"head": "Liquid", "relation": "Is Added To", "tail": "Volumetric_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Weight", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1"]}, {"head": "Glass Pipette", "relation": "Is Positioned Over", "tail": "Glass Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1"]}, {"head": "Glass Volumetric Flask", "relation": "Rests On", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "Negative Reading", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1"]}, {"head": "Flask", "relation": "Rests On", "tail": "Digital_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2"]}, {"head": "Digital_Balance", "relation": "Measures", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Negative_Value", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2"]}, {"head": "Negative_Value", "relation": "Indicates", "tail": "Tared_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2"]}, {"head": "Lab_Equipment", "relation": "Contains", "tail": "Glass_Fronted_Cabinet", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2"]}, {"head": "Lab_Equipment", "relation": "Contains", "tail": "Cardboard_Box", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:36:58,661 - src.components.global_refiner - DEBUG - Refining 18 triplets (prompt ~277 words, ~360 tokens)
2025-11-24 14:36:58,661 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:37:18,773 - src.components.global_refiner - DEBUG - LLM call completed in 20.11s
2025-11-24 14:37:18,773 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0']], ['Liquid', 'is_added_to', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0']], ['Digital_Balance', 'displays', 'Weight', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0']], ['Person', 'holds', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1']], ['Person', 'holds', 'Glass_Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1']], ['Glass_Pipette', 'is_positioned_over', 'Glass_Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1']], ['Glass_Volumetric_Flask', 'rests_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1']], ['Digital_Balance', 'displays', 'Negative_Reading', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1']], ['Flask', 'rests_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2']], ['Digital_Balance', 'measures', 'Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2']], ['Digital_Balance', 'displays', 'Negative_Value', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2']], ['Negative_Value', 'indicates', 'Tared_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2']], ['Lab_Equipment', 'contains', 'Glass_Fronted_Cabinet', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2']], ['Lab_Equipment', 'contains', 'Cardboard_Box', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2']]]
2025-11-24 14:37:18,773 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0"
    ]
  ],
  [
    "Liquid",
    "is_added_to",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Weight",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1"
    ]
  ],
  [
    "Glass_Pipette",
    "is_positioned_over",
    "Glass_Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1"
    ]
  ],
  [
    "Glass_Volumetric_Flask",
    "rests_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Negative_Reading",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_1"
    ]
  ],
  [
    "Flask",
    "rests_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Negative_Value",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2"
    ]
  ],
  [
    "Negative_Value",
    "indicates",
    "Tared_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2"
    ]
  ],
  [
    "Lab_Equipment",
    "contains",
    "Glass_Fronted_Cabinet",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2"
    ]
  ],
  [
    "Lab_Equipment",
    "contains",
    "Cardboard_Box",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_15_2"
    ]
  ]
]
2025-11-24 14:37:18,773 - src.components.global_refiner - INFO - Refinement complete: 18 → 17 triplets (total: 20.11s, LLM: 20.11s)
2025-11-24 14:37:18,773 - src.pipeline.kg_builder - INFO - Global refinement: 17 triplets in 20.11s
2025-11-24 14:37:18,773 - src.pipeline.kg_builder - INFO - Using 17 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:37:18,773 - src.pipeline.kg_builder - INFO - Pushing batch 16/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:37:18,774 - src.components.neo4j_handler - INFO - Adding 17 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:37:18,917 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:37:18,917 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:37:18,917 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:37:18,917 - src.components.neo4j_handler - INFO - Batch injected in 0.14s (triplets: 0.14s, indexes: 0.00s)
2025-11-24 14:37:18,917 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:37:18,958 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 283 nodes
2025-11-24 14:37:19,053 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 277 nodes
2025-11-24 14:37:19,160 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 283, 'relationship_count': 723, 'density': 0.0091, 'avg_degree': 5.1095, 'avg_unique_neighbors': 5.0742, 'global_efficiency': 0.3514, 'avg_path_length': 3.0478, 'avg_degree_centrality': 0.0181, 'max_degree_centrality': 0.4716, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0172, 'degree_assortativity': -0.2266, 'graph_robustness': 0.823, 'diameter_estimate': 8, 'clustering_coefficient': 0.3175, 'weakly_connected_components': 7, 'largest_wcc_size': 277, 'pagerank_top10_percent': 12.23, 'louvain_communities': 19, 'louvain_modularity': 0.5184, 'label_entropy': 1.4171, 'computational_time': 0.24288968596374616}
2025-11-24 14:37:19,160 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 15, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966239.1609695, 'total_time': 24.385144954023417, 'aggregation': 2.6949564926326275e-06, 'network_info': 0.0058221640065312386, 'llm_extraction': 23.992126449011266, 'data_cleaning': 1.2440024875104427e-05, 'neo4j_injection': 0.1439512789947912, 'embedding_time': 0, 'indexing_time': 0.0032770020188763738, 'graph_injection_time': 0.14053047099150717, 'acs_metrics': {'node_count': 283, 'relationship_count': 723, 'density': 0.0091, 'avg_degree': 5.1095, 'avg_unique_neighbors': 5.0742, 'global_efficiency': 0.3514, 'avg_path_length': 3.0478, 'avg_degree_centrality': 0.0181, 'max_degree_centrality': 0.4716, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0172, 'degree_assortativity': -0.2266, 'graph_robustness': 0.823, 'diameter_estimate': 8, 'clustering_coefficient': 0.3175, 'weakly_connected_components': 7, 'largest_wcc_size': 277, 'pagerank_top10_percent': 12.23, 'louvain_communities': 19, 'louvain_modularity': 0.5184, 'label_entropy': 1.4171, 'computational_time': 0.24288968596374616}, 'retrieval_queries': []}
2025-11-24 14:37:19,161 - src.pipeline.kg_builder - DEBUG - Batch 15 metrics: {
  "batch_idx": 15,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966239.1609695,
  "total_time": 24.385144954023417,
  "aggregation": 2.6949564926326275e-06,
  "network_info": 0.0058221640065312386,
  "llm_extraction": 23.992126449011266,
  "data_cleaning": 1.2440024875104427e-05,
  "neo4j_injection": 0.1439512789947912,
  "embedding_time": 0,
  "indexing_time": 0.0032770020188763738,
  "graph_injection_time": 0.14053047099150717,
  "acs_metrics": {
    "node_count": 283,
    "relationship_count": 723,
    "density": 0.0091,
    "avg_degree": 5.1095,
    "avg_unique_neighbors": 5.0742,
    "global_efficiency": 0.3514,
    "avg_path_length": 3.0478,
    "avg_degree_centrality": 0.0181,
    "max_degree_centrality": 0.4716,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0172,
    "degree_assortativity": -0.2266,
    "graph_robustness": 0.823,
    "diameter_estimate": 8,
    "clustering_coefficient": 0.3175,
    "weakly_connected_components": 7,
    "largest_wcc_size": 277,
    "pagerank_top10_percent": 12.23,
    "louvain_communities": 19,
    "louvain_modularity": 0.5184,
    "label_entropy": 1.4171,
    "computational_time": 0.24288968596374616
  },
  "retrieval_queries": []
}
2025-11-24 14:37:19,161 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:37:19,161 - src.pipeline.kg_builder - INFO - Batch 16 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 23.99s, Clean: 0.00s, Neo4j: 0.14s, ACS: 0.24s
2025-11-24 14:37:19,161 - src.pipeline.kg_builder - INFO - Batch 16 completed in 24.39s
Processing KG batches:  22%|██▏       | 16/72 [09:16<32:21, 34.68s/it]2025-11-24 14:37:19,161 - src.pipeline.kg_builder - INFO - Processing batch 17/72 (3 items)
2025-11-24 14:37:19,161 - src.pipeline.kg_builder - DEBUG - Batch 17 current_video_time: 04:09-04:14
2025-11-24 14:37:19,170 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 283
- Total Relationships: 285
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:37:19,170 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 14:37:19,170 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0 ~218 words, content: Time: 03:59-04:04 Content: In a laboratory setting, a person wearing blue nitrile gloves is performing a precise measurement. The scene is viewed from a first-person...
2025-11-24 14:37:19,170 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1 ~223 words, content: a first-person perspective, with the person's left arm, which has a watch with a black leather strap, visible in the foreground. The primary action involves...
2025-11-24 14:37:19,170 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2 ~222 words, content: person, whose arm and hand are visible, wearing blue nitrile gloves and a black watch. They are performing a quantitative transfer of a liquid using...
2025-11-24 14:37:19,170 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3 ~56 words, content: the pipette is positioned directly above the flask's opening to ensure accurate transfer. The overall context suggests a methodical and precise scientific task, such as...
2025-11-24 14:37:19,170 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:37:19,171 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0) (~218 words) with timeout=5.0s retries=3
2025-11-24 14:37:20,448 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:37:20,448 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:37:20,448 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1) (~223 words) with timeout=5.0s retries=3
2025-11-24 14:37:21,774 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:37:21,774 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:37:21,774 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2) (~222 words) with timeout=5.0s retries=3
2025-11-24 14:37:22,854 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:37:22,854 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:37:22,854 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3) (~56 words) with timeout=5.0s retries=3
2025-11-24 14:37:23,928 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:37:23,928 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:37:23,928 - src.components.pre_llm_injector - INFO - Extracted 18 local triplets from 4 chunks
2025-11-24 14:37:23,928 - src.pipeline.kg_builder - INFO - Pre-extraction: 18 triplets in 4.76s
2025-11-24 14:37:23,932 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 283
- Total Relationships: 285
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2"]}, {"head": "Volumetric Flask", "relation": "Is On", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "-56.301 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1"]}, {"head": "Pipette", "relation": "Transfers Liquid From", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2"]}, {"head": "Person", "relation": "Wears", "tail": "Black_Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2"]}, {"head": "Pipette", "relation": "Positioned Above", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3"]}, {"head": "Pipette", "relation": "Ensures", "tail": "Accurate_Transfer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3"]}, {"head": "Flask", "relation": "Contains", "tail": "Solution", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3"]}, {"head": "Lab_Worker", "relation": "Wears", "tail": "Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3"]}, {"head": "Lab_Worker", "relation": "Uses", "tail": "Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3"]}, {"head": "Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:37:23,932 - src.components.global_refiner - DEBUG - Refining 18 triplets (prompt ~277 words, ~360 tokens)
2025-11-24 14:37:23,932 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:37:48,738 - src.components.global_refiner - DEBUG - LLM call completed in 24.81s
2025-11-24 14:37:48,738 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2']], ['Person', 'wears', 'Black_Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2']], ['Pipette', 'transfers_liquid_from', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2']], ['Volumetric_Flask', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0']], ['Digital_Balance', 'displays', '-56.301_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1']], ['Beaker', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1']], ['Pipette', 'positioned_above', 'Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3']], ['Pipette', 'ensures', 'Accurate_Transfer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3']], ['Flask', 'contains', 'Solution', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3']], ['Lab_Worker', 'wears', 'Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3']], ['Lab_Worker', 'uses', 'Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3']], ['Balance', 'measures', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3']]]
2025-11-24 14:37:48,738 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Black_Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2"
    ]
  ],
  [
    "Pipette",
    "transfers_liquid_from",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_2"
    ]
  ],
  [
    "Volumetric_Flask",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "-56.301_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_1"
    ]
  ],
  [
    "Pipette",
    "positioned_above",
    "Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3"
    ]
  ],
  [
    "Pipette",
    "ensures",
    "Accurate_Transfer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3"
    ]
  ],
  [
    "Flask",
    "contains",
    "Solution",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3"
    ]
  ],
  [
    "Lab_Worker",
    "wears",
    "Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3"
    ]
  ],
  [
    "Lab_Worker",
    "uses",
    "Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3"
    ]
  ],
  [
    "Balance",
    "measures",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_16_3"
    ]
  ]
]
2025-11-24 14:37:48,738 - src.components.global_refiner - INFO - Refinement complete: 18 → 17 triplets (total: 24.81s, LLM: 24.81s)
2025-11-24 14:37:48,738 - src.pipeline.kg_builder - INFO - Global refinement: 17 triplets in 24.81s
2025-11-24 14:37:48,738 - src.pipeline.kg_builder - INFO - Using 17 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:37:48,738 - src.pipeline.kg_builder - INFO - Pushing batch 17/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:37:48,738 - src.components.neo4j_handler - INFO - Adding 17 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:37:48,971 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:37:48,971 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:37:48,971 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:37:48,971 - src.components.neo4j_handler - INFO - Batch injected in 0.23s (triplets: 0.23s, indexes: 0.01s)
2025-11-24 14:37:48,971 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:37:49,003 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 291 nodes
2025-11-24 14:37:49,099 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 285 nodes
2025-11-24 14:37:49,213 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 291, 'relationship_count': 759, 'density': 0.009, 'avg_degree': 5.2165, 'avg_unique_neighbors': 5.1821, 'global_efficiency': 0.3532, 'avg_path_length': 3.0301, 'avg_degree_centrality': 0.018, 'max_degree_centrality': 0.4724, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0208, 'degree_assortativity': -0.2209, 'graph_robustness': 0.8182, 'diameter_estimate': 8, 'clustering_coefficient': 0.3144, 'weakly_connected_components': 7, 'largest_wcc_size': 285, 'pagerank_top10_percent': 11.9, 'louvain_communities': 19, 'louvain_modularity': 0.5183, 'label_entropy': 1.4218, 'computational_time': 0.24167181801749393}
2025-11-24 14:37:49,213 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 16, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966269.2134442, 'total_time': 30.05180559202563, 'aggregation': 3.1040399335324764e-06, 'network_info': 0.008576355990953743, 'llm_extraction': 29.567911140038632, 'data_cleaning': 1.2303004041314125e-05, 'neo4j_injection': 0.23326836002524942, 'embedding_time': 0, 'indexing_time': 0.005492873955518007, 'graph_injection_time': 0.22764231398468837, 'acs_metrics': {'node_count': 291, 'relationship_count': 759, 'density': 0.009, 'avg_degree': 5.2165, 'avg_unique_neighbors': 5.1821, 'global_efficiency': 0.3532, 'avg_path_length': 3.0301, 'avg_degree_centrality': 0.018, 'max_degree_centrality': 0.4724, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0208, 'degree_assortativity': -0.2209, 'graph_robustness': 0.8182, 'diameter_estimate': 8, 'clustering_coefficient': 0.3144, 'weakly_connected_components': 7, 'largest_wcc_size': 285, 'pagerank_top10_percent': 11.9, 'louvain_communities': 19, 'louvain_modularity': 0.5183, 'label_entropy': 1.4218, 'computational_time': 0.24167181801749393}, 'retrieval_queries': []}
2025-11-24 14:37:49,213 - src.pipeline.kg_builder - DEBUG - Batch 16 metrics: {
  "batch_idx": 16,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966269.2134442,
  "total_time": 30.05180559202563,
  "aggregation": 3.1040399335324764e-06,
  "network_info": 0.008576355990953743,
  "llm_extraction": 29.567911140038632,
  "data_cleaning": 1.2303004041314125e-05,
  "neo4j_injection": 0.23326836002524942,
  "embedding_time": 0,
  "indexing_time": 0.005492873955518007,
  "graph_injection_time": 0.22764231398468837,
  "acs_metrics": {
    "node_count": 291,
    "relationship_count": 759,
    "density": 0.009,
    "avg_degree": 5.2165,
    "avg_unique_neighbors": 5.1821,
    "global_efficiency": 0.3532,
    "avg_path_length": 3.0301,
    "avg_degree_centrality": 0.018,
    "max_degree_centrality": 0.4724,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0208,
    "degree_assortativity": -0.2209,
    "graph_robustness": 0.8182,
    "diameter_estimate": 8,
    "clustering_coefficient": 0.3144,
    "weakly_connected_components": 7,
    "largest_wcc_size": 285,
    "pagerank_top10_percent": 11.9,
    "louvain_communities": 19,
    "louvain_modularity": 0.5183,
    "label_entropy": 1.4218,
    "computational_time": 0.24167181801749393
  },
  "retrieval_queries": []
}
2025-11-24 14:37:49,214 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:37:49,214 - src.pipeline.kg_builder - INFO - Batch 17 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 29.57s, Clean: 0.00s, Neo4j: 0.23s, ACS: 0.24s
2025-11-24 14:37:49,214 - src.pipeline.kg_builder - INFO - Batch 17 completed in 30.05s
Processing KG batches:  24%|██▎       | 17/72 [09:46<30:30, 33.29s/it]2025-11-24 14:37:49,214 - src.pipeline.kg_builder - INFO - Processing batch 18/72 (3 items)
2025-11-24 14:37:49,214 - src.pipeline.kg_builder - DEBUG - Batch 18 current_video_time: 04:24-04:29
2025-11-24 14:37:49,230 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 291
- Total Relationships: 293
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:37:49,230 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:37:49,230 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0 ~224 words, content: Time: 04:14-04:19 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a precise liquid transfer, performed with care and precision. The...
2025-11-24 14:37:49,230 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1 ~229 words, content: used to add a liquid to the beaker. The person's hands are steady, and the focus remains on the precise measurement of the liquid. The...
2025-11-24 14:37:49,230 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2 ~218 words, content: aker. - **Equipment and Setup:** The central focus is the digital balance, which displays a reading of approximately $56.30$ grams. This indicates the person is...
2025-11-24 14:37:49,231 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3 ~222 words, content: bench. A person, whose arm is visible, is using a pipette to transfer a liquid. The liquid is being added to a glass beaker that...
2025-11-24 14:37:49,231 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4 ~106 words, content: - The background shows a typical lab environment with a glass-fronted cabinet, a door, and other equipment. - The digital balance's display changes slightly throughout...
2025-11-24 14:37:49,231 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:37:49,231 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0) (~224 words) with timeout=5.0s retries=3
2025-11-24 14:37:50,513 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:37:50,513 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:37:50,513 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1) (~229 words) with timeout=5.0s retries=3
2025-11-24 14:37:51,549 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:37:51,549 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:37:51,549 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2) (~218 words) with timeout=5.0s retries=3
2025-11-24 14:37:52,501 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:37:52,501 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:37:52,502 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3) (~222 words) with timeout=5.0s retries=3
2025-11-24 14:37:53,740 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:37:53,740 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:37:53,741 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4) (~106 words) with timeout=5.0s retries=3
2025-11-24 14:37:54,923 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:37:54,923 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:37:54,923 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 5 chunks
2025-11-24 14:37:54,923 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 5.69s
2025-11-24 14:37:54,923 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 291
- Total Relationships: 293
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Negative_Reading", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0"]}, {"head": "Person", "relation": "Uses", "tail": "White_Plastic_Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1"]}, {"head": "Person", "relation": "Holds", "tail": "Wash Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2"]}, {"head": "Person", "relation": "Wears", "tail": "Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Document", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2"]}, {"head": "Person", "relation": "Holds", "tail": "Squeeze Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3"]}, {"head": "Liquid", "relation": "Is Added To", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "56.301 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "Glass-Fronted Cabinet", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "Door", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4"]}, {"head": "Mass", "relation": "Is Monitored In Real Time", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4"]}, {"head": "Liquid", "relation": "Is Added To", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:37:54,923 - src.components.global_refiner - DEBUG - Refining 24 triplets (prompt ~338 words, ~439 tokens)
2025-11-24 14:37:54,923 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:38:26,160 - src.components.global_refiner - DEBUG - LLM call completed in 31.24s
2025-11-24 14:38:26,161 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3']], ['Beaker', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0']], ['Digital_Balance', 'displays', 'Negative_Reading', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0']], ['Person', 'uses', 'White_Plastic_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1']], ['Person', 'holds', 'Wash_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2']], ['Digital_Balance', 'measures', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2']], ['Person', 'wears', 'Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1']], ['Person', 'wears', 'Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2']], ['Lab_Table', 'contains', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2']], ['Lab_Table', 'contains', 'Document', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2']], ['Person', 'holds', 'Squeeze_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3']], ['Liquid', 'is_added_to', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3']], ['Beaker', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3']], ['Digital_Balance', 'displays', '56.301_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3']], ['Lab_Environment', 'contains', 'Glass-Fronted_Cabinet', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4']], ['Lab_Environment', 'contains', 'Door', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4']], ['Lab_Environment', 'contains', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4']], ['Digital_Balance', 'displays', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4']], ['Mass', 'is_monitored_in_real_time', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4']], ['Liquid', 'is_added_to', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4']]]
2025-11-24 14:38:26,161 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Negative_Reading",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0"
    ]
  ],
  [
    "Person",
    "uses",
    "White_Plastic_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Wash_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2"
    ]
  ],
  [
    "Lab_Table",
    "contains",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2"
    ]
  ],
  [
    "Lab_Table",
    "contains",
    "Document",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Squeeze_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3"
    ]
  ],
  [
    "Liquid",
    "is_added_to",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "56.301_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_3"
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "Glass-Fronted_Cabinet",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4"
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "Door",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4"
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4"
    ]
  ],
  [
    "Mass",
    "is_monitored_in_real_time",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4"
    ]
  ],
  [
    "Liquid",
    "is_added_to",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_17_4"
    ]
  ]
]
2025-11-24 14:38:26,161 - src.components.global_refiner - INFO - Refinement complete: 24 → 24 triplets (total: 31.24s, LLM: 31.24s)
2025-11-24 14:38:26,161 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 31.24s
2025-11-24 14:38:26,161 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:38:26,161 - src.pipeline.kg_builder - INFO - Pushing batch 18/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:38:26,161 - src.components.neo4j_handler - INFO - Adding 23 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:38:26,477 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:38:26,477 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:38:26,478 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:38:26,478 - src.components.neo4j_handler - INFO - Batch injected in 0.32s (triplets: 0.31s, indexes: 0.00s)
2025-11-24 14:38:26,478 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:38:26,511 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 300 nodes
2025-11-24 14:38:26,616 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 294 nodes
2025-11-24 14:38:26,735 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 300, 'relationship_count': 807, 'density': 0.009, 'avg_degree': 5.38, 'avg_unique_neighbors': 5.34, 'global_efficiency': 0.3554, 'avg_path_length': 3.0133, 'avg_degree_centrality': 0.018, 'max_degree_centrality': 0.4749, 'avg_betweenness_centrality': 0.0012, 'max_betweenness_centrality': 0.0488, 'degree_assortativity': -0.2143, 'graph_robustness': 0.824, 'diameter_estimate': 8, 'clustering_coefficient': 0.3111, 'weakly_connected_components': 7, 'largest_wcc_size': 294, 'pagerank_top10_percent': 11.56, 'louvain_communities': 19, 'louvain_modularity': 0.5061, 'label_entropy': 1.4277, 'computational_time': 0.25734962901333347}
2025-11-24 14:38:26,735 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 17, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966306.7356403, 'total_time': 37.521492131985724, 'aggregation': 2.4979817681014538e-06, 'network_info': 0.016151328047271818, 'llm_extraction': 36.930766139994375, 'data_cleaning': 1.6963982488960028e-05, 'neo4j_injection': 0.31687822501407936, 'embedding_time': 0, 'indexing_time': 0.0032395049929618835, 'graph_injection_time': 0.3134756769868545, 'acs_metrics': {'node_count': 300, 'relationship_count': 807, 'density': 0.009, 'avg_degree': 5.38, 'avg_unique_neighbors': 5.34, 'global_efficiency': 0.3554, 'avg_path_length': 3.0133, 'avg_degree_centrality': 0.018, 'max_degree_centrality': 0.4749, 'avg_betweenness_centrality': 0.0012, 'max_betweenness_centrality': 0.0488, 'degree_assortativity': -0.2143, 'graph_robustness': 0.824, 'diameter_estimate': 8, 'clustering_coefficient': 0.3111, 'weakly_connected_components': 7, 'largest_wcc_size': 294, 'pagerank_top10_percent': 11.56, 'louvain_communities': 19, 'louvain_modularity': 0.5061, 'label_entropy': 1.4277, 'computational_time': 0.25734962901333347}, 'retrieval_queries': []}
2025-11-24 14:38:26,735 - src.pipeline.kg_builder - DEBUG - Batch 17 metrics: {
  "batch_idx": 17,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966306.7356403,
  "total_time": 37.521492131985724,
  "aggregation": 2.4979817681014538e-06,
  "network_info": 0.016151328047271818,
  "llm_extraction": 36.930766139994375,
  "data_cleaning": 1.6963982488960028e-05,
  "neo4j_injection": 0.31687822501407936,
  "embedding_time": 0,
  "indexing_time": 0.0032395049929618835,
  "graph_injection_time": 0.3134756769868545,
  "acs_metrics": {
    "node_count": 300,
    "relationship_count": 807,
    "density": 0.009,
    "avg_degree": 5.38,
    "avg_unique_neighbors": 5.34,
    "global_efficiency": 0.3554,
    "avg_path_length": 3.0133,
    "avg_degree_centrality": 0.018,
    "max_degree_centrality": 0.4749,
    "avg_betweenness_centrality": 0.0012,
    "max_betweenness_centrality": 0.0488,
    "degree_assortativity": -0.2143,
    "graph_robustness": 0.824,
    "diameter_estimate": 8,
    "clustering_coefficient": 0.3111,
    "weakly_connected_components": 7,
    "largest_wcc_size": 294,
    "pagerank_top10_percent": 11.56,
    "louvain_communities": 19,
    "louvain_modularity": 0.5061,
    "label_entropy": 1.4277,
    "computational_time": 0.25734962901333347
  },
  "retrieval_queries": []
}
2025-11-24 14:38:26,736 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:38:26,736 - src.pipeline.kg_builder - INFO - Batch 18 timings - Agg: 0.00s, NetInfo: 0.02s, LLM: 36.93s, Clean: 0.00s, Neo4j: 0.32s, ACS: 0.26s
2025-11-24 14:38:26,736 - src.pipeline.kg_builder - INFO - Batch 18 completed in 37.52s
Processing KG batches:  25%|██▌       | 18/72 [10:24<31:06, 34.56s/it]2025-11-24 14:38:26,736 - src.pipeline.kg_builder - INFO - Processing batch 19/72 (3 items)
2025-11-24 14:38:26,736 - src.pipeline.kg_builder - DEBUG - Batch 19 current_video_time: 04:39-04:44
2025-11-24 14:38:26,744 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 300
- Total Relationships: 305
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:38:26,745 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:38:26,745 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0 ~217 words, content: Time: 04:29-04:34 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a precise liquid transfer, performed by a person wearing blue...
2025-11-24 14:38:26,745 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1 ~200 words, content: a counter in the background. A sign with Chinese characters, "当心火灾" (Beware of fire), is visible on the wall, indicating a safety precaution. - **Procedure:**...
2025-11-24 14:38:26,745 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2 ~214 words, content: - A **volumetric flask**, which is a round-bottomed flask with a long neck, is positioned on the table to receive the liquid. - A **digital...
2025-11-24 14:38:26,745 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3 ~197 words, content: **Primary Action:** A person wearing blue nitrile gloves is carefully pouring a clear liquid from a small, transparent glass beaker into a long, thin glass...
2025-11-24 14:38:26,745 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4 ~106 words, content: to receive the liquid. The liquid is being dispensed into this flask. - **Other Lab Equipment:** In the background, there is a white shelving unit...
2025-11-24 14:38:26,745 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:38:26,745 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0) (~217 words) with timeout=5.0s retries=3
2025-11-24 14:38:27,916 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:38:27,916 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:38:27,917 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1) (~200 words) with timeout=5.0s retries=3
2025-11-24 14:38:28,961 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:38:28,962 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:38:28,962 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2) (~214 words) with timeout=5.0s retries=3
2025-11-24 14:38:30,192 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:38:30,192 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:38:30,192 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3) (~197 words) with timeout=5.0s retries=3
2025-11-24 14:38:31,467 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:38:31,467 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:38:31,468 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4) (~106 words) with timeout=5.0s retries=3
2025-11-24 14:38:32,689 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:38:32,689 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:38:32,689 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 5 chunks
2025-11-24 14:38:32,689 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 5.95s
2025-11-24 14:38:32,690 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 300
- Total Relationships: 305
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1"]}, {"head": "Beaker", "relation": "Placed On", "tail": "Digital_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Mass_Value", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1"]}, {"head": "Volumetric Flask", "relation": "Receives", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1"]}, {"head": "Wall", "relation": "Displays", "tail": "Sign", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1"]}, {"head": "Volumetric Flask", "relation": "Is Positioned On", "tail": "Lab Table", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "Weight", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2"]}, {"head": "Beaker", "relation": "Is Held Over", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Piece Of Paper", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3"]}, {"head": "Pipette", "relation": "Dispenses", "tail": "Liquid_To_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3"]}, {"head": "Liquid", "relation": "Is Dispensed Into", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4"]}, {"head": "Watch", "relation": "Has", "tail": "Black_Leather_Strap", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4"]}, {"head": "Watch", "relation": "Has", "tail": "Gold_Colored_Case", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4"]}, {"head": "Lab_Equipment", "relation": "Is Visible In", "tail": "Background", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4"]}, {"head": "Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:38:32,690 - src.components.global_refiner - DEBUG - Refining 24 triplets (prompt ~332 words, ~432 tokens)
2025-11-24 14:38:32,690 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:39:04,212 - src.components.global_refiner - DEBUG - LLM call completed in 31.52s
2025-11-24 14:39:04,212 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1']], ['Beaker', 'placed_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0']], ['Digital_Balance', 'displays', 'Mass_Value', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1']], ['Volumetric_Flask', 'receives', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1']], ['Wall', 'displays', 'Sign', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1']], ['Volumetric_Flask', 'is_positioned_on', 'Lab_Table', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2']], ['Digital_Balance', 'displays', 'Weight', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2']], ['Beaker', 'is_held_over', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3']], ['Lab_Table', 'contains', 'Piece_Of_Paper', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2']], ['Beaker', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3']], ['Pipette', 'transfers', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3']], ['Pipette', 'dispenses', 'Liquid_To_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3']], ['Liquid', 'is_dispensed_into', 'Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4']], ['Person', 'wears', 'Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4']], ['Watch', 'has', 'Black_Leather_Strap', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4']], ['Watch', 'has', 'Gold_Colored_Case', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4']], ['Lab_Equipment', 'is_visible_in', 'Background', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4']], ['Flask', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4']]]
2025-11-24 14:39:04,212 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1"
    ]
  ],
  [
    "Beaker",
    "placed_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Mass_Value",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1"
    ]
  ],
  [
    "Volumetric_Flask",
    "receives",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1"
    ]
  ],
  [
    "Wall",
    "displays",
    "Sign",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_1"
    ]
  ],
  [
    "Volumetric_Flask",
    "is_positioned_on",
    "Lab_Table",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Weight",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2"
    ]
  ],
  [
    "Beaker",
    "is_held_over",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3"
    ]
  ],
  [
    "Lab_Table",
    "contains",
    "Piece_Of_Paper",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3"
    ]
  ],
  [
    "Pipette",
    "dispenses",
    "Liquid_To_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_3"
    ]
  ],
  [
    "Liquid",
    "is_dispensed_into",
    "Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4"
    ]
  ],
  [
    "Watch",
    "has",
    "Black_Leather_Strap",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4"
    ]
  ],
  [
    "Watch",
    "has",
    "Gold_Colored_Case",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4"
    ]
  ],
  [
    "Lab_Equipment",
    "is_visible_in",
    "Background",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4"
    ]
  ],
  [
    "Flask",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_18_4"
    ]
  ]
]
2025-11-24 14:39:04,212 - src.components.global_refiner - INFO - Refinement complete: 24 → 24 triplets (total: 31.52s, LLM: 31.52s)
2025-11-24 14:39:04,212 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 31.52s
2025-11-24 14:39:04,213 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:39:04,213 - src.pipeline.kg_builder - INFO - Pushing batch 19/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:39:04,213 - src.components.neo4j_handler - INFO - Adding 23 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:39:04,504 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:39:04,504 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:39:04,505 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:39:04,505 - src.components.neo4j_handler - INFO - Batch injected in 0.29s (triplets: 0.29s, indexes: 0.00s)
2025-11-24 14:39:04,505 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:39:04,549 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 313 nodes
2025-11-24 14:39:04,667 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 307 nodes
2025-11-24 14:39:04,853 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 313, 'relationship_count': 854, 'density': 0.0087, 'avg_degree': 5.4569, 'avg_unique_neighbors': 5.4058, 'global_efficiency': 0.3558, 'avg_path_length': 3.0024, 'avg_degree_centrality': 0.0175, 'max_degree_centrality': 0.4712, 'avg_betweenness_centrality': 0.001, 'max_betweenness_centrality': 0.0504, 'degree_assortativity': -0.1963, 'graph_robustness': 0.829, 'diameter_estimate': 7, 'clustering_coefficient': 0.3131, 'weakly_connected_components': 7, 'largest_wcc_size': 307, 'pagerank_top10_percent': 11.1, 'louvain_communities': 19, 'louvain_modularity': 0.4798, 'label_entropy': 1.4307, 'computational_time': 0.3477305879932828}
2025-11-24 14:39:04,853 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 18, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966344.853378, 'total_time': 38.11703376204241, 'aggregation': 3.2390234991908073e-06, 'network_info': 0.008190635009668767, 'llm_extraction': 37.46834439295344, 'data_cleaning': 1.6425037756562233e-05, 'neo4j_injection': 0.29235386999789625, 'embedding_time': 0, 'indexing_time': 0.004346556030213833, 'graph_injection_time': 0.28785803099162877, 'acs_metrics': {'node_count': 313, 'relationship_count': 854, 'density': 0.0087, 'avg_degree': 5.4569, 'avg_unique_neighbors': 5.4058, 'global_efficiency': 0.3558, 'avg_path_length': 3.0024, 'avg_degree_centrality': 0.0175, 'max_degree_centrality': 0.4712, 'avg_betweenness_centrality': 0.001, 'max_betweenness_centrality': 0.0504, 'degree_assortativity': -0.1963, 'graph_robustness': 0.829, 'diameter_estimate': 7, 'clustering_coefficient': 0.3131, 'weakly_connected_components': 7, 'largest_wcc_size': 307, 'pagerank_top10_percent': 11.1, 'louvain_communities': 19, 'louvain_modularity': 0.4798, 'label_entropy': 1.4307, 'computational_time': 0.3477305879932828}, 'retrieval_queries': []}
2025-11-24 14:39:04,853 - src.pipeline.kg_builder - DEBUG - Batch 18 metrics: {
  "batch_idx": 18,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966344.853378,
  "total_time": 38.11703376204241,
  "aggregation": 3.2390234991908073e-06,
  "network_info": 0.008190635009668767,
  "llm_extraction": 37.46834439295344,
  "data_cleaning": 1.6425037756562233e-05,
  "neo4j_injection": 0.29235386999789625,
  "embedding_time": 0,
  "indexing_time": 0.004346556030213833,
  "graph_injection_time": 0.28785803099162877,
  "acs_metrics": {
    "node_count": 313,
    "relationship_count": 854,
    "density": 0.0087,
    "avg_degree": 5.4569,
    "avg_unique_neighbors": 5.4058,
    "global_efficiency": 0.3558,
    "avg_path_length": 3.0024,
    "avg_degree_centrality": 0.0175,
    "max_degree_centrality": 0.4712,
    "avg_betweenness_centrality": 0.001,
    "max_betweenness_centrality": 0.0504,
    "degree_assortativity": -0.1963,
    "graph_robustness": 0.829,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.3131,
    "weakly_connected_components": 7,
    "largest_wcc_size": 307,
    "pagerank_top10_percent": 11.1,
    "louvain_communities": 19,
    "louvain_modularity": 0.4798,
    "label_entropy": 1.4307,
    "computational_time": 0.3477305879932828
  },
  "retrieval_queries": []
}
2025-11-24 14:39:04,854 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:39:04,854 - src.pipeline.kg_builder - INFO - Batch 19 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 37.47s, Clean: 0.00s, Neo4j: 0.29s, ACS: 0.35s
2025-11-24 14:39:04,854 - src.pipeline.kg_builder - INFO - Batch 19 completed in 38.12s
Processing KG batches:  26%|██▋       | 19/72 [11:02<31:28, 35.63s/it]2025-11-24 14:39:04,854 - src.pipeline.kg_builder - INFO - Processing batch 20/72 (3 items)
2025-11-24 14:39:04,854 - src.pipeline.kg_builder - DEBUG - Batch 20 current_video_time: 04:54-04:59
2025-11-24 14:39:04,860 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 313
- Total Relationships: 319
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:39:04,860 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:39:04,860 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0 ~214 words, content: Time: 04:44-04:49 Content: The video captures a detailed, first-person perspective of a precise laboratory procedure, likely the preparation of a solution. The sequence of actions...
2025-11-24 14:39:04,860 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1 ~225 words, content: **Step 2: Measuring and Transferring:** The person continues to use the pipette to draw liquid from the beaker. The beaker is then placed on the...
2025-11-24 14:39:04,860 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2 ~222 words, content: . Time: 04:49-04:54 Content: The video sequence captures a detailed, first-person perspective of a precise laboratory procedure, likely a titration or a solution preparation step....
2025-11-24 14:39:04,860 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3 ~226 words, content: ette." The liquid being used for the rinse is likely a solvent or a diluent, as indicated by the "10%" label on the wash bottle....
2025-11-24 14:39:04,860 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4 ~146 words, content: achieve a specific weight. - **Equipment and Setup:** The experiment is taking place on a black laboratory bench. In addition to the balance and beaker,...
2025-11-24 14:39:04,860 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:39:04,861 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0) (~214 words) with timeout=5.0s retries=3
2025-11-24 14:39:05,992 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:39:05,992 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:39:05,992 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1) (~225 words) with timeout=5.0s retries=3
2025-11-24 14:39:07,063 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:39:07,063 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:39:07,063 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2) (~222 words) with timeout=5.0s retries=3
2025-11-24 14:39:08,362 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:39:08,362 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:39:08,362 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3) (~226 words) with timeout=5.0s retries=3
2025-11-24 14:39:13,369 - src.components.pre_llm_injector - WARNING - Chunk 3 timed out after 5.0s (attempt 1/4), retrying...
2025-11-24 14:39:15,201 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 2)
2025-11-24 14:39:15,202 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:39:15,202 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4) (~146 words) with timeout=5.0s retries=3
2025-11-24 14:39:16,202 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:39:16,202 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:39:16,202 - src.components.pre_llm_injector - INFO - Extracted 25 local triplets from 5 chunks
2025-11-24 14:39:16,202 - src.pipeline.kg_builder - INFO - Pre-extraction: 25 triplets in 11.34s
2025-11-24 14:39:16,202 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 313
- Total Relationships: 319
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0"]}, {"head": "Beaker", "relation": "Is Held Over", "tail": "Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0"]}, {"head": "Balance", "relation": "Displays", "tail": "Negative_Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1"]}, {"head": "Liquid", "relation": "Is Added To", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1"]}, {"head": "Beaker", "relation": "Is Placed On", "tail": "Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1"]}, {"head": "Person", "relation": "Measures", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4"]}, {"head": "Pipette", "relation": "Transfers Liquid To", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2"]}, {"head": "Person", "relation": "Uses", "tail": "Wash_Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2"]}, {"head": "Wash_Bottle", "relation": "Rinses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2"]}, {"head": "Person", "relation": "Uses", "tail": "Glass_Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3"]}, {"head": "Glass_Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3"]}, {"head": "Glass_Beaker", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "56.301_G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3"]}, {"head": "Person", "relation": "Holds", "tail": "Squeeze Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4"]}, {"head": "Squeeze Bottle", "relation": "Controls", "tail": "Liquid Flow", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4"]}, {"head": "Pipette", "relation": "Adds", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4"]}, {"head": "Beaker", "relation": "Receives", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4"]}, {"head": "Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:39:16,202 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~333 words, ~433 tokens)
2025-11-24 14:39:16,202 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:39:47,797 - src.components.global_refiner - DEBUG - LLM call completed in 31.59s
2025-11-24 14:39:47,797 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3']], ['Person', 'wears', 'Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2']], ['Beaker', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0']], ['Beaker', 'is_held_over', 'Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0']], ['Balance', 'displays', 'Negative_Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1']], ['Liquid', 'is_added_to', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1']], ['Beaker', 'is_placed_on', 'Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1']], ['Person', 'measures', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4']], ['Pipette', 'transfers_liquid_to', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2']], ['Person', 'uses', 'Wash_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2']], ['Wash_Bottle', 'rinses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2']], ['Person', 'uses', 'Glass_Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3']], ['Glass_Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3']], ['Glass_Beaker', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3']], ['Digital_Balance', 'displays', '56.301_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3']], ['Person', 'holds', 'Squeeze_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4']], ['Squeeze_Bottle', 'controls', 'Liquid_Flow', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4']], ['Pipette', 'adds', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4']], ['Beaker', 'receives', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4']], ['Balance', 'measures', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4']]]
2025-11-24 14:39:47,797 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0"
    ]
  ],
  [
    "Beaker",
    "is_held_over",
    "Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0"
    ]
  ],
  [
    "Balance",
    "displays",
    "Negative_Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1"
    ]
  ],
  [
    "Liquid",
    "is_added_to",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1"
    ]
  ],
  [
    "Beaker",
    "is_placed_on",
    "Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1"
    ]
  ],
  [
    "Person",
    "measures",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4"
    ]
  ],
  [
    "Pipette",
    "transfers_liquid_to",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Wash_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2"
    ]
  ],
  [
    "Wash_Bottle",
    "rinses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Glass_Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3"
    ]
  ],
  [
    "Glass_Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3"
    ]
  ],
  [
    "Glass_Beaker",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "56.301_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Squeeze_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4"
    ]
  ],
  [
    "Squeeze_Bottle",
    "controls",
    "Liquid_Flow",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4"
    ]
  ],
  [
    "Pipette",
    "adds",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4"
    ]
  ],
  [
    "Beaker",
    "receives",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4"
    ]
  ],
  [
    "Balance",
    "measures",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_19_4"
    ]
  ]
]
2025-11-24 14:39:47,797 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 31.59s, LLM: 31.59s)
2025-11-24 14:39:47,797 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 31.59s
2025-11-24 14:39:47,797 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:39:47,797 - src.pipeline.kg_builder - INFO - Pushing batch 20/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:39:47,797 - src.components.neo4j_handler - INFO - Adding 25 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:39:48,099 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:39:48,099 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:39:48,100 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:39:48,100 - src.components.neo4j_handler - INFO - Batch injected in 0.30s (triplets: 0.30s, indexes: 0.00s)
2025-11-24 14:39:48,100 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:39:48,138 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 320 nodes
2025-11-24 14:39:48,261 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 314 nodes
2025-11-24 14:39:48,403 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 320, 'relationship_count': 893, 'density': 0.0087, 'avg_degree': 5.5812, 'avg_unique_neighbors': 5.5312, 'global_efficiency': 0.3577, 'avg_path_length': 2.9879, 'avg_degree_centrality': 0.0175, 'max_degree_centrality': 0.4765, 'avg_betweenness_centrality': 0.0014, 'max_betweenness_centrality': 0.0581, 'degree_assortativity': -0.1874, 'graph_robustness': 0.8343, 'diameter_estimate': 7, 'clustering_coefficient': 0.3115, 'weakly_connected_components': 7, 'largest_wcc_size': 314, 'pagerank_top10_percent': 10.9, 'louvain_communities': 20, 'louvain_modularity': 0.494, 'label_entropy': 1.4368, 'computational_time': 0.30298825295176357}
2025-11-24 14:39:48,403 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 19, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966388.4035437, 'total_time': 43.54938471299829, 'aggregation': 2.1859887056052685e-06, 'network_info': 0.00601653300691396, 'llm_extraction': 42.93715611100197, 'data_cleaning': 1.7784012015908957e-05, 'neo4j_injection': 0.30285648902645335, 'embedding_time': 0, 'indexing_time': 0.004025108995847404, 'graph_injection_time': 0.29868005600292236, 'acs_metrics': {'node_count': 320, 'relationship_count': 893, 'density': 0.0087, 'avg_degree': 5.5812, 'avg_unique_neighbors': 5.5312, 'global_efficiency': 0.3577, 'avg_path_length': 2.9879, 'avg_degree_centrality': 0.0175, 'max_degree_centrality': 0.4765, 'avg_betweenness_centrality': 0.0014, 'max_betweenness_centrality': 0.0581, 'degree_assortativity': -0.1874, 'graph_robustness': 0.8343, 'diameter_estimate': 7, 'clustering_coefficient': 0.3115, 'weakly_connected_components': 7, 'largest_wcc_size': 314, 'pagerank_top10_percent': 10.9, 'louvain_communities': 20, 'louvain_modularity': 0.494, 'label_entropy': 1.4368, 'computational_time': 0.30298825295176357}, 'retrieval_queries': []}
2025-11-24 14:39:48,403 - src.pipeline.kg_builder - DEBUG - Batch 19 metrics: {
  "batch_idx": 19,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966388.4035437,
  "total_time": 43.54938471299829,
  "aggregation": 2.1859887056052685e-06,
  "network_info": 0.00601653300691396,
  "llm_extraction": 42.93715611100197,
  "data_cleaning": 1.7784012015908957e-05,
  "neo4j_injection": 0.30285648902645335,
  "embedding_time": 0,
  "indexing_time": 0.004025108995847404,
  "graph_injection_time": 0.29868005600292236,
  "acs_metrics": {
    "node_count": 320,
    "relationship_count": 893,
    "density": 0.0087,
    "avg_degree": 5.5812,
    "avg_unique_neighbors": 5.5312,
    "global_efficiency": 0.3577,
    "avg_path_length": 2.9879,
    "avg_degree_centrality": 0.0175,
    "max_degree_centrality": 0.4765,
    "avg_betweenness_centrality": 0.0014,
    "max_betweenness_centrality": 0.0581,
    "degree_assortativity": -0.1874,
    "graph_robustness": 0.8343,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.3115,
    "weakly_connected_components": 7,
    "largest_wcc_size": 314,
    "pagerank_top10_percent": 10.9,
    "louvain_communities": 20,
    "louvain_modularity": 0.494,
    "label_entropy": 1.4368,
    "computational_time": 0.30298825295176357
  },
  "retrieval_queries": []
}
2025-11-24 14:39:48,404 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:39:48,404 - src.pipeline.kg_builder - INFO - Batch 20 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 42.94s, Clean: 0.00s, Neo4j: 0.30s, ACS: 0.30s
2025-11-24 14:39:48,404 - src.pipeline.kg_builder - INFO - Batch 20 completed in 43.55s
Processing KG batches:  28%|██▊       | 20/72 [11:46<32:56, 38.01s/it]2025-11-24 14:39:48,404 - src.pipeline.kg_builder - INFO - Processing batch 21/72 (3 items)
2025-11-24 14:39:48,404 - src.pipeline.kg_builder - DEBUG - Batch 21 current_video_time: 05:09-05:14
2025-11-24 14:39:48,409 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 320
- Total Relationships: 330
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:39:48,410 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 14:39:48,410 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0 ~215 words, content: Time: 04:59-05:04 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a precise liquid transfer, performed by a person wearing blue...
2025-11-24 14:39:48,410 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1 ~230 words, content: ** The person then uses their right hand to pick up the beaker, which is still on the balance. They lift it slightly, likely to...
2025-11-24 14:39:48,410 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2 ~224 words, content: aker into a larger, empty volumetric flask. This is a standard technique in analytical chemistry for preparing a solution of a specific concentration. - **Measurement:**...
2025-11-24 14:39:48,410 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3 ~122 words, content: . The individual, wearing blue nitrile gloves, is carefully transferring a liquid from a small beaker into a volumetric flask. The process is being conducted...
2025-11-24 14:39:48,410 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:39:48,410 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0) (~215 words) with timeout=5.0s retries=3
2025-11-24 14:39:49,769 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:39:49,769 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:39:49,769 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1) (~230 words) with timeout=5.0s retries=3
2025-11-24 14:39:50,819 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:39:50,819 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:39:50,819 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2) (~224 words) with timeout=5.0s retries=3
2025-11-24 14:39:52,049 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:39:52,049 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:39:52,049 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3) (~122 words) with timeout=5.0s retries=3
2025-11-24 14:39:53,293 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:39:53,293 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:39:53,293 - src.components.pre_llm_injector - INFO - Extracted 20 local triplets from 4 chunks
2025-11-24 14:39:53,293 - src.pipeline.kg_builder - INFO - Pre-extraction: 20 triplets in 4.88s
2025-11-24 14:39:53,293 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 320
- Total Relationships: 330
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0"]}, {"head": "Person", "relation": "Holds", "tail": "Clear Plastic Wash Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0"]}, {"head": "Glass Pipette", "relation": "Is Positioned Above", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0"]}, {"head": "Glass Beaker", "relation": "Is On", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "630.1", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2"]}, {"head": "Liquid", "relation": "Is Measured On", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "-56.301 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2"]}, {"head": "Person", "relation": "Performs", "tail": "Liquid Transfer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Volumetric_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3"]}, {"head": "Digital_Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3"]}, {"head": "Lab_Equipment", "relation": "Is In", "tail": "Background", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:39:53,293 - src.components.global_refiner - DEBUG - Refining 20 triplets (prompt ~303 words, ~394 tokens)
2025-11-24 14:39:53,293 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:40:17,715 - src.components.global_refiner - DEBUG - LLM call completed in 24.42s
2025-11-24 14:40:17,715 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3']], ['Person', 'holds', 'Glass_Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0']], ['Person', 'holds', 'Clear_Plastic_Wash_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0']], ['Glass_Pipette', 'is_positioned_above', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0']], ['Glass_Beaker', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0']], ['Digital_Balance', 'displays', '630.1', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1']], ['Beaker', 'is_on', 'Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1']], ['Person', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2']], ['Liquid', 'is_measured_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2']], ['Digital_Balance', 'displays', '-56.301_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2']], ['Person', 'performs', 'Liquid_Transfer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2']], ['Liquid', 'is_transferred_to', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3']], ['Digital_Balance', 'measures', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3']], ['Lab_Equipment', 'is_in', 'Background', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3']]]
2025-11-24 14:40:17,715 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Clear_Plastic_Wash_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0"
    ]
  ],
  [
    "Glass_Pipette",
    "is_positioned_above",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0"
    ]
  ],
  [
    "Glass_Beaker",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "630.1",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2"
    ]
  ],
  [
    "Liquid",
    "is_measured_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "-56.301_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2"
    ]
  ],
  [
    "Person",
    "performs",
    "Liquid_Transfer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_2"
    ]
  ],
  [
    "Liquid",
    "is_transferred_to",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3"
    ]
  ],
  [
    "Lab_Equipment",
    "is_in",
    "Background",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_20_3"
    ]
  ]
]
2025-11-24 14:40:17,715 - src.components.global_refiner - INFO - Refinement complete: 20 → 19 triplets (total: 24.42s, LLM: 24.42s)
2025-11-24 14:40:17,715 - src.pipeline.kg_builder - INFO - Global refinement: 19 triplets in 24.42s
2025-11-24 14:40:17,715 - src.pipeline.kg_builder - INFO - Using 19 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:40:17,715 - src.pipeline.kg_builder - INFO - Pushing batch 21/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:40:17,715 - src.components.neo4j_handler - INFO - Adding 19 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:40:17,947 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:40:17,947 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:40:17,948 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:40:17,948 - src.components.neo4j_handler - INFO - Batch injected in 0.23s (triplets: 0.23s, indexes: 0.01s)
2025-11-24 14:40:17,948 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:40:17,988 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 327 nodes
2025-11-24 14:40:18,118 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 321 nodes
2025-11-24 14:40:18,267 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 327, 'relationship_count': 926, 'density': 0.0087, 'avg_degree': 5.6636, 'avg_unique_neighbors': 5.6086, 'global_efficiency': 0.36, 'avg_path_length': 2.9698, 'avg_degree_centrality': 0.0174, 'max_degree_centrality': 0.4847, 'avg_betweenness_centrality': 0.0013, 'max_betweenness_centrality': 0.0578, 'degree_assortativity': -0.1892, 'graph_robustness': 0.8402, 'diameter_estimate': 7, 'clustering_coefficient': 0.3126, 'weakly_connected_components': 7, 'largest_wcc_size': 321, 'pagerank_top10_percent': 10.71, 'louvain_communities': 18, 'louvain_modularity': 0.4857, 'label_entropy': 1.4405, 'computational_time': 0.3194216990377754}
2025-11-24 14:40:18,268 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 20, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966418.268029, 'total_time': 29.863751996017527, 'aggregation': 2.543965820223093e-06, 'network_info': 0.005303498008288443, 'llm_extraction': 29.305826888012234, 'data_cleaning': 1.4873978216201067e-05, 'neo4j_injection': 0.23278210096759722, 'embedding_time': 0, 'indexing_time': 0.0057847980060614645, 'graph_injection_time': 0.22685723297763616, 'acs_metrics': {'node_count': 327, 'relationship_count': 926, 'density': 0.0087, 'avg_degree': 5.6636, 'avg_unique_neighbors': 5.6086, 'global_efficiency': 0.36, 'avg_path_length': 2.9698, 'avg_degree_centrality': 0.0174, 'max_degree_centrality': 0.4847, 'avg_betweenness_centrality': 0.0013, 'max_betweenness_centrality': 0.0578, 'degree_assortativity': -0.1892, 'graph_robustness': 0.8402, 'diameter_estimate': 7, 'clustering_coefficient': 0.3126, 'weakly_connected_components': 7, 'largest_wcc_size': 321, 'pagerank_top10_percent': 10.71, 'louvain_communities': 18, 'louvain_modularity': 0.4857, 'label_entropy': 1.4405, 'computational_time': 0.3194216990377754}, 'retrieval_queries': []}
2025-11-24 14:40:18,268 - src.pipeline.kg_builder - DEBUG - Batch 20 metrics: {
  "batch_idx": 20,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966418.268029,
  "total_time": 29.863751996017527,
  "aggregation": 2.543965820223093e-06,
  "network_info": 0.005303498008288443,
  "llm_extraction": 29.305826888012234,
  "data_cleaning": 1.4873978216201067e-05,
  "neo4j_injection": 0.23278210096759722,
  "embedding_time": 0,
  "indexing_time": 0.0057847980060614645,
  "graph_injection_time": 0.22685723297763616,
  "acs_metrics": {
    "node_count": 327,
    "relationship_count": 926,
    "density": 0.0087,
    "avg_degree": 5.6636,
    "avg_unique_neighbors": 5.6086,
    "global_efficiency": 0.36,
    "avg_path_length": 2.9698,
    "avg_degree_centrality": 0.0174,
    "max_degree_centrality": 0.4847,
    "avg_betweenness_centrality": 0.0013,
    "max_betweenness_centrality": 0.0578,
    "degree_assortativity": -0.1892,
    "graph_robustness": 0.8402,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.3126,
    "weakly_connected_components": 7,
    "largest_wcc_size": 321,
    "pagerank_top10_percent": 10.71,
    "louvain_communities": 18,
    "louvain_modularity": 0.4857,
    "label_entropy": 1.4405,
    "computational_time": 0.3194216990377754
  },
  "retrieval_queries": []
}
2025-11-24 14:40:18,268 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:40:18,268 - src.pipeline.kg_builder - INFO - Batch 21 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 29.31s, Clean: 0.00s, Neo4j: 0.23s, ACS: 0.32s
2025-11-24 14:40:18,268 - src.pipeline.kg_builder - INFO - Batch 21 completed in 29.86s
Processing KG batches:  29%|██▉       | 21/72 [12:15<30:13, 35.56s/it]2025-11-24 14:40:18,268 - src.pipeline.kg_builder - INFO - Processing batch 22/72 (3 items)
2025-11-24 14:40:18,268 - src.pipeline.kg_builder - DEBUG - Batch 22 current_video_time: 05:24-05:29
2025-11-24 14:40:18,273 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 327
- Total Relationships: 338
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:40:18,273 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:40:18,273 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0 ~222 words, content: Time: 05:14-05:19 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a solution preparation, performed by a scientist wearing blue nitrile...
2025-11-24 14:40:18,273 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1 ~247 words, content: **Frame 3:** The perspective changes to a wider shot, showing more of the laboratory bench. The person is now using a pipette to transfer liquid...
2025-11-24 14:40:18,273 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2 ~225 words, content: suggests that the procedure requires high accuracy, possibly for preparing a standard solution or conducting a titration. The person is carefully handling the equipment and...
2025-11-24 14:40:18,273 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3 ~228 words, content: - **Final Action:** After the liquid has been added, the person removes the pipette from the beaker. The beaker is then lifted and placed onto...
2025-11-24 14:40:18,273 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4 ~184 words, content: involves a person wearing blue nitrile gloves, who is carefully handling laboratory equipment. The process begins with the person using a pipette to transfer a...
2025-11-24 14:40:18,273 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:40:18,274 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0) (~222 words) with timeout=5.0s retries=3
2025-11-24 14:40:19,555 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:40:19,555 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:40:19,555 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1) (~247 words) with timeout=5.0s retries=3
2025-11-24 14:40:20,558 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:40:20,558 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:40:20,558 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2) (~225 words) with timeout=5.0s retries=3
2025-11-24 14:40:25,564 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 1/4), retrying...
2025-11-24 14:40:27,290 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 2)
2025-11-24 14:40:27,290 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:40:27,290 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3) (~228 words) with timeout=5.0s retries=3
2025-11-24 14:40:28,445 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:40:28,445 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:40:28,445 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4) (~184 words) with timeout=5.0s retries=3
2025-11-24 14:40:29,735 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:40:29,735 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:40:29,735 - src.components.pre_llm_injector - INFO - Extracted 21 local triplets from 5 chunks
2025-11-24 14:40:29,735 - src.pipeline.kg_builder - INFO - Pre-extraction: 21 triplets in 11.46s
2025-11-24 14:40:29,736 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 327
- Total Relationships: 338
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4"]}, {"head": "Liquid", "relation": "Is In", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "-56.301_G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1"]}, {"head": "Digital Balance", "relation": "Is Used By", "tail": "Person", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2"]}, {"head": "Person", "relation": "Uses", "tail": "Wash_Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2"]}, {"head": "Person", "relation": "Controls", "tail": "Liquid_Flow", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2"]}, {"head": "Glass_Pipette", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2"]}, {"head": "Digital_Balance", "relation": "Measures", "tail": "Mass_Of_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3"]}, {"head": "Pipette", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3"]}, {"head": "Beaker", "relation": "Is Placed On", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "Higher Mass Reading", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "630.1_G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:40:29,736 - src.components.global_refiner - DEBUG - Refining 21 triplets (prompt ~306 words, ~398 tokens)
2025-11-24 14:40:29,736 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:41:00,302 - src.components.global_refiner - DEBUG - LLM call completed in 30.57s
2025-11-24 14:41:00,302 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4']], ['Liquid', 'is_in', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0']], ['Beaker', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4']], ['Digital_Balance', 'displays', '-56.301_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4']], ['Person', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1']], ['Digital_Balance', 'is_used_by', 'Person', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1']], ['Lab_Bench', 'contains', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4']], ['Person', 'holds', 'Glass_Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2']], ['Person', 'uses', 'Wash_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2']], ['Person', 'controls', 'Liquid_Flow', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2']], ['Glass_Pipette', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2']], ['Digital_Balance', 'measures', 'Mass_Of_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3']], ['Pipette', 'dispenses', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3']], ['Beaker', 'is_placed_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3']], ['Digital_Balance', 'displays', 'Higher_Mass_Reading', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3']], ['Digital_Balance', 'displays', '630.1_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4']]]
2025-11-24 14:41:00,302 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4"
    ]
  ],
  [
    "Liquid",
    "is_in",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "-56.301_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1"
    ]
  ],
  [
    "Digital_Balance",
    "is_used_by",
    "Person",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Wash_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2"
    ]
  ],
  [
    "Person",
    "controls",
    "Liquid_Flow",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2"
    ]
  ],
  [
    "Glass_Pipette",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Mass_Of_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3"
    ]
  ],
  [
    "Pipette",
    "dispenses",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3"
    ]
  ],
  [
    "Beaker",
    "is_placed_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Higher_Mass_Reading",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_3"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "630.1_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_21_4"
    ]
  ]
]
2025-11-24 14:41:00,302 - src.components.global_refiner - INFO - Refinement complete: 21 → 21 triplets (total: 30.57s, LLM: 30.57s)
2025-11-24 14:41:00,302 - src.pipeline.kg_builder - INFO - Global refinement: 21 triplets in 30.57s
2025-11-24 14:41:00,302 - src.pipeline.kg_builder - INFO - Using 21 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:41:00,302 - src.pipeline.kg_builder - INFO - Pushing batch 22/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:41:00,302 - src.components.neo4j_handler - INFO - Adding 20 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:41:00,540 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:41:00,540 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:41:00,540 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:41:00,540 - src.components.neo4j_handler - INFO - Batch injected in 0.24s (triplets: 0.23s, indexes: 0.00s)
2025-11-24 14:41:00,540 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:41:00,583 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 335 nodes
2025-11-24 14:41:00,721 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 329 nodes
2025-11-24 14:41:00,879 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 335, 'relationship_count': 966, 'density': 0.0086, 'avg_degree': 5.7672, 'avg_unique_neighbors': 5.7134, 'global_efficiency': 0.3631, 'avg_path_length': 2.9449, 'avg_degree_centrality': 0.0173, 'max_degree_centrality': 0.494, 'avg_betweenness_centrality': 0.0009, 'max_betweenness_centrality': 0.0658, 'degree_assortativity': -0.1859, 'graph_robustness': 0.8395, 'diameter_estimate': 7, 'clustering_coefficient': 0.3158, 'weakly_connected_components': 7, 'largest_wcc_size': 329, 'pagerank_top10_percent': 10.5, 'louvain_communities': 19, 'louvain_modularity': 0.4786, 'label_entropy': 1.4451, 'computational_time': 0.33830995799507946}
2025-11-24 14:41:00,879 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 21, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966460.8794174, 'total_time': 42.61059352301527, 'aggregation': 2.7929781936109066e-06, 'network_info': 0.004249753023032099, 'llm_extraction': 42.02916481898865, 'data_cleaning': 1.5335041098296642e-05, 'neo4j_injection': 0.23841913096839562, 'embedding_time': 0, 'indexing_time': 0.0049335010116919875, 'graph_injection_time': 0.23334341298323125, 'acs_metrics': {'node_count': 335, 'relationship_count': 966, 'density': 0.0086, 'avg_degree': 5.7672, 'avg_unique_neighbors': 5.7134, 'global_efficiency': 0.3631, 'avg_path_length': 2.9449, 'avg_degree_centrality': 0.0173, 'max_degree_centrality': 0.494, 'avg_betweenness_centrality': 0.0009, 'max_betweenness_centrality': 0.0658, 'degree_assortativity': -0.1859, 'graph_robustness': 0.8395, 'diameter_estimate': 7, 'clustering_coefficient': 0.3158, 'weakly_connected_components': 7, 'largest_wcc_size': 329, 'pagerank_top10_percent': 10.5, 'louvain_communities': 19, 'louvain_modularity': 0.4786, 'label_entropy': 1.4451, 'computational_time': 0.33830995799507946}, 'retrieval_queries': []}
2025-11-24 14:41:00,879 - src.pipeline.kg_builder - DEBUG - Batch 21 metrics: {
  "batch_idx": 21,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966460.8794174,
  "total_time": 42.61059352301527,
  "aggregation": 2.7929781936109066e-06,
  "network_info": 0.004249753023032099,
  "llm_extraction": 42.02916481898865,
  "data_cleaning": 1.5335041098296642e-05,
  "neo4j_injection": 0.23841913096839562,
  "embedding_time": 0,
  "indexing_time": 0.0049335010116919875,
  "graph_injection_time": 0.23334341298323125,
  "acs_metrics": {
    "node_count": 335,
    "relationship_count": 966,
    "density": 0.0086,
    "avg_degree": 5.7672,
    "avg_unique_neighbors": 5.7134,
    "global_efficiency": 0.3631,
    "avg_path_length": 2.9449,
    "avg_degree_centrality": 0.0173,
    "max_degree_centrality": 0.494,
    "avg_betweenness_centrality": 0.0009,
    "max_betweenness_centrality": 0.0658,
    "degree_assortativity": -0.1859,
    "graph_robustness": 0.8395,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.3158,
    "weakly_connected_components": 7,
    "largest_wcc_size": 329,
    "pagerank_top10_percent": 10.5,
    "louvain_communities": 19,
    "louvain_modularity": 0.4786,
    "label_entropy": 1.4451,
    "computational_time": 0.33830995799507946
  },
  "retrieval_queries": []
}
2025-11-24 14:41:00,880 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:41:00,880 - src.pipeline.kg_builder - INFO - Batch 22 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 42.03s, Clean: 0.00s, Neo4j: 0.24s, ACS: 0.34s
2025-11-24 14:41:00,880 - src.pipeline.kg_builder - INFO - Batch 22 completed in 42.61s
Processing KG batches:  31%|███       | 22/72 [12:58<31:23, 37.68s/it]2025-11-24 14:41:00,880 - src.pipeline.kg_builder - INFO - Processing batch 23/72 (3 items)
2025-11-24 14:41:00,880 - src.pipeline.kg_builder - DEBUG - Batch 23 current_video_time: 05:39-05:44
2025-11-24 14:41:00,884 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 335
- Total Relationships: 346
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:41:00,885 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 14:41:00,885 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0 ~213 words, content: Time: 05:29-05:34 Content: The sequence of images captures a detailed laboratory procedure, likely a titration or a precise liquid transfer, performed by a person wearing...
2025-11-24 14:41:00,885 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1 ~220 words, content: A white bottle with a red cap, which appears to be a chemical reagent. The label is partially visible and shows hazard symbols, including a...
2025-11-24 14:41:00,885 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2 ~231 words, content: le gloves, performing a careful measurement. The person is using a pipette to transfer a liquid from a small, clear glass beaker into a larger,...
2025-11-24 14:41:00,885 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3 ~109 words, content: pipette in their left hand and a small, clear glass beaker in their right hand. They are carefully using the pipette to draw liquid from...
2025-11-24 14:41:00,885 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:41:00,885 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0) (~213 words) with timeout=5.0s retries=3
2025-11-24 14:41:02,233 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:41:02,233 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:41:02,233 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1) (~220 words) with timeout=5.0s retries=3
2025-11-24 14:41:03,344 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:41:03,344 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:41:03,344 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2) (~231 words) with timeout=5.0s retries=3
2025-11-24 14:41:04,373 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:41:04,373 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:41:04,373 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3) (~109 words) with timeout=5.0s retries=3
2025-11-24 14:41:05,726 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:41:05,726 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:41:05,726 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 4 chunks
2025-11-24 14:41:05,726 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 4.84s
2025-11-24 14:41:05,726 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 335
- Total Relationships: 346
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3"]}, {"head": "Person", "relation": "Holds", "tail": "Wash_Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Dark_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0"]}, {"head": "Digital_Analytical_Balance", "relation": "Displays", "tail": "6.301_G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1"]}, {"head": "Pipette", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1"]}, {"head": "Liquid", "relation": "Is Added To", "tail": "Sample", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1"]}, {"head": "Sample", "relation": "Is Placed On", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "-56.301_G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3"]}, {"head": "Digital_Balance", "relation": "Is Model", "tail": "Mettler_Toledo", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:41:05,726 - src.components.global_refiner - DEBUG - Refining 17 triplets (prompt ~268 words, ~348 tokens)
2025-11-24 14:41:05,726 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:41:35,084 - src.components.global_refiner - DEBUG - LLM call completed in 29.36s
2025-11-24 14:41:35,084 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3']], ['Person', 'holds', 'Wash_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3']], ['Pipette', 'dispenses', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1']], ['Beaker', 'contains', 'Dark_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2']], ['Beaker', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3']], ['Digital_Analytical_Balance', 'displays', '6.301_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0']], ['Digital_Balance', 'displays', '-56.301_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3']], ['Digital_Balance', 'measures', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2']], ['Digital_Balance', 'is_model', 'Mettler_Toledo', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3']], ['Sample', 'is_placed_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1']], ['Liquid', 'is_added_to', 'Sample', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1']], ['Digital_Analytical_Balance', 'is_model', 'Mettler_Toledo', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3']], ['Digital_Balance', 'is_model', 'Mettler_Toledo', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3']], ['Digital_Balance', 'displays', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2']]]
2025-11-24 14:41:35,084 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Wash_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3"
    ]
  ],
  [
    "Pipette",
    "dispenses",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Dark_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3"
    ]
  ],
  [
    "Digital_Analytical_Balance",
    "displays",
    "6.301_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "-56.301_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2"
    ]
  ],
  [
    "Digital_Balance",
    "is_model",
    "Mettler_Toledo",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3"
    ]
  ],
  [
    "Sample",
    "is_placed_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1"
    ]
  ],
  [
    "Liquid",
    "is_added_to",
    "Sample",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1"
    ]
  ],
  [
    "Digital_Analytical_Balance",
    "is_model",
    "Mettler_Toledo",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3"
    ]
  ],
  [
    "Digital_Balance",
    "is_model",
    "Mettler_Toledo",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_3"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_22_2"
    ]
  ]
]
2025-11-24 14:41:35,084 - src.components.global_refiner - INFO - Refinement complete: 17 → 19 triplets (total: 29.36s, LLM: 29.36s)
2025-11-24 14:41:35,084 - src.pipeline.kg_builder - INFO - Global refinement: 19 triplets in 29.36s
2025-11-24 14:41:35,084 - src.pipeline.kg_builder - INFO - Using 19 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:41:35,084 - src.pipeline.kg_builder - INFO - Pushing batch 23/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:41:35,084 - src.components.neo4j_handler - INFO - Adding 18 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:41:35,313 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:41:35,313 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:41:35,313 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:41:35,313 - src.components.neo4j_handler - INFO - Batch injected in 0.23s (triplets: 0.23s, indexes: 0.00s)
2025-11-24 14:41:35,313 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:41:35,356 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 343 nodes
2025-11-24 14:41:35,501 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 337 nodes
2025-11-24 14:41:35,664 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 343, 'relationship_count': 1003, 'density': 0.0086, 'avg_degree': 5.8484, 'avg_unique_neighbors': 5.7959, 'global_efficiency': 0.3642, 'avg_path_length': 2.936, 'avg_degree_centrality': 0.0171, 'max_degree_centrality': 0.4942, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0572, 'degree_assortativity': -0.1777, 'graph_robustness': 0.8435, 'diameter_estimate': 7, 'clustering_coefficient': 0.317, 'weakly_connected_components': 7, 'largest_wcc_size': 337, 'pagerank_top10_percent': 10.27, 'louvain_communities': 19, 'louvain_modularity': 0.4736, 'label_entropy': 1.4477, 'computational_time': 0.35120488598477095}
2025-11-24 14:41:35,664 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 22, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966495.6648185, 'total_time': 34.78457353496924, 'aggregation': 2.9559596441686153e-06, 'network_info': 0.0043539240141399205, 'llm_extraction': 34.19978254602756, 'data_cleaning': 1.3744982425123453e-05, 'neo4j_injection': 0.22882075898814946, 'embedding_time': 0, 'indexing_time': 0.0036081609432585537, 'graph_injection_time': 0.22506914800032973, 'acs_metrics': {'node_count': 343, 'relationship_count': 1003, 'density': 0.0086, 'avg_degree': 5.8484, 'avg_unique_neighbors': 5.7959, 'global_efficiency': 0.3642, 'avg_path_length': 2.936, 'avg_degree_centrality': 0.0171, 'max_degree_centrality': 0.4942, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0572, 'degree_assortativity': -0.1777, 'graph_robustness': 0.8435, 'diameter_estimate': 7, 'clustering_coefficient': 0.317, 'weakly_connected_components': 7, 'largest_wcc_size': 337, 'pagerank_top10_percent': 10.27, 'louvain_communities': 19, 'louvain_modularity': 0.4736, 'label_entropy': 1.4477, 'computational_time': 0.35120488598477095}, 'retrieval_queries': []}
2025-11-24 14:41:35,664 - src.pipeline.kg_builder - DEBUG - Batch 22 metrics: {
  "batch_idx": 22,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966495.6648185,
  "total_time": 34.78457353496924,
  "aggregation": 2.9559596441686153e-06,
  "network_info": 0.0043539240141399205,
  "llm_extraction": 34.19978254602756,
  "data_cleaning": 1.3744982425123453e-05,
  "neo4j_injection": 0.22882075898814946,
  "embedding_time": 0,
  "indexing_time": 0.0036081609432585537,
  "graph_injection_time": 0.22506914800032973,
  "acs_metrics": {
    "node_count": 343,
    "relationship_count": 1003,
    "density": 0.0086,
    "avg_degree": 5.8484,
    "avg_unique_neighbors": 5.7959,
    "global_efficiency": 0.3642,
    "avg_path_length": 2.936,
    "avg_degree_centrality": 0.0171,
    "max_degree_centrality": 0.4942,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.0572,
    "degree_assortativity": -0.1777,
    "graph_robustness": 0.8435,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.317,
    "weakly_connected_components": 7,
    "largest_wcc_size": 337,
    "pagerank_top10_percent": 10.27,
    "louvain_communities": 19,
    "louvain_modularity": 0.4736,
    "label_entropy": 1.4477,
    "computational_time": 0.35120488598477095
  },
  "retrieval_queries": []
}
2025-11-24 14:41:35,665 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:41:35,665 - src.pipeline.kg_builder - INFO - Batch 23 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 34.20s, Clean: 0.00s, Neo4j: 0.23s, ACS: 0.35s
2025-11-24 14:41:35,665 - src.pipeline.kg_builder - INFO - Batch 23 completed in 34.78s
Processing KG batches:  32%|███▏      | 23/72 [13:33<30:03, 36.81s/it]2025-11-24 14:41:35,665 - src.pipeline.kg_builder - INFO - Processing batch 24/72 (3 items)
2025-11-24 14:41:35,665 - src.pipeline.kg_builder - DEBUG - Batch 24 current_video_time: 05:54-05:59
2025-11-24 14:41:35,670 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 343
- Total Relationships: 352
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:41:35,670 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:41:35,671 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0 ~213 words, content: Time: 05:44-05:49 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a precise weighing process, from a first-person perspective. The setting...
2025-11-24 14:41:35,671 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1 ~233 words, content: of the pipette and the beaker. The person's left hand, with the watch, is visible, and they are carefully controlling the flow of the liquid....
2025-11-24 14:41:35,671 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2 ~219 words, content: added. Time: 05:49-05:54 Content: The video sequence captures a detailed laboratory procedure, likely the preparation of a solution, from a first-person perspective. The scene is...
2025-11-24 14:41:35,671 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3 ~227 words, content: In summary, the video shows a person using a balance to accurately measure a liquid by adding it to a volumetric flask, a common technique...
2025-11-24 14:41:35,671 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4 ~82 words, content: a window, and a cardboard box with a "小心易燃" (Caution: Flammable) warning sign. A printed document with Chinese text, likely a lab protocol, is also...
2025-11-24 14:41:35,671 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:41:35,671 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0) (~213 words) with timeout=5.0s retries=3
2025-11-24 14:41:36,788 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:41:36,788 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:41:36,788 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1) (~233 words) with timeout=5.0s retries=3
2025-11-24 14:41:37,702 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:41:37,702 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:41:37,702 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2) (~219 words) with timeout=5.0s retries=3
2025-11-24 14:41:38,944 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:41:38,944 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:41:38,944 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3) (~227 words) with timeout=5.0s retries=3
2025-11-24 14:41:40,144 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:41:40,144 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:41:40,145 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4) (~82 words) with timeout=5.0s retries=3
2025-11-24 14:41:41,245 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:41:41,246 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:41:41,246 - src.components.pre_llm_injector - INFO - Extracted 25 local triplets from 5 chunks
2025-11-24 14:41:41,246 - src.pipeline.kg_builder - INFO - Pre-extraction: 25 triplets in 5.58s
2025-11-24 14:41:41,246 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 343
- Total Relationships: 352
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1"]}, {"head": "Pipette", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0"]}, {"head": "Person", "relation": "Uses", "tail": "Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2"]}, {"head": "Person", "relation": "Holds", "tail": "Wash_Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2"]}, {"head": "Balance", "relation": "Displays", "tail": "Positive_Value", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3"]}, {"head": "Pipette", "relation": "Adds", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3"]}, {"head": "Volumetric Flask", "relation": "Is On", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass Of Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3"]}, {"head": "Table", "relation": "Contains", "tail": "Window", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4"]}, {"head": "Table", "relation": "Contains", "tail": "Cardboard Box", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4"]}, {"head": "Cardboard Box", "relation": "Has Label", "tail": "Caution Flammable", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4"]}, {"head": "Table", "relation": "Contains", "tail": "Document", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4"]}, {"head": "Document", "relation": "Has Text", "tail": "Chinese Text", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4"]}, {"head": "Table", "relation": "Contains", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:41:41,246 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~337 words, ~438 tokens)
2025-11-24 14:41:41,246 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:42:16,497 - src.components.global_refiner - DEBUG - LLM call completed in 35.25s
2025-11-24 14:42:16,497 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3']], ['Person', 'wears', 'Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1']], ['Person', 'holds', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3']], ['Person', 'holds', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3']], ['Person', 'holds', 'Wash_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3']], ['Person', 'uses', 'Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1']], ['Pipette', 'dispenses', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1']], ['Pipette', 'adds', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3']], ['Beaker', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1']], ['Volumetric_Flask', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3']], ['Volumetric_Flask', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3']], ['Digital_Balance', 'measures', 'Mass_Of_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3']], ['Digital_Balance', 'displays', 'Positive_Value', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2']], ['Table', 'contains', 'Window', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4']], ['Table', 'contains', 'Cardboard_Box', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4']], ['Cardboard_Box', 'has_label', 'Caution_Flammable', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4']], ['Table', 'contains', 'Document', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4']], ['Document', 'has_text', 'Chinese_Text', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4']], ['Table', 'contains', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4']]]
2025-11-24 14:42:16,497 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Wash_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1"
    ]
  ],
  [
    "Pipette",
    "dispenses",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1"
    ]
  ],
  [
    "Pipette",
    "adds",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_1"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3"
    ]
  ],
  [
    "Volumetric_Flask",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Mass_Of_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_3"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Positive_Value",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_2"
    ]
  ],
  [
    "Table",
    "contains",
    "Window",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4"
    ]
  ],
  [
    "Table",
    "contains",
    "Cardboard_Box",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4"
    ]
  ],
  [
    "Cardboard_Box",
    "has_label",
    "Caution_Flammable",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4"
    ]
  ],
  [
    "Table",
    "contains",
    "Document",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4"
    ]
  ],
  [
    "Document",
    "has_text",
    "Chinese_Text",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4"
    ]
  ],
  [
    "Table",
    "contains",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_23_4"
    ]
  ]
]
2025-11-24 14:42:16,497 - src.components.global_refiner - INFO - Refinement complete: 25 → 24 triplets (total: 35.25s, LLM: 35.25s)
2025-11-24 14:42:16,497 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 35.25s
2025-11-24 14:42:16,497 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:42:16,497 - src.pipeline.kg_builder - INFO - Pushing batch 24/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:42:16,497 - src.components.neo4j_handler - INFO - Adding 23 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:42:16,710 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:42:16,710 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:42:16,710 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:42:16,710 - src.components.neo4j_handler - INFO - Batch injected in 0.21s (triplets: 0.21s, indexes: 0.00s)
2025-11-24 14:42:16,710 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:42:16,772 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 351 nodes
2025-11-24 14:42:16,923 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 345 nodes
2025-11-24 14:42:17,097 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 351, 'relationship_count': 1045, 'density': 0.0085, 'avg_degree': 5.9544, 'avg_unique_neighbors': 5.9031, 'global_efficiency': 0.3649, 'avg_path_length': 2.9325, 'avg_degree_centrality': 0.017, 'max_degree_centrality': 0.4971, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0523, 'degree_assortativity': -0.1707, 'graph_robustness': 0.8392, 'diameter_estimate': 7, 'clustering_coefficient': 0.3156, 'weakly_connected_components': 7, 'largest_wcc_size': 345, 'pagerank_top10_percent': 10.06, 'louvain_communities': 19, 'louvain_modularity': 0.467, 'label_entropy': 1.4517, 'computational_time': 0.38645701203495264}
2025-11-24 14:42:17,097 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 23, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966537.0973697, 'total_time': 41.431749026000034, 'aggregation': 3.5139964893460274e-06, 'network_info': 0.004786611010786146, 'llm_extraction': 40.826947103021666, 'data_cleaning': 1.703400630503893e-05, 'neo4j_injection': 0.2131658050348051, 'embedding_time': 0, 'indexing_time': 0.003059135051444173, 'graph_injection_time': 0.20995123300235718, 'acs_metrics': {'node_count': 351, 'relationship_count': 1045, 'density': 0.0085, 'avg_degree': 5.9544, 'avg_unique_neighbors': 5.9031, 'global_efficiency': 0.3649, 'avg_path_length': 2.9325, 'avg_degree_centrality': 0.017, 'max_degree_centrality': 0.4971, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0523, 'degree_assortativity': -0.1707, 'graph_robustness': 0.8392, 'diameter_estimate': 7, 'clustering_coefficient': 0.3156, 'weakly_connected_components': 7, 'largest_wcc_size': 345, 'pagerank_top10_percent': 10.06, 'louvain_communities': 19, 'louvain_modularity': 0.467, 'label_entropy': 1.4517, 'computational_time': 0.38645701203495264}, 'retrieval_queries': []}
2025-11-24 14:42:17,097 - src.pipeline.kg_builder - DEBUG - Batch 23 metrics: {
  "batch_idx": 23,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966537.0973697,
  "total_time": 41.431749026000034,
  "aggregation": 3.5139964893460274e-06,
  "network_info": 0.004786611010786146,
  "llm_extraction": 40.826947103021666,
  "data_cleaning": 1.703400630503893e-05,
  "neo4j_injection": 0.2131658050348051,
  "embedding_time": 0,
  "indexing_time": 0.003059135051444173,
  "graph_injection_time": 0.20995123300235718,
  "acs_metrics": {
    "node_count": 351,
    "relationship_count": 1045,
    "density": 0.0085,
    "avg_degree": 5.9544,
    "avg_unique_neighbors": 5.9031,
    "global_efficiency": 0.3649,
    "avg_path_length": 2.9325,
    "avg_degree_centrality": 0.017,
    "max_degree_centrality": 0.4971,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0523,
    "degree_assortativity": -0.1707,
    "graph_robustness": 0.8392,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.3156,
    "weakly_connected_components": 7,
    "largest_wcc_size": 345,
    "pagerank_top10_percent": 10.06,
    "louvain_communities": 19,
    "louvain_modularity": 0.467,
    "label_entropy": 1.4517,
    "computational_time": 0.38645701203495264
  },
  "retrieval_queries": []
}
2025-11-24 14:42:17,098 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:42:17,098 - src.pipeline.kg_builder - INFO - Batch 24 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 40.83s, Clean: 0.00s, Neo4j: 0.21s, ACS: 0.39s
2025-11-24 14:42:17,098 - src.pipeline.kg_builder - INFO - Batch 24 completed in 41.43s
Processing KG batches:  33%|███▎      | 24/72 [14:14<30:33, 38.20s/it]2025-11-24 14:42:17,098 - src.pipeline.kg_builder - INFO - Processing batch 25/72 (3 items)
2025-11-24 14:42:17,098 - src.pipeline.kg_builder - DEBUG - Batch 25 current_video_time: 06:09-06:14
2025-11-24 14:42:17,107 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 351
- Total Relationships: 361
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:42:17,108 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:42:17,108 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0 ~224 words, content: Time: 05:59-06:04 Content: The video sequence captures a first-person perspective of a laboratory procedure, likely a titration or solution preparation, taking place on a black...
2025-11-24 14:42:17,108 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1 ~229 words, content: - **Other Objects:** A white bottle with a red cap, likely containing a chemical reagent, sits on the bench. A printed document with Chinese text,...
2025-11-24 14:42:17,108 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_2 ~226 words, content: On the table, there is a white bottle with a red cap, a box of aluminum foil, a pen, and a document with handwritten notes....
2025-11-24 14:42:17,108 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3 ~234 words, content: overall atmosphere suggests a methodical and careful approach to the experiment. In summary, the video depicts a detailed and precise laboratory procedure, likely involving the...
2025-11-24 14:42:17,108 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4 ~28 words, content: liquid level in the volumetric flask is accurate. The camera remains relatively stable, focusing on the hand and the flask, with slight movements that follow...
2025-11-24 14:42:17,108 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:42:17,108 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0) (~224 words) with timeout=5.0s retries=3
2025-11-24 14:42:18,426 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:42:18,427 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:42:18,427 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1) (~229 words) with timeout=5.0s retries=3
2025-11-24 14:42:19,597 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:42:19,597 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:42:19,597 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_2) (~226 words) with timeout=5.0s retries=3
2025-11-24 14:42:24,603 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 1/4), retrying...
2025-11-24 14:42:30,110 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 2/4), retrying...
2025-11-24 14:42:36,118 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 3/4), retrying...
2025-11-24 14:42:42,626 - src.components.pre_llm_injector - WARNING - ⚠️ Chunk 2 TIMED OUT after 5.0s on final attempt. Skipping.
2025-11-24 14:42:42,626 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 0 triplets
2025-11-24 14:42:42,626 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3) (~234 words) with timeout=5.0s retries=3
2025-11-24 14:42:43,973 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:42:43,973 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:42:43,974 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4) (~28 words) with timeout=5.0s retries=3
2025-11-24 14:42:45,014 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:42:45,014 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:42:45,014 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 5 chunks
2025-11-24 14:42:45,014 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 27.91s
2025-11-24 14:42:45,014 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 351
- Total Relationships: 361
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0"]}, {"head": "Person", "relation": "Wears", "tail": "Gold_Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3"]}, {"head": "Person", "relation": "Uses", "tail": "Squeeze_Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3"]}, {"head": "Digital_Balance", "relation": "Measures", "tail": "Mass_Of_Contents", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0"]}, {"head": "Person", "relation": "Holds", "tail": "Squeeze Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1"]}, {"head": "Squeeze Bottle", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1"]}, {"head": "Liquid", "relation": "Enters", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1"]}, {"head": "Volumetric Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "White Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3"]}, {"head": "Watch", "relation": "Has", "tail": "Black_Leather_Strap", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Volumetric_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3"]}, {"head": "Liquid Level", "relation": "Is", "tail": "Accurate", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4"]}, {"head": "Camera", "relation": "Focuses On", "tail": "Hand", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4"]}, {"head": "Camera", "relation": "Focuses On", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4"]}, {"head": "Camera", "relation": "Remains Stable", "tail": "Relative Position", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4"]}, {"head": "Hand", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4"]}, {"head": "Person", "relation": "Performs", "tail": "Action", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:42:45,014 - src.components.global_refiner - DEBUG - Refining 22 triplets (prompt ~307 words, ~399 tokens)
2025-11-24 14:42:45,014 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:43:09,895 - src.components.global_refiner - DEBUG - LLM call completed in 24.88s
2025-11-24 14:43:09,895 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0']], ['Person', 'wears', 'Gold_Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0']], ['Person', 'holds', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1']], ['Person', 'uses', 'Squeeze_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0']], ['Volumetric_Flask', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3']], ['Digital_Balance', 'measures', 'Mass_Of_Contents', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0']], ['Person', 'holds', 'Squeeze_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1']], ['Squeeze_Bottle', 'dispenses', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1']], ['Liquid', 'enters', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1']], ['Volumetric_Flask', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1']], ['Lab_Bench', 'contains', 'White_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1']], ['Person', 'wears', 'Blue_Nitrile_Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3']], ['Person', 'wears', 'Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3']], ['Watch', 'has', 'Black_Leather_Strap', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3']], ['Lab_Bench', 'contains', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3']], ['Liquid_Level', 'is', 'Accurate', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4']], ['Camera', 'focuses_on', 'Hand', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4']], ['Camera', 'focuses_on', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4']], ['Camera', 'remains_stable', 'Relative_Position', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4']], ['Hand', 'holds', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4']], ['Person', 'performs', 'Action', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4']]]
2025-11-24 14:43:09,895 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Gold_Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Squeeze_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Mass_Of_Contents",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Squeeze_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1"
    ]
  ],
  [
    "Squeeze_Bottle",
    "dispenses",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1"
    ]
  ],
  [
    "Liquid",
    "enters",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "White_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3"
    ]
  ],
  [
    "Watch",
    "has",
    "Black_Leather_Strap",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_3"
    ]
  ],
  [
    "Liquid_Level",
    "is",
    "Accurate",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4"
    ]
  ],
  [
    "Camera",
    "focuses_on",
    "Hand",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4"
    ]
  ],
  [
    "Camera",
    "focuses_on",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4"
    ]
  ],
  [
    "Camera",
    "remains_stable",
    "Relative_Position",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4"
    ]
  ],
  [
    "Hand",
    "holds",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4"
    ]
  ],
  [
    "Person",
    "performs",
    "Action",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_24_4"
    ]
  ]
]
2025-11-24 14:43:09,895 - src.components.global_refiner - INFO - Refinement complete: 22 → 21 triplets (total: 24.88s, LLM: 24.88s)
2025-11-24 14:43:09,895 - src.pipeline.kg_builder - INFO - Global refinement: 21 triplets in 24.88s
2025-11-24 14:43:09,895 - src.pipeline.kg_builder - INFO - Using 21 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:43:09,896 - src.pipeline.kg_builder - INFO - Pushing batch 25/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:43:09,896 - src.components.neo4j_handler - INFO - Adding 21 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:43:10,128 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:43:10,128 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:43:10,128 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:43:10,129 - src.components.neo4j_handler - INFO - Batch injected in 0.23s (triplets: 0.23s, indexes: 0.00s)
2025-11-24 14:43:10,129 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:43:10,196 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 364 nodes
2025-11-24 14:43:10,359 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 357 nodes
2025-11-24 14:43:10,545 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 364, 'relationship_count': 1086, 'density': 0.0082, 'avg_degree': 5.967, 'avg_unique_neighbors': 5.9176, 'global_efficiency': 0.3628, 'avg_path_length': 2.9323, 'avg_degree_centrality': 0.0164, 'max_degree_centrality': 0.4959, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0621, 'degree_assortativity': -0.1706, 'graph_robustness': 0.8379, 'diameter_estimate': 7, 'clustering_coefficient': 0.3153, 'weakly_connected_components': 8, 'largest_wcc_size': 357, 'pagerank_top10_percent': 9.61, 'louvain_communities': 21, 'louvain_modularity': 0.4652, 'label_entropy': 1.453, 'computational_time': 0.4160603720229119}
2025-11-24 14:43:10,545 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 24, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966590.5453136, 'total_time': 53.447132724977564, 'aggregation': 2.995016984641552e-06, 'network_info': 0.009515064011793584, 'llm_extraction': 52.78812275198288, 'data_cleaning': 1.5340978279709816e-05, 'neo4j_injection': 0.23305402102414519, 'embedding_time': 0, 'indexing_time': 0.0028138909838162363, 'graph_injection_time': 0.23008627397939563, 'acs_metrics': {'node_count': 364, 'relationship_count': 1086, 'density': 0.0082, 'avg_degree': 5.967, 'avg_unique_neighbors': 5.9176, 'global_efficiency': 0.3628, 'avg_path_length': 2.9323, 'avg_degree_centrality': 0.0164, 'max_degree_centrality': 0.4959, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0621, 'degree_assortativity': -0.1706, 'graph_robustness': 0.8379, 'diameter_estimate': 7, 'clustering_coefficient': 0.3153, 'weakly_connected_components': 8, 'largest_wcc_size': 357, 'pagerank_top10_percent': 9.61, 'louvain_communities': 21, 'louvain_modularity': 0.4652, 'label_entropy': 1.453, 'computational_time': 0.4160603720229119}, 'retrieval_queries': []}
2025-11-24 14:43:10,545 - src.pipeline.kg_builder - DEBUG - Batch 24 metrics: {
  "batch_idx": 24,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966590.5453136,
  "total_time": 53.447132724977564,
  "aggregation": 2.995016984641552e-06,
  "network_info": 0.009515064011793584,
  "llm_extraction": 52.78812275198288,
  "data_cleaning": 1.5340978279709816e-05,
  "neo4j_injection": 0.23305402102414519,
  "embedding_time": 0,
  "indexing_time": 0.0028138909838162363,
  "graph_injection_time": 0.23008627397939563,
  "acs_metrics": {
    "node_count": 364,
    "relationship_count": 1086,
    "density": 0.0082,
    "avg_degree": 5.967,
    "avg_unique_neighbors": 5.9176,
    "global_efficiency": 0.3628,
    "avg_path_length": 2.9323,
    "avg_degree_centrality": 0.0164,
    "max_degree_centrality": 0.4959,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.0621,
    "degree_assortativity": -0.1706,
    "graph_robustness": 0.8379,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.3153,
    "weakly_connected_components": 8,
    "largest_wcc_size": 357,
    "pagerank_top10_percent": 9.61,
    "louvain_communities": 21,
    "louvain_modularity": 0.4652,
    "label_entropy": 1.453,
    "computational_time": 0.4160603720229119
  },
  "retrieval_queries": []
}
2025-11-24 14:43:10,545 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:43:10,546 - src.pipeline.kg_builder - INFO - Batch 25 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 52.79s, Clean: 0.00s, Neo4j: 0.23s, ACS: 0.42s
2025-11-24 14:43:10,546 - src.pipeline.kg_builder - INFO - Batch 25 completed in 53.45s
Processing KG batches:  35%|███▍      | 25/72 [15:08<33:30, 42.77s/it]2025-11-24 14:43:10,546 - src.pipeline.kg_builder - INFO - Processing batch 26/72 (3 items)
2025-11-24 14:43:10,546 - src.pipeline.kg_builder - DEBUG - Batch 26 current_video_time: 06:24-06:29
2025-11-24 14:43:10,554 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 364
- Total Relationships: 375
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:43:10,554 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-24 14:43:10,554 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0 ~202 words, content: Time: 06:14-06:19 Content: The video captures a close-up, first-person perspective of a laboratory procedure, likely the preparation of a solution. The scene is set in...
2025-11-24 14:43:10,554 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1 ~209 words, content: reaction is complete. - **Balance:** A digital analytical balance is visible in the background, which is used for precise weighing of chemicals. - **Chemical Containers:**...
2025-11-24 14:43:10,554 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2 ~242 words, content: laboratory setting. The frames show a person, wearing a blue nitrile glove, handling laboratory equipment with precision. - **In the first four frames**, the focus...
2025-11-24 14:43:10,554 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3 ~238 words, content: flask, likely as part of a chemical experiment. The sequence transitions from a close-up of the precise action to a wider shot of the laboratory,...
2025-11-24 14:43:10,554 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_4 ~249 words, content: background includes a cabinet with various items, and the overall environment remains consistent with a laboratory setting. - In the third frame, the camera angle...
2025-11-24 14:43:10,554 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_5 ~214 words, content: - In the final frame, the camera angle changes to show a different part of the laboratory. The balance scale is still visible, but now...
2025-11-24 14:43:10,554 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:43:10,555 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0) (~202 words) with timeout=5.0s retries=3
2025-11-24 14:43:11,979 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:43:11,980 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:43:11,980 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1) (~209 words) with timeout=5.0s retries=3
2025-11-24 14:43:13,448 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:43:13,448 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:43:13,448 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2) (~242 words) with timeout=5.0s retries=3
2025-11-24 14:43:14,806 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:43:14,806 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:43:14,806 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3) (~238 words) with timeout=5.0s retries=3
2025-11-24 14:43:15,890 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:43:15,890 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:43:15,890 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_4) (~249 words) with timeout=5.0s retries=3
2025-11-24 14:43:16,953 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:43:16,954 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:43:16,954 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_5) (~214 words) with timeout=5.0s retries=3
2025-11-24 14:43:18,040 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-24 14:43:18,040 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-24 14:43:18,041 - src.components.pre_llm_injector - INFO - Extracted 29 local triplets from 6 chunks
2025-11-24 14:43:18,041 - src.pipeline.kg_builder - INFO - Pre-extraction: 29 triplets in 7.49s
2025-11-24 14:43:18,041 - src.components.global_refiner - INFO - Capping refinement input: 29 → 25 triplets
2025-11-24 14:43:18,041 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 364
- Total Relationships: 375
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2"]}, {"head": "Burette", "relation": "Dispenses", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0"]}, {"head": "Burette", "relation": "Is Above", "tail": "Volumetric_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1"]}, {"head": "Digital Analytical Balance", "relation": "Is Used For", "tail": "Precise Weighing", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1"]}, {"head": "White Bottle", "relation": "Has Label", "tail": "Corrosive Hazard Symbol", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1"]}, {"head": "Volumetric Flask", "relation": "Receives", "tail": "Liquid From Burette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Pen", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1"]}, {"head": "Person", "relation": "Uses", "tail": "Laboratory_Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2"]}, {"head": "Laboratory_Bench", "relation": "Contains", "tail": "Digital_Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2"]}, {"head": "Lab_Environment", "relation": "Contains", "tail": "Magnetic_Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2"]}, {"head": "Flask", "relation": "Is Part Of", "tail": "Chemical_Experiment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3"]}, {"head": "Balance_Scale", "relation": "Measures", "tail": "Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_5"]}, {"head": "Person", "relation": "Handles", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3"]}, {"head": "Lab_Environment", "relation": "Contains", "tail": "Balance_Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3"]}, {"head": "Lab_Environment", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "Cabinet", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_4"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_4"]}, {"head": "Person", "relation": "Handles", "tail": "Glassware", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_4", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_5"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_4", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_5"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:43:18,041 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~343 words, ~446 tokens)
2025-11-24 14:43:18,041 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:43:51,247 - src.components.global_refiner - DEBUG - LLM call completed in 33.21s
2025-11-24 14:43:51,247 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2']], ['Person', 'wears', 'Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0']], ['Person', 'wears', 'Blue_Nitrile_Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1']], ['Person', 'wears', 'Blue_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_5']], ['Person', 'wears', 'Blue_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_4']], ['Person', 'holds', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2']], ['Person', 'uses', 'Laboratory_Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2']], ['Person', 'handles', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3']], ['Person', 'handles', 'Glassware', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_4', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_5']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_4', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_5']], ['Volumetric_Flask', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2']], ['Volumetric_Flask', 'receives', 'Liquid_From_Burette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1']], ['Burette', 'dispenses', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0']], ['Burette', 'is_above', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0']], ['Digital_Analytical_Balance', 'is_used_for', 'Precise_Weighing', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1']], ['White_Bottle', 'has_label', 'Corrosive_Hazard_Symbol', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1']], ['Lab_Table', 'contains', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1']], ['Lab_Table', 'contains', 'Pen', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1']], ['Laboratory_Bench', 'contains', 'Digital_Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2']], ['Lab_Environment', 'contains', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2']], ['Flask', 'is_part_of', 'Chemical_Experiment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3']], ['Balance_Scale', 'measures', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3']], ['Lab_Environment', 'contains', 'Balance_Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3']], ['Lab_Environment', 'contains', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3']], ['Lab_Environment', 'contains', 'Cabinet', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_4']]]
2025-11-24 14:43:51,247 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_5"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_4"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Laboratory_Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2"
    ]
  ],
  [
    "Person",
    "handles",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3"
    ]
  ],
  [
    "Person",
    "handles",
    "Glassware",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_4",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_5"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_4",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_5"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2"
    ]
  ],
  [
    "Volumetric_Flask",
    "receives",
    "Liquid_From_Burette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1"
    ]
  ],
  [
    "Burette",
    "dispenses",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0"
    ]
  ],
  [
    "Burette",
    "is_above",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_0"
    ]
  ],
  [
    "Digital_Analytical_Balance",
    "is_used_for",
    "Precise_Weighing",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1"
    ]
  ],
  [
    "White_Bottle",
    "has_label",
    "Corrosive_Hazard_Symbol",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1"
    ]
  ],
  [
    "Lab_Table",
    "contains",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1"
    ]
  ],
  [
    "Lab_Table",
    "contains",
    "Pen",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_1"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Digital_Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2"
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_2"
    ]
  ],
  [
    "Flask",
    "is_part_of",
    "Chemical_Experiment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3"
    ]
  ],
  [
    "Balance_Scale",
    "measures",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3"
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "Balance_Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3"
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_3"
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "Cabinet",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_25_4"
    ]
  ]
]
2025-11-24 14:43:51,247 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 33.21s, LLM: 33.21s)
2025-11-24 14:43:51,247 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 33.21s
2025-11-24 14:43:51,247 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:43:51,247 - src.pipeline.kg_builder - INFO - Pushing batch 26/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:43:51,247 - src.components.neo4j_handler - INFO - Adding 23 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:43:51,478 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:43:51,478 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:43:51,478 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:43:51,478 - src.components.neo4j_handler - INFO - Batch injected in 0.23s (triplets: 0.23s, indexes: 0.00s)
2025-11-24 14:43:51,478 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:43:51,529 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 377 nodes
2025-11-24 14:43:51,702 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 370 nodes
2025-11-24 14:43:51,895 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 377, 'relationship_count': 1143, 'density': 0.0081, 'avg_degree': 6.0637, 'avg_unique_neighbors': 6.0159, 'global_efficiency': 0.3652, 'avg_path_length': 2.893, 'avg_degree_centrality': 0.0161, 'max_degree_centrality': 0.4973, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0491, 'degree_assortativity': -0.1737, 'graph_robustness': 0.8443, 'diameter_estimate': 6, 'clustering_coefficient': 0.312, 'weakly_connected_components': 8, 'largest_wcc_size': 370, 'pagerank_top10_percent': 9.26, 'louvain_communities': 21, 'louvain_modularity': 0.4616, 'label_entropy': 1.4555, 'computational_time': 0.4168708139914088}
2025-11-24 14:43:51,896 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 25, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966631.8960497, 'total_time': 41.34991704503773, 'aggregation': 2.7479836717247963e-06, 'network_info': 0.007848968962207437, 'llm_extraction': 40.6936377180391, 'data_cleaning': 1.9623024854809046e-05, 'neo4j_injection': 0.2311626219889149, 'embedding_time': 0, 'indexing_time': 0.004578437015879899, 'graph_injection_time': 0.22644364496227354, 'acs_metrics': {'node_count': 377, 'relationship_count': 1143, 'density': 0.0081, 'avg_degree': 6.0637, 'avg_unique_neighbors': 6.0159, 'global_efficiency': 0.3652, 'avg_path_length': 2.893, 'avg_degree_centrality': 0.0161, 'max_degree_centrality': 0.4973, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0491, 'degree_assortativity': -0.1737, 'graph_robustness': 0.8443, 'diameter_estimate': 6, 'clustering_coefficient': 0.312, 'weakly_connected_components': 8, 'largest_wcc_size': 370, 'pagerank_top10_percent': 9.26, 'louvain_communities': 21, 'louvain_modularity': 0.4616, 'label_entropy': 1.4555, 'computational_time': 0.4168708139914088}, 'retrieval_queries': []}
2025-11-24 14:43:51,896 - src.pipeline.kg_builder - DEBUG - Batch 25 metrics: {
  "batch_idx": 25,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966631.8960497,
  "total_time": 41.34991704503773,
  "aggregation": 2.7479836717247963e-06,
  "network_info": 0.007848968962207437,
  "llm_extraction": 40.6936377180391,
  "data_cleaning": 1.9623024854809046e-05,
  "neo4j_injection": 0.2311626219889149,
  "embedding_time": 0,
  "indexing_time": 0.004578437015879899,
  "graph_injection_time": 0.22644364496227354,
  "acs_metrics": {
    "node_count": 377,
    "relationship_count": 1143,
    "density": 0.0081,
    "avg_degree": 6.0637,
    "avg_unique_neighbors": 6.0159,
    "global_efficiency": 0.3652,
    "avg_path_length": 2.893,
    "avg_degree_centrality": 0.0161,
    "max_degree_centrality": 0.4973,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0491,
    "degree_assortativity": -0.1737,
    "graph_robustness": 0.8443,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.312,
    "weakly_connected_components": 8,
    "largest_wcc_size": 370,
    "pagerank_top10_percent": 9.26,
    "louvain_communities": 21,
    "louvain_modularity": 0.4616,
    "label_entropy": 1.4555,
    "computational_time": 0.4168708139914088
  },
  "retrieval_queries": []
}
2025-11-24 14:43:51,896 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:43:51,896 - src.pipeline.kg_builder - INFO - Batch 26 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 40.69s, Clean: 0.00s, Neo4j: 0.23s, ACS: 0.42s
2025-11-24 14:43:51,896 - src.pipeline.kg_builder - INFO - Batch 26 completed in 41.35s
Processing KG batches:  36%|███▌      | 26/72 [15:49<32:27, 42.35s/it]2025-11-24 14:43:51,896 - src.pipeline.kg_builder - INFO - Processing batch 27/72 (3 items)
2025-11-24 14:43:51,896 - src.pipeline.kg_builder - DEBUG - Batch 27 current_video_time: 06:39-06:44
2025-11-24 14:43:51,902 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 377
- Total Relationships: 392
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:43:51,902 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 14:43:51,902 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0 ~229 words, content: Time: 06:29-06:34 Content: The sequence of images captures a laboratory procedure, likely the preparation of a chemical solution. The scene is set on a black...
2025-11-24 14:43:51,902 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1 ~225 words, content: is being added to a container that is already on the balance. The overall context implies that a precise amount of a chemical is being...
2025-11-24 14:43:51,902 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2 ~224 words, content: , is positioned nearby, indicating that the solution is being weighed as part of the process. The person's left wrist, adorned with a watch, is...
2025-11-24 14:43:51,902 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3 ~145 words, content: This flask, which has a long neck and a flat bottom, is already partially filled with a clear liquid. The person is using the pipette...
2025-11-24 14:43:51,902 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:43:51,902 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0) (~229 words) with timeout=5.0s retries=3
2025-11-24 14:43:53,181 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:43:53,181 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:43:53,181 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1) (~225 words) with timeout=5.0s retries=3
2025-11-24 14:43:54,428 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:43:54,429 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:43:54,429 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2) (~224 words) with timeout=5.0s retries=3
2025-11-24 14:43:55,576 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:43:55,576 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:43:55,577 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3) (~145 words) with timeout=5.0s retries=3
2025-11-24 14:43:56,630 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:43:56,631 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:43:56,631 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 4 chunks
2025-11-24 14:43:56,631 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 4.73s
2025-11-24 14:43:56,631 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 377
- Total Relationships: 392
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Laboratory Balance", "relation": "Displays", "tail": "-56.301 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2"]}, {"head": "Person", "relation": "Adds", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Dark Opaque Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Stirring Rod", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1"]}, {"head": "Person", "relation": "Uses", "tail": "Glass Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1"]}, {"head": "Glass Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1"]}, {"head": "Glass Beaker", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "56.30", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Glass Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3"]}, {"head": "Volumetric Flask", "relation": "Receives", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3"]}, {"head": "Lab Table", "relation": "Holds", "tail": "Electronic Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3"]}, {"head": "Lab Table", "relation": "Holds", "tail": "Laboratory Report", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:43:56,631 - src.components.global_refiner - DEBUG - Refining 22 triplets (prompt ~316 words, ~411 tokens)
2025-11-24 14:43:56,631 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:44:22,696 - src.components.global_refiner - DEBUG - LLM call completed in 26.07s
2025-11-24 14:44:22,696 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Laboratory_Balance', 'displays', '-56.301_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2']], ['Person', 'adds', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0']], ['Beaker', 'contains', 'Dark_Opaque_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0']], ['Beaker', 'contains', 'Stirring_Rod', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0']], ['Person', 'holds', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1']], ['Person', 'uses', 'Glass_Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1']], ['Glass_Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1']], ['Glass_Beaker', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1']], ['Digital_Balance', 'displays', '56.30', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2']], ['Beaker', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2']], ['Beaker', 'contains', 'Glass_Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2']], ['Person', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2']], ['Liquid', 'is_transferred_to', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3']], ['Volumetric_Flask', 'receives', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3']], ['Lab_Table', 'holds', 'Electronic_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3']], ['Lab_Table', 'holds', 'Laboratory_Report', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3']]]
2025-11-24 14:44:22,697 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Laboratory_Balance",
    "displays",
    "-56.301_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2"
    ]
  ],
  [
    "Person",
    "adds",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Dark_Opaque_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Stirring_Rod",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Glass_Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1"
    ]
  ],
  [
    "Glass_Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1"
    ]
  ],
  [
    "Glass_Beaker",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "56.30",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Glass_Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2"
    ]
  ],
  [
    "Liquid",
    "is_transferred_to",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3"
    ]
  ],
  [
    "Volumetric_Flask",
    "receives",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3"
    ]
  ],
  [
    "Lab_Table",
    "holds",
    "Electronic_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3"
    ]
  ],
  [
    "Lab_Table",
    "holds",
    "Laboratory_Report",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_26_3"
    ]
  ]
]
2025-11-24 14:44:22,697 - src.components.global_refiner - INFO - Refinement complete: 22 → 22 triplets (total: 26.07s, LLM: 26.07s)
2025-11-24 14:44:22,697 - src.pipeline.kg_builder - INFO - Global refinement: 22 triplets in 26.07s
2025-11-24 14:44:22,697 - src.pipeline.kg_builder - INFO - Using 22 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:44:22,697 - src.pipeline.kg_builder - INFO - Pushing batch 27/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:44:22,697 - src.components.neo4j_handler - INFO - Adding 22 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:44:22,879 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:44:22,879 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:44:22,880 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:44:22,880 - src.components.neo4j_handler - INFO - Batch injected in 0.18s (triplets: 0.18s, indexes: 0.00s)
2025-11-24 14:44:22,880 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:44:22,953 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 386 nodes
2025-11-24 14:44:23,136 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 379 nodes
2025-11-24 14:44:23,340 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 386, 'relationship_count': 1182, 'density': 0.008, 'avg_degree': 6.1244, 'avg_unique_neighbors': 6.0777, 'global_efficiency': 0.366, 'avg_path_length': 2.8873, 'avg_degree_centrality': 0.0159, 'max_degree_centrality': 0.4961, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0345, 'degree_assortativity': -0.1661, 'graph_robustness': 0.8604, 'diameter_estimate': 6, 'clustering_coefficient': 0.3124, 'weakly_connected_components': 8, 'largest_wcc_size': 379, 'pagerank_top10_percent': 9.04, 'louvain_communities': 19, 'louvain_modularity': 0.4482, 'label_entropy': 1.457, 'computational_time': 0.4601140220183879}
2025-11-24 14:44:23,340 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 26, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966663.3405983, 'total_time': 31.443740549962968, 'aggregation': 2.3189932107925415e-06, 'network_info': 0.0051326590473763645, 'llm_extraction': 30.79497085598996, 'data_cleaning': 1.4725024811923504e-05, 'neo4j_injection': 0.18311003601411358, 'embedding_time': 0, 'indexing_time': 0.002812069025821984, 'graph_injection_time': 0.18014661298366264, 'acs_metrics': {'node_count': 386, 'relationship_count': 1182, 'density': 0.008, 'avg_degree': 6.1244, 'avg_unique_neighbors': 6.0777, 'global_efficiency': 0.366, 'avg_path_length': 2.8873, 'avg_degree_centrality': 0.0159, 'max_degree_centrality': 0.4961, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0345, 'degree_assortativity': -0.1661, 'graph_robustness': 0.8604, 'diameter_estimate': 6, 'clustering_coefficient': 0.3124, 'weakly_connected_components': 8, 'largest_wcc_size': 379, 'pagerank_top10_percent': 9.04, 'louvain_communities': 19, 'louvain_modularity': 0.4482, 'label_entropy': 1.457, 'computational_time': 0.4601140220183879}, 'retrieval_queries': []}
2025-11-24 14:44:23,340 - src.pipeline.kg_builder - DEBUG - Batch 26 metrics: {
  "batch_idx": 26,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966663.3405983,
  "total_time": 31.443740549962968,
  "aggregation": 2.3189932107925415e-06,
  "network_info": 0.0051326590473763645,
  "llm_extraction": 30.79497085598996,
  "data_cleaning": 1.4725024811923504e-05,
  "neo4j_injection": 0.18311003601411358,
  "embedding_time": 0,
  "indexing_time": 0.002812069025821984,
  "graph_injection_time": 0.18014661298366264,
  "acs_metrics": {
    "node_count": 386,
    "relationship_count": 1182,
    "density": 0.008,
    "avg_degree": 6.1244,
    "avg_unique_neighbors": 6.0777,
    "global_efficiency": 0.366,
    "avg_path_length": 2.8873,
    "avg_degree_centrality": 0.0159,
    "max_degree_centrality": 0.4961,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0345,
    "degree_assortativity": -0.1661,
    "graph_robustness": 0.8604,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.3124,
    "weakly_connected_components": 8,
    "largest_wcc_size": 379,
    "pagerank_top10_percent": 9.04,
    "louvain_communities": 19,
    "louvain_modularity": 0.4482,
    "label_entropy": 1.457,
    "computational_time": 0.4601140220183879
  },
  "retrieval_queries": []
}
2025-11-24 14:44:23,341 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:44:23,341 - src.pipeline.kg_builder - INFO - Batch 27 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 30.79s, Clean: 0.00s, Neo4j: 0.18s, ACS: 0.46s
2025-11-24 14:44:23,341 - src.pipeline.kg_builder - INFO - Batch 27 completed in 31.44s
Processing KG batches:  38%|███▊      | 27/72 [16:21<29:18, 39.08s/it]2025-11-24 14:44:23,341 - src.pipeline.kg_builder - INFO - Processing batch 28/72 (3 items)
2025-11-24 14:44:23,341 - src.pipeline.kg_builder - DEBUG - Batch 28 current_video_time: 06:54-06:59
2025-11-24 14:44:23,347 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 386
- Total Relationships: 399
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:44:23,348 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-24 14:44:23,348 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0 ~224 words, content: Time: 06:44-06:49 Content: The video captures a sequence of actions in a laboratory setting, focusing on the preparation of a chemical solution. The scene is...
2025-11-24 14:44:23,348 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1 ~227 words, content: the table, which appears to be a reagent vial, and hold it in their right hand. The Erlenmeyer flask, now containing the transferred liquid, remains...
2025-11-24 14:44:23,348 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2 ~243 words, content: , working at a large black lab bench. The digital balance is prominently featured in the foreground, with its display showing a negative reading, which...
2025-11-24 14:44:23,348 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3 ~233 words, content: adding a substance to the container, possibly to achieve a specific concentration or to prepare a solution. The surrounding lab environment remains unchanged, with various...
2025-11-24 14:44:23,348 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_4 ~241 words, content: Action Sequence:** The person carefully places the glass flask onto the balance. The digital display on the balance shows a reading of -56.302 g, which...
2025-11-24 14:44:23,348 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_5 ~28 words, content: laboratory setting, emphasizing the importance of precision and safety in scientific experiments. The person's actions are deliberate and careful, highlighting the attention to detail required...
2025-11-24 14:44:23,348 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:44:23,348 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0) (~224 words) with timeout=5.0s retries=3
2025-11-24 14:44:24,781 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:44:24,781 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:44:24,781 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1) (~227 words) with timeout=5.0s retries=3
2025-11-24 14:44:25,882 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:44:25,882 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:44:25,883 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2) (~243 words) with timeout=5.0s retries=3
2025-11-24 14:44:26,895 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:44:26,895 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:44:26,895 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3) (~233 words) with timeout=5.0s retries=3
2025-11-24 14:44:28,327 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:44:28,327 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:44:28,328 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_4) (~241 words) with timeout=5.0s retries=3
2025-11-24 14:44:29,468 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:44:29,468 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:44:29,469 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_5) (~28 words) with timeout=5.0s retries=3
2025-11-24 14:44:30,447 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-24 14:44:30,447 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-24 14:44:30,447 - src.components.pre_llm_injector - INFO - Extracted 33 local triplets from 6 chunks
2025-11-24 14:44:30,447 - src.pipeline.kg_builder - INFO - Pre-extraction: 33 triplets in 7.10s
2025-11-24 14:44:30,448 - src.components.global_refiner - INFO - Capping refinement input: 33 → 25 triplets
2025-11-24 14:44:30,448 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 386
- Total Relationships: 399
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3"]}, {"head": "Person", "relation": "Holds", "tail": "Erlenmeyer_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0"]}, {"head": "Erlenmeyer_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0"]}, {"head": "Person", "relation": "Holds", "tail": "Reagent_Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0"]}, {"head": "Person", "relation": "Holds", "tail": "Reagent Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1"]}, {"head": "Person", "relation": "Holds", "tail": "Erlenmeyer Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1"]}, {"head": "Erlenmeyer Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1"]}, {"head": "Person", "relation": "Handles", "tail": "Glass Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2"]}, {"head": "Glass Container", "relation": "Is Placed On", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "Negative Reading", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2"]}, {"head": "Glass Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2"]}, {"head": "Person", "relation": "Uses", "tail": "Digital_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3"]}, {"head": "Digital_Balance", "relation": "Is Part Of", "tail": "Laboratory_Setup", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3"]}, {"head": "Glass_Flask", "relation": "Is Placed On", "tail": "Digital_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3"]}, {"head": "Digital_Balance", "relation": "Measures", "tail": "Chemical_Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3"]}, {"head": "Person", "relation": "Places", "tail": "Glass Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_4"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_4"]}, {"head": "Balance", "relation": "Displays", "tail": "-56.302 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_4"]}, {"head": "Person", "relation": "Adds", "tail": "Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:44:30,448 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~340 words, ~442 tokens)
2025-11-24 14:44:30,448 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:45:00,447 - src.components.global_refiner - DEBUG - LLM call completed in 30.00s
2025-11-24 14:45:00,447 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3']], ['Person', 'holds', 'Erlenmeyer_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0']], ['Erlenmeyer_Flask', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2']], ['Pipette', 'transfers', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0']], ['Person', 'holds', 'Reagent_Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1']], ['Person', 'holds', 'Erlenmeyer_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1']], ['Erlenmeyer_Flask', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1']], ['Person', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1']], ['Lab_Bench', 'contains', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1']], ['Person', 'handles', 'Glass_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2']], ['Glass_Container', 'is_placed_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2']], ['Digital_Balance', 'displays', 'Negative_Reading', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2']], ['Glass_Container', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2']], ['Digital_Balance', 'measures', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2']], ['Person', 'uses', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3']], ['Digital_Balance', 'is_part_of', 'Laboratory_Setup', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3']], ['Person', 'holds', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3']], ['Glass_Flask', 'is_placed_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3']], ['Digital_Balance', 'measures', 'Chemical_Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3']], ['Person', 'places', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_4']], ['Glass_Flask', 'is_on', 'Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_4']], ['Balance', 'displays', '-56.302_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_4']], ['Person', 'adds', 'Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_4']]]
2025-11-24 14:45:00,447 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Erlenmeyer_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0"
    ]
  ],
  [
    "Erlenmeyer_Flask",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Reagent_Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Erlenmeyer_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1"
    ]
  ],
  [
    "Erlenmeyer_Flask",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_1"
    ]
  ],
  [
    "Person",
    "handles",
    "Glass_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2"
    ]
  ],
  [
    "Glass_Container",
    "is_placed_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Negative_Reading",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2"
    ]
  ],
  [
    "Glass_Container",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3"
    ]
  ],
  [
    "Digital_Balance",
    "is_part_of",
    "Laboratory_Setup",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3"
    ]
  ],
  [
    "Glass_Flask",
    "is_placed_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Chemical_Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_3"
    ]
  ],
  [
    "Person",
    "places",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_4"
    ]
  ],
  [
    "Glass_Flask",
    "is_on",
    "Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_4"
    ]
  ],
  [
    "Balance",
    "displays",
    "-56.302_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_4"
    ]
  ],
  [
    "Person",
    "adds",
    "Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_27_4"
    ]
  ]
]
2025-11-24 14:45:00,447 - src.components.global_refiner - INFO - Refinement complete: 25 → 24 triplets (total: 30.00s, LLM: 30.00s)
2025-11-24 14:45:00,447 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 30.00s
2025-11-24 14:45:00,447 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:45:00,447 - src.pipeline.kg_builder - INFO - Pushing batch 28/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:45:00,447 - src.components.neo4j_handler - INFO - Adding 23 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:45:00,660 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:45:00,660 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:45:00,660 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:45:00,660 - src.components.neo4j_handler - INFO - Batch injected in 0.21s (triplets: 0.21s, indexes: 0.00s)
2025-11-24 14:45:00,660 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:45:00,714 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 395 nodes
2025-11-24 14:45:00,912 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 387 nodes
2025-11-24 14:45:01,133 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 395, 'relationship_count': 1226, 'density': 0.0079, 'avg_degree': 6.2076, 'avg_unique_neighbors': 6.157, 'global_efficiency': 0.3668, 'avg_path_length': 2.8664, 'avg_degree_centrality': 0.0158, 'max_degree_centrality': 0.5076, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0585, 'degree_assortativity': -0.1686, 'graph_robustness': 0.8638, 'diameter_estimate': 6, 'clustering_coefficient': 0.3121, 'weakly_connected_components': 9, 'largest_wcc_size': 387, 'pagerank_top10_percent': 8.88, 'louvain_communities': 20, 'louvain_modularity': 0.4514, 'label_entropy': 1.4608, 'computational_time': 0.4725929700070992}
2025-11-24 14:45:01,133 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 27, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966701.1333792, 'total_time': 37.79192220600089, 'aggregation': 2.869986928999424e-06, 'network_info': 0.006376978999469429, 'llm_extraction': 37.09968605794711, 'data_cleaning': 1.552602043375373e-05, 'neo4j_injection': 0.21284421696327627, 'embedding_time': 0, 'indexing_time': 0.0024167910451069474, 'graph_injection_time': 0.2102736930246465, 'acs_metrics': {'node_count': 395, 'relationship_count': 1226, 'density': 0.0079, 'avg_degree': 6.2076, 'avg_unique_neighbors': 6.157, 'global_efficiency': 0.3668, 'avg_path_length': 2.8664, 'avg_degree_centrality': 0.0158, 'max_degree_centrality': 0.5076, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0585, 'degree_assortativity': -0.1686, 'graph_robustness': 0.8638, 'diameter_estimate': 6, 'clustering_coefficient': 0.3121, 'weakly_connected_components': 9, 'largest_wcc_size': 387, 'pagerank_top10_percent': 8.88, 'louvain_communities': 20, 'louvain_modularity': 0.4514, 'label_entropy': 1.4608, 'computational_time': 0.4725929700070992}, 'retrieval_queries': []}
2025-11-24 14:45:01,133 - src.pipeline.kg_builder - DEBUG - Batch 27 metrics: {
  "batch_idx": 27,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966701.1333792,
  "total_time": 37.79192220600089,
  "aggregation": 2.869986928999424e-06,
  "network_info": 0.006376978999469429,
  "llm_extraction": 37.09968605794711,
  "data_cleaning": 1.552602043375373e-05,
  "neo4j_injection": 0.21284421696327627,
  "embedding_time": 0,
  "indexing_time": 0.0024167910451069474,
  "graph_injection_time": 0.2102736930246465,
  "acs_metrics": {
    "node_count": 395,
    "relationship_count": 1226,
    "density": 0.0079,
    "avg_degree": 6.2076,
    "avg_unique_neighbors": 6.157,
    "global_efficiency": 0.3668,
    "avg_path_length": 2.8664,
    "avg_degree_centrality": 0.0158,
    "max_degree_centrality": 0.5076,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0585,
    "degree_assortativity": -0.1686,
    "graph_robustness": 0.8638,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.3121,
    "weakly_connected_components": 9,
    "largest_wcc_size": 387,
    "pagerank_top10_percent": 8.88,
    "louvain_communities": 20,
    "louvain_modularity": 0.4514,
    "label_entropy": 1.4608,
    "computational_time": 0.4725929700070992
  },
  "retrieval_queries": []
}
2025-11-24 14:45:01,134 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:45:01,134 - src.pipeline.kg_builder - INFO - Batch 28 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 37.10s, Clean: 0.00s, Neo4j: 0.21s, ACS: 0.47s
2025-11-24 14:45:01,134 - src.pipeline.kg_builder - INFO - Batch 28 completed in 37.79s
Processing KG batches:  39%|███▉      | 28/72 [16:58<28:22, 38.69s/it]2025-11-24 14:45:01,134 - src.pipeline.kg_builder - INFO - Processing batch 29/72 (3 items)
2025-11-24 14:45:01,134 - src.pipeline.kg_builder - DEBUG - Batch 29 current_video_time: 07:08-07:13
2025-11-24 14:45:01,142 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 395
- Total Relationships: 413
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:45:01,142 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:45:01,142 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0 ~226 words, content: Time: 06:59-07:03 Content: The sequence of frames captures a person in a laboratory setting performing a precise task, likely related to preparing a chemical solution....
2025-11-24 14:45:01,142 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1 ~225 words, content: the Seal (Frame 4):** The person continues to hold the flask, now with the stopper fully in place. They are likely in the process of...
2025-11-24 14:45:01,142 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2 ~226 words, content: the person holding a glass volumetric flask, which is a piece of laboratory glassware used to prepare a solution of precise concentration. The flask is...
2025-11-24 14:45:01,142 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3 ~227 words, content: . In summary, the video shows a person in a lab, wearing protective gloves, preparing a solution by carefully adding a liquid to a volumetric...
2025-11-24 14:45:01,142 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4 ~102 words, content: to adjust or secure the stopper. The camera angle shifts slightly, providing a clearer view of the person in the background, who remains focused on...
2025-11-24 14:45:01,142 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:45:01,142 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0) (~226 words) with timeout=5.0s retries=3
2025-11-24 14:45:02,414 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:45:02,414 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:45:02,414 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1) (~225 words) with timeout=5.0s retries=3
2025-11-24 14:45:03,356 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:45:03,356 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:45:03,356 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2) (~226 words) with timeout=5.0s retries=3
2025-11-24 14:45:04,497 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:45:04,497 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:45:04,497 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3) (~227 words) with timeout=5.0s retries=3
2025-11-24 14:45:05,575 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:45:05,575 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:45:05,575 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4) (~102 words) with timeout=5.0s retries=3
2025-11-24 14:45:06,844 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:45:06,844 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:45:06,844 - src.components.pre_llm_injector - INFO - Extracted 26 local triplets from 5 chunks
2025-11-24 14:45:06,844 - src.pipeline.kg_builder - INFO - Pre-extraction: 26 triplets in 5.70s
2025-11-24 14:45:06,844 - src.components.global_refiner - INFO - Capping refinement input: 26 → 25 triplets
2025-11-24 14:45:06,844 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 395
- Total Relationships: 413
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0"]}, {"head": "Person", "relation": "Places", "tail": "Stopper", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0"]}, {"head": "Person", "relation": "Checks", "tail": "Liquid_Level", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0"]}, {"head": "Person", "relation": "Holds", "tail": "Flask_Steady", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0"]}, {"head": "Person", "relation": "Holds", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1"]}, {"head": "Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1"]}, {"head": "Person", "relation": "Inverts", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1"]}, {"head": "Flask", "relation": "Contains", "tail": "Stopper", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1"]}, {"head": "Person", "relation": "Holds", "tail": "Stopper", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1"]}, {"head": "Flask", "relation": "Contains", "tail": "Solution", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2"]}, {"head": "Volumetric Flask", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4"]}, {"head": "Person", "relation": "Seals", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3"]}, {"head": "Person", "relation": "Inverts", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2"]}, {"head": "Person", "relation": "Mixes", "tail": "Solution", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3"]}, {"head": "Person", "relation": "Wears", "tail": "Protective Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3"]}, {"head": "Person", "relation": "Observes", "tail": "Lab Procedure", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3"]}, {"head": "Lab Procedure", "relation": "Involves", "tail": "Precise Liquid Handling", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3"]}, {"head": "Person", "relation": "Adjusts", "tail": "Stopper", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4"]}, {"head": "Stopper", "relation": "Is Seated In", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4"]}, {"head": "Person", "relation": "Observes", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4"]}, {"head": "Person", "relation": "Performs", "tail": "Sealing Action", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:45:06,845 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~334 words, ~434 tokens)
2025-11-24 14:45:06,845 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:45:38,371 - src.components.global_refiner - DEBUG - LLM call completed in 31.53s
2025-11-24 14:45:38,371 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0']], ['Person', 'holds', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0']], ['Person', 'places', 'Stopper', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0']], ['Volumetric_Flask', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0']], ['Person', 'checks', 'Liquid_Level', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0']], ['Person', 'holds', 'Flask_Steady', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0']], ['Person', 'holds', 'Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1']], ['Flask', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1']], ['Person', 'inverts', 'Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1']], ['Flask', 'contains', 'Stopper', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1']], ['Person', 'holds', 'Stopper', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1']], ['Flask', 'contains', 'Solution', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1']], ['Person', 'holds', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2']], ['Volumetric_Flask', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4']], ['Person', 'seals', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3']], ['Person', 'inverts', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2']], ['Person', 'mixes', 'Solution', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3']], ['Person', 'wears', 'Protective_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3']], ['Person', 'observes', 'Lab_Procedure', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3']], ['Lab_Procedure', 'involves', 'Precise_Liquid_Handling', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3']], ['Person', 'adjusts', 'Stopper', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4']], ['Stopper', 'is_seated_in', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4']], ['Person', 'observes', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4']], ['Person', 'performs', 'Sealing_Action', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4']]]
2025-11-24 14:45:38,371 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0"
    ]
  ],
  [
    "Person",
    "places",
    "Stopper",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0"
    ]
  ],
  [
    "Person",
    "checks",
    "Liquid_Level",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Flask_Steady",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1"
    ]
  ],
  [
    "Flask",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1"
    ]
  ],
  [
    "Person",
    "inverts",
    "Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1"
    ]
  ],
  [
    "Flask",
    "contains",
    "Stopper",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Stopper",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1"
    ]
  ],
  [
    "Flask",
    "contains",
    "Solution",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4"
    ]
  ],
  [
    "Person",
    "seals",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3"
    ]
  ],
  [
    "Person",
    "inverts",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2"
    ]
  ],
  [
    "Person",
    "mixes",
    "Solution",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Protective_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3"
    ]
  ],
  [
    "Person",
    "observes",
    "Lab_Procedure",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3"
    ]
  ],
  [
    "Lab_Procedure",
    "involves",
    "Precise_Liquid_Handling",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_3"
    ]
  ],
  [
    "Person",
    "adjusts",
    "Stopper",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4"
    ]
  ],
  [
    "Stopper",
    "is_seated_in",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4"
    ]
  ],
  [
    "Person",
    "observes",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4"
    ]
  ],
  [
    "Person",
    "performs",
    "Sealing_Action",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_28_4"
    ]
  ]
]
2025-11-24 14:45:38,371 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 31.53s, LLM: 31.53s)
2025-11-24 14:45:38,371 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 31.53s
2025-11-24 14:45:38,371 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:45:38,371 - src.pipeline.kg_builder - INFO - Pushing batch 29/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:45:38,371 - src.components.neo4j_handler - INFO - Adding 23 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:45:38,581 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:45:38,581 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:45:38,582 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:45:38,582 - src.components.neo4j_handler - INFO - Batch injected in 0.21s (triplets: 0.21s, indexes: 0.00s)
2025-11-24 14:45:38,582 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:45:38,661 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 406 nodes
2025-11-24 14:45:38,860 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 398 nodes
2025-11-24 14:45:39,086 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 406, 'relationship_count': 1263, 'density': 0.0077, 'avg_degree': 6.2217, 'avg_unique_neighbors': 6.1724, 'global_efficiency': 0.3706, 'avg_path_length': 2.8356, 'avg_degree_centrality': 0.0154, 'max_degree_centrality': 0.5259, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0556, 'degree_assortativity': -0.1826, 'graph_robustness': 0.8527, 'diameter_estimate': 6, 'clustering_coefficient': 0.3127, 'weakly_connected_components': 9, 'largest_wcc_size': 398, 'pagerank_top10_percent': 8.66, 'louvain_communities': 20, 'louvain_modularity': 0.4329, 'label_entropy': 1.4624, 'computational_time': 0.5041220450075343}
2025-11-24 14:45:39,086 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 28, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966739.086433, 'total_time': 37.952167532988824, 'aggregation': 2.469983883202076e-06, 'network_info': 0.007769746996928006, 'llm_extraction': 37.2294494920061, 'data_cleaning': 2.4051987566053867e-05, 'neo4j_injection': 0.21041689300909638, 'embedding_time': 0, 'indexing_time': 0.002856448001693934, 'graph_injection_time': 0.207368788018357, 'acs_metrics': {'node_count': 406, 'relationship_count': 1263, 'density': 0.0077, 'avg_degree': 6.2217, 'avg_unique_neighbors': 6.1724, 'global_efficiency': 0.3706, 'avg_path_length': 2.8356, 'avg_degree_centrality': 0.0154, 'max_degree_centrality': 0.5259, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0556, 'degree_assortativity': -0.1826, 'graph_robustness': 0.8527, 'diameter_estimate': 6, 'clustering_coefficient': 0.3127, 'weakly_connected_components': 9, 'largest_wcc_size': 398, 'pagerank_top10_percent': 8.66, 'louvain_communities': 20, 'louvain_modularity': 0.4329, 'label_entropy': 1.4624, 'computational_time': 0.5041220450075343}, 'retrieval_queries': []}
2025-11-24 14:45:39,086 - src.pipeline.kg_builder - DEBUG - Batch 28 metrics: {
  "batch_idx": 28,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966739.086433,
  "total_time": 37.952167532988824,
  "aggregation": 2.469983883202076e-06,
  "network_info": 0.007769746996928006,
  "llm_extraction": 37.2294494920061,
  "data_cleaning": 2.4051987566053867e-05,
  "neo4j_injection": 0.21041689300909638,
  "embedding_time": 0,
  "indexing_time": 0.002856448001693934,
  "graph_injection_time": 0.207368788018357,
  "acs_metrics": {
    "node_count": 406,
    "relationship_count": 1263,
    "density": 0.0077,
    "avg_degree": 6.2217,
    "avg_unique_neighbors": 6.1724,
    "global_efficiency": 0.3706,
    "avg_path_length": 2.8356,
    "avg_degree_centrality": 0.0154,
    "max_degree_centrality": 0.5259,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0556,
    "degree_assortativity": -0.1826,
    "graph_robustness": 0.8527,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.3127,
    "weakly_connected_components": 9,
    "largest_wcc_size": 398,
    "pagerank_top10_percent": 8.66,
    "louvain_communities": 20,
    "louvain_modularity": 0.4329,
    "label_entropy": 1.4624,
    "computational_time": 0.5041220450075343
  },
  "retrieval_queries": []
}
2025-11-24 14:45:39,087 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:45:39,087 - src.pipeline.kg_builder - INFO - Batch 29 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 37.23s, Clean: 0.00s, Neo4j: 0.21s, ACS: 0.50s
2025-11-24 14:45:39,087 - src.pipeline.kg_builder - INFO - Batch 29 completed in 37.95s
Processing KG batches:  40%|████      | 29/72 [17:36<27:34, 38.47s/it]2025-11-24 14:45:39,087 - src.pipeline.kg_builder - INFO - Processing batch 30/72 (3 items)
2025-11-24 14:45:39,087 - src.pipeline.kg_builder - DEBUG - Batch 30 current_video_time: 07:23-07:28
2025-11-24 14:45:39,092 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 406
- Total Relationships: 430
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:45:39,092 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-24 14:45:39,092 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0 ~241 words, content: Time: 07:13-07:18 Content: The video captures a scene in a laboratory setting, likely a chemistry or research lab, where a scientific procedure is being performed....
2025-11-24 14:45:39,092 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1 ~225 words, content: precision, which is essential in scientific research. The video likely aims to document a specific scientific procedure, emphasizing the importance of careful handling and observation...
2025-11-24 14:45:39,092 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2 ~210 words, content: final frame shows the person's arm and a gold watch, confirming the first-person viewpoint. The overall atmosphere suggests a teaching or research demonstration. Time: 07:23-07:28...
2025-11-24 14:45:39,092 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:45:39,092 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0) (~241 words) with timeout=5.0s retries=3
2025-11-24 14:45:40,448 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:45:40,448 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:45:40,449 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1) (~225 words) with timeout=5.0s retries=3
2025-11-24 14:45:41,789 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:45:41,789 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:45:41,790 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2) (~210 words) with timeout=5.0s retries=3
2025-11-24 14:45:42,814 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:45:42,814 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:45:42,814 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 3 chunks
2025-11-24 14:45:42,814 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 3.72s
2025-11-24 14:45:42,814 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 406
- Total Relationships: 430
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0"]}, {"head": "Person", "relation": "Handles", "tail": "Volumetric_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0"]}, {"head": "Person", "relation": "Observes", "tail": "Another_Person", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0"]}, {"head": "Lab", "relation": "Contains", "tail": "Fire_Extinguisher", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1"]}, {"head": "Volumetric Flask", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1"]}, {"head": "Man", "relation": "Observes", "tail": "Laboratory Activity", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1"]}, {"head": "Man", "relation": "Wears", "tail": "Cream-Colored Turtleneck Sweater", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Fire Extinguisher", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2"]}, {"head": "Person", "relation": "Performs", "tail": "Titration", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2"]}, {"head": "Person", "relation": "Uses", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2"]}, {"head": "Observer", "relation": "Watches", "tail": "Procedure", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:45:42,814 - src.components.global_refiner - DEBUG - Refining 17 triplets (prompt ~262 words, ~341 tokens)
2025-11-24 14:45:42,814 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:46:09,491 - src.components.global_refiner - DEBUG - LLM call completed in 26.68s
2025-11-24 14:46:09,491 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1']], ['Person', 'handles', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0']], ['Person', 'observes', 'Another_Person', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0']], ['Volumetric_Flask', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2']], ['Lab', 'contains', 'Fire_Extinguisher', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0']], ['Person', 'holds', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1']], ['Man', 'wears', 'Cream-Colored_Turtleneck_Sweater', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1']], ['Man', 'observes', 'Laboratory_Activity', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1']], ['Laboratory', 'contains', 'Fire_Extinguisher', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2']], ['Person', 'performs', 'Titration', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2']], ['Person', 'uses', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2']], ['Observer', 'watches', 'Procedure', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2']], ['Laboratory', 'contains', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1']], ['Person', 'observes', 'Another_Person', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2']], ['Person', 'holds', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1']], ['Person', 'performs', 'Titration', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2']]]
2025-11-24 14:46:09,491 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1"
    ]
  ],
  [
    "Person",
    "handles",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0"
    ]
  ],
  [
    "Person",
    "observes",
    "Another_Person",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2"
    ]
  ],
  [
    "Lab",
    "contains",
    "Fire_Extinguisher",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1"
    ]
  ],
  [
    "Man",
    "wears",
    "Cream-Colored_Turtleneck_Sweater",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1"
    ]
  ],
  [
    "Man",
    "observes",
    "Laboratory_Activity",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Fire_Extinguisher",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2"
    ]
  ],
  [
    "Person",
    "performs",
    "Titration",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2"
    ]
  ],
  [
    "Observer",
    "watches",
    "Procedure",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1"
    ]
  ],
  [
    "Person",
    "observes",
    "Another_Person",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_1"
    ]
  ],
  [
    "Person",
    "performs",
    "Titration",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_29_2"
    ]
  ]
]
2025-11-24 14:46:09,491 - src.components.global_refiner - INFO - Refinement complete: 17 → 21 triplets (total: 26.68s, LLM: 26.68s)
2025-11-24 14:46:09,491 - src.pipeline.kg_builder - INFO - Global refinement: 21 triplets in 26.68s
2025-11-24 14:46:09,491 - src.pipeline.kg_builder - INFO - Using 21 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:46:09,491 - src.pipeline.kg_builder - INFO - Pushing batch 30/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:46:09,491 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:46:09,719 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:46:09,719 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:46:09,719 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:46:09,719 - src.components.neo4j_handler - INFO - Batch injected in 0.23s (triplets: 0.22s, indexes: 0.00s)
2025-11-24 14:46:09,719 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:46:09,778 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 415 nodes
2025-11-24 14:46:09,993 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 407 nodes
2025-11-24 14:46:10,229 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 415, 'relationship_count': 1294, 'density': 0.0075, 'avg_degree': 6.2361, 'avg_unique_neighbors': 6.188, 'global_efficiency': 0.3704, 'avg_path_length': 2.8376, 'avg_degree_centrality': 0.0151, 'max_degree_centrality': 0.5266, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0677, 'degree_assortativity': -0.1831, 'graph_robustness': 0.8586, 'diameter_estimate': 6, 'clustering_coefficient': 0.3117, 'weakly_connected_components': 9, 'largest_wcc_size': 407, 'pagerank_top10_percent': 8.45, 'louvain_communities': 20, 'louvain_modularity': 0.4335, 'label_entropy': 1.4623, 'computational_time': 0.5103331250138581}
2025-11-24 14:46:10,230 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 29, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966770.230143, 'total_time': 31.14284632797353, 'aggregation': 2.363987732678652e-06, 'network_info': 0.004755572008434683, 'llm_extraction': 30.399294885981362, 'data_cleaning': 1.2777047231793404e-05, 'neo4j_injection': 0.22804898000322282, 'embedding_time': 0, 'indexing_time': 0.003996161976829171, 'graph_injection_time': 0.22390769905177876, 'acs_metrics': {'node_count': 415, 'relationship_count': 1294, 'density': 0.0075, 'avg_degree': 6.2361, 'avg_unique_neighbors': 6.188, 'global_efficiency': 0.3704, 'avg_path_length': 2.8376, 'avg_degree_centrality': 0.0151, 'max_degree_centrality': 0.5266, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0677, 'degree_assortativity': -0.1831, 'graph_robustness': 0.8586, 'diameter_estimate': 6, 'clustering_coefficient': 0.3117, 'weakly_connected_components': 9, 'largest_wcc_size': 407, 'pagerank_top10_percent': 8.45, 'louvain_communities': 20, 'louvain_modularity': 0.4335, 'label_entropy': 1.4623, 'computational_time': 0.5103331250138581}, 'retrieval_queries': []}
2025-11-24 14:46:10,230 - src.pipeline.kg_builder - DEBUG - Batch 29 metrics: {
  "batch_idx": 29,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966770.230143,
  "total_time": 31.14284632797353,
  "aggregation": 2.363987732678652e-06,
  "network_info": 0.004755572008434683,
  "llm_extraction": 30.399294885981362,
  "data_cleaning": 1.2777047231793404e-05,
  "neo4j_injection": 0.22804898000322282,
  "embedding_time": 0,
  "indexing_time": 0.003996161976829171,
  "graph_injection_time": 0.22390769905177876,
  "acs_metrics": {
    "node_count": 415,
    "relationship_count": 1294,
    "density": 0.0075,
    "avg_degree": 6.2361,
    "avg_unique_neighbors": 6.188,
    "global_efficiency": 0.3704,
    "avg_path_length": 2.8376,
    "avg_degree_centrality": 0.0151,
    "max_degree_centrality": 0.5266,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0677,
    "degree_assortativity": -0.1831,
    "graph_robustness": 0.8586,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.3117,
    "weakly_connected_components": 9,
    "largest_wcc_size": 407,
    "pagerank_top10_percent": 8.45,
    "louvain_communities": 20,
    "louvain_modularity": 0.4335,
    "label_entropy": 1.4623,
    "computational_time": 0.5103331250138581
  },
  "retrieval_queries": []
}
2025-11-24 14:46:10,230 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:46:10,230 - src.pipeline.kg_builder - INFO - Batch 30 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 30.40s, Clean: 0.00s, Neo4j: 0.23s, ACS: 0.51s
2025-11-24 14:46:10,230 - src.pipeline.kg_builder - INFO - Batch 30 completed in 31.14s
Processing KG batches:  42%|████▏     | 30/72 [18:07<25:23, 36.27s/it]2025-11-24 14:46:10,231 - src.pipeline.kg_builder - INFO - Processing batch 31/72 (3 items)
2025-11-24 14:46:10,231 - src.pipeline.kg_builder - DEBUG - Batch 31 current_video_time: 07:38-07:43
2025-11-24 14:46:10,237 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 415
- Total Relationships: 438
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:46:10,237 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:46:10,237 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0 ~233 words, content: Time: 07:28-07:33 Content: The video captures a scene in a laboratory where a person is performing a precise liquid measurement. The sequence of frames shows...
2025-11-24 14:46:10,237 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1 ~229 words, content: the frame, observing the procedure. The overall context suggests that the person is preparing a solution of a specific concentration, a common task in chemistry...
2025-11-24 14:46:10,237 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2 ~225 words, content: and the person is seen adjusting the settings on the device. This suggests that the next step in the experiment involves mixing the contents of...
2025-11-24 14:46:10,237 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3 ~227 words, content: rile glove is holding a round-bottom flask, which is a type of laboratory glassware. The flask contains a clear liquid and is connected to a...
2025-11-24 14:46:10,237 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_4 ~53 words, content: person is now holding a different piece of glassware, possibly a pipette or a burette, and is preparing to use it. The scene suggests that...
2025-11-24 14:46:10,237 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:46:10,238 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0) (~233 words) with timeout=5.0s retries=3
2025-11-24 14:46:11,441 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:46:11,441 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:46:11,441 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1) (~229 words) with timeout=5.0s retries=3
2025-11-24 14:46:13,109 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:46:13,109 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:46:13,109 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2) (~225 words) with timeout=5.0s retries=3
2025-11-24 14:46:14,200 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:46:14,200 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:46:14,200 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3) (~227 words) with timeout=5.0s retries=3
2025-11-24 14:46:15,661 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:46:15,661 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:46:15,661 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_4) (~53 words) with timeout=5.0s retries=3
2025-11-24 14:46:16,709 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:46:16,709 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:46:16,709 - src.components.pre_llm_injector - INFO - Extracted 29 local triplets from 5 chunks
2025-11-24 14:46:16,709 - src.pipeline.kg_builder - INFO - Pre-extraction: 29 triplets in 6.47s
2025-11-24 14:46:16,709 - src.components.global_refiner - INFO - Capping refinement input: 29 → 25 triplets
2025-11-24 14:46:16,709 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 415
- Total Relationships: 438
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0"]}, {"head": "Person", "relation": "Performs", "tail": "Liquid Measurement", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0"]}, {"head": "Volumetric Flask", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0"]}, {"head": "Person", "relation": "Checks", "tail": "Meniscus", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0"]}, {"head": "Person", "relation": "Looks At", "tail": "Meniscus", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1"]}, {"head": "Person", "relation": "Holds", "tail": "Round_Bottom_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1"]}, {"head": "Round_Bottom_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1"]}, {"head": "Round_Bottom_Flask", "relation": "Is Placed On", "tail": "Magnetic_Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1"]}, {"head": "Magnetic_Stirrer", "relation": "Is Used For", "tail": "Mixing_Liquids", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1"]}, {"head": "Person", "relation": "Wears", "tail": "Lab Coat", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2"]}, {"head": "Person", "relation": "Holds", "tail": "Round-Bottom Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3"]}, {"head": "Round-Bottom Flask", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2"]}, {"head": "Person", "relation": "Adjusts", "tail": "Device", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2"]}, {"head": "Lab Coat", "relation": "Provides", "tail": "Protection", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2"]}, {"head": "Round-Bottom Flask", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3"]}, {"head": "Round-Bottom Flask", "relation": "Is Connected To", "tail": "Tubing", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3"]}, {"head": "Round-Bottom Flask", "relation": "Is Over", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3"]}, {"head": "Magnetic Stirrer", "relation": "Is Actively Mixing", "tail": "Contents Of Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3"]}, {"head": "Person", "relation": "Places", "tail": "Round-Bottom Flask On Countertop", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3"]}, {"head": "Person", "relation": "Holds", "tail": "Glassware", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_4"]}, {"head": "Person", "relation": "Prepares", "tail": "Experiment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:46:16,709 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~350 words, ~455 tokens)
2025-11-24 14:46:16,709 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:46:46,998 - src.components.global_refiner - DEBUG - LLM call completed in 30.29s
2025-11-24 14:46:46,998 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2']], ['Person', 'wears', 'Lab_Coat', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2']], ['Person', 'holds', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0']], ['Person', 'holds', 'Round_Bottom_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3']], ['Person', 'holds', 'Glassware', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_4']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1']], ['Person', 'performs', 'Liquid_Measurement', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0']], ['Person', 'checks', 'Meniscus', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0']], ['Person', 'looks_at', 'Meniscus', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0']], ['Person', 'adjusts', 'Device', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2']], ['Person', 'prepares', 'Experiment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_4']], ['Volumetric_Flask', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0']], ['Round_Bottom_Flask', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3']], ['Round_Bottom_Flask', 'is_connected_to', 'Tubing', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3']], ['Round_Bottom_Flask', 'is_over', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3']], ['Round_Bottom_Flask', 'is_placed_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2']], ['Round_Bottom_Flask', 'is_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2']], ['Magnetic_Stirrer', 'is_used_for', 'Mixing_Liquids', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1']], ['Magnetic_Stirrer', 'is_actively_mixing', 'Contents_Of_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3']], ['Lab_Coat', 'provides', 'Protection', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2']], ['Person', 'places', 'Round_Bottom_Flask_On_Countertop', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3']]]
2025-11-24 14:46:46,998 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Lab_Coat",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Round_Bottom_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Glassware",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_4"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1"
    ]
  ],
  [
    "Person",
    "performs",
    "Liquid_Measurement",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0"
    ]
  ],
  [
    "Person",
    "checks",
    "Meniscus",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0"
    ]
  ],
  [
    "Person",
    "looks_at",
    "Meniscus",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0"
    ]
  ],
  [
    "Person",
    "adjusts",
    "Device",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2"
    ]
  ],
  [
    "Person",
    "prepares",
    "Experiment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_4"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_0"
    ]
  ],
  [
    "Round_Bottom_Flask",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3"
    ]
  ],
  [
    "Round_Bottom_Flask",
    "is_connected_to",
    "Tubing",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3"
    ]
  ],
  [
    "Round_Bottom_Flask",
    "is_over",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3"
    ]
  ],
  [
    "Round_Bottom_Flask",
    "is_placed_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2"
    ]
  ],
  [
    "Round_Bottom_Flask",
    "is_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "is_used_for",
    "Mixing_Liquids",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_1"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "is_actively_mixing",
    "Contents_Of_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3"
    ]
  ],
  [
    "Lab_Coat",
    "provides",
    "Protection",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_2"
    ]
  ],
  [
    "Person",
    "places",
    "Round_Bottom_Flask_On_Countertop",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_30_3"
    ]
  ]
]
2025-11-24 14:46:46,999 - src.components.global_refiner - INFO - Refinement complete: 25 → 21 triplets (total: 30.29s, LLM: 30.29s)
2025-11-24 14:46:46,999 - src.pipeline.kg_builder - INFO - Global refinement: 21 triplets in 30.29s
2025-11-24 14:46:46,999 - src.pipeline.kg_builder - INFO - Using 21 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:46:46,999 - src.pipeline.kg_builder - INFO - Pushing batch 31/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:46:46,999 - src.components.neo4j_handler - INFO - Adding 21 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:46:47,299 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:46:47,299 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:46:47,299 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:46:47,299 - src.components.neo4j_handler - INFO - Batch injected in 0.30s (triplets: 0.30s, indexes: 0.00s)
2025-11-24 14:46:47,300 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:46:47,421 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 429 nodes
2025-11-24 14:46:47,653 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 421 nodes
2025-11-24 14:46:47,919 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 429, 'relationship_count': 1337, 'density': 0.0073, 'avg_degree': 6.2331, 'avg_unique_neighbors': 6.1865, 'global_efficiency': 0.3718, 'avg_path_length': 2.8277, 'avg_degree_centrality': 0.0146, 'max_degree_centrality': 0.535, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.056, 'degree_assortativity': -0.1916, 'graph_robustness': 0.8489, 'diameter_estimate': 6, 'clustering_coefficient': 0.3119, 'weakly_connected_components': 9, 'largest_wcc_size': 421, 'pagerank_top10_percent': 8.12, 'louvain_communities': 22, 'louvain_modularity': 0.4551, 'label_entropy': 1.4626, 'computational_time': 0.6192616819753312}
2025-11-24 14:46:47,919 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 30, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966807.919556, 'total_time': 37.68851290002931, 'aggregation': 3.563007339835167e-06, 'network_info': 0.006037371000275016, 'llm_extraction': 36.76185024401639, 'data_cleaning': 1.542596146464348e-05, 'neo4j_injection': 0.30089691799366847, 'embedding_time': 0, 'indexing_time': 0.00468389003071934, 'graph_injection_time': 0.2960563790402375, 'acs_metrics': {'node_count': 429, 'relationship_count': 1337, 'density': 0.0073, 'avg_degree': 6.2331, 'avg_unique_neighbors': 6.1865, 'global_efficiency': 0.3718, 'avg_path_length': 2.8277, 'avg_degree_centrality': 0.0146, 'max_degree_centrality': 0.535, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.056, 'degree_assortativity': -0.1916, 'graph_robustness': 0.8489, 'diameter_estimate': 6, 'clustering_coefficient': 0.3119, 'weakly_connected_components': 9, 'largest_wcc_size': 421, 'pagerank_top10_percent': 8.12, 'louvain_communities': 22, 'louvain_modularity': 0.4551, 'label_entropy': 1.4626, 'computational_time': 0.6192616819753312}, 'retrieval_queries': []}
2025-11-24 14:46:47,919 - src.pipeline.kg_builder - DEBUG - Batch 30 metrics: {
  "batch_idx": 30,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966807.919556,
  "total_time": 37.68851290002931,
  "aggregation": 3.563007339835167e-06,
  "network_info": 0.006037371000275016,
  "llm_extraction": 36.76185024401639,
  "data_cleaning": 1.542596146464348e-05,
  "neo4j_injection": 0.30089691799366847,
  "embedding_time": 0,
  "indexing_time": 0.00468389003071934,
  "graph_injection_time": 0.2960563790402375,
  "acs_metrics": {
    "node_count": 429,
    "relationship_count": 1337,
    "density": 0.0073,
    "avg_degree": 6.2331,
    "avg_unique_neighbors": 6.1865,
    "global_efficiency": 0.3718,
    "avg_path_length": 2.8277,
    "avg_degree_centrality": 0.0146,
    "max_degree_centrality": 0.535,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.056,
    "degree_assortativity": -0.1916,
    "graph_robustness": 0.8489,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.3119,
    "weakly_connected_components": 9,
    "largest_wcc_size": 421,
    "pagerank_top10_percent": 8.12,
    "louvain_communities": 22,
    "louvain_modularity": 0.4551,
    "label_entropy": 1.4626,
    "computational_time": 0.6192616819753312
  },
  "retrieval_queries": []
}
2025-11-24 14:46:47,920 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:46:47,920 - src.pipeline.kg_builder - INFO - Batch 31 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 36.76s, Clean: 0.00s, Neo4j: 0.30s, ACS: 0.62s
2025-11-24 14:46:47,920 - src.pipeline.kg_builder - INFO - Batch 31 completed in 37.69s
Processing KG batches:  43%|████▎     | 31/72 [18:45<25:04, 36.70s/it]2025-11-24 14:46:47,920 - src.pipeline.kg_builder - INFO - Processing batch 32/72 (3 items)
2025-11-24 14:46:47,920 - src.pipeline.kg_builder - DEBUG - Batch 32 current_video_time: 07:53-07:58
2025-11-24 14:46:47,928 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 429
- Total Relationships: 455
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:46:47,929 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:46:47,929 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0 ~235 words, content: Time: 07:43-07:48 Content: The video sequence captures a series of actions within a laboratory setting, focusing on a person conducting an experiment or a procedure....
2025-11-24 14:46:47,929 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1 ~235 words, content: involved in the experiment. The background shows a white cabinet with shelves containing various items, and a fire extinguisher is mounted on the wall, emphasizing...
2025-11-24 14:46:47,929 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2 ~227 words, content: precision analytical balance, identified by the "METTLER TOLEDO" brand name. The process unfolds as follows: - **Initial Setup:** The person prepares a small piece of...
2025-11-24 14:46:47,929 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3 ~226 words, content: , indicating adherence to safety protocols. The overall scene depicts a careful and methodical scientific procedure. Time: 07:53-07:58 Content: The sequence of frames captures a...
2025-11-24 14:46:47,929 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_4 ~143 words, content: .300 g`, which is a very slight change, suggesting the foil's weight is minimal. The person then opens the glass door of the balance again,...
2025-11-24 14:46:47,929 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:46:47,929 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0) (~235 words) with timeout=5.0s retries=3
2025-11-24 14:46:49,248 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:46:49,248 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:46:49,248 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1) (~235 words) with timeout=5.0s retries=3
2025-11-24 14:46:50,403 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:46:50,403 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:46:50,403 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2) (~227 words) with timeout=5.0s retries=3
2025-11-24 14:46:52,033 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:46:52,033 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:46:52,033 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3) (~226 words) with timeout=5.0s retries=3
2025-11-24 14:46:53,223 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:46:53,223 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:46:53,223 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_4) (~143 words) with timeout=5.0s retries=3
2025-11-24 14:46:54,631 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:46:54,631 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:46:54,631 - src.components.pre_llm_injector - INFO - Extracted 27 local triplets from 5 chunks
2025-11-24 14:46:54,631 - src.pipeline.kg_builder - INFO - Pre-extraction: 27 triplets in 6.70s
2025-11-24 14:46:54,631 - src.components.global_refiner - INFO - Capping refinement input: 27 → 25 triplets
2025-11-24 14:46:54,631 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 429
- Total Relationships: 455
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0"]}, {"head": "Person", "relation": "Holds", "tail": "Small Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0"]}, {"head": "Digital Scale", "relation": "Displays", "tail": "-5630.1", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0"]}, {"head": "Digital Scale", "relation": "Is On", "tail": "Black Countertop", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0"]}, {"head": "Person", "relation": "Interacts With", "tail": "Digital Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1"]}, {"head": "Person", "relation": "Uses", "tail": "Analytical Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_4"]}, {"head": "Analytical Balance", "relation": "Has Brand", "tail": "Mettler Toledo", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1"]}, {"head": "Person", "relation": "Handles", "tail": "Aluminum Foil", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1"]}, {"head": "Lab", "relation": "Contains", "tail": "Fire Extinguisher", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1"]}, {"head": "Lab", "relation": "Contains", "tail": "White Cabinet", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1"]}, {"head": "Person", "relation": "Places", "tail": "Aluminum Foil", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3"]}, {"head": "Aluminum Foil", "relation": "Is Inside", "tail": "Weighing Chamber", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2"]}, {"head": "Weighing Chamber", "relation": "Is Part Of", "tail": "Precision Analytical Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2"]}, {"head": "Precision Analytical Balance", "relation": "Displays", "tail": "-56.30", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2"]}, {"head": "Person", "relation": "Places", "tail": "White Rectangular Object", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2"]}, {"head": "White Rectangular Object", "relation": "Is On", "tail": "Weighing Pan", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3"]}, {"head": "Aluminum Foil", "relation": "Is On", "tail": "Balance Pan", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3"]}, {"head": "Balance", "relation": "Displays", "tail": "Negative Weight", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3"]}, {"head": "Person", "relation": "Closes", "tail": "Glass Draft Shield", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3"]}, {"head": "Balance", "relation": "Shows", "tail": "Weight Change", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3"]}, {"head": "Analytical Balance", "relation": "Displays", "tail": "-56.300 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_4"]}, {"head": "Person", "relation": "Removes", "tail": "Aluminum Foil", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_4"]}, {"head": "Aluminum Foil", "relation": "Has Weight", "tail": "Minimal", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:46:54,631 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~364 words, ~473 tokens)
2025-11-24 14:46:54,631 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:47:29,349 - src.components.global_refiner - DEBUG - LLM call completed in 34.72s
2025-11-24 14:47:29,349 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0']], ['Person', 'holds', 'Small Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0']], ['Digital Scale', 'displays', '-5630.1', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0']], ['Digital Scale', 'is_on', 'Black Countertop', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0']], ['Person', 'interacts_with', 'Digital Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0']], ['Person', 'wears', 'Blue Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1']], ['Person', 'uses', 'Analytical Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_4']], ['Analytical Balance', 'has_brand', 'Mettler Toledo', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1']], ['Person', 'handles', 'Aluminum Foil', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1']], ['Lab', 'contains', 'Fire Extinguisher', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1']], ['Lab', 'contains', 'White Cabinet', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1']], ['Person', 'places', 'Aluminum Foil', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3']], ['Aluminum Foil', 'is_inside', 'Weighing Chamber', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2']], ['Weighing Chamber', 'is_part_of', 'Precision Analytical Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2']], ['Precision Analytical Balance', 'displays', '-56.30', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2']], ['Person', 'places', 'White Rectangular Object', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2']], ['White Rectangular Object', 'is_on', 'Weighing Pan', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2']], ['Person', 'wears', 'Blue Nitrile Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3']], ['Aluminum Foil', 'is_on', 'Balance Pan', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3']], ['Balance', 'displays', 'Negative Weight', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3']], ['Person', 'closes', 'Glass Draft Shield', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3']], ['Balance', 'shows', 'Weight Change', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3']], ['Analytical Balance', 'displays', '-56.300 G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_4']], ['Person', 'removes', 'Aluminum Foil', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_4']], ['Aluminum Foil', 'has_weight', 'Minimal', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_4']]]
2025-11-24 14:47:29,349 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Small Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0"
    ]
  ],
  [
    "Digital Scale",
    "displays",
    "-5630.1",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0"
    ]
  ],
  [
    "Digital Scale",
    "is_on",
    "Black Countertop",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0"
    ]
  ],
  [
    "Person",
    "interacts_with",
    "Digital Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Analytical Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_4"
    ]
  ],
  [
    "Analytical Balance",
    "has_brand",
    "Mettler Toledo",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1"
    ]
  ],
  [
    "Person",
    "handles",
    "Aluminum Foil",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1"
    ]
  ],
  [
    "Lab",
    "contains",
    "Fire Extinguisher",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1"
    ]
  ],
  [
    "Lab",
    "contains",
    "White Cabinet",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_1"
    ]
  ],
  [
    "Person",
    "places",
    "Aluminum Foil",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3"
    ]
  ],
  [
    "Aluminum Foil",
    "is_inside",
    "Weighing Chamber",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2"
    ]
  ],
  [
    "Weighing Chamber",
    "is_part_of",
    "Precision Analytical Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2"
    ]
  ],
  [
    "Precision Analytical Balance",
    "displays",
    "-56.30",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2"
    ]
  ],
  [
    "Person",
    "places",
    "White Rectangular Object",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2"
    ]
  ],
  [
    "White Rectangular Object",
    "is_on",
    "Weighing Pan",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Nitrile Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3"
    ]
  ],
  [
    "Aluminum Foil",
    "is_on",
    "Balance Pan",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3"
    ]
  ],
  [
    "Balance",
    "displays",
    "Negative Weight",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3"
    ]
  ],
  [
    "Person",
    "closes",
    "Glass Draft Shield",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3"
    ]
  ],
  [
    "Balance",
    "shows",
    "Weight Change",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_3"
    ]
  ],
  [
    "Analytical Balance",
    "displays",
    "-56.300 G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_4"
    ]
  ],
  [
    "Person",
    "removes",
    "Aluminum Foil",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_4"
    ]
  ],
  [
    "Aluminum Foil",
    "has_weight",
    "Minimal",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_31_4"
    ]
  ]
]
2025-11-24 14:47:29,349 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 34.72s, LLM: 34.72s)
2025-11-24 14:47:29,349 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 34.72s
2025-11-24 14:47:29,349 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:47:29,349 - src.pipeline.kg_builder - INFO - Pushing batch 32/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:47:29,349 - src.components.neo4j_handler - INFO - Adding 25 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:47:29,914 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:47:29,914 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:47:29,915 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:47:29,915 - src.components.neo4j_handler - INFO - Batch injected in 0.57s (triplets: 0.55s, indexes: 0.02s)
2025-11-24 14:47:29,915 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:47:30,018 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 454 nodes
2025-11-24 14:47:30,317 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 446 nodes
2025-11-24 14:47:30,645 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 454, 'relationship_count': 1392, 'density': 0.0068, 'avg_degree': 6.1322, 'avg_unique_neighbors': 6.0881, 'global_efficiency': 0.3698, 'avg_path_length': 2.8459, 'avg_degree_centrality': 0.0135, 'max_degree_centrality': 0.532, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0576, 'degree_assortativity': -0.1936, 'graph_robustness': 0.8448, 'diameter_estimate': 6, 'clustering_coefficient': 0.3165, 'weakly_connected_components': 9, 'largest_wcc_size': 446, 'pagerank_top10_percent': 7.6, 'louvain_communities': 22, 'louvain_modularity': 0.4659, 'label_entropy': 1.4588, 'computational_time': 0.729792766040191}
2025-11-24 14:47:30,646 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 31, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966850.646114, 'total_time': 42.72559796797577, 'aggregation': 3.1100353226065636e-06, 'network_info': 0.007915020978543907, 'llm_extraction': 41.421032150043175, 'data_cleaning': 3.060302697122097e-05, 'neo4j_injection': 0.5662547129904851, 'embedding_time': 0, 'indexing_time': 0.016546747996471822, 'graph_injection_time': 0.5493714950280264, 'acs_metrics': {'node_count': 454, 'relationship_count': 1392, 'density': 0.0068, 'avg_degree': 6.1322, 'avg_unique_neighbors': 6.0881, 'global_efficiency': 0.3698, 'avg_path_length': 2.8459, 'avg_degree_centrality': 0.0135, 'max_degree_centrality': 0.532, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0576, 'degree_assortativity': -0.1936, 'graph_robustness': 0.8448, 'diameter_estimate': 6, 'clustering_coefficient': 0.3165, 'weakly_connected_components': 9, 'largest_wcc_size': 446, 'pagerank_top10_percent': 7.6, 'louvain_communities': 22, 'louvain_modularity': 0.4659, 'label_entropy': 1.4588, 'computational_time': 0.729792766040191}, 'retrieval_queries': []}
2025-11-24 14:47:30,646 - src.pipeline.kg_builder - DEBUG - Batch 31 metrics: {
  "batch_idx": 31,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966850.646114,
  "total_time": 42.72559796797577,
  "aggregation": 3.1100353226065636e-06,
  "network_info": 0.007915020978543907,
  "llm_extraction": 41.421032150043175,
  "data_cleaning": 3.060302697122097e-05,
  "neo4j_injection": 0.5662547129904851,
  "embedding_time": 0,
  "indexing_time": 0.016546747996471822,
  "graph_injection_time": 0.5493714950280264,
  "acs_metrics": {
    "node_count": 454,
    "relationship_count": 1392,
    "density": 0.0068,
    "avg_degree": 6.1322,
    "avg_unique_neighbors": 6.0881,
    "global_efficiency": 0.3698,
    "avg_path_length": 2.8459,
    "avg_degree_centrality": 0.0135,
    "max_degree_centrality": 0.532,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0576,
    "degree_assortativity": -0.1936,
    "graph_robustness": 0.8448,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.3165,
    "weakly_connected_components": 9,
    "largest_wcc_size": 446,
    "pagerank_top10_percent": 7.6,
    "louvain_communities": 22,
    "louvain_modularity": 0.4659,
    "label_entropy": 1.4588,
    "computational_time": 0.729792766040191
  },
  "retrieval_queries": []
}
2025-11-24 14:47:30,647 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:47:30,647 - src.pipeline.kg_builder - INFO - Batch 32 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 41.42s, Clean: 0.00s, Neo4j: 0.57s, ACS: 0.73s
2025-11-24 14:47:30,647 - src.pipeline.kg_builder - INFO - Batch 32 completed in 42.73s
Processing KG batches:  44%|████▍     | 32/72 [19:28<25:40, 38.51s/it]2025-11-24 14:47:30,647 - src.pipeline.kg_builder - INFO - Processing batch 33/72 (3 items)
2025-11-24 14:47:30,647 - src.pipeline.kg_builder - DEBUG - Batch 33 current_video_time: 08:08-08:13
2025-11-24 14:47:30,656 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 454
- Total Relationships: 478
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:47:30,657 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:47:30,657 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0 ~212 words, content: Time: 07:58-08:03 Content: The video sequence captures a scientific procedure, likely a chemical experiment, being conducted in a laboratory setting. The perspective is first-person, showing...
2025-11-24 14:47:30,657 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1 ~226 words, content: positive weight, indicating the mass of the substance that was added to the beaker. The final reading on the display is $0.191$ grams, which is...
2025-11-24 14:47:30,657 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2 ~238 words, content: the measurement. The person then carefully places a small, circular piece of aluminum foil onto the weighing pan. After closing the draft shield, the balance's...
2025-11-24 14:47:30,657 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3 ~232 words, content: precise measurement in a laboratory setting. The scene is set on a black laboratory bench, with various pieces of equipment and materials arranged around the...
2025-11-24 14:47:30,657 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_4 ~84 words, content: the bench. This suggests the next step in the procedure might involve using the foil, perhaps to cover the sample or to prepare for the...
2025-11-24 14:47:30,657 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:47:30,657 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0) (~212 words) with timeout=5.0s retries=3
2025-11-24 14:47:32,530 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:47:32,531 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:47:32,531 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1) (~226 words) with timeout=5.0s retries=3
2025-11-24 14:47:34,486 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:47:34,486 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:47:34,487 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2) (~238 words) with timeout=5.0s retries=3
2025-11-24 14:47:35,738 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:47:35,738 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:47:35,738 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3) (~232 words) with timeout=5.0s retries=3
2025-11-24 14:47:37,003 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:47:37,003 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:47:37,003 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_4) (~84 words) with timeout=5.0s retries=3
2025-11-24 14:47:38,268 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:47:38,268 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:47:38,268 - src.components.pre_llm_injector - INFO - Extracted 28 local triplets from 5 chunks
2025-11-24 14:47:38,268 - src.pipeline.kg_builder - INFO - Pre-extraction: 28 triplets in 7.61s
2025-11-24 14:47:38,268 - src.components.global_refiner - INFO - Capping refinement input: 28 → 25 triplets
2025-11-24 14:47:38,268 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 454
- Total Relationships: 478
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Researcher", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0"]}, {"head": "Researcher", "relation": "Opens", "tail": "Glass Draft Shield", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0"]}, {"head": "Researcher", "relation": "Places", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Analytical Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0"]}, {"head": "Analytical Balance", "relation": "Displays", "tail": "Negative Value", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0"]}, {"head": "Analytical Balance", "relation": "Displays", "tail": "Positive Value", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0"]}, {"head": "Analytical Balance", "relation": "Displays", "tail": "0.191 Grams", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3"]}, {"head": "Person", "relation": "Opens", "tail": "Draft Shield", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2"]}, {"head": "Draft Shield", "relation": "Is Part Of", "tail": "Analytical Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1"]}, {"head": "Analytical Balance", "relation": "Is On", "tail": "Laboratory Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1"]}, {"head": "Laboratory Bench", "relation": "Contains", "tail": "Bottle With Red Cap", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1"]}, {"head": "Person", "relation": "Places", "tail": "Aluminum Foil", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2"]}, {"head": "Aluminum Foil", "relation": "Has Mass", "tail": "Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2"]}, {"head": "Balance", "relation": "Displays", "tail": "0.193 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2"]}, {"head": "Person", "relation": "Closes", "tail": "Draft Shield", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2"]}, {"head": "Balance", "relation": "Is Surrounded By", "tail": "Laboratory Items", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "0.193 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3"]}, {"head": "Digital Balance", "relation": "Contains", "tail": "Metallic Dish", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3"]}, {"head": "Person", "relation": "Holds", "tail": "Small Tool", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3"]}, {"head": "Person", "relation": "Manipulates", "tail": "Sample", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3"]}, {"head": "Person", "relation": "Reaches For", "tail": "Aluminum Foil", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3"]}, {"head": "Person", "relation": "Adjusts", "tail": "Sample", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_4"]}, {"head": "Sample", "relation": "Is On", "tail": "Digital Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_4"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "0.193 Grams", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:47:38,268 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~362 words, ~471 tokens)
2025-11-24 14:47:38,268 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:48:08,981 - src.components.global_refiner - DEBUG - LLM call completed in 30.71s
2025-11-24 14:48:08,981 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Researcher', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0']], ['Researcher', 'opens', 'Glass_Draft_Shield', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0']], ['Researcher', 'places', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0']], ['Beaker', 'is_on', 'Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0']], ['Analytical_Balance', 'displays', 'Negative_Value', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0']], ['Analytical_Balance', 'displays', 'Positive_Value', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0']], ['Analytical_Balance', 'displays', '0.191_Grams', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1']], ['Person', 'wears', 'Blue_Nitrile_Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3']], ['Person', 'opens', 'Draft_Shield', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2']], ['Draft_Shield', 'is_part_of', 'Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1']], ['Analytical_Balance', 'is_on', 'Laboratory_Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1']], ['Laboratory_Bench', 'contains', 'Bottle_With_Red_Cap', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1']], ['Person', 'places', 'Aluminum_Foil', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2']], ['Aluminum_Foil', 'has_mass', 'Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2']], ['Balance', 'displays', '0.193_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2']], ['Person', 'closes', 'Draft_Shield', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2']], ['Balance', 'is_surrounded_by', 'Laboratory_Items', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2']], ['Digital_Balance', 'displays', '0.193_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3']], ['Digital_Balance', 'contains', 'Metallic_Dish', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3']], ['Person', 'holds', 'Small_Tool', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3']], ['Person', 'manipulates', 'Sample', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3']], ['Person', 'reaches_for', 'Aluminum_Foil', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3']], ['Person', 'adjusts', 'Sample', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_4']], ['Sample', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_4']], ['Digital_Balance', 'displays', '0.193_Grams', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_4']]]
2025-11-24 14:48:08,982 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Researcher",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0"
    ]
  ],
  [
    "Researcher",
    "opens",
    "Glass_Draft_Shield",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0"
    ]
  ],
  [
    "Researcher",
    "places",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0"
    ]
  ],
  [
    "Analytical_Balance",
    "displays",
    "Negative_Value",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0"
    ]
  ],
  [
    "Analytical_Balance",
    "displays",
    "Positive_Value",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_0"
    ]
  ],
  [
    "Analytical_Balance",
    "displays",
    "0.191_Grams",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3"
    ]
  ],
  [
    "Person",
    "opens",
    "Draft_Shield",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2"
    ]
  ],
  [
    "Draft_Shield",
    "is_part_of",
    "Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1"
    ]
  ],
  [
    "Analytical_Balance",
    "is_on",
    "Laboratory_Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Bottle_With_Red_Cap",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_1"
    ]
  ],
  [
    "Person",
    "places",
    "Aluminum_Foil",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2"
    ]
  ],
  [
    "Aluminum_Foil",
    "has_mass",
    "Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2"
    ]
  ],
  [
    "Balance",
    "displays",
    "0.193_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2"
    ]
  ],
  [
    "Person",
    "closes",
    "Draft_Shield",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2"
    ]
  ],
  [
    "Balance",
    "is_surrounded_by",
    "Laboratory_Items",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "0.193_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3"
    ]
  ],
  [
    "Digital_Balance",
    "contains",
    "Metallic_Dish",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Small_Tool",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3"
    ]
  ],
  [
    "Person",
    "manipulates",
    "Sample",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3"
    ]
  ],
  [
    "Person",
    "reaches_for",
    "Aluminum_Foil",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_3"
    ]
  ],
  [
    "Person",
    "adjusts",
    "Sample",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_4"
    ]
  ],
  [
    "Sample",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_4"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "0.193_Grams",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_32_4"
    ]
  ]
]
2025-11-24 14:48:08,982 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 30.71s, LLM: 30.71s)
2025-11-24 14:48:08,982 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 30.71s
2025-11-24 14:48:08,982 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:48:08,982 - src.pipeline.kg_builder - INFO - Pushing batch 33/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:48:08,982 - src.components.neo4j_handler - INFO - Adding 25 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:48:09,194 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:48:09,194 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:48:09,195 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:48:09,195 - src.components.neo4j_handler - INFO - Batch injected in 0.21s (triplets: 0.21s, indexes: 0.00s)
2025-11-24 14:48:09,195 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:48:09,282 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 467 nodes
2025-11-24 14:48:09,554 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 459 nodes
2025-11-24 14:48:09,855 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 467, 'relationship_count': 1441, 'density': 0.0066, 'avg_degree': 6.1713, 'avg_unique_neighbors': 6.1285, 'global_efficiency': 0.3705, 'avg_path_length': 2.8412, 'avg_degree_centrality': 0.0132, 'max_degree_centrality': 0.5322, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0836, 'degree_assortativity': -0.1934, 'graph_robustness': 0.8446, 'diameter_estimate': 6, 'clustering_coefficient': 0.3155, 'weakly_connected_components': 9, 'largest_wcc_size': 459, 'pagerank_top10_percent': 7.37, 'louvain_communities': 21, 'louvain_modularity': 0.4479, 'label_entropy': 1.4595, 'computational_time': 0.6607435009791516}
2025-11-24 14:48:09,856 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 32, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966889.8562014, 'total_time': 39.20860574900871, 'aggregation': 1.0377960279583931e-05, 'network_info': 0.008884479000698775, 'llm_extraction': 38.32542761700461, 'data_cleaning': 5.015195347368717e-05, 'neo4j_injection': 0.2126264109974727, 'embedding_time': 0, 'indexing_time': 0.0026950890314765275, 'graph_injection_time': 0.20965240197256207, 'acs_metrics': {'node_count': 467, 'relationship_count': 1441, 'density': 0.0066, 'avg_degree': 6.1713, 'avg_unique_neighbors': 6.1285, 'global_efficiency': 0.3705, 'avg_path_length': 2.8412, 'avg_degree_centrality': 0.0132, 'max_degree_centrality': 0.5322, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0836, 'degree_assortativity': -0.1934, 'graph_robustness': 0.8446, 'diameter_estimate': 6, 'clustering_coefficient': 0.3155, 'weakly_connected_components': 9, 'largest_wcc_size': 459, 'pagerank_top10_percent': 7.37, 'louvain_communities': 21, 'louvain_modularity': 0.4479, 'label_entropy': 1.4595, 'computational_time': 0.6607435009791516}, 'retrieval_queries': []}
2025-11-24 14:48:09,856 - src.pipeline.kg_builder - DEBUG - Batch 32 metrics: {
  "batch_idx": 32,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966889.8562014,
  "total_time": 39.20860574900871,
  "aggregation": 1.0377960279583931e-05,
  "network_info": 0.008884479000698775,
  "llm_extraction": 38.32542761700461,
  "data_cleaning": 5.015195347368717e-05,
  "neo4j_injection": 0.2126264109974727,
  "embedding_time": 0,
  "indexing_time": 0.0026950890314765275,
  "graph_injection_time": 0.20965240197256207,
  "acs_metrics": {
    "node_count": 467,
    "relationship_count": 1441,
    "density": 0.0066,
    "avg_degree": 6.1713,
    "avg_unique_neighbors": 6.1285,
    "global_efficiency": 0.3705,
    "avg_path_length": 2.8412,
    "avg_degree_centrality": 0.0132,
    "max_degree_centrality": 0.5322,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.0836,
    "degree_assortativity": -0.1934,
    "graph_robustness": 0.8446,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.3155,
    "weakly_connected_components": 9,
    "largest_wcc_size": 459,
    "pagerank_top10_percent": 7.37,
    "louvain_communities": 21,
    "louvain_modularity": 0.4479,
    "label_entropy": 1.4595,
    "computational_time": 0.6607435009791516
  },
  "retrieval_queries": []
}
2025-11-24 14:48:09,857 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:48:09,857 - src.pipeline.kg_builder - INFO - Batch 33 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 38.33s, Clean: 0.00s, Neo4j: 0.21s, ACS: 0.66s
2025-11-24 14:48:09,857 - src.pipeline.kg_builder - INFO - Batch 33 completed in 39.21s
Processing KG batches:  46%|████▌     | 33/72 [20:07<25:09, 38.72s/it]2025-11-24 14:48:09,857 - src.pipeline.kg_builder - INFO - Processing batch 34/72 (3 items)
2025-11-24 14:48:09,857 - src.pipeline.kg_builder - DEBUG - Batch 34 current_video_time: 08:23-08:28
2025-11-24 14:48:09,862 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 467
- Total Relationships: 499
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:48:09,862 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:48:09,862 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0 ~245 words, content: Time: 08:13-08:18 Content: The video sequence captures a series of actions within a laboratory setting, focusing on a person conducting an experiment. The scene is...
2025-11-24 14:48:09,862 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1 ~236 words, content: the contents of the container are not contaminated. The surrounding area includes a blue stand with a glass tube, a beaker, and a pair of...
2025-11-24 14:48:09,862 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2 ~248 words, content: the camera provides a wide view of the lab. A person wearing blue gloves is seen interacting with a piece of equipment, possibly a balance...
2025-11-24 14:48:09,862 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3 ~245 words, content: and other lab equipment remain in the foreground, but the primary action is the documentation of the experiment. Overall, the video depicts a scientific procedure...
2025-11-24 14:48:09,862 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_4 ~221 words, content: A glass container is placed on a magnetic stirrer, which is actively mixing a liquid. The stirrer is connected to a power source, and the...
2025-11-24 14:48:09,862 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:48:09,863 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0) (~245 words) with timeout=5.0s retries=3
2025-11-24 14:48:10,986 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:48:10,986 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:48:10,986 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1) (~236 words) with timeout=5.0s retries=3
2025-11-24 14:48:12,016 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:48:12,016 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:48:12,017 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2) (~248 words) with timeout=5.0s retries=3
2025-11-24 14:48:13,067 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:48:13,067 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:48:13,068 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3) (~245 words) with timeout=5.0s retries=3
2025-11-24 14:48:18,074 - src.components.pre_llm_injector - WARNING - Chunk 3 timed out after 5.0s (attempt 1/4), retrying...
2025-11-24 14:48:19,776 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 2)
2025-11-24 14:48:19,776 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:48:19,776 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_4) (~221 words) with timeout=5.0s retries=3
2025-11-24 14:48:21,114 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:48:21,114 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:48:21,114 - src.components.pre_llm_injector - INFO - Extracted 28 local triplets from 5 chunks
2025-11-24 14:48:21,114 - src.pipeline.kg_builder - INFO - Pre-extraction: 28 triplets in 11.25s
2025-11-24 14:48:21,115 - src.components.global_refiner - INFO - Capping refinement input: 28 → 25 triplets
2025-11-24 14:48:21,115 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 467
- Total Relationships: 499
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0"]}, {"head": "Person", "relation": "Handles", "tail": "Aluminum Foil", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1"]}, {"head": "Person", "relation": "Uses", "tail": "Balance Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0"]}, {"head": "Balance Scale", "relation": "Measures", "tail": "Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0"]}, {"head": "Container", "relation": "Is Placed On", "tail": "Balance Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0"]}, {"head": "Container", "relation": "Is Covered With", "tail": "Aluminum Foil", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1"]}, {"head": "Person", "relation": "Works At", "tail": "Countertop", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1"]}, {"head": "Lab", "relation": "Contains", "tail": "Balance Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1"]}, {"head": "Lab", "relation": "Contains", "tail": "Glass Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1"]}, {"head": "Lab", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1"]}, {"head": "Camera", "relation": "Provides", "tail": "Wide_View", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2"]}, {"head": "Person", "relation": "Interacts With", "tail": "Balance_Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2"]}, {"head": "Person", "relation": "Holds", "tail": "Smartphone", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3"]}, {"head": "Person", "relation": "Documents", "tail": "Experiment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2"]}, {"head": "Lab", "relation": "Contains", "tail": "Fire_Extinguisher", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2"]}, {"head": "Person", "relation": "Wears", "tail": "Cream-Colored Sweater", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3"]}, {"head": "Person", "relation": "Stands At", "tail": "Lab Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Glass Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Bottle With Red Cap", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Small Container With White Lid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3"]}, {"head": "Glass Container", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_4"]}, {"head": "Magnetic Stirrer", "relation": "Mixes", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_4"]}, {"head": "Liquid", "relation": "Is Stirred By", "tail": "Magnetic Bar", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:48:21,115 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~353 words, ~459 tokens)
2025-11-24 14:48:21,115 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:48:51,172 - src.components.global_refiner - DEBUG - LLM call completed in 30.06s
2025-11-24 14:48:51,172 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0']], ['Person', 'handles', 'Aluminum Foil', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1']], ['Person', 'uses', 'Balance Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0']], ['Balance Scale', 'measures', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0']], ['Container', 'is_placed_on', 'Balance Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0']], ['Container', 'is_covered_with', 'Aluminum Foil', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0']], ['Person', 'wears', 'Blue Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2']], ['Person', 'works_at', 'Countertop', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1']], ['Lab', 'contains', 'Balance Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1']], ['Lab', 'contains', 'Glass Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1']], ['Lab', 'contains', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1']], ['Camera', 'provides', 'Wide_View', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2']], ['Person', 'interacts_with', 'Balance Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2']], ['Person', 'holds', 'Smartphone', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3']], ['Person', 'documents', 'Experiment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2']], ['Lab', 'contains', 'Fire_Extinguisher', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2']], ['Person', 'wears', 'Cream-Colored Sweater', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3']], ['Person', 'stands_at', 'Lab Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3']], ['Lab Bench', 'contains', 'Glass Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3']], ['Lab Bench', 'contains', 'Bottle With Red Cap', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3']], ['Lab Bench', 'contains', 'Small Container With White Lid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3']], ['Glass Container', 'is_on', 'Magnetic Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_4']], ['Magnetic Stirrer', 'mixes', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_4']], ['Liquid', 'is_stirred_by', 'Magnetic Bar', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_4']]]
2025-11-24 14:48:51,172 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0"
    ]
  ],
  [
    "Person",
    "handles",
    "Aluminum Foil",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Balance Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0"
    ]
  ],
  [
    "Balance Scale",
    "measures",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0"
    ]
  ],
  [
    "Container",
    "is_placed_on",
    "Balance Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0"
    ]
  ],
  [
    "Container",
    "is_covered_with",
    "Aluminum Foil",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2"
    ]
  ],
  [
    "Person",
    "works_at",
    "Countertop",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1"
    ]
  ],
  [
    "Lab",
    "contains",
    "Balance Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1"
    ]
  ],
  [
    "Lab",
    "contains",
    "Glass Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1"
    ]
  ],
  [
    "Lab",
    "contains",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_1"
    ]
  ],
  [
    "Camera",
    "provides",
    "Wide_View",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2"
    ]
  ],
  [
    "Person",
    "interacts_with",
    "Balance Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Smartphone",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3"
    ]
  ],
  [
    "Person",
    "documents",
    "Experiment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2"
    ]
  ],
  [
    "Lab",
    "contains",
    "Fire_Extinguisher",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Cream-Colored Sweater",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3"
    ]
  ],
  [
    "Person",
    "stands_at",
    "Lab Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3"
    ]
  ],
  [
    "Lab Bench",
    "contains",
    "Glass Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3"
    ]
  ],
  [
    "Lab Bench",
    "contains",
    "Bottle With Red Cap",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3"
    ]
  ],
  [
    "Lab Bench",
    "contains",
    "Small Container With White Lid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_3"
    ]
  ],
  [
    "Glass Container",
    "is_on",
    "Magnetic Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_4"
    ]
  ],
  [
    "Magnetic Stirrer",
    "mixes",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_4"
    ]
  ],
  [
    "Liquid",
    "is_stirred_by",
    "Magnetic Bar",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_33_4"
    ]
  ]
]
2025-11-24 14:48:51,173 - src.components.global_refiner - INFO - Refinement complete: 25 → 24 triplets (total: 30.06s, LLM: 30.06s)
2025-11-24 14:48:51,173 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 30.06s
2025-11-24 14:48:51,173 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:48:51,173 - src.pipeline.kg_builder - INFO - Pushing batch 34/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:48:51,173 - src.components.neo4j_handler - INFO - Adding 24 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:48:51,376 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:48:51,376 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:48:51,376 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:48:51,376 - src.components.neo4j_handler - INFO - Batch injected in 0.20s (triplets: 0.20s, indexes: 0.00s)
2025-11-24 14:48:51,376 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:48:51,468 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 479 nodes
2025-11-24 14:48:51,754 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 471 nodes
2025-11-24 14:48:52,071 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 479, 'relationship_count': 1491, 'density': 0.0065, 'avg_degree': 6.2255, 'avg_unique_neighbors': 6.1837, 'global_efficiency': 0.3711, 'avg_path_length': 2.838, 'avg_degree_centrality': 0.013, 'max_degree_centrality': 0.5335, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0763, 'degree_assortativity': -0.1911, 'graph_robustness': 0.8457, 'diameter_estimate': 6, 'clustering_coefficient': 0.3162, 'weakly_connected_components': 9, 'largest_wcc_size': 471, 'pagerank_top10_percent': 7.02, 'louvain_communities': 21, 'louvain_modularity': 0.4659, 'label_entropy': 1.4605, 'computational_time': 0.6944388789706863}
2025-11-24 14:48:52,071 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 33, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966932.071732, 'total_time': 42.214457917027175, 'aggregation': 2.695014700293541e-06, 'network_info': 0.0048864950076676905, 'llm_extraction': 41.31079260300612, 'data_cleaning': 2.2799009457230568e-05, 'neo4j_injection': 0.20376725203823298, 'embedding_time': 0, 'indexing_time': 0.0025824119802564383, 'graph_injection_time': 0.2009955720277503, 'acs_metrics': {'node_count': 479, 'relationship_count': 1491, 'density': 0.0065, 'avg_degree': 6.2255, 'avg_unique_neighbors': 6.1837, 'global_efficiency': 0.3711, 'avg_path_length': 2.838, 'avg_degree_centrality': 0.013, 'max_degree_centrality': 0.5335, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0763, 'degree_assortativity': -0.1911, 'graph_robustness': 0.8457, 'diameter_estimate': 6, 'clustering_coefficient': 0.3162, 'weakly_connected_components': 9, 'largest_wcc_size': 471, 'pagerank_top10_percent': 7.02, 'louvain_communities': 21, 'louvain_modularity': 0.4659, 'label_entropy': 1.4605, 'computational_time': 0.6944388789706863}, 'retrieval_queries': []}
2025-11-24 14:48:52,071 - src.pipeline.kg_builder - DEBUG - Batch 33 metrics: {
  "batch_idx": 33,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966932.071732,
  "total_time": 42.214457917027175,
  "aggregation": 2.695014700293541e-06,
  "network_info": 0.0048864950076676905,
  "llm_extraction": 41.31079260300612,
  "data_cleaning": 2.2799009457230568e-05,
  "neo4j_injection": 0.20376725203823298,
  "embedding_time": 0,
  "indexing_time": 0.0025824119802564383,
  "graph_injection_time": 0.2009955720277503,
  "acs_metrics": {
    "node_count": 479,
    "relationship_count": 1491,
    "density": 0.0065,
    "avg_degree": 6.2255,
    "avg_unique_neighbors": 6.1837,
    "global_efficiency": 0.3711,
    "avg_path_length": 2.838,
    "avg_degree_centrality": 0.013,
    "max_degree_centrality": 0.5335,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0763,
    "degree_assortativity": -0.1911,
    "graph_robustness": 0.8457,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.3162,
    "weakly_connected_components": 9,
    "largest_wcc_size": 471,
    "pagerank_top10_percent": 7.02,
    "louvain_communities": 21,
    "louvain_modularity": 0.4659,
    "label_entropy": 1.4605,
    "computational_time": 0.6944388789706863
  },
  "retrieval_queries": []
}
2025-11-24 14:48:52,072 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:48:52,072 - src.pipeline.kg_builder - INFO - Batch 34 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 41.31s, Clean: 0.00s, Neo4j: 0.20s, ACS: 0.69s
2025-11-24 14:48:52,072 - src.pipeline.kg_builder - INFO - Batch 34 completed in 42.21s
Processing KG batches:  47%|████▋     | 34/72 [20:49<25:11, 39.77s/it]2025-11-24 14:48:52,072 - src.pipeline.kg_builder - INFO - Processing batch 35/72 (3 items)
2025-11-24 14:48:52,072 - src.pipeline.kg_builder - DEBUG - Batch 35 current_video_time: 08:38-08:43
2025-11-24 14:48:52,082 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 479
- Total Relationships: 517
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:48:52,083 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:48:52,083 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0 ~235 words, content: Time: 08:28-08:33 Content: The video captures a sequence of actions in a laboratory setting, focusing on a chemical experiment. The scene is set on a...
2025-11-24 14:48:52,083 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1 ~224 words, content: show the person continuing to use the pipette to transfer the liquid. The test tube is held steady, and the liquid is being drawn into...
2025-11-24 14:48:52,083 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2 ~223 words, content: with precision, suggesting a controlled experiment. The person's hands are the primary focus, demonstrating careful handling of the chemicals. - **Final State:** After the transfer,...
2025-11-24 14:48:52,083 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3 ~226 words, content: weighing balance or a stir plate. - **Transfer to a Volumetric Flask:** The researcher then carefully transfers the liquid from the small vial into a...
2025-11-24 14:48:52,083 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_4 ~71 words, content: which might contain a reagent. In summary, the video shows a researcher meticulously preparing a chemical solution in a laboratory setting. The process involves precise...
2025-11-24 14:48:52,083 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:48:52,083 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0) (~235 words) with timeout=5.0s retries=3
2025-11-24 14:48:53,297 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:48:53,298 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:48:53,298 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1) (~224 words) with timeout=5.0s retries=3
2025-11-24 14:48:54,623 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:48:54,623 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:48:54,624 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2) (~223 words) with timeout=5.0s retries=3
2025-11-24 14:48:55,865 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:48:55,865 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:48:55,866 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3) (~226 words) with timeout=5.0s retries=3
2025-11-24 14:48:57,269 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:48:57,269 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:48:57,270 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_4) (~71 words) with timeout=5.0s retries=3
2025-11-24 14:48:58,667 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:48:58,668 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:48:58,668 - src.components.pre_llm_injector - INFO - Extracted 29 local triplets from 5 chunks
2025-11-24 14:48:58,668 - src.pipeline.kg_builder - INFO - Pre-extraction: 29 triplets in 6.59s
2025-11-24 14:48:58,669 - src.components.global_refiner - INFO - Capping refinement input: 29 → 25 triplets
2025-11-24 14:48:58,669 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 479
- Total Relationships: 517
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Lab Bench", "relation": "Contains", "tail": "Glass Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0"]}, {"head": "Glass Flask", "relation": "Connected To", "tail": "Flexible Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0"]}, {"head": "Flexible Tube", "relation": "Connected To", "tail": "Plastic Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1"]}, {"head": "Person", "relation": "Holds", "tail": "Test_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1"]}, {"head": "Test_Tube", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1"]}, {"head": "Volumetric_Flask", "relation": "Receives", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1"]}, {"head": "Laboratory_Bench", "relation": "Contains", "tail": "Analytical_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1"]}, {"head": "Person", "relation": "Holds", "tail": "Test Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2"]}, {"head": "Person", "relation": "Uses", "tail": "Glass Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2"]}, {"head": "Glass Vial", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Analytical Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2"]}, {"head": "Researcher", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3"]}, {"head": "Liquid", "relation": "Is In", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3"]}, {"head": "Balance", "relation": "Is Used To", "tail": "Weigh Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3"]}, {"head": "Stir Plate", "relation": "Is Used To", "tail": "Mix Solution", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3"]}, {"head": "Beaker", "relation": "Is On", "tail": "Stir Plate", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3"]}, {"head": "Magnetic Stir Bar", "relation": "Is In", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3"]}, {"head": "Researcher", "relation": "Prepares", "tail": "Chemical Solution", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_4"]}, {"head": "Researcher", "relation": "Uses", "tail": "Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:48:58,669 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~348 words, ~452 tokens)
2025-11-24 14:48:58,669 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:49:35,447 - src.components.global_refiner - DEBUG - LLM call completed in 36.78s
2025-11-24 14:49:35,447 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Lab_Bench', 'contains', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0']], ['Glass_Flask', 'connected_to', 'Flexible_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0']], ['Flexible_Tube', 'connected_to', 'Plastic_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0']], ['Person', 'holds', 'Test_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2']], ['Test_Tube', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1']], ['Person', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1']], ['Volumetric_Flask', 'receives', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1']], ['Laboratory_Bench', 'contains', 'Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1']], ['Person', 'holds', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2']], ['Person', 'uses', 'Glass_Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2']], ['Glass_Vial', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2']], ['Lab_Table', 'contains', 'Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2']], ['Researcher', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3']], ['Liquid', 'is_in', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3']], ['Balance', 'is_used_to', 'weigh_vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3']], ['Stir_Plate', 'is_used_to', 'mix_solution', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3']], ['Beaker', 'is_on', 'Stir_Plate', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3']], ['Magnetic_Stir_Bar', 'is_in', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3']], ['Researcher', 'prepares', 'Chemical_Solution', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_4']], ['Researcher', 'uses', 'Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_4']]]
2025-11-24 14:49:35,447 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Lab_Bench",
    "contains",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0"
    ]
  ],
  [
    "Glass_Flask",
    "connected_to",
    "Flexible_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0"
    ]
  ],
  [
    "Flexible_Tube",
    "connected_to",
    "Plastic_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Test_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2"
    ]
  ],
  [
    "Test_Tube",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1"
    ]
  ],
  [
    "Volumetric_Flask",
    "receives",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Glass_Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2"
    ]
  ],
  [
    "Glass_Vial",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2"
    ]
  ],
  [
    "Lab_Table",
    "contains",
    "Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_2"
    ]
  ],
  [
    "Researcher",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3"
    ]
  ],
  [
    "Liquid",
    "is_in",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3"
    ]
  ],
  [
    "Balance",
    "is_used_to",
    "weigh_vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3"
    ]
  ],
  [
    "Stir_Plate",
    "is_used_to",
    "mix_solution",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Stir_Plate",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3"
    ]
  ],
  [
    "Magnetic_Stir_Bar",
    "is_in",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_3"
    ]
  ],
  [
    "Researcher",
    "prepares",
    "Chemical_Solution",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_4"
    ]
  ],
  [
    "Researcher",
    "uses",
    "Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_34_4"
    ]
  ]
]
2025-11-24 14:49:35,447 - src.components.global_refiner - INFO - Refinement complete: 25 → 23 triplets (total: 36.78s, LLM: 36.78s)
2025-11-24 14:49:35,447 - src.pipeline.kg_builder - INFO - Global refinement: 23 triplets in 36.78s
2025-11-24 14:49:35,447 - src.pipeline.kg_builder - INFO - Using 23 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:49:35,447 - src.pipeline.kg_builder - INFO - Pushing batch 35/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:49:35,447 - src.components.neo4j_handler - INFO - Adding 23 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:49:35,678 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:49:35,678 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:49:35,678 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:49:35,678 - src.components.neo4j_handler - INFO - Batch injected in 0.23s (triplets: 0.23s, indexes: 0.00s)
2025-11-24 14:49:35,678 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:49:35,774 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 491 nodes
2025-11-24 14:49:36,113 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 483 nodes
2025-11-24 14:49:36,511 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 491, 'relationship_count': 1543, 'density': 0.0064, 'avg_degree': 6.2851, 'avg_unique_neighbors': 6.2403, 'global_efficiency': 0.3709, 'avg_path_length': 2.8408, 'avg_degree_centrality': 0.0128, 'max_degree_centrality': 0.5306, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0856, 'degree_assortativity': -0.1894, 'graph_robustness': 0.8432, 'diameter_estimate': 6, 'clustering_coefficient': 0.3167, 'weakly_connected_components': 9, 'largest_wcc_size': 483, 'pagerank_top10_percent': 6.83, 'louvain_communities': 22, 'louvain_modularity': 0.4601, 'label_entropy': 1.4615, 'computational_time': 0.8324120239703916}
2025-11-24 14:49:36,512 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 34, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763966976.512485, 'total_time': 44.439737820008304, 'aggregation': 2.7180067263543606e-06, 'network_info': 0.009731930971611291, 'llm_extraction': 43.36494343797676, 'data_cleaning': 2.1870015189051628e-05, 'neo4j_injection': 0.23091315297642723, 'embedding_time': 0, 'indexing_time': 0.003150921023916453, 'graph_injection_time': 0.2275714019779116, 'acs_metrics': {'node_count': 491, 'relationship_count': 1543, 'density': 0.0064, 'avg_degree': 6.2851, 'avg_unique_neighbors': 6.2403, 'global_efficiency': 0.3709, 'avg_path_length': 2.8408, 'avg_degree_centrality': 0.0128, 'max_degree_centrality': 0.5306, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0856, 'degree_assortativity': -0.1894, 'graph_robustness': 0.8432, 'diameter_estimate': 6, 'clustering_coefficient': 0.3167, 'weakly_connected_components': 9, 'largest_wcc_size': 483, 'pagerank_top10_percent': 6.83, 'louvain_communities': 22, 'louvain_modularity': 0.4601, 'label_entropy': 1.4615, 'computational_time': 0.8324120239703916}, 'retrieval_queries': []}
2025-11-24 14:49:36,512 - src.pipeline.kg_builder - DEBUG - Batch 34 metrics: {
  "batch_idx": 34,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763966976.512485,
  "total_time": 44.439737820008304,
  "aggregation": 2.7180067263543606e-06,
  "network_info": 0.009731930971611291,
  "llm_extraction": 43.36494343797676,
  "data_cleaning": 2.1870015189051628e-05,
  "neo4j_injection": 0.23091315297642723,
  "embedding_time": 0,
  "indexing_time": 0.003150921023916453,
  "graph_injection_time": 0.2275714019779116,
  "acs_metrics": {
    "node_count": 491,
    "relationship_count": 1543,
    "density": 0.0064,
    "avg_degree": 6.2851,
    "avg_unique_neighbors": 6.2403,
    "global_efficiency": 0.3709,
    "avg_path_length": 2.8408,
    "avg_degree_centrality": 0.0128,
    "max_degree_centrality": 0.5306,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.0856,
    "degree_assortativity": -0.1894,
    "graph_robustness": 0.8432,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.3167,
    "weakly_connected_components": 9,
    "largest_wcc_size": 483,
    "pagerank_top10_percent": 6.83,
    "louvain_communities": 22,
    "louvain_modularity": 0.4601,
    "label_entropy": 1.4615,
    "computational_time": 0.8324120239703916
  },
  "retrieval_queries": []
}
2025-11-24 14:49:36,514 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:49:36,514 - src.pipeline.kg_builder - INFO - Batch 35 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 43.36s, Clean: 0.00s, Neo4j: 0.23s, ACS: 0.83s
2025-11-24 14:49:36,514 - src.pipeline.kg_builder - INFO - Batch 35 completed in 44.44s
Processing KG batches:  49%|████▊     | 35/72 [21:34<25:23, 41.17s/it]2025-11-24 14:49:36,514 - src.pipeline.kg_builder - INFO - Processing batch 36/72 (3 items)
2025-11-24 14:49:36,514 - src.pipeline.kg_builder - DEBUG - Batch 36 current_video_time: 08:53-08:58
2025-11-24 14:49:36,523 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 491
- Total Relationships: 534
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:49:36,524 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:49:36,524 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0 ~235 words, content: Time: 08:43-08:48 Content: The video sequence captures a series of actions within a laboratory setting, focusing on a person conducting an experiment. The environment is...
2025-11-24 14:49:36,524 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1 ~240 words, content: - In the third frame, the person is seen adjusting a piece of equipment, possibly a pipette or a similar device, which is connected to...
2025-11-24 14:49:36,524 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2 ~249 words, content: scientific experiment. The scene begins with a close-up of a laboratory bench, where a person wearing blue gloves is handling a glass container. The bench...
2025-11-24 14:49:36,524 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3 ~233 words, content: video suggests a professional and organized laboratory setting, with a focus on scientific research and experimentation. In summary, the video depicts a laboratory scene where...
2025-11-24 14:49:36,524 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_4 ~119 words, content: The balance's digital display shows "0.0000 g", indicating it has been tared. The person then uses a metal spatula to transfer a white solid from...
2025-11-24 14:49:36,524 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:49:36,524 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0) (~235 words) with timeout=5.0s retries=3
2025-11-24 14:49:38,023 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:49:38,023 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:49:38,023 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1) (~240 words) with timeout=5.0s retries=3
2025-11-24 14:49:39,291 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:49:39,291 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:49:39,292 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2) (~249 words) with timeout=5.0s retries=3
2025-11-24 14:49:40,646 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:49:40,646 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:49:40,646 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3) (~233 words) with timeout=5.0s retries=3
2025-11-24 14:49:42,289 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:49:42,290 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:49:42,291 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_4) (~119 words) with timeout=5.0s retries=3
2025-11-24 14:49:46,946 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:49:46,946 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:49:46,946 - src.components.pre_llm_injector - INFO - Extracted 27 local triplets from 5 chunks
2025-11-24 14:49:46,946 - src.pipeline.kg_builder - INFO - Pre-extraction: 27 triplets in 10.42s
2025-11-24 14:49:46,946 - src.components.global_refiner - INFO - Capping refinement input: 27 → 25 triplets
2025-11-24 14:49:46,947 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 491
- Total Relationships: 534
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0"]}, {"head": "Person", "relation": "Handles", "tail": "Test Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0"]}, {"head": "Person", "relation": "Interacts With", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0"]}, {"head": "Magnetic Stirrer", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0"]}, {"head": "Person", "relation": "Adjusts", "tail": "Magnetic Stirrer Settings", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0"]}, {"head": "Person", "relation": "Adjusts", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1"]}, {"head": "Person", "relation": "Handles", "tail": "Glass Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2"]}, {"head": "Equipment", "relation": "Connected To", "tail": "Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1"]}, {"head": "Glass Container", "relation": "Contains", "tail": "Reagent", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1"]}, {"head": "Glass Container", "relation": "Is On", "tail": "Laboratory Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2"]}, {"head": "Person", "relation": "Stands Near", "tail": "Glass Cabinet", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2"]}, {"head": "Glass Cabinet", "relation": "Contains", "tail": "Laboratory Supplies", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2"]}, {"head": "Person", "relation": "Observes", "tail": "Experiment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2"]}, {"head": "Laboratory Bench", "relation": "Contains", "tail": "Analytical Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3"]}, {"head": "Laboratory Bench", "relation": "Contains", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3"]}, {"head": "Magnetic Stirrer", "relation": "Holds", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_4"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3"]}, {"head": "Pipette", "relation": "Interacts With", "tail": "Aluminum Foil", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3"]}, {"head": "Person", "relation": "Uses", "tail": "Metal Spatula", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_4"]}, {"head": "Metal Spatula", "relation": "Transfers", "tail": "White Solid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_4"]}, {"head": "White Solid", "relation": "Is Transferred To", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:49:46,947 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~353 words, ~459 tokens)
2025-11-24 14:49:46,947 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:50:26,225 - src.components.global_refiner - DEBUG - LLM call completed in 39.28s
2025-11-24 14:50:26,226 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0']], ['Person', 'handles', 'Test_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0']], ['Person', 'interacts_with', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0']], ['Magnetic_Stirrer', 'contains', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0']], ['Person', 'adjusts', 'Magnetic_Stirrer_Settings', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0']], ['Person', 'adjusts', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1']], ['Person', 'handles', 'Glass_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2']], ['Person', 'wears', 'Blue_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2']], ['Equipment', 'connected_to', 'Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1']], ['Glass_Container', 'contains', 'Reagent', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1']], ['Lab_Environment', 'contains', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1']], ['Glass_Container', 'is_on', 'Laboratory_Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2']], ['Person', 'stands_near', 'Glass_Cabinet', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2']], ['Glass_Cabinet', 'contains', 'Laboratory_Supplies', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2']], ['Person', 'observes', 'Experiment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2']], ['Laboratory_Bench', 'contains', 'Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3']], ['Laboratory_Bench', 'contains', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3']], ['Magnetic_Stirrer', 'holds', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3']], ['Person', 'wears', 'Blue_Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_4']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3']], ['Pipette', 'interacts_with', 'Aluminum_Foil', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3']], ['Person', 'uses', 'Metal_Spatula', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_4']], ['Metal_Spatula', 'transfers', 'White_Solid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_4']], ['White_Solid', 'is_transferred_to', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_4']]]
2025-11-24 14:50:26,226 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0"
    ]
  ],
  [
    "Person",
    "handles",
    "Test_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0"
    ]
  ],
  [
    "Person",
    "interacts_with",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "contains",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0"
    ]
  ],
  [
    "Person",
    "adjusts",
    "Magnetic_Stirrer_Settings",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_0"
    ]
  ],
  [
    "Person",
    "adjusts",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1"
    ]
  ],
  [
    "Person",
    "handles",
    "Glass_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2"
    ]
  ],
  [
    "Equipment",
    "connected_to",
    "Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1"
    ]
  ],
  [
    "Glass_Container",
    "contains",
    "Reagent",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1"
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_1"
    ]
  ],
  [
    "Glass_Container",
    "is_on",
    "Laboratory_Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2"
    ]
  ],
  [
    "Person",
    "stands_near",
    "Glass_Cabinet",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2"
    ]
  ],
  [
    "Glass_Cabinet",
    "contains",
    "Laboratory_Supplies",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2"
    ]
  ],
  [
    "Person",
    "observes",
    "Experiment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_2"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "holds",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_4"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3"
    ]
  ],
  [
    "Pipette",
    "interacts_with",
    "Aluminum_Foil",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Metal_Spatula",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_4"
    ]
  ],
  [
    "Metal_Spatula",
    "transfers",
    "White_Solid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_4"
    ]
  ],
  [
    "White_Solid",
    "is_transferred_to",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_35_4"
    ]
  ]
]
2025-11-24 14:50:26,226 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 39.28s, LLM: 39.28s)
2025-11-24 14:50:26,226 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 39.28s
2025-11-24 14:50:26,226 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:50:26,226 - src.pipeline.kg_builder - INFO - Pushing batch 36/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:50:26,227 - src.components.neo4j_handler - INFO - Adding 25 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:50:26,449 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:50:26,449 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:50:26,449 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:50:26,449 - src.components.neo4j_handler - INFO - Batch injected in 0.22s (triplets: 0.22s, indexes: 0.00s)
2025-11-24 14:50:26,449 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:50:26,509 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:50:26,840 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 493 nodes
2025-11-24 14:50:26,870 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 501, 'relationship_count': 1589, 'density': 0.0063, 'avg_degree': 6.3433, 'avg_unique_neighbors': 6.2914, 'global_efficiency': 0.3794, 'avg_path_length': 2.8334, 'avg_degree_centrality': 0.0127, 'max_degree_centrality': 0.536, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0558, 'degree_assortativity': -0.1886, 'graph_robustness': 0.8452, 'diameter_estimate': 50, 'clustering_coefficient': 0.3154, 'weakly_connected_components': 9, 'largest_wcc_size': 493, 'pagerank_top10_percent': 6.7, 'louvain_communities': 23, 'louvain_modularity': 0.4603, 'label_entropy': 1.463, 'computational_time': 0.42092484899330884}
2025-11-24 14:50:26,870 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 35, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967026.8707445, 'total_time': 50.356189996993635, 'aggregation': 5.527981556952e-06, 'network_info': 0.008849238976836205, 'llm_extraction': 49.703001106972806, 'data_cleaning': 5.0870992708951235e-05, 'neo4j_injection': 0.22275740298209712, 'embedding_time': 0, 'indexing_time': 0.0034316020319238305, 'graph_injection_time': 0.21901611000066623, 'acs_metrics': {'node_count': 501, 'relationship_count': 1589, 'density': 0.0063, 'avg_degree': 6.3433, 'avg_unique_neighbors': 6.2914, 'global_efficiency': 0.3794, 'avg_path_length': 2.8334, 'avg_degree_centrality': 0.0127, 'max_degree_centrality': 0.536, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0558, 'degree_assortativity': -0.1886, 'graph_robustness': 0.8452, 'diameter_estimate': 50, 'clustering_coefficient': 0.3154, 'weakly_connected_components': 9, 'largest_wcc_size': 493, 'pagerank_top10_percent': 6.7, 'louvain_communities': 23, 'louvain_modularity': 0.4603, 'label_entropy': 1.463, 'computational_time': 0.42092484899330884}, 'retrieval_queries': []}
2025-11-24 14:50:26,870 - src.pipeline.kg_builder - DEBUG - Batch 35 metrics: {
  "batch_idx": 35,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967026.8707445,
  "total_time": 50.356189996993635,
  "aggregation": 5.527981556952e-06,
  "network_info": 0.008849238976836205,
  "llm_extraction": 49.703001106972806,
  "data_cleaning": 5.0870992708951235e-05,
  "neo4j_injection": 0.22275740298209712,
  "embedding_time": 0,
  "indexing_time": 0.0034316020319238305,
  "graph_injection_time": 0.21901611000066623,
  "acs_metrics": {
    "node_count": 501,
    "relationship_count": 1589,
    "density": 0.0063,
    "avg_degree": 6.3433,
    "avg_unique_neighbors": 6.2914,
    "global_efficiency": 0.3794,
    "avg_path_length": 2.8334,
    "avg_degree_centrality": 0.0127,
    "max_degree_centrality": 0.536,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0558,
    "degree_assortativity": -0.1886,
    "graph_robustness": 0.8452,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3154,
    "weakly_connected_components": 9,
    "largest_wcc_size": 493,
    "pagerank_top10_percent": 6.7,
    "louvain_communities": 23,
    "louvain_modularity": 0.4603,
    "label_entropy": 1.463,
    "computational_time": 0.42092484899330884
  },
  "retrieval_queries": []
}
2025-11-24 14:50:26,872 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:50:26,872 - src.pipeline.kg_builder - INFO - Batch 36 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 49.70s, Clean: 0.00s, Neo4j: 0.22s, ACS: 0.42s
2025-11-24 14:50:26,872 - src.pipeline.kg_builder - INFO - Batch 36 completed in 50.36s
Processing KG batches:  50%|█████     | 36/72 [22:24<26:21, 43.93s/it]2025-11-24 14:50:26,872 - src.pipeline.kg_builder - INFO - Processing batch 37/72 (3 items)
2025-11-24 14:50:26,872 - src.pipeline.kg_builder - DEBUG - Batch 37 current_video_time: 09:08-09:13
2025-11-24 14:50:26,881 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 501
- Total Relationships: 550
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:50:26,882 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:50:26,882 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0 ~221 words, content: Time: 08:58-09:03 Content: The video sequence captures a detailed laboratory procedure, likely a chemical synthesis or analysis, performed by a scientist wearing blue nitrile gloves....
2025-11-24 14:50:26,882 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1 ~224 words, content: The presence of the magnetic stirrer in the background indicates that the contents of the flask will be mixed, likely to ensure homogeneity or to...
2025-11-24 14:50:26,882 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2 ~208 words, content: steady, while their right hand controls the vial, tilting it to pour the liquid. This action is being performed with great care to ensure an...
2025-11-24 14:50:26,882 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3 ~221 words, content: laboratory setting with a white door, a wall-mounted electrical panel with a high-voltage warning sign, and cardboard boxes. The overall environment suggests a controlled and...
2025-11-24 14:50:26,882 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4 ~69 words, content: process. The digital scale in the background displays a reading of "0.18," which could be the mass of a substance being weighed, possibly the reagent...
2025-11-24 14:50:26,882 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:50:26,882 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0) (~221 words) with timeout=5.0s retries=3
2025-11-24 14:50:28,184 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:50:28,184 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:50:28,184 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1) (~224 words) with timeout=5.0s retries=3
2025-11-24 14:50:29,267 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:50:29,267 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:50:29,267 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2) (~208 words) with timeout=5.0s retries=3
2025-11-24 14:50:30,477 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:50:30,477 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:50:30,478 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3) (~221 words) with timeout=5.0s retries=3
2025-11-24 14:50:31,535 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:50:31,535 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:50:31,536 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4) (~69 words) with timeout=5.0s retries=3
2025-11-24 14:50:32,473 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:50:32,473 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:50:32,474 - src.components.pre_llm_injector - INFO - Extracted 25 local triplets from 5 chunks
2025-11-24 14:50:32,474 - src.pipeline.kg_builder - INFO - Pre-extraction: 25 triplets in 5.59s
2025-11-24 14:50:32,474 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 501
- Total Relationships: 550
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Scientist", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0"]}, {"head": "Scientist", "relation": "Holds", "tail": "Glass Cylinder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0"]}, {"head": "Scientist", "relation": "Holds", "tail": "Round-Bottom Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0"]}, {"head": "Glass Cylinder", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0"]}, {"head": "Round-Bottom Flask", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0"]}, {"head": "Magnetic Stirrer", "relation": "Mixes", "tail": "Solution", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0"]}, {"head": "Scientist", "relation": "Holds", "tail": "Graduated Cylinder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1"]}, {"head": "Scientist", "relation": "Holds", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1"]}, {"head": "Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1"]}, {"head": "Burette", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4"]}, {"head": "Scientist", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1"]}, {"head": "Magnetic Stirrer", "relation": "Mixes", "tail": "Contents", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1"]}, {"head": "Person", "relation": "Holds", "tail": "Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2"]}, {"head": "Person", "relation": "Controls", "tail": "Burette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2"]}, {"head": "Balance", "relation": "Displays", "tail": "0.18_G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2"]}, {"head": "Glass Enclosure", "relation": "Contains", "tail": "Desiccator", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Glass Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3"]}, {"head": "Person", "relation": "Holds", "tail": "Burette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3"]}, {"head": "Digital Scale", "relation": "Displays", "tail": "Reading", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3"]}, {"head": "Person", "relation": "Performs", "tail": "Experiment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4"]}, {"head": "Environment", "relation": "Is", "tail": "Scientific", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4"]}, {"head": "Reading", "relation": "Represents", "tail": "Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:50:32,475 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~337 words, ~438 tokens)
2025-11-24 14:50:32,475 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:51:05,288 - src.components.global_refiner - DEBUG - LLM call completed in 32.81s
2025-11-24 14:51:05,288 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Scientist', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0']], ['Scientist', 'holds', 'Glass_Cylinder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0']], ['Scientist', 'holds', 'Round_Bottom_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0']], ['Glass_Cylinder', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0']], ['Round_Bottom_Flask', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0']], ['Magnetic_Stirrer', 'mixes', 'Solution', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0']], ['Scientist', 'holds', 'Graduated_Cylinder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1']], ['Scientist', 'holds', 'Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1']], ['Flask', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1']], ['Burette', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4']], ['Scientist', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1']], ['Magnetic_Stirrer', 'mixes', 'Contents', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1']], ['Person', 'holds', 'Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2']], ['Person', 'controls', 'Burette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2']], ['Balance', 'displays', '0.18_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2']], ['Glass_Enclosure', 'contains', 'Desiccator', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2']], ['Lab_Table', 'contains', 'Glass_Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3']], ['Person', 'holds', 'Burette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3']], ['Digital_Scale', 'displays', 'Reading', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4']], ['Laboratory', 'contains', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3']], ['Person', 'performs', 'Experiment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4']], ['Environment', 'is', 'Scientific', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4']], ['Reading', 'represents', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4']]]
2025-11-24 14:51:05,289 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Scientist",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0"
    ]
  ],
  [
    "Scientist",
    "holds",
    "Glass_Cylinder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0"
    ]
  ],
  [
    "Scientist",
    "holds",
    "Round_Bottom_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0"
    ]
  ],
  [
    "Glass_Cylinder",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0"
    ]
  ],
  [
    "Round_Bottom_Flask",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "mixes",
    "Solution",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_0"
    ]
  ],
  [
    "Scientist",
    "holds",
    "Graduated_Cylinder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1"
    ]
  ],
  [
    "Scientist",
    "holds",
    "Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1"
    ]
  ],
  [
    "Flask",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1"
    ]
  ],
  [
    "Burette",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4"
    ]
  ],
  [
    "Scientist",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "mixes",
    "Contents",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2"
    ]
  ],
  [
    "Person",
    "controls",
    "Burette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2"
    ]
  ],
  [
    "Balance",
    "displays",
    "0.18_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2"
    ]
  ],
  [
    "Glass_Enclosure",
    "contains",
    "Desiccator",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2"
    ]
  ],
  [
    "Lab_Table",
    "contains",
    "Glass_Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Burette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3"
    ]
  ],
  [
    "Digital_Scale",
    "displays",
    "Reading",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_3"
    ]
  ],
  [
    "Person",
    "performs",
    "Experiment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4"
    ]
  ],
  [
    "Environment",
    "is",
    "Scientific",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4"
    ]
  ],
  [
    "Reading",
    "represents",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_36_4"
    ]
  ]
]
2025-11-24 14:51:05,289 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 32.81s, LLM: 32.81s)
2025-11-24 14:51:05,289 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 32.81s
2025-11-24 14:51:05,289 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:51:05,289 - src.pipeline.kg_builder - INFO - Pushing batch 37/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:51:05,289 - src.components.neo4j_handler - INFO - Adding 25 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:51:05,568 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:51:05,568 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:51:05,568 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:51:05,568 - src.components.neo4j_handler - INFO - Batch injected in 0.28s (triplets: 0.28s, indexes: 0.00s)
2025-11-24 14:51:05,568 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:51:05,630 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:51:05,700 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 508
2025-11-24 14:51:05,731 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 516, 'relationship_count': 1647, 'density': 0.0062, 'avg_degree': 6.3837, 'avg_unique_neighbors': 6.3333, 'global_efficiency': 0.3744, 'avg_path_length': 2.8377, 'avg_degree_centrality': 0.0124, 'max_degree_centrality': 0.5282, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0578, 'degree_assortativity': -0.1852, 'graph_robustness': 0.6958, 'diameter_estimate': 50, 'clustering_coefficient': 0.3151, 'weakly_connected_components': 9, 'largest_wcc_size': 508, 'pagerank_top10_percent': 6.5, 'louvain_communities': 21, 'louvain_modularity': 0.446, 'label_entropy': 1.4629, 'computational_time': 0.16314808803144842}
2025-11-24 14:51:05,732 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 36, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967065.7321749, 'total_time': 38.859779722988605, 'aggregation': 2.844957634806633e-06, 'network_info': 0.009271009010262787, 'llm_extraction': 38.40750967897475, 'data_cleaning': 4.377000732347369e-05, 'neo4j_injection': 0.2793738949694671, 'embedding_time': 0, 'indexing_time': 0.003682220005430281, 'graph_injection_time': 0.2754180289921351, 'acs_metrics': {'node_count': 516, 'relationship_count': 1647, 'density': 0.0062, 'avg_degree': 6.3837, 'avg_unique_neighbors': 6.3333, 'global_efficiency': 0.3744, 'avg_path_length': 2.8377, 'avg_degree_centrality': 0.0124, 'max_degree_centrality': 0.5282, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0578, 'degree_assortativity': -0.1852, 'graph_robustness': 0.6958, 'diameter_estimate': 50, 'clustering_coefficient': 0.3151, 'weakly_connected_components': 9, 'largest_wcc_size': 508, 'pagerank_top10_percent': 6.5, 'louvain_communities': 21, 'louvain_modularity': 0.446, 'label_entropy': 1.4629, 'computational_time': 0.16314808803144842}, 'retrieval_queries': []}
2025-11-24 14:51:05,732 - src.pipeline.kg_builder - DEBUG - Batch 36 metrics: {
  "batch_idx": 36,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967065.7321749,
  "total_time": 38.859779722988605,
  "aggregation": 2.844957634806633e-06,
  "network_info": 0.009271009010262787,
  "llm_extraction": 38.40750967897475,
  "data_cleaning": 4.377000732347369e-05,
  "neo4j_injection": 0.2793738949694671,
  "embedding_time": 0,
  "indexing_time": 0.003682220005430281,
  "graph_injection_time": 0.2754180289921351,
  "acs_metrics": {
    "node_count": 516,
    "relationship_count": 1647,
    "density": 0.0062,
    "avg_degree": 6.3837,
    "avg_unique_neighbors": 6.3333,
    "global_efficiency": 0.3744,
    "avg_path_length": 2.8377,
    "avg_degree_centrality": 0.0124,
    "max_degree_centrality": 0.5282,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0578,
    "degree_assortativity": -0.1852,
    "graph_robustness": 0.6958,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3151,
    "weakly_connected_components": 9,
    "largest_wcc_size": 508,
    "pagerank_top10_percent": 6.5,
    "louvain_communities": 21,
    "louvain_modularity": 0.446,
    "label_entropy": 1.4629,
    "computational_time": 0.16314808803144842
  },
  "retrieval_queries": []
}
2025-11-24 14:51:05,733 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:51:05,733 - src.pipeline.kg_builder - INFO - Batch 37 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 38.41s, Clean: 0.00s, Neo4j: 0.28s, ACS: 0.16s
2025-11-24 14:51:05,733 - src.pipeline.kg_builder - INFO - Batch 37 completed in 38.86s
Processing KG batches:  51%|█████▏    | 37/72 [23:03<24:44, 42.41s/it]2025-11-24 14:51:05,733 - src.pipeline.kg_builder - INFO - Processing batch 38/72 (3 items)
2025-11-24 14:51:05,733 - src.pipeline.kg_builder - DEBUG - Batch 38 current_video_time: 09:23-09:28
2025-11-24 14:51:05,743 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 516
- Total Relationships: 569
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:51:05,744 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:51:05,744 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0 ~224 words, content: Time: 09:13-09:18 Content: The video sequence captures a detailed laboratory procedure, likely a chemical titration or solution preparation, performed by a person wearing blue nitrile...
2025-11-24 14:51:05,744 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1 ~231 words, content: step in the procedure is to weigh the cylinder to determine the exact mass of the liquid that was added. This is a critical step...
2025-11-24 14:51:05,744 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2 ~222 words, content: Mettler Toledo model, is visible on the left, with its display showing "0.000 g," suggesting it is used for weighing. To the right, a white...
2025-11-24 14:51:05,744 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3 ~225 words, content: **Initial Setup**: The person, wearing blue nitrile gloves, is handling laboratory glassware. Their left hand holds a tall, graduated cylinder, which contains a clear liquid....
2025-11-24 14:51:05,744 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4 ~46 words, content: In summary, the video shows a person in a laboratory setting, using a pipette to transfer a liquid from one container to another, likely as...
2025-11-24 14:51:05,744 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:51:05,744 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0) (~224 words) with timeout=5.0s retries=3
2025-11-24 14:51:07,101 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:51:07,101 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:51:07,102 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1) (~231 words) with timeout=5.0s retries=3
2025-11-24 14:51:08,191 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:51:08,191 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:51:08,191 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2) (~222 words) with timeout=5.0s retries=3
2025-11-24 14:51:09,789 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:51:09,789 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:51:09,789 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3) (~225 words) with timeout=5.0s retries=3
2025-11-24 14:51:11,183 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:51:11,183 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:51:11,183 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4) (~46 words) with timeout=5.0s retries=3
2025-11-24 14:51:12,143 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:51:12,143 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:51:12,143 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 5 chunks
2025-11-24 14:51:12,143 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 6.40s
2025-11-24 14:51:12,144 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 516
- Total Relationships: 569
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated Cylinder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0"]}, {"head": "Graduated Cylinder", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0"]}, {"head": "Person", "relation": "Places", "tail": "Graduated Cylinder On Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0"]}, {"head": "Balance", "relation": "Displays", "tail": "0.000 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1"]}, {"head": "Graduated Cylinder", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1"]}, {"head": "Mettler Toledo", "relation": "Is Visible On", "tail": "Left Side", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2"]}, {"head": "Mettler Toledo", "relation": "Displays", "tail": "0.000 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2"]}, {"head": "White Magnetic Stirrer", "relation": "Is In Use", "tail": "Right Side", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2"]}, {"head": "Glass Container", "relation": "Is On", "tail": "White Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated_Cylinder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3"]}, {"head": "Graduated_Cylinder", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4"]}, {"head": "Liquid", "relation": "Is Dispensed Into", "tail": "Round_Bottom_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3"]}, {"head": "Person", "relation": "Wears", "tail": "Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4"]}, {"head": "Liquid", "relation": "Moves From", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4"]}, {"head": "Liquid", "relation": "Moves To", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4"]}, {"head": "Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:51:12,144 - src.components.global_refiner - DEBUG - Refining 23 triplets (prompt ~337 words, ~438 tokens)
2025-11-24 14:51:12,144 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:51:42,946 - src.components.global_refiner - DEBUG - LLM call completed in 30.80s
2025-11-24 14:51:42,946 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3']], ['Person', 'holds', 'Graduated_Cylinder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3']], ['Person', 'holds', 'Glass_Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0']], ['Graduated_Cylinder', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3']], ['Person', 'places', 'Graduated_Cylinder_On_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0']], ['Balance', 'displays', '0.000_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4']], ['Person', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1']], ['Digital_Balance', 'measures', 'Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1']], ['Mettler_Toledo', 'is_visible_on', 'Left_Side', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2']], ['Mettler_Toledo', 'displays', '0.000_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2']], ['White_Magnetic_Stirrer', 'is_in_use', 'Right_Side', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2']], ['Glass_Container', 'is_on', 'White_Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2']], ['Person', 'wears', 'Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4']], ['Liquid', 'is_dispensed_into', 'Round_Bottom_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3']], ['Liquid', 'moves_from', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4']], ['Liquid', 'moves_to', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4']], ['Container', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4']]]
2025-11-24 14:51:42,946 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Graduated_Cylinder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0"
    ]
  ],
  [
    "Graduated_Cylinder",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3"
    ]
  ],
  [
    "Person",
    "places",
    "Graduated_Cylinder_On_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0"
    ]
  ],
  [
    "Balance",
    "displays",
    "0.000_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_1"
    ]
  ],
  [
    "Mettler_Toledo",
    "is_visible_on",
    "Left_Side",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2"
    ]
  ],
  [
    "Mettler_Toledo",
    "displays",
    "0.000_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2"
    ]
  ],
  [
    "White_Magnetic_Stirrer",
    "is_in_use",
    "Right_Side",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2"
    ]
  ],
  [
    "Glass_Container",
    "is_on",
    "White_Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4"
    ]
  ],
  [
    "Liquid",
    "is_dispensed_into",
    "Round_Bottom_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_3"
    ]
  ],
  [
    "Liquid",
    "moves_from",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4"
    ]
  ],
  [
    "Liquid",
    "moves_to",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4"
    ]
  ],
  [
    "Container",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_37_4"
    ]
  ]
]
2025-11-24 14:51:42,946 - src.components.global_refiner - INFO - Refinement complete: 23 → 19 triplets (total: 30.80s, LLM: 30.80s)
2025-11-24 14:51:42,946 - src.pipeline.kg_builder - INFO - Global refinement: 19 triplets in 30.80s
2025-11-24 14:51:42,947 - src.pipeline.kg_builder - INFO - Using 19 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:51:42,947 - src.pipeline.kg_builder - INFO - Pushing batch 38/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:51:42,947 - src.components.neo4j_handler - INFO - Adding 19 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:51:43,156 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:51:43,156 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:51:43,157 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:51:43,157 - src.components.neo4j_handler - INFO - Batch injected in 0.21s (triplets: 0.21s, indexes: 0.00s)
2025-11-24 14:51:43,157 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:51:43,218 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:51:43,347 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 518
2025-11-24 14:51:43,382 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 526, 'relationship_count': 1692, 'density': 0.0061, 'avg_degree': 6.4335, 'avg_unique_neighbors': 6.3802, 'global_efficiency': 0.3794, 'avg_path_length': 2.8762, 'avg_degree_centrality': 0.0123, 'max_degree_centrality': 0.5314, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0853, 'degree_assortativity': -0.1841, 'graph_robustness': 0.6974, 'diameter_estimate': 50, 'clustering_coefficient': 0.3139, 'weakly_connected_components': 9, 'largest_wcc_size': 518, 'pagerank_top10_percent': 6.38, 'louvain_communities': 23, 'louvain_modularity': 0.4587, 'label_entropy': 1.4643, 'computational_time': 0.22520725399954244}
2025-11-24 14:51:43,382 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 37, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967103.3825493, 'total_time': 37.64864923898131, 'aggregation': 2.642977051436901e-06, 'network_info': 0.009695735992863774, 'llm_extraction': 37.20327800500672, 'data_cleaning': 1.991301542147994e-05, 'neo4j_injection': 0.210008658003062, 'embedding_time': 0, 'indexing_time': 0.0025955489836633205, 'graph_injection_time': 0.207225896010641, 'acs_metrics': {'node_count': 526, 'relationship_count': 1692, 'density': 0.0061, 'avg_degree': 6.4335, 'avg_unique_neighbors': 6.3802, 'global_efficiency': 0.3794, 'avg_path_length': 2.8762, 'avg_degree_centrality': 0.0123, 'max_degree_centrality': 0.5314, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0853, 'degree_assortativity': -0.1841, 'graph_robustness': 0.6974, 'diameter_estimate': 50, 'clustering_coefficient': 0.3139, 'weakly_connected_components': 9, 'largest_wcc_size': 518, 'pagerank_top10_percent': 6.38, 'louvain_communities': 23, 'louvain_modularity': 0.4587, 'label_entropy': 1.4643, 'computational_time': 0.22520725399954244}, 'retrieval_queries': []}
2025-11-24 14:51:43,382 - src.pipeline.kg_builder - DEBUG - Batch 37 metrics: {
  "batch_idx": 37,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967103.3825493,
  "total_time": 37.64864923898131,
  "aggregation": 2.642977051436901e-06,
  "network_info": 0.009695735992863774,
  "llm_extraction": 37.20327800500672,
  "data_cleaning": 1.991301542147994e-05,
  "neo4j_injection": 0.210008658003062,
  "embedding_time": 0,
  "indexing_time": 0.0025955489836633205,
  "graph_injection_time": 0.207225896010641,
  "acs_metrics": {
    "node_count": 526,
    "relationship_count": 1692,
    "density": 0.0061,
    "avg_degree": 6.4335,
    "avg_unique_neighbors": 6.3802,
    "global_efficiency": 0.3794,
    "avg_path_length": 2.8762,
    "avg_degree_centrality": 0.0123,
    "max_degree_centrality": 0.5314,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.0853,
    "degree_assortativity": -0.1841,
    "graph_robustness": 0.6974,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3139,
    "weakly_connected_components": 9,
    "largest_wcc_size": 518,
    "pagerank_top10_percent": 6.38,
    "louvain_communities": 23,
    "louvain_modularity": 0.4587,
    "label_entropy": 1.4643,
    "computational_time": 0.22520725399954244
  },
  "retrieval_queries": []
}
2025-11-24 14:51:43,383 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:51:43,383 - src.pipeline.kg_builder - INFO - Batch 38 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 37.20s, Clean: 0.00s, Neo4j: 0.21s, ACS: 0.23s
2025-11-24 14:51:43,383 - src.pipeline.kg_builder - INFO - Batch 38 completed in 37.65s
Processing KG batches:  53%|█████▎    | 38/72 [23:41<23:13, 40.98s/it]2025-11-24 14:51:43,383 - src.pipeline.kg_builder - INFO - Processing batch 39/72 (3 items)
2025-11-24 14:51:43,383 - src.pipeline.kg_builder - DEBUG - Batch 39 current_video_time: 09:38-09:43
2025-11-24 14:51:43,387 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 526
- Total Relationships: 582
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:51:43,388 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:51:43,388 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0 ~217 words, content: Time: 09:28-09:33 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a precise liquid transfer, performed by a scientist. The scene...
2025-11-24 14:51:43,388 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1 ~236 words, content: used for weighing. - **Final Adjustment (Frame 3):** The person has now lifted the graduated cylinder, holding it up for a final inspection. The liquid...
2025-11-24 14:51:43,388 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2 ~239 words, content: is conducted with care and precision, which is essential in a laboratory setting. The person is likely preparing a solution of a specific concentration, a...
2025-11-24 14:51:43,388 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3 ~232 words, content: person is wearing a blue glove on their right hand and a black glove on their left hand. The video ends with the person still...
2025-11-24 14:51:43,388 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4 ~123 words, content: critical to the experiment's outcome. - **Progression of the Procedure:** The person continues to add the clear liquid from the pipette into the volumetric flask....
2025-11-24 14:51:43,388 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:51:43,388 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0) (~217 words) with timeout=5.0s retries=3
2025-11-24 14:51:44,895 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:51:44,895 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:51:44,895 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1) (~236 words) with timeout=5.0s retries=3
2025-11-24 14:51:45,967 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:51:45,967 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:51:45,967 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2) (~239 words) with timeout=5.0s retries=3
2025-11-24 14:51:47,256 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:51:47,256 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:51:47,256 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3) (~232 words) with timeout=5.0s retries=3
2025-11-24 14:51:48,471 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:51:48,472 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:51:48,472 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4) (~123 words) with timeout=5.0s retries=3
2025-11-24 14:51:49,691 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:51:49,691 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:51:49,691 - src.components.pre_llm_injector - INFO - Extracted 26 local triplets from 5 chunks
2025-11-24 14:51:49,691 - src.pipeline.kg_builder - INFO - Pre-extraction: 26 triplets in 6.30s
2025-11-24 14:51:49,692 - src.components.global_refiner - INFO - Capping refinement input: 26 → 25 triplets
2025-11-24 14:51:49,693 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 526
- Total Relationships: 582
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated_Cylinder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2"]}, {"head": "Glass_Pipette", "relation": "Transfers Liquid To", "tail": "Graduated_Cylinder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0"]}, {"head": "Graduated_Cylinder", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2"]}, {"head": "Person", "relation": "Uses", "tail": "Digital_Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated Cylinder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2"]}, {"head": "Graduated Cylinder", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1"]}, {"head": "Person", "relation": "Observes", "tail": "Liquid Level", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Glass_Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3"]}, {"head": "Person", "relation": "Wears", "tail": "Black_Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3"]}, {"head": "Person", "relation": "Holds", "tail": "Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3"]}, {"head": "Person", "relation": "Uses", "tail": "Volumetric_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3"]}, {"head": "Volumetric_Flask", "relation": "Is On", "tail": "Electronic_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3"]}, {"head": "Person", "relation": "Adds", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4"]}, {"head": "Clear Liquid", "relation": "Enters", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4"]}, {"head": "Person", "relation": "Places", "tail": "Stopper", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4"]}, {"head": "Stopper", "relation": "Seals", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4"]}, {"head": "Volumetric Flask", "relation": "Contains", "tail": "Reagent", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:51:49,693 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~334 words, ~434 tokens)
2025-11-24 14:51:49,693 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:52:22,804 - src.components.global_refiner - DEBUG - LLM call completed in 33.11s
2025-11-24 14:52:22,804 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2']], ['Person', 'holds', 'Glass_Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0']], ['Person', 'holds', 'Graduated_Cylinder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2']], ['Glass_Pipette', 'transfers_liquid_to', 'Graduated_Cylinder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0']], ['Graduated_Cylinder', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2']], ['Person', 'uses', 'Digital_Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0']], ['Person', 'holds', 'Graduated_Cylinder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2']], ['Graduated_Cylinder', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1']], ['Person', 'observes', 'Liquid_Level', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1']], ['Lab_Bench', 'contains', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1']], ['Lab_Bench', 'contains', 'Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1']], ['Person', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2']], ['Liquid', 'is_transferred_to', 'Glass_Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2']], ['Person', 'wears', 'Blue_Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3']], ['Person', 'wears', 'Black_Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3']], ['Person', 'holds', 'Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3']], ['Person', 'uses', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3']], ['Volumetric_Flask', 'is_on', 'Electronic_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3']], ['Person', 'adds', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4']], ['Clear_Liquid', 'enters', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4']], ['Person', 'places', 'Stopper', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4']], ['Stopper', 'seals', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4']], ['Volumetric_Flask', 'contains', 'Reagent', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4']]]
2025-11-24 14:52:22,804 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Graduated_Cylinder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2"
    ]
  ],
  [
    "Glass_Pipette",
    "transfers_liquid_to",
    "Graduated_Cylinder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0"
    ]
  ],
  [
    "Graduated_Cylinder",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Digital_Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Graduated_Cylinder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2"
    ]
  ],
  [
    "Graduated_Cylinder",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1"
    ]
  ],
  [
    "Person",
    "observes",
    "Liquid_Level",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_1"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2"
    ]
  ],
  [
    "Liquid",
    "is_transferred_to",
    "Glass_Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Black_Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3"
    ]
  ],
  [
    "Volumetric_Flask",
    "is_on",
    "Electronic_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_3"
    ]
  ],
  [
    "Person",
    "adds",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4"
    ]
  ],
  [
    "Clear_Liquid",
    "enters",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4"
    ]
  ],
  [
    "Person",
    "places",
    "Stopper",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4"
    ]
  ],
  [
    "Stopper",
    "seals",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Reagent",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_38_4"
    ]
  ]
]
2025-11-24 14:52:22,805 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 33.11s, LLM: 33.11s)
2025-11-24 14:52:22,805 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 33.11s
2025-11-24 14:52:22,805 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:52:22,805 - src.pipeline.kg_builder - INFO - Pushing batch 39/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:52:22,805 - src.components.neo4j_handler - INFO - Adding 24 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:52:22,998 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:52:22,998 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:52:22,999 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:52:22,999 - src.components.neo4j_handler - INFO - Batch injected in 0.19s (triplets: 0.19s, indexes: 0.00s)
2025-11-24 14:52:22,999 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:52:23,063 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:52:23,142 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 524
2025-11-24 14:52:23,177 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 532, 'relationship_count': 1735, 'density': 0.0061, 'avg_degree': 6.5226, 'avg_unique_neighbors': 6.4662, 'global_efficiency': 0.3805, 'avg_path_length': 2.8587, 'avg_degree_centrality': 0.0123, 'max_degree_centrality': 0.5405, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0705, 'degree_assortativity': -0.1794, 'graph_robustness': 0.6986, 'diameter_estimate': 50, 'clustering_coefficient': 0.3148, 'weakly_connected_components': 9, 'largest_wcc_size': 524, 'pagerank_top10_percent': 6.33, 'louvain_communities': 22, 'louvain_modularity': 0.4542, 'label_entropy': 1.4669, 'computational_time': 0.17837939696619287}
2025-11-24 14:52:23,177 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 38, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967143.1778722, 'total_time': 39.7942465619999, 'aggregation': 2.7850037440657616e-06, 'network_info': 0.004050365008879453, 'llm_extraction': 39.41735131299356, 'data_cleaning': 3.8833997678011656e-05, 'neo4j_injection': 0.19394115498289466, 'embedding_time': 0, 'indexing_time': 0.0023818190093152225, 'graph_injection_time': 0.1913090479793027, 'acs_metrics': {'node_count': 532, 'relationship_count': 1735, 'density': 0.0061, 'avg_degree': 6.5226, 'avg_unique_neighbors': 6.4662, 'global_efficiency': 0.3805, 'avg_path_length': 2.8587, 'avg_degree_centrality': 0.0123, 'max_degree_centrality': 0.5405, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0705, 'degree_assortativity': -0.1794, 'graph_robustness': 0.6986, 'diameter_estimate': 50, 'clustering_coefficient': 0.3148, 'weakly_connected_components': 9, 'largest_wcc_size': 524, 'pagerank_top10_percent': 6.33, 'louvain_communities': 22, 'louvain_modularity': 0.4542, 'label_entropy': 1.4669, 'computational_time': 0.17837939696619287}, 'retrieval_queries': []}
2025-11-24 14:52:23,177 - src.pipeline.kg_builder - DEBUG - Batch 38 metrics: {
  "batch_idx": 38,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967143.1778722,
  "total_time": 39.7942465619999,
  "aggregation": 2.7850037440657616e-06,
  "network_info": 0.004050365008879453,
  "llm_extraction": 39.41735131299356,
  "data_cleaning": 3.8833997678011656e-05,
  "neo4j_injection": 0.19394115498289466,
  "embedding_time": 0,
  "indexing_time": 0.0023818190093152225,
  "graph_injection_time": 0.1913090479793027,
  "acs_metrics": {
    "node_count": 532,
    "relationship_count": 1735,
    "density": 0.0061,
    "avg_degree": 6.5226,
    "avg_unique_neighbors": 6.4662,
    "global_efficiency": 0.3805,
    "avg_path_length": 2.8587,
    "avg_degree_centrality": 0.0123,
    "max_degree_centrality": 0.5405,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0705,
    "degree_assortativity": -0.1794,
    "graph_robustness": 0.6986,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3148,
    "weakly_connected_components": 9,
    "largest_wcc_size": 524,
    "pagerank_top10_percent": 6.33,
    "louvain_communities": 22,
    "louvain_modularity": 0.4542,
    "label_entropy": 1.4669,
    "computational_time": 0.17837939696619287
  },
  "retrieval_queries": []
}
2025-11-24 14:52:23,178 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:52:23,178 - src.pipeline.kg_builder - INFO - Batch 39 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 39.42s, Clean: 0.00s, Neo4j: 0.19s, ACS: 0.18s
2025-11-24 14:52:23,178 - src.pipeline.kg_builder - INFO - Batch 39 completed in 39.79s
Processing KG batches:  54%|█████▍    | 39/72 [24:20<22:20, 40.62s/it]2025-11-24 14:52:23,178 - src.pipeline.kg_builder - INFO - Processing batch 40/72 (3 items)
2025-11-24 14:52:23,178 - src.pipeline.kg_builder - DEBUG - Batch 40 current_video_time: 09:53-09:58
2025-11-24 14:52:23,184 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 532
- Total Relationships: 594
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:52:23,184 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 14:52:23,184 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0 ~222 words, content: Time: 09:43-09:48 Content: The video sequence captures a detailed laboratory procedure, likely the preparation of a chemical solution, from a first-person perspective. The scene is...
2025-11-24 14:52:23,184 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1 ~235 words, content: **Final Transfer:** In the final frames, the person is again seen pouring a liquid from a small test tube into the larger flask. This action...
2025-11-24 14:52:23,184 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2 ~225 words, content: contributing to the context of a scientific experiment. The overall action is one of meticulous measurement and preparation. Time: 09:53-09:58 Content: The video sequence captures...
2025-11-24 14:52:23,184 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3 ~227 words, content: . - **Frame 3:** The person has placed the volumetric flask back on the balance. The display now shows a non-zero value, indicating that the...
2025-11-24 14:52:23,184 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:52:23,185 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0) (~222 words) with timeout=5.0s retries=3
2025-11-24 14:52:24,640 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:52:24,640 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:52:24,640 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1) (~235 words) with timeout=5.0s retries=3
2025-11-24 14:52:25,944 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:52:25,944 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:52:25,944 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2) (~225 words) with timeout=5.0s retries=3
2025-11-24 14:52:27,548 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:52:27,548 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:52:27,548 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3) (~227 words) with timeout=5.0s retries=3
2025-11-24 14:52:28,695 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:52:28,695 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:52:28,696 - src.components.pre_llm_injector - INFO - Extracted 21 local triplets from 4 chunks
2025-11-24 14:52:28,696 - src.pipeline.kg_builder - INFO - Pre-extraction: 21 triplets in 5.51s
2025-11-24 14:52:28,696 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 532
- Total Relationships: 594
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2"]}, {"head": "Person", "relation": "Holds", "tail": "Test_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0"]}, {"head": "Test_Tube", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0"]}, {"head": "Person", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "0.0000_G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0"]}, {"head": "Person", "relation": "Uses", "tail": "Digital_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2"]}, {"head": "Glass_Pipette", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1"]}, {"head": "Digital_Balance", "relation": "Is On", "tail": "Lab_Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Digital_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Volumetric_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2"]}, {"head": "Volumetric_Flask", "relation": "Is Placed On", "tail": "Precision_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2"]}, {"head": "Precision_Balance", "relation": "Displays", "tail": "0.000_G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3"]}, {"head": "Person", "relation": "Holds", "tail": "Test Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3"]}, {"head": "Person", "relation": "Uses", "tail": "Precision Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3"]}, {"head": "Volumetric Flask", "relation": "Is On", "tail": "Precision Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3"]}, {"head": "Precision Balance", "relation": "Displays", "tail": "Mass Value", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:52:28,696 - src.components.global_refiner - DEBUG - Refining 21 triplets (prompt ~299 words, ~389 tokens)
2025-11-24 14:52:28,696 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:52:56,091 - src.components.global_refiner - DEBUG - LLM call completed in 27.40s
2025-11-24 14:52:56,092 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2']], ['Person', 'holds', 'Test_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0']], ['Test_Tube', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0']], ['Person', 'transfers', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0']], ['Digital_Balance', 'displays', '0.0000_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0']], ['Person', 'uses', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0']], ['Person', 'holds', 'Glass_Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1']], ['Glass_Pipette', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1']], ['Person', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2']], ['Digital_Balance', 'is_on', 'Lab_Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1']], ['Lab_Bench', 'contains', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2']], ['Liquid', 'is_transferred_to', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2']], ['Volumetric_Flask', 'is_on', 'Precision_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2']], ['Precision_Balance', 'displays', '0.000_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2']], ['Person', 'holds', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3']], ['Person', 'holds', 'Test_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3']], ['Person', 'uses', 'Precision_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3']], ['Volumetric_Flask', 'is_on', 'Precision_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3']], ['Person', 'wears', 'Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3']], ['Precision_Balance', 'displays', 'Mass_Value', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3']]]
2025-11-24 14:52:56,092 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Test_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0"
    ]
  ],
  [
    "Test_Tube",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0"
    ]
  ],
  [
    "Person",
    "transfers",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "0.0000_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1"
    ]
  ],
  [
    "Glass_Pipette",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2"
    ]
  ],
  [
    "Digital_Balance",
    "is_on",
    "Lab_Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2"
    ]
  ],
  [
    "Liquid",
    "is_transferred_to",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2"
    ]
  ],
  [
    "Volumetric_Flask",
    "is_on",
    "Precision_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2"
    ]
  ],
  [
    "Precision_Balance",
    "displays",
    "0.000_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Test_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Precision_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3"
    ]
  ],
  [
    "Volumetric_Flask",
    "is_on",
    "Precision_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3"
    ]
  ],
  [
    "Precision_Balance",
    "displays",
    "Mass_Value",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_39_3"
    ]
  ]
]
2025-11-24 14:52:56,092 - src.components.global_refiner - INFO - Refinement complete: 21 → 21 triplets (total: 27.40s, LLM: 27.40s)
2025-11-24 14:52:56,092 - src.pipeline.kg_builder - INFO - Global refinement: 21 triplets in 27.40s
2025-11-24 14:52:56,092 - src.pipeline.kg_builder - INFO - Using 21 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:52:56,092 - src.pipeline.kg_builder - INFO - Pushing batch 40/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:52:56,092 - src.components.neo4j_handler - INFO - Adding 19 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:52:56,533 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:52:56,534 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:52:56,534 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:52:56,534 - src.components.neo4j_handler - INFO - Batch injected in 0.44s (triplets: 0.41s, indexes: 0.03s)
2025-11-24 14:52:56,535 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:52:56,603 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:52:56,677 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 529
2025-11-24 14:52:56,712 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 537, 'relationship_count': 1764, 'density': 0.0061, 'avg_degree': 6.5698, 'avg_unique_neighbors': 6.5102, 'global_efficiency': 0.381, 'avg_path_length': 2.8561, 'avg_degree_centrality': 0.0123, 'max_degree_centrality': 0.5429, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0749, 'degree_assortativity': -0.1766, 'graph_robustness': 0.6984, 'diameter_estimate': 50, 'clustering_coefficient': 0.3139, 'weakly_connected_components': 9, 'largest_wcc_size': 529, 'pagerank_top10_percent': 6.28, 'louvain_communities': 23, 'louvain_modularity': 0.4343, 'label_entropy': 1.4687, 'computational_time': 0.17702398798428476}
2025-11-24 14:52:56,712 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 39, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967176.7122736, 'total_time': 33.53330527001526, 'aggregation': 3.0939700081944466e-06, 'network_info': 0.005209177965298295, 'llm_extraction': 32.9079187749885, 'data_cleaning': 1.575000351294875e-05, 'neo4j_injection': 0.4427110590040684, 'embedding_time': 0, 'indexing_time': 0.02757446898613125, 'graph_injection_time': 0.4149261290440336, 'acs_metrics': {'node_count': 537, 'relationship_count': 1764, 'density': 0.0061, 'avg_degree': 6.5698, 'avg_unique_neighbors': 6.5102, 'global_efficiency': 0.381, 'avg_path_length': 2.8561, 'avg_degree_centrality': 0.0123, 'max_degree_centrality': 0.5429, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0749, 'degree_assortativity': -0.1766, 'graph_robustness': 0.6984, 'diameter_estimate': 50, 'clustering_coefficient': 0.3139, 'weakly_connected_components': 9, 'largest_wcc_size': 529, 'pagerank_top10_percent': 6.28, 'louvain_communities': 23, 'louvain_modularity': 0.4343, 'label_entropy': 1.4687, 'computational_time': 0.17702398798428476}, 'retrieval_queries': []}
2025-11-24 14:52:56,712 - src.pipeline.kg_builder - DEBUG - Batch 39 metrics: {
  "batch_idx": 39,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967176.7122736,
  "total_time": 33.53330527001526,
  "aggregation": 3.0939700081944466e-06,
  "network_info": 0.005209177965298295,
  "llm_extraction": 32.9079187749885,
  "data_cleaning": 1.575000351294875e-05,
  "neo4j_injection": 0.4427110590040684,
  "embedding_time": 0,
  "indexing_time": 0.02757446898613125,
  "graph_injection_time": 0.4149261290440336,
  "acs_metrics": {
    "node_count": 537,
    "relationship_count": 1764,
    "density": 0.0061,
    "avg_degree": 6.5698,
    "avg_unique_neighbors": 6.5102,
    "global_efficiency": 0.381,
    "avg_path_length": 2.8561,
    "avg_degree_centrality": 0.0123,
    "max_degree_centrality": 0.5429,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0749,
    "degree_assortativity": -0.1766,
    "graph_robustness": 0.6984,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3139,
    "weakly_connected_components": 9,
    "largest_wcc_size": 529,
    "pagerank_top10_percent": 6.28,
    "louvain_communities": 23,
    "louvain_modularity": 0.4343,
    "label_entropy": 1.4687,
    "computational_time": 0.17702398798428476
  },
  "retrieval_queries": []
}
2025-11-24 14:52:56,713 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:52:56,713 - src.pipeline.kg_builder - INFO - Batch 40 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 32.91s, Clean: 0.00s, Neo4j: 0.44s, ACS: 0.18s
2025-11-24 14:52:56,713 - src.pipeline.kg_builder - INFO - Batch 40 completed in 33.53s
Processing KG batches:  56%|█████▌    | 40/72 [24:54<20:31, 38.50s/it]2025-11-24 14:52:56,713 - src.pipeline.kg_builder - INFO - Processing batch 41/72 (3 items)
2025-11-24 14:52:56,713 - src.pipeline.kg_builder - DEBUG - Batch 41 current_video_time: 10:08-10:13
2025-11-24 14:52:56,718 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 537
- Total Relationships: 601
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:52:56,719 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:52:56,719 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0 ~209 words, content: Time: 09:58-10:03 Content: The video sequence captures a detailed laboratory procedure, likely a chemical titration or solution preparation, from a first-person perspective. The scene is...
2025-11-24 14:52:56,719 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1 ~224 words, content: , which is a METTLER TOLEDO model, is visible in the background, indicating that the procedure may involve weighing the liquid to ensure accuracy. The...
2025-11-24 14:52:56,719 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2 ~233 words, content: tte, filled with a clear liquid. The person is carefully adjusting the liquid level in the burette, a common step in titration experiments to ensure...
2025-11-24 14:52:56,719 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3 ~207 words, content: of precision and accuracy in laboratory work. In summary, the video shows a person preparing a solution for a titration experiment. They carefully adjust the...
2025-11-24 14:52:56,719 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4 ~170 words, content: markings. - **Pipette:** Used to transfer a precise volume of liquid from the flask to the burette. - **Round-Bottom Flask:** Contains a clear liquid and...
2025-11-24 14:52:56,719 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:52:56,719 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0) (~209 words) with timeout=5.0s retries=3
2025-11-24 14:52:57,903 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:52:57,903 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:52:57,903 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1) (~224 words) with timeout=5.0s retries=3
2025-11-24 14:52:59,001 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:52:59,001 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:52:59,001 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2) (~233 words) with timeout=5.0s retries=3
2025-11-24 14:53:00,175 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:53:00,175 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:53:00,176 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3) (~207 words) with timeout=5.0s retries=3
2025-11-24 14:53:01,219 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:53:01,219 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:53:01,219 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4) (~170 words) with timeout=5.0s retries=3
2025-11-24 14:53:02,830 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:53:02,830 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:53:02,830 - src.components.pre_llm_injector - INFO - Extracted 25 local triplets from 5 chunks
2025-11-24 14:53:02,830 - src.pipeline.kg_builder - INFO - Pre-extraction: 25 triplets in 6.11s
2025-11-24 14:53:02,830 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 537
- Total Relationships: 601
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3"]}, {"head": "Person", "relation": "Holds", "tail": "Burette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0"]}, {"head": "Burette", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3"]}, {"head": "Volumetric Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0"]}, {"head": "Digital Balance", "relation": "Is In Background", "tail": "Laboratory", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0"]}, {"head": "Person", "relation": "Wears", "tail": "Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1"]}, {"head": "Person", "relation": "Handles", "tail": "Burette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1"]}, {"head": "Digital Balance", "relation": "Is Visible In", "tail": "Background", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1"]}, {"head": "Person", "relation": "Uses", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1"]}, {"head": "Lab Environment", "relation": "Emphasizes", "tail": "Accuracy And Safety", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1"]}, {"head": "Person", "relation": "Adjusts", "tail": "Burette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2"]}, {"head": "Burette", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2"]}, {"head": "Liquid", "relation": "Is Transferred Via", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2"]}, {"head": "Pipette", "relation": "Is Used To", "tail": "Transfer Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2"]}, {"head": "Burette", "relation": "Has", "tail": "Correct Liquid Level", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4"]}, {"head": "Lab", "relation": "Contains", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3"]}, {"head": "Round-Bottom Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4"]}, {"head": "Round-Bottom Flask", "relation": "Rests On", "tail": "Magnetic Stirrer/Hot Plate", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4"]}, {"head": "Magnetic Stirrer/Hot Plate", "relation": "Is Used For", "tail": "Stirring_Or_Heating", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Digital Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Bottle_With_Red_Cap", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:53:02,830 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~354 words, ~460 tokens)
2025-11-24 14:53:02,831 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:53:37,167 - src.components.global_refiner - DEBUG - LLM call completed in 34.34s
2025-11-24 14:53:37,167 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3']], ['Person', 'holds', 'Burette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3']], ['Person', 'holds', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0']], ['Burette', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3']], ['Volumetric_Flask', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0']], ['Digital_Balance', 'is_in_background', 'Laboratory', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0']], ['Person', 'wears', 'Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1']], ['Person', 'handles', 'Burette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1']], ['Digital_Balance', 'is_visible_in', 'Background', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1']], ['Person', 'uses', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1']], ['Lab_Environment', 'emphasizes', 'Accuracy_And_Safety', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1']], ['Person', 'adjusts', 'Burette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2']], ['Burette', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2']], ['Person', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2']], ['Liquid', 'is_transferred_via', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2']], ['Pipette', 'is_used_to', 'Transfer_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2']], ['Burette', 'has', 'Correct_Liquid_Level', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4']], ['Lab', 'contains', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3']], ['Round_Bottom_Flask', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4']], ['Round_Bottom_Flask', 'rests_on', 'Magnetic_Stirrer/Hot_Plate', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4']], ['Magnetic_Stirrer/Hot_Plate', 'is_used_for', 'Stirring_Or_Heating', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4']], ['Lab_Bench', 'contains', 'Digital_Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4']], ['Lab_Bench', 'contains', 'Bottle_With_Red_Cap', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4']]]
2025-11-24 14:53:37,167 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Burette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0"
    ]
  ],
  [
    "Burette",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3"
    ]
  ],
  [
    "Volumetric_Flask",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0"
    ]
  ],
  [
    "Digital_Balance",
    "is_in_background",
    "Laboratory",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1"
    ]
  ],
  [
    "Person",
    "handles",
    "Burette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1"
    ]
  ],
  [
    "Digital_Balance",
    "is_visible_in",
    "Background",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1"
    ]
  ],
  [
    "Lab_Environment",
    "emphasizes",
    "Accuracy_And_Safety",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_1"
    ]
  ],
  [
    "Person",
    "adjusts",
    "Burette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2"
    ]
  ],
  [
    "Burette",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2"
    ]
  ],
  [
    "Liquid",
    "is_transferred_via",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2"
    ]
  ],
  [
    "Pipette",
    "is_used_to",
    "Transfer_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2"
    ]
  ],
  [
    "Burette",
    "has",
    "Correct_Liquid_Level",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_2"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4"
    ]
  ],
  [
    "Lab",
    "contains",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_3"
    ]
  ],
  [
    "Round_Bottom_Flask",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4"
    ]
  ],
  [
    "Round_Bottom_Flask",
    "rests_on",
    "Magnetic_Stirrer/Hot_Plate",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4"
    ]
  ],
  [
    "Magnetic_Stirrer/Hot_Plate",
    "is_used_for",
    "Stirring_Or_Heating",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Digital_Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Bottle_With_Red_Cap",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_40_4"
    ]
  ]
]
2025-11-24 14:53:37,167 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 34.34s, LLM: 34.34s)
2025-11-24 14:53:37,167 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 34.34s
2025-11-24 14:53:37,168 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:53:37,168 - src.pipeline.kg_builder - INFO - Pushing batch 41/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:53:37,168 - src.components.neo4j_handler - INFO - Adding 25 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:53:37,686 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:53:37,687 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:53:37,687 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:53:37,687 - src.components.neo4j_handler - INFO - Batch injected in 0.52s (triplets: 0.51s, indexes: 0.00s)
2025-11-24 14:53:37,687 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:53:37,753 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:53:37,830 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 539
2025-11-24 14:53:37,867 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 547, 'relationship_count': 1814, 'density': 0.0061, 'avg_degree': 6.6325, 'avg_unique_neighbors': 6.5667, 'global_efficiency': 0.3819, 'avg_path_length': 2.8539, 'avg_degree_centrality': 0.0121, 'max_degree_centrality': 0.5403, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0717, 'degree_assortativity': -0.1705, 'graph_robustness': 0.6996, 'diameter_estimate': 50, 'clustering_coefficient': 0.3155, 'weakly_connected_components': 9, 'largest_wcc_size': 539, 'pagerank_top10_percent': 6.17, 'louvain_communities': 21, 'louvain_modularity': 0.4454, 'label_entropy': 1.4699, 'computational_time': 0.17966373701347038}
2025-11-24 14:53:37,867 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 40, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967217.8672645, 'total_time': 41.15389410802163, 'aggregation': 2.569984644651413e-06, 'network_info': 0.00541660696035251, 'llm_extraction': 40.44905364600709, 'data_cleaning': 2.026703441515565e-05, 'neo4j_injection': 0.5192734519951046, 'embedding_time': 0, 'indexing_time': 0.004994685994461179, 'graph_injection_time': 0.5141048840014264, 'acs_metrics': {'node_count': 547, 'relationship_count': 1814, 'density': 0.0061, 'avg_degree': 6.6325, 'avg_unique_neighbors': 6.5667, 'global_efficiency': 0.3819, 'avg_path_length': 2.8539, 'avg_degree_centrality': 0.0121, 'max_degree_centrality': 0.5403, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0717, 'degree_assortativity': -0.1705, 'graph_robustness': 0.6996, 'diameter_estimate': 50, 'clustering_coefficient': 0.3155, 'weakly_connected_components': 9, 'largest_wcc_size': 539, 'pagerank_top10_percent': 6.17, 'louvain_communities': 21, 'louvain_modularity': 0.4454, 'label_entropy': 1.4699, 'computational_time': 0.17966373701347038}, 'retrieval_queries': []}
2025-11-24 14:53:37,867 - src.pipeline.kg_builder - DEBUG - Batch 40 metrics: {
  "batch_idx": 40,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967217.8672645,
  "total_time": 41.15389410802163,
  "aggregation": 2.569984644651413e-06,
  "network_info": 0.00541660696035251,
  "llm_extraction": 40.44905364600709,
  "data_cleaning": 2.026703441515565e-05,
  "neo4j_injection": 0.5192734519951046,
  "embedding_time": 0,
  "indexing_time": 0.004994685994461179,
  "graph_injection_time": 0.5141048840014264,
  "acs_metrics": {
    "node_count": 547,
    "relationship_count": 1814,
    "density": 0.0061,
    "avg_degree": 6.6325,
    "avg_unique_neighbors": 6.5667,
    "global_efficiency": 0.3819,
    "avg_path_length": 2.8539,
    "avg_degree_centrality": 0.0121,
    "max_degree_centrality": 0.5403,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0717,
    "degree_assortativity": -0.1705,
    "graph_robustness": 0.6996,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3155,
    "weakly_connected_components": 9,
    "largest_wcc_size": 539,
    "pagerank_top10_percent": 6.17,
    "louvain_communities": 21,
    "louvain_modularity": 0.4454,
    "label_entropy": 1.4699,
    "computational_time": 0.17966373701347038
  },
  "retrieval_queries": []
}
2025-11-24 14:53:37,868 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:53:37,868 - src.pipeline.kg_builder - INFO - Batch 41 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 40.45s, Clean: 0.00s, Neo4j: 0.52s, ACS: 0.18s
2025-11-24 14:53:37,868 - src.pipeline.kg_builder - INFO - Batch 41 completed in 41.15s
Processing KG batches:  57%|█████▋    | 41/72 [25:35<20:18, 39.29s/it]2025-11-24 14:53:37,868 - src.pipeline.kg_builder - INFO - Processing batch 42/72 (3 items)
2025-11-24 14:53:37,868 - src.pipeline.kg_builder - DEBUG - Batch 42 current_video_time: 10:23-10:28
2025-11-24 14:53:37,873 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 547
- Total Relationships: 616
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:53:37,874 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:53:37,874 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0 ~220 words, content: Time: 10:13-10:18 Content: The sequence of frames captures a precise laboratory procedure, likely a titration or the preparation of a solution, from a first-person perspective....
2025-11-24 14:53:37,874 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1 ~227 words, content: clear. The action is deliberate and controlled, suggesting a need for precision. - **Final Adjustment:** The person continues to add the liquid from the pipette...
2025-11-24 14:53:37,874 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2 ~229 words, content: The person's right hand is using a pipette to add a clear liquid drop by drop into the graduated cylinder. The liquid being added is...
2025-11-24 14:53:37,874 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3 ~226 words, content: digital balance, a magnetic stirrer, and a volumetric flask. - **Initial Action:** The primary focus is on a person wearing blue nitrile gloves, who is...
2025-11-24 14:53:37,874 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4 ~54 words, content: is one of concentration and precision, highlighting the importance of accuracy in scientific research. In summary, the video shows a detailed and methodical process of...
2025-11-24 14:53:37,874 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:53:37,874 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0) (~220 words) with timeout=5.0s retries=3
2025-11-24 14:53:38,971 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:53:38,971 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:53:38,971 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1) (~227 words) with timeout=5.0s retries=3
2025-11-24 14:53:40,137 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:53:40,137 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:53:40,137 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2) (~229 words) with timeout=5.0s retries=3
2025-11-24 14:53:41,438 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:53:41,438 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:53:41,439 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3) (~226 words) with timeout=5.0s retries=3
2025-11-24 14:53:42,639 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:53:42,639 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:53:42,639 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4) (~54 words) with timeout=5.0s retries=3
2025-11-24 14:53:44,202 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:53:44,202 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:53:44,202 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 5 chunks
2025-11-24 14:53:44,202 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 6.33s
2025-11-24 14:53:44,202 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 547
- Total Relationships: 616
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated Cylinder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0"]}, {"head": "Graduated Cylinder", "relation": "Receives", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1"]}, {"head": "Person", "relation": "Adds", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1"]}, {"head": "Pipette", "relation": "Adds", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1"]}, {"head": "Person", "relation": "Performs", "tail": "Precise Liquid Transfer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1"]}, {"head": "Pipette", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2"]}, {"head": "Liquid", "relation": "Enters", "tail": "Graduated Cylinder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2"]}, {"head": "Person", "relation": "Observes", "tail": "Graduated Cylinder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "0.000 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3"]}, {"head": "Magnetic Stirrer", "relation": "Has", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2"]}, {"head": "Person", "relation": "Observes", "tail": "Colleague", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3"]}, {"head": "Liquid", "relation": "Is Measured In", "tail": "Graduated_Cylinder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4"]}, {"head": "Graduated_Cylinder", "relation": "Is Used For", "tail": "Measuring_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4"]}, {"head": "Person", "relation": "Observes", "tail": "Measuring_Process", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Graduated_Cylinder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4"]}, {"head": "Scientific_Research", "relation": "Requires", "tail": "Precision", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4"]}, {"head": "Graduated_Cylinder", "relation": "Is Part Of", "tail": "Measuring_Process", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:53:44,202 - src.components.global_refiner - DEBUG - Refining 23 triplets (prompt ~326 words, ~424 tokens)
2025-11-24 14:53:44,202 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:54:17,288 - src.components.global_refiner - DEBUG - LLM call completed in 33.09s
2025-11-24 14:54:17,288 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3']], ['Person', 'holds', 'Graduated_Cylinder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0']], ['Graduated_Cylinder', 'receives', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1']], ['Person', 'adds', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1']], ['Pipette', 'adds', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1']], ['Person', 'performs', 'Precise_Liquid_Transfer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1']], ['Pipette', 'dispenses', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2']], ['Liquid', 'enters', 'Graduated_Cylinder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2']], ['Person', 'observes', 'Graduated_Cylinder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2']], ['Digital_Balance', 'displays', '0.000_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3']], ['Magnetic_Stirrer', 'has', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2']], ['Person', 'observes', 'Colleague', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3']], ['Lab_Environment', 'contains', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3']], ['Liquid', 'is_measured_in', 'Graduated_Cylinder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4']], ['Graduated_Cylinder', 'is_used_for', 'Measuring_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4']], ['Person', 'observes', 'Measuring_Process', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4']], ['Laboratory', 'contains', 'Graduated_Cylinder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4']], ['Scientific_Research', 'requires', 'Precision', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4']], ['Graduated_Cylinder', 'is_part_of', 'Measuring_Process', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4']]]
2025-11-24 14:54:17,288 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Graduated_Cylinder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0"
    ]
  ],
  [
    "Graduated_Cylinder",
    "receives",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1"
    ]
  ],
  [
    "Person",
    "adds",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1"
    ]
  ],
  [
    "Pipette",
    "adds",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1"
    ]
  ],
  [
    "Person",
    "performs",
    "Precise_Liquid_Transfer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_1"
    ]
  ],
  [
    "Pipette",
    "dispenses",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2"
    ]
  ],
  [
    "Liquid",
    "enters",
    "Graduated_Cylinder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2"
    ]
  ],
  [
    "Person",
    "observes",
    "Graduated_Cylinder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "0.000_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "has",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_2"
    ]
  ],
  [
    "Person",
    "observes",
    "Colleague",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3"
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_3"
    ]
  ],
  [
    "Liquid",
    "is_measured_in",
    "Graduated_Cylinder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4"
    ]
  ],
  [
    "Graduated_Cylinder",
    "is_used_for",
    "Measuring_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4"
    ]
  ],
  [
    "Person",
    "observes",
    "Measuring_Process",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Graduated_Cylinder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4"
    ]
  ],
  [
    "Scientific_Research",
    "requires",
    "Precision",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4"
    ]
  ],
  [
    "Graduated_Cylinder",
    "is_part_of",
    "Measuring_Process",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_41_4"
    ]
  ]
]
2025-11-24 14:54:17,288 - src.components.global_refiner - INFO - Refinement complete: 23 → 23 triplets (total: 33.09s, LLM: 33.09s)
2025-11-24 14:54:17,288 - src.pipeline.kg_builder - INFO - Global refinement: 23 triplets in 33.09s
2025-11-24 14:54:17,288 - src.pipeline.kg_builder - INFO - Using 23 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:54:17,288 - src.pipeline.kg_builder - INFO - Pushing batch 42/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:54:17,288 - src.components.neo4j_handler - INFO - Adding 23 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:54:17,542 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:54:17,542 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:54:17,543 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:54:17,543 - src.components.neo4j_handler - INFO - Batch injected in 0.25s (triplets: 0.25s, indexes: 0.00s)
2025-11-24 14:54:17,543 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:54:17,590 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:54:17,668 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 549
2025-11-24 14:54:17,703 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 557, 'relationship_count': 1859, 'density': 0.006, 'avg_degree': 6.675, 'avg_unique_neighbors': 6.6068, 'global_efficiency': 0.3813, 'avg_path_length': 2.8395, 'avg_degree_centrality': 0.012, 'max_degree_centrality': 0.545, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.07, 'degree_assortativity': -0.1709, 'graph_robustness': 0.6977, 'diameter_estimate': 50, 'clustering_coefficient': 0.3163, 'weakly_connected_components': 9, 'largest_wcc_size': 549, 'pagerank_top10_percent': 6.07, 'louvain_communities': 20, 'louvain_modularity': 0.4369, 'label_entropy': 1.471, 'computational_time': 0.16008846304612234}
2025-11-24 14:54:17,703 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 41, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967257.7034898, 'total_time': 39.83509038598277, 'aggregation': 2.8830254450440407e-06, 'network_info': 0.005155250953976065, 'llm_extraction': 39.41491465398576, 'data_cleaning': 1.5833997167646885e-05, 'neo4j_injection': 0.2545525549794547, 'embedding_time': 0, 'indexing_time': 0.004999912984203547, 'graph_injection_time': 0.24937931902240962, 'acs_metrics': {'node_count': 557, 'relationship_count': 1859, 'density': 0.006, 'avg_degree': 6.675, 'avg_unique_neighbors': 6.6068, 'global_efficiency': 0.3813, 'avg_path_length': 2.8395, 'avg_degree_centrality': 0.012, 'max_degree_centrality': 0.545, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.07, 'degree_assortativity': -0.1709, 'graph_robustness': 0.6977, 'diameter_estimate': 50, 'clustering_coefficient': 0.3163, 'weakly_connected_components': 9, 'largest_wcc_size': 549, 'pagerank_top10_percent': 6.07, 'louvain_communities': 20, 'louvain_modularity': 0.4369, 'label_entropy': 1.471, 'computational_time': 0.16008846304612234}, 'retrieval_queries': []}
2025-11-24 14:54:17,703 - src.pipeline.kg_builder - DEBUG - Batch 41 metrics: {
  "batch_idx": 41,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967257.7034898,
  "total_time": 39.83509038598277,
  "aggregation": 2.8830254450440407e-06,
  "network_info": 0.005155250953976065,
  "llm_extraction": 39.41491465398576,
  "data_cleaning": 1.5833997167646885e-05,
  "neo4j_injection": 0.2545525549794547,
  "embedding_time": 0,
  "indexing_time": 0.004999912984203547,
  "graph_injection_time": 0.24937931902240962,
  "acs_metrics": {
    "node_count": 557,
    "relationship_count": 1859,
    "density": 0.006,
    "avg_degree": 6.675,
    "avg_unique_neighbors": 6.6068,
    "global_efficiency": 0.3813,
    "avg_path_length": 2.8395,
    "avg_degree_centrality": 0.012,
    "max_degree_centrality": 0.545,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.07,
    "degree_assortativity": -0.1709,
    "graph_robustness": 0.6977,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3163,
    "weakly_connected_components": 9,
    "largest_wcc_size": 549,
    "pagerank_top10_percent": 6.07,
    "louvain_communities": 20,
    "louvain_modularity": 0.4369,
    "label_entropy": 1.471,
    "computational_time": 0.16008846304612234
  },
  "retrieval_queries": []
}
2025-11-24 14:54:17,704 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:54:17,704 - src.pipeline.kg_builder - INFO - Batch 42 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 39.41s, Clean: 0.00s, Neo4j: 0.25s, ACS: 0.16s
2025-11-24 14:54:17,704 - src.pipeline.kg_builder - INFO - Batch 42 completed in 39.84s
Processing KG batches:  58%|█████▊    | 42/72 [26:15<19:43, 39.46s/it]2025-11-24 14:54:17,704 - src.pipeline.kg_builder - INFO - Processing batch 43/72 (3 items)
2025-11-24 14:54:17,704 - src.pipeline.kg_builder - DEBUG - Batch 43 current_video_time: 10:38-10:43
2025-11-24 14:54:17,713 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 557
- Total Relationships: 629
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:54:17,714 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 14:54:17,714 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0 ~222 words, content: Time: 10:28-10:33 Content: The video captures a detailed, first-person perspective of a precise laboratory procedure, likely a titration or the preparation of a solution. The...
2025-11-24 14:54:17,714 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1 ~222 words, content: graduated cylinder, ensuring it is stable and properly aligned. The left hand, which is also wearing a black wristwatch, holds the cylinder firmly. The right...
2025-11-24 14:54:17,714 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2 ~222 words, content: and precise, suggesting the importance of accurate measurement. The surrounding environment provides context for the experiment: - To the left, a white bottle with a...
2025-11-24 14:54:17,714 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3 ~198 words, content: pipette to transfer a clear liquid from a small vial into a larger, empty volumetric flask. The work is being done on a black countertop,...
2025-11-24 14:54:17,714 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:54:17,714 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0) (~222 words) with timeout=5.0s retries=3
2025-11-24 14:54:19,050 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:54:19,050 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:54:19,051 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1) (~222 words) with timeout=5.0s retries=3
2025-11-24 14:54:20,169 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:54:20,169 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:54:20,169 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2) (~222 words) with timeout=5.0s retries=3
2025-11-24 14:54:21,493 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:54:21,493 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:54:21,494 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3) (~198 words) with timeout=5.0s retries=3
2025-11-24 14:54:22,624 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:54:22,624 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:54:22,624 - src.components.pre_llm_injector - INFO - Extracted 19 local triplets from 4 chunks
2025-11-24 14:54:22,624 - src.pipeline.kg_builder - INFO - Pre-extraction: 19 triplets in 4.91s
2025-11-24 14:54:22,624 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 557
- Total Relationships: 629
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated_Cylinder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1"]}, {"head": "Pipette", "relation": "Adds", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0"]}, {"head": "Graduated_Cylinder", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0"]}, {"head": "Graduated_Cylinder", "relation": "Rests On", "tail": "Analytical_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated Cylinder", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3"]}, {"head": "Graduated Cylinder", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1"]}, {"head": "Person", "relation": "Makes", "tail": "Final Adjustments", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Dark Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "0.000 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2"]}, {"head": "Magnetic Stirrer", "relation": "Has", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2"]}, {"head": "Person", "relation": "Holds", "tail": "Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3"]}, {"head": "Vial", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Volumetric Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:54:22,624 - src.components.global_refiner - DEBUG - Refining 19 triplets (prompt ~286 words, ~372 tokens)
2025-11-24 14:54:22,624 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:54:53,774 - src.components.global_refiner - DEBUG - LLM call completed in 31.15s
2025-11-24 14:54:53,774 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2']], ['Person', 'holds', 'Graduated_Cylinder', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3']], ['Person', 'holds', 'Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3']], ['Person', 'makes', 'Final_Adjustments', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1']], ['Pipette', 'adds', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2']], ['Pipette', 'transfers', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3']], ['Graduated_Cylinder', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1']], ['Graduated_Cylinder', 'rests_on', 'Analytical_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0']], ['Beaker', 'contains', 'Dark_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2']], ['Digital_Balance', 'displays', '0.000_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2']], ['Digital_Balance', 'measures', 'Volumetric_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3']], ['Magnetic_Stirrer', 'has', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2']], ['Vial', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1']], ['Pipette', 'uses', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2']], ['Pipette', 'uses', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3']], ['Graduated_Cylinder', 'uses', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1']], ['Vial', 'uses', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3']]]
2025-11-24 14:54:53,774 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Graduated_Cylinder",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3"
    ]
  ],
  [
    "Person",
    "makes",
    "Final_Adjustments",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1"
    ]
  ],
  [
    "Pipette",
    "adds",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3"
    ]
  ],
  [
    "Graduated_Cylinder",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1"
    ]
  ],
  [
    "Graduated_Cylinder",
    "rests_on",
    "Analytical_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Dark_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "0.000_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2"
    ]
  ],
  [
    "Digital_Balance",
    "measures",
    "Volumetric_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "has",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2"
    ]
  ],
  [
    "Vial",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1"
    ]
  ],
  [
    "Pipette",
    "uses",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_2"
    ]
  ],
  [
    "Pipette",
    "uses",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3"
    ]
  ],
  [
    "Graduated_Cylinder",
    "uses",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_1"
    ]
  ],
  [
    "Vial",
    "uses",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_42_3"
    ]
  ]
]
2025-11-24 14:54:53,774 - src.components.global_refiner - INFO - Refinement complete: 19 → 20 triplets (total: 31.15s, LLM: 31.15s)
2025-11-24 14:54:53,774 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 31.15s
2025-11-24 14:54:53,774 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:54:53,774 - src.pipeline.kg_builder - INFO - Pushing batch 43/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:54:53,775 - src.components.neo4j_handler - INFO - Adding 20 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:54:53,994 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:54:53,994 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:54:53,995 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:54:53,995 - src.components.neo4j_handler - INFO - Batch injected in 0.22s (triplets: 0.22s, indexes: 0.00s)
2025-11-24 14:54:53,995 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:54:54,061 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:54:54,139 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 554
2025-11-24 14:54:54,174 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 562, 'relationship_count': 1891, 'density': 0.006, 'avg_degree': 6.7295, 'avg_unique_neighbors': 6.6584, 'global_efficiency': 0.3819, 'avg_path_length': 2.8248, 'avg_degree_centrality': 0.012, 'max_degree_centrality': 0.549, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0707, 'degree_assortativity': -0.1704, 'graph_robustness': 0.6965, 'diameter_estimate': 50, 'clustering_coefficient': 0.3165, 'weakly_connected_components': 9, 'largest_wcc_size': 554, 'pagerank_top10_percent': 6.03, 'louvain_communities': 21, 'louvain_modularity': 0.4287, 'label_entropy': 1.4726, 'computational_time': 0.1798439499689266}
2025-11-24 14:54:54,175 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 42, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967294.1751685, 'total_time': 36.47060818300815, 'aggregation': 2.6740017347037792e-06, 'network_info': 0.009010422974824905, 'llm_extraction': 36.061157151998486, 'data_cleaning': 1.6106001567095518e-05, 'neo4j_injection': 0.2202137970016338, 'embedding_time': 0, 'indexing_time': 0.0030459469999186695, 'graph_injection_time': 0.21700556203722954, 'acs_metrics': {'node_count': 562, 'relationship_count': 1891, 'density': 0.006, 'avg_degree': 6.7295, 'avg_unique_neighbors': 6.6584, 'global_efficiency': 0.3819, 'avg_path_length': 2.8248, 'avg_degree_centrality': 0.012, 'max_degree_centrality': 0.549, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0707, 'degree_assortativity': -0.1704, 'graph_robustness': 0.6965, 'diameter_estimate': 50, 'clustering_coefficient': 0.3165, 'weakly_connected_components': 9, 'largest_wcc_size': 554, 'pagerank_top10_percent': 6.03, 'louvain_communities': 21, 'louvain_modularity': 0.4287, 'label_entropy': 1.4726, 'computational_time': 0.1798439499689266}, 'retrieval_queries': []}
2025-11-24 14:54:54,175 - src.pipeline.kg_builder - DEBUG - Batch 42 metrics: {
  "batch_idx": 42,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967294.1751685,
  "total_time": 36.47060818300815,
  "aggregation": 2.6740017347037792e-06,
  "network_info": 0.009010422974824905,
  "llm_extraction": 36.061157151998486,
  "data_cleaning": 1.6106001567095518e-05,
  "neo4j_injection": 0.2202137970016338,
  "embedding_time": 0,
  "indexing_time": 0.0030459469999186695,
  "graph_injection_time": 0.21700556203722954,
  "acs_metrics": {
    "node_count": 562,
    "relationship_count": 1891,
    "density": 0.006,
    "avg_degree": 6.7295,
    "avg_unique_neighbors": 6.6584,
    "global_efficiency": 0.3819,
    "avg_path_length": 2.8248,
    "avg_degree_centrality": 0.012,
    "max_degree_centrality": 0.549,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0707,
    "degree_assortativity": -0.1704,
    "graph_robustness": 0.6965,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3165,
    "weakly_connected_components": 9,
    "largest_wcc_size": 554,
    "pagerank_top10_percent": 6.03,
    "louvain_communities": 21,
    "louvain_modularity": 0.4287,
    "label_entropy": 1.4726,
    "computational_time": 0.1798439499689266
  },
  "retrieval_queries": []
}
2025-11-24 14:54:54,176 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:54:54,176 - src.pipeline.kg_builder - INFO - Batch 43 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 36.06s, Clean: 0.00s, Neo4j: 0.22s, ACS: 0.18s
2025-11-24 14:54:54,176 - src.pipeline.kg_builder - INFO - Batch 43 completed in 36.47s
Processing KG batches:  60%|█████▉    | 43/72 [26:51<18:38, 38.56s/it]2025-11-24 14:54:54,176 - src.pipeline.kg_builder - INFO - Processing batch 44/72 (3 items)
2025-11-24 14:54:54,176 - src.pipeline.kg_builder - DEBUG - Batch 44 current_video_time: 10:53-10:58
2025-11-24 14:54:54,181 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 562
- Total Relationships: 637
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:54:54,182 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-24 14:54:54,182 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0 ~217 words, content: Time: 10:43-10:48 Content: The video sequence captures a detailed laboratory procedure, likely a chemical preparation or analysis, performed by a person wearing blue nitrile gloves....
2025-11-24 14:54:54,182 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1 ~230 words, content: an empty container before tare. This suggests the person has just tared the balance, setting the weight of the empty vial to zero. The person...
2025-11-24 14:54:54,182 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2 ~230 words, content: nitrile gloves is handling a small, clear glass vial. In the foreground, a digital analytical balance is visible, with its display reading "0.000". To the...
2025-11-24 14:54:54,182 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3 ~220 words, content: . The digital balance is on the left, and the magnetic stirrer is in the center. A person's hand, wearing a blue glove, is seen...
2025-11-24 14:54:54,182 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_4 ~217 words, content: the left, a digital balance scale is visible, with its display reading `0.000`. To the right, a magnetic stirrer holds a beaker, and a burette...
2025-11-24 14:54:54,182 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_5 ~82 words, content: , remains in place, indicating that the experiment is ongoing. The overall atmosphere is one of concentration and precision, typical of a scientific research environment....
2025-11-24 14:54:54,182 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:54:54,182 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0) (~217 words) with timeout=5.0s retries=3
2025-11-24 14:54:56,465 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:54:56,465 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:54:56,465 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1) (~230 words) with timeout=5.0s retries=3
2025-11-24 14:54:57,626 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:54:57,626 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:54:57,627 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2) (~230 words) with timeout=5.0s retries=3
2025-11-24 14:54:59,061 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:54:59,061 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:54:59,061 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3) (~220 words) with timeout=5.0s retries=3
2025-11-24 14:55:03,138 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:55:03,139 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:55:03,139 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_4) (~217 words) with timeout=5.0s retries=3
2025-11-24 14:55:04,610 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:55:04,610 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:55:04,611 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_5) (~82 words) with timeout=5.0s retries=3
2025-11-24 14:55:05,785 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-24 14:55:05,785 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-24 14:55:05,785 - src.components.pre_llm_injector - INFO - Extracted 34 local triplets from 6 chunks
2025-11-24 14:55:05,785 - src.pipeline.kg_builder - INFO - Pre-extraction: 34 triplets in 11.60s
2025-11-24 14:55:05,785 - src.components.global_refiner - INFO - Capping refinement input: 34 → 25 triplets
2025-11-24 14:55:05,786 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 562
- Total Relationships: 637
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0"]}, {"head": "Person", "relation": "Handles", "tail": "Glass_Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0"]}, {"head": "Glass_Vial", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "0.000_G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Digital_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Magnetic_Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_4"]}, {"head": "Person", "relation": "Holds", "tail": "Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1"]}, {"head": "Vial", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1"]}, {"head": "Balance", "relation": "Displays", "tail": "0.000 G", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1"]}, {"head": "Person", "relation": "Places", "tail": "Vial On Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1"]}, {"head": "Balance", "relation": "Measures", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1"]}, {"head": "Person", "relation": "Holds", "tail": "Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2"]}, {"head": "Nitrile Gloves", "relation": "Holds", "tail": "Glass Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2"]}, {"head": "Glass Vial", "relation": "Contains", "tail": "White Solid Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "0.000", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_4"]}, {"head": "Magnetic Stirrer", "relation": "Holds", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2"]}, {"head": "Burette", "relation": "Is Held By", "tail": "Clamp", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2"]}, {"head": "Digital Balance", "relation": "Is On", "tail": "Laboratory Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3"]}, {"head": "Magnetic Stirrer", "relation": "Is On", "tail": "Laboratory Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3"]}, {"head": "Person", "relation": "Adjusts", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3"]}, {"head": "Magnetic Stirrer", "relation": "Displays", "tail": "0.000", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3"]}, {"head": "Magnetic Stirrer", "relation": "Displays", "tail": "0.076", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3"]}, {"head": "Magnetic Stirrer", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:55:05,786 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~344 words, ~447 tokens)
2025-11-24 14:55:05,786 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:55:37,685 - src.components.global_refiner - DEBUG - LLM call completed in 31.90s
2025-11-24 14:55:37,685 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_4']], ['Person', 'handles', 'Glass_Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0']], ['Glass_Vial', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0']], ['Digital_Balance', 'displays', '0.000_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0']], ['Lab_Bench', 'contains', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0']], ['Lab_Bench', 'contains', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0']], ['Person', 'holds', 'Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1']], ['Vial', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1']], ['Balance', 'displays', '0.000_G', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1']], ['Person', 'places', 'Vial_On_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1']], ['Balance', 'measures', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1']], ['Person', 'holds', 'Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2']], ['Nitrile_Gloves', 'holds', 'Glass_Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2']], ['Glass_Vial', 'contains', 'White_Solid_Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2']], ['Digital_Balance', 'displays', '0.000', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_4']], ['Magnetic_Stirrer', 'holds', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2']], ['Burette', 'is_held_by', 'Clamp', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2']], ['Digital_Balance', 'is_on', 'Laboratory_Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3']], ['Magnetic_Stirrer', 'is_on', 'Laboratory_Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3']], ['Person', 'wears', 'Blue_Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3']], ['Person', 'adjusts', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3']], ['Magnetic_Stirrer', 'displays', '0.000', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3']], ['Magnetic_Stirrer', 'displays', '0.076', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3']], ['Magnetic_Stirrer', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_4']]]
2025-11-24 14:55:37,686 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_4"
    ]
  ],
  [
    "Person",
    "handles",
    "Glass_Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0"
    ]
  ],
  [
    "Glass_Vial",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "0.000_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1"
    ]
  ],
  [
    "Vial",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1"
    ]
  ],
  [
    "Balance",
    "displays",
    "0.000_G",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1"
    ]
  ],
  [
    "Person",
    "places",
    "Vial_On_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1"
    ]
  ],
  [
    "Balance",
    "measures",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2"
    ]
  ],
  [
    "Nitrile_Gloves",
    "holds",
    "Glass_Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2"
    ]
  ],
  [
    "Glass_Vial",
    "contains",
    "White_Solid_Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "0.000",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_4"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "holds",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2"
    ]
  ],
  [
    "Burette",
    "is_held_by",
    "Clamp",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_2"
    ]
  ],
  [
    "Digital_Balance",
    "is_on",
    "Laboratory_Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "is_on",
    "Laboratory_Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3"
    ]
  ],
  [
    "Person",
    "adjusts",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "displays",
    "0.000",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "displays",
    "0.076",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_3"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_43_4"
    ]
  ]
]
2025-11-24 14:55:37,686 - src.components.global_refiner - INFO - Refinement complete: 25 → 24 triplets (total: 31.90s, LLM: 31.90s)
2025-11-24 14:55:37,686 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 31.90s
2025-11-24 14:55:37,686 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:55:37,686 - src.pipeline.kg_builder - INFO - Pushing batch 44/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:55:37,686 - src.components.neo4j_handler - INFO - Adding 24 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:55:37,969 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:55:37,969 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:55:37,969 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:55:37,969 - src.components.neo4j_handler - INFO - Batch injected in 0.28s (triplets: 0.28s, indexes: 0.01s)
2025-11-24 14:55:37,969 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:55:38,018 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:55:38,098 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 564
2025-11-24 14:55:38,136 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 573, 'relationship_count': 1942, 'density': 0.0059, 'avg_degree': 6.7784, 'avg_unique_neighbors': 6.7051, 'global_efficiency': 0.3807, 'avg_path_length': 2.8393, 'avg_degree_centrality': 0.0119, 'max_degree_centrality': 0.549, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0772, 'degree_assortativity': -0.168, 'graph_robustness': 0.6977, 'diameter_estimate': 50, 'clustering_coefficient': 0.3165, 'weakly_connected_components': 10, 'largest_wcc_size': 564, 'pagerank_top10_percent': 5.93, 'louvain_communities': 21, 'louvain_modularity': 0.424, 'label_entropy': 1.474, 'computational_time': 0.16700435796519741}
2025-11-24 14:55:38,137 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 43, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967338.1371233, 'total_time': 43.960815347963944, 'aggregation': 2.8130016289651394e-06, 'network_info': 0.0053937979973852634, 'llm_extraction': 43.50427319301525, 'data_cleaning': 1.6245990991592407e-05, 'neo4j_injection': 0.28373885998735204, 'embedding_time': 0, 'indexing_time': 0.0052881279843859375, 'graph_injection_time': 0.2783066050033085, 'acs_metrics': {'node_count': 573, 'relationship_count': 1942, 'density': 0.0059, 'avg_degree': 6.7784, 'avg_unique_neighbors': 6.7051, 'global_efficiency': 0.3807, 'avg_path_length': 2.8393, 'avg_degree_centrality': 0.0119, 'max_degree_centrality': 0.549, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0772, 'degree_assortativity': -0.168, 'graph_robustness': 0.6977, 'diameter_estimate': 50, 'clustering_coefficient': 0.3165, 'weakly_connected_components': 10, 'largest_wcc_size': 564, 'pagerank_top10_percent': 5.93, 'louvain_communities': 21, 'louvain_modularity': 0.424, 'label_entropy': 1.474, 'computational_time': 0.16700435796519741}, 'retrieval_queries': []}
2025-11-24 14:55:38,137 - src.pipeline.kg_builder - DEBUG - Batch 43 metrics: {
  "batch_idx": 43,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967338.1371233,
  "total_time": 43.960815347963944,
  "aggregation": 2.8130016289651394e-06,
  "network_info": 0.0053937979973852634,
  "llm_extraction": 43.50427319301525,
  "data_cleaning": 1.6245990991592407e-05,
  "neo4j_injection": 0.28373885998735204,
  "embedding_time": 0,
  "indexing_time": 0.0052881279843859375,
  "graph_injection_time": 0.2783066050033085,
  "acs_metrics": {
    "node_count": 573,
    "relationship_count": 1942,
    "density": 0.0059,
    "avg_degree": 6.7784,
    "avg_unique_neighbors": 6.7051,
    "global_efficiency": 0.3807,
    "avg_path_length": 2.8393,
    "avg_degree_centrality": 0.0119,
    "max_degree_centrality": 0.549,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0772,
    "degree_assortativity": -0.168,
    "graph_robustness": 0.6977,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3165,
    "weakly_connected_components": 10,
    "largest_wcc_size": 564,
    "pagerank_top10_percent": 5.93,
    "louvain_communities": 21,
    "louvain_modularity": 0.424,
    "label_entropy": 1.474,
    "computational_time": 0.16700435796519741
  },
  "retrieval_queries": []
}
2025-11-24 14:55:38,138 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:55:38,138 - src.pipeline.kg_builder - INFO - Batch 44 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 43.50s, Clean: 0.00s, Neo4j: 0.28s, ACS: 0.17s
2025-11-24 14:55:38,138 - src.pipeline.kg_builder - INFO - Batch 44 completed in 43.96s
Processing KG batches:  61%|██████    | 44/72 [27:35<18:45, 40.18s/it]2025-11-24 14:55:38,138 - src.pipeline.kg_builder - INFO - Processing batch 45/72 (3 items)
2025-11-24 14:55:38,138 - src.pipeline.kg_builder - DEBUG - Batch 45 current_video_time: 11:08-11:13
2025-11-24 14:55:38,147 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 573
- Total Relationships: 651
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:55:38,148 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:55:38,148 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0 ~223 words, content: Time: 10:58-11:03 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a similar chemical analysis, performed by a person wearing blue...
2025-11-24 14:55:38,148 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1 ~222 words, content: , a glass beaker on a stirrer, and a burette clamped to a stand on the right. Other items like a bottle with a red...
2025-11-24 14:55:38,148 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2 ~217 words, content: experiment is taking place on a black laboratory bench. The setup includes: - A glass beaker on an electronic balance. - A blue magnetic stirrer...
2025-11-24 14:55:38,148 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3 ~225 words, content: presence of a stirrer, a stand with a tube, and other equipment suggests a chemical synthesis or a reaction setup. Another person is observing the...
2025-11-24 14:55:38,148 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4 ~163 words, content: . The camera angle changes again, showing more of the lab environment, including white cabinets and a fire extinguisher in the background. The person's hand...
2025-11-24 14:55:38,148 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:55:38,148 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0) (~223 words) with timeout=5.0s retries=3
2025-11-24 14:55:39,391 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:55:39,391 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:55:39,392 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1) (~222 words) with timeout=5.0s retries=3
2025-11-24 14:55:40,433 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:55:40,433 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:55:40,433 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2) (~217 words) with timeout=5.0s retries=3
2025-11-24 14:55:41,693 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:55:41,693 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:55:41,694 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3) (~225 words) with timeout=5.0s retries=3
2025-11-24 14:55:42,867 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:55:42,867 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:55:42,867 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4) (~163 words) with timeout=5.0s retries=3
2025-11-24 14:55:43,958 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:55:43,959 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:55:43,959 - src.components.pre_llm_injector - INFO - Extracted 26 local triplets from 5 chunks
2025-11-24 14:55:43,959 - src.pipeline.kg_builder - INFO - Pre-extraction: 26 triplets in 5.81s
2025-11-24 14:55:43,959 - src.components.global_refiner - INFO - Capping refinement input: 26 → 25 triplets
2025-11-24 14:55:43,959 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 573
- Total Relationships: 651
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3"]}, {"head": "Glass Vial", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0"]}, {"head": "Person", "relation": "Places", "tail": "Glass Vial On Device", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0"]}, {"head": "Device", "relation": "Displays", "tail": "0.352", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0"]}, {"head": "Device", "relation": "Has", "tail": "Green Light", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0"]}, {"head": "Person", "relation": "Holds", "tail": "Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4"]}, {"head": "Vial", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1"]}, {"head": "Person", "relation": "Pours", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1"]}, {"head": "Burette", "relation": "Is Clamped To", "tail": "Stand", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1"]}, {"head": "Person", "relation": "Performs", "tail": "Experiment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2"]}, {"head": "Beaker", "relation": "Is On", "tail": "Electronic_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2"]}, {"head": "Magnetic_Stirrer", "relation": "Is Inside", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2"]}, {"head": "Metal_Stand", "relation": "Holds", "tail": "Glass_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2"]}, {"head": "Glass_Tube", "relation": "Is Connected To", "tail": "Flexible_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2"]}, {"head": "Person", "relation": "Observes", "tail": "Experiment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3"]}, {"head": "Glass Vial", "relation": "Contains", "tail": "Transparent Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3"]}, {"head": "Person", "relation": "Stands Near", "tail": "Lab Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3"]}, {"head": "Camera", "relation": "Captures", "tail": "Lab Environment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4"]}, {"head": "Woman", "relation": "Interacts With", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4"]}, {"head": "Vial", "relation": "Connected To", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:55:43,959 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~345 words, ~448 tokens)
2025-11-24 14:55:43,959 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:56:15,311 - src.components.global_refiner - DEBUG - LLM call completed in 31.35s
2025-11-24 14:56:15,311 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3']], ['Person', 'holds', 'Glass_Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3']], ['Glass_Vial', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0']], ['Glass_Vial', 'contains', 'Transparent_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3']], ['Person', 'places', 'Glass_Vial_On_Device', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0']], ['Device', 'displays', '0.352', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0']], ['Device', 'has', 'Green_Light', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0']], ['Person', 'holds', 'Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4']], ['Vial', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1']], ['Beaker', 'is_on', 'Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1']], ['Person', 'pours', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1']], ['Burette', 'is_clamped_to', 'Stand', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1']], ['Person', 'performs', 'Experiment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2']], ['Beaker', 'is_on', 'Electronic_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2']], ['Magnetic_Stirrer', 'is_inside', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2']], ['Metal_Stand', 'holds', 'Glass_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2']], ['Glass_Tube', 'is_connected_to', 'Flexible_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2']], ['Person', 'observes', 'Experiment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3']], ['Person', 'stands_near', 'Lab_Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3']], ['Lab_Bench', 'contains', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3']], ['Camera', 'captures', 'Lab_Environment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4']], ['Woman', 'interacts_with', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4']], ['Beaker', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4']], ['Vial', 'connected_to', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4']]]
2025-11-24 14:56:15,312 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3"
    ]
  ],
  [
    "Glass_Vial",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0"
    ]
  ],
  [
    "Glass_Vial",
    "contains",
    "Transparent_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3"
    ]
  ],
  [
    "Person",
    "places",
    "Glass_Vial_On_Device",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0"
    ]
  ],
  [
    "Device",
    "displays",
    "0.352",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0"
    ]
  ],
  [
    "Device",
    "has",
    "Green_Light",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4"
    ]
  ],
  [
    "Vial",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1"
    ]
  ],
  [
    "Person",
    "pours",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1"
    ]
  ],
  [
    "Burette",
    "is_clamped_to",
    "Stand",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_1"
    ]
  ],
  [
    "Person",
    "performs",
    "Experiment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Electronic_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "is_inside",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2"
    ]
  ],
  [
    "Metal_Stand",
    "holds",
    "Glass_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2"
    ]
  ],
  [
    "Glass_Tube",
    "is_connected_to",
    "Flexible_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2"
    ]
  ],
  [
    "Person",
    "observes",
    "Experiment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3"
    ]
  ],
  [
    "Person",
    "stands_near",
    "Lab_Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_3"
    ]
  ],
  [
    "Camera",
    "captures",
    "Lab_Environment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4"
    ]
  ],
  [
    "Woman",
    "interacts_with",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4"
    ]
  ],
  [
    "Vial",
    "connected_to",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_44_4"
    ]
  ]
]
2025-11-24 14:56:15,312 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 31.35s, LLM: 31.35s)
2025-11-24 14:56:15,312 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 31.35s
2025-11-24 14:56:15,312 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:56:15,312 - src.pipeline.kg_builder - INFO - Pushing batch 45/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:56:15,312 - src.components.neo4j_handler - INFO - Adding 25 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:56:15,645 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:56:15,645 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:56:15,646 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:56:15,646 - src.components.neo4j_handler - INFO - Batch injected in 0.33s (triplets: 0.33s, indexes: 0.01s)
2025-11-24 14:56:15,646 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:56:15,697 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:56:15,833 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 575
2025-11-24 14:56:15,875 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 584, 'relationship_count': 1994, 'density': 0.0059, 'avg_degree': 6.8288, 'avg_unique_neighbors': 6.7568, 'global_efficiency': 0.381, 'avg_path_length': 2.8202, 'avg_degree_centrality': 0.0117, 'max_degree_centrality': 0.5506, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0661, 'degree_assortativity': -0.1659, 'graph_robustness': 0.6996, 'diameter_estimate': 50, 'clustering_coefficient': 0.3162, 'weakly_connected_components': 10, 'largest_wcc_size': 575, 'pagerank_top10_percent': 5.81, 'louvain_communities': 21, 'louvain_modularity': 0.423, 'label_entropy': 1.4746, 'computational_time': 0.22941692604217678}
2025-11-24 14:56:15,876 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 44, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967375.875995, 'total_time': 37.73774291697191, 'aggregation': 2.266024239361286e-06, 'network_info': 0.009489350020885468, 'llm_extraction': 37.164203445019666, 'data_cleaning': 1.7873011529445648e-05, 'neo4j_injection': 0.334150388953276, 'embedding_time': 0, 'indexing_time': 0.0068689550389535725, 'graph_injection_time': 0.3271208420046605, 'acs_metrics': {'node_count': 584, 'relationship_count': 1994, 'density': 0.0059, 'avg_degree': 6.8288, 'avg_unique_neighbors': 6.7568, 'global_efficiency': 0.381, 'avg_path_length': 2.8202, 'avg_degree_centrality': 0.0117, 'max_degree_centrality': 0.5506, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0661, 'degree_assortativity': -0.1659, 'graph_robustness': 0.6996, 'diameter_estimate': 50, 'clustering_coefficient': 0.3162, 'weakly_connected_components': 10, 'largest_wcc_size': 575, 'pagerank_top10_percent': 5.81, 'louvain_communities': 21, 'louvain_modularity': 0.423, 'label_entropy': 1.4746, 'computational_time': 0.22941692604217678}, 'retrieval_queries': []}
2025-11-24 14:56:15,876 - src.pipeline.kg_builder - DEBUG - Batch 44 metrics: {
  "batch_idx": 44,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967375.875995,
  "total_time": 37.73774291697191,
  "aggregation": 2.266024239361286e-06,
  "network_info": 0.009489350020885468,
  "llm_extraction": 37.164203445019666,
  "data_cleaning": 1.7873011529445648e-05,
  "neo4j_injection": 0.334150388953276,
  "embedding_time": 0,
  "indexing_time": 0.0068689550389535725,
  "graph_injection_time": 0.3271208420046605,
  "acs_metrics": {
    "node_count": 584,
    "relationship_count": 1994,
    "density": 0.0059,
    "avg_degree": 6.8288,
    "avg_unique_neighbors": 6.7568,
    "global_efficiency": 0.381,
    "avg_path_length": 2.8202,
    "avg_degree_centrality": 0.0117,
    "max_degree_centrality": 0.5506,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0661,
    "degree_assortativity": -0.1659,
    "graph_robustness": 0.6996,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3162,
    "weakly_connected_components": 10,
    "largest_wcc_size": 575,
    "pagerank_top10_percent": 5.81,
    "louvain_communities": 21,
    "louvain_modularity": 0.423,
    "label_entropy": 1.4746,
    "computational_time": 0.22941692604217678
  },
  "retrieval_queries": []
}
2025-11-24 14:56:15,876 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:56:15,877 - src.pipeline.kg_builder - INFO - Batch 45 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 37.16s, Clean: 0.00s, Neo4j: 0.33s, ACS: 0.23s
2025-11-24 14:56:15,877 - src.pipeline.kg_builder - INFO - Batch 45 completed in 37.74s
Processing KG batches:  62%|██████▎   | 45/72 [28:13<17:45, 39.45s/it]2025-11-24 14:56:15,877 - src.pipeline.kg_builder - INFO - Processing batch 46/72 (3 items)
2025-11-24 14:56:15,877 - src.pipeline.kg_builder - DEBUG - Batch 46 current_video_time: 11:23-11:28
2025-11-24 14:56:15,887 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 584
- Total Relationships: 665
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:56:15,887 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 14:56:15,887 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0 ~240 words, content: Time: 11:13-11:18 Content: The video captures a sequence of actions in a laboratory setting, focusing on a person conducting a chemical experiment. The scene is...
2025-11-24 14:56:15,887 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1 ~231 words, content: and a beige sweater. This person appears to be assisting or observing the experiment, adding to the collaborative nature of the work. The laboratory environment...
2025-11-24 14:56:15,887 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2 ~222 words, content: person is using a long, white, flexible tube, which is being inserted into the glassware. The right hand holds the tube in place while the...
2025-11-24 14:56:15,887 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3 ~87 words, content: by the "D LAB" logo visible on the device. The person's left hand, which is adorned with a gold and black watch, is holding the...
2025-11-24 14:56:15,887 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:56:15,887 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0) (~240 words) with timeout=5.0s retries=3
2025-11-24 14:56:16,924 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:56:16,924 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:56:16,924 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1) (~231 words) with timeout=5.0s retries=3
2025-11-24 14:56:18,178 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:56:18,178 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:56:18,178 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2) (~222 words) with timeout=5.0s retries=3
2025-11-24 14:56:19,535 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:56:19,535 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:56:19,536 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3) (~87 words) with timeout=5.0s retries=3
2025-11-24 14:56:20,709 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:56:20,709 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:56:20,709 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 4 chunks
2025-11-24 14:56:20,709 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 4.82s
2025-11-24 14:56:20,710 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 584
- Total Relationships: 665
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2"]}, {"head": "Person", "relation": "Wears", "tail": "Gold Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0"]}, {"head": "Person", "relation": "Holds", "tail": "Aluminum Foil", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0"]}, {"head": "Person", "relation": "Uses", "tail": "White Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1"]}, {"head": "Person", "relation": "Performs", "tail": "Precise_Task", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1"]}, {"head": "Person", "relation": "Uses", "tail": "Hands", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Component", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1"]}, {"head": "Glass_Component", "relation": "Is Connected To", "tail": "Glass_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1"]}, {"head": "Glass_Flask", "relation": "Is On", "tail": "White_Tray", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1"]}, {"head": "Person", "relation": "Wears", "tail": "Gold-Colored Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2"]}, {"head": "Person", "relation": "Holds", "tail": "Long White Flexible Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2"]}, {"head": "Person", "relation": "Uses", "tail": "White Cylindrical Device", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2"]}, {"head": "Long White Flexible Tube", "relation": "Is Inserted Into", "tail": "Glassware", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2"]}, {"head": "White Cylindrical Device", "relation": "Transfers Liquid To", "tail": "Clear Glass Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3"]}, {"head": "Person", "relation": "Holds", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3"]}, {"head": "Flask", "relation": "Is Held By", "tail": "Person", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3"]}, {"head": "Pipette", "relation": "Is Held By", "tail": "Person", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "Fire Extinguisher", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:56:20,710 - src.components.global_refiner - DEBUG - Refining 23 triplets (prompt ~332 words, ~432 tokens)
2025-11-24 14:56:20,710 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:56:47,055 - src.components.global_refiner - DEBUG - LLM call completed in 26.34s
2025-11-24 14:56:47,055 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2']], ['Person', 'wears', 'Gold-Colored_Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3']], ['Person', 'holds', 'Glass_Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0']], ['Person', 'holds', 'Aluminum_Foil', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0']], ['Person', 'uses', 'White_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0']], ['Person', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0']], ['Person', 'performs', 'Precise_Task', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1']], ['Person', 'uses', 'Hands', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1']], ['Person', 'holds', 'Glass_Component', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1']], ['Glass_Component', 'is_connected_to', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1']], ['Glass_Flask', 'is_on', 'White_Tray', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1']], ['Person', 'holds', 'Long_White_Flexible_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2']], ['Person', 'uses', 'White_Cylindrical_Device', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2']], ['Long_White_Flexible_Tube', 'is_inserted_into', 'Glassware', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2']], ['White_Cylindrical_Device', 'transfers_liquid_to', 'Clear_Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2']], ['Person', 'holds', 'Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3']], ['Flask', 'is_held_by', 'Person', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3']], ['Pipette', 'is_held_by', 'Person', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3']], ['Lab_Environment', 'contains', 'Fire_Extinguisher', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3']]]
2025-11-24 14:56:47,055 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Gold-Colored_Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Aluminum_Foil",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0"
    ]
  ],
  [
    "Person",
    "uses",
    "White_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_0"
    ]
  ],
  [
    "Person",
    "performs",
    "Precise_Task",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Hands",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Component",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1"
    ]
  ],
  [
    "Glass_Component",
    "is_connected_to",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1"
    ]
  ],
  [
    "Glass_Flask",
    "is_on",
    "White_Tray",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Long_White_Flexible_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2"
    ]
  ],
  [
    "Person",
    "uses",
    "White_Cylindrical_Device",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2"
    ]
  ],
  [
    "Long_White_Flexible_Tube",
    "is_inserted_into",
    "Glassware",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2"
    ]
  ],
  [
    "White_Cylindrical_Device",
    "transfers_liquid_to",
    "Clear_Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3"
    ]
  ],
  [
    "Flask",
    "is_held_by",
    "Person",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3"
    ]
  ],
  [
    "Pipette",
    "is_held_by",
    "Person",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3"
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "Fire_Extinguisher",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_45_3"
    ]
  ]
]
2025-11-24 14:56:47,055 - src.components.global_refiner - INFO - Refinement complete: 23 → 20 triplets (total: 26.35s, LLM: 26.34s)
2025-11-24 14:56:47,055 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 26.35s
2025-11-24 14:56:47,055 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:56:47,055 - src.pipeline.kg_builder - INFO - Pushing batch 46/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:56:47,055 - src.components.neo4j_handler - INFO - Adding 20 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:56:47,259 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:56:47,259 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:56:47,260 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:56:47,260 - src.components.neo4j_handler - INFO - Batch injected in 0.20s (triplets: 0.20s, indexes: 0.00s)
2025-11-24 14:56:47,260 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:56:47,333 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:56:47,417 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 588
2025-11-24 14:56:47,457 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 597, 'relationship_count': 2035, 'density': 0.0057, 'avg_degree': 6.8174, 'avg_unique_neighbors': 6.7404, 'global_efficiency': 0.3825, 'avg_path_length': 2.8195, 'avg_degree_centrality': 0.0114, 'max_degree_centrality': 0.5604, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0759, 'degree_assortativity': -0.1723, 'graph_robustness': 0.7017, 'diameter_estimate': 50, 'clustering_coefficient': 0.3204, 'weakly_connected_components': 10, 'largest_wcc_size': 588, 'pagerank_top10_percent': 5.68, 'louvain_communities': 24, 'louvain_modularity': 0.4296, 'label_entropy': 1.4741, 'computational_time': 0.1972709340043366}
2025-11-24 14:56:47,457 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 45, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967407.4578133, 'total_time': 31.580678311001975, 'aggregation': 2.4460023269057274e-06, 'network_info': 0.009833224990870804, 'llm_extraction': 31.168456518964376, 'data_cleaning': 1.6061007045209408e-05, 'neo4j_injection': 0.2046667829854414, 'embedding_time': 0, 'indexing_time': 0.004934706958010793, 'graph_injection_time': 0.1995674700010568, 'acs_metrics': {'node_count': 597, 'relationship_count': 2035, 'density': 0.0057, 'avg_degree': 6.8174, 'avg_unique_neighbors': 6.7404, 'global_efficiency': 0.3825, 'avg_path_length': 2.8195, 'avg_degree_centrality': 0.0114, 'max_degree_centrality': 0.5604, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0759, 'degree_assortativity': -0.1723, 'graph_robustness': 0.7017, 'diameter_estimate': 50, 'clustering_coefficient': 0.3204, 'weakly_connected_components': 10, 'largest_wcc_size': 588, 'pagerank_top10_percent': 5.68, 'louvain_communities': 24, 'louvain_modularity': 0.4296, 'label_entropy': 1.4741, 'computational_time': 0.1972709340043366}, 'retrieval_queries': []}
2025-11-24 14:56:47,457 - src.pipeline.kg_builder - DEBUG - Batch 45 metrics: {
  "batch_idx": 45,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967407.4578133,
  "total_time": 31.580678311001975,
  "aggregation": 2.4460023269057274e-06,
  "network_info": 0.009833224990870804,
  "llm_extraction": 31.168456518964376,
  "data_cleaning": 1.6061007045209408e-05,
  "neo4j_injection": 0.2046667829854414,
  "embedding_time": 0,
  "indexing_time": 0.004934706958010793,
  "graph_injection_time": 0.1995674700010568,
  "acs_metrics": {
    "node_count": 597,
    "relationship_count": 2035,
    "density": 0.0057,
    "avg_degree": 6.8174,
    "avg_unique_neighbors": 6.7404,
    "global_efficiency": 0.3825,
    "avg_path_length": 2.8195,
    "avg_degree_centrality": 0.0114,
    "max_degree_centrality": 0.5604,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0759,
    "degree_assortativity": -0.1723,
    "graph_robustness": 0.7017,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3204,
    "weakly_connected_components": 10,
    "largest_wcc_size": 588,
    "pagerank_top10_percent": 5.68,
    "louvain_communities": 24,
    "louvain_modularity": 0.4296,
    "label_entropy": 1.4741,
    "computational_time": 0.1972709340043366
  },
  "retrieval_queries": []
}
2025-11-24 14:56:47,458 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:56:47,458 - src.pipeline.kg_builder - INFO - Batch 46 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 31.17s, Clean: 0.00s, Neo4j: 0.20s, ACS: 0.20s
2025-11-24 14:56:47,458 - src.pipeline.kg_builder - INFO - Batch 46 completed in 31.58s
Processing KG batches:  64%|██████▍   | 46/72 [28:45<16:04, 37.09s/it]2025-11-24 14:56:47,458 - src.pipeline.kg_builder - INFO - Processing batch 47/72 (3 items)
2025-11-24 14:56:47,459 - src.pipeline.kg_builder - DEBUG - Batch 47 current_video_time: 11:38-11:43
2025-11-24 14:56:47,465 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 597
- Total Relationships: 680
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:56:47,466 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 14:56:47,466 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0 ~226 words, content: Time: 11:28-11:33 Content: The video captures a scientific procedure being performed in a laboratory setting. The sequence of events unfolds as follows: - **Initial Setup:**...
2025-11-24 14:56:47,466 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1 ~233 words, content: - **Broader Context:** The camera pulls back further, revealing more of the laboratory. The entire apparatus, including the balance, the flask, and the tubing, is...
2025-11-24 14:56:47,466 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2 ~233 words, content: of laboratory equipment. This equipment includes a glass flask, which is being held in place by a clamp attached to a metal stand. The flask...
2025-11-24 14:56:47,466 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3 ~238 words, content: stirring process is ongoing. In summary, the video shows a controlled laboratory experiment where a liquid is being transferred from a flask, which is being...
2025-11-24 14:56:47,466 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_4 ~88 words, content: with a clear liquid. The final frames show the tube submerged in the liquid within the measuring cup, indicating that the liquid is being pumped...
2025-11-24 14:56:47,466 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:56:47,467 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0) (~226 words) with timeout=5.0s retries=3
2025-11-24 14:56:49,362 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:56:49,362 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:56:49,362 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1) (~233 words) with timeout=5.0s retries=3
2025-11-24 14:56:50,570 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:56:50,570 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:56:50,571 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2) (~233 words) with timeout=5.0s retries=3
2025-11-24 14:56:51,970 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:56:51,970 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:56:51,970 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3) (~238 words) with timeout=5.0s retries=3
2025-11-24 14:56:53,126 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:56:53,126 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:56:53,127 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_4) (~88 words) with timeout=5.0s retries=3
2025-11-24 14:56:54,225 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:56:54,225 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:56:54,225 - src.components.pre_llm_injector - INFO - Extracted 29 local triplets from 5 chunks
2025-11-24 14:56:54,225 - src.pipeline.kg_builder - INFO - Pre-extraction: 29 triplets in 6.76s
2025-11-24 14:56:54,225 - src.components.global_refiner - INFO - Capping refinement input: 29 → 25 triplets
2025-11-24 14:56:54,225 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 597
- Total Relationships: 680
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Erlenmeyer_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0"]}, {"head": "Glass_Erlenmeyer_Flask", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Liquid_Mass", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Glass_Erlenmeyer_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0"]}, {"head": "Glass_Erlenmeyer_Flask", "relation": "Is Part Of", "tail": "Laboratory_Setup", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0"]}, {"head": "Camera", "relation": "Pulls Back", "tail": "Laboratory", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1"]}, {"head": "Apparatus", "relation": "Includes", "tail": "Balance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_4"]}, {"head": "Apparatus", "relation": "Includes", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1"]}, {"head": "Apparatus", "relation": "Includes", "tail": "Tubing", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1"]}, {"head": "Tubing", "relation": "Is Routed Over", "tail": "Metal_Stand", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1"]}, {"head": "Person", "relation": "Adjusts", "tail": "Apparatus", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1"]}, {"head": "Glass Flask", "relation": "Is Held By", "tail": "Clamp", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2"]}, {"head": "Clamp", "relation": "Is Attached To", "tail": "Metal Stand", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2"]}, {"head": "Magnetic Stirrer", "relation": "Has Display Reading", "tail": "0970", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2"]}, {"head": "Tube", "relation": "Connects", "tail": "Glass Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2"]}, {"head": "Tube", "relation": "Transfers Liquid To", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2"]}, {"head": "Liquid", "relation": "Is Transferred From", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3"]}, {"head": "Flask", "relation": "Is Stirred By", "tail": "Motorized Device", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3"]}, {"head": "Motorized Device", "relation": "Stirs", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3"]}, {"head": "Tube", "relation": "Connects", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3"]}, {"head": "Tube", "relation": "Passes Through", "tail": "Pump Assembly", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3"]}, {"head": "Pump Assembly", "relation": "Controls", "tail": "Liquid Flow", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3"]}, {"head": "Tube", "relation": "Submerged In", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:56:54,225 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~350 words, ~455 tokens)
2025-11-24 14:56:54,225 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:57:24,381 - src.components.global_refiner - DEBUG - LLM call completed in 30.16s
2025-11-24 14:57:24,381 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0']], ['Person', 'holds', 'Glass_Erlenmeyer_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0']], ['Glass_Erlenmeyer_Flask', 'is_on', 'Digital_Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0']], ['Digital_Balance', 'displays', 'Liquid_Mass', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0']], ['Liquid', 'is_transferred_to', 'Glass_Erlenmeyer_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0']], ['Glass_Erlenmeyer_Flask', 'is_part_of', 'Laboratory_Setup', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0']], ['Camera', 'pulls_back', 'Laboratory', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1']], ['Apparatus', 'includes', 'Balance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_4']], ['Apparatus', 'includes', 'Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1']], ['Apparatus', 'includes', 'Tubing', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1']], ['Tubing', 'is_routed_over', 'Metal_Stand', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1']], ['Person', 'adjusts', 'Apparatus', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1']], ['Glass_Flask', 'is_held_by', 'Clamp', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2']], ['Clamp', 'is_attached_to', 'Metal_Stand', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2']], ['Glass_Flask', 'is_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2']], ['Magnetic_Stirrer', 'has_display_reading', '0970', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2']], ['Tube', 'connects', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2']], ['Tube', 'transfers_liquid_to', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2']], ['Liquid', 'is_transferred_from', 'Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3']], ['Flask', 'is_stirred_by', 'Motorized_Device', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3']], ['Motorized_Device', 'stirs', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3']], ['Tube', 'connects', 'Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3']], ['Tube', 'passes_through', 'Pump_Assembly', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3']], ['Pump_Assembly', 'controls', 'Liquid_Flow', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3']], ['Tube', 'is_submerged_in', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_4']]]
2025-11-24 14:57:24,381 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Erlenmeyer_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0"
    ]
  ],
  [
    "Glass_Erlenmeyer_Flask",
    "is_on",
    "Digital_Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "Liquid_Mass",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0"
    ]
  ],
  [
    "Liquid",
    "is_transferred_to",
    "Glass_Erlenmeyer_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0"
    ]
  ],
  [
    "Glass_Erlenmeyer_Flask",
    "is_part_of",
    "Laboratory_Setup",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_0"
    ]
  ],
  [
    "Camera",
    "pulls_back",
    "Laboratory",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1"
    ]
  ],
  [
    "Apparatus",
    "includes",
    "Balance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_4"
    ]
  ],
  [
    "Apparatus",
    "includes",
    "Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1"
    ]
  ],
  [
    "Apparatus",
    "includes",
    "Tubing",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1"
    ]
  ],
  [
    "Tubing",
    "is_routed_over",
    "Metal_Stand",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1"
    ]
  ],
  [
    "Person",
    "adjusts",
    "Apparatus",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_1"
    ]
  ],
  [
    "Glass_Flask",
    "is_held_by",
    "Clamp",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2"
    ]
  ],
  [
    "Clamp",
    "is_attached_to",
    "Metal_Stand",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2"
    ]
  ],
  [
    "Glass_Flask",
    "is_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "has_display_reading",
    "0970",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2"
    ]
  ],
  [
    "Tube",
    "connects",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2"
    ]
  ],
  [
    "Tube",
    "transfers_liquid_to",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_2"
    ]
  ],
  [
    "Liquid",
    "is_transferred_from",
    "Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3"
    ]
  ],
  [
    "Flask",
    "is_stirred_by",
    "Motorized_Device",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3"
    ]
  ],
  [
    "Motorized_Device",
    "stirs",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3"
    ]
  ],
  [
    "Tube",
    "connects",
    "Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3"
    ]
  ],
  [
    "Tube",
    "passes_through",
    "Pump_Assembly",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3"
    ]
  ],
  [
    "Pump_Assembly",
    "controls",
    "Liquid_Flow",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_3"
    ]
  ],
  [
    "Tube",
    "is_submerged_in",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_46_4"
    ]
  ]
]
2025-11-24 14:57:24,381 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 30.16s, LLM: 30.16s)
2025-11-24 14:57:24,381 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 30.16s
2025-11-24 14:57:24,381 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:57:24,381 - src.pipeline.kg_builder - INFO - Pushing batch 47/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:57:24,381 - src.components.neo4j_handler - INFO - Adding 25 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:57:24,691 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:57:24,692 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:57:24,692 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:57:24,692 - src.components.neo4j_handler - INFO - Batch injected in 0.31s (triplets: 0.31s, indexes: 0.01s)
2025-11-24 14:57:24,692 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:57:24,746 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:57:24,834 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 598
2025-11-24 14:57:24,875 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 607, 'relationship_count': 2090, 'density': 0.0057, 'avg_degree': 6.8863, 'avg_unique_neighbors': 6.8105, 'global_efficiency': 0.3851, 'avg_path_length': 2.8075, 'avg_degree_centrality': 0.0114, 'max_degree_centrality': 0.5578, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0816, 'degree_assortativity': -0.1674, 'graph_robustness': 0.6971, 'diameter_estimate': 50, 'clustering_coefficient': 0.3183, 'weakly_connected_components': 10, 'largest_wcc_size': 598, 'pagerank_top10_percent': 5.58, 'louvain_communities': 25, 'louvain_modularity': 0.4132, 'label_entropy': 1.475, 'computational_time': 0.1834285199875012}
2025-11-24 14:57:24,876 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 46, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967444.8760278, 'total_time': 37.41703846200835, 'aggregation': 2.7120113372802734e-06, 'network_info': 0.0068513110163621604, 'llm_extraction': 36.91533721802989, 'data_cleaning': 1.882604556158185e-05, 'neo4j_injection': 0.3109247130341828, 'embedding_time': 0, 'indexing_time': 0.005557747033890337, 'graph_injection_time': 0.3052233979688026, 'acs_metrics': {'node_count': 607, 'relationship_count': 2090, 'density': 0.0057, 'avg_degree': 6.8863, 'avg_unique_neighbors': 6.8105, 'global_efficiency': 0.3851, 'avg_path_length': 2.8075, 'avg_degree_centrality': 0.0114, 'max_degree_centrality': 0.5578, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0816, 'degree_assortativity': -0.1674, 'graph_robustness': 0.6971, 'diameter_estimate': 50, 'clustering_coefficient': 0.3183, 'weakly_connected_components': 10, 'largest_wcc_size': 598, 'pagerank_top10_percent': 5.58, 'louvain_communities': 25, 'louvain_modularity': 0.4132, 'label_entropy': 1.475, 'computational_time': 0.1834285199875012}, 'retrieval_queries': []}
2025-11-24 14:57:24,876 - src.pipeline.kg_builder - DEBUG - Batch 46 metrics: {
  "batch_idx": 46,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967444.8760278,
  "total_time": 37.41703846200835,
  "aggregation": 2.7120113372802734e-06,
  "network_info": 0.0068513110163621604,
  "llm_extraction": 36.91533721802989,
  "data_cleaning": 1.882604556158185e-05,
  "neo4j_injection": 0.3109247130341828,
  "embedding_time": 0,
  "indexing_time": 0.005557747033890337,
  "graph_injection_time": 0.3052233979688026,
  "acs_metrics": {
    "node_count": 607,
    "relationship_count": 2090,
    "density": 0.0057,
    "avg_degree": 6.8863,
    "avg_unique_neighbors": 6.8105,
    "global_efficiency": 0.3851,
    "avg_path_length": 2.8075,
    "avg_degree_centrality": 0.0114,
    "max_degree_centrality": 0.5578,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0816,
    "degree_assortativity": -0.1674,
    "graph_robustness": 0.6971,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3183,
    "weakly_connected_components": 10,
    "largest_wcc_size": 598,
    "pagerank_top10_percent": 5.58,
    "louvain_communities": 25,
    "louvain_modularity": 0.4132,
    "label_entropy": 1.475,
    "computational_time": 0.1834285199875012
  },
  "retrieval_queries": []
}
2025-11-24 14:57:24,877 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:57:24,877 - src.pipeline.kg_builder - INFO - Batch 47 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 36.92s, Clean: 0.00s, Neo4j: 0.31s, ACS: 0.18s
2025-11-24 14:57:24,877 - src.pipeline.kg_builder - INFO - Batch 47 completed in 37.42s
Processing KG batches:  65%|██████▌   | 47/72 [29:22<15:29, 37.19s/it]2025-11-24 14:57:24,877 - src.pipeline.kg_builder - INFO - Processing batch 48/72 (3 items)
2025-11-24 14:57:24,877 - src.pipeline.kg_builder - DEBUG - Batch 48 current_video_time: 11:53-11:58
2025-11-24 14:57:24,887 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 607
- Total Relationships: 704
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:57:24,888 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 14:57:24,888 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0 ~241 words, content: Time: 11:43-11:48 Content: The video captures a scene in a laboratory or workshop setting, focusing on a scientific experiment involving fluid transfer. The camera is...
2025-11-24 14:57:24,888 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1 ~226 words, content: plastic bag containing small components, and a glass rod. The overall impression is that of an active workspace where an experiment is in progress. Time:...
2025-11-24 14:57:24,888 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2 ~233 words, content: **Final Scene (Frames 4-5):** The camera settles on a clear view of the experiment. A glass beaker is positioned on a white, electronic device, which...
2025-11-24 14:57:24,888 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3 ~168 words, content: , which is part of a setup that appears to be a gas delivery system. The camera angle shifts slightly, providing a broader view of...
2025-11-24 14:57:24,888 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:57:24,888 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0) (~241 words) with timeout=5.0s retries=3
2025-11-24 14:57:25,841 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:57:25,841 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:57:25,842 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1) (~226 words) with timeout=5.0s retries=3
2025-11-24 14:57:27,029 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:57:27,029 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:57:27,030 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2) (~233 words) with timeout=5.0s retries=3
2025-11-24 14:57:28,286 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:57:28,286 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:57:28,287 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3) (~168 words) with timeout=5.0s retries=3
2025-11-24 14:57:29,365 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:57:29,365 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:57:29,365 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-24 14:57:29,365 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 4.48s
2025-11-24 14:57:29,366 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 607
- Total Relationships: 704
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0"]}, {"head": "Pump", "relation": "Connected To", "tail": "Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0"]}, {"head": "Tube", "relation": "Inserted Into", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0"]}, {"head": "Container", "relation": "Contains", "tail": "Water", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0"]}, {"head": "Workbench", "relation": "Holds", "tail": "Pump", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0"]}, {"head": "Workbench", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0"]}, {"head": "Plastic Bag", "relation": "Contains", "tail": "Small Components", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1"]}, {"head": "Glass Rod", "relation": "Is In", "tail": "Plastic Bag", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1"]}, {"head": "Lab Bench", "relation": "Has", "tail": "Clear Plastic Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1"]}, {"head": "Clear Plastic Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1"]}, {"head": "Tube", "relation": "Is Submerged In", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1"]}, {"head": "Glass Beaker", "relation": "Contains", "tail": "Red Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Foamy Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2"]}, {"head": "Tube", "relation": "Is Inserted Into", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2"]}, {"head": "Metal Rod", "relation": "Is Part Of", "tail": "Gas Delivery System", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2"]}, {"head": "Apparatus", "relation": "Contains", "tail": "Tape", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2"]}, {"head": "Experiment", "relation": "Involves", "tail": "Chemical Reaction", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2"]}, {"head": "Gas Delivery System", "relation": "Includes", "tail": "Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3"]}, {"head": "Tube", "relation": "Leads To", "tail": "Collection Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3"]}, {"head": "Collection Container", "relation": "Contains", "tail": "Water", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3"]}, {"head": "Reaction Beaker", "relation": "Produces", "tail": "Gas", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3"]}, {"head": "Gas", "relation": "Displaces", "tail": "Water", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3"]}, {"head": "Gas", "relation": "Is Collected In", "tail": "Collection Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:57:29,366 - src.components.global_refiner - DEBUG - Refining 24 triplets (prompt ~343 words, ~446 tokens)
2025-11-24 14:57:29,366 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:57:56,296 - src.components.global_refiner - DEBUG - LLM call completed in 26.93s
2025-11-24 14:57:56,296 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Tube', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0']], ['Pump', 'connected_to', 'Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0']], ['Tube', 'inserted_into', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0']], ['Container', 'contains', 'Water', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0']], ['Workbench', 'holds', 'Pump', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0']], ['Workbench', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0']], ['Plastic_Bag', 'contains', 'Small_Components', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1']], ['Glass_Rod', 'is_in', 'Plastic_Bag', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1']], ['Lab_Bench', 'has', 'Clear_Plastic_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1']], ['Clear_Plastic_Container', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1']], ['Tube', 'is_submerged_in', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1']], ['Glass_Beaker', 'contains', 'Red_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1']], ['Beaker', 'is_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2']], ['Beaker', 'contains', 'Foamy_Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2']], ['Tube', 'is_inserted_into', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2']], ['Metal_Rod', 'is_part_of', 'Gas_Delivery_System', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2']], ['Apparatus', 'contains', 'Tape', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2']], ['Experiment', 'involves', 'Chemical_Reaction', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2']], ['Gas_Delivery_System', 'includes', 'Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3']], ['Tube', 'leads_to', 'Collection_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3']], ['Collection_Container', 'contains', 'Water', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3']], ['Reaction_Beaker', 'produces', 'Gas', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3']], ['Gas', 'displaces', 'Water', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3']], ['Gas', 'is_collected_in', 'Collection_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3']]]
2025-11-24 14:57:56,296 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Tube",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0"
    ]
  ],
  [
    "Pump",
    "connected_to",
    "Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0"
    ]
  ],
  [
    "Tube",
    "inserted_into",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0"
    ]
  ],
  [
    "Container",
    "contains",
    "Water",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0"
    ]
  ],
  [
    "Workbench",
    "holds",
    "Pump",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0"
    ]
  ],
  [
    "Workbench",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_0"
    ]
  ],
  [
    "Plastic_Bag",
    "contains",
    "Small_Components",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1"
    ]
  ],
  [
    "Glass_Rod",
    "is_in",
    "Plastic_Bag",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1"
    ]
  ],
  [
    "Lab_Bench",
    "has",
    "Clear_Plastic_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1"
    ]
  ],
  [
    "Clear_Plastic_Container",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1"
    ]
  ],
  [
    "Tube",
    "is_submerged_in",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1"
    ]
  ],
  [
    "Glass_Beaker",
    "contains",
    "Red_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_1"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Foamy_Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2"
    ]
  ],
  [
    "Tube",
    "is_inserted_into",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2"
    ]
  ],
  [
    "Metal_Rod",
    "is_part_of",
    "Gas_Delivery_System",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2"
    ]
  ],
  [
    "Apparatus",
    "contains",
    "Tape",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2"
    ]
  ],
  [
    "Experiment",
    "involves",
    "Chemical_Reaction",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_2"
    ]
  ],
  [
    "Gas_Delivery_System",
    "includes",
    "Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3"
    ]
  ],
  [
    "Tube",
    "leads_to",
    "Collection_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3"
    ]
  ],
  [
    "Collection_Container",
    "contains",
    "Water",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3"
    ]
  ],
  [
    "Reaction_Beaker",
    "produces",
    "Gas",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3"
    ]
  ],
  [
    "Gas",
    "displaces",
    "Water",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3"
    ]
  ],
  [
    "Gas",
    "is_collected_in",
    "Collection_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_47_3"
    ]
  ]
]
2025-11-24 14:57:56,297 - src.components.global_refiner - INFO - Refinement complete: 24 → 24 triplets (total: 26.93s, LLM: 26.93s)
2025-11-24 14:57:56,297 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 26.93s
2025-11-24 14:57:56,297 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:57:56,297 - src.pipeline.kg_builder - INFO - Pushing batch 48/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:57:56,297 - src.components.neo4j_handler - INFO - Adding 24 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:57:56,585 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:57:56,585 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:57:56,586 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:57:56,586 - src.components.neo4j_handler - INFO - Batch injected in 0.29s (triplets: 0.29s, indexes: 0.00s)
2025-11-24 14:57:56,586 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:57:56,640 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:57:56,732 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 616
2025-11-24 14:57:56,775 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 625, 'relationship_count': 2142, 'density': 0.0055, 'avg_degree': 6.8544, 'avg_unique_neighbors': 6.7808, 'global_efficiency': 0.381, 'avg_path_length': 2.8253, 'avg_degree_centrality': 0.011, 'max_degree_centrality': 0.5417, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0876, 'degree_assortativity': -0.1619, 'graph_robustness': 0.6984, 'diameter_estimate': 50, 'clustering_coefficient': 0.3185, 'weakly_connected_components': 10, 'largest_wcc_size': 616, 'pagerank_top10_percent': 5.39, 'louvain_communities': 25, 'louvain_modularity': 0.4219, 'label_entropy': 1.4733, 'computational_time': 0.1897703689755872}
2025-11-24 14:57:56,776 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 47, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967476.7761824, 'total_time': 31.898942381027155, 'aggregation': 2.8850045055150986e-06, 'network_info': 0.010345290007535368, 'llm_extraction': 31.409338671015576, 'data_cleaning': 1.7431972082704306e-05, 'neo4j_injection': 0.2890811469987966, 'embedding_time': 0, 'indexing_time': 0.0036190359969623387, 'graph_injection_time': 0.28531388397095725, 'acs_metrics': {'node_count': 625, 'relationship_count': 2142, 'density': 0.0055, 'avg_degree': 6.8544, 'avg_unique_neighbors': 6.7808, 'global_efficiency': 0.381, 'avg_path_length': 2.8253, 'avg_degree_centrality': 0.011, 'max_degree_centrality': 0.5417, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0876, 'degree_assortativity': -0.1619, 'graph_robustness': 0.6984, 'diameter_estimate': 50, 'clustering_coefficient': 0.3185, 'weakly_connected_components': 10, 'largest_wcc_size': 616, 'pagerank_top10_percent': 5.39, 'louvain_communities': 25, 'louvain_modularity': 0.4219, 'label_entropy': 1.4733, 'computational_time': 0.1897703689755872}, 'retrieval_queries': []}
2025-11-24 14:57:56,776 - src.pipeline.kg_builder - DEBUG - Batch 47 metrics: {
  "batch_idx": 47,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967476.7761824,
  "total_time": 31.898942381027155,
  "aggregation": 2.8850045055150986e-06,
  "network_info": 0.010345290007535368,
  "llm_extraction": 31.409338671015576,
  "data_cleaning": 1.7431972082704306e-05,
  "neo4j_injection": 0.2890811469987966,
  "embedding_time": 0,
  "indexing_time": 0.0036190359969623387,
  "graph_injection_time": 0.28531388397095725,
  "acs_metrics": {
    "node_count": 625,
    "relationship_count": 2142,
    "density": 0.0055,
    "avg_degree": 6.8544,
    "avg_unique_neighbors": 6.7808,
    "global_efficiency": 0.381,
    "avg_path_length": 2.8253,
    "avg_degree_centrality": 0.011,
    "max_degree_centrality": 0.5417,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0876,
    "degree_assortativity": -0.1619,
    "graph_robustness": 0.6984,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3185,
    "weakly_connected_components": 10,
    "largest_wcc_size": 616,
    "pagerank_top10_percent": 5.39,
    "louvain_communities": 25,
    "louvain_modularity": 0.4219,
    "label_entropy": 1.4733,
    "computational_time": 0.1897703689755872
  },
  "retrieval_queries": []
}
2025-11-24 14:57:56,777 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:57:56,777 - src.pipeline.kg_builder - INFO - Batch 48 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 31.41s, Clean: 0.00s, Neo4j: 0.29s, ACS: 0.19s
2025-11-24 14:57:56,777 - src.pipeline.kg_builder - INFO - Batch 48 completed in 31.90s
Processing KG batches:  67%|██████▋   | 48/72 [29:54<14:14, 35.60s/it]2025-11-24 14:57:56,777 - src.pipeline.kg_builder - INFO - Processing batch 49/72 (3 items)
2025-11-24 14:57:56,777 - src.pipeline.kg_builder - DEBUG - Batch 49 current_video_time: 12:08-12:13
2025-11-24 14:57:56,788 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 625
- Total Relationships: 726
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:57:56,788 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 14:57:56,788 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0 ~247 words, content: Time: 11:58-12:03 Content: The video sequence captures a scientific experiment being conducted in a laboratory setting. The scene is set on a black laboratory bench,...
2025-11-24 14:57:56,788 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1 ~241 words, content: a well-equipped laboratory. - The video captures the process of a scientific experiment, with the equipment and materials being used to conduct the experiment. The...
2025-11-24 14:57:56,788 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2 ~227 words, content: rer, a blue stand holds a metal rod, which is part of a larger apparatus, possibly for titration or another measurement. Other items on the...
2025-11-24 14:57:56,788 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3 ~132 words, content: next stage of the process. The flexible tube, which was initially in the flask, is now shown extending across the lab bench. It is being...
2025-11-24 14:57:56,788 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:57:56,789 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0) (~247 words) with timeout=5.0s retries=3
2025-11-24 14:57:57,879 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:57:57,879 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:57:57,879 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1) (~241 words) with timeout=5.0s retries=3
2025-11-24 14:57:59,310 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:57:59,310 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:57:59,310 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2) (~227 words) with timeout=5.0s retries=3
2025-11-24 14:58:00,778 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:58:00,778 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:58:00,779 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3) (~132 words) with timeout=5.0s retries=3
2025-11-24 14:58:01,979 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:58:01,980 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:58:01,980 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-24 14:58:01,980 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 5.19s
2025-11-24 14:58:01,980 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 625
- Total Relationships: 726
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Laboratory Bench", "relation": "Contains", "tail": "Plastic Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0"]}, {"head": "Plastic Container", "relation": "Contains", "tail": "Water", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0"]}, {"head": "Equipment", "relation": "Connected To", "tail": "Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0"]}, {"head": "Equipment", "relation": "Has", "tail": "Digital Display", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0"]}, {"head": "Glass Container", "relation": "Placed On", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0"]}, {"head": "Liquid", "relation": "Stirred By", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1"]}, {"head": "Equipment", "relation": "Includes", "tail": "Erlenmeyer Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1"]}, {"head": "Erlenmeyer Flask", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1"]}, {"head": "Magnetic Stirrer", "relation": "Is Part Of", "tail": "Hot Plate", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1"]}, {"head": "Hot Plate", "relation": "Displays", "tail": "Temperature", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1"]}, {"head": "Temperature", "relation": "Is Set To", "tail": "70.0 Degrees Celsius", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1"]}, {"head": "Glass Flask", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2"]}, {"head": "Magnetic Stirrer", "relation": "Is Operating", "tail": "Glass Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2"]}, {"head": "Blue Stand", "relation": "Holds", "tail": "Metal Rod", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2"]}, {"head": "Metal Rod", "relation": "Is Part Of", "tail": "Larger Apparatus", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2"]}, {"head": "Larger Apparatus", "relation": "Is Used For", "tail": "Titration Or Measurement", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2"]}, {"head": "Tube", "relation": "Extends Across", "tail": "Lab_Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3"]}, {"head": "Tube", "relation": "Channels", "tail": "Gas", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3"]}, {"head": "Gas", "relation": "Is Collected In", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Water", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3"]}, {"head": "Tube", "relation": "Is Submerged In", "tail": "Water", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3"]}, {"head": "Beaker", "relation": "Is Inverted", "tail": "Lab_Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:58:01,980 - src.components.global_refiner - DEBUG - Refining 24 triplets (prompt ~354 words, ~460 tokens)
2025-11-24 14:58:01,980 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:58:29,470 - src.components.global_refiner - DEBUG - LLM call completed in 27.49s
2025-11-24 14:58:29,470 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['laboratory_bench', 'contains', 'plastic_container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0']], ['plastic_container', 'contains', 'water', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0']], ['equipment', 'connected_to', 'tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0']], ['equipment', 'has', 'digital_display', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0']], ['glass_container', 'placed_on', 'equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0']], ['liquid', 'stirred_by', 'magnetic_stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0']], ['laboratory', 'contains', 'equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1']], ['equipment', 'includes', 'erlenmeyer_flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1']], ['erlenmeyer_flask', 'is_on', 'magnetic_stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1']], ['magnetic_stirrer', 'is_part_of', 'hot_plate', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1']], ['hot_plate', 'displays', 'temperature', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1']], ['temperature', 'is_set_to', '70.0_degrees_celsius', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1']], ['glass_flask', 'contains', 'clear_liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2']], ['glass_flask', 'is_on', 'magnetic_stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2']], ['magnetic_stirrer', 'is_operating', 'glass_flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2']], ['blue_stand', 'holds', 'metal_rod', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2']], ['metal_rod', 'is_part_of', 'larger_apparatus', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2']], ['larger_apparatus', 'is_used_for', 'titration_or_measurement', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2']], ['tube', 'extends_across', 'lab_bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3']], ['tube', 'channels', 'gas', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3']], ['gas', 'is_collected_in', 'beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3']], ['beaker', 'contains', 'water', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3']], ['tube', 'is_submerged_in', 'water', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3']], ['beaker', 'is_inverted', 'lab_bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3']]]
2025-11-24 14:58:29,470 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "laboratory_bench",
    "contains",
    "plastic_container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0"
    ]
  ],
  [
    "plastic_container",
    "contains",
    "water",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0"
    ]
  ],
  [
    "equipment",
    "connected_to",
    "tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0"
    ]
  ],
  [
    "equipment",
    "has",
    "digital_display",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0"
    ]
  ],
  [
    "glass_container",
    "placed_on",
    "equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0"
    ]
  ],
  [
    "liquid",
    "stirred_by",
    "magnetic_stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_0"
    ]
  ],
  [
    "laboratory",
    "contains",
    "equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1"
    ]
  ],
  [
    "equipment",
    "includes",
    "erlenmeyer_flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1"
    ]
  ],
  [
    "erlenmeyer_flask",
    "is_on",
    "magnetic_stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1"
    ]
  ],
  [
    "magnetic_stirrer",
    "is_part_of",
    "hot_plate",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1"
    ]
  ],
  [
    "hot_plate",
    "displays",
    "temperature",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1"
    ]
  ],
  [
    "temperature",
    "is_set_to",
    "70.0_degrees_celsius",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_1"
    ]
  ],
  [
    "glass_flask",
    "contains",
    "clear_liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2"
    ]
  ],
  [
    "glass_flask",
    "is_on",
    "magnetic_stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2"
    ]
  ],
  [
    "magnetic_stirrer",
    "is_operating",
    "glass_flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2"
    ]
  ],
  [
    "blue_stand",
    "holds",
    "metal_rod",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2"
    ]
  ],
  [
    "metal_rod",
    "is_part_of",
    "larger_apparatus",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2"
    ]
  ],
  [
    "larger_apparatus",
    "is_used_for",
    "titration_or_measurement",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_2"
    ]
  ],
  [
    "tube",
    "extends_across",
    "lab_bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3"
    ]
  ],
  [
    "tube",
    "channels",
    "gas",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3"
    ]
  ],
  [
    "gas",
    "is_collected_in",
    "beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3"
    ]
  ],
  [
    "beaker",
    "contains",
    "water",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3"
    ]
  ],
  [
    "tube",
    "is_submerged_in",
    "water",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3"
    ]
  ],
  [
    "beaker",
    "is_inverted",
    "lab_bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_48_3"
    ]
  ]
]
2025-11-24 14:58:29,470 - src.components.global_refiner - INFO - Refinement complete: 24 → 24 triplets (total: 27.49s, LLM: 27.49s)
2025-11-24 14:58:29,470 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 27.49s
2025-11-24 14:58:29,470 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:58:29,470 - src.pipeline.kg_builder - INFO - Pushing batch 49/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:58:29,470 - src.components.neo4j_handler - INFO - Adding 24 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:58:29,731 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:58:29,731 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:58:29,731 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:58:29,731 - src.components.neo4j_handler - INFO - Batch injected in 0.26s (triplets: 0.26s, indexes: 0.00s)
2025-11-24 14:58:29,731 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:58:29,784 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:58:29,875 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 628
2025-11-24 14:58:29,917 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 637, 'relationship_count': 2191, 'density': 0.0054, 'avg_degree': 6.8791, 'avg_unique_neighbors': 6.8006, 'global_efficiency': 0.3793, 'avg_path_length': 2.8658, 'avg_degree_centrality': 0.0108, 'max_degree_centrality': 0.5314, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0713, 'degree_assortativity': -0.1579, 'graph_robustness': 0.6983, 'diameter_estimate': 50, 'clustering_coefficient': 0.3193, 'weakly_connected_components': 10, 'largest_wcc_size': 628, 'pagerank_top10_percent': 5.28, 'louvain_communities': 25, 'louvain_modularity': 0.4313, 'label_entropy': 1.4731, 'computational_time': 0.18568956799572334}
2025-11-24 14:58:29,917 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 48, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967509.9177136, 'total_time': 33.140336586977355, 'aggregation': 2.8869835659861565e-06, 'network_info': 0.01088819099823013, 'llm_extraction': 32.68200834299205, 'data_cleaning': 1.755898119881749e-05, 'neo4j_injection': 0.26130473299417645, 'embedding_time': 0, 'indexing_time': 0.0030890359776094556, 'graph_injection_time': 0.2580676049692556, 'acs_metrics': {'node_count': 637, 'relationship_count': 2191, 'density': 0.0054, 'avg_degree': 6.8791, 'avg_unique_neighbors': 6.8006, 'global_efficiency': 0.3793, 'avg_path_length': 2.8658, 'avg_degree_centrality': 0.0108, 'max_degree_centrality': 0.5314, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0713, 'degree_assortativity': -0.1579, 'graph_robustness': 0.6983, 'diameter_estimate': 50, 'clustering_coefficient': 0.3193, 'weakly_connected_components': 10, 'largest_wcc_size': 628, 'pagerank_top10_percent': 5.28, 'louvain_communities': 25, 'louvain_modularity': 0.4313, 'label_entropy': 1.4731, 'computational_time': 0.18568956799572334}, 'retrieval_queries': []}
2025-11-24 14:58:29,917 - src.pipeline.kg_builder - DEBUG - Batch 48 metrics: {
  "batch_idx": 48,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967509.9177136,
  "total_time": 33.140336586977355,
  "aggregation": 2.8869835659861565e-06,
  "network_info": 0.01088819099823013,
  "llm_extraction": 32.68200834299205,
  "data_cleaning": 1.755898119881749e-05,
  "neo4j_injection": 0.26130473299417645,
  "embedding_time": 0,
  "indexing_time": 0.0030890359776094556,
  "graph_injection_time": 0.2580676049692556,
  "acs_metrics": {
    "node_count": 637,
    "relationship_count": 2191,
    "density": 0.0054,
    "avg_degree": 6.8791,
    "avg_unique_neighbors": 6.8006,
    "global_efficiency": 0.3793,
    "avg_path_length": 2.8658,
    "avg_degree_centrality": 0.0108,
    "max_degree_centrality": 0.5314,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0713,
    "degree_assortativity": -0.1579,
    "graph_robustness": 0.6983,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3193,
    "weakly_connected_components": 10,
    "largest_wcc_size": 628,
    "pagerank_top10_percent": 5.28,
    "louvain_communities": 25,
    "louvain_modularity": 0.4313,
    "label_entropy": 1.4731,
    "computational_time": 0.18568956799572334
  },
  "retrieval_queries": []
}
2025-11-24 14:58:29,918 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:58:29,918 - src.pipeline.kg_builder - INFO - Batch 49 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 32.68s, Clean: 0.00s, Neo4j: 0.26s, ACS: 0.19s
2025-11-24 14:58:29,918 - src.pipeline.kg_builder - INFO - Batch 49 completed in 33.14s
Processing KG batches:  68%|██████▊   | 49/72 [30:27<13:21, 34.86s/it]2025-11-24 14:58:29,918 - src.pipeline.kg_builder - INFO - Processing batch 50/72 (3 items)
2025-11-24 14:58:29,918 - src.pipeline.kg_builder - DEBUG - Batch 50 current_video_time: 12:23-12:28
2025-11-24 14:58:29,929 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 637
- Total Relationships: 747
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:58:29,929 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-24 14:58:29,929 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0 ~245 words, content: Time: 12:13-12:18 Content: The video captures a sequence of events in a laboratory setting, focusing on a scientific experiment involving a chemical reaction or a...
2025-11-24 14:58:29,929 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1 ~244 words, content: water. This suggests that the experiment involves a chemical reaction or a process that produces a gas or a liquid that needs to be collected...
2025-11-24 14:58:29,929 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2 ~244 words, content: , a digital device with a control panel, is actively stirring the contents of the flask. The digital display on this device shows a reading...
2025-11-24 14:58:29,929 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3 ~207 words, content: captures a continuous process in a laboratory setting, focusing on a chemical experiment involving a reflux or distillation setup. The camera's perspective shifts slightly across...
2025-11-24 14:58:29,929 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_4 ~206 words, content: In the background, there are white **cabinets** and a **glass-enclosed cabinet** (a fume hood or a storage cabinet) with various items on shelves. - The...
2025-11-24 14:58:29,929 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_5 ~54 words, content: shows a laboratory experiment where a chemical reaction is being conducted in a round-bottom flask. The setup is designed to heat the mixture, vaporize a...
2025-11-24 14:58:29,929 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:58:29,930 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0) (~245 words) with timeout=5.0s retries=3
2025-11-24 14:58:31,013 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:58:31,013 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:58:31,013 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1) (~244 words) with timeout=5.0s retries=3
2025-11-24 14:58:32,129 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:58:32,129 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:58:32,130 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2) (~244 words) with timeout=5.0s retries=3
2025-11-24 14:58:33,133 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:58:33,133 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:58:33,134 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3) (~207 words) with timeout=5.0s retries=3
2025-11-24 14:58:34,658 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:58:34,658 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:58:34,659 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_4) (~206 words) with timeout=5.0s retries=3
2025-11-24 14:58:35,703 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 14:58:35,703 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 14:58:35,704 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_5) (~54 words) with timeout=5.0s retries=3
2025-11-24 14:58:36,924 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-24 14:58:36,925 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-24 14:58:36,925 - src.components.pre_llm_injector - INFO - Extracted 35 local triplets from 6 chunks
2025-11-24 14:58:36,925 - src.pipeline.kg_builder - INFO - Pre-extraction: 35 triplets in 7.00s
2025-11-24 14:58:36,925 - src.components.global_refiner - INFO - Capping refinement input: 35 → 25 triplets
2025-11-24 14:58:36,926 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 637
- Total Relationships: 747
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Laboratory Table", "relation": "Contains", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0"]}, {"head": "Equipment", "relation": "Includes", "tail": "Plastic Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0"]}, {"head": "Plastic Container", "relation": "Contains", "tail": "Water", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1"]}, {"head": "Glass Container", "relation": "Connected To", "tail": "Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0"]}, {"head": "Tube", "relation": "Connected To", "tail": "Glass Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0"]}, {"head": "Glass Container", "relation": "Placed On", "tail": "White Device", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0"]}, {"head": "Glass Container", "relation": "Produces", "tail": "Foam", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1"]}, {"head": "Foam", "relation": "Is Collected In", "tail": "Plastic Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1"]}, {"head": "Glass Container", "relation": "Connected To", "tail": "Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1"]}, {"head": "Tube", "relation": "Leads To", "tail": "Plastic Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1"]}, {"head": "Experiment", "relation": "Takes Place In", "tail": "Laboratory", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1"]}, {"head": "Digital Device", "relation": "Stirs", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2"]}, {"head": "Digital Device", "relation": "Displays", "tail": "Time", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2"]}, {"head": "Flask", "relation": "Produces", "tail": "Foam", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2"]}, {"head": "Tube", "relation": "Connects", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2"]}, {"head": "Blue Base", "relation": "Supports", "tail": "Metal Rod", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Glass Cabinet", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2"]}, {"head": "Round-Bottom Flask", "relation": "Is On", "tail": "Hot Plate Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3"]}, {"head": "Condenser", "relation": "Is Connected To", "tail": "Round-Bottom Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3"]}, {"head": "Condenser", "relation": "Is Connected To", "tail": "Long Flexible Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3"]}, {"head": "Long Flexible Tube", "relation": "Leads To", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3"]}, {"head": "Apparatus", "relation": "Is Held By", "tail": "Ring Stand", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3"]}, {"head": "Apparatus", "relation": "Is On", "tail": "Laboratory Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Digital Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_4"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:58:36,926 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~364 words, ~473 tokens)
2025-11-24 14:58:36,926 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:59:06,126 - src.components.global_refiner - DEBUG - LLM call completed in 29.20s
2025-11-24 14:59:06,126 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['laboratory_table', 'contains', 'equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0']], ['equipment', 'includes', 'plastic_container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0']], ['plastic_container', 'contains', 'water', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1']], ['glass_container', 'connected_to', 'tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0']], ['tube', 'connected_to', 'glass_container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0']], ['glass_container', 'placed_on', 'white_device', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0']], ['glass_container', 'produces', 'foam', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1']], ['foam', 'is_collected_in', 'plastic_container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1']], ['glass_container', 'connected_to', 'tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1']], ['tube', 'leads_to', 'plastic_container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1']], ['experiment', 'takes_place_in', 'laboratory', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1']], ['digital_device', 'stirs', 'flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2']], ['digital_device', 'displays', 'time', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2']], ['flask', 'produces', 'foam', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2']], ['tube', 'connects', 'flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2']], ['blue_base', 'supports', 'metal_rod', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2']], ['lab_bench', 'contains', 'glass_cabinet', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2']], ['round_bottom_flask', 'is_on', 'hot_plate_stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3']], ['condenser', 'is_connected_to', 'round_bottom_flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3']], ['condenser', 'is_connected_to', 'long_flexible_tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3']], ['long_flexible_tube', 'leads_to', 'beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3']], ['apparatus', 'is_held_by', 'ring_stand', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3']], ['apparatus', 'is_on', 'laboratory_bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3']], ['lab_bench', 'contains', 'digital_scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_4']], ['lab_bench', 'contains', 'beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_4']]]
2025-11-24 14:59:06,126 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "laboratory_table",
    "contains",
    "equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0"
    ]
  ],
  [
    "equipment",
    "includes",
    "plastic_container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0"
    ]
  ],
  [
    "plastic_container",
    "contains",
    "water",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1"
    ]
  ],
  [
    "glass_container",
    "connected_to",
    "tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0"
    ]
  ],
  [
    "tube",
    "connected_to",
    "glass_container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0"
    ]
  ],
  [
    "glass_container",
    "placed_on",
    "white_device",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_0"
    ]
  ],
  [
    "glass_container",
    "produces",
    "foam",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1"
    ]
  ],
  [
    "foam",
    "is_collected_in",
    "plastic_container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1"
    ]
  ],
  [
    "glass_container",
    "connected_to",
    "tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1"
    ]
  ],
  [
    "tube",
    "leads_to",
    "plastic_container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1"
    ]
  ],
  [
    "experiment",
    "takes_place_in",
    "laboratory",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_1"
    ]
  ],
  [
    "digital_device",
    "stirs",
    "flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2"
    ]
  ],
  [
    "digital_device",
    "displays",
    "time",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2"
    ]
  ],
  [
    "flask",
    "produces",
    "foam",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2"
    ]
  ],
  [
    "tube",
    "connects",
    "flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2"
    ]
  ],
  [
    "blue_base",
    "supports",
    "metal_rod",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2"
    ]
  ],
  [
    "lab_bench",
    "contains",
    "glass_cabinet",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_2"
    ]
  ],
  [
    "round_bottom_flask",
    "is_on",
    "hot_plate_stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3"
    ]
  ],
  [
    "condenser",
    "is_connected_to",
    "round_bottom_flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3"
    ]
  ],
  [
    "condenser",
    "is_connected_to",
    "long_flexible_tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3"
    ]
  ],
  [
    "long_flexible_tube",
    "leads_to",
    "beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3"
    ]
  ],
  [
    "apparatus",
    "is_held_by",
    "ring_stand",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3"
    ]
  ],
  [
    "apparatus",
    "is_on",
    "laboratory_bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_3"
    ]
  ],
  [
    "lab_bench",
    "contains",
    "digital_scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_4"
    ]
  ],
  [
    "lab_bench",
    "contains",
    "beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_49_4"
    ]
  ]
]
2025-11-24 14:59:06,126 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 29.20s, LLM: 29.20s)
2025-11-24 14:59:06,126 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 29.20s
2025-11-24 14:59:06,126 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:59:06,126 - src.pipeline.kg_builder - INFO - Pushing batch 50/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:59:06,126 - src.components.neo4j_handler - INFO - Adding 24 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:59:06,383 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:59:06,383 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:59:06,383 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:59:06,383 - src.components.neo4j_handler - INFO - Batch injected in 0.26s (triplets: 0.25s, indexes: 0.00s)
2025-11-24 14:59:06,383 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:59:06,463 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:59:06,558 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 643
2025-11-24 14:59:06,602 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 653, 'relationship_count': 2245, 'density': 0.0053, 'avg_degree': 6.876, 'avg_unique_neighbors': 6.7963, 'global_efficiency': 0.3775, 'avg_path_length': 2.8892, 'avg_degree_centrality': 0.0105, 'max_degree_centrality': 0.5184, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0773, 'degree_assortativity': -0.154, 'graph_robustness': 0.6998, 'diameter_estimate': 50, 'clustering_coefficient': 0.3189, 'weakly_connected_components': 11, 'largest_wcc_size': 643, 'pagerank_top10_percent': 5.15, 'louvain_communities': 22, 'louvain_modularity': 0.4305, 'label_entropy': 1.4732, 'computational_time': 0.21867931296583265}
2025-11-24 14:59:06,602 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 49, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967546.602764, 'total_time': 36.68385443999432, 'aggregation': 2.9030488803982735e-06, 'network_info': 0.010083795990794897, 'llm_extraction': 36.19767074298579, 'data_cleaning': 2.3954955395311117e-05, 'neo4j_injection': 0.25693058397155255, 'embedding_time': 0, 'indexing_time': 0.0022357910056598485, 'graph_injection_time': 0.25450756296049803, 'acs_metrics': {'node_count': 653, 'relationship_count': 2245, 'density': 0.0053, 'avg_degree': 6.876, 'avg_unique_neighbors': 6.7963, 'global_efficiency': 0.3775, 'avg_path_length': 2.8892, 'avg_degree_centrality': 0.0105, 'max_degree_centrality': 0.5184, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0773, 'degree_assortativity': -0.154, 'graph_robustness': 0.6998, 'diameter_estimate': 50, 'clustering_coefficient': 0.3189, 'weakly_connected_components': 11, 'largest_wcc_size': 643, 'pagerank_top10_percent': 5.15, 'louvain_communities': 22, 'louvain_modularity': 0.4305, 'label_entropy': 1.4732, 'computational_time': 0.21867931296583265}, 'retrieval_queries': []}
2025-11-24 14:59:06,602 - src.pipeline.kg_builder - DEBUG - Batch 49 metrics: {
  "batch_idx": 49,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967546.602764,
  "total_time": 36.68385443999432,
  "aggregation": 2.9030488803982735e-06,
  "network_info": 0.010083795990794897,
  "llm_extraction": 36.19767074298579,
  "data_cleaning": 2.3954955395311117e-05,
  "neo4j_injection": 0.25693058397155255,
  "embedding_time": 0,
  "indexing_time": 0.0022357910056598485,
  "graph_injection_time": 0.25450756296049803,
  "acs_metrics": {
    "node_count": 653,
    "relationship_count": 2245,
    "density": 0.0053,
    "avg_degree": 6.876,
    "avg_unique_neighbors": 6.7963,
    "global_efficiency": 0.3775,
    "avg_path_length": 2.8892,
    "avg_degree_centrality": 0.0105,
    "max_degree_centrality": 0.5184,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0773,
    "degree_assortativity": -0.154,
    "graph_robustness": 0.6998,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3189,
    "weakly_connected_components": 11,
    "largest_wcc_size": 643,
    "pagerank_top10_percent": 5.15,
    "louvain_communities": 22,
    "louvain_modularity": 0.4305,
    "label_entropy": 1.4732,
    "computational_time": 0.21867931296583265
  },
  "retrieval_queries": []
}
2025-11-24 14:59:06,603 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:59:06,603 - src.pipeline.kg_builder - INFO - Batch 50 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 36.20s, Clean: 0.00s, Neo4j: 0.26s, ACS: 0.22s
2025-11-24 14:59:06,603 - src.pipeline.kg_builder - INFO - Batch 50 completed in 36.68s
Processing KG batches:  69%|██████▉   | 50/72 [31:04<12:59, 35.41s/it]2025-11-24 14:59:06,603 - src.pipeline.kg_builder - INFO - Processing batch 51/72 (3 items)
2025-11-24 14:59:06,604 - src.pipeline.kg_builder - DEBUG - Batch 51 current_video_time: 12:38-12:43
2025-11-24 14:59:06,608 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 653
- Total Relationships: 767
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:59:06,608 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-24 14:59:06,608 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0 ~234 words, content: Time: 12:28-12:33 Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a procedure on a black lab bench. The...
2025-11-24 14:59:06,608 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1 ~240 words, content: guide the tube, ensuring it is properly positioned within the container. The surrounding environment is a laboratory setting. To the left, there is a blue...
2025-11-24 14:59:06,608 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_2 ~24 words, content:  a glass cylinder holding pens and tools. The overall action appears to be the transfer of liquid or the setup for a chemical process.
2025-11-24 14:59:06,608 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:59:06,608 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0) (~234 words) with timeout=5.0s retries=3
2025-11-24 14:59:08,223 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:59:08,223 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:59:08,223 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1) (~240 words) with timeout=5.0s retries=3
2025-11-24 14:59:09,131 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:59:09,131 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:59:09,131 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_2) (~24 words) with timeout=5.0s retries=3
2025-11-24 14:59:09,824 - src.components.pre_llm_injector - DEBUG - Extracted 3 triplets from chunk 2 (attempt 1)
2025-11-24 14:59:09,824 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 3 triplets
2025-11-24 14:59:09,824 - src.components.pre_llm_injector - INFO - Extracted 15 local triplets from 3 chunks
2025-11-24 14:59:09,825 - src.pipeline.kg_builder - INFO - Pre-extraction: 15 triplets in 3.22s
2025-11-24 14:59:09,825 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 653
- Total Relationships: 767
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0"]}, {"head": "Person", "relation": "Manipulates", "tail": "Translucent_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0"]}, {"head": "Translucent_Tube", "relation": "Is Connected To", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0"]}, {"head": "Translucent_Tube", "relation": "Is Inserted Into", "tail": "Clear_Plastic_Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0"]}, {"head": "Clear_Plastic_Container", "relation": "Is Inside", "tail": "White_Plastic_Measuring_Jug", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0"]}, {"head": "Person", "relation": "Holds", "tail": "Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0"]}, {"head": "Person", "relation": "Holds", "tail": "Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1"]}, {"head": "Person", "relation": "Holds", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1"]}, {"head": "Tube", "relation": "Is Inserted Into", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1"]}, {"head": "Watch", "relation": "Has Color", "tail": "Gold", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1"]}, {"head": "Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1"]}, {"head": "Glass Cylinder", "relation": "Holds", "tail": "Pens And Tools", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_2"]}, {"head": "Glass Cylinder", "relation": "Is Part Of", "tail": "Chemical Process Setup", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_2"]}, {"head": "Chemical Process Setup", "relation": "Involves", "tail": "Liquid Transfer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:59:09,825 - src.components.global_refiner - DEBUG - Refining 15 triplets (prompt ~254 words, ~330 tokens)
2025-11-24 14:59:09,825 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:59:26,875 - src.components.global_refiner - DEBUG - LLM call completed in 17.05s
2025-11-24 14:59:26,875 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0']], ['Person', 'manipulates', 'Translucent_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0']], ['Translucent_Tube', 'is_connected_to', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0']], ['Translucent_Tube', 'is_inserted_into', 'Clear_Plastic_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0']], ['Clear_Plastic_Container', 'is_inside', 'White_Plastic_Measuring_Jug', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0']], ['Person', 'holds', 'Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1']], ['Person', 'holds', 'Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1']], ['Person', 'holds', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1']], ['Tube', 'is_inserted_into', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1']], ['Watch', 'has_color', 'Gold', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1']], ['Container', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1']], ['Glass_Cylinder', 'holds', 'Pens_And_Tools', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_2']], ['Glass_Cylinder', 'is_part_of', 'Chemical_Process_Setup', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_2']], ['Chemical_Process_Setup', 'involves', 'Liquid_Transfer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_2']]]
2025-11-24 14:59:26,875 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0"
    ]
  ],
  [
    "Person",
    "manipulates",
    "Translucent_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0"
    ]
  ],
  [
    "Translucent_Tube",
    "is_connected_to",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0"
    ]
  ],
  [
    "Translucent_Tube",
    "is_inserted_into",
    "Clear_Plastic_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0"
    ]
  ],
  [
    "Clear_Plastic_Container",
    "is_inside",
    "White_Plastic_Measuring_Jug",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1"
    ]
  ],
  [
    "Tube",
    "is_inserted_into",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1"
    ]
  ],
  [
    "Watch",
    "has_color",
    "Gold",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1"
    ]
  ],
  [
    "Container",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_1"
    ]
  ],
  [
    "Glass_Cylinder",
    "holds",
    "Pens_And_Tools",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_2"
    ]
  ],
  [
    "Glass_Cylinder",
    "is_part_of",
    "Chemical_Process_Setup",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_2"
    ]
  ],
  [
    "Chemical_Process_Setup",
    "involves",
    "Liquid_Transfer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_50_2"
    ]
  ]
]
2025-11-24 14:59:26,878 - src.components.global_refiner - INFO - Refinement complete: 15 → 14 triplets (total: 17.05s, LLM: 17.05s)
2025-11-24 14:59:26,878 - src.pipeline.kg_builder - INFO - Global refinement: 14 triplets in 17.05s
2025-11-24 14:59:26,878 - src.pipeline.kg_builder - INFO - Using 14 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:59:26,878 - src.pipeline.kg_builder - INFO - Pushing batch 51/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:59:26,878 - src.components.neo4j_handler - INFO - Adding 14 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:59:27,008 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:59:27,008 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:59:27,008 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:59:27,008 - src.components.neo4j_handler - INFO - Batch injected in 0.13s (triplets: 0.13s, indexes: 0.00s)
2025-11-24 14:59:27,008 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:59:27,087 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:59:27,178 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 651
2025-11-24 14:59:27,225 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 661, 'relationship_count': 2271, 'density': 0.0052, 'avg_degree': 6.8714, 'avg_unique_neighbors': 6.7927, 'global_efficiency': 0.3764, 'avg_path_length': 2.8797, 'avg_degree_centrality': 0.0104, 'max_degree_centrality': 0.5182, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0628, 'degree_assortativity': -0.1513, 'graph_robustness': 0.7015, 'diameter_estimate': 50, 'clustering_coefficient': 0.3183, 'weakly_connected_components': 11, 'largest_wcc_size': 651, 'pagerank_top10_percent': 5.08, 'louvain_communities': 24, 'louvain_modularity': 0.4268, 'label_entropy': 1.4732, 'computational_time': 0.21664922102354467}
2025-11-24 14:59:27,225 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 50, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967567.2253938, 'total_time': 20.621402896998916, 'aggregation': 3.0730152502655983e-06, 'network_info': 0.004135537019465119, 'llm_extraction': 20.269846309965942, 'data_cleaning': 2.095400122925639e-05, 'neo4j_injection': 0.13030307402368635, 'embedding_time': 0, 'indexing_time': 0.0029400080093182623, 'graph_injection_time': 0.12715762603329495, 'acs_metrics': {'node_count': 661, 'relationship_count': 2271, 'density': 0.0052, 'avg_degree': 6.8714, 'avg_unique_neighbors': 6.7927, 'global_efficiency': 0.3764, 'avg_path_length': 2.8797, 'avg_degree_centrality': 0.0104, 'max_degree_centrality': 0.5182, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0628, 'degree_assortativity': -0.1513, 'graph_robustness': 0.7015, 'diameter_estimate': 50, 'clustering_coefficient': 0.3183, 'weakly_connected_components': 11, 'largest_wcc_size': 651, 'pagerank_top10_percent': 5.08, 'louvain_communities': 24, 'louvain_modularity': 0.4268, 'label_entropy': 1.4732, 'computational_time': 0.21664922102354467}, 'retrieval_queries': []}
2025-11-24 14:59:27,225 - src.pipeline.kg_builder - DEBUG - Batch 50 metrics: {
  "batch_idx": 50,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967567.2253938,
  "total_time": 20.621402896998916,
  "aggregation": 3.0730152502655983e-06,
  "network_info": 0.004135537019465119,
  "llm_extraction": 20.269846309965942,
  "data_cleaning": 2.095400122925639e-05,
  "neo4j_injection": 0.13030307402368635,
  "embedding_time": 0,
  "indexing_time": 0.0029400080093182623,
  "graph_injection_time": 0.12715762603329495,
  "acs_metrics": {
    "node_count": 661,
    "relationship_count": 2271,
    "density": 0.0052,
    "avg_degree": 6.8714,
    "avg_unique_neighbors": 6.7927,
    "global_efficiency": 0.3764,
    "avg_path_length": 2.8797,
    "avg_degree_centrality": 0.0104,
    "max_degree_centrality": 0.5182,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0628,
    "degree_assortativity": -0.1513,
    "graph_robustness": 0.7015,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3183,
    "weakly_connected_components": 11,
    "largest_wcc_size": 651,
    "pagerank_top10_percent": 5.08,
    "louvain_communities": 24,
    "louvain_modularity": 0.4268,
    "label_entropy": 1.4732,
    "computational_time": 0.21664922102354467
  },
  "retrieval_queries": []
}
2025-11-24 14:59:27,226 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:59:27,226 - src.pipeline.kg_builder - INFO - Batch 51 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 20.27s, Clean: 0.00s, Neo4j: 0.13s, ACS: 0.22s
2025-11-24 14:59:27,226 - src.pipeline.kg_builder - INFO - Batch 51 completed in 20.62s
Processing KG batches:  71%|███████   | 51/72 [31:24<10:50, 30.97s/it]2025-11-24 14:59:27,226 - src.pipeline.kg_builder - INFO - Processing batch 52/72 (3 items)
2025-11-24 14:59:27,226 - src.pipeline.kg_builder - DEBUG - Batch 52 current_video_time: 12:53-12:58
2025-11-24 14:59:27,236 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 661
- Total Relationships: 778
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:59:27,236 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 14:59:27,236 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0 ~232 words, content: Time: 12:43-12:48 Content: The video captures a close-up, first-person view of a laboratory procedure being performed on a black countertop. The central action involves a...
2025-11-24 14:59:27,236 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1 ~227 words, content: a controlled scientific or medical procedure. The focus is on the precise transfer of a substance, likely a reagent or a sample, into a container...
2025-11-24 14:59:27,236 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2 ~241 words, content: view of a person's hands, protected by blue nitrile gloves. The person is holding a long, flexible, translucent tube. They are carefully inserting the end...
2025-11-24 14:59:27,236 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3 ~121 words, content: system. The person's hands are still engaged, ensuring the tube is properly positioned. The background shows a well-equipped laboratory with white cabinets, shelves filled with...
2025-11-24 14:59:27,236 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:59:27,236 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0) (~232 words) with timeout=5.0s retries=3
2025-11-24 14:59:28,738 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 14:59:28,738 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 14:59:28,739 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1) (~227 words) with timeout=5.0s retries=3
2025-11-24 14:59:30,039 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 14:59:30,039 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 14:59:30,039 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2) (~241 words) with timeout=5.0s retries=3
2025-11-24 14:59:31,772 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 14:59:31,772 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 14:59:31,772 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3) (~121 words) with timeout=5.0s retries=3
2025-11-24 14:59:32,709 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 14:59:32,710 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 14:59:32,710 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 4 chunks
2025-11-24 14:59:32,710 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 5.47s
2025-11-24 14:59:32,711 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 661
- Total Relationships: 778
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0"]}, {"head": "Person", "relation": "Uses", "tail": "Translucent_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0"]}, {"head": "Translucent_Tube", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0"]}, {"head": "Clear_Liquid", "relation": "Flows Into", "tail": "Glass_Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0"]}, {"head": "Glass_Beaker", "relation": "Is On", "tail": "Black_Counterboard", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1"]}, {"head": "Person", "relation": "Uses", "tail": "Translucent Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1"]}, {"head": "Translucent Tube", "relation": "Transfers", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1"]}, {"head": "Clear Liquid", "relation": "Is Transferred To", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1"]}, {"head": "Glass Beaker", "relation": "Is Held By", "tail": "Person", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2"]}, {"head": "Translucent_Tube", "relation": "Is Inserted Into", "tail": "Clear_Plastic_Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2"]}, {"head": "Clear_Plastic_Container", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2"]}, {"head": "Person", "relation": "Guides", "tail": "Translucent_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2"]}, {"head": "Translucent_Tube", "relation": "Connects To", "tail": "Yellow_Multi_Armed_Apparatus", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3"]}, {"head": "Person", "relation": "Holds", "tail": "Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3"]}, {"head": "Tube", "relation": "Is Connected To", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3"]}, {"head": "Person", "relation": "Operates", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Cabinets", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Shelves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 14:59:32,711 - src.components.global_refiner - DEBUG - Refining 23 triplets (prompt ~320 words, ~416 tokens)
2025-11-24 14:59:32,711 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 14:59:58,092 - src.components.global_refiner - DEBUG - LLM call completed in 25.38s
2025-11-24 14:59:58,092 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1']], ['Person', 'holds', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1']], ['Person', 'uses', 'Translucent_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1']], ['Translucent_Tube', 'transfers', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1']], ['Clear_Liquid', 'flows_into', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0']], ['Glass_Beaker', 'is_on', 'Black_Counterboard', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0']], ['Clear_Liquid', 'is_transferred_to', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1']], ['Glass_Beaker', 'is_held_by', 'Person', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1']], ['Person', 'holds', 'Translucent_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2']], ['Translucent_Tube', 'is_inserted_into', 'Clear_Plastic_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2']], ['Clear_Plastic_Container', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2']], ['Person', 'guides', 'Translucent_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2']], ['Translucent_Tube', 'connects_to', 'Yellow_Multi_Armed_Apparatus', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2']], ['Person', 'wears', 'Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3']], ['Person', 'holds', 'Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3']], ['Tube', 'is_connected_to', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3']], ['Person', 'operates', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3']], ['Laboratory', 'contains', 'Cabinets', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3']], ['Laboratory', 'contains', 'Shelves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3']]]
2025-11-24 14:59:58,092 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Translucent_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1"
    ]
  ],
  [
    "Translucent_Tube",
    "transfers",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1"
    ]
  ],
  [
    "Clear_Liquid",
    "flows_into",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0"
    ]
  ],
  [
    "Glass_Beaker",
    "is_on",
    "Black_Counterboard",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_0"
    ]
  ],
  [
    "Clear_Liquid",
    "is_transferred_to",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1"
    ]
  ],
  [
    "Glass_Beaker",
    "is_held_by",
    "Person",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Translucent_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2"
    ]
  ],
  [
    "Translucent_Tube",
    "is_inserted_into",
    "Clear_Plastic_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2"
    ]
  ],
  [
    "Clear_Plastic_Container",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2"
    ]
  ],
  [
    "Person",
    "guides",
    "Translucent_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2"
    ]
  ],
  [
    "Translucent_Tube",
    "connects_to",
    "Yellow_Multi_Armed_Apparatus",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3"
    ]
  ],
  [
    "Tube",
    "is_connected_to",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3"
    ]
  ],
  [
    "Person",
    "operates",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Cabinets",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Shelves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_51_3"
    ]
  ]
]
2025-11-24 14:59:58,092 - src.components.global_refiner - INFO - Refinement complete: 23 → 19 triplets (total: 25.38s, LLM: 25.38s)
2025-11-24 14:59:58,092 - src.pipeline.kg_builder - INFO - Global refinement: 19 triplets in 25.38s
2025-11-24 14:59:58,092 - src.pipeline.kg_builder - INFO - Using 19 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 14:59:58,092 - src.pipeline.kg_builder - INFO - Pushing batch 52/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 14:59:58,093 - src.components.neo4j_handler - INFO - Adding 19 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 14:59:58,340 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 14:59:58,341 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 14:59:58,341 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 14:59:58,341 - src.components.neo4j_handler - INFO - Batch injected in 0.25s (triplets: 0.24s, indexes: 0.00s)
2025-11-24 14:59:58,341 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 14:59:58,477 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 14:59:58,572 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 658
2025-11-24 14:59:58,617 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 668, 'relationship_count': 2302, 'density': 0.0052, 'avg_degree': 6.8922, 'avg_unique_neighbors': 6.8054, 'global_efficiency': 0.377, 'avg_path_length': 2.8798, 'avg_degree_centrality': 0.0103, 'max_degree_centrality': 0.5202, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0719, 'degree_assortativity': -0.1501, 'graph_robustness': 0.7029, 'diameter_estimate': 50, 'clustering_coefficient': 0.3192, 'weakly_connected_components': 11, 'largest_wcc_size': 658, 'pagerank_top10_percent': 5.04, 'louvain_communities': 23, 'louvain_modularity': 0.4425, 'label_entropy': 1.4741, 'computational_time': 0.2765940710087307}
2025-11-24 14:59:58,618 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 51, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967598.6182625, 'total_time': 31.39164820400765, 'aggregation': 3.2380339689552784e-06, 'network_info': 0.009369503997731954, 'llm_extraction': 30.8567918020417, 'data_cleaning': 1.705199247226119e-05, 'neo4j_injection': 0.24837690003914759, 'embedding_time': 0, 'indexing_time': 0.0035550370230339468, 'graph_injection_time': 0.2446699200081639, 'acs_metrics': {'node_count': 668, 'relationship_count': 2302, 'density': 0.0052, 'avg_degree': 6.8922, 'avg_unique_neighbors': 6.8054, 'global_efficiency': 0.377, 'avg_path_length': 2.8798, 'avg_degree_centrality': 0.0103, 'max_degree_centrality': 0.5202, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0719, 'degree_assortativity': -0.1501, 'graph_robustness': 0.7029, 'diameter_estimate': 50, 'clustering_coefficient': 0.3192, 'weakly_connected_components': 11, 'largest_wcc_size': 658, 'pagerank_top10_percent': 5.04, 'louvain_communities': 23, 'louvain_modularity': 0.4425, 'label_entropy': 1.4741, 'computational_time': 0.2765940710087307}, 'retrieval_queries': []}
2025-11-24 14:59:58,618 - src.pipeline.kg_builder - DEBUG - Batch 51 metrics: {
  "batch_idx": 51,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967598.6182625,
  "total_time": 31.39164820400765,
  "aggregation": 3.2380339689552784e-06,
  "network_info": 0.009369503997731954,
  "llm_extraction": 30.8567918020417,
  "data_cleaning": 1.705199247226119e-05,
  "neo4j_injection": 0.24837690003914759,
  "embedding_time": 0,
  "indexing_time": 0.0035550370230339468,
  "graph_injection_time": 0.2446699200081639,
  "acs_metrics": {
    "node_count": 668,
    "relationship_count": 2302,
    "density": 0.0052,
    "avg_degree": 6.8922,
    "avg_unique_neighbors": 6.8054,
    "global_efficiency": 0.377,
    "avg_path_length": 2.8798,
    "avg_degree_centrality": 0.0103,
    "max_degree_centrality": 0.5202,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0719,
    "degree_assortativity": -0.1501,
    "graph_robustness": 0.7029,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3192,
    "weakly_connected_components": 11,
    "largest_wcc_size": 658,
    "pagerank_top10_percent": 5.04,
    "louvain_communities": 23,
    "louvain_modularity": 0.4425,
    "label_entropy": 1.4741,
    "computational_time": 0.2765940710087307
  },
  "retrieval_queries": []
}
2025-11-24 14:59:58,619 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 14:59:58,619 - src.pipeline.kg_builder - INFO - Batch 52 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 30.86s, Clean: 0.00s, Neo4j: 0.25s, ACS: 0.28s
2025-11-24 14:59:58,619 - src.pipeline.kg_builder - INFO - Batch 52 completed in 31.39s
Processing KG batches:  72%|███████▏  | 52/72 [31:56<10:21, 31.10s/it]2025-11-24 14:59:58,619 - src.pipeline.kg_builder - INFO - Processing batch 53/72 (3 items)
2025-11-24 14:59:58,619 - src.pipeline.kg_builder - DEBUG - Batch 53 current_video_time: 13:08-13:13
2025-11-24 14:59:58,624 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 668
- Total Relationships: 791
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 14:59:58,625 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-24 14:59:58,625 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0 ~241 words, content: Time: 12:58-13:03 Content: The video captures a sequence of actions in a laboratory setting, focusing on a person performing a procedure involving a long, flexible...
2025-11-24 14:59:58,625 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1 ~240 words, content: are several power outlets, a glass beaker with pens and tools, a green bag of wipes, and a container with cotton balls. The background shows...
2025-11-24 14:59:58,625 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2 ~207 words, content: with various items, including a blue foam block, a roll of tape, electrical cords, a glass beaker holding pens and scissors, a container of cotton...
2025-11-24 14:59:58,625 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 14:59:58,625 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0) (~241 words) with timeout=5.0s retries=3
2025-11-24 15:00:00,074 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:00:00,074 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:00:00,074 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1) (~240 words) with timeout=5.0s retries=3
2025-11-24 15:00:01,217 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:00:01,217 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:00:01,217 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2) (~207 words) with timeout=5.0s retries=3
2025-11-24 15:00:06,223 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 1/4), retrying...
2025-11-24 15:00:11,730 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 2/4), retrying...
2025-11-24 15:00:13,940 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 3)
2025-11-24 15:00:13,940 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:00:13,941 - src.components.pre_llm_injector - INFO - Extracted 14 local triplets from 3 chunks
2025-11-24 15:00:13,941 - src.pipeline.kg_builder - INFO - Pre-extraction: 14 triplets in 15.32s
2025-11-24 15:00:13,941 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 668
- Total Relationships: 791
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2"]}, {"head": "Translucent Tube", "relation": "Is Connected To", "tail": "Yellow Apparatus", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0"]}, {"head": "Yellow Apparatus", "relation": "Is Mounted On", "tail": "Metal Stand", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0"]}, {"head": "Person", "relation": "Guides", "tail": "Translucent Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0"]}, {"head": "Translucent Tube", "relation": "Is Inserted Into", "tail": "Clear Plastic Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0"]}, {"head": "Person", "relation": "Holds", "tail": "Clear Plastic Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1"]}, {"head": "Person", "relation": "Uses", "tail": "Metal Stand", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1"]}, {"head": "Person", "relation": "Uses", "tail": "Yellow Clamp", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2"]}, {"head": "Translucent Tube", "relation": "Transfers", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2"]}, {"head": "Glass Beaker", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Blue Foam Block", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:00:13,941 - src.components.global_refiner - DEBUG - Refining 14 triplets (prompt ~262 words, ~341 tokens)
2025-11-24 15:00:13,941 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:00:33,484 - src.components.global_refiner - DEBUG - LLM call completed in 19.54s
2025-11-24 15:00:33,484 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2']], ['Person', 'holds', 'Translucent_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2']], ['Translucent_Tube', 'is_connected_to', 'Yellow_Apparatus', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0']], ['Yellow_Apparatus', 'is_mounted_on', 'Metal_Stand', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0']], ['Person', 'guides', 'Translucent_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0']], ['Translucent_Tube', 'is_inserted_into', 'Clear_Plastic_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0']], ['Person', 'holds', 'Clear_Plastic_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1']], ['Person', 'uses', 'Metal_Stand', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1']], ['Person', 'uses', 'Yellow_Clamp', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1']], ['Lab_Bench', 'contains', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1']], ['Person', 'holds', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2']], ['Translucent_Tube', 'transfers', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2']], ['Glass_Beaker', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2']], ['Lab_Bench', 'contains', 'Blue_Foam_Block', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2']]]
2025-11-24 15:00:33,484 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Translucent_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2"
    ]
  ],
  [
    "Translucent_Tube",
    "is_connected_to",
    "Yellow_Apparatus",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0"
    ]
  ],
  [
    "Yellow_Apparatus",
    "is_mounted_on",
    "Metal_Stand",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0"
    ]
  ],
  [
    "Person",
    "guides",
    "Translucent_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0"
    ]
  ],
  [
    "Translucent_Tube",
    "is_inserted_into",
    "Clear_Plastic_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Clear_Plastic_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Metal_Stand",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Yellow_Clamp",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2"
    ]
  ],
  [
    "Translucent_Tube",
    "transfers",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2"
    ]
  ],
  [
    "Glass_Beaker",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Blue_Foam_Block",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_52_2"
    ]
  ]
]
2025-11-24 15:00:33,484 - src.components.global_refiner - INFO - Refinement complete: 14 → 14 triplets (total: 19.54s, LLM: 19.54s)
2025-11-24 15:00:33,484 - src.pipeline.kg_builder - INFO - Global refinement: 14 triplets in 19.54s
2025-11-24 15:00:33,485 - src.pipeline.kg_builder - INFO - Using 14 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:00:33,485 - src.pipeline.kg_builder - INFO - Pushing batch 53/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:00:33,485 - src.components.neo4j_handler - INFO - Adding 14 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:00:33,613 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:00:33,613 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:00:33,613 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:00:33,613 - src.components.neo4j_handler - INFO - Batch injected in 0.13s (triplets: 0.12s, indexes: 0.00s)
2025-11-24 15:00:33,613 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:00:33,672 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:00:33,767 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 664
2025-11-24 15:00:33,815 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 674, 'relationship_count': 2329, 'density': 0.0051, 'avg_degree': 6.911, 'avg_unique_neighbors': 6.8249, 'global_efficiency': 0.3773, 'avg_path_length': 2.8694, 'avg_degree_centrality': 0.0103, 'max_degree_centrality': 0.5245, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0688, 'degree_assortativity': -0.1515, 'graph_robustness': 0.7042, 'diameter_estimate': 50, 'clustering_coefficient': 0.3194, 'weakly_connected_components': 11, 'largest_wcc_size': 664, 'pagerank_top10_percent': 5.0, 'louvain_communities': 24, 'louvain_modularity': 0.4406, 'label_entropy': 1.4745, 'computational_time': 0.20130228495690972}
2025-11-24 15:00:33,815 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 52, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967633.8154483, 'total_time': 35.195918356999755, 'aggregation': 3.078952431678772e-06, 'network_info': 0.0050438769976608455, 'llm_extraction': 34.86029368097661, 'data_cleaning': 2.7381989639252424e-05, 'neo4j_injection': 0.12882577400887385, 'embedding_time': 0, 'indexing_time': 0.0037860700394958258, 'graph_injection_time': 0.1247988379909657, 'acs_metrics': {'node_count': 674, 'relationship_count': 2329, 'density': 0.0051, 'avg_degree': 6.911, 'avg_unique_neighbors': 6.8249, 'global_efficiency': 0.3773, 'avg_path_length': 2.8694, 'avg_degree_centrality': 0.0103, 'max_degree_centrality': 0.5245, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0688, 'degree_assortativity': -0.1515, 'graph_robustness': 0.7042, 'diameter_estimate': 50, 'clustering_coefficient': 0.3194, 'weakly_connected_components': 11, 'largest_wcc_size': 664, 'pagerank_top10_percent': 5.0, 'louvain_communities': 24, 'louvain_modularity': 0.4406, 'label_entropy': 1.4745, 'computational_time': 0.20130228495690972}, 'retrieval_queries': []}
2025-11-24 15:00:33,815 - src.pipeline.kg_builder - DEBUG - Batch 52 metrics: {
  "batch_idx": 52,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967633.8154483,
  "total_time": 35.195918356999755,
  "aggregation": 3.078952431678772e-06,
  "network_info": 0.0050438769976608455,
  "llm_extraction": 34.86029368097661,
  "data_cleaning": 2.7381989639252424e-05,
  "neo4j_injection": 0.12882577400887385,
  "embedding_time": 0,
  "indexing_time": 0.0037860700394958258,
  "graph_injection_time": 0.1247988379909657,
  "acs_metrics": {
    "node_count": 674,
    "relationship_count": 2329,
    "density": 0.0051,
    "avg_degree": 6.911,
    "avg_unique_neighbors": 6.8249,
    "global_efficiency": 0.3773,
    "avg_path_length": 2.8694,
    "avg_degree_centrality": 0.0103,
    "max_degree_centrality": 0.5245,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0688,
    "degree_assortativity": -0.1515,
    "graph_robustness": 0.7042,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3194,
    "weakly_connected_components": 11,
    "largest_wcc_size": 664,
    "pagerank_top10_percent": 5.0,
    "louvain_communities": 24,
    "louvain_modularity": 0.4406,
    "label_entropy": 1.4745,
    "computational_time": 0.20130228495690972
  },
  "retrieval_queries": []
}
2025-11-24 15:00:33,816 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:00:33,816 - src.pipeline.kg_builder - INFO - Batch 53 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 34.86s, Clean: 0.00s, Neo4j: 0.13s, ACS: 0.20s
2025-11-24 15:00:33,816 - src.pipeline.kg_builder - INFO - Batch 53 completed in 35.20s
Processing KG batches:  74%|███████▎  | 53/72 [32:31<10:14, 32.33s/it]2025-11-24 15:00:33,816 - src.pipeline.kg_builder - INFO - Processing batch 54/72 (3 items)
2025-11-24 15:00:33,816 - src.pipeline.kg_builder - DEBUG - Batch 54 current_video_time: 13:23-13:28
2025-11-24 15:00:33,822 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 674
- Total Relationships: 797
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:00:33,822 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-24 15:00:33,822 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0 ~226 words, content: Time: 13:13-13:18 Content: The video shows a person conducting a laboratory procedure, likely a rinsing or washing step, from a first-person perspective. The individual, wearing...
2025-11-24 15:00:33,823 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1 ~225 words, content: , the video captures a precise laboratory technique where a glass container is being rinsed or washed using a liquid transfer method, resulting in a...
2025-11-24 15:00:33,823 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2 ~227 words, content: . The person in the foreground continues to hold the white tube, which is now positioned over the large jug. The workbench is cluttered with...
2025-11-24 15:00:33,823 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:00:33,823 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0) (~226 words) with timeout=5.0s retries=3
2025-11-24 15:00:35,225 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:00:35,225 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:00:35,225 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1) (~225 words) with timeout=5.0s retries=3
2025-11-24 15:00:36,552 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:00:36,552 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:00:36,552 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2) (~227 words) with timeout=5.0s retries=3
2025-11-24 15:00:37,734 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:00:37,734 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:00:37,734 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 3 chunks
2025-11-24 15:00:37,734 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 3.91s
2025-11-24 15:00:37,735 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 674
- Total Relationships: 797
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1"]}, {"head": "Person", "relation": "Holds", "tail": "Flexible_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0"]}, {"head": "Flexible_Tube", "relation": "Is Inserted Into", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0"]}, {"head": "Glass_Container", "relation": "Is Submerged In", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0"]}, {"head": "Person", "relation": "Holds", "tail": "White_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1"]}, {"head": "Person", "relation": "Holds", "tail": "Clear_Plastic_Jug", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1"]}, {"head": "Person", "relation": "Uses", "tail": "White_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1"]}, {"head": "Clear_Plastic_Jug", "relation": "Contains", "tail": "Cloudy_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1"]}, {"head": "Person", "relation": "Observes", "tail": "Background_Person", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1"]}, {"head": "Person", "relation": "Holds", "tail": "White Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2"]}, {"head": "Person", "relation": "Holds", "tail": "White Plastic Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2"]}, {"head": "White Tube", "relation": "Is Positioned Over", "tail": "Large Jug", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2"]}, {"head": "Glass Beaker", "relation": "Contains", "tail": "Pens And Tools", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2"]}, {"head": "Person", "relation": "Performs", "tail": "Liquid Transfer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:00:37,735 - src.components.global_refiner - DEBUG - Refining 17 triplets (prompt ~269 words, ~350 tokens)
2025-11-24 15:00:37,735 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:00:57,912 - src.components.global_refiner - DEBUG - LLM call completed in 20.18s
2025-11-24 15:00:57,913 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1']], ['Person', 'holds', 'Flexible_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0']], ['Flexible_Tube', 'is_inserted_into', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0']], ['Person', 'holds', 'Glass_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0']], ['Glass_Container', 'is_submerged_in', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0']], ['Beaker', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0']], ['Person', 'holds', 'White_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2']], ['Person', 'holds', 'Clear_Plastic_Jug', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1']], ['Person', 'uses', 'White_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1']], ['Clear_Plastic_Jug', 'contains', 'Cloudy_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1']], ['Person', 'observes', 'Background_Person', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1']], ['Person', 'holds', 'White_Plastic_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2']], ['White_Tube', 'is_positioned_over', 'Large_Jug', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2']], ['Lab_Bench', 'contains', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2']], ['Glass_Beaker', 'contains', 'Pens_And_Tools', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2']], ['Person', 'performs', 'Liquid_Transfer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2']]]
2025-11-24 15:00:57,913 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Flexible_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0"
    ]
  ],
  [
    "Flexible_Tube",
    "is_inserted_into",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0"
    ]
  ],
  [
    "Glass_Container",
    "is_submerged_in",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_0"
    ]
  ],
  [
    "Person",
    "holds",
    "White_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Clear_Plastic_Jug",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1"
    ]
  ],
  [
    "Person",
    "uses",
    "White_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1"
    ]
  ],
  [
    "Clear_Plastic_Jug",
    "contains",
    "Cloudy_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1"
    ]
  ],
  [
    "Person",
    "observes",
    "Background_Person",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_1"
    ]
  ],
  [
    "Person",
    "holds",
    "White_Plastic_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2"
    ]
  ],
  [
    "White_Tube",
    "is_positioned_over",
    "Large_Jug",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2"
    ]
  ],
  [
    "Glass_Beaker",
    "contains",
    "Pens_And_Tools",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2"
    ]
  ],
  [
    "Person",
    "performs",
    "Liquid_Transfer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_53_2"
    ]
  ]
]
2025-11-24 15:00:57,913 - src.components.global_refiner - INFO - Refinement complete: 17 → 16 triplets (total: 20.18s, LLM: 20.18s)
2025-11-24 15:00:57,913 - src.pipeline.kg_builder - INFO - Global refinement: 16 triplets in 20.18s
2025-11-24 15:00:57,913 - src.pipeline.kg_builder - INFO - Using 16 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:00:57,913 - src.pipeline.kg_builder - INFO - Pushing batch 54/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:00:57,913 - src.components.neo4j_handler - INFO - Adding 16 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:00:58,069 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:00:58,069 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:00:58,069 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:00:58,069 - src.components.neo4j_handler - INFO - Batch injected in 0.16s (triplets: 0.15s, indexes: 0.00s)
2025-11-24 15:00:58,069 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:00:58,149 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:00:58,246 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 671
2025-11-24 15:00:58,293 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 681, 'relationship_count': 2358, 'density': 0.0051, 'avg_degree': 6.9251, 'avg_unique_neighbors': 6.837, 'global_efficiency': 0.3766, 'avg_path_length': 2.8567, 'avg_degree_centrality': 0.0102, 'max_degree_centrality': 0.5294, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0751, 'degree_assortativity': -0.1538, 'graph_robustness': 0.7048, 'diameter_estimate': 50, 'clustering_coefficient': 0.3189, 'weakly_connected_components': 11, 'largest_wcc_size': 671, 'pagerank_top10_percent': 4.95, 'louvain_communities': 23, 'louvain_modularity': 0.4279, 'label_entropy': 1.4748, 'computational_time': 0.2235052659525536}
2025-11-24 15:00:58,293 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 53, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967658.29343, 'total_time': 24.476741282036528, 'aggregation': 2.596992999315262e-06, 'network_info': 0.005741194996517152, 'llm_extraction': 24.09066773398081, 'data_cleaning': 1.830799737945199e-05, 'neo4j_injection': 0.15628688695142046, 'embedding_time': 0, 'indexing_time': 0.0037902850308455527, 'graph_injection_time': 0.15232742903754115, 'acs_metrics': {'node_count': 681, 'relationship_count': 2358, 'density': 0.0051, 'avg_degree': 6.9251, 'avg_unique_neighbors': 6.837, 'global_efficiency': 0.3766, 'avg_path_length': 2.8567, 'avg_degree_centrality': 0.0102, 'max_degree_centrality': 0.5294, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0751, 'degree_assortativity': -0.1538, 'graph_robustness': 0.7048, 'diameter_estimate': 50, 'clustering_coefficient': 0.3189, 'weakly_connected_components': 11, 'largest_wcc_size': 671, 'pagerank_top10_percent': 4.95, 'louvain_communities': 23, 'louvain_modularity': 0.4279, 'label_entropy': 1.4748, 'computational_time': 0.2235052659525536}, 'retrieval_queries': []}
2025-11-24 15:00:58,293 - src.pipeline.kg_builder - DEBUG - Batch 53 metrics: {
  "batch_idx": 53,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967658.29343,
  "total_time": 24.476741282036528,
  "aggregation": 2.596992999315262e-06,
  "network_info": 0.005741194996517152,
  "llm_extraction": 24.09066773398081,
  "data_cleaning": 1.830799737945199e-05,
  "neo4j_injection": 0.15628688695142046,
  "embedding_time": 0,
  "indexing_time": 0.0037902850308455527,
  "graph_injection_time": 0.15232742903754115,
  "acs_metrics": {
    "node_count": 681,
    "relationship_count": 2358,
    "density": 0.0051,
    "avg_degree": 6.9251,
    "avg_unique_neighbors": 6.837,
    "global_efficiency": 0.3766,
    "avg_path_length": 2.8567,
    "avg_degree_centrality": 0.0102,
    "max_degree_centrality": 0.5294,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0751,
    "degree_assortativity": -0.1538,
    "graph_robustness": 0.7048,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3189,
    "weakly_connected_components": 11,
    "largest_wcc_size": 671,
    "pagerank_top10_percent": 4.95,
    "louvain_communities": 23,
    "louvain_modularity": 0.4279,
    "label_entropy": 1.4748,
    "computational_time": 0.2235052659525536
  },
  "retrieval_queries": []
}
2025-11-24 15:00:58,294 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:00:58,294 - src.pipeline.kg_builder - INFO - Batch 54 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 24.09s, Clean: 0.00s, Neo4j: 0.16s, ACS: 0.22s
2025-11-24 15:00:58,294 - src.pipeline.kg_builder - INFO - Batch 54 completed in 24.48s
Processing KG batches:  75%|███████▌  | 54/72 [32:55<08:59, 29.97s/it]2025-11-24 15:00:58,294 - src.pipeline.kg_builder - INFO - Processing batch 55/72 (3 items)
2025-11-24 15:00:58,294 - src.pipeline.kg_builder - DEBUG - Batch 55 current_video_time: 13:38-13:43
2025-11-24 15:00:58,300 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 681
- Total Relationships: 808
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:00:58,301 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 15:00:58,301 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0 ~227 words, content: Time: 13:28-13:33 Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a procedure on a black lab bench. The...
2025-11-24 15:00:58,301 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1 ~225 words, content: with their right hand and a long, translucent pipette with their left. They are carefully inserting the pipette into the beaker, which contains a clear...
2025-11-24 15:00:58,301 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2 ~236 words, content: first-person perspective. A person wearing blue nitrile gloves is holding a long, flexible, translucent tube. They are carefully inserting this tube into a large, clear...
2025-11-24 15:00:58,301 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3 ~77 words, content: a stand. The tube is being used to transfer the white liquid from the beaker into a glass container that is on the white stirrer....
2025-11-24 15:00:58,301 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:00:58,301 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0) (~227 words) with timeout=5.0s retries=3
2025-11-24 15:00:59,447 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:00:59,447 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:00:59,447 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1) (~225 words) with timeout=5.0s retries=3
2025-11-24 15:01:00,472 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:01:00,473 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:01:00,473 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2) (~236 words) with timeout=5.0s retries=3
2025-11-24 15:01:01,829 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:01:01,829 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:01:01,829 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3) (~77 words) with timeout=5.0s retries=3
2025-11-24 15:01:02,926 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 15:01:02,927 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 15:01:02,927 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 4 chunks
2025-11-24 15:01:02,927 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 4.63s
2025-11-24 15:01:02,928 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 681
- Total Relationships: 808
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0"]}, {"head": "Person", "relation": "Holds", "tail": "Clear Plastic Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0"]}, {"head": "Person", "relation": "Holds", "tail": "Long Translucent Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0"]}, {"head": "Person", "relation": "Performs", "tail": "Procedure", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Glass Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2"]}, {"head": "Translucent_Tube", "relation": "Is Inserted Into", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudy_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2"]}, {"head": "Person", "relation": "Uses", "tail": "Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2"]}, {"head": "Tube", "relation": "Transfers", "tail": "Cloudy_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2"]}, {"head": "Tube", "relation": "Transfers", "tail": "White Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "White Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3"]}, {"head": "Glass Container", "relation": "Receives", "tail": "White Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3"]}, {"head": "White Stirrer", "relation": "Supports", "tail": "Glass Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Glass Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:01:02,928 - src.components.global_refiner - DEBUG - Refining 23 triplets (prompt ~321 words, ~417 tokens)
2025-11-24 15:01:02,928 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:01:31,824 - src.components.global_refiner - DEBUG - LLM call completed in 28.90s
2025-11-24 15:01:31,824 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2']], ['Person', 'holds', 'Clear_Plastic_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0']], ['Person', 'holds', 'Long_Translucent_Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1']], ['Person', 'holds', 'Translucent_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2']], ['Person', 'performs', 'Procedure', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1']], ['Person', 'uses', 'Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1']], ['Tube', 'transfers', 'Cloudy_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2']], ['Tube', 'transfers', 'White_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1']], ['Beaker', 'contains', 'Cloudy_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2']], ['Beaker', 'contains', 'White_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3']], ['Lab_Bench', 'contains', 'Glass_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0']], ['Lab_Bench', 'contains', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0']], ['Lab_Table', 'contains', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3']], ['Lab_Table', 'contains', 'Glass_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3']], ['Glass_Container', 'receives', 'White_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3']], ['White_Stirrer', 'supports', 'Glass_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3']], ['Translucent_Tube', 'is_inserted_into', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2']]]
2025-11-24 15:01:31,824 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Clear_Plastic_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Long_Translucent_Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Translucent_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2"
    ]
  ],
  [
    "Person",
    "performs",
    "Procedure",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1"
    ]
  ],
  [
    "Person",
    "uses",
    "Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1"
    ]
  ],
  [
    "Tube",
    "transfers",
    "Cloudy_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2"
    ]
  ],
  [
    "Tube",
    "transfers",
    "White_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Cloudy_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "White_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Glass_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_0"
    ]
  ],
  [
    "Lab_Table",
    "contains",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3"
    ]
  ],
  [
    "Lab_Table",
    "contains",
    "Glass_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3"
    ]
  ],
  [
    "Glass_Container",
    "receives",
    "White_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3"
    ]
  ],
  [
    "White_Stirrer",
    "supports",
    "Glass_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_3"
    ]
  ],
  [
    "Translucent_Tube",
    "is_inserted_into",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_54_2"
    ]
  ]
]
2025-11-24 15:01:31,824 - src.components.global_refiner - INFO - Refinement complete: 23 → 22 triplets (total: 28.90s, LLM: 28.90s)
2025-11-24 15:01:31,824 - src.pipeline.kg_builder - INFO - Global refinement: 22 triplets in 28.90s
2025-11-24 15:01:31,824 - src.pipeline.kg_builder - INFO - Using 22 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:01:31,824 - src.pipeline.kg_builder - INFO - Pushing batch 55/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:01:31,824 - src.components.neo4j_handler - INFO - Adding 22 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:01:31,987 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:01:31,987 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:01:31,987 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:01:31,987 - src.components.neo4j_handler - INFO - Batch injected in 0.16s (triplets: 0.16s, indexes: 0.00s)
2025-11-24 15:01:31,987 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:01:32,072 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:01:32,170 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 678
2025-11-24 15:01:32,215 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 688, 'relationship_count': 2393, 'density': 0.0051, 'avg_degree': 6.9564, 'avg_unique_neighbors': 6.8692, 'global_efficiency': 0.3771, 'avg_path_length': 2.849, 'avg_degree_centrality': 0.0101, 'max_degree_centrality': 0.5313, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0661, 'degree_assortativity': -0.1537, 'graph_robustness': 0.7058, 'diameter_estimate': 50, 'clustering_coefficient': 0.3195, 'weakly_connected_components': 11, 'largest_wcc_size': 678, 'pagerank_top10_percent': 4.9, 'louvain_communities': 25, 'louvain_modularity': 0.4253, 'label_entropy': 1.4756, 'computational_time': 0.22759270801907405}
2025-11-24 15:01:32,215 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 54, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967692.2154453, 'total_time': 33.920650513027795, 'aggregation': 2.614047843962908e-06, 'network_info': 0.005885972001124173, 'llm_extraction': 33.523895621008705, 'data_cleaning': 2.0670006051659584e-05, 'neo4j_injection': 0.16278546798275784, 'embedding_time': 0, 'indexing_time': 0.002832436002790928, 'graph_injection_time': 0.15977614495204762, 'acs_metrics': {'node_count': 688, 'relationship_count': 2393, 'density': 0.0051, 'avg_degree': 6.9564, 'avg_unique_neighbors': 6.8692, 'global_efficiency': 0.3771, 'avg_path_length': 2.849, 'avg_degree_centrality': 0.0101, 'max_degree_centrality': 0.5313, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0661, 'degree_assortativity': -0.1537, 'graph_robustness': 0.7058, 'diameter_estimate': 50, 'clustering_coefficient': 0.3195, 'weakly_connected_components': 11, 'largest_wcc_size': 678, 'pagerank_top10_percent': 4.9, 'louvain_communities': 25, 'louvain_modularity': 0.4253, 'label_entropy': 1.4756, 'computational_time': 0.22759270801907405}, 'retrieval_queries': []}
2025-11-24 15:01:32,215 - src.pipeline.kg_builder - DEBUG - Batch 54 metrics: {
  "batch_idx": 54,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967692.2154453,
  "total_time": 33.920650513027795,
  "aggregation": 2.614047843962908e-06,
  "network_info": 0.005885972001124173,
  "llm_extraction": 33.523895621008705,
  "data_cleaning": 2.0670006051659584e-05,
  "neo4j_injection": 0.16278546798275784,
  "embedding_time": 0,
  "indexing_time": 0.002832436002790928,
  "graph_injection_time": 0.15977614495204762,
  "acs_metrics": {
    "node_count": 688,
    "relationship_count": 2393,
    "density": 0.0051,
    "avg_degree": 6.9564,
    "avg_unique_neighbors": 6.8692,
    "global_efficiency": 0.3771,
    "avg_path_length": 2.849,
    "avg_degree_centrality": 0.0101,
    "max_degree_centrality": 0.5313,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0661,
    "degree_assortativity": -0.1537,
    "graph_robustness": 0.7058,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3195,
    "weakly_connected_components": 11,
    "largest_wcc_size": 678,
    "pagerank_top10_percent": 4.9,
    "louvain_communities": 25,
    "louvain_modularity": 0.4253,
    "label_entropy": 1.4756,
    "computational_time": 0.22759270801907405
  },
  "retrieval_queries": []
}
2025-11-24 15:01:32,216 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:01:32,216 - src.pipeline.kg_builder - INFO - Batch 55 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 33.52s, Clean: 0.00s, Neo4j: 0.16s, ACS: 0.23s
2025-11-24 15:01:32,216 - src.pipeline.kg_builder - INFO - Batch 55 completed in 33.92s
Processing KG batches:  76%|███████▋  | 55/72 [33:29<08:49, 31.16s/it]2025-11-24 15:01:32,216 - src.pipeline.kg_builder - INFO - Processing batch 56/72 (3 items)
2025-11-24 15:01:32,216 - src.pipeline.kg_builder - DEBUG - Batch 56 current_video_time: 13:53-13:58
2025-11-24 15:01:32,222 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 688
- Total Relationships: 819
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:01:32,222 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 15:01:32,222 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0 ~233 words, content: Time: 13:43-13:48 Content: The sequence of images captures a laboratory procedure involving the transfer of a liquid using a pipette. The setting is a well-equipped...
2025-11-24 15:01:32,222 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1 ~243 words, content: Content: The video sequence captures a scientific experiment being conducted in a laboratory setting. The scene begins with a close-up view of a person's hands,...
2025-11-24 15:01:32,222 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2 ~222 words, content: is one of focused concentration, with the individual fully engaged in the task at hand. The video effectively conveys the meticulous nature of laboratory work,...
2025-11-24 15:01:32,222 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3 ~115 words, content: lab environment, including the glass cabinet and other equipment, remains visible, providing context for the experiment. - **Introduction of the Scientist (Frame 4):** A person...
2025-11-24 15:01:32,222 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:01:32,223 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0) (~233 words) with timeout=5.0s retries=3
2025-11-24 15:01:33,468 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:01:33,468 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:01:33,468 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1) (~243 words) with timeout=5.0s retries=3
2025-11-24 15:01:34,883 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:01:34,883 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:01:34,884 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2) (~222 words) with timeout=5.0s retries=3
2025-11-24 15:01:36,074 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:01:36,074 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:01:36,075 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3) (~115 words) with timeout=5.0s retries=3
2025-11-24 15:01:37,238 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 15:01:37,238 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 15:01:37,238 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 4 chunks
2025-11-24 15:01:37,238 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 5.02s
2025-11-24 15:01:37,238 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 688
- Total Relationships: 819
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0"]}, {"head": "Liquid", "relation": "Is In", "tail": "Glass_Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0"]}, {"head": "Glass_Beaker", "relation": "Is On", "tail": "Magnetic_Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1"]}, {"head": "Liquid", "relation": "Is In", "tail": "Glass_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1"]}, {"head": "Glass_Flask", "relation": "Is On", "tail": "Magnetic_Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1"]}, {"head": "Magnetic_Stirrer", "relation": "Rotates", "tail": "Stir_Bar", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1"]}, {"head": "Glass_Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Glass Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2"]}, {"head": "Person", "relation": "Holds", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2"]}, {"head": "Magnetic Stirrer", "relation": "Mixes", "tail": "Contents", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Glass Cabinet", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "Glass Cabinet", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3"]}, {"head": "Person", "relation": "Appears In", "tail": "Frame 4", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3"]}, {"head": "Person", "relation": "Has", "tail": "Long Curly Dark Hair", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3"]}, {"head": "Person", "relation": "Has", "tail": "Warm Smile", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3"]}, {"head": "Lab Environment", "relation": "Serves As", "tail": "Backdrop", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:01:37,238 - src.components.global_refiner - DEBUG - Refining 23 triplets (prompt ~323 words, ~420 tokens)
2025-11-24 15:01:37,238 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:02:05,064 - src.components.global_refiner - DEBUG - LLM call completed in 27.83s
2025-11-24 15:02:05,064 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2']], ['Person', 'wears', 'Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0']], ['Liquid', 'is_in', 'Glass_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0']], ['Glass_Beaker', 'is_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0']], ['Person', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1']], ['Liquid', 'is_in', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2']], ['Glass_Flask', 'is_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2']], ['Magnetic_Stirrer', 'rotates', 'Stir_Bar', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1']], ['Glass_Flask', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2']], ['Laboratory', 'contains', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2']], ['Person', 'has', 'Long_Curly_Dark_Hair', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3']], ['Person', 'has', 'Warm_Smile', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3']], ['Person', 'appears_in', 'Frame_4', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3']], ['Laboratory', 'contains', 'Glass_Cabinet', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3']], ['Lab_Environment', 'contains', 'Glass_Cabinet', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3']], ['Lab_Environment', 'contains', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3']], ['Lab_Environment', 'serves_as', 'Backdrop', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3']], ['Magnetic_Stirrer', 'mixes', 'Contents', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2']]]
2025-11-24 15:02:05,065 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0"
    ]
  ],
  [
    "Liquid",
    "is_in",
    "Glass_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0"
    ]
  ],
  [
    "Glass_Beaker",
    "is_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_0"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1"
    ]
  ],
  [
    "Liquid",
    "is_in",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2"
    ]
  ],
  [
    "Glass_Flask",
    "is_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "rotates",
    "Stir_Bar",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1"
    ]
  ],
  [
    "Glass_Flask",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2"
    ]
  ],
  [
    "Person",
    "has",
    "Long_Curly_Dark_Hair",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3"
    ]
  ],
  [
    "Person",
    "has",
    "Warm_Smile",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3"
    ]
  ],
  [
    "Person",
    "appears_in",
    "Frame_4",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Glass_Cabinet",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3"
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "Glass_Cabinet",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3"
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3"
    ]
  ],
  [
    "Lab_Environment",
    "serves_as",
    "Backdrop",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_3"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "mixes",
    "Contents",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_55_2"
    ]
  ]
]
2025-11-24 15:02:05,065 - src.components.global_refiner - INFO - Refinement complete: 23 → 20 triplets (total: 27.83s, LLM: 27.83s)
2025-11-24 15:02:05,065 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 27.83s
2025-11-24 15:02:05,065 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:02:05,065 - src.pipeline.kg_builder - INFO - Pushing batch 56/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:02:05,065 - src.components.neo4j_handler - INFO - Adding 20 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:02:05,250 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:02:05,250 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:02:05,250 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:02:05,250 - src.components.neo4j_handler - INFO - Batch injected in 0.18s (triplets: 0.18s, indexes: 0.00s)
2025-11-24 15:02:05,250 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:02:05,330 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:02:05,429 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 687
2025-11-24 15:02:05,475 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 697, 'relationship_count': 2435, 'density': 0.005, 'avg_degree': 6.9871, 'avg_unique_neighbors': 6.8953, 'global_efficiency': 0.3772, 'avg_path_length': 2.8372, 'avg_degree_centrality': 0.01, 'max_degree_centrality': 0.5345, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0739, 'degree_assortativity': -0.1548, 'graph_robustness': 0.7047, 'diameter_estimate': 50, 'clustering_coefficient': 0.3205, 'weakly_connected_components': 11, 'largest_wcc_size': 687, 'pagerank_top10_percent': 4.84, 'louvain_communities': 24, 'louvain_modularity': 0.4381, 'label_entropy': 1.4759, 'computational_time': 0.2249182160012424}
2025-11-24 15:02:05,475 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 55, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967725.4756315, 'total_time': 33.258852803031914, 'aggregation': 2.795015461742878e-06, 'network_info': 0.005365302029531449, 'llm_extraction': 32.843161584984045, 'data_cleaning': 4.04070015065372e-05, 'neo4j_injection': 0.1849013669998385, 'embedding_time': 0, 'indexing_time': 0.0028432629769667983, 'graph_injection_time': 0.18177731399191543, 'acs_metrics': {'node_count': 697, 'relationship_count': 2435, 'density': 0.005, 'avg_degree': 6.9871, 'avg_unique_neighbors': 6.8953, 'global_efficiency': 0.3772, 'avg_path_length': 2.8372, 'avg_degree_centrality': 0.01, 'max_degree_centrality': 0.5345, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0739, 'degree_assortativity': -0.1548, 'graph_robustness': 0.7047, 'diameter_estimate': 50, 'clustering_coefficient': 0.3205, 'weakly_connected_components': 11, 'largest_wcc_size': 687, 'pagerank_top10_percent': 4.84, 'louvain_communities': 24, 'louvain_modularity': 0.4381, 'label_entropy': 1.4759, 'computational_time': 0.2249182160012424}, 'retrieval_queries': []}
2025-11-24 15:02:05,475 - src.pipeline.kg_builder - DEBUG - Batch 55 metrics: {
  "batch_idx": 55,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967725.4756315,
  "total_time": 33.258852803031914,
  "aggregation": 2.795015461742878e-06,
  "network_info": 0.005365302029531449,
  "llm_extraction": 32.843161584984045,
  "data_cleaning": 4.04070015065372e-05,
  "neo4j_injection": 0.1849013669998385,
  "embedding_time": 0,
  "indexing_time": 0.0028432629769667983,
  "graph_injection_time": 0.18177731399191543,
  "acs_metrics": {
    "node_count": 697,
    "relationship_count": 2435,
    "density": 0.005,
    "avg_degree": 6.9871,
    "avg_unique_neighbors": 6.8953,
    "global_efficiency": 0.3772,
    "avg_path_length": 2.8372,
    "avg_degree_centrality": 0.01,
    "max_degree_centrality": 0.5345,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0739,
    "degree_assortativity": -0.1548,
    "graph_robustness": 0.7047,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3205,
    "weakly_connected_components": 11,
    "largest_wcc_size": 687,
    "pagerank_top10_percent": 4.84,
    "louvain_communities": 24,
    "louvain_modularity": 0.4381,
    "label_entropy": 1.4759,
    "computational_time": 0.2249182160012424
  },
  "retrieval_queries": []
}
2025-11-24 15:02:05,476 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:02:05,476 - src.pipeline.kg_builder - INFO - Batch 56 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 32.84s, Clean: 0.00s, Neo4j: 0.18s, ACS: 0.23s
2025-11-24 15:02:05,476 - src.pipeline.kg_builder - INFO - Batch 56 completed in 33.26s
Processing KG batches:  78%|███████▊  | 56/72 [34:03<08:28, 31.79s/it]2025-11-24 15:02:05,476 - src.pipeline.kg_builder - INFO - Processing batch 57/72 (3 items)
2025-11-24 15:02:05,476 - src.pipeline.kg_builder - DEBUG - Batch 57 current_video_time: 14:07-14:12
2025-11-24 15:02:05,487 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 697
- Total Relationships: 831
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:02:05,488 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 15:02:05,488 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0 ~236 words, content: Time: 13:58-14:03 Content: The video captures a sequence of actions in a laboratory setting, focusing on a chemical experiment. The scene is set on a...
2025-11-24 15:02:05,488 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1 ~223 words, content: , likely the preparation of a chemical solution or the initiation of a reaction that requires controlled conditions, such as heating and reflux. The person's...
2025-11-24 15:02:05,488 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2 ~238 words, content: a closer, first-person perspective, showing a person's hands wearing blue nitrile gloves. The person is actively handling a white plastic beaker. The long tube from...
2025-11-24 15:02:05,488 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3 ~255 words, content: with a clamp is visible to the left. - The second frame provides a closer view of the container and the tube. The person's hand...
2025-11-24 15:02:05,488 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_4 ~21 words, content:  is using a yellow apparatus with multiple tubes and clamps. The lab is well-equipped with various pieces of equipment and supplies.
2025-11-24 15:02:05,488 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:02:05,488 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0) (~236 words) with timeout=5.0s retries=3
2025-11-24 15:02:06,891 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:02:06,891 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:02:06,891 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1) (~223 words) with timeout=5.0s retries=3
2025-11-24 15:02:08,564 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:02:08,565 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:02:08,565 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2) (~238 words) with timeout=5.0s retries=3
2025-11-24 15:02:09,833 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:02:09,833 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:02:09,834 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3) (~255 words) with timeout=5.0s retries=3
2025-11-24 15:02:10,869 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 15:02:10,869 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 15:02:10,869 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_4) (~21 words) with timeout=5.0s retries=3
2025-11-24 15:02:11,965 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 15:02:11,965 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 15:02:11,965 - src.components.pre_llm_injector - INFO - Extracted 30 local triplets from 5 chunks
2025-11-24 15:02:11,965 - src.pipeline.kg_builder - INFO - Pre-extraction: 30 triplets in 6.48s
2025-11-24 15:02:11,966 - src.components.global_refiner - INFO - Capping refinement input: 30 → 25 triplets
2025-11-24 15:02:11,966 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 697
- Total Relationships: 831
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0"]}, {"head": "Person", "relation": "Pours", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0"]}, {"head": "Clear Liquid", "relation": "Flows Into", "tail": "Translucent Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Heated Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0"]}, {"head": "Reflux Condenser", "relation": "Is Above", "tail": "Glass Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0"]}, {"head": "Glass Flask", "relation": "Is Connected To", "tail": "Reflux Condenser", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0"]}, {"head": "Person", "relation": "Wears", "tail": "Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1"]}, {"head": "Reaction Apparatus", "relation": "Contains", "tail": "Round_Bottom_Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1"]}, {"head": "Round_Bottom_Flask", "relation": "Is On", "tail": "Magnetic_Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1"]}, {"head": "Magnetic_Stirrer", "relation": "Is On", "tail": "Hot_Plate", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1"]}, {"head": "Reaction_Apparatus", "relation": "Is Connected To", "tail": "Schlenk_Line", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Glass_Enclosed_Cabinet", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2"]}, {"head": "Tube", "relation": "Delivers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker_Steady", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Blue_Stand_With_Clamp", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2"]}, {"head": "Person", "relation": "Holds", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3"]}, {"head": "Person", "relation": "Holds", "tail": "Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3"]}, {"head": "Tube", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3"]}, {"head": "Person", "relation": "Uses", "tail": "Apparatus", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3"]}, {"head": "Apparatus", "relation": "Is Mounted On", "tail": "Metal Stand", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3"]}, {"head": "Container", "relation": "Is Transferred To", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3"]}, {"head": "Person", "relation": "Uses", "tail": "Yellow_Apparatus", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:02:11,966 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~342 words, ~445 tokens)
2025-11-24 15:02:11,966 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:02:41,574 - src.components.global_refiner - DEBUG - LLM call completed in 29.61s
2025-11-24 15:02:41,574 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_4']], ['Person', 'pours', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0']], ['Clear_Liquid', 'flows_into', 'Translucent_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0']], ['Glass_Flask', 'is_on', 'Heated_Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0']], ['Reflux_Condenser', 'is_above', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0']], ['Glass_Flask', 'is_connected_to', 'Reflux_Condenser', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0']], ['Person', 'wears', 'Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1']], ['Reaction_Apparatus', 'contains', 'Round_Bottom_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1']], ['Round_Bottom_Flask', 'is_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1']], ['Magnetic_Stirrer', 'is_on', 'Hot_Plate', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1']], ['Reaction_Apparatus', 'is_connected_to', 'Schlenk_Line', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1']], ['Laboratory', 'contains', 'Glass_Enclosed_Cabinet', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2']], ['Person', 'holds', 'Beaker_Steady', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2']], ['Lab_Bench', 'contains', 'Blue_Stand_With_Clamp', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2']], ['Person', 'holds', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3']], ['Person', 'holds', 'Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3']], ['Tube', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3']], ['Person', 'uses', 'Apparatus', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3']], ['Apparatus', 'is_mounted_on', 'Metal_Stand', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3']], ['Container', 'is_transferred_to', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3']], ['Person', 'uses', 'Yellow_Apparatus', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_4']], ['Tube', 'delivers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2']]]
2025-11-24 15:02:41,574 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_4"
    ]
  ],
  [
    "Person",
    "pours",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0"
    ]
  ],
  [
    "Clear_Liquid",
    "flows_into",
    "Translucent_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0"
    ]
  ],
  [
    "Glass_Flask",
    "is_on",
    "Heated_Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0"
    ]
  ],
  [
    "Reflux_Condenser",
    "is_above",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0"
    ]
  ],
  [
    "Glass_Flask",
    "is_connected_to",
    "Reflux_Condenser",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1"
    ]
  ],
  [
    "Reaction_Apparatus",
    "contains",
    "Round_Bottom_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1"
    ]
  ],
  [
    "Round_Bottom_Flask",
    "is_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "is_on",
    "Hot_Plate",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1"
    ]
  ],
  [
    "Reaction_Apparatus",
    "is_connected_to",
    "Schlenk_Line",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Glass_Enclosed_Cabinet",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker_Steady",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Blue_Stand_With_Clamp",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3"
    ]
  ],
  [
    "Tube",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Apparatus",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3"
    ]
  ],
  [
    "Apparatus",
    "is_mounted_on",
    "Metal_Stand",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3"
    ]
  ],
  [
    "Container",
    "is_transferred_to",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Yellow_Apparatus",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_4"
    ]
  ],
  [
    "Tube",
    "delivers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_56_2"
    ]
  ]
]
2025-11-24 15:02:41,574 - src.components.global_refiner - INFO - Refinement complete: 25 → 24 triplets (total: 29.61s, LLM: 29.61s)
2025-11-24 15:02:41,574 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 29.61s
2025-11-24 15:02:41,574 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:02:41,574 - src.pipeline.kg_builder - INFO - Pushing batch 57/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:02:41,574 - src.components.neo4j_handler - INFO - Adding 24 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:02:41,771 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:02:41,771 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:02:41,772 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:02:41,772 - src.components.neo4j_handler - INFO - Batch injected in 0.20s (triplets: 0.19s, indexes: 0.00s)
2025-11-24 15:02:41,772 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:02:41,856 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:02:41,957 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 700
2025-11-24 15:02:42,067 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 710, 'relationship_count': 2480, 'density': 0.0049, 'avg_degree': 6.9859, 'avg_unique_neighbors': 6.8901, 'global_efficiency': 0.3773, 'avg_path_length': 2.847, 'avg_degree_centrality': 0.0099, 'max_degree_centrality': 0.5346, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0734, 'degree_assortativity': -0.154, 'graph_robustness': 0.7044, 'diameter_estimate': 50, 'clustering_coefficient': 0.3217, 'weakly_connected_components': 11, 'largest_wcc_size': 700, 'pagerank_top10_percent': 4.76, 'louvain_communities': 24, 'louvain_modularity': 0.4399, 'label_entropy': 1.476, 'computational_time': 0.29509584297193214}
2025-11-24 15:02:42,067 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 56, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967762.0675573, 'total_time': 36.59060927800601, 'aggregation': 2.668995875865221e-06, 'network_info': 0.01053318299818784, 'llm_extraction': 36.086901934002526, 'data_cleaning': 1.758901635184884e-05, 'neo4j_injection': 0.1975747809628956, 'embedding_time': 0, 'indexing_time': 0.00280353199923411, 'graph_injection_time': 0.19461444998160005, 'acs_metrics': {'node_count': 710, 'relationship_count': 2480, 'density': 0.0049, 'avg_degree': 6.9859, 'avg_unique_neighbors': 6.8901, 'global_efficiency': 0.3773, 'avg_path_length': 2.847, 'avg_degree_centrality': 0.0099, 'max_degree_centrality': 0.5346, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0734, 'degree_assortativity': -0.154, 'graph_robustness': 0.7044, 'diameter_estimate': 50, 'clustering_coefficient': 0.3217, 'weakly_connected_components': 11, 'largest_wcc_size': 700, 'pagerank_top10_percent': 4.76, 'louvain_communities': 24, 'louvain_modularity': 0.4399, 'label_entropy': 1.476, 'computational_time': 0.29509584297193214}, 'retrieval_queries': []}
2025-11-24 15:02:42,067 - src.pipeline.kg_builder - DEBUG - Batch 56 metrics: {
  "batch_idx": 56,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967762.0675573,
  "total_time": 36.59060927800601,
  "aggregation": 2.668995875865221e-06,
  "network_info": 0.01053318299818784,
  "llm_extraction": 36.086901934002526,
  "data_cleaning": 1.758901635184884e-05,
  "neo4j_injection": 0.1975747809628956,
  "embedding_time": 0,
  "indexing_time": 0.00280353199923411,
  "graph_injection_time": 0.19461444998160005,
  "acs_metrics": {
    "node_count": 710,
    "relationship_count": 2480,
    "density": 0.0049,
    "avg_degree": 6.9859,
    "avg_unique_neighbors": 6.8901,
    "global_efficiency": 0.3773,
    "avg_path_length": 2.847,
    "avg_degree_centrality": 0.0099,
    "max_degree_centrality": 0.5346,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0734,
    "degree_assortativity": -0.154,
    "graph_robustness": 0.7044,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3217,
    "weakly_connected_components": 11,
    "largest_wcc_size": 700,
    "pagerank_top10_percent": 4.76,
    "louvain_communities": 24,
    "louvain_modularity": 0.4399,
    "label_entropy": 1.476,
    "computational_time": 0.29509584297193214
  },
  "retrieval_queries": []
}
2025-11-24 15:02:42,068 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:02:42,068 - src.pipeline.kg_builder - INFO - Batch 57 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 36.09s, Clean: 0.00s, Neo4j: 0.20s, ACS: 0.30s
2025-11-24 15:02:42,068 - src.pipeline.kg_builder - INFO - Batch 57 completed in 36.59s
Processing KG batches:  79%|███████▉  | 57/72 [34:39<08:18, 33.23s/it]2025-11-24 15:02:42,068 - src.pipeline.kg_builder - INFO - Processing batch 58/72 (3 items)
2025-11-24 15:02:42,068 - src.pipeline.kg_builder - DEBUG - Batch 58 current_video_time: 14:22-14:27
2025-11-24 15:02:42,073 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 710
- Total Relationships: 848
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:02:42,073 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 15:02:42,073 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0 ~238 words, content: Time: 14:12-14:17 Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a procedure on a black lab bench. The...
2025-11-24 15:02:42,073 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1 ~229 words, content: The laboratory environment is well-equipped, with various pieces of equipment and supplies visible in the background. The person's actions are methodical and precise, indicating a...
2025-11-24 15:02:42,073 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2 ~235 words, content: yellow, multi-way manifold (a Schlenk line). This manifold is mounted on a metal stand and is used to control the flow of inert gas (like...
2025-11-24 15:02:42,073 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3 ~94 words, content: to transfer liquid from the white container into a glass flask. The flask is being held by the person's hand, and the tube is being...
2025-11-24 15:02:42,074 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:02:42,074 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0) (~238 words) with timeout=5.0s retries=3
2025-11-24 15:02:43,285 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:02:43,285 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:02:43,286 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1) (~229 words) with timeout=5.0s retries=3
2025-11-24 15:02:44,905 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:02:44,905 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:02:44,905 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2) (~235 words) with timeout=5.0s retries=3
2025-11-24 15:02:46,212 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:02:46,212 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:02:46,212 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3) (~94 words) with timeout=5.0s retries=3
2025-11-24 15:02:47,346 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 15:02:47,346 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 15:02:47,346 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 4 chunks
2025-11-24 15:02:47,346 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 5.27s
2025-11-24 15:02:47,347 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 710
- Total Relationships: 848
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1"]}, {"head": "Person", "relation": "Handles", "tail": "Flexible_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0"]}, {"head": "Flexible_Tube", "relation": "Is Connected To", "tail": "Vacuum_System", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3"]}, {"head": "Liquid", "relation": "Is In", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0"]}, {"head": "Flask", "relation": "Is On", "tail": "Balance_Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0"]}, {"head": "Person", "relation": "Holds", "tail": "Flexible_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1"]}, {"head": "Flexible_Tube", "relation": "Connects To", "tail": "Schlenk_Line", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1"]}, {"head": "Schlenk_Line", "relation": "Is Part Of", "tail": "Inert_Atmosphere_System", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1"]}, {"head": "Person", "relation": "Performs", "tail": "Laboratory_Procedure", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1"]}, {"head": "Laboratory_Procedure", "relation": "Involves", "tail": "Chemical_Synthesis_Or_Purification", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2"]}, {"head": "Person", "relation": "Holds", "tail": "Flexible Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2"]}, {"head": "Flexible Tube", "relation": "Connects To", "tail": "Schlenk Line", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2"]}, {"head": "Schlenk Line", "relation": "Controls", "tail": "Inert Gas", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2"]}, {"head": "Glass Flask", "relation": "Is Held By", "tail": "Clamp", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2"]}, {"head": "Glass Flask", "relation": "Is Positioned On", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2"]}, {"head": "Liquid", "relation": "Flows Into", "tail": "Glass Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3"]}, {"head": "Glass Flask", "relation": "Is Held By", "tail": "Person", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3"]}, {"head": "Tube", "relation": "Is Inserted Into", "tail": "Glass Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3"]}, {"head": "Person", "relation": "Performs", "tail": "Chemical Procedure", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3"]}, {"head": "Chemical Procedure", "relation": "Requires", "tail": "Inert Atmosphere", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:02:47,347 - src.components.global_refiner - DEBUG - Refining 22 triplets (prompt ~325 words, ~422 tokens)
2025-11-24 15:02:47,347 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:03:14,171 - src.components.global_refiner - DEBUG - LLM call completed in 26.82s
2025-11-24 15:03:14,171 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1']], ['Person', 'handles', 'Flexible_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0']], ['Flexible_Tube', 'is_connected_to', 'Vacuum_System', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0']], ['Person', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3']], ['Liquid', 'is_in', 'Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0']], ['Flask', 'is_on', 'Balance_Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0']], ['Person', 'holds', 'Flexible_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2']], ['Flexible_Tube', 'connects_to', 'Schlenk_Line', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2']], ['Schlenk_Line', 'is_part_of', 'Inert_Atmosphere_System', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1']], ['Person', 'performs', 'Laboratory_Procedure', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1']], ['Laboratory_Procedure', 'involves', 'Chemical_Synthesis_Or_Purification', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1']], ['Person', 'wears', 'Blue_Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2']], ['Schlenk_Line', 'controls', 'Inert_Gas', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2']], ['Glass_Flask', 'is_held_by', 'Clamp', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2']], ['Glass_Flask', 'is_positioned_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2']], ['Liquid', 'flows_into', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3']], ['Glass_Flask', 'is_held_by', 'Person', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3']], ['Tube', 'is_inserted_into', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3']], ['Person', 'performs', 'Chemical_Procedure', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3']], ['Chemical_Procedure', 'requires', 'Inert_Atmosphere', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3']]]
2025-11-24 15:03:14,171 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1"
    ]
  ],
  [
    "Person",
    "handles",
    "Flexible_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0"
    ]
  ],
  [
    "Flexible_Tube",
    "is_connected_to",
    "Vacuum_System",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0"
    ]
  ],
  [
    "Person",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3"
    ]
  ],
  [
    "Liquid",
    "is_in",
    "Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0"
    ]
  ],
  [
    "Flask",
    "is_on",
    "Balance_Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Flexible_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2"
    ]
  ],
  [
    "Flexible_Tube",
    "connects_to",
    "Schlenk_Line",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2"
    ]
  ],
  [
    "Schlenk_Line",
    "is_part_of",
    "Inert_Atmosphere_System",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1"
    ]
  ],
  [
    "Person",
    "performs",
    "Laboratory_Procedure",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1"
    ]
  ],
  [
    "Laboratory_Procedure",
    "involves",
    "Chemical_Synthesis_Or_Purification",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2"
    ]
  ],
  [
    "Schlenk_Line",
    "controls",
    "Inert_Gas",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2"
    ]
  ],
  [
    "Glass_Flask",
    "is_held_by",
    "Clamp",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2"
    ]
  ],
  [
    "Glass_Flask",
    "is_positioned_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_2"
    ]
  ],
  [
    "Liquid",
    "flows_into",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3"
    ]
  ],
  [
    "Glass_Flask",
    "is_held_by",
    "Person",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3"
    ]
  ],
  [
    "Tube",
    "is_inserted_into",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3"
    ]
  ],
  [
    "Person",
    "performs",
    "Chemical_Procedure",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3"
    ]
  ],
  [
    "Chemical_Procedure",
    "requires",
    "Inert_Atmosphere",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_57_3"
    ]
  ]
]
2025-11-24 15:03:14,171 - src.components.global_refiner - INFO - Refinement complete: 22 → 20 triplets (total: 26.82s, LLM: 26.82s)
2025-11-24 15:03:14,171 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 26.82s
2025-11-24 15:03:14,171 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:03:14,171 - src.pipeline.kg_builder - INFO - Pushing batch 58/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:03:14,171 - src.components.neo4j_handler - INFO - Adding 20 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:03:14,490 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:03:14,490 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:03:14,490 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:03:14,490 - src.components.neo4j_handler - INFO - Batch injected in 0.32s (triplets: 0.32s, indexes: 0.00s)
2025-11-24 15:03:14,490 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:03:14,554 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:03:14,657 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 711
2025-11-24 15:03:14,706 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 721, 'relationship_count': 2518, 'density': 0.0049, 'avg_degree': 6.9847, 'avg_unique_neighbors': 6.8877, 'global_efficiency': 0.3779, 'avg_path_length': 2.8691, 'avg_degree_centrality': 0.0097, 'max_degree_centrality': 0.5361, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0739, 'degree_assortativity': -0.153, 'graph_robustness': 0.7037, 'diameter_estimate': 50, 'clustering_coefficient': 0.3223, 'weakly_connected_components': 11, 'largest_wcc_size': 711, 'pagerank_top10_percent': 4.68, 'louvain_communities': 23, 'louvain_modularity': 0.442, 'label_entropy': 1.476, 'computational_time': 0.21528647700324655}
2025-11-24 15:03:14,706 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 57, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967794.706197, 'total_time': 32.63726574298926, 'aggregation': 3.264984115958214e-06, 'network_info': 0.004410060006193817, 'llm_extraction': 32.09788224095246, 'data_cleaning': 1.67780090123415e-05, 'neo4j_injection': 0.3192952499957755, 'embedding_time': 0, 'indexing_time': 0.004143928992561996, 'graph_injection_time': 0.3150055459700525, 'acs_metrics': {'node_count': 721, 'relationship_count': 2518, 'density': 0.0049, 'avg_degree': 6.9847, 'avg_unique_neighbors': 6.8877, 'global_efficiency': 0.3779, 'avg_path_length': 2.8691, 'avg_degree_centrality': 0.0097, 'max_degree_centrality': 0.5361, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0739, 'degree_assortativity': -0.153, 'graph_robustness': 0.7037, 'diameter_estimate': 50, 'clustering_coefficient': 0.3223, 'weakly_connected_components': 11, 'largest_wcc_size': 711, 'pagerank_top10_percent': 4.68, 'louvain_communities': 23, 'louvain_modularity': 0.442, 'label_entropy': 1.476, 'computational_time': 0.21528647700324655}, 'retrieval_queries': []}
2025-11-24 15:03:14,706 - src.pipeline.kg_builder - DEBUG - Batch 57 metrics: {
  "batch_idx": 57,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967794.706197,
  "total_time": 32.63726574298926,
  "aggregation": 3.264984115958214e-06,
  "network_info": 0.004410060006193817,
  "llm_extraction": 32.09788224095246,
  "data_cleaning": 1.67780090123415e-05,
  "neo4j_injection": 0.3192952499957755,
  "embedding_time": 0,
  "indexing_time": 0.004143928992561996,
  "graph_injection_time": 0.3150055459700525,
  "acs_metrics": {
    "node_count": 721,
    "relationship_count": 2518,
    "density": 0.0049,
    "avg_degree": 6.9847,
    "avg_unique_neighbors": 6.8877,
    "global_efficiency": 0.3779,
    "avg_path_length": 2.8691,
    "avg_degree_centrality": 0.0097,
    "max_degree_centrality": 0.5361,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0739,
    "degree_assortativity": -0.153,
    "graph_robustness": 0.7037,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3223,
    "weakly_connected_components": 11,
    "largest_wcc_size": 711,
    "pagerank_top10_percent": 4.68,
    "louvain_communities": 23,
    "louvain_modularity": 0.442,
    "label_entropy": 1.476,
    "computational_time": 0.21528647700324655
  },
  "retrieval_queries": []
}
2025-11-24 15:03:14,707 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:03:14,707 - src.pipeline.kg_builder - INFO - Batch 58 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 32.10s, Clean: 0.00s, Neo4j: 0.32s, ACS: 0.22s
2025-11-24 15:03:14,707 - src.pipeline.kg_builder - INFO - Batch 58 completed in 32.64s
Processing KG batches:  81%|████████  | 58/72 [35:12<07:42, 33.05s/it]2025-11-24 15:03:14,707 - src.pipeline.kg_builder - INFO - Processing batch 59/72 (3 items)
2025-11-24 15:03:14,707 - src.pipeline.kg_builder - DEBUG - Batch 59 current_video_time: 14:37-14:42
2025-11-24 15:03:14,717 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 721
- Total Relationships: 863
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:03:14,718 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-24 15:03:14,718 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0 ~223 words, content: Time: 14:27-14:32 Content: The video shows a person conducting a laboratory procedure, likely a rinsing or washing step, from a first-person perspective. The scene is...
2025-11-24 15:03:14,718 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1 ~222 words, content: methodical and controlled process, such as preparing a solution or cleaning glassware. Time: 14:32-14:37 Content: The video begins with a close-up view of a laboratory...
2025-11-24 15:03:14,718 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2 ~145 words, content: on a black laboratory bench. On the bench, a complex experimental setup is in progress. A long, flexible, translucent tube is connected to a yellow...
2025-11-24 15:03:14,718 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:03:14,718 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0) (~223 words) with timeout=5.0s retries=3
2025-11-24 15:03:16,458 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:03:16,458 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:03:16,458 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1) (~222 words) with timeout=5.0s retries=3
2025-11-24 15:03:17,672 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:03:17,672 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:03:17,673 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2) (~145 words) with timeout=5.0s retries=3
2025-11-24 15:03:18,932 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:03:18,933 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:03:18,933 - src.components.pre_llm_injector - INFO - Extracted 18 local triplets from 3 chunks
2025-11-24 15:03:18,933 - src.pipeline.kg_builder - INFO - Pre-extraction: 18 triplets in 4.22s
2025-11-24 15:03:18,933 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 721
- Total Relationships: 863
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0"]}, {"head": "Translucent_Tube", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0"]}, {"head": "Clear_Liquid", "relation": "Flows Into", "tail": "White_Plastic_Measuring_Jug", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0"]}, {"head": "White_Plastic_Measuring_Jug", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0"]}, {"head": "Person", "relation": "Manipulates", "tail": "White_Plastic_Measuring_Jug", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0"]}, {"head": "Plastic Tube", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1"]}, {"head": "Laboratory Bench", "relation": "Contains", "tail": "Measuring Cup", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1"]}, {"head": "Man", "relation": "Wears", "tail": "Turtleneck Sweater", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1"]}, {"head": "Man", "relation": "Wears", "tail": "Jeans", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1"]}, {"head": "Man", "relation": "Stands In Front Of", "tail": "Storage Cabinet", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1"]}, {"head": "Storage Cabinet", "relation": "Contains", "tail": "Laboratory Supplies", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1"]}, {"head": "Laboratory Bench", "relation": "Contains", "tail": "Experimental Setup", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2"]}, {"head": "Experimental Setup", "relation": "Includes", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2"]}, {"head": "Experimental Setup", "relation": "Includes", "tail": "Glass Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2"]}, {"head": "Experimental Setup", "relation": "Includes", "tail": "Clear Plastic Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2"]}, {"head": "Magnetic Stirrer", "relation": "Has", "tail": "Blue Base", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2"]}, {"head": "Experimental Setup", "relation": "Uses", "tail": "Translucent Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:03:18,933 - src.components.global_refiner - DEBUG - Refining 18 triplets (prompt ~283 words, ~368 tokens)
2025-11-24 15:03:18,933 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:03:40,523 - src.components.global_refiner - DEBUG - LLM call completed in 21.59s
2025-11-24 15:03:40,523 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0']], ['Person', 'holds', 'Translucent_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0']], ['Translucent_Tube', 'transfers', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0']], ['Clear_Liquid', 'flows_into', 'White_Plastic_Measuring_Jug', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0']], ['White_Plastic_Measuring_Jug', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0']], ['Person', 'manipulates', 'White_Plastic_Measuring_Jug', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0']], ['Plastic_Tube', 'dispenses', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1']], ['Laboratory_Bench', 'contains', 'Measuring_Cup', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1']], ['Person', 'wears', 'Turtleneck_Sweater', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1']], ['Person', 'wears', 'Jeans', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1']], ['Person', 'stands_in_front_of', 'Storage_Cabinet', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1']], ['Storage_Cabinet', 'contains', 'Laboratory_Supplies', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1']], ['Laboratory_Bench', 'contains', 'Experimental_Setup', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2']], ['Experimental_Setup', 'includes', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2']], ['Experimental_Setup', 'includes', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2']], ['Experimental_Setup', 'includes', 'Clear_Plastic_Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2']], ['Magnetic_Stirrer', 'has', 'Blue_Base', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2']], ['Experimental_Setup', 'uses', 'Translucent_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2']]]
2025-11-24 15:03:40,523 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Translucent_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0"
    ]
  ],
  [
    "Translucent_Tube",
    "transfers",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0"
    ]
  ],
  [
    "Clear_Liquid",
    "flows_into",
    "White_Plastic_Measuring_Jug",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0"
    ]
  ],
  [
    "White_Plastic_Measuring_Jug",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0"
    ]
  ],
  [
    "Person",
    "manipulates",
    "White_Plastic_Measuring_Jug",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_0"
    ]
  ],
  [
    "Plastic_Tube",
    "dispenses",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Measuring_Cup",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Turtleneck_Sweater",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Jeans",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1"
    ]
  ],
  [
    "Person",
    "stands_in_front_of",
    "Storage_Cabinet",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1"
    ]
  ],
  [
    "Storage_Cabinet",
    "contains",
    "Laboratory_Supplies",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_1"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Experimental_Setup",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2"
    ]
  ],
  [
    "Experimental_Setup",
    "includes",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2"
    ]
  ],
  [
    "Experimental_Setup",
    "includes",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2"
    ]
  ],
  [
    "Experimental_Setup",
    "includes",
    "Clear_Plastic_Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "has",
    "Blue_Base",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2"
    ]
  ],
  [
    "Experimental_Setup",
    "uses",
    "Translucent_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_58_2"
    ]
  ]
]
2025-11-24 15:03:40,523 - src.components.global_refiner - INFO - Refinement complete: 18 → 18 triplets (total: 21.59s, LLM: 21.59s)
2025-11-24 15:03:40,524 - src.pipeline.kg_builder - INFO - Global refinement: 18 triplets in 21.59s
2025-11-24 15:03:40,524 - src.pipeline.kg_builder - INFO - Using 18 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:03:40,524 - src.pipeline.kg_builder - INFO - Pushing batch 59/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:03:40,524 - src.components.neo4j_handler - INFO - Adding 18 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:03:40,761 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:03:40,761 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:03:40,762 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:03:40,762 - src.components.neo4j_handler - INFO - Batch injected in 0.24s (triplets: 0.23s, indexes: 0.01s)
2025-11-24 15:03:40,762 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:03:40,826 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:03:40,931 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 719
2025-11-24 15:03:40,980 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 729, 'relationship_count': 2552, 'density': 0.0048, 'avg_degree': 7.0014, 'avg_unique_neighbors': 6.9026, 'global_efficiency': 0.3784, 'avg_path_length': 2.8646, 'avg_degree_centrality': 0.0096, 'max_degree_centrality': 0.5357, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0817, 'degree_assortativity': -0.1529, 'graph_robustness': 0.7061, 'diameter_estimate': 50, 'clustering_coefficient': 0.321, 'weakly_connected_components': 11, 'largest_wcc_size': 719, 'pagerank_top10_percent': 4.61, 'louvain_communities': 24, 'louvain_modularity': 0.4425, 'label_entropy': 1.476, 'computational_time': 0.21824207698227838}
2025-11-24 15:03:40,980 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 58, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967820.9807446, 'total_time': 26.273200644995086, 'aggregation': 2.7070054784417152e-06, 'network_info': 0.010100073995999992, 'llm_extraction': 25.806237884040456, 'data_cleaning': 1.3789976947009563e-05, 'neo4j_injection': 0.238117091008462, 'embedding_time': 0, 'indexing_time': 0.005451937031466514, 'graph_injection_time': 0.232516210002359, 'acs_metrics': {'node_count': 729, 'relationship_count': 2552, 'density': 0.0048, 'avg_degree': 7.0014, 'avg_unique_neighbors': 6.9026, 'global_efficiency': 0.3784, 'avg_path_length': 2.8646, 'avg_degree_centrality': 0.0096, 'max_degree_centrality': 0.5357, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0817, 'degree_assortativity': -0.1529, 'graph_robustness': 0.7061, 'diameter_estimate': 50, 'clustering_coefficient': 0.321, 'weakly_connected_components': 11, 'largest_wcc_size': 719, 'pagerank_top10_percent': 4.61, 'louvain_communities': 24, 'louvain_modularity': 0.4425, 'label_entropy': 1.476, 'computational_time': 0.21824207698227838}, 'retrieval_queries': []}
2025-11-24 15:03:40,980 - src.pipeline.kg_builder - DEBUG - Batch 58 metrics: {
  "batch_idx": 58,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967820.9807446,
  "total_time": 26.273200644995086,
  "aggregation": 2.7070054784417152e-06,
  "network_info": 0.010100073995999992,
  "llm_extraction": 25.806237884040456,
  "data_cleaning": 1.3789976947009563e-05,
  "neo4j_injection": 0.238117091008462,
  "embedding_time": 0,
  "indexing_time": 0.005451937031466514,
  "graph_injection_time": 0.232516210002359,
  "acs_metrics": {
    "node_count": 729,
    "relationship_count": 2552,
    "density": 0.0048,
    "avg_degree": 7.0014,
    "avg_unique_neighbors": 6.9026,
    "global_efficiency": 0.3784,
    "avg_path_length": 2.8646,
    "avg_degree_centrality": 0.0096,
    "max_degree_centrality": 0.5357,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0817,
    "degree_assortativity": -0.1529,
    "graph_robustness": 0.7061,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.321,
    "weakly_connected_components": 11,
    "largest_wcc_size": 719,
    "pagerank_top10_percent": 4.61,
    "louvain_communities": 24,
    "louvain_modularity": 0.4425,
    "label_entropy": 1.476,
    "computational_time": 0.21824207698227838
  },
  "retrieval_queries": []
}
2025-11-24 15:03:40,982 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:03:40,982 - src.pipeline.kg_builder - INFO - Batch 59 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 25.81s, Clean: 0.00s, Neo4j: 0.24s, ACS: 0.22s
2025-11-24 15:03:40,982 - src.pipeline.kg_builder - INFO - Batch 59 completed in 26.27s
Processing KG batches:  82%|████████▏ | 59/72 [35:38<06:43, 31.02s/it]2025-11-24 15:03:40,982 - src.pipeline.kg_builder - INFO - Processing batch 60/72 (3 items)
2025-11-24 15:03:40,982 - src.pipeline.kg_builder - DEBUG - Batch 60 current_video_time: 14:52-14:57
2025-11-24 15:03:40,988 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 729
- Total Relationships: 876
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:03:40,988 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 15:03:40,988 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_0 ~238 words, content: Time: 14:42-14:47 Content: The video shows a laboratory setting where a scientific procedure is in progress. The central focus is a long, flexible tube, which...
2025-11-24 15:03:40,989 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_1 ~239 words, content: 52 Content: The video sequence captures a scientific experiment being conducted in a laboratory setting. The scene is set on a black laboratory bench, which...
2025-11-24 15:03:40,989 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_2 ~236 words, content: aker via the long tube. The liquid is being added slowly and steadily, indicating a controlled process. The entire setup is designed to ensure a...
2025-11-24 15:03:40,989 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_3 ~219 words, content: apparatus featuring a yellow, multi-armed clamp holding several tubes and a long, flexible tube. This entire assembly is mounted on a metal stand. The background...
2025-11-24 15:03:40,989 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_4 ~89 words, content: View (Frame 5):** The camera focuses on the end of the long, flexible tube, which is submerged in a white plastic beaker filled with a...
2025-11-24 15:03:40,989 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:03:40,989 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_0) (~238 words) with timeout=5.0s retries=3
2025-11-24 15:03:42,248 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:03:42,248 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:03:42,248 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_1) (~239 words) with timeout=5.0s retries=3
2025-11-24 15:03:43,435 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:03:43,435 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:03:43,435 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_2) (~236 words) with timeout=5.0s retries=3
2025-11-24 15:03:44,627 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:03:44,627 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:03:44,627 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_3) (~219 words) with timeout=5.0s retries=3
2025-11-24 15:03:45,721 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 15:03:45,721 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 15:03:45,721 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_4) (~89 words) with timeout=5.0s retries=3
2025-11-24 15:03:46,870 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 15:03:46,870 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 15:03:46,870 - src.components.pre_llm_injector - INFO - Extracted 30 local triplets from 5 chunks
2025-11-24 15:03:46,871 - src.pipeline.kg_builder - INFO - Pre-extraction: 30 triplets in 5.88s
2025-11-24 15:03:46,871 - src.components.global_refiner - INFO - Capping refinement input: 30 → 25 triplets
2025-11-24 15:03:46,871 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 729
- Total Relationships: 876
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Vacuum Filtration Setup", "relation": "Contains", "tail": "Flexible Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_0"]}, {"head": "Flexible Tube", "relation": "Connects", "tail": "Blue Stand", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_0"]}, {"head": "Flexible Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_0"]}, {"head": "Liquid", "relation": "Flows Through", "tail": "Flexible Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_0"]}, {"head": "Liquid", "relation": "Enters", "tail": "White Plastic Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_0"]}, {"head": "White Plastic Beaker", "relation": "Rests On", "tail": "Laboratory Table", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_0"]}, {"head": "Laboratory Bench", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_1"]}, {"head": "Beaker", "relation": "Connected To", "tail": "Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_1"]}, {"head": "Tube", "relation": "Connected To", "tail": "Balance Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_1"]}, {"head": "Beaker", "relation": "Placed On", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_1"]}, {"head": "Glass Flask", "relation": "Held By", "tail": "Clamp", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_1"]}, {"head": "Clamp", "relation": "Attached To", "tail": "Metal Stand", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_1"]}, {"head": "Flask", "relation": "Is Connected To", "tail": "Apparatus", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_2"]}, {"head": "Apparatus", "relation": "Contains", "tail": "Long Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_2"]}, {"head": "Liquid", "relation": "Is Added To", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_2"]}, {"head": "Flask", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_2"]}, {"head": "Person", "relation": "Observes", "tail": "Experiment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_2"]}, {"head": "Apparatus", "relation": "Is Used For", "tail": "Controlled Addition", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_2"]}, {"head": "Apparatus", "relation": "Holds", "tail": "Tubes", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_3"]}, {"head": "Apparatus", "relation": "Holds", "tail": "Flexible Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_3"]}, {"head": "Apparatus", "relation": "Mounted On", "tail": "Metal Stand", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_3"]}, {"head": "Camera", "relation": "Moves", "tail": "Upward", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_3"]}, {"head": "Person", "relation": "Stands In", "tail": "Lab", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_3"]}, {"head": "Lab", "relation": "Contains", "tail": "White Cabinets", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_3"]}, {"head": "Tube", "relation": "Is Submerged In", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_59_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:03:46,871 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~356 words, ~463 tokens)
2025-11-24 15:03:46,871 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:03:55,752 - src.components.global_refiner - DEBUG - LLM call completed in 8.88s
2025-11-24 15:03:55,752 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Vacuum Filtration Setup', 'contains', 'Flexible Tube', [0]], ['Flexible Tube', 'connects', 'Blue Stand', [0]], ['Flexible Tube', 'transfers', 'Liquid', [0]], ['Liquid', 'flows_through', 'Flexible Tube', [0]], ['Liquid', 'enters', 'White Plastic Beaker', [0]], ['White Plastic Beaker', 'rests_on', 'Laboratory Table', [0]], ['Laboratory Bench', 'contains', 'Beaker', [1]], ['Beaker', 'connected_to', 'Tube', [1]], ['Tube', 'connected_to', 'Balance Scale', [1]], ['Beaker', 'placed_on', 'Magnetic Stirrer', [1]], ['Glass Flask', 'held_by', 'Clamp', [1]], ['Clamp', 'attached_to', 'Metal Stand', [1]], ['Flask', 'is_connected_to', 'Apparatus', [2]], ['Apparatus', 'contains', 'Long Tube', [2]], ['Liquid', 'is_added_to', 'Flask', [2]], ['Flask', 'is_on', 'Magnetic Stirrer', [2]], ['Person', 'observes', 'Experiment', [2]], ['Apparatus', 'is_used_for', 'Controlled Addition', [2]], ['Apparatus', 'holds', 'Tubes', [3]], ['Apparatus', 'holds', 'Flexible Tube', [3]], ['Apparatus', 'mounted_on', 'Metal Stand', [3]], ['Camera', 'moves', 'Upward', [3]], ['Person', 'stands_in', 'Lab', [3]], ['Lab', 'contains', 'White Cabinets', [3]], ['Tube', 'is_submerged_in', 'Beaker', [4]]]
2025-11-24 15:03:55,752 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Vacuum Filtration Setup",
    "contains",
    "Flexible Tube",
    [
      0
    ]
  ],
  [
    "Flexible Tube",
    "connects",
    "Blue Stand",
    [
      0
    ]
  ],
  [
    "Flexible Tube",
    "transfers",
    "Liquid",
    [
      0
    ]
  ],
  [
    "Liquid",
    "flows_through",
    "Flexible Tube",
    [
      0
    ]
  ],
  [
    "Liquid",
    "enters",
    "White Plastic Beaker",
    [
      0
    ]
  ],
  [
    "White Plastic Beaker",
    "rests_on",
    "Laboratory Table",
    [
      0
    ]
  ],
  [
    "Laboratory Bench",
    "contains",
    "Beaker",
    [
      1
    ]
  ],
  [
    "Beaker",
    "connected_to",
    "Tube",
    [
      1
    ]
  ],
  [
    "Tube",
    "connected_to",
    "Balance Scale",
    [
      1
    ]
  ],
  [
    "Beaker",
    "placed_on",
    "Magnetic Stirrer",
    [
      1
    ]
  ],
  [
    "Glass Flask",
    "held_by",
    "Clamp",
    [
      1
    ]
  ],
  [
    "Clamp",
    "attached_to",
    "Metal Stand",
    [
      1
    ]
  ],
  [
    "Flask",
    "is_connected_to",
    "Apparatus",
    [
      2
    ]
  ],
  [
    "Apparatus",
    "contains",
    "Long Tube",
    [
      2
    ]
  ],
  [
    "Liquid",
    "is_added_to",
    "Flask",
    [
      2
    ]
  ],
  [
    "Flask",
    "is_on",
    "Magnetic Stirrer",
    [
      2
    ]
  ],
  [
    "Person",
    "observes",
    "Experiment",
    [
      2
    ]
  ],
  [
    "Apparatus",
    "is_used_for",
    "Controlled Addition",
    [
      2
    ]
  ],
  [
    "Apparatus",
    "holds",
    "Tubes",
    [
      3
    ]
  ],
  [
    "Apparatus",
    "holds",
    "Flexible Tube",
    [
      3
    ]
  ],
  [
    "Apparatus",
    "mounted_on",
    "Metal Stand",
    [
      3
    ]
  ],
  [
    "Camera",
    "moves",
    "Upward",
    [
      3
    ]
  ],
  [
    "Person",
    "stands_in",
    "Lab",
    [
      3
    ]
  ],
  [
    "Lab",
    "contains",
    "White Cabinets",
    [
      3
    ]
  ],
  [
    "Tube",
    "is_submerged_in",
    "Beaker",
    [
      4
    ]
  ]
]
2025-11-24 15:03:55,752 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 8.88s, LLM: 8.88s)
2025-11-24 15:03:55,752 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 8.88s
2025-11-24 15:03:55,752 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:03:55,752 - src.pipeline.kg_builder - INFO - Pushing batch 60/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:03:55,752 - src.components.neo4j_handler - INFO - Adding 25 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:03:56,219 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:03:56,219 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:03:56,220 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:03:56,220 - src.components.neo4j_handler - INFO - Batch injected in 0.47s (triplets: 0.47s, indexes: 0.00s)
2025-11-24 15:03:56,220 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:03:56,306 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:03:56,413 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 729
2025-11-24 15:03:56,464 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 744, 'relationship_count': 2574, 'density': 0.0047, 'avg_degree': 6.9194, 'avg_unique_neighbors': 6.8145, 'global_efficiency': 0.3739, 'avg_path_length': 2.8743, 'avg_degree_centrality': 0.0093, 'max_degree_centrality': 0.5262, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0831, 'degree_assortativity': -0.149, 'graph_robustness': 0.704, 'diameter_estimate': 50, 'clustering_coefficient': 0.3149, 'weakly_connected_components': 16, 'largest_wcc_size': 729, 'pagerank_top10_percent': 4.53, 'louvain_communities': 28, 'louvain_modularity': 0.4387, 'label_entropy': 1.4757, 'computational_time': 0.24403379997238517}
2025-11-24 15:03:56,464 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 59, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967836.4644403, 'total_time': 15.482255855982658, 'aggregation': 2.668006345629692e-06, 'network_info': 0.0061536640278063715, 'llm_extraction': 14.764000966970343, 'data_cleaning': 1.8551014363765717e-05, 'neo4j_injection': 0.46759000897873193, 'embedding_time': 0, 'indexing_time': 0.0016078060143627226, 'graph_injection_time': 0.4658269290230237, 'acs_metrics': {'node_count': 744, 'relationship_count': 2574, 'density': 0.0047, 'avg_degree': 6.9194, 'avg_unique_neighbors': 6.8145, 'global_efficiency': 0.3739, 'avg_path_length': 2.8743, 'avg_degree_centrality': 0.0093, 'max_degree_centrality': 0.5262, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0831, 'degree_assortativity': -0.149, 'graph_robustness': 0.704, 'diameter_estimate': 50, 'clustering_coefficient': 0.3149, 'weakly_connected_components': 16, 'largest_wcc_size': 729, 'pagerank_top10_percent': 4.53, 'louvain_communities': 28, 'louvain_modularity': 0.4387, 'label_entropy': 1.4757, 'computational_time': 0.24403379997238517}, 'retrieval_queries': []}
2025-11-24 15:03:56,464 - src.pipeline.kg_builder - DEBUG - Batch 59 metrics: {
  "batch_idx": 59,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967836.4644403,
  "total_time": 15.482255855982658,
  "aggregation": 2.668006345629692e-06,
  "network_info": 0.0061536640278063715,
  "llm_extraction": 14.764000966970343,
  "data_cleaning": 1.8551014363765717e-05,
  "neo4j_injection": 0.46759000897873193,
  "embedding_time": 0,
  "indexing_time": 0.0016078060143627226,
  "graph_injection_time": 0.4658269290230237,
  "acs_metrics": {
    "node_count": 744,
    "relationship_count": 2574,
    "density": 0.0047,
    "avg_degree": 6.9194,
    "avg_unique_neighbors": 6.8145,
    "global_efficiency": 0.3739,
    "avg_path_length": 2.8743,
    "avg_degree_centrality": 0.0093,
    "max_degree_centrality": 0.5262,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0831,
    "degree_assortativity": -0.149,
    "graph_robustness": 0.704,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3149,
    "weakly_connected_components": 16,
    "largest_wcc_size": 729,
    "pagerank_top10_percent": 4.53,
    "louvain_communities": 28,
    "louvain_modularity": 0.4387,
    "label_entropy": 1.4757,
    "computational_time": 0.24403379997238517
  },
  "retrieval_queries": []
}
2025-11-24 15:03:56,465 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:03:56,465 - src.pipeline.kg_builder - INFO - Batch 60 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 14.76s, Clean: 0.00s, Neo4j: 0.47s, ACS: 0.24s
2025-11-24 15:03:56,465 - src.pipeline.kg_builder - INFO - Batch 60 completed in 15.48s
Processing KG batches:  83%|████████▎ | 60/72 [35:54<05:16, 26.36s/it]2025-11-24 15:03:56,465 - src.pipeline.kg_builder - INFO - Processing batch 61/72 (3 items)
2025-11-24 15:03:56,465 - src.pipeline.kg_builder - DEBUG - Batch 61 current_video_time: 15:07-15:12
2025-11-24 15:03:56,472 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 744
- Total Relationships: 900
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:03:56,473 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 15:03:56,473 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0 ~232 words, content: Time: 14:57-15:02 Content: The video sequence captures a scientific procedure, likely a chemical experiment or a sample preparation process, taking place in a laboratory setting....
2025-11-24 15:03:56,473 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1 ~235 words, content: . - **Frame 4:** The person continues to handle the tube, ensuring it is properly aligned. The liquid is being transferred from the beaker into...
2025-11-24 15:03:56,473 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2 ~234 words, content: or transferring a solution. - **Frame 2:** The person adjusts the tube, which is now forming a large loop. The apparatus is positioned on a...
2025-11-24 15:03:56,473 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3 ~108 words, content: flexible, transparent tube, which appears to be a pipette or a transfer tube. The person is carefully manipulating the tube, ensuring it is properly positioned...
2025-11-24 15:03:56,473 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:03:56,473 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0) (~232 words) with timeout=5.0s retries=3
2025-11-24 15:03:57,706 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:03:57,706 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:03:57,707 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1) (~235 words) with timeout=5.0s retries=3
2025-11-24 15:03:58,718 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:03:58,718 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:03:58,719 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2) (~234 words) with timeout=5.0s retries=3
2025-11-24 15:03:59,818 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:03:59,818 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:03:59,818 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3) (~108 words) with timeout=5.0s retries=3
2025-11-24 15:04:00,723 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 15:04:00,724 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 15:04:00,724 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-24 15:04:00,724 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 4.25s
2025-11-24 15:04:00,724 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 744
- Total Relationships: 900
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0"]}, {"head": "Person", "relation": "Holds", "tail": "Transparent_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0"]}, {"head": "Transparent_Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0"]}, {"head": "Liquid", "relation": "Flows Into", "tail": "White_Plastic_Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0"]}, {"head": "Equipment", "relation": "Mounted On", "tail": "Metal_Stand", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0"]}, {"head": "Person", "relation": "Adjusts", "tail": "Transparent_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0"]}, {"head": "Person", "relation": "Wears", "tail": "Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1"]}, {"head": "Person", "relation": "Holds", "tail": "Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1"]}, {"head": "Tube", "relation": "Connects", "tail": "Apparatus", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1"]}, {"head": "Apparatus", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1"]}, {"head": "Liquid", "relation": "Flows From", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2"]}, {"head": "Person", "relation": "Holds", "tail": "Transparent Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2"]}, {"head": "Transparent Tube", "relation": "Connects", "tail": "Glass Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2"]}, {"head": "Transparent Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2"]}, {"head": "Glass Flask", "relation": "Receives", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2"]}, {"head": "Person", "relation": "Handles", "tail": "Laboratory Apparatus", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2"]}, {"head": "Person", "relation": "Manipulates", "tail": "Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3"]}, {"head": "Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3"]}, {"head": "Liquid", "relation": "Moves From", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3"]}, {"head": "Liquid", "relation": "Moves To", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3"]}, {"head": "Person", "relation": "Uses", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3"]}, {"head": "Equipment", "relation": "Includes", "tail": "Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:04:00,724 - src.components.global_refiner - DEBUG - Refining 24 triplets (prompt ~320 words, ~416 tokens)
2025-11-24 15:04:00,724 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:04:28,679 - src.components.global_refiner - DEBUG - LLM call completed in 27.95s
2025-11-24 15:04:28,679 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2']], ['Person', 'holds', 'Transparent_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3']], ['Transparent_Tube', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3']], ['Liquid', 'flows_into', 'White_Plastic_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0']], ['Equipment', 'mounted_on', 'Metal_Stand', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0']], ['Person', 'adjusts', 'Transparent_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0']], ['Person', 'wears', 'Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1']], ['Person', 'holds', 'Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3']], ['Tube', 'connects', 'Apparatus', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1']], ['Apparatus', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1']], ['Liquid', 'flows_from', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1']], ['Transparent_Tube', 'connects', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2']], ['Glass_Flask', 'receives', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2']], ['Person', 'handles', 'Laboratory_Apparatus', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2']], ['Person', 'manipulates', 'Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3']], ['Liquid', 'moves_from', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3']], ['Liquid', 'moves_to', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3']], ['Person', 'uses', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3']], ['Equipment', 'includes', 'Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3']]]
2025-11-24 15:04:28,679 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Transparent_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3"
    ]
  ],
  [
    "Transparent_Tube",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3"
    ]
  ],
  [
    "Liquid",
    "flows_into",
    "White_Plastic_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0"
    ]
  ],
  [
    "Equipment",
    "mounted_on",
    "Metal_Stand",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0"
    ]
  ],
  [
    "Person",
    "adjusts",
    "Transparent_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3"
    ]
  ],
  [
    "Tube",
    "connects",
    "Apparatus",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1"
    ]
  ],
  [
    "Apparatus",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1"
    ]
  ],
  [
    "Liquid",
    "flows_from",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_1"
    ]
  ],
  [
    "Transparent_Tube",
    "connects",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2"
    ]
  ],
  [
    "Glass_Flask",
    "receives",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2"
    ]
  ],
  [
    "Person",
    "handles",
    "Laboratory_Apparatus",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_2"
    ]
  ],
  [
    "Person",
    "manipulates",
    "Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3"
    ]
  ],
  [
    "Liquid",
    "moves_from",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3"
    ]
  ],
  [
    "Liquid",
    "moves_to",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3"
    ]
  ],
  [
    "Equipment",
    "includes",
    "Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_60_3"
    ]
  ]
]
2025-11-24 15:04:28,679 - src.components.global_refiner - INFO - Refinement complete: 24 → 20 triplets (total: 27.96s, LLM: 27.95s)
2025-11-24 15:04:28,679 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 27.96s
2025-11-24 15:04:28,679 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:04:28,679 - src.pipeline.kg_builder - INFO - Pushing batch 61/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:04:28,679 - src.components.neo4j_handler - INFO - Adding 20 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:04:28,936 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:04:28,936 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:04:28,936 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:04:28,936 - src.components.neo4j_handler - INFO - Batch injected in 0.26s (triplets: 0.25s, indexes: 0.00s)
2025-11-24 15:04:28,936 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:04:29,032 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:04:29,140 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 735
2025-11-24 15:04:29,192 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 750, 'relationship_count': 2610, 'density': 0.0046, 'avg_degree': 6.96, 'avg_unique_neighbors': 6.856, 'global_efficiency': 0.3756, 'avg_path_length': 2.8703, 'avg_degree_centrality': 0.0093, 'max_degree_centrality': 0.53, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0799, 'degree_assortativity': -0.1487, 'graph_robustness': 0.7023, 'diameter_estimate': 50, 'clustering_coefficient': 0.3152, 'weakly_connected_components': 16, 'largest_wcc_size': 735, 'pagerank_top10_percent': 4.5, 'louvain_communities': 28, 'louvain_modularity': 0.4263, 'label_entropy': 1.4766, 'computational_time': 0.25561143999220803}
2025-11-24 15:04:29,192 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 60, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967869.192523, 'total_time': 32.7266929539619, 'aggregation': 2.707995008677244e-06, 'network_info': 0.00681839999742806, 'llm_extraction': 32.20682098501129, 'data_cleaning': 1.5064026229083538e-05, 'neo4j_injection': 0.25694912497419864, 'embedding_time': 0, 'indexing_time': 0.003898839990142733, 'graph_injection_time': 0.2528782900189981, 'acs_metrics': {'node_count': 750, 'relationship_count': 2610, 'density': 0.0046, 'avg_degree': 6.96, 'avg_unique_neighbors': 6.856, 'global_efficiency': 0.3756, 'avg_path_length': 2.8703, 'avg_degree_centrality': 0.0093, 'max_degree_centrality': 0.53, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0799, 'degree_assortativity': -0.1487, 'graph_robustness': 0.7023, 'diameter_estimate': 50, 'clustering_coefficient': 0.3152, 'weakly_connected_components': 16, 'largest_wcc_size': 735, 'pagerank_top10_percent': 4.5, 'louvain_communities': 28, 'louvain_modularity': 0.4263, 'label_entropy': 1.4766, 'computational_time': 0.25561143999220803}, 'retrieval_queries': []}
2025-11-24 15:04:29,192 - src.pipeline.kg_builder - DEBUG - Batch 60 metrics: {
  "batch_idx": 60,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967869.192523,
  "total_time": 32.7266929539619,
  "aggregation": 2.707995008677244e-06,
  "network_info": 0.00681839999742806,
  "llm_extraction": 32.20682098501129,
  "data_cleaning": 1.5064026229083538e-05,
  "neo4j_injection": 0.25694912497419864,
  "embedding_time": 0,
  "indexing_time": 0.003898839990142733,
  "graph_injection_time": 0.2528782900189981,
  "acs_metrics": {
    "node_count": 750,
    "relationship_count": 2610,
    "density": 0.0046,
    "avg_degree": 6.96,
    "avg_unique_neighbors": 6.856,
    "global_efficiency": 0.3756,
    "avg_path_length": 2.8703,
    "avg_degree_centrality": 0.0093,
    "max_degree_centrality": 0.53,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0799,
    "degree_assortativity": -0.1487,
    "graph_robustness": 0.7023,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3152,
    "weakly_connected_components": 16,
    "largest_wcc_size": 735,
    "pagerank_top10_percent": 4.5,
    "louvain_communities": 28,
    "louvain_modularity": 0.4263,
    "label_entropy": 1.4766,
    "computational_time": 0.25561143999220803
  },
  "retrieval_queries": []
}
2025-11-24 15:04:29,193 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:04:29,193 - src.pipeline.kg_builder - INFO - Batch 61 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 32.21s, Clean: 0.00s, Neo4j: 0.26s, ACS: 0.26s
2025-11-24 15:04:29,193 - src.pipeline.kg_builder - INFO - Batch 61 completed in 32.73s
Processing KG batches:  85%|████████▍ | 61/72 [36:26<05:10, 28.27s/it]2025-11-24 15:04:29,193 - src.pipeline.kg_builder - INFO - Processing batch 62/72 (3 items)
2025-11-24 15:04:29,193 - src.pipeline.kg_builder - DEBUG - Batch 62 current_video_time: 15:22-15:27
2025-11-24 15:04:29,199 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 750
- Total Relationships: 915
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:04:29,199 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 15:04:29,199 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0 ~217 words, content: Time: 15:12-15:17 Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a procedure on a black lab bench. The...
2025-11-24 15:04:29,199 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1 ~232 words, content: . Time: 15:17-15:22 Content: The video sequence captures a scientific procedure, likely a chemical experiment, taking place on a laboratory bench. The frames show a...
2025-11-24 15:04:29,200 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2 ~239 words, content: pieces of equipment and glassware in the background. In summary, the video shows a chemical reaction that produces a gas. The gas is being collected...
2025-11-24 15:04:29,200 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3 ~33 words, content: different perspectives of the experiment. In the final frame, a person with dark, curly hair is seen sitting at the bench, observing the experiment. The...
2025-11-24 15:04:29,200 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:04:29,200 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0) (~217 words) with timeout=5.0s retries=3
2025-11-24 15:04:30,750 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:04:30,750 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:04:30,750 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1) (~232 words) with timeout=5.0s retries=3
2025-11-24 15:04:31,886 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:04:31,886 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:04:31,886 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2) (~239 words) with timeout=5.0s retries=3
2025-11-24 15:04:33,064 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:04:33,064 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:04:33,064 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3) (~33 words) with timeout=5.0s retries=3
2025-11-24 15:04:34,167 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 15:04:34,167 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 15:04:34,167 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-24 15:04:34,167 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 4.97s
2025-11-24 15:04:34,168 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 750
- Total Relationships: 915
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0"]}, {"head": "Translucent_Tube", "relation": "Is Inserted Into", "tail": "Measuring_Cup", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0"]}, {"head": "Measuring_Cup", "relation": "Contains", "tail": "Transparent_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0"]}, {"head": "Person", "relation": "Uses", "tail": "Blue_Device", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0"]}, {"head": "Blue_Device", "relation": "Is On", "tail": "Lab_Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0"]}, {"head": "Plastic Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1"]}, {"head": "Tube", "relation": "Delivers", "tail": "Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1"]}, {"head": "Inverted Beaker", "relation": "Collects", "tail": "Gas", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1"]}, {"head": "Plastic Container", "relation": "Produces", "tail": "Bubbles", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1"]}, {"head": "Tube", "relation": "Connects", "tail": "Electronic Device", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1"]}, {"head": "Laboratory Bench", "relation": "Holds", "tail": "Experiment Setup", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1"]}, {"head": "Flask", "relation": "Is Heated On", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2"]}, {"head": "Tube", "relation": "Connects", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2"]}, {"head": "Tube", "relation": "Delivers Gas To", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2"]}, {"head": "Beaker", "relation": "Is Inverted Above", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2"]}, {"head": "Gas", "relation": "Is Produced By", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2"]}, {"head": "Person", "relation": "Has", "tail": "Dark Curly Hair", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3"]}, {"head": "Person", "relation": "Sits At", "tail": "Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3"]}, {"head": "Person", "relation": "Observes", "tail": "Experiment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3"]}, {"head": "Experiment", "relation": "Is Observed By", "tail": "Person", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3"]}, {"head": "Bench", "relation": "Contains", "tail": "Person", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3"]}, {"head": "Atmosphere", "relation": "Is Characterized By", "tail": "Focused Scientific Inquiry", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:04:34,168 - src.components.global_refiner - DEBUG - Refining 24 triplets (prompt ~334 words, ~434 tokens)
2025-11-24 15:04:34,168 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:05:01,318 - src.components.global_refiner - DEBUG - LLM call completed in 27.15s
2025-11-24 15:05:01,318 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0']], ['Person', 'holds', 'Translucent_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0']], ['Translucent_Tube', 'is_inserted_into', 'Measuring_Cup', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0']], ['Measuring_Cup', 'contains', 'Transparent_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0']], ['Person', 'uses', 'Blue_Device', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0']], ['Blue_Device', 'is_on', 'Lab_Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0']], ['Plastic_Container', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1']], ['Tube', 'delivers', 'Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1']], ['Inverted_Beaker', 'collects', 'Gas', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1']], ['Plastic_Container', 'produces', 'Bubbles', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1']], ['Tube', 'connects', 'Electronic_Device', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1']], ['Laboratory_Bench', 'holds', 'Experiment_Setup', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1']], ['Flask', 'is_heated_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2']], ['Tube', 'connects', 'Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2']], ['Tube', 'delivers_gas_to', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2']], ['Beaker', 'is_inverted_above', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2']], ['Gas', 'is_produced_by', 'Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2']], ['Person', 'has', 'Dark_Curly_Hair', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3']], ['Person', 'sits_at', 'Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3']], ['Person', 'observes', 'Experiment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3']], ['Experiment', 'is_observed_by', 'Person', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3']], ['Bench', 'contains', 'Person', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3']], ['Atmosphere', 'is_characterized_by', 'Focused_Scientific_Inquiry', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3']]]
2025-11-24 15:05:01,318 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Translucent_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0"
    ]
  ],
  [
    "Translucent_Tube",
    "is_inserted_into",
    "Measuring_Cup",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0"
    ]
  ],
  [
    "Measuring_Cup",
    "contains",
    "Transparent_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Blue_Device",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0"
    ]
  ],
  [
    "Blue_Device",
    "is_on",
    "Lab_Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_0"
    ]
  ],
  [
    "Plastic_Container",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1"
    ]
  ],
  [
    "Tube",
    "delivers",
    "Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1"
    ]
  ],
  [
    "Inverted_Beaker",
    "collects",
    "Gas",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1"
    ]
  ],
  [
    "Plastic_Container",
    "produces",
    "Bubbles",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1"
    ]
  ],
  [
    "Tube",
    "connects",
    "Electronic_Device",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1"
    ]
  ],
  [
    "Laboratory_Bench",
    "holds",
    "Experiment_Setup",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_1"
    ]
  ],
  [
    "Flask",
    "is_heated_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2"
    ]
  ],
  [
    "Tube",
    "connects",
    "Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2"
    ]
  ],
  [
    "Tube",
    "delivers_gas_to",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2"
    ]
  ],
  [
    "Beaker",
    "is_inverted_above",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2"
    ]
  ],
  [
    "Gas",
    "is_produced_by",
    "Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_2"
    ]
  ],
  [
    "Person",
    "has",
    "Dark_Curly_Hair",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3"
    ]
  ],
  [
    "Person",
    "sits_at",
    "Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3"
    ]
  ],
  [
    "Person",
    "observes",
    "Experiment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3"
    ]
  ],
  [
    "Experiment",
    "is_observed_by",
    "Person",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3"
    ]
  ],
  [
    "Bench",
    "contains",
    "Person",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3"
    ]
  ],
  [
    "Atmosphere",
    "is_characterized_by",
    "Focused_Scientific_Inquiry",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_61_3"
    ]
  ]
]
2025-11-24 15:05:01,319 - src.components.global_refiner - INFO - Refinement complete: 24 → 24 triplets (total: 27.15s, LLM: 27.15s)
2025-11-24 15:05:01,319 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 27.15s
2025-11-24 15:05:01,319 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:05:01,319 - src.pipeline.kg_builder - INFO - Pushing batch 62/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:05:01,319 - src.components.neo4j_handler - INFO - Adding 24 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:05:01,619 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:05:01,620 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:05:01,620 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:05:01,620 - src.components.neo4j_handler - INFO - Batch injected in 0.30s (triplets: 0.30s, indexes: 0.00s)
2025-11-24 15:05:01,620 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:05:01,769 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:05:01,878 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 748
2025-11-24 15:05:01,930 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 763, 'relationship_count': 2656, 'density': 0.0046, 'avg_degree': 6.962, 'avg_unique_neighbors': 6.8545, 'global_efficiency': 0.3751, 'avg_path_length': 2.857, 'avg_degree_centrality': 0.0091, 'max_degree_centrality': 0.5302, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0767, 'degree_assortativity': -0.15, 'graph_robustness': 0.7041, 'diameter_estimate': 50, 'clustering_coefficient': 0.316, 'weakly_connected_components': 16, 'largest_wcc_size': 748, 'pagerank_top10_percent': 4.43, 'louvain_communities': 30, 'louvain_modularity': 0.4214, 'label_entropy': 1.4762, 'computational_time': 0.3100625440129079}
2025-11-24 15:05:01,930 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 61, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967901.9306414, 'total_time': 32.73673967900686, 'aggregation': 2.4450127966701984e-06, 'network_info': 0.005491834948770702, 'llm_extraction': 32.119753010047134, 'data_cleaning': 6.004102760925889e-05, 'neo4j_injection': 0.3008568219956942, 'embedding_time': 0, 'indexing_time': 0.004316149977967143, 'graph_injection_time': 0.2962096810224466, 'acs_metrics': {'node_count': 763, 'relationship_count': 2656, 'density': 0.0046, 'avg_degree': 6.962, 'avg_unique_neighbors': 6.8545, 'global_efficiency': 0.3751, 'avg_path_length': 2.857, 'avg_degree_centrality': 0.0091, 'max_degree_centrality': 0.5302, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0767, 'degree_assortativity': -0.15, 'graph_robustness': 0.7041, 'diameter_estimate': 50, 'clustering_coefficient': 0.316, 'weakly_connected_components': 16, 'largest_wcc_size': 748, 'pagerank_top10_percent': 4.43, 'louvain_communities': 30, 'louvain_modularity': 0.4214, 'label_entropy': 1.4762, 'computational_time': 0.3100625440129079}, 'retrieval_queries': []}
2025-11-24 15:05:01,930 - src.pipeline.kg_builder - DEBUG - Batch 61 metrics: {
  "batch_idx": 61,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967901.9306414,
  "total_time": 32.73673967900686,
  "aggregation": 2.4450127966701984e-06,
  "network_info": 0.005491834948770702,
  "llm_extraction": 32.119753010047134,
  "data_cleaning": 6.004102760925889e-05,
  "neo4j_injection": 0.3008568219956942,
  "embedding_time": 0,
  "indexing_time": 0.004316149977967143,
  "graph_injection_time": 0.2962096810224466,
  "acs_metrics": {
    "node_count": 763,
    "relationship_count": 2656,
    "density": 0.0046,
    "avg_degree": 6.962,
    "avg_unique_neighbors": 6.8545,
    "global_efficiency": 0.3751,
    "avg_path_length": 2.857,
    "avg_degree_centrality": 0.0091,
    "max_degree_centrality": 0.5302,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0767,
    "degree_assortativity": -0.15,
    "graph_robustness": 0.7041,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.316,
    "weakly_connected_components": 16,
    "largest_wcc_size": 748,
    "pagerank_top10_percent": 4.43,
    "louvain_communities": 30,
    "louvain_modularity": 0.4214,
    "label_entropy": 1.4762,
    "computational_time": 0.3100625440129079
  },
  "retrieval_queries": []
}
2025-11-24 15:05:01,931 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:05:01,931 - src.pipeline.kg_builder - INFO - Batch 62 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 32.12s, Clean: 0.00s, Neo4j: 0.30s, ACS: 0.31s
2025-11-24 15:05:01,932 - src.pipeline.kg_builder - INFO - Batch 62 completed in 32.74s
Processing KG batches:  86%|████████▌ | 62/72 [36:59<04:56, 29.61s/it]2025-11-24 15:05:01,932 - src.pipeline.kg_builder - INFO - Processing batch 63/72 (3 items)
2025-11-24 15:05:01,932 - src.pipeline.kg_builder - DEBUG - Batch 63 current_video_time: 15:37-15:42
2025-11-24 15:05:01,937 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 763
- Total Relationships: 934
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:05:01,938 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 15:05:01,938 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0 ~225 words, content: Time: 15:27-15:32 Content: The video sequence captures a scientific experiment being conducted in a laboratory setting. The scene is set in a well-equipped lab with...
2025-11-24 15:05:01,938 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1 ~231 words, content: , showing the entire experimental setup. The person is still present, observing the experiment. The lab environment remains consistent, with the focus on the ongoing...
2025-11-24 15:05:01,938 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2 ~220 words, content: Frame (4):** The camera then shifts to include a person in the frame. A man with long, dark, curly hair, wearing a light-colored sweater and...
2025-11-24 15:05:01,938 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3 ~144 words, content: smile directed at the camera, suggesting a moment of happiness or satisfaction. - **Fourth Frame:** The person turns their head to their right, away from...
2025-11-24 15:05:01,938 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:05:01,938 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0) (~225 words) with timeout=5.0s retries=3
2025-11-24 15:05:03,217 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:05:03,217 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:05:03,217 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1) (~231 words) with timeout=5.0s retries=3
2025-11-24 15:05:04,378 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:05:04,378 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:05:04,378 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2) (~220 words) with timeout=5.0s retries=3
2025-11-24 15:05:05,395 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:05:05,395 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:05:05,396 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3) (~144 words) with timeout=5.0s retries=3
2025-11-24 15:05:06,562 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 15:05:06,563 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 15:05:06,563 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-24 15:05:06,563 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 4.63s
2025-11-24 15:05:06,564 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 763
- Total Relationships: 934
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Sits At", "tail": "Lab Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0"]}, {"head": "Lab Bench", "relation": "Holds", "tail": "Glass Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0"]}, {"head": "Magnetic Stirrer", "relation": "Mixes", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0"]}, {"head": "Glass Flask", "relation": "Connected To", "tail": "Flexible Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0"]}, {"head": "Flexible Tube", "relation": "Part Of", "tail": "Vacuum Filtration Setup", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0"]}, {"head": "Scientist", "relation": "Conducts", "tail": "Experiment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1"]}, {"head": "Experiment", "relation": "Involves", "tail": "Vacuum Filtration Setup", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1"]}, {"head": "Vacuum Filtration Setup", "relation": "Includes", "tail": "Glass Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1"]}, {"head": "Glass Flask", "relation": "Is Connected To", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1"]}, {"head": "Scientist", "relation": "Observes", "tail": "Experiment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1"]}, {"head": "Person", "relation": "Wears", "tail": "Sweater", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2"]}, {"head": "Person", "relation": "Wears", "tail": "Jeans", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2"]}, {"head": "Person", "relation": "Sits On", "tail": "Floor", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2"]}, {"head": "Person", "relation": "Looks At", "tail": "Camera", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2"]}, {"head": "Person", "relation": "Smiles At", "tail": "Camera", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Scientific Apparatus", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2"]}, {"head": "Person", "relation": "Smiles At", "tail": "Camera", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3"]}, {"head": "Person", "relation": "Turns Head To", "tail": "Right", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3"]}, {"head": "Person", "relation": "Laughs At", "tail": "Off-Camera Entity", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3"]}, {"head": "Person", "relation": "Leans Back", "tail": "In Amusement", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3"]}, {"head": "Person", "relation": "Looks Toward", "tail": "Right Side Of Frame", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3"]}, {"head": "Person", "relation": "Engages With", "tail": "Off-Camera Entity", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:05:06,564 - src.components.global_refiner - DEBUG - Refining 24 triplets (prompt ~349 words, ~454 tokens)
2025-11-24 15:05:06,564 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:05:34,100 - src.components.global_refiner - DEBUG - LLM call completed in 27.54s
2025-11-24 15:05:34,100 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'sits_at', 'Lab_Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0']], ['Lab_Bench', 'holds', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0']], ['Glass_Flask', 'is_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0']], ['Magnetic_Stirrer', 'mixes', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0']], ['Glass_Flask', 'connected_to', 'Flexible_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0']], ['Flexible_Tube', 'part_of', 'Vacuum_Filtration_Setup', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0']], ['Scientist', 'conducts', 'Experiment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1']], ['Experiment', 'involves', 'Vacuum_Filtration_Setup', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1']], ['Vacuum_Filtration_Setup', 'includes', 'Glass_Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1']], ['Glass_Flask', 'is_connected_to', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1']], ['Beaker', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1']], ['Scientist', 'observes', 'Experiment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1']], ['Person', 'wears', 'Sweater', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2']], ['Person', 'wears', 'Jeans', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2']], ['Person', 'sits_on', 'Floor', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2']], ['Person', 'looks_at', 'Camera', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2']], ['Person', 'smiles_at', 'Camera', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2']], ['Person', 'smiles_at', 'Camera', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3']], ['Person', 'turns_head_to', 'Right', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3']], ['Person', 'laughs_at', 'Off_Camera_Entity', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3']], ['Person', 'leans_back', 'In_Amusement', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3']], ['Person', 'looks_toward', 'Right_Side_Of_Frame', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3']], ['Person', 'engages_with', 'Off_Camera_Entity', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3']], ['Lab_Bench', 'contains', 'Scientific_Apparatus', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2']]]
2025-11-24 15:05:34,100 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "sits_at",
    "Lab_Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0"
    ]
  ],
  [
    "Lab_Bench",
    "holds",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0"
    ]
  ],
  [
    "Glass_Flask",
    "is_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "mixes",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0"
    ]
  ],
  [
    "Glass_Flask",
    "connected_to",
    "Flexible_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0"
    ]
  ],
  [
    "Flexible_Tube",
    "part_of",
    "Vacuum_Filtration_Setup",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_0"
    ]
  ],
  [
    "Scientist",
    "conducts",
    "Experiment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1"
    ]
  ],
  [
    "Experiment",
    "involves",
    "Vacuum_Filtration_Setup",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1"
    ]
  ],
  [
    "Vacuum_Filtration_Setup",
    "includes",
    "Glass_Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1"
    ]
  ],
  [
    "Glass_Flask",
    "is_connected_to",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1"
    ]
  ],
  [
    "Scientist",
    "observes",
    "Experiment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Sweater",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Jeans",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2"
    ]
  ],
  [
    "Person",
    "sits_on",
    "Floor",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2"
    ]
  ],
  [
    "Person",
    "looks_at",
    "Camera",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2"
    ]
  ],
  [
    "Person",
    "smiles_at",
    "Camera",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2"
    ]
  ],
  [
    "Person",
    "smiles_at",
    "Camera",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3"
    ]
  ],
  [
    "Person",
    "turns_head_to",
    "Right",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3"
    ]
  ],
  [
    "Person",
    "laughs_at",
    "Off_Camera_Entity",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3"
    ]
  ],
  [
    "Person",
    "leans_back",
    "In_Amusement",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3"
    ]
  ],
  [
    "Person",
    "looks_toward",
    "Right_Side_Of_Frame",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3"
    ]
  ],
  [
    "Person",
    "engages_with",
    "Off_Camera_Entity",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_3"
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Scientific_Apparatus",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_62_2"
    ]
  ]
]
2025-11-24 15:05:34,100 - src.components.global_refiner - INFO - Refinement complete: 24 → 24 triplets (total: 27.54s, LLM: 27.54s)
2025-11-24 15:05:34,100 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 27.54s
2025-11-24 15:05:34,100 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:05:34,100 - src.pipeline.kg_builder - INFO - Pushing batch 63/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:05:34,100 - src.components.neo4j_handler - INFO - Adding 23 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:05:34,328 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:05:34,328 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:05:34,328 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:05:34,328 - src.components.neo4j_handler - INFO - Batch injected in 0.23s (triplets: 0.22s, indexes: 0.00s)
2025-11-24 15:05:34,328 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:05:34,396 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:05:34,509 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 760
2025-11-24 15:05:34,564 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 775, 'relationship_count': 2694, 'density': 0.0045, 'avg_degree': 6.9523, 'avg_unique_neighbors': 6.8439, 'global_efficiency': 0.3755, 'avg_path_length': 2.8449, 'avg_degree_centrality': 0.009, 'max_degree_centrality': 0.5336, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0761, 'degree_assortativity': -0.1522, 'graph_robustness': 0.706, 'diameter_estimate': 50, 'clustering_coefficient': 0.3173, 'weakly_connected_components': 16, 'largest_wcc_size': 760, 'pagerank_top10_percent': 4.37, 'louvain_communities': 28, 'louvain_modularity': 0.4404, 'label_entropy': 1.476, 'computational_time': 0.2356422109878622}
2025-11-24 15:05:34,564 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 62, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967934.56491, 'total_time': 32.63282182603143, 'aggregation': 3.1469971872866154e-06, 'network_info': 0.005745675996877253, 'llm_extraction': 32.16241257201182, 'data_cleaning': 1.9757950212806463e-05, 'neo4j_injection': 0.2285309240105562, 'embedding_time': 0, 'indexing_time': 0.003709674987476319, 'graph_injection_time': 0.22466523596085608, 'acs_metrics': {'node_count': 775, 'relationship_count': 2694, 'density': 0.0045, 'avg_degree': 6.9523, 'avg_unique_neighbors': 6.8439, 'global_efficiency': 0.3755, 'avg_path_length': 2.8449, 'avg_degree_centrality': 0.009, 'max_degree_centrality': 0.5336, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0761, 'degree_assortativity': -0.1522, 'graph_robustness': 0.706, 'diameter_estimate': 50, 'clustering_coefficient': 0.3173, 'weakly_connected_components': 16, 'largest_wcc_size': 760, 'pagerank_top10_percent': 4.37, 'louvain_communities': 28, 'louvain_modularity': 0.4404, 'label_entropy': 1.476, 'computational_time': 0.2356422109878622}, 'retrieval_queries': []}
2025-11-24 15:05:34,565 - src.pipeline.kg_builder - DEBUG - Batch 62 metrics: {
  "batch_idx": 62,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967934.56491,
  "total_time": 32.63282182603143,
  "aggregation": 3.1469971872866154e-06,
  "network_info": 0.005745675996877253,
  "llm_extraction": 32.16241257201182,
  "data_cleaning": 1.9757950212806463e-05,
  "neo4j_injection": 0.2285309240105562,
  "embedding_time": 0,
  "indexing_time": 0.003709674987476319,
  "graph_injection_time": 0.22466523596085608,
  "acs_metrics": {
    "node_count": 775,
    "relationship_count": 2694,
    "density": 0.0045,
    "avg_degree": 6.9523,
    "avg_unique_neighbors": 6.8439,
    "global_efficiency": 0.3755,
    "avg_path_length": 2.8449,
    "avg_degree_centrality": 0.009,
    "max_degree_centrality": 0.5336,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0761,
    "degree_assortativity": -0.1522,
    "graph_robustness": 0.706,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3173,
    "weakly_connected_components": 16,
    "largest_wcc_size": 760,
    "pagerank_top10_percent": 4.37,
    "louvain_communities": 28,
    "louvain_modularity": 0.4404,
    "label_entropy": 1.476,
    "computational_time": 0.2356422109878622
  },
  "retrieval_queries": []
}
2025-11-24 15:05:34,566 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:05:34,566 - src.pipeline.kg_builder - INFO - Batch 63 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 32.16s, Clean: 0.00s, Neo4j: 0.23s, ACS: 0.24s
2025-11-24 15:05:34,566 - src.pipeline.kg_builder - INFO - Batch 63 completed in 32.63s
Processing KG batches:  88%|████████▊ | 63/72 [37:32<04:34, 30.52s/it]2025-11-24 15:05:34,566 - src.pipeline.kg_builder - INFO - Processing batch 64/72 (3 items)
2025-11-24 15:05:34,566 - src.pipeline.kg_builder - DEBUG - Batch 64 current_video_time: 15:52-15:57
2025-11-24 15:05:34,576 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 775
- Total Relationships: 952
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:05:34,576 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 15:05:34,576 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0 ~216 words, content: Time: 15:42-15:47 Content: The video captures a scene in a well-equipped laboratory, focusing on a scientific experiment in progress. The sequence of frames provides a...
2025-11-24 15:05:34,576 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1 ~216 words, content: stand** holds a glass tube, which is connected by a long, flexible tube to a **beaker** filled with a clear liquid. This setup is typical...
2025-11-24 15:05:34,576 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2 ~230 words, content: showing a person interacting with the environment and equipment. - The first frame provides a wide view of a laboratory. A black countertop is set...
2025-11-24 15:05:34,576 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3 ~246 words, content: :52-15:57 Content: The video sequence captures a scientific experiment or procedure taking place in a laboratory setting. The frames show a person, likely a scientist...
2025-11-24 15:05:34,576 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:05:34,577 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0) (~216 words) with timeout=5.0s retries=3
2025-11-24 15:05:37,566 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:05:37,566 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:05:37,566 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1) (~216 words) with timeout=5.0s retries=3
2025-11-24 15:05:38,889 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:05:38,890 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:05:38,890 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2) (~230 words) with timeout=5.0s retries=3
2025-11-24 15:05:39,793 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:05:39,793 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:05:39,794 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3) (~246 words) with timeout=5.0s retries=3
2025-11-24 15:05:41,034 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 15:05:41,034 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 15:05:41,034 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-24 15:05:41,034 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 6.46s
2025-11-24 15:05:41,035 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 775
- Total Relationships: 952
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Stands In", "tail": "Laboratory", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0"]}, {"head": "Person", "relation": "Smiles At", "tail": "Camera", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Glass Cabinets", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0"]}, {"head": "Glass Cabinets", "relation": "Contain", "tail": "Bottles", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Laboratory Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0"]}, {"head": "Laboratory Bench", "relation": "Contains", "tail": "Balance Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1"]}, {"head": "Glass Tube", "relation": "Connected To", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1"]}, {"head": "Flask", "relation": "Is Part Of", "tail": "Apparatus", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1"]}, {"head": "Apparatus", "relation": "Is Used For", "tail": "Reflux", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1"]}, {"head": "Apparatus", "relation": "Is Used For", "tail": "Distillation", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1"]}, {"head": "Person", "relation": "Enters", "tail": "Laboratory", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2"]}, {"head": "Person", "relation": "Holds", "tail": "Smartphone", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2"]}, {"head": "Person", "relation": "Walks", "tail": "Laboratory", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2"]}, {"head": "Person", "relation": "Passes", "tail": "Cabinet", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2"]}, {"head": "Cabinet", "relation": "Contains", "tail": "Laboratory Supplies", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2"]}, {"head": "Camera", "relation": "Captures", "tail": "Person", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3"]}, {"head": "Person", "relation": "Handles", "tail": "Flexible_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3"]}, {"head": "Flexible_Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3"]}, {"head": "Liquid", "relation": "Flows Into", "tail": "Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3"]}, {"head": "Flask", "relation": "Is Part Of", "tail": "Apparatus", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3"]}, {"head": "Apparatus", "relation": "Includes", "tail": "Magnetic_Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:05:41,035 - src.components.global_refiner - DEBUG - Refining 24 triplets (prompt ~328 words, ~426 tokens)
2025-11-24 15:05:41,035 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:06:07,839 - src.components.global_refiner - DEBUG - LLM call completed in 26.80s
2025-11-24 15:06:07,839 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'stands_in', 'Laboratory', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0']], ['Person', 'smiles_at', 'Camera', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0']], ['Laboratory', 'contains', 'Glass_Cabinets', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0']], ['Glass_Cabinets', 'contains', 'Bottles', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0']], ['Laboratory', 'contains', 'Laboratory_Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0']], ['Laboratory_Bench', 'contains', 'Balance_Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0']], ['Person', 'holds', 'Glass_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1']], ['Glass_Tube', 'connected_to', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1']], ['Beaker', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1']], ['Flask', 'is_part_of', 'Apparatus', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1']], ['Apparatus', 'is_used_for', 'Reflux', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1']], ['Apparatus', 'is_used_for', 'Distillation', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1']], ['Person', 'enters', 'Laboratory', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2']], ['Person', 'holds', 'Smartphone', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2']], ['Person', 'walks', 'Laboratory', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2']], ['Person', 'passes', 'Cabinet', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2']], ['Cabinet', 'contains', 'Laboratory_Supplies', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2']], ['Camera', 'captures', 'Person', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2']], ['Person', 'wears', 'Blue_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3']], ['Person', 'handles', 'Flexible_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3']], ['Flexible_Tube', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3']], ['Liquid', 'flows_into', 'Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3']], ['Flask', 'is_part_of', 'Apparatus', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3']], ['Apparatus', 'includes', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3']]]
2025-11-24 15:06:07,839 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "stands_in",
    "Laboratory",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0"
    ]
  ],
  [
    "Person",
    "smiles_at",
    "Camera",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Glass_Cabinets",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0"
    ]
  ],
  [
    "Glass_Cabinets",
    "contains",
    "Bottles",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Laboratory_Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Balance_Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1"
    ]
  ],
  [
    "Glass_Tube",
    "connected_to",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1"
    ]
  ],
  [
    "Flask",
    "is_part_of",
    "Apparatus",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1"
    ]
  ],
  [
    "Apparatus",
    "is_used_for",
    "Reflux",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1"
    ]
  ],
  [
    "Apparatus",
    "is_used_for",
    "Distillation",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_1"
    ]
  ],
  [
    "Person",
    "enters",
    "Laboratory",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Smartphone",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2"
    ]
  ],
  [
    "Person",
    "walks",
    "Laboratory",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2"
    ]
  ],
  [
    "Person",
    "passes",
    "Cabinet",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2"
    ]
  ],
  [
    "Cabinet",
    "contains",
    "Laboratory_Supplies",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2"
    ]
  ],
  [
    "Camera",
    "captures",
    "Person",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3"
    ]
  ],
  [
    "Person",
    "handles",
    "Flexible_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3"
    ]
  ],
  [
    "Flexible_Tube",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3"
    ]
  ],
  [
    "Liquid",
    "flows_into",
    "Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3"
    ]
  ],
  [
    "Flask",
    "is_part_of",
    "Apparatus",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3"
    ]
  ],
  [
    "Apparatus",
    "includes",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_63_3"
    ]
  ]
]
2025-11-24 15:06:07,840 - src.components.global_refiner - INFO - Refinement complete: 24 → 24 triplets (total: 26.80s, LLM: 26.80s)
2025-11-24 15:06:07,840 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 26.80s
2025-11-24 15:06:07,840 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:06:07,840 - src.pipeline.kg_builder - INFO - Pushing batch 64/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:06:07,840 - src.components.neo4j_handler - INFO - Adding 23 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:06:08,099 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:06:08,099 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:06:08,099 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:06:08,099 - src.components.neo4j_handler - INFO - Batch injected in 0.26s (triplets: 0.26s, indexes: 0.00s)
2025-11-24 15:06:08,099 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:06:08,191 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:06:08,298 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 767
2025-11-24 15:06:08,410 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 782, 'relationship_count': 2735, 'density': 0.0045, 'avg_degree': 6.9949, 'avg_unique_neighbors': 6.8849, 'global_efficiency': 0.3771, 'avg_path_length': 2.8362, 'avg_degree_centrality': 0.009, 'max_degree_centrality': 0.5378, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.073, 'degree_assortativity': -0.1515, 'graph_robustness': 0.7046, 'diameter_estimate': 50, 'clustering_coefficient': 0.3174, 'weakly_connected_components': 16, 'largest_wcc_size': 767, 'pagerank_top10_percent': 4.29, 'louvain_communities': 30, 'louvain_modularity': 0.424, 'label_entropy': 1.4766, 'computational_time': 0.31032635999144986}
2025-11-24 15:06:08,410 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 63, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763967968.4106054, 'total_time': 33.844254726951476, 'aggregation': 2.562999725341797e-06, 'network_info': 0.00981192901963368, 'llm_extraction': 33.26375670399284, 'data_cleaning': 2.1933054085820913e-05, 'neo4j_injection': 0.25979482900584117, 'embedding_time': 0, 'indexing_time': 0.002842096029780805, 'graph_injection_time': 0.25675677496474236, 'acs_metrics': {'node_count': 782, 'relationship_count': 2735, 'density': 0.0045, 'avg_degree': 6.9949, 'avg_unique_neighbors': 6.8849, 'global_efficiency': 0.3771, 'avg_path_length': 2.8362, 'avg_degree_centrality': 0.009, 'max_degree_centrality': 0.5378, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.073, 'degree_assortativity': -0.1515, 'graph_robustness': 0.7046, 'diameter_estimate': 50, 'clustering_coefficient': 0.3174, 'weakly_connected_components': 16, 'largest_wcc_size': 767, 'pagerank_top10_percent': 4.29, 'louvain_communities': 30, 'louvain_modularity': 0.424, 'label_entropy': 1.4766, 'computational_time': 0.31032635999144986}, 'retrieval_queries': []}
2025-11-24 15:06:08,410 - src.pipeline.kg_builder - DEBUG - Batch 63 metrics: {
  "batch_idx": 63,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763967968.4106054,
  "total_time": 33.844254726951476,
  "aggregation": 2.562999725341797e-06,
  "network_info": 0.00981192901963368,
  "llm_extraction": 33.26375670399284,
  "data_cleaning": 2.1933054085820913e-05,
  "neo4j_injection": 0.25979482900584117,
  "embedding_time": 0,
  "indexing_time": 0.002842096029780805,
  "graph_injection_time": 0.25675677496474236,
  "acs_metrics": {
    "node_count": 782,
    "relationship_count": 2735,
    "density": 0.0045,
    "avg_degree": 6.9949,
    "avg_unique_neighbors": 6.8849,
    "global_efficiency": 0.3771,
    "avg_path_length": 2.8362,
    "avg_degree_centrality": 0.009,
    "max_degree_centrality": 0.5378,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.073,
    "degree_assortativity": -0.1515,
    "graph_robustness": 0.7046,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3174,
    "weakly_connected_components": 16,
    "largest_wcc_size": 767,
    "pagerank_top10_percent": 4.29,
    "louvain_communities": 30,
    "louvain_modularity": 0.424,
    "label_entropy": 1.4766,
    "computational_time": 0.31032635999144986
  },
  "retrieval_queries": []
}
2025-11-24 15:06:08,411 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:06:08,411 - src.pipeline.kg_builder - INFO - Batch 64 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 33.26s, Clean: 0.00s, Neo4j: 0.26s, ACS: 0.31s
2025-11-24 15:06:08,411 - src.pipeline.kg_builder - INFO - Batch 64 completed in 33.84s
Processing KG batches:  89%|████████▉ | 64/72 [38:06<04:12, 31.52s/it]2025-11-24 15:06:08,412 - src.pipeline.kg_builder - INFO - Processing batch 65/72 (3 items)
2025-11-24 15:06:08,412 - src.pipeline.kg_builder - DEBUG - Batch 65 current_video_time: 16:07-16:12
2025-11-24 15:06:08,423 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 782
- Total Relationships: 969
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:06:08,424 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 15:06:08,424 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0 ~240 words, content: Time: 15:57-16:02 Content: The video sequence captures a scientific procedure being performed in a laboratory setting. The scene is focused on a workbench where a...
2025-11-24 15:06:08,424 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1 ~240 words, content: with various pieces of equipment and materials. - **Initial Setup:** The video begins with a close-up view of a laboratory bench. A clear, flexible tube...
2025-11-24 15:06:08,424 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2 ~233 words, content: tube is seen extending from the stirrer into the beaker, suggesting that the liquid is being mixed or stirred as it is added. - **Final...
2025-11-24 15:06:08,424 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3 ~149 words, content: rod, likely a stir bar or a probe, is inserted into the liquid. The surrounding area is cluttered with various laboratory equipment, including a digital...
2025-11-24 15:06:08,424 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:06:08,424 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0) (~240 words) with timeout=5.0s retries=3
2025-11-24 15:06:09,803 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:06:09,803 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:06:09,803 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1) (~240 words) with timeout=5.0s retries=3
2025-11-24 15:06:10,925 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:06:10,926 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:06:10,926 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2) (~233 words) with timeout=5.0s retries=3
2025-11-24 15:06:11,947 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:06:11,947 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:06:11,948 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3) (~149 words) with timeout=5.0s retries=3
2025-11-24 15:06:16,954 - src.components.pre_llm_injector - WARNING - Chunk 3 timed out after 5.0s (attempt 1/4), retrying...
2025-11-24 15:06:22,460 - src.components.pre_llm_injector - WARNING - Chunk 3 timed out after 5.0s (attempt 2/4), retrying...
2025-11-24 15:06:28,467 - src.components.pre_llm_injector - WARNING - Chunk 3 timed out after 5.0s (attempt 3/4), retrying...
2025-11-24 15:06:31,111 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 4)
2025-11-24 15:06:31,111 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 15:06:31,111 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-24 15:06:31,111 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 22.69s
2025-11-24 15:06:31,112 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 782
- Total Relationships: 969
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0"]}, {"head": "Person", "relation": "Holds", "tail": "Flexible_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0"]}, {"head": "Flexible_Tube", "relation": "Is Inserted Into", "tail": "Clear_Plastic_Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0"]}, {"head": "Clear_Plastic_Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0"]}, {"head": "Laboratory_Bench", "relation": "Contains", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0"]}, {"head": "Person", "relation": "Performs", "tail": "Scientific_Procedure", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0"]}, {"head": "Tube", "relation": "Extends From", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1"]}, {"head": "Container", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1"]}, {"head": "Tube", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1"]}, {"head": "Lab_Bench", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1"]}, {"head": "Lab_Bench", "relation": "Holds", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1"]}, {"head": "Tube", "relation": "Extends Into", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2"]}, {"head": "Stirrer", "relation": "Stirs", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2"]}, {"head": "Tube", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2"]}, {"head": "Camera", "relation": "Captures", "tail": "Laboratory Setup", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2"]}, {"head": "Container", "relation": "Receives", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2"]}, {"head": "Rod", "relation": "Is Inserted Into", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Digital Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Glass Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Cables", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3"]}, {"head": "Man", "relation": "Wears", "tail": "Beige Sweater", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3"]}, {"head": "Man", "relation": "Wears", "tail": "Blue Jeans", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:06:31,112 - src.components.global_refiner - DEBUG - Refining 24 triplets (prompt ~318 words, ~413 tokens)
2025-11-24 15:06:31,112 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:06:57,806 - src.components.global_refiner - DEBUG - LLM call completed in 26.69s
2025-11-24 15:06:57,806 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0']], ['Person', 'holds', 'Flexible_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0']], ['Flexible_Tube', 'is_inserted_into', 'Clear_Plastic_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0']], ['Clear_Plastic_Container', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0']], ['Laboratory_Bench', 'contains', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0']], ['Person', 'performs', 'Scientific_Procedure', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0']], ['Tube', 'extends_from', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1']], ['Container', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1']], ['Tube', 'transfers', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1']], ['Beaker', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1']], ['Lab_Bench', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1']], ['Lab_Bench', 'holds', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1']], ['Tube', 'extends_into', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2']], ['Stirrer', 'stirs', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2']], ['Tube', 'dispenses', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2']], ['Camera', 'captures', 'Laboratory_Setup', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2']], ['Container', 'receives', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2']], ['Rod', 'is_inserted_into', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3']], ['Laboratory', 'contains', 'Digital_Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3']], ['Laboratory', 'contains', 'Glass_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3']], ['Laboratory', 'contains', 'Cables', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3']], ['Person', 'wears', 'Beige_Sweater', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3']], ['Person', 'wears', 'Blue_Jeans', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3']]]
2025-11-24 15:06:57,806 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0"
    ]
  ],
  [
    "Person",
    "holds",
    "Flexible_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0"
    ]
  ],
  [
    "Flexible_Tube",
    "is_inserted_into",
    "Clear_Plastic_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0"
    ]
  ],
  [
    "Clear_Plastic_Container",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0"
    ]
  ],
  [
    "Person",
    "performs",
    "Scientific_Procedure",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_0"
    ]
  ],
  [
    "Tube",
    "extends_from",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1"
    ]
  ],
  [
    "Container",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1"
    ]
  ],
  [
    "Tube",
    "transfers",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1"
    ]
  ],
  [
    "Lab_Bench",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1"
    ]
  ],
  [
    "Lab_Bench",
    "holds",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_1"
    ]
  ],
  [
    "Tube",
    "extends_into",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2"
    ]
  ],
  [
    "Stirrer",
    "stirs",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2"
    ]
  ],
  [
    "Tube",
    "dispenses",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2"
    ]
  ],
  [
    "Camera",
    "captures",
    "Laboratory_Setup",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2"
    ]
  ],
  [
    "Container",
    "receives",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_2"
    ]
  ],
  [
    "Rod",
    "is_inserted_into",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Digital_Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Glass_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Cables",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Beige_Sweater",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Jeans",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_64_3"
    ]
  ]
]
2025-11-24 15:06:57,806 - src.components.global_refiner - INFO - Refinement complete: 24 → 24 triplets (total: 26.69s, LLM: 26.69s)
2025-11-24 15:06:57,806 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 26.69s
2025-11-24 15:06:57,806 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:06:57,806 - src.pipeline.kg_builder - INFO - Pushing batch 65/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:06:57,807 - src.components.neo4j_handler - INFO - Adding 24 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:06:58,054 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:06:58,054 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:06:58,054 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:06:58,054 - src.components.neo4j_handler - INFO - Batch injected in 0.25s (triplets: 0.24s, indexes: 0.00s)
2025-11-24 15:06:58,054 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:06:58,147 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:06:58,254 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 776
2025-11-24 15:06:58,308 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 791, 'relationship_count': 2777, 'density': 0.0044, 'avg_degree': 7.0215, 'avg_unique_neighbors': 6.9128, 'global_efficiency': 0.3774, 'avg_path_length': 2.8348, 'avg_degree_centrality': 0.0089, 'max_degree_centrality': 0.5367, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0728, 'degree_assortativity': -0.1512, 'graph_robustness': 0.7033, 'diameter_estimate': 50, 'clustering_coefficient': 0.3179, 'weakly_connected_components': 16, 'largest_wcc_size': 776, 'pagerank_top10_percent': 4.31, 'louvain_communities': 30, 'louvain_modularity': 0.4156, 'label_entropy': 1.4769, 'computational_time': 0.25409581704298034}
2025-11-24 15:06:58,309 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 64, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763968018.3090212, 'total_time': 49.89694358903216, 'aggregation': 2.8240028768777847e-06, 'network_info': 0.01161064300686121, 'llm_extraction': 49.3829385790159, 'data_cleaning': 3.536103758960962e-05, 'neo4j_injection': 0.24774943199008703, 'embedding_time': 0, 'indexing_time': 0.0042583440081216395, 'graph_injection_time': 0.24326270900201052, 'acs_metrics': {'node_count': 791, 'relationship_count': 2777, 'density': 0.0044, 'avg_degree': 7.0215, 'avg_unique_neighbors': 6.9128, 'global_efficiency': 0.3774, 'avg_path_length': 2.8348, 'avg_degree_centrality': 0.0089, 'max_degree_centrality': 0.5367, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0728, 'degree_assortativity': -0.1512, 'graph_robustness': 0.7033, 'diameter_estimate': 50, 'clustering_coefficient': 0.3179, 'weakly_connected_components': 16, 'largest_wcc_size': 776, 'pagerank_top10_percent': 4.31, 'louvain_communities': 30, 'louvain_modularity': 0.4156, 'label_entropy': 1.4769, 'computational_time': 0.25409581704298034}, 'retrieval_queries': []}
2025-11-24 15:06:58,309 - src.pipeline.kg_builder - DEBUG - Batch 64 metrics: {
  "batch_idx": 64,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763968018.3090212,
  "total_time": 49.89694358903216,
  "aggregation": 2.8240028768777847e-06,
  "network_info": 0.01161064300686121,
  "llm_extraction": 49.3829385790159,
  "data_cleaning": 3.536103758960962e-05,
  "neo4j_injection": 0.24774943199008703,
  "embedding_time": 0,
  "indexing_time": 0.0042583440081216395,
  "graph_injection_time": 0.24326270900201052,
  "acs_metrics": {
    "node_count": 791,
    "relationship_count": 2777,
    "density": 0.0044,
    "avg_degree": 7.0215,
    "avg_unique_neighbors": 6.9128,
    "global_efficiency": 0.3774,
    "avg_path_length": 2.8348,
    "avg_degree_centrality": 0.0089,
    "max_degree_centrality": 0.5367,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0728,
    "degree_assortativity": -0.1512,
    "graph_robustness": 0.7033,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3179,
    "weakly_connected_components": 16,
    "largest_wcc_size": 776,
    "pagerank_top10_percent": 4.31,
    "louvain_communities": 30,
    "louvain_modularity": 0.4156,
    "label_entropy": 1.4769,
    "computational_time": 0.25409581704298034
  },
  "retrieval_queries": []
}
2025-11-24 15:06:58,310 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:06:58,310 - src.pipeline.kg_builder - INFO - Batch 65 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 49.38s, Clean: 0.00s, Neo4j: 0.25s, ACS: 0.25s
2025-11-24 15:06:58,310 - src.pipeline.kg_builder - INFO - Batch 65 completed in 49.90s
Processing KG batches:  90%|█████████ | 65/72 [38:55<04:19, 37.03s/it]2025-11-24 15:06:58,310 - src.pipeline.kg_builder - INFO - Processing batch 66/72 (3 items)
2025-11-24 15:06:58,310 - src.pipeline.kg_builder - DEBUG - Batch 66 current_video_time: 16:22-16:27
2025-11-24 15:06:58,315 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 791
- Total Relationships: 987
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:06:58,315 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-24 15:06:58,315 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0 ~238 words, content: Time: 16:12-16:17 Content: The video sequence captures a scientific experiment taking place in a laboratory setting. The scene begins with a person, who has curly...
2025-11-24 15:06:58,315 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1 ~239 words, content: of the equipment. The overall atmosphere of the video suggests a scientific experiment or a demonstration of a chemical process, with the person in the...
2025-11-24 15:06:58,315 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2 ~161 words, content: Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a procedure on a black countertop. The central action involves...
2025-11-24 15:06:58,315 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:06:58,316 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0) (~238 words) with timeout=5.0s retries=3
2025-11-24 15:06:59,602 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:06:59,602 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:06:59,602 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1) (~239 words) with timeout=5.0s retries=3
2025-11-24 15:07:00,799 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:07:00,799 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:07:00,799 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2) (~161 words) with timeout=5.0s retries=3
2025-11-24 15:07:02,155 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:07:02,155 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:07:02,155 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 3 chunks
2025-11-24 15:07:02,155 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 3.84s
2025-11-24 15:07:02,156 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 791
- Total Relationships: 987
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Beige Sweater", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0"]}, {"head": "Person", "relation": "Handles", "tail": "Glass Funnel", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0"]}, {"head": "Glass Funnel", "relation": "Is Submerged In", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0"]}, {"head": "Clear Liquid", "relation": "Is Contained In", "tail": "Transparent Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0"]}, {"head": "Transparent Container", "relation": "Is On", "tail": "Laboratory Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2"]}, {"head": "Person", "relation": "Wears", "tail": "Black_Watch", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1"]}, {"head": "Person", "relation": "Manipulates", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1"]}, {"head": "Equipment", "relation": "Is Placed On", "tail": "Laboratory_Table", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1"]}, {"head": "Container", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1"]}, {"head": "Container", "relation": "Contains", "tail": "White_Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1"]}, {"head": "Person", "relation": "Performs", "tail": "Procedure", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2"]}, {"head": "Person", "relation": "Holds", "tail": "Test_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2"]}, {"head": "Test_Tube", "relation": "Is Submerged In", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudy_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "White_Plastic_Bottle", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:07:02,156 - src.components.global_refiner - DEBUG - Refining 17 triplets (prompt ~270 words, ~351 tokens)
2025-11-24 15:07:02,156 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:07:22,607 - src.components.global_refiner - DEBUG - LLM call completed in 20.45s
2025-11-24 15:07:22,607 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Beige_Sweater', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0']], ['Person', 'wears', 'Blue_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0']], ['Person', 'handles', 'Glass_Funnel', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0']], ['Glass_Funnel', 'is_submerged_in', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0']], ['Clear_Liquid', 'is_contained_in', 'Transparent_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0']], ['Transparent_Container', 'is_on', 'Laboratory_Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0']], ['Person', 'wears', 'Blue_Nitrile_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2']], ['Person', 'wears', 'Black_Watch', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1']], ['Person', 'manipulates', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1']], ['Equipment', 'is_placed_on', 'Laboratory_Table', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1']], ['Container', 'contains', 'Clear_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1']], ['Container', 'contains', 'White_Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1']], ['Person', 'performs', 'Procedure', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2']], ['Person', 'holds', 'Test_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2']], ['Test_Tube', 'is_submerged_in', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2']], ['Beaker', 'contains', 'Cloudy_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2']], ['Beaker', 'contains', 'White_Plastic_Bottle', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2']]]
2025-11-24 15:07:22,607 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Beige_Sweater",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0"
    ]
  ],
  [
    "Person",
    "handles",
    "Glass_Funnel",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0"
    ]
  ],
  [
    "Glass_Funnel",
    "is_submerged_in",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0"
    ]
  ],
  [
    "Clear_Liquid",
    "is_contained_in",
    "Transparent_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0"
    ]
  ],
  [
    "Transparent_Container",
    "is_on",
    "Laboratory_Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Nitrile_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Black_Watch",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1"
    ]
  ],
  [
    "Person",
    "manipulates",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1"
    ]
  ],
  [
    "Equipment",
    "is_placed_on",
    "Laboratory_Table",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1"
    ]
  ],
  [
    "Container",
    "contains",
    "Clear_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1"
    ]
  ],
  [
    "Container",
    "contains",
    "White_Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_1"
    ]
  ],
  [
    "Person",
    "performs",
    "Procedure",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Test_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2"
    ]
  ],
  [
    "Test_Tube",
    "is_submerged_in",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Cloudy_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "White_Plastic_Bottle",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_65_2"
    ]
  ]
]
2025-11-24 15:07:22,607 - src.components.global_refiner - INFO - Refinement complete: 17 → 17 triplets (total: 20.45s, LLM: 20.45s)
2025-11-24 15:07:22,608 - src.pipeline.kg_builder - INFO - Global refinement: 17 triplets in 20.45s
2025-11-24 15:07:22,608 - src.pipeline.kg_builder - INFO - Using 17 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:07:22,608 - src.pipeline.kg_builder - INFO - Pushing batch 66/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:07:22,608 - src.components.neo4j_handler - INFO - Adding 17 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:07:22,804 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:07:22,804 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:07:22,804 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:07:22,804 - src.components.neo4j_handler - INFO - Batch injected in 0.20s (triplets: 0.19s, indexes: 0.00s)
2025-11-24 15:07:22,804 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:07:22,896 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:07:23,004 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 782
2025-11-24 15:07:23,060 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 797, 'relationship_count': 2807, 'density': 0.0044, 'avg_degree': 7.0439, 'avg_unique_neighbors': 6.9335, 'global_efficiency': 0.3782, 'avg_path_length': 2.8331, 'avg_degree_centrality': 0.0088, 'max_degree_centrality': 0.5377, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0765, 'degree_assortativity': -0.1508, 'graph_robustness': 0.7043, 'diameter_estimate': 50, 'clustering_coefficient': 0.3175, 'weakly_connected_components': 16, 'largest_wcc_size': 782, 'pagerank_top10_percent': 4.27, 'louvain_communities': 29, 'louvain_modularity': 0.4305, 'label_entropy': 1.4773, 'computational_time': 0.2559489660197869}
2025-11-24 15:07:23,060 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 65, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763968043.0608263, 'total_time': 24.750361241050996, 'aggregation': 2.470973413437605e-06, 'network_info': 0.0049047250067815185, 'llm_extraction': 24.29252425598679, 'data_cleaning': 1.276994589716196e-05, 'neo4j_injection': 0.1965138210216537, 'embedding_time': 0, 'indexing_time': 0.003081624978221953, 'graph_injection_time': 0.1932705279905349, 'acs_metrics': {'node_count': 797, 'relationship_count': 2807, 'density': 0.0044, 'avg_degree': 7.0439, 'avg_unique_neighbors': 6.9335, 'global_efficiency': 0.3782, 'avg_path_length': 2.8331, 'avg_degree_centrality': 0.0088, 'max_degree_centrality': 0.5377, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0765, 'degree_assortativity': -0.1508, 'graph_robustness': 0.7043, 'diameter_estimate': 50, 'clustering_coefficient': 0.3175, 'weakly_connected_components': 16, 'largest_wcc_size': 782, 'pagerank_top10_percent': 4.27, 'louvain_communities': 29, 'louvain_modularity': 0.4305, 'label_entropy': 1.4773, 'computational_time': 0.2559489660197869}, 'retrieval_queries': []}
2025-11-24 15:07:23,060 - src.pipeline.kg_builder - DEBUG - Batch 65 metrics: {
  "batch_idx": 65,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763968043.0608263,
  "total_time": 24.750361241050996,
  "aggregation": 2.470973413437605e-06,
  "network_info": 0.0049047250067815185,
  "llm_extraction": 24.29252425598679,
  "data_cleaning": 1.276994589716196e-05,
  "neo4j_injection": 0.1965138210216537,
  "embedding_time": 0,
  "indexing_time": 0.003081624978221953,
  "graph_injection_time": 0.1932705279905349,
  "acs_metrics": {
    "node_count": 797,
    "relationship_count": 2807,
    "density": 0.0044,
    "avg_degree": 7.0439,
    "avg_unique_neighbors": 6.9335,
    "global_efficiency": 0.3782,
    "avg_path_length": 2.8331,
    "avg_degree_centrality": 0.0088,
    "max_degree_centrality": 0.5377,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0765,
    "degree_assortativity": -0.1508,
    "graph_robustness": 0.7043,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3175,
    "weakly_connected_components": 16,
    "largest_wcc_size": 782,
    "pagerank_top10_percent": 4.27,
    "louvain_communities": 29,
    "louvain_modularity": 0.4305,
    "label_entropy": 1.4773,
    "computational_time": 0.2559489660197869
  },
  "retrieval_queries": []
}
2025-11-24 15:07:23,062 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:07:23,062 - src.pipeline.kg_builder - INFO - Batch 66 timings - Agg: 0.00s, NetInfo: 0.00s, LLM: 24.29s, Clean: 0.00s, Neo4j: 0.20s, ACS: 0.26s
2025-11-24 15:07:23,062 - src.pipeline.kg_builder - INFO - Batch 66 completed in 24.75s
Processing KG batches:  92%|█████████▏| 66/72 [39:20<03:20, 33.35s/it]2025-11-24 15:07:23,062 - src.pipeline.kg_builder - INFO - Processing batch 67/72 (3 items)
2025-11-24 15:07:23,062 - src.pipeline.kg_builder - DEBUG - Batch 67 current_video_time: 16:37-16:42
2025-11-24 15:07:23,069 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 797
- Total Relationships: 996
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:07:23,070 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 15:07:23,070 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0 ~229 words, content: Time: 16:27-16:32 Content: The video captures a sequence of actions in a laboratory setting, focusing on a person conducting a chemical experiment. The scene is...
2025-11-24 15:07:23,070 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1 ~232 words, content: The central activity involves a glass beaker, which contains a dark, cylindrical object, likely a sample or a filter. This beaker is placed on a...
2025-11-24 15:07:23,070 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2 ~229 words, content: with the camera panning to the right, revealing more of the laboratory environment, including a blue base with a metal rod, which could be part...
2025-11-24 15:07:23,070 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3 ~225 words, content: providing a wider view of the lab bench. The digital scale is now clearly identifiable as a "DUA" model. A person's hand, wearing a blue...
2025-11-24 15:07:23,070 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_4 ~81 words, content: a blue base, a roll of black tape, and other laboratory items. In summary, the video shows a laboratory experiment where a substance is being...
2025-11-24 15:07:23,070 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:07:23,070 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0) (~229 words) with timeout=5.0s retries=3
2025-11-24 15:07:24,175 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:07:24,175 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:07:24,175 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1) (~232 words) with timeout=5.0s retries=3
2025-11-24 15:07:25,927 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:07:25,927 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:07:25,927 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2) (~229 words) with timeout=5.0s retries=3
2025-11-24 15:07:27,233 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:07:27,233 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:07:27,233 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3) (~225 words) with timeout=5.0s retries=3
2025-11-24 15:07:28,540 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 15:07:28,540 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 15:07:28,540 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_4) (~81 words) with timeout=5.0s retries=3
2025-11-24 15:07:29,764 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 15:07:29,764 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 15:07:29,764 - src.components.pre_llm_injector - INFO - Extracted 27 local triplets from 5 chunks
2025-11-24 15:07:29,764 - src.pipeline.kg_builder - INFO - Pre-extraction: 27 triplets in 6.69s
2025-11-24 15:07:29,764 - src.components.global_refiner - INFO - Capping refinement input: 27 → 25 triplets
2025-11-24 15:07:29,765 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 797
- Total Relationships: 996
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0"]}, {"head": "Liquid", "relation": "Is In", "tail": "Transparent Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0"]}, {"head": "Transparent Container", "relation": "Is On", "tail": "Black Countertop", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Dark_Cylindrical_Object", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2"]}, {"head": "Beaker", "relation": "Placed On", "tail": "Magnetic_Stirrer_Or_Heating_Plate", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1"]}, {"head": "Magnetic_Stirrer_Or_Heating_Plate", "relation": "Placed On", "tail": "Digital_Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1"]}, {"head": "Digital_Scale", "relation": "Displays", "tail": "0970", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1"]}, {"head": "Beaker", "relation": "Has", "tail": "White_Tube_Or_Rod", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1"]}, {"head": "Camera", "relation": "Pans To", "tail": "Right", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_4"]}, {"head": "Digital_Scale", "relation": "Is On", "tail": "Stirrer_Or_Heating_Plate", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2"]}, {"head": "Experiment", "relation": "Involves", "tail": "Mass_Measurement", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2"]}, {"head": "Hand", "relation": "Wears", "tail": "Bluenitrileglove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3"]}, {"head": "Hand", "relation": "Holds", "tail": "Stirringrod", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3"]}, {"head": "Stirringrod", "relation": "Stirs", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudyliquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3"]}, {"head": "Digitalscale", "relation": "Displays", "tail": "Time", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3"]}, {"head": "Beaker", "relation": "Rests On", "tail": "Magneticstirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_4"]}, {"head": "Beaker", "relation": "Is On", "tail": "Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_4"]}, {"head": "Substance", "relation": "Is Stirred In", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:07:29,765 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~332 words, ~432 tokens)
2025-11-24 15:07:29,765 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:08:00,372 - src.components.global_refiner - DEBUG - LLM call completed in 30.61s
2025-11-24 15:08:00,372 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue_Nitrile_Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1']], ['Person', 'holds', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0']], ['Pipette', 'transfers', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0']], ['Liquid', 'is_in', 'Transparent_Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0']], ['Transparent_Container', 'is_on', 'Black_Countertop', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0']], ['Beaker', 'contains', 'Dark_Cylindrical_Object', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2']], ['Beaker', 'placed_on', 'Magnetic_Stirrer_Or_Heating_Plate', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1']], ['Magnetic_Stirrer_Or_Heating_Plate', 'placed_on', 'Digital_Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1']], ['Digital_Scale', 'displays', '0970', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2']], ['Beaker', 'has', 'White_Tube_Or_Rod', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1']], ['Camera', 'pans_to', 'Right', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2']], ['Laboratory', 'contains', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_4']], ['Digital_Scale', 'is_on', 'Magnetic_Stirrer_Or_Heating_Plate', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2']], ['Experiment', 'involves', 'Mass_Measurement', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2']], ['Hand', 'wears', 'Bluenitrileglove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3']], ['Hand', 'holds', 'Stirringrod', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3']], ['Stirringrod', 'stirs', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3']], ['Beaker', 'contains', 'Cloudyliquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3']], ['Digital_Scale', 'displays', 'Time', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3']], ['Beaker', 'rests_on', 'Magnetic_Stirrer_Or_Heating_Plate', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3']], ['Beaker', 'contains', 'Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_4']], ['Beaker', 'is_on', 'Digital_Scale', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_4']], ['Substance', 'is_stirred_in', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_4']]]
2025-11-24 15:08:00,373 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue_Nitrile_Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0"
    ]
  ],
  [
    "Pipette",
    "transfers",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0"
    ]
  ],
  [
    "Liquid",
    "is_in",
    "Transparent_Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0"
    ]
  ],
  [
    "Transparent_Container",
    "is_on",
    "Black_Countertop",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Dark_Cylindrical_Object",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2"
    ]
  ],
  [
    "Beaker",
    "placed_on",
    "Magnetic_Stirrer_Or_Heating_Plate",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1"
    ]
  ],
  [
    "Magnetic_Stirrer_Or_Heating_Plate",
    "placed_on",
    "Digital_Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1"
    ]
  ],
  [
    "Digital_Scale",
    "displays",
    "0970",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2"
    ]
  ],
  [
    "Beaker",
    "has",
    "White_Tube_Or_Rod",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_1"
    ]
  ],
  [
    "Camera",
    "pans_to",
    "Right",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_4"
    ]
  ],
  [
    "Digital_Scale",
    "is_on",
    "Magnetic_Stirrer_Or_Heating_Plate",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2"
    ]
  ],
  [
    "Experiment",
    "involves",
    "Mass_Measurement",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_2"
    ]
  ],
  [
    "Hand",
    "wears",
    "Bluenitrileglove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3"
    ]
  ],
  [
    "Hand",
    "holds",
    "Stirringrod",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3"
    ]
  ],
  [
    "Stirringrod",
    "stirs",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Cloudyliquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3"
    ]
  ],
  [
    "Digital_Scale",
    "displays",
    "Time",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3"
    ]
  ],
  [
    "Beaker",
    "rests_on",
    "Magnetic_Stirrer_Or_Heating_Plate",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_4"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Digital_Scale",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_4"
    ]
  ],
  [
    "Substance",
    "is_stirred_in",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_66_4"
    ]
  ]
]
2025-11-24 15:08:00,373 - src.components.global_refiner - INFO - Refinement complete: 25 → 24 triplets (total: 30.61s, LLM: 30.61s)
2025-11-24 15:08:00,373 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 30.61s
2025-11-24 15:08:00,373 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:08:00,373 - src.pipeline.kg_builder - INFO - Pushing batch 67/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:08:00,373 - src.components.neo4j_handler - INFO - Adding 24 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:08:00,581 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:08:00,581 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:08:00,581 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:08:00,581 - src.components.neo4j_handler - INFO - Batch injected in 0.21s (triplets: 0.21s, indexes: 0.00s)
2025-11-24 15:08:00,581 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:08:00,719 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:08:00,831 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 794
2025-11-24 15:08:00,887 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 809, 'relationship_count': 2862, 'density': 0.0044, 'avg_degree': 7.0754, 'avg_unique_neighbors': 6.9617, 'global_efficiency': 0.3785, 'avg_path_length': 2.824, 'avg_degree_centrality': 0.0088, 'max_degree_centrality': 0.5322, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0728, 'degree_assortativity': -0.1486, 'graph_robustness': 0.703, 'diameter_estimate': 50, 'clustering_coefficient': 0.3165, 'weakly_connected_components': 16, 'largest_wcc_size': 794, 'pagerank_top10_percent': 4.27, 'louvain_communities': 28, 'louvain_modularity': 0.4328, 'label_entropy': 1.4775, 'computational_time': 0.305210291990079}
2025-11-24 15:08:00,887 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 66, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763968080.887402, 'total_time': 37.82510145800188, 'aggregation': 2.4589826352894306e-06, 'network_info': 0.007521602034103125, 'llm_extraction': 37.30341602500994, 'data_cleaning': 6.213499000295997e-05, 'neo4j_injection': 0.20832386100664735, 'embedding_time': 0, 'indexing_time': 0.002880521002225578, 'graph_injection_time': 0.20509346103062853, 'acs_metrics': {'node_count': 809, 'relationship_count': 2862, 'density': 0.0044, 'avg_degree': 7.0754, 'avg_unique_neighbors': 6.9617, 'global_efficiency': 0.3785, 'avg_path_length': 2.824, 'avg_degree_centrality': 0.0088, 'max_degree_centrality': 0.5322, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0728, 'degree_assortativity': -0.1486, 'graph_robustness': 0.703, 'diameter_estimate': 50, 'clustering_coefficient': 0.3165, 'weakly_connected_components': 16, 'largest_wcc_size': 794, 'pagerank_top10_percent': 4.27, 'louvain_communities': 28, 'louvain_modularity': 0.4328, 'label_entropy': 1.4775, 'computational_time': 0.305210291990079}, 'retrieval_queries': []}
2025-11-24 15:08:00,887 - src.pipeline.kg_builder - DEBUG - Batch 66 metrics: {
  "batch_idx": 66,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763968080.887402,
  "total_time": 37.82510145800188,
  "aggregation": 2.4589826352894306e-06,
  "network_info": 0.007521602034103125,
  "llm_extraction": 37.30341602500994,
  "data_cleaning": 6.213499000295997e-05,
  "neo4j_injection": 0.20832386100664735,
  "embedding_time": 0,
  "indexing_time": 0.002880521002225578,
  "graph_injection_time": 0.20509346103062853,
  "acs_metrics": {
    "node_count": 809,
    "relationship_count": 2862,
    "density": 0.0044,
    "avg_degree": 7.0754,
    "avg_unique_neighbors": 6.9617,
    "global_efficiency": 0.3785,
    "avg_path_length": 2.824,
    "avg_degree_centrality": 0.0088,
    "max_degree_centrality": 0.5322,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0728,
    "degree_assortativity": -0.1486,
    "graph_robustness": 0.703,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3165,
    "weakly_connected_components": 16,
    "largest_wcc_size": 794,
    "pagerank_top10_percent": 4.27,
    "louvain_communities": 28,
    "louvain_modularity": 0.4328,
    "label_entropy": 1.4775,
    "computational_time": 0.305210291990079
  },
  "retrieval_queries": []
}
2025-11-24 15:08:00,888 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:08:00,888 - src.pipeline.kg_builder - INFO - Batch 67 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 37.30s, Clean: 0.00s, Neo4j: 0.21s, ACS: 0.31s
2025-11-24 15:08:00,888 - src.pipeline.kg_builder - INFO - Batch 67 completed in 37.83s
Processing KG batches:  93%|█████████▎| 67/72 [39:58<02:53, 34.69s/it]2025-11-24 15:08:00,888 - src.pipeline.kg_builder - INFO - Processing batch 68/72 (3 items)
2025-11-24 15:08:00,888 - src.pipeline.kg_builder - DEBUG - Batch 68 current_video_time: 16:52-16:57
2025-11-24 15:08:00,900 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 809
- Total Relationships: 1016
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:08:00,900 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-24 15:08:00,900 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0 ~234 words, content: Time: 16:42-16:47 Content: The video shows a scientific experiment taking place in a laboratory setting. A person wearing blue gloves is using a pipette to...
2025-11-24 15:08:00,900 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1 ~237 words, content: a solution. The laboratory environment is visible in the background, featuring a white wall, a door, and a shelf with various items, including cardboard boxes...
2025-11-24 15:08:00,900 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2 ~35 words, content: The final frame provides a wider view of the laboratory, highlighting the equipment and the organized workspace. The overall atmosphere is one of focused scientific...
2025-11-24 15:08:00,900 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:08:00,901 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0) (~234 words) with timeout=5.0s retries=3
2025-11-24 15:08:02,089 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:08:02,089 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:08:02,089 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1) (~237 words) with timeout=5.0s retries=3
2025-11-24 15:08:03,265 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:08:03,266 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:08:03,266 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2) (~35 words) with timeout=5.0s retries=3
2025-11-24 15:08:04,290 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:08:04,290 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:08:04,291 - src.components.pre_llm_injector - INFO - Extracted 18 local triplets from 3 chunks
2025-11-24 15:08:04,291 - src.pipeline.kg_builder - INFO - Pre-extraction: 18 triplets in 3.39s
2025-11-24 15:08:04,291 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 809
- Total Relationships: 1016
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0"]}, {"head": "Pipette", "relation": "Adds", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0"]}, {"head": "Clear Liquid", "relation": "Is Added To", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudy Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "White Precipitate", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudy White Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1"]}, {"head": "Person", "relation": "Handles", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1"]}, {"head": "Beaker", "relation": "Is Transferred To", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1"]}, {"head": "Woman", "relation": "Stands Near", "tail": "Glass Cabinet", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Workspace", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2"]}, {"head": "Workspace", "relation": "Is", "tail": "Organized", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2"]}, {"head": "Laboratory", "relation": "Has", "tail": "Atmosphere", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2"]}, {"head": "Atmosphere", "relation": "Is", "tail": "Focused", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2"]}, {"head": "Experiment", "relation": "Is", "tail": "Conducted", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:08:04,292 - src.components.global_refiner - DEBUG - Refining 18 triplets (prompt ~274 words, ~356 tokens)
2025-11-24 15:08:04,292 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:08:24,348 - src.components.global_refiner - DEBUG - LLM call completed in 20.06s
2025-11-24 15:08:24,349 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0']], ['Person', 'uses', 'Pipette', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0']], ['Pipette', 'adds', 'Clear Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0']], ['Clear Liquid', 'is_added_to', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0']], ['Beaker', 'contains', 'Cloudy Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0']], ['Beaker', 'contains', 'White Precipitate', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0']], ['Laboratory', 'contains', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1']], ['Beaker', 'contains', 'Cloudy White Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1']], ['Person', 'wears', 'Blue Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1']], ['Person', 'handles', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1']], ['Beaker', 'is_transferred_to', 'Magnetic Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1']], ['Woman', 'stands_near', 'Glass Cabinet', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1']], ['Laboratory', 'contains', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2']], ['Laboratory', 'contains', 'Workspace', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2']], ['Workspace', 'is', 'Organized', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2']], ['Laboratory', 'has', 'Atmosphere', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2']], ['Atmosphere', 'is', 'Focused', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2']], ['Experiment', 'is', 'Conducted', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2']]]
2025-11-24 15:08:24,349 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0"
    ]
  ],
  [
    "Person",
    "uses",
    "Pipette",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0"
    ]
  ],
  [
    "Pipette",
    "adds",
    "Clear Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0"
    ]
  ],
  [
    "Clear Liquid",
    "is_added_to",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Cloudy Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "White Precipitate",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_0"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Cloudy White Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1"
    ]
  ],
  [
    "Person",
    "handles",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1"
    ]
  ],
  [
    "Beaker",
    "is_transferred_to",
    "Magnetic Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1"
    ]
  ],
  [
    "Woman",
    "stands_near",
    "Glass Cabinet",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_1"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Workspace",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2"
    ]
  ],
  [
    "Workspace",
    "is",
    "Organized",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2"
    ]
  ],
  [
    "Laboratory",
    "has",
    "Atmosphere",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2"
    ]
  ],
  [
    "Atmosphere",
    "is",
    "Focused",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2"
    ]
  ],
  [
    "Experiment",
    "is",
    "Conducted",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_67_2"
    ]
  ]
]
2025-11-24 15:08:24,349 - src.components.global_refiner - INFO - Refinement complete: 18 → 18 triplets (total: 20.06s, LLM: 20.06s)
2025-11-24 15:08:24,349 - src.pipeline.kg_builder - INFO - Global refinement: 18 triplets in 20.06s
2025-11-24 15:08:24,349 - src.pipeline.kg_builder - INFO - Using 18 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:08:24,349 - src.pipeline.kg_builder - INFO - Pushing batch 68/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:08:24,350 - src.components.neo4j_handler - INFO - Adding 18 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:08:24,534 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:08:24,534 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:08:24,534 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:08:24,534 - src.components.neo4j_handler - INFO - Batch injected in 0.18s (triplets: 0.18s, indexes: 0.00s)
2025-11-24 15:08:24,534 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:08:24,636 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:08:24,749 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 805
2025-11-24 15:08:24,806 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 820, 'relationship_count': 2896, 'density': 0.0043, 'avg_degree': 7.0634, 'avg_unique_neighbors': 6.9512, 'global_efficiency': 0.3783, 'avg_path_length': 2.8273, 'avg_degree_centrality': 0.0086, 'max_degree_centrality': 0.5275, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0635, 'degree_assortativity': -0.1472, 'graph_robustness': 0.7006, 'diameter_estimate': 50, 'clustering_coefficient': 0.317, 'weakly_connected_components': 16, 'largest_wcc_size': 805, 'pagerank_top10_percent': 4.21, 'louvain_communities': 29, 'louvain_modularity': 0.4294, 'label_entropy': 1.477, 'computational_time': 0.27222184400307015}
2025-11-24 15:08:24,807 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 67, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763968104.8070927, 'total_time': 23.91813910001656, 'aggregation': 2.7740024961531162e-06, 'network_info': 0.01125168101862073, 'llm_extraction': 23.449355330958497, 'data_cleaning': 4.906702088192105e-05, 'neo4j_injection': 0.18467174895340577, 'embedding_time': 0, 'indexing_time': 0.003177097998559475, 'graph_injection_time': 0.18114932696335018, 'acs_metrics': {'node_count': 820, 'relationship_count': 2896, 'density': 0.0043, 'avg_degree': 7.0634, 'avg_unique_neighbors': 6.9512, 'global_efficiency': 0.3783, 'avg_path_length': 2.8273, 'avg_degree_centrality': 0.0086, 'max_degree_centrality': 0.5275, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0635, 'degree_assortativity': -0.1472, 'graph_robustness': 0.7006, 'diameter_estimate': 50, 'clustering_coefficient': 0.317, 'weakly_connected_components': 16, 'largest_wcc_size': 805, 'pagerank_top10_percent': 4.21, 'louvain_communities': 29, 'louvain_modularity': 0.4294, 'label_entropy': 1.477, 'computational_time': 0.27222184400307015}, 'retrieval_queries': []}
2025-11-24 15:08:24,807 - src.pipeline.kg_builder - DEBUG - Batch 67 metrics: {
  "batch_idx": 67,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763968104.8070927,
  "total_time": 23.91813910001656,
  "aggregation": 2.7740024961531162e-06,
  "network_info": 0.01125168101862073,
  "llm_extraction": 23.449355330958497,
  "data_cleaning": 4.906702088192105e-05,
  "neo4j_injection": 0.18467174895340577,
  "embedding_time": 0,
  "indexing_time": 0.003177097998559475,
  "graph_injection_time": 0.18114932696335018,
  "acs_metrics": {
    "node_count": 820,
    "relationship_count": 2896,
    "density": 0.0043,
    "avg_degree": 7.0634,
    "avg_unique_neighbors": 6.9512,
    "global_efficiency": 0.3783,
    "avg_path_length": 2.8273,
    "avg_degree_centrality": 0.0086,
    "max_degree_centrality": 0.5275,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0635,
    "degree_assortativity": -0.1472,
    "graph_robustness": 0.7006,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.317,
    "weakly_connected_components": 16,
    "largest_wcc_size": 805,
    "pagerank_top10_percent": 4.21,
    "louvain_communities": 29,
    "louvain_modularity": 0.4294,
    "label_entropy": 1.477,
    "computational_time": 0.27222184400307015
  },
  "retrieval_queries": []
}
2025-11-24 15:08:24,808 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:08:24,808 - src.pipeline.kg_builder - INFO - Batch 68 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 23.45s, Clean: 0.00s, Neo4j: 0.18s, ACS: 0.27s
2025-11-24 15:08:24,808 - src.pipeline.kg_builder - INFO - Batch 68 completed in 23.92s
Processing KG batches:  94%|█████████▍| 68/72 [40:22<02:05, 31.46s/it]2025-11-24 15:08:24,808 - src.pipeline.kg_builder - INFO - Processing batch 69/72 (3 items)
2025-11-24 15:08:24,808 - src.pipeline.kg_builder - DEBUG - Batch 69 current_video_time: 17:07-17:12
2025-11-24 15:08:24,814 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 820
- Total Relationships: 1028
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:08:24,814 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-24 15:08:24,814 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0 ~234 words, content: Time: 16:57-17:02 Content: The video sequence captures a series of events in a laboratory setting, focusing on a scientific experiment involving a magnetic stirrer and...
2025-11-24 15:08:24,814 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1 ~243 words, content: warning label. The person's hand is carefully manipulating the beaker, suggesting they are conducting a precise experiment. - **Frame 4:** The camera returns to a...
2025-11-24 15:08:24,814 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2 ~228 words, content: supplies, and the person appears to be focused on their task. Time: 17:02-17:07 Content: The video captures a sequence of events in a laboratory setting,...
2025-11-24 15:08:24,814 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3 ~232 words, content: . In summary, the video shows a person conducting a chemical experiment in a laboratory. The experiment involves mixing a substance in a beaker using...
2025-11-24 15:08:24,814 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4 ~125 words, content: in the laboratory. He appears to be observing the experiment. His presence suggests that he might be a researcher or a student conducting the experiment....
2025-11-24 15:08:24,814 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:08:24,814 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0) (~234 words) with timeout=5.0s retries=3
2025-11-24 15:08:25,933 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:08:25,934 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:08:25,934 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1) (~243 words) with timeout=5.0s retries=3
2025-11-24 15:08:27,065 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:08:27,065 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:08:27,065 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2) (~228 words) with timeout=5.0s retries=3
2025-11-24 15:08:28,011 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:08:28,012 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:08:28,012 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3) (~232 words) with timeout=5.0s retries=3
2025-11-24 15:08:29,088 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 15:08:29,089 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 15:08:29,089 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4) (~125 words) with timeout=5.0s retries=3
2025-11-24 15:08:30,064 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 15:08:30,064 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 15:08:30,064 - src.components.pre_llm_injector - INFO - Extracted 26 local triplets from 5 chunks
2025-11-24 15:08:30,064 - src.pipeline.kg_builder - INFO - Pre-extraction: 26 triplets in 5.25s
2025-11-24 15:08:30,065 - src.components.global_refiner - INFO - Capping refinement input: 26 → 25 triplets
2025-11-24 15:08:30,065 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 820
- Total Relationships: 1028
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Beige Sweater", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Jeans", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0"]}, {"head": "Person", "relation": "Holds", "tail": "White Object", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0"]}, {"head": "Person", "relation": "Interacts With", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0"]}, {"head": "Hand", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0"]}, {"head": "Hand", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0"]}, {"head": "Person", "relation": "Manipulates", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1"]}, {"head": "Magnetic Stirrer", "relation": "Stirs", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3"]}, {"head": "Person", "relation": "Interacts With", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1"]}, {"head": "Equipment", "relation": "Includes", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Equipment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4"]}, {"head": "Equipment", "relation": "Performs", "tail": "Mixing", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2"]}, {"head": "Person", "relation": "Conducts", "tail": "Experiment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4"]}, {"head": "Hand", "relation": "Holds", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2"]}, {"head": "Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2"]}, {"head": "Liquid", "relation": "Is Added To", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3"]}, {"head": "Person", "relation": "Holds", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3"]}, {"head": "Experiment", "relation": "Involves", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3"]}, {"head": "Liquid", "relation": "Is In", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3"]}, {"head": "Person", "relation": "Is In", "tail": "Laboratory", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4"]}, {"head": "Person", "relation": "Observes", "tail": "Experiment", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4"]}, {"head": "Laboratory", "relation": "Has", "tail": "Shelves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:08:30,065 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~334 words, ~434 tokens)
2025-11-24 15:08:30,065 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:09:00,815 - src.components.global_refiner - DEBUG - LLM call completed in 30.75s
2025-11-24 15:09:00,816 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Beige Sweater', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0']], ['Person', 'wears', 'Blue Jeans', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0']], ['Person', 'holds', 'White Object', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0']], ['Person', 'interacts_with', 'Magnetic Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0']], ['Hand', 'wears', 'Blue Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0']], ['Hand', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0']], ['Person', 'manipulates', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1']], ['Magnetic Stirrer', 'stirs', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3']], ['Person', 'interacts_with', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1']], ['Equipment', 'includes', 'Magnetic Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1']], ['Laboratory', 'contains', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1']], ['Laboratory', 'contains', 'Equipment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4']], ['Equipment', 'performs', 'Mixing', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2']], ['Person', 'conducts', 'Experiment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4']], ['Hand', 'holds', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2']], ['Container', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2']], ['Liquid', 'is_added_to', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2']], ['Person', 'wears', 'Blue Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3']], ['Person', 'holds', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3']], ['Experiment', 'involves', 'Magnetic Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3']], ['Liquid', 'is_in', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3']], ['Person', 'is_in', 'Laboratory', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4']], ['Person', 'observes', 'Experiment', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4']], ['Laboratory', 'has', 'Shelves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4']]]
2025-11-24 15:09:00,816 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Beige Sweater",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Jeans",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0"
    ]
  ],
  [
    "Person",
    "holds",
    "White Object",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0"
    ]
  ],
  [
    "Person",
    "interacts_with",
    "Magnetic Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0"
    ]
  ],
  [
    "Hand",
    "wears",
    "Blue Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0"
    ]
  ],
  [
    "Hand",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_0"
    ]
  ],
  [
    "Person",
    "manipulates",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1"
    ]
  ],
  [
    "Magnetic Stirrer",
    "stirs",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3"
    ]
  ],
  [
    "Person",
    "interacts_with",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1"
    ]
  ],
  [
    "Equipment",
    "includes",
    "Magnetic Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_1"
    ]
  ],
  [
    "Laboratory",
    "contains",
    "Equipment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4"
    ]
  ],
  [
    "Equipment",
    "performs",
    "Mixing",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2"
    ]
  ],
  [
    "Person",
    "conducts",
    "Experiment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4"
    ]
  ],
  [
    "Hand",
    "holds",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2"
    ]
  ],
  [
    "Container",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2"
    ]
  ],
  [
    "Liquid",
    "is_added_to",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3"
    ]
  ],
  [
    "Person",
    "holds",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3"
    ]
  ],
  [
    "Experiment",
    "involves",
    "Magnetic Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3"
    ]
  ],
  [
    "Liquid",
    "is_in",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_3"
    ]
  ],
  [
    "Person",
    "is_in",
    "Laboratory",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4"
    ]
  ],
  [
    "Person",
    "observes",
    "Experiment",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4"
    ]
  ],
  [
    "Laboratory",
    "has",
    "Shelves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_68_4"
    ]
  ]
]
2025-11-24 15:09:00,816 - src.components.global_refiner - INFO - Refinement complete: 25 → 25 triplets (total: 30.75s, LLM: 30.75s)
2025-11-24 15:09:00,816 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 30.75s
2025-11-24 15:09:00,816 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:09:00,817 - src.pipeline.kg_builder - INFO - Pushing batch 69/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:09:00,817 - src.components.neo4j_handler - INFO - Adding 25 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:09:01,000 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:09:01,000 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:09:01,000 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:09:01,000 - src.components.neo4j_handler - INFO - Batch injected in 0.18s (triplets: 0.18s, indexes: 0.00s)
2025-11-24 15:09:01,000 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:09:01,095 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:09:01,259 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 813
2025-11-24 15:09:01,315 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 828, 'relationship_count': 2941, 'density': 0.0043, 'avg_degree': 7.1039, 'avg_unique_neighbors': 6.9928, 'global_efficiency': 0.3791, 'avg_path_length': 2.8188, 'avg_degree_centrality': 0.0086, 'max_degree_centrality': 0.5333, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0638, 'degree_assortativity': -0.148, 'graph_robustness': 0.6998, 'diameter_estimate': 50, 'clustering_coefficient': 0.3169, 'weakly_connected_components': 16, 'largest_wcc_size': 813, 'pagerank_top10_percent': 4.16, 'louvain_communities': 26, 'louvain_modularity': 0.4271, 'label_entropy': 1.4779, 'computational_time': 0.31496581697138026}
2025-11-24 15:09:01,315 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 68, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763968141.3159254, 'total_time': 36.50738795299549, 'aggregation': 2.5440240278840065e-06, 'network_info': 0.005300097982399166, 'llm_extraction': 36.002761664043646, 'data_cleaning': 6.285804556682706e-05, 'neo4j_injection': 0.18370426399633288, 'embedding_time': 0, 'indexing_time': 0.002373224007897079, 'graph_injection_time': 0.18099297996377572, 'acs_metrics': {'node_count': 828, 'relationship_count': 2941, 'density': 0.0043, 'avg_degree': 7.1039, 'avg_unique_neighbors': 6.9928, 'global_efficiency': 0.3791, 'avg_path_length': 2.8188, 'avg_degree_centrality': 0.0086, 'max_degree_centrality': 0.5333, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0638, 'degree_assortativity': -0.148, 'graph_robustness': 0.6998, 'diameter_estimate': 50, 'clustering_coefficient': 0.3169, 'weakly_connected_components': 16, 'largest_wcc_size': 813, 'pagerank_top10_percent': 4.16, 'louvain_communities': 26, 'louvain_modularity': 0.4271, 'label_entropy': 1.4779, 'computational_time': 0.31496581697138026}, 'retrieval_queries': []}
2025-11-24 15:09:01,316 - src.pipeline.kg_builder - DEBUG - Batch 68 metrics: {
  "batch_idx": 68,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763968141.3159254,
  "total_time": 36.50738795299549,
  "aggregation": 2.5440240278840065e-06,
  "network_info": 0.005300097982399166,
  "llm_extraction": 36.002761664043646,
  "data_cleaning": 6.285804556682706e-05,
  "neo4j_injection": 0.18370426399633288,
  "embedding_time": 0,
  "indexing_time": 0.002373224007897079,
  "graph_injection_time": 0.18099297996377572,
  "acs_metrics": {
    "node_count": 828,
    "relationship_count": 2941,
    "density": 0.0043,
    "avg_degree": 7.1039,
    "avg_unique_neighbors": 6.9928,
    "global_efficiency": 0.3791,
    "avg_path_length": 2.8188,
    "avg_degree_centrality": 0.0086,
    "max_degree_centrality": 0.5333,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0638,
    "degree_assortativity": -0.148,
    "graph_robustness": 0.6998,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3169,
    "weakly_connected_components": 16,
    "largest_wcc_size": 813,
    "pagerank_top10_percent": 4.16,
    "louvain_communities": 26,
    "louvain_modularity": 0.4271,
    "label_entropy": 1.4779,
    "computational_time": 0.31496581697138026
  },
  "retrieval_queries": []
}
2025-11-24 15:09:01,317 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:09:01,317 - src.pipeline.kg_builder - INFO - Batch 69 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 36.00s, Clean: 0.00s, Neo4j: 0.18s, ACS: 0.32s
2025-11-24 15:09:01,317 - src.pipeline.kg_builder - INFO - Batch 69 completed in 36.51s
Processing KG batches:  96%|█████████▌| 69/72 [40:58<01:38, 32.97s/it]2025-11-24 15:09:01,317 - src.pipeline.kg_builder - INFO - Processing batch 70/72 (3 items)
2025-11-24 15:09:01,317 - src.pipeline.kg_builder - DEBUG - Batch 70 current_video_time: 17:22-17:27
2025-11-24 15:09:01,322 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 828
- Total Relationships: 1043
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:09:01,323 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 15:09:01,323 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0 ~226 words, content: Time: 17:12-17:17 Content: The video sequence captures a scene within a laboratory, focusing on a scientific experiment in progress. The setting is a well-equipped lab...
2025-11-24 15:09:01,323 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1 ~230 words, content: are methodical and suggest a controlled experiment. - **Initial Setup:** The scene is a laboratory with a black countertop. A person wearing a blue nitrile...
2025-11-24 15:09:01,323 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2 ~216 words, content: The camera angle changes slightly, providing a closer view of the person's hand as they adjust the flask in the beaker. The focus remains on...
2025-11-24 15:09:01,323 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3 ~97 words, content: fully immersed. - **Final State:** The vial is now completely submerged in the liquid. The hand remains in the beaker, holding the vial in place....
2025-11-24 15:09:01,323 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:09:01,323 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0) (~226 words) with timeout=5.0s retries=3
2025-11-24 15:09:02,423 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:09:02,423 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:09:02,423 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1) (~230 words) with timeout=5.0s retries=3
2025-11-24 15:09:03,830 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:09:03,830 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:09:03,831 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2) (~216 words) with timeout=5.0s retries=3
2025-11-24 15:09:04,958 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:09:04,958 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:09:04,959 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3) (~97 words) with timeout=5.0s retries=3
2025-11-24 15:09:06,019 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 15:09:06,019 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 15:09:06,019 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 4 chunks
2025-11-24 15:09:06,019 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 4.70s
2025-11-24 15:09:06,020 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 828
- Total Relationships: 1043
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Person", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0"]}, {"head": "Person", "relation": "Handles", "tail": "Container", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0"]}, {"head": "Container", "relation": "Contains", "tail": "Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0"]}, {"head": "Magnetic Stirrer", "relation": "Is Part Of", "tail": "Experiment Setup", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0"]}, {"head": "Experiment Setup", "relation": "Includes", "tail": "Heating Element", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1"]}, {"head": "Person", "relation": "Holds", "tail": "Round-Bottom Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1"]}, {"head": "Round-Bottom Flask", "relation": "Is Connected To", "tail": "Long Flexible Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1"]}, {"head": "Long Flexible Tube", "relation": "Leads To", "tail": "Clear Plastic Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1"]}, {"head": "Clear Plastic Beaker", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1"]}, {"head": "Person", "relation": "Submerges", "tail": "Round-Bottom Flask", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1"]}, {"head": "Person", "relation": "Wears", "tail": "Glove", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2"]}, {"head": "Person", "relation": "Holds", "tail": "Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2"]}, {"head": "Vial", "relation": "Is Submerged In", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3"]}, {"head": "Person", "relation": "Manipulates", "tail": "Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2"]}, {"head": "Vial", "relation": "Is Inside", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2"]}, {"head": "Vial", "relation": "Is Submerged In", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3"]}, {"head": "Hand", "relation": "Holds", "tail": "Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Vial", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3"]}, {"head": "Lab Table", "relation": "Supports", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Suspension", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:09:06,020 - src.components.global_refiner - DEBUG - Refining 23 triplets (prompt ~330 words, ~429 tokens)
2025-11-24 15:09:06,020 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:09:32,431 - src.components.global_refiner - DEBUG - LLM call completed in 26.41s
2025-11-24 15:09:32,432 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Person', 'wears', 'Blue Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0']], ['Person', 'handles', 'Container', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0']], ['Container', 'contains', 'Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0']], ['Beaker', 'contains', 'Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0']], ['Magnetic Stirrer', 'is_part_of', 'Experiment Setup', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0']], ['Experiment Setup', 'includes', 'Heating Element', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0']], ['Person', 'wears', 'Blue Nitrile Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1']], ['Person', 'holds', 'Round_Bottom Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1']], ['Round_Bottom Flask', 'is_connected_to', 'Long Flexible Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1']], ['Long Flexible Tube', 'leads_to', 'Clear Plastic Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1']], ['Clear Plastic Beaker', 'contains', 'Clear Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1']], ['Person', 'submerges', 'Round_Bottom Flask', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1']], ['Person', 'wears', 'Glove', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2']], ['Person', 'holds', 'Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2']], ['Vial', 'is_submerged_in', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3']], ['Person', 'manipulates', 'Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2']], ['Vial', 'is_inside', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2']], ['Vial', 'is_submerged_in', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3']], ['Hand', 'holds', 'Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3']], ['Beaker', 'contains', 'Vial', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3']], ['Lab Table', 'supports', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3']], ['Beaker', 'contains', 'Suspension', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3']]]
2025-11-24 15:09:32,432 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Person",
    "wears",
    "Blue Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0"
    ]
  ],
  [
    "Person",
    "handles",
    "Container",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0"
    ]
  ],
  [
    "Container",
    "contains",
    "Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0"
    ]
  ],
  [
    "Magnetic Stirrer",
    "is_part_of",
    "Experiment Setup",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0"
    ]
  ],
  [
    "Experiment Setup",
    "includes",
    "Heating Element",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_0"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue Nitrile Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Round_Bottom Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1"
    ]
  ],
  [
    "Round_Bottom Flask",
    "is_connected_to",
    "Long Flexible Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1"
    ]
  ],
  [
    "Long Flexible Tube",
    "leads_to",
    "Clear Plastic Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1"
    ]
  ],
  [
    "Clear Plastic Beaker",
    "contains",
    "Clear Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1"
    ]
  ],
  [
    "Person",
    "submerges",
    "Round_Bottom Flask",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_1"
    ]
  ],
  [
    "Person",
    "wears",
    "Glove",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2"
    ]
  ],
  [
    "Person",
    "holds",
    "Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2"
    ]
  ],
  [
    "Vial",
    "is_submerged_in",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3"
    ]
  ],
  [
    "Person",
    "manipulates",
    "Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2"
    ]
  ],
  [
    "Vial",
    "is_inside",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_2"
    ]
  ],
  [
    "Vial",
    "is_submerged_in",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3"
    ]
  ],
  [
    "Hand",
    "holds",
    "Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Vial",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3"
    ]
  ],
  [
    "Lab Table",
    "supports",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Suspension",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_69_3"
    ]
  ]
]
2025-11-24 15:09:32,432 - src.components.global_refiner - INFO - Refinement complete: 23 → 23 triplets (total: 26.41s, LLM: 26.41s)
2025-11-24 15:09:32,432 - src.pipeline.kg_builder - INFO - Global refinement: 23 triplets in 26.41s
2025-11-24 15:09:32,432 - src.pipeline.kg_builder - INFO - Using 23 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:09:32,432 - src.pipeline.kg_builder - INFO - Pushing batch 70/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:09:32,432 - src.components.neo4j_handler - INFO - Adding 23 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:09:32,680 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:09:32,681 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:09:32,681 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:09:32,681 - src.components.neo4j_handler - INFO - Batch injected in 0.25s (triplets: 0.24s, indexes: 0.00s)
2025-11-24 15:09:32,681 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:09:32,780 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:09:32,895 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 824
2025-11-24 15:09:32,955 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 839, 'relationship_count': 2978, 'density': 0.0042, 'avg_degree': 7.0989, 'avg_unique_neighbors': 6.9869, 'global_efficiency': 0.3778, 'avg_path_length': 2.8196, 'avg_degree_centrality': 0.0085, 'max_degree_centrality': 0.5322, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.07, 'degree_assortativity': -0.1466, 'graph_robustness': 0.6998, 'diameter_estimate': 50, 'clustering_coefficient': 0.3166, 'weakly_connected_components': 16, 'largest_wcc_size': 824, 'pagerank_top10_percent': 4.1, 'louvain_communities': 28, 'louvain_modularity': 0.4236, 'label_entropy': 1.4778, 'computational_time': 0.2740707329940051}
2025-11-24 15:09:32,955 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 69, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763968172.955739, 'total_time': 31.638042000995483, 'aggregation': 2.701999619603157e-06, 'network_info': 0.005088219011668116, 'llm_extraction': 31.10952490597265, 'data_cleaning': 3.260804805904627e-05, 'neo4j_injection': 0.24878604500554502, 'embedding_time': 0, 'indexing_time': 0.003962408984079957, 'graph_injection_time': 0.24458401004085317, 'acs_metrics': {'node_count': 839, 'relationship_count': 2978, 'density': 0.0042, 'avg_degree': 7.0989, 'avg_unique_neighbors': 6.9869, 'global_efficiency': 0.3778, 'avg_path_length': 2.8196, 'avg_degree_centrality': 0.0085, 'max_degree_centrality': 0.5322, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.07, 'degree_assortativity': -0.1466, 'graph_robustness': 0.6998, 'diameter_estimate': 50, 'clustering_coefficient': 0.3166, 'weakly_connected_components': 16, 'largest_wcc_size': 824, 'pagerank_top10_percent': 4.1, 'louvain_communities': 28, 'louvain_modularity': 0.4236, 'label_entropy': 1.4778, 'computational_time': 0.2740707329940051}, 'retrieval_queries': []}
2025-11-24 15:09:32,955 - src.pipeline.kg_builder - DEBUG - Batch 69 metrics: {
  "batch_idx": 69,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763968172.955739,
  "total_time": 31.638042000995483,
  "aggregation": 2.701999619603157e-06,
  "network_info": 0.005088219011668116,
  "llm_extraction": 31.10952490597265,
  "data_cleaning": 3.260804805904627e-05,
  "neo4j_injection": 0.24878604500554502,
  "embedding_time": 0,
  "indexing_time": 0.003962408984079957,
  "graph_injection_time": 0.24458401004085317,
  "acs_metrics": {
    "node_count": 839,
    "relationship_count": 2978,
    "density": 0.0042,
    "avg_degree": 7.0989,
    "avg_unique_neighbors": 6.9869,
    "global_efficiency": 0.3778,
    "avg_path_length": 2.8196,
    "avg_degree_centrality": 0.0085,
    "max_degree_centrality": 0.5322,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.07,
    "degree_assortativity": -0.1466,
    "graph_robustness": 0.6998,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3166,
    "weakly_connected_components": 16,
    "largest_wcc_size": 824,
    "pagerank_top10_percent": 4.1,
    "louvain_communities": 28,
    "louvain_modularity": 0.4236,
    "label_entropy": 1.4778,
    "computational_time": 0.2740707329940051
  },
  "retrieval_queries": []
}
2025-11-24 15:09:32,957 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:09:32,957 - src.pipeline.kg_builder - INFO - Batch 70 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 31.11s, Clean: 0.00s, Neo4j: 0.25s, ACS: 0.27s
2025-11-24 15:09:32,957 - src.pipeline.kg_builder - INFO - Batch 70 completed in 31.64s
Processing KG batches:  97%|█████████▋| 70/72 [41:30<01:05, 32.57s/it]2025-11-24 15:09:32,957 - src.pipeline.kg_builder - INFO - Processing batch 71/72 (3 items)
2025-11-24 15:09:32,957 - src.pipeline.kg_builder - DEBUG - Batch 71 current_video_time: 17:37-17:42
2025-11-24 15:09:32,963 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 839
- Total Relationships: 1061
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:09:32,964 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-24 15:09:32,964 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0 ~224 words, content: Time: 17:27-17:32 Content: The sequence of frames captures a scientific experiment being conducted in a laboratory setting. The overall process involves preparing a solution and...
2025-11-24 15:09:32,964 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1 ~237 words, content: is visible inside it. The white tube is now positioned to deliver a substance into this beaker. To the left, a Mettler Toledo analytical balance...
2025-11-24 15:09:32,964 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2 ~216 words, content: shown is a step in a larger chemical synthesis or analysis. Time: 17:32-17:37 Content: The video captures a sequence of laboratory activities, likely a chemical...
2025-11-24 15:09:32,964 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3 ~232 words, content: the camera as it moves from the close-up of the experiment to a broader view of the lab. - **Final Scene (Frame 4):** The camera...
2025-11-24 15:09:32,964 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4 ~234 words, content: a chemical reaction is occurring, possibly the formation of a precipitate or a phase change. - **Continuation of the Process:** In the fourth frame, the...
2025-11-24 15:09:32,964 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_5 ~22 words, content:  from clear to cloudy white. The final frame shows this experiment in the context of a larger laboratory setup with other equipment.
2025-11-24 15:09:32,964 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:09:32,964 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0) (~224 words) with timeout=5.0s retries=3
2025-11-24 15:09:34,225 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:09:34,225 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:09:34,225 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1) (~237 words) with timeout=5.0s retries=3
2025-11-24 15:09:35,512 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:09:35,513 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:09:35,513 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2) (~216 words) with timeout=5.0s retries=3
2025-11-24 15:09:36,830 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:09:36,830 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:09:36,831 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3) (~232 words) with timeout=5.0s retries=3
2025-11-24 15:09:38,061 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 15:09:38,061 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 15:09:38,062 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4) (~234 words) with timeout=5.0s retries=3
2025-11-24 15:09:39,343 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-24 15:09:39,343 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-24 15:09:39,343 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_5) (~22 words) with timeout=5.0s retries=3
2025-11-24 15:09:40,125 - src.components.pre_llm_injector - DEBUG - Extracted 4 triplets from chunk 5 (attempt 1)
2025-11-24 15:09:40,125 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 4 triplets
2025-11-24 15:09:40,125 - src.components.pre_llm_injector - INFO - Extracted 31 local triplets from 6 chunks
2025-11-24 15:09:40,126 - src.pipeline.kg_builder - INFO - Pre-extraction: 31 triplets in 7.16s
2025-11-24 15:09:40,126 - src.components.global_refiner - INFO - Capping refinement input: 31 → 25 triplets
2025-11-24 15:09:40,127 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 839
- Total Relationships: 1061
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Hand", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudy_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3"]}, {"head": "Beaker", "relation": "Placed On", "tail": "Magnetic_Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0"]}, {"head": "Magnetic_Stirrer", "relation": "Contains", "tail": "Stir_Bar", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0"]}, {"head": "Hand", "relation": "Uses", "tail": "White_Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0"]}, {"head": "White_Tube", "relation": "Delivers", "tail": "Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Solution", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1"]}, {"head": "Magnetic Stirrer", "relation": "Operates On", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1"]}, {"head": "White Tube", "relation": "Delivers", "tail": "Substance", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1"]}, {"head": "Analytical Balance", "relation": "Measures", "tail": "Chemicals", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1"]}, {"head": "Pipette", "relation": "Lies On", "tail": "Lab Table", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1"]}, {"head": "Solution", "relation": "Is Stirred By", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4"]}, {"head": "Beaker", "relation": "Contains", "tail": "Magnetic_Stir_Bar", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Rod", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "0.970", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2"]}, {"head": "Digital_Balance", "relation": "Is On", "tail": "Laboratory_Bench", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2"]}, {"head": "Laboratory_Bench", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Gloves", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3"]}, {"head": "Beaker", "relation": "Is On", "tail": "Black_Countertop", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3"]}, {"head": "Person", "relation": "Uses", "tail": "Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3"]}, {"head": "Tube", "relation": "Is Used To", "tail": "Stir_Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3"]}, {"head": "Liquid", "relation": "Undergoes", "tail": "Chemical_Reaction", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4"]}, {"head": "Beaker", "relation": "Is On", "tail": "Lab_Table", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:09:40,127 - src.components.global_refiner - DEBUG - Refining 25 triplets (prompt ~333 words, ~433 tokens)
2025-11-24 15:09:40,127 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:10:19,442 - src.components.global_refiner - DEBUG - LLM call completed in 39.32s
2025-11-24 15:10:19,442 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Hand', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0']], ['Beaker', 'contains', 'Cloudy_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3']], ['Beaker', 'contains', 'Solution', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1']], ['Beaker', 'contains', 'Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4']], ['Beaker', 'contains', 'Magnetic_Stir_Bar', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2']], ['Beaker', 'is_on', 'Black_Countertop', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3']], ['Beaker', 'is_on', 'Lab_Table', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4']], ['Magnetic_Stirrer', 'contains', 'Stir_Bar', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0']], ['Magnetic_Stirrer', 'operates_on', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1']], ['Solution', 'is_stirred_by', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1']], ['Person', 'holds', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4']], ['Person', 'holds', 'Glass_Rod', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2']], ['Person', 'wears', 'Blue_Gloves', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3']], ['Person', 'uses', 'Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3']], ['Tube', 'is_used_to', 'Stir_Liquid', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3']], ['Hand', 'uses', 'White_Tube', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0']], ['White_Tube', 'delivers', 'Substance', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1']], ['Analytical_Balance', 'measures', 'Chemicals', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1']], ['Pipette', 'lies_on', 'Lab_Table', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1']], ['Digital_Balance', 'displays', '0.970', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2']], ['Digital_Balance', 'is_on', 'Laboratory_Bench', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2']], ['Laboratory_Bench', 'contains', 'Beaker', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2']], ['Liquid', 'undergoes', 'Chemical_Reaction', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4']], ['Beaker', 'placed_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0']], ['Beaker', 'placed_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1']], ['Beaker', 'placed_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2']], ['Beaker', 'placed_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3']], ['Beaker', 'placed_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4']], ['Beaker', 'placed_on', 'Magnetic_Stirrer', ['c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3', 'c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4']]]
2025-11-24 15:10:19,443 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Hand",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Cloudy_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Solution",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4"
    ]
  ],
  [
    "Beaker",
    "contains",
    "Magnetic_Stir_Bar",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Black_Countertop",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3"
    ]
  ],
  [
    "Beaker",
    "is_on",
    "Lab_Table",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "contains",
    "Stir_Bar",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0"
    ]
  ],
  [
    "Magnetic_Stirrer",
    "operates_on",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1"
    ]
  ],
  [
    "Solution",
    "is_stirred_by",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1"
    ]
  ],
  [
    "Person",
    "holds",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4"
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Rod",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2"
    ]
  ],
  [
    "Person",
    "wears",
    "Blue_Gloves",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3"
    ]
  ],
  [
    "Person",
    "uses",
    "Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3"
    ]
  ],
  [
    "Tube",
    "is_used_to",
    "Stir_Liquid",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3"
    ]
  ],
  [
    "Hand",
    "uses",
    "White_Tube",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0"
    ]
  ],
  [
    "White_Tube",
    "delivers",
    "Substance",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1"
    ]
  ],
  [
    "Analytical_Balance",
    "measures",
    "Chemicals",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1"
    ]
  ],
  [
    "Pipette",
    "lies_on",
    "Lab_Table",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1"
    ]
  ],
  [
    "Digital_Balance",
    "displays",
    "0.970",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2"
    ]
  ],
  [
    "Digital_Balance",
    "is_on",
    "Laboratory_Bench",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2"
    ]
  ],
  [
    "Laboratory_Bench",
    "contains",
    "Beaker",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2"
    ]
  ],
  [
    "Liquid",
    "undergoes",
    "Chemical_Reaction",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4"
    ]
  ],
  [
    "Beaker",
    "placed_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0"
    ]
  ],
  [
    "Beaker",
    "placed_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1"
    ]
  ],
  [
    "Beaker",
    "placed_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2"
    ]
  ],
  [
    "Beaker",
    "placed_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3"
    ]
  ],
  [
    "Beaker",
    "placed_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4"
    ]
  ],
  [
    "Beaker",
    "placed_on",
    "Magnetic_Stirrer",
    [
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_0",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_1",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_2",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_3",
      "c9e3bb63-6754-4df9-9e87-3b305cca6e63_70_4"
    ]
  ]
]
2025-11-24 15:10:19,443 - src.components.global_refiner - INFO - Refinement complete: 25 → 29 triplets (total: 39.32s, LLM: 39.32s)
2025-11-24 15:10:19,443 - src.pipeline.kg_builder - INFO - Global refinement: 29 triplets in 39.32s
2025-11-24 15:10:19,443 - src.pipeline.kg_builder - INFO - Using 29 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:10:19,443 - src.pipeline.kg_builder - INFO - Pushing batch 71/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:10:19,443 - src.components.neo4j_handler - INFO - Adding 24 triplets + 3 chunks to graph (hybrid mode)
2025-11-24 15:10:19,640 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:10:19,640 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:10:19,640 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:10:19,640 - src.components.neo4j_handler - INFO - Batch injected in 0.20s (triplets: 0.19s, indexes: 0.00s)
2025-11-24 15:10:19,640 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:10:19,740 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:10:19,860 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 832
2025-11-24 15:10:19,970 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 848, 'relationship_count': 3026, 'density': 0.0042, 'avg_degree': 7.1368, 'avg_unique_neighbors': 7.0189, 'global_efficiency': 0.3777, 'avg_path_length': 2.826, 'avg_degree_centrality': 0.0084, 'max_degree_centrality': 0.5301, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0629, 'degree_assortativity': -0.1457, 'graph_robustness': 0.6993, 'diameter_estimate': 50, 'clustering_coefficient': 0.3159, 'weakly_connected_components': 17, 'largest_wcc_size': 832, 'pagerank_top10_percent': 4.06, 'louvain_communities': 29, 'louvain_modularity': 0.435, 'label_entropy': 1.4789, 'computational_time': 0.32999264902900904}
2025-11-24 15:10:19,970 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 70, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763968219.9708695, 'total_time': 47.01361060800264, 'aggregation': 2.8569484129548073e-06, 'network_info': 0.0063389690476469696, 'llm_extraction': 46.47943685401697, 'data_cleaning': 2.929801121354103e-05, 'neo4j_injection': 0.19730381102999672, 'embedding_time': 0, 'indexing_time': 0.0029332650010474026, 'graph_injection_time': 0.19416805601213127, 'acs_metrics': {'node_count': 848, 'relationship_count': 3026, 'density': 0.0042, 'avg_degree': 7.1368, 'avg_unique_neighbors': 7.0189, 'global_efficiency': 0.3777, 'avg_path_length': 2.826, 'avg_degree_centrality': 0.0084, 'max_degree_centrality': 0.5301, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0629, 'degree_assortativity': -0.1457, 'graph_robustness': 0.6993, 'diameter_estimate': 50, 'clustering_coefficient': 0.3159, 'weakly_connected_components': 17, 'largest_wcc_size': 832, 'pagerank_top10_percent': 4.06, 'louvain_communities': 29, 'louvain_modularity': 0.435, 'label_entropy': 1.4789, 'computational_time': 0.32999264902900904}, 'retrieval_queries': []}
2025-11-24 15:10:19,970 - src.pipeline.kg_builder - DEBUG - Batch 70 metrics: {
  "batch_idx": 70,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763968219.9708695,
  "total_time": 47.01361060800264,
  "aggregation": 2.8569484129548073e-06,
  "network_info": 0.0063389690476469696,
  "llm_extraction": 46.47943685401697,
  "data_cleaning": 2.929801121354103e-05,
  "neo4j_injection": 0.19730381102999672,
  "embedding_time": 0,
  "indexing_time": 0.0029332650010474026,
  "graph_injection_time": 0.19416805601213127,
  "acs_metrics": {
    "node_count": 848,
    "relationship_count": 3026,
    "density": 0.0042,
    "avg_degree": 7.1368,
    "avg_unique_neighbors": 7.0189,
    "global_efficiency": 0.3777,
    "avg_path_length": 2.826,
    "avg_degree_centrality": 0.0084,
    "max_degree_centrality": 0.5301,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0629,
    "degree_assortativity": -0.1457,
    "graph_robustness": 0.6993,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3159,
    "weakly_connected_components": 17,
    "largest_wcc_size": 832,
    "pagerank_top10_percent": 4.06,
    "louvain_communities": 29,
    "louvain_modularity": 0.435,
    "label_entropy": 1.4789,
    "computational_time": 0.32999264902900904
  },
  "retrieval_queries": []
}
2025-11-24 15:10:19,972 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:10:19,972 - src.pipeline.kg_builder - INFO - Batch 71 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 46.48s, Clean: 0.00s, Neo4j: 0.20s, ACS: 0.33s
2025-11-24 15:10:19,972 - src.pipeline.kg_builder - INFO - Batch 71 completed in 47.01s
Processing KG batches:  99%|█████████▊| 71/72 [42:17<00:36, 36.91s/it]2025-11-24 15:10:19,972 - src.pipeline.kg_builder - INFO - Processing batch 72/72 (2 items)
2025-11-24 15:10:19,972 - src.pipeline.kg_builder - DEBUG - Batch 72 current_video_time: 17:47-17:52
2025-11-24 15:10:19,978 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 848
- Total Relationships: 1076
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.

2025-11-24 15:10:19,978 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-24 15:10:19,978 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_0 ~228 words, content: Time: 17:42-17:47 Content: The video sequence captures a scientific experiment taking place in a laboratory setting. The scene is set on a black laboratory bench,...
2025-11-24 15:10:19,978 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_1 ~229 words, content: of the Process (Frame 4):** The camera angle changes slightly, but the focus remains on the beaker with the cloudy liquid. The person's hand continues...
2025-11-24 15:10:19,978 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_2 ~226 words, content: actively mixing a liquid in a glass beaker, which is held in place by a clamp. To the right, a blue stand holds a magnetic...
2025-11-24 15:10:19,978 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_3 ~157 words, content: seen extending over the stirrer, and the clamp holding the beaker is visible. The blue stand with the magnetic stir bar is in the foreground....
2025-11-24 15:10:19,978 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction (batch_llm_parallelism=false)
2025-11-24 15:10:19,978 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_0) (~228 words) with timeout=5.0s retries=3
2025-11-24 15:10:21,126 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-24 15:10:21,126 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-24 15:10:21,126 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_1) (~229 words) with timeout=5.0s retries=3
2025-11-24 15:10:22,413 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-24 15:10:22,413 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-24 15:10:22,413 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_2) (~226 words) with timeout=5.0s retries=3
2025-11-24 15:10:23,756 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-24 15:10:23,757 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-24 15:10:23,757 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_3) (~157 words) with timeout=5.0s retries=3
2025-11-24 15:10:24,881 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-24 15:10:24,882 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-24 15:10:24,882 - src.components.pre_llm_injector - INFO - Extracted 19 local triplets from 4 chunks
2025-11-24 15:10:24,882 - src.pipeline.kg_builder - INFO - Pre-extraction: 19 triplets in 4.90s
2025-11-24 15:10:24,883 - src.components.global_refiner - DEBUG - Global refinement full input prompt: Human: 
Consolidate and enrich the following knowledge graph triplets.

CONTEXT:

Current Graph Statistics:
- Total Nodes: 848
- Total Relationships: 1076
- Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63

This information provides context about the current state of the knowledge graph.


CANDIDATES:
[{"head": "Beaker", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_0"]}, {"head": "Tube", "relation": "Is Inserted Into", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_0"]}, {"head": "Person", "relation": "Holds", "tail": "Tube", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudy Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_0", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_1", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_2"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_1"]}, {"head": "Tube", "relation": "Is Connected To", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_1"]}, {"head": "Magnetic Stirrer", "relation": "Stirs", "tail": "Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_1"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "High-Voltage Warning Sign", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_2"]}, {"head": "Person", "relation": "Submerges", "tail": "Rectangular Object", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_2"]}, {"head": "Rectangular Object", "relation": "Is In", "tail": "Cloudy Liquid", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_2"]}, {"head": "Magnetic Stirrer", "relation": "Holds", "tail": "Beaker", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_3"]}, {"head": "Beaker", "relation": "Is Held By", "tail": "Clamp", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_2", "c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_3"]}, {"head": "Person", "relation": "Wears", "tail": "Light-Colored Shirt", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_3"]}, {"head": "Person", "relation": "Wears", "tail": "Jeans", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_3"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Balance Scale", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_3"]}, {"head": "Lab Cabinet", "relation": "Contains", "tail": "Laboratory Supplies", "source_chunks": ["c9e3bb63-6754-4df9-9e87-3b305cca6e63_71_3"]}]

TASKS:
1. Merge duplicates and normalize entities (e.g., "Man" -> "Person").
2. Use snake_case for relations.
3. Track source chunks indices.

OUTPUT FORMAT:
Return a JSON object with a single key "triplets".
The value must be a list of lists, where each inner list is: [Head, Relation, Tail, [source_indices]].

CONSTRAINTS:
Do not output more than 20 triplets in the top-level "triplets" list.

EXAMPLE:
{"triplets": [
  ["Person", "holds", "Smartphone", [0, 1]],
  ["Smartphone", "brand", "Apple", [2]]
]}

JSON OUTPUT:

2025-11-24 15:10:24,883 - src.components.global_refiner - DEBUG - Refining 19 triplets (prompt ~299 words, ~389 tokens)
2025-11-24 15:10:24,883 - src.components.global_refiner - DEBUG - Starting global refinement LLM call...
2025-11-24 15:10:32,376 - src.components.global_refiner - DEBUG - LLM call completed in 7.49s
2025-11-24 15:10:32,377 - src.components.global_refiner - DEBUG - Global refinement raw LLM output: triplets=[['Beaker', 'is_on', 'Magnetic_Stirrer', [0, 7]], ['Beaker', 'contains', 'Liquid', [0]], ['Tube', 'is_inserted_into', 'Beaker', [2]], ['Person', 'holds', 'Tube', [3, 4]], ['Beaker', 'contains', 'Cloudy_Liquid', [5, 6, 8]], ['Lab_Bench', 'contains', 'Beaker', [0]], ['Tube', 'is_connected_to', 'Beaker', [9]], ['Magnetic_Stirrer', 'stirs', 'Liquid', [9]], ['Lab_Environment', 'contains', 'High_Voltage_Warning_Sign', [10]], ['Person', 'holds', 'Glass_Beaker', [11]], ['Person', 'submerges', 'Rectangular_Object', [12]], ['Rectangular_Object', 'is_in', 'Cloudy_Liquid', [12]], ['Magnetic_Stirrer', 'holds', 'Beaker', [13, 14]], ['Beaker', 'is_held_by', 'Clamp', [13, 14]], ['Person', 'wears', 'Light_Colored_Shirt', [15]], ['Person', 'wears', 'Jeans', [15]], ['Lab_Table', 'contains', 'Balance_Scale', [16]], ['Lab_Cabinet', 'contains', 'Laboratory_Supplies', [17]]]
2025-11-24 15:10:32,377 - src.components.global_refiner - DEBUG - LLM refinement output: [
  [
    "Beaker",
    "is_on",
    "Magnetic_Stirrer",
    [
      0,
      7
    ]
  ],
  [
    "Beaker",
    "contains",
    "Liquid",
    [
      0
    ]
  ],
  [
    "Tube",
    "is_inserted_into",
    "Beaker",
    [
      2
    ]
  ],
  [
    "Person",
    "holds",
    "Tube",
    [
      3,
      4
    ]
  ],
  [
    "Beaker",
    "contains",
    "Cloudy_Liquid",
    [
      5,
      6,
      8
    ]
  ],
  [
    "Lab_Bench",
    "contains",
    "Beaker",
    [
      0
    ]
  ],
  [
    "Tube",
    "is_connected_to",
    "Beaker",
    [
      9
    ]
  ],
  [
    "Magnetic_Stirrer",
    "stirs",
    "Liquid",
    [
      9
    ]
  ],
  [
    "Lab_Environment",
    "contains",
    "High_Voltage_Warning_Sign",
    [
      10
    ]
  ],
  [
    "Person",
    "holds",
    "Glass_Beaker",
    [
      11
    ]
  ],
  [
    "Person",
    "submerges",
    "Rectangular_Object",
    [
      12
    ]
  ],
  [
    "Rectangular_Object",
    "is_in",
    "Cloudy_Liquid",
    [
      12
    ]
  ],
  [
    "Magnetic_Stirrer",
    "holds",
    "Beaker",
    [
      13,
      14
    ]
  ],
  [
    "Beaker",
    "is_held_by",
    "Clamp",
    [
      13,
      14
    ]
  ],
  [
    "Person",
    "wears",
    "Light_Colored_Shirt",
    [
      15
    ]
  ],
  [
    "Person",
    "wears",
    "Jeans",
    [
      15
    ]
  ],
  [
    "Lab_Table",
    "contains",
    "Balance_Scale",
    [
      16
    ]
  ],
  [
    "Lab_Cabinet",
    "contains",
    "Laboratory_Supplies",
    [
      17
    ]
  ]
]
2025-11-24 15:10:32,377 - src.components.global_refiner - INFO - Refinement complete: 19 → 18 triplets (total: 7.49s, LLM: 7.49s)
2025-11-24 15:10:32,377 - src.pipeline.kg_builder - INFO - Global refinement: 18 triplets in 7.49s
2025-11-24 15:10:32,377 - src.pipeline.kg_builder - INFO - Using 18 refined triplets (skipped redundant final LLM enrichment)
2025-11-24 15:10:32,377 - src.pipeline.kg_builder - INFO - Pushing batch 72/72 to graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:10:32,378 - src.components.neo4j_handler - INFO - Adding 18 triplets + 2 chunks to graph (hybrid mode)
2025-11-24 15:10:32,626 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-24 15:10:32,626 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-24 15:10:32,626 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-24 15:10:32,626 - src.components.neo4j_handler - INFO - Batch injected in 0.25s (triplets: 0.25s, indexes: 0.00s)
2025-11-24 15:10:32,626 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-24 15:10:32,732 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-24 15:10:32,851 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 836
2025-11-24 15:10:32,912 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 856, 'relationship_count': 3033, 'density': 0.0041, 'avg_degree': 7.0864, 'avg_unique_neighbors': 6.9696, 'global_efficiency': 0.3727, 'avg_path_length': 2.8271, 'avg_degree_centrality': 0.0083, 'max_degree_centrality': 0.5275, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0678, 'degree_assortativity': -0.147, 'graph_robustness': 0.7, 'diameter_estimate': 50, 'clustering_coefficient': 0.3135, 'weakly_connected_components': 21, 'largest_wcc_size': 836, 'pagerank_top10_percent': 4.02, 'louvain_communities': 36, 'louvain_modularity': 0.4202, 'label_entropy': 1.4793, 'computational_time': 0.285359144967515}
2025-11-24 15:10:32,912 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 71, 'run_uuid': 'c9e3bb63-6754-4df9-9e87-3b305cca6e63', 'timestamp': 1763968232.912653, 'total_time': 12.9402218569885, 'aggregation': 2.2269668988883495e-06, 'network_info': 0.005611839005723596, 'llm_extraction': 12.3995419809944, 'data_cleaning': 5.0450966227799654e-05, 'neo4j_injection': 0.24905778700485826, 'embedding_time': 0, 'indexing_time': 0.0013719589915126562, 'graph_injection_time': 0.24733766698045656, 'acs_metrics': {'node_count': 856, 'relationship_count': 3033, 'density': 0.0041, 'avg_degree': 7.0864, 'avg_unique_neighbors': 6.9696, 'global_efficiency': 0.3727, 'avg_path_length': 2.8271, 'avg_degree_centrality': 0.0083, 'max_degree_centrality': 0.5275, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0678, 'degree_assortativity': -0.147, 'graph_robustness': 0.7, 'diameter_estimate': 50, 'clustering_coefficient': 0.3135, 'weakly_connected_components': 21, 'largest_wcc_size': 836, 'pagerank_top10_percent': 4.02, 'louvain_communities': 36, 'louvain_modularity': 0.4202, 'label_entropy': 1.4793, 'computational_time': 0.285359144967515}, 'retrieval_queries': []}
2025-11-24 15:10:32,912 - src.pipeline.kg_builder - DEBUG - Batch 71 metrics: {
  "batch_idx": 71,
  "run_uuid": "c9e3bb63-6754-4df9-9e87-3b305cca6e63",
  "timestamp": 1763968232.912653,
  "total_time": 12.9402218569885,
  "aggregation": 2.2269668988883495e-06,
  "network_info": 0.005611839005723596,
  "llm_extraction": 12.3995419809944,
  "data_cleaning": 5.0450966227799654e-05,
  "neo4j_injection": 0.24905778700485826,
  "embedding_time": 0,
  "indexing_time": 0.0013719589915126562,
  "graph_injection_time": 0.24733766698045656,
  "acs_metrics": {
    "node_count": 856,
    "relationship_count": 3033,
    "density": 0.0041,
    "avg_degree": 7.0864,
    "avg_unique_neighbors": 6.9696,
    "global_efficiency": 0.3727,
    "avg_path_length": 2.8271,
    "avg_degree_centrality": 0.0083,
    "max_degree_centrality": 0.5275,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0678,
    "degree_assortativity": -0.147,
    "graph_robustness": 0.7,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.3135,
    "weakly_connected_components": 21,
    "largest_wcc_size": 836,
    "pagerank_top10_percent": 4.02,
    "louvain_communities": 36,
    "louvain_modularity": 0.4202,
    "label_entropy": 1.4793,
    "computational_time": 0.285359144967515
  },
  "retrieval_queries": []
}
2025-11-24 15:10:32,914 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c9e3bb63-6754-4df9-9e87-3b305cca6e63_batch_metrics_kg.json
2025-11-24 15:10:32,914 - src.pipeline.kg_builder - INFO - Batch 72 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 12.40s, Clean: 0.00s, Neo4j: 0.25s, ACS: 0.29s
2025-11-24 15:10:32,914 - src.pipeline.kg_builder - INFO - Batch 72 completed in 12.94s
Processing KG batches: 100%|██████████| 72/72 [42:30<00:00, 29.72s/it]2025-11-24 15:10:32,915 - src.core.metrics - INFO - Metrics saved to: metrics/kg_c9e3bb63-6754-4df9-9e87-3b305cca6e63.json
2025-11-24 15:10:32,915 - src.pipeline.kg_builder - INFO - Knowledge graph construction completed successfully!
2025-11-24 15:10:32,915 - src.pipeline.kg_builder - INFO - Graph UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
2025-11-24 15:10:32,915 - src.pipeline.kg_builder - INFO - Total batches processed: 72
2025-11-24 15:10:32,915 - src.pipeline.kg_builder - INFO - Hierarchical extraction enabled: chunk_size=296, parallel=2
Processing KG batches: 100%|██████████| 72/72 [42:30<00:00, 35.42s/it]
2025-11-24 15:10:32,916 - __main__ - INFO - Knowledge graph construction completed with UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
Knowledge graph construction completed with UUID: c9e3bb63-6754-4df9-9e87-3b305cca6e63
