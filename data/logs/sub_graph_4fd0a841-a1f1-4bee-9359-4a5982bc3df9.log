nohup: ignoring input
2025-11-30 21:06:56,821 - __main__ - INFO - Loading configuration from: config/base_config.yaml
2025-11-30 21:06:56,823 - __main__ - INFO - Building knowledge graph from: /home/viture-ai/Documents/Real-Time-Brain-Inspired-Video-Memory/data/outputs/vlm_output.json
2025-11-30 21:06:56,916 - src.components.neo4j_handler - INFO - Initialized Neo4j handler for run UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:06:56,937 - src.components.llm_injector - INFO - Initialized LLMInjector (chunking: True)
2025-11-30 21:06:57,049 - src.components.pre_llm_injector - INFO - Initialized PreLLMInjector: chunk_size=296, overlap=16, parallel=2, max_triplets_per_chunk=6, subgraph_extraction=True
2025-11-30 21:06:57,050 - src.components.global_refiner - INFO - Initialized GlobalRefiner with max_tokens=4000
2025-11-30 21:06:57,050 - src.pipeline.kg_builder - INFO - Initialized KG Builder with run UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9 (hierarchical extraction: True)
2025-11-30 21:06:57,050 - src.pipeline.kg_builder - INFO - Starting knowledge graph construction from: /home/viture-ai/Documents/Real-Time-Brain-Inspired-Video-Memory/data/outputs/vlm_output.json
2025-11-30 21:06:57,051 - src.pipeline.kg_builder - INFO - Reset logs directory: /home/viture-ai/Documents/Real-Time-Brain-Inspired-Video-Memory/logs
Processing KG batches:   0%|          | 0/72 [00:00<?, ?it/s]2025-11-30 21:06:57,053 - src.pipeline.kg_builder - INFO - Processing batch 1/72 (3 items)
2025-11-30 21:06:57,053 - src.pipeline.kg_builder - DEBUG - Batch 1 current_video_time: 00:09-00:14
2025-11-30 21:06:57,106 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 0
- Total Relationships: 0
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:06:57,107 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:06:57,107 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_0 ~221 words, content: Time: 00:00-00:04 Content: The video sequence captures a scene within a laboratory environment, focusing on a person and their interaction with the surroundings. - **Initial...
2025-11-30 21:06:57,107 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_1 ~237 words, content: , looking directly at it. They are still holding the smartphone. The laboratory setting remains consistent, with the glass cabinet, the door, and the equipment...
2025-11-30 21:06:57,107 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_2 ~196 words, content: up as if to show it. - In the final frame, the man is still holding the paper and looking at the camera. The man...
2025-11-30 21:06:57,107 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_3 ~181 words, content: This indicates the document is a report for a chemistry experiment, possibly using augmented reality technology. The person holding the paper is wearing a blue...
2025-11-30 21:06:57,128 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:06:57,241 - src.components.pre_llm_injector - DEBUG - Found 0 existing chunk embeddings for similarity lookup
2025-11-30 21:06:57,241 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : []
2025-11-30 21:06:57,241 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: none (no existing chunks to compare)
2025-11-30 21:06:57,241 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: none (no existing chunks to compare)
2025-11-30 21:06:57,241 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: none (no existing chunks to compare)
2025-11-30 21:06:57,241 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: none (no existing chunks to compare)
2025-11-30 21:06:57,241 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:06:57,242 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_0) (~221 words) with timeout=5.0s retries=3
2025-11-30 21:06:58,366 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:06:58,366 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:06:58,366 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_1) (~237 words) with timeout=5.0s retries=3
2025-11-30 21:06:59,373 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:06:59,373 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:06:59,374 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_2) (~196 words) with timeout=5.0s retries=3
2025-11-30 21:07:00,624 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:07:00,624 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:07:00,625 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_3) (~181 words) with timeout=5.0s retries=3
2025-11-30 21:07:01,699 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:07:01,699 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:07:01,699 - src.components.pre_llm_injector - INFO - Extracted 20 local triplets from 4 chunks
2025-11-30 21:07:01,699 - src.pipeline.kg_builder - INFO - Pre-extraction: 20 triplets in 4.59s
2025-11-30 21:07:01,699 - src.components.global_refiner - INFO - Capping refinement input: 20 → 15 triplets
2025-11-30 21:07:01,699 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.

RULE: If CONTEXT SUBGRAPHS is empty or says "No subgraph context available", set "inter_chunk_relations", "merge_instructions", and "prune_instructions" to []. ONLY add to "new_triplets" from NEW CANDIDATES. DO NOT invent IDs, entities, or relations—stick to provided data. For merges/links, match EXACT entity names/IDs from CONTEXT only.

### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
No subgraph context available
No existing entities or relations.

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Cream-Colored Sweater", "source_chunks": ["0_0", "0_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Jeans", "source_chunks": ["0_0", "0_2"]}, {"head": "Person", "relation": "Holds", "tail": "Smartphone", "source_chunks": ["0_0", "0_1"]}, {"head": "Person", "relation": "Stands Near", "tail": "Laboratory Table", "source_chunks": ["0_0"]}, {"head": "Laboratory Table", "relation": "Contains", "tail": "Precision Balance", "source_chunks": ["0_0"]}, {"head": "Laboratory Table", "relation": "Contains", "tail": "Red-Capped Bottle", "source_chunks": ["0_0"]}, {"head": "Person", "relation": "Stands In", "tail": "Laboratory", "source_chunks": ["0_1"]}, {"head": "Person", "relation": "Interacts With", "tail": "Paper", "source_chunks": ["0_1"]}, {"head": "Person", "relation": "Looks At", "tail": "Camera", "source_chunks": ["0_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Balance_Scale", "source_chunks": ["0_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Glassware", "source_chunks": ["0_1"]}, {"head": "Person", "relation": "Holds", "tail": "Document", "source_chunks": ["0_2"]}, {"head": "Person", "relation": "Stands", "tail": "Left Side Of Frame", "source_chunks": ["0_2"]}, {"head": "Document", "relation": "Has Title", "tail": "Ar Glasses Training Chemistry Experiment Report (Simplified Version)", "source_chunks": ["0_2"]}, {"head": "Document", "relation": "Is About", "tail": "Chemistry Experiment", "source_chunks": ["0_2", "0_3"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:07:01,699 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~380 words, ~494 tokens)
2025-11-30 21:07:01,699 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:07:08,499 - src.components.global_refiner - DEBUG - LLM call completed in 6.80s
2025-11-30 21:07:08,499 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Cream-Colored Sweater', ['0_0', '0_2']], ['Person', 'Wears', 'Blue Jeans', ['0_0', '0_2']], ['Person', 'Holds', 'Smartphone', ['0_0', '0_1']], ['Person', 'Stands Near', 'Laboratory Table', ['0_0']], ['Laboratory Table', 'Contains', 'Precision Balance', ['0_0']], ['Laboratory Table', 'Contains', 'Red-Capped Bottle', ['0_0']], ['Person', 'Stands In', 'Laboratory', ['0_1']], ['Person', 'Interacts With', 'Paper', ['0_1']], ['Person', 'Looks At', 'Camera', ['0_1']], ['Laboratory', 'Contains', 'Balance_Scale', ['0_1']], ['Laboratory', 'Contains', 'Glassware', ['0_1']], ['Person', 'Holds', 'Document', ['0_2']], ['Person', 'Stands', 'Left Side Of Frame', ['0_2']], ['Document', 'Has Title', 'Ar Glasses Training Chemistry Experiment Report (Simplified Version)', ['0_2']], ['Document', 'Is About', 'Chemistry Experiment', ['0_2', '0_3']]] inter_chunk_relations=[] merge_instructions=[] prune_instructions=[]
2025-11-30 21:07:08,499 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Cream-Colored Sweater', ['0_0', '0_2']], ['Person', 'Wears', 'Blue Jeans', ['0_0', '0_2']], ['Person', 'Holds', 'Smartphone', ['0_0', '0_1']]]
2025-11-30 21:07:08,499 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=0, sample=[]
2025-11-30 21:07:08,499 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=0, sample=[]
2025-11-30 21:07:08,499 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=0, sample=[]
2025-11-30 21:07:08,499 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 15 triplets (total: 6.80s, LLM: 6.80s)
2025-11-30 21:07:08,500 - src.pipeline.kg_builder - INFO - Global refinement: 15 triplets in 6.80s
2025-11-30 21:07:08,500 - src.pipeline.kg_builder - INFO - Using 15 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:07:08,500 - src.pipeline.kg_builder - INFO - Pushing batch 1/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:07:08,500 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:07:08,724 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=20, relationships=15
2025-11-30 21:07:08,725 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:07:08,732 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=20, relationships=15
2025-11-30 21:07:08,735 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:07:08,735 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:07:08,735 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:07:08,735 - src.components.neo4j_handler - INFO - Batch injected in 0.24s (triplets: 0.23s, indexes: 0.00s)
2025-11-30 21:07:08,736 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 4, 'with_embedding': 4, 'linked_chunks': 4}
2025-11-30 21:07:08,736 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:07:08,739 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 20 nodes
2025-11-30 21:07:08,739 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 20 nodes
2025-11-30 21:07:08,744 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 20, 'relationship_count': 38, 'density': 0.1, 'avg_degree': 3.8, 'avg_unique_neighbors': 3.8, 'global_efficiency': 0.5333, 'avg_path_length': 2.2421, 'avg_degree_centrality': 0.2, 'max_degree_centrality': 0.6316, 'avg_betweenness_centrality': 0.001, 'max_betweenness_centrality': 0.0088, 'degree_assortativity': -0.5171, 'graph_robustness': 0.6316, 'diameter_estimate': 4, 'clustering_coefficient': 0.3526, 'weakly_connected_components': 1, 'largest_wcc_size': 20, 'pagerank_top10_percent': 70.09, 'louvain_communities': 4, 'louvain_modularity': 0.3618, 'label_entropy': 1.361, 'computational_time': 0.00791883294004947}
2025-11-30 21:07:08,744 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 0, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508028.744931, 'total_time': 11.691608747001737, 'aggregation': 3.048917278647423e-06, 'network_info': 0.05344010703265667, 'llm_extraction': 11.39319778396748, 'data_cleaning': 4.026398528367281e-05, 'neo4j_injection': 0.23575916595291346, 'embedding_time': 0, 'indexing_time': 0.003081844071857631, 'graph_injection_time': 0.23240602703299373, 'acs_metrics': {'node_count': 20, 'relationship_count': 38, 'density': 0.1, 'avg_degree': 3.8, 'avg_unique_neighbors': 3.8, 'global_efficiency': 0.5333, 'avg_path_length': 2.2421, 'avg_degree_centrality': 0.2, 'max_degree_centrality': 0.6316, 'avg_betweenness_centrality': 0.001, 'max_betweenness_centrality': 0.0088, 'degree_assortativity': -0.5171, 'graph_robustness': 0.6316, 'diameter_estimate': 4, 'clustering_coefficient': 0.3526, 'weakly_connected_components': 1, 'largest_wcc_size': 20, 'pagerank_top10_percent': 70.09, 'louvain_communities': 4, 'louvain_modularity': 0.3618, 'label_entropy': 1.361, 'computational_time': 0.00791883294004947}, 'retrieval_queries': []}
2025-11-30 21:07:08,745 - src.pipeline.kg_builder - DEBUG - Batch 0 metrics: {
  "batch_idx": 0,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508028.744931,
  "total_time": 11.691608747001737,
  "aggregation": 3.048917278647423e-06,
  "network_info": 0.05344010703265667,
  "llm_extraction": 11.39319778396748,
  "data_cleaning": 4.026398528367281e-05,
  "neo4j_injection": 0.23575916595291346,
  "embedding_time": 0,
  "indexing_time": 0.003081844071857631,
  "graph_injection_time": 0.23240602703299373,
  "acs_metrics": {
    "node_count": 20,
    "relationship_count": 38,
    "density": 0.1,
    "avg_degree": 3.8,
    "avg_unique_neighbors": 3.8,
    "global_efficiency": 0.5333,
    "avg_path_length": 2.2421,
    "avg_degree_centrality": 0.2,
    "max_degree_centrality": 0.6316,
    "avg_betweenness_centrality": 0.001,
    "max_betweenness_centrality": 0.0088,
    "degree_assortativity": -0.5171,
    "graph_robustness": 0.6316,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.3526,
    "weakly_connected_components": 1,
    "largest_wcc_size": 20,
    "pagerank_top10_percent": 70.09,
    "louvain_communities": 4,
    "louvain_modularity": 0.3618,
    "label_entropy": 1.361,
    "computational_time": 0.00791883294004947
  },
  "retrieval_queries": []
}
2025-11-30 21:07:08,745 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:07:08,745 - src.pipeline.kg_builder - INFO - Batch 1 timings - Agg: 0.00s, NetInfo: 0.05s, LLM: 11.39s, Clean: 0.00s, Neo4j: 0.24s, ACS: 0.01s
2025-11-30 21:07:08,745 - src.pipeline.kg_builder - INFO - Batch 1 completed in 11.69s
Processing KG batches:   1%|▏         | 1/72 [00:11<13:50, 11.69s/it]2025-11-30 21:07:08,745 - src.pipeline.kg_builder - INFO - Processing batch 2/72 (3 items)
2025-11-30 21:07:08,745 - src.pipeline.kg_builder - DEBUG - Batch 2 current_video_time: 00:24-00:29
2025-11-30 21:07:08,753 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 20
- Total Relationships: 15
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:07:08,753 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:07:08,753 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_0 ~221 words, content: Time: 00:14-00:19 Content: The video sequence captures a scene within a laboratory or research facility, focusing on a person and their surroundings. The camera's movement...
2025-11-30 21:07:08,753 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_1 ~200 words, content: , possibly a balance or a sample holder. The background shows more of the lab's white cabinetry and a stack of cardboard boxes. The overall...
2025-11-30 21:07:08,753 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_2 ~195 words, content: and components, including a syringe, a small container, and a pen. To the left, a tall, white, glass-fronted cabinet is open, revealing shelves stocked with...
2025-11-30 21:07:08,753 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_3 ~215 words, content: 学实验报告 (简版)" (AR Glasses Training Chemistry Experiment Report (Brief Version)). This document appears to be a guide for the experiment, which involves the synthesis of...
2025-11-30 21:07:08,753 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4 ~91 words, content: data. The use of AR glasses suggests that the experiment is being conducted as part of a training program, where the user can see instructions...
2025-11-30 21:07:08,774 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:07:08,800 - src.components.pre_llm_injector - DEBUG - Found 4 existing chunk embeddings for similarity lookup
2025-11-30 21:07:08,801 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_3', '0.639'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_1', '0.625')]
2025-11-30 21:07:08,802 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_3
2025-11-30 21:07:08,802 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:07:08,803 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 3 total -> 3 (internal: 1, external: 2)
2025-11-30 21:07:08,803 - src.components.pre_llm_injector - DEBUG - Subgraph: (Document / ID: 0_2)-[IS_ABOUT]->(Chemistry Experiment / ID: 0_2), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Document / ID: 0_2)-[HAS_TITLE]->(Ar Glasses Training Chemistry Experiment Report (Simplified Version) / ID: 0_2)
2025-11-30 21:07:08,847 - src.components.pre_llm_injector - DEBUG - Found 7 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_1
2025-11-30 21:07:08,847 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:07:08,849 - src.components.pre_llm_injector - DEBUG - Limited Person from 5 to 2 external connections
2025-11-30 21:07:08,849 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 11 total -> 8 (internal: 6, external: 2)
2025-11-30 21:07:08,849 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(Smartphone / ID: 0_0), (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[INTERACTS_WITH]->(Paper / ID: 0_1), (Person / ID: 0_0)-[LOOKS_AT]->(Camera / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance_Scale / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Glassware / ID: 0_1), (Person / ID: 0_0)-[STANDS]->(Left Side Of Frame / ID: 0_2), (Person / ID: 0_0)-[STANDS_NEAR]->(Laboratory Table / ID: 0_0)
2025-11-30 21:07:08,849 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_0', '0.516'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_1', '0.500')]
2025-11-30 21:07:08,850 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_1', '0.623'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_3', '0.617')]
2025-11-30 21:07:08,850 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_2', '0.439'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_1', '0.409')]
2025-11-30 21:07:08,850 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_3', '0.607'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_1', '0.551')]
2025-11-30 21:07:08,850 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_3', '0.639'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_1', '0.625')]
2025-11-30 21:07:08,850 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:07:08,850 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_0) (~221 words) with timeout=5.0s retries=3
2025-11-30 21:07:13,856 - src.components.pre_llm_injector - WARNING - Chunk 0 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 21:07:19,363 - src.components.pre_llm_injector - WARNING - Chunk 0 timed out after 5.0s (attempt 2/4), retrying...
2025-11-30 21:07:21,497 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 3)
2025-11-30 21:07:21,497 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:07:21,498 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_1) (~200 words) with timeout=5.0s retries=3
2025-11-30 21:07:22,610 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:07:22,610 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:07:22,611 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_2) (~195 words) with timeout=5.0s retries=3
2025-11-30 21:07:27,617 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 21:07:33,120 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 2/4), retrying...
2025-11-30 21:07:39,128 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 3/4), retrying...
2025-11-30 21:07:45,636 - src.components.pre_llm_injector - WARNING - ⚠️ Chunk 2 TIMED OUT after 5.0s on final attempt. Skipping.
2025-11-30 21:07:45,636 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 0 triplets
2025-11-30 21:07:45,637 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_3) (~215 words) with timeout=5.0s retries=3
2025-11-30 21:07:46,806 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:07:46,806 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:07:46,806 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4) (~91 words) with timeout=5.0s retries=3
2025-11-30 21:07:47,861 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:07:47,861 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:07:47,861 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 5 chunks
2025-11-30 21:07:47,861 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 39.11s
2025-11-30 21:07:47,861 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 21:07:47,862 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Document / ID: 0_2)-[IS_ABOUT]->(Chemistry Experiment / ID: 0_2), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Document / ID: 0_2)-[HAS_TITLE]->(Ar Glasses Training Chemistry Experiment Report (Simplified Version) / ID: 0_2)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[HOLDS]->(Smartphone / ID: 0_0), (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[INTERACTS_WITH]->(Paper / ID: 0_1), (Person / ID: 0_0)-[LOOKS_AT]->(Camera / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance_Scale / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Glassware / ID: 0_1), (Person / ID: 0_0)-[STANDS]->(Left Side Of Frame / ID: 0_2), (Person / ID: 0_0)-[STANDS_NEAR]->(Laboratory Table / ID: 0_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Turtleneck_Sweater", "source_chunks": ["1_0"]}, {"head": "Person", "relation": "Wears", "tail": "Jeans", "source_chunks": ["1_0"]}, {"head": "Person", "relation": "Stands", "tail": "In_Laboratory", "source_chunks": ["1_0"]}, {"head": "Camera", "relation": "Pans", "tail": "To_The_Right", "source_chunks": ["1_0"]}, {"head": "Camera", "relation": "Reveals", "tail": "Countertop", "source_chunks": ["1_0"]}, {"head": "Countertop", "relation": "Contains", "tail": "Equipment", "source_chunks": ["1_0"]}, {"head": "Person", "relation": "Stands In", "tail": "Laboratory", "source_chunks": ["1_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Workbench", "source_chunks": ["1_1"]}, {"head": "Workbench", "relation": "Holds", "tail": "Bottle", "source_chunks": ["1_1"]}, {"head": "Workbench", "relation": "Holds", "tail": "Paper", "source_chunks": ["1_1"]}, {"head": "Workbench", "relation": "Holds", "tail": "Apparatus", "source_chunks": ["1_1"]}, {"head": "Apparatus", "relation": "Is Part Of", "tail": "Laboratory Equipment", "source_chunks": ["1_1"]}, {"head": "Person", "relation": "Uses", "tail": "Ar Glasses", "source_chunks": ["1_3"]}, {"head": "Person", "relation": "Holds", "tail": "White Pen", "source_chunks": ["1_3"]}, {"head": "White Pen", "relation": "Writes On", "tail": "Experiment Report", "source_chunks": ["1_3"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:07:47,862 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~400 words, ~520 tokens)
2025-11-30 21:07:47,862 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:08:00,650 - src.components.global_refiner - DEBUG - LLM call completed in 12.79s
2025-11-30 21:08:00,650 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Turtleneck_Sweater', ['1_0']], ['Person', 'Wears', 'Jeans', ['1_0']], ['Person', 'Stands', 'In_Laboratory', ['1_0']], ['Camera', 'Pans', 'To_The_Right', ['1_0']], ['Camera', 'Reveals', 'Countertop', ['1_0']], ['Countertop', 'Contains', 'Equipment', ['1_0']], ['Person', 'Stands In', 'Laboratory', ['1_1']], ['Laboratory', 'Contains', 'Workbench', ['1_1']], ['Workbench', 'Holds', 'Bottle', ['1_1']], ['Workbench', 'Holds', 'Paper', ['1_1']], ['Workbench', 'Holds', 'Apparatus', ['1_1']], ['Apparatus', 'Is Part Of', 'Laboratory Equipment', ['1_1']], ['Person', 'Uses', 'Ar Glasses', ['1_3']], ['Person', 'Holds', 'White Pen', ['1_3']], ['White Pen', 'Writes On', 'Experiment Report', ['1_3']]] inter_chunk_relations=[['Person', 'Stands In', 'Laboratory', ['1_0']], ['Person', 'Stands In', 'Laboratory', ['1_1']], ['Workbench', 'Holds', 'Paper', ['1_1']], ['Person', 'Holds', 'White Pen', ['1_3']], ['White Pen', 'Writes On', 'Experiment Report', ['1_3']]] merge_instructions=[{'local': 'In_Laboratory', 'existing': 'Laboratory', 'existing_id': '0_1'}, {'local': 'Laboratory Equipment', 'existing': 'Laboratory Equipment', 'existing_id': '0_1'}, {'local': 'Experiment Report', 'existing': 'Ar Glasses Training Chemistry Experiment Report (Simplified Version)', 'existing_id': '0_2'}] prune_instructions=[{'head': 'Person', 'relation': 'Stands', 'tail': 'Left Side Of Frame'}, {'head': 'Person', 'relation': 'Stands Near', 'tail': 'Laboratory Table'}, {'head': 'Person', 'relation': 'Stands In', 'tail': 'Laboratory'}, {'head': 'Person', 'relation': 'Stands In', 'tail': 'In_Laboratory'}]
2025-11-30 21:08:00,651 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Turtleneck_Sweater', ['1_0']], ['Person', 'Wears', 'Jeans', ['1_0']], ['Person', 'Stands', 'In_Laboratory', ['1_0']]]
2025-11-30 21:08:00,651 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Person', 'Stands In', 'Laboratory', ['1_0']], ['Person', 'Stands In', 'Laboratory', ['1_1']], ['Workbench', 'Holds', 'Paper', ['1_1']]]
2025-11-30 21:08:00,651 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=3, sample=[{'local': 'In_Laboratory', 'existing': 'Laboratory', 'existing_id': '0_1'}, {'local': 'Laboratory Equipment', 'existing': 'Laboratory Equipment', 'existing_id': '0_1'}, {'local': 'Experiment Report', 'existing': 'Ar Glasses Training Chemistry Experiment Report (Simplified Version)', 'existing_id': '0_2'}]
2025-11-30 21:08:00,651 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Stands', 'tail': 'Left Side Of Frame'}, {'head': 'Person', 'relation': 'Stands Near', 'tail': 'Laboratory Table'}, {'head': 'Person', 'relation': 'Stands In', 'tail': 'Laboratory'}]
2025-11-30 21:08:00,651 - src.components.global_refiner - INFO - LLM suggested 3 entity merges: [{'local': 'In_Laboratory', 'existing': 'Laboratory', 'existing_id': '0_1'}, {'local': 'Laboratory Equipment', 'existing': 'Laboratory Equipment', 'existing_id': '0_1'}, {'local': 'Experiment Report', 'existing': 'Ar Glasses Training Chemistry Experiment Report (Simplified Version)', 'existing_id': '0_2'}]
2025-11-30 21:08:00,651 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Stands', 'tail': 'Left Side Of Frame'}, {'head': 'Person', 'relation': 'Stands Near', 'tail': 'Laboratory Table'}, {'head': 'Person', 'relation': 'Stands In', 'tail': 'Laboratory'}, {'head': 'Person', 'relation': 'Stands In', 'tail': 'In_Laboratory'}]
2025-11-30 21:08:00,651 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 12.79s, LLM: 12.79s)
2025-11-30 21:08:00,651 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 12.79s
2025-11-30 21:08:00,651 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:08:00,651 - src.pipeline.kg_builder - INFO - Pushing batch 2/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:08:00,651 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:08:00,808 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=38, relationships=29
2025-11-30 21:08:00,808 - src.components.neo4j_handler - INFO - Applying 3 merge instructions
2025-11-30 21:08:00,808 - src.components.neo4j_handler - DEBUG - APOC merge successful: In_Laboratory -> Laboratory
2025-11-30 21:08:00,808 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Laboratory Equipment -> Laboratory Equipment
2025-11-30 21:08:00,813 - src.components.neo4j_handler - DEBUG - APOC merge successful: Experiment Report -> Ar Glasses Training Chemistry Experiment Report (Simplified Version)
2025-11-30 21:08:00,813 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:08:00,817 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Stands]-> Left Side Of Frame
2025-11-30 21:08:00,819 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Stands Near]-> Laboratory Table
2025-11-30 21:08:00,820 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Stands In]-> Laboratory
2025-11-30 21:08:00,845 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Stands In]-> In_Laboratory
2025-11-30 21:08:00,845 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:08:00,848 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Stands In]-> Laboratory
2025-11-30 21:08:00,849 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Stands In]-> Laboratory
2025-11-30 21:08:00,850 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Workbench -[Holds]-> Paper
2025-11-30 21:08:00,851 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> White Pen
2025-11-30 21:08:00,852 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: White Pen -[Writes On]-> Experiment Report
2025-11-30 21:08:00,852 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:08:00,858 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=36, relationships=27
2025-11-30 21:08:00,860 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:08:00,860 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:08:00,860 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:08:00,860 - src.components.neo4j_handler - INFO - Batch injected in 0.21s (triplets: 0.21s, indexes: 0.00s)
2025-11-30 21:08:00,861 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 9, 'with_embedding': 9, 'linked_chunks': 7}
2025-11-30 21:08:00,861 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:08:00,865 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 36 nodes
2025-11-30 21:08:00,866 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 34 nodes
2025-11-30 21:08:00,871 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 36, 'relationship_count': 68, 'density': 0.054, 'avg_degree': 3.7778, 'avg_unique_neighbors': 3.7778, 'global_efficiency': 0.4093, 'avg_path_length': 2.5597, 'avg_degree_centrality': 0.1079, 'max_degree_centrality': 0.4857, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0059, 'degree_assortativity': -0.3635, 'graph_robustness': 0.8676, 'diameter_estimate': 4, 'clustering_coefficient': 0.3004, 'weakly_connected_components': 3, 'largest_wcc_size': 34, 'pagerank_top10_percent': 53.97, 'louvain_communities': 7, 'louvain_modularity': 0.4848, 'label_entropy': 1.4056, 'computational_time': 0.010264653014019132}
2025-11-30 21:08:00,872 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 1, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508080.8719823, 'total_time': 52.12661246804055, 'aggregation': 3.956025466322899e-06, 'network_info': 0.007808013935573399, 'llm_extraction': 51.89828767394647, 'data_cleaning': 3.849703352898359e-05, 'neo4j_injection': 0.20890057797078043, 'embedding_time': 0, 'indexing_time': 0.0015713010216131806, 'graph_injection_time': 0.2069974159821868, 'acs_metrics': {'node_count': 36, 'relationship_count': 68, 'density': 0.054, 'avg_degree': 3.7778, 'avg_unique_neighbors': 3.7778, 'global_efficiency': 0.4093, 'avg_path_length': 2.5597, 'avg_degree_centrality': 0.1079, 'max_degree_centrality': 0.4857, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0059, 'degree_assortativity': -0.3635, 'graph_robustness': 0.8676, 'diameter_estimate': 4, 'clustering_coefficient': 0.3004, 'weakly_connected_components': 3, 'largest_wcc_size': 34, 'pagerank_top10_percent': 53.97, 'louvain_communities': 7, 'louvain_modularity': 0.4848, 'label_entropy': 1.4056, 'computational_time': 0.010264653014019132}, 'retrieval_queries': []}
2025-11-30 21:08:00,872 - src.pipeline.kg_builder - DEBUG - Batch 1 metrics: {
  "batch_idx": 1,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508080.8719823,
  "total_time": 52.12661246804055,
  "aggregation": 3.956025466322899e-06,
  "network_info": 0.007808013935573399,
  "llm_extraction": 51.89828767394647,
  "data_cleaning": 3.849703352898359e-05,
  "neo4j_injection": 0.20890057797078043,
  "embedding_time": 0,
  "indexing_time": 0.0015713010216131806,
  "graph_injection_time": 0.2069974159821868,
  "acs_metrics": {
    "node_count": 36,
    "relationship_count": 68,
    "density": 0.054,
    "avg_degree": 3.7778,
    "avg_unique_neighbors": 3.7778,
    "global_efficiency": 0.4093,
    "avg_path_length": 2.5597,
    "avg_degree_centrality": 0.1079,
    "max_degree_centrality": 0.4857,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0059,
    "degree_assortativity": -0.3635,
    "graph_robustness": 0.8676,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.3004,
    "weakly_connected_components": 3,
    "largest_wcc_size": 34,
    "pagerank_top10_percent": 53.97,
    "louvain_communities": 7,
    "louvain_modularity": 0.4848,
    "label_entropy": 1.4056,
    "computational_time": 0.010264653014019132
  },
  "retrieval_queries": []
}
2025-11-30 21:08:00,872 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:08:00,872 - src.pipeline.kg_builder - INFO - Batch 2 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 51.90s, Clean: 0.00s, Neo4j: 0.21s, ACS: 0.01s
2025-11-30 21:08:00,872 - src.pipeline.kg_builder - INFO - Batch 2 completed in 52.13s
Processing KG batches:   3%|▎         | 2/72 [01:03<41:23, 35.48s/it]2025-11-30 21:08:00,872 - src.pipeline.kg_builder - INFO - Processing batch 3/72 (3 items)
2025-11-30 21:08:00,872 - src.pipeline.kg_builder - DEBUG - Batch 3 current_video_time: 00:39-00:44
2025-11-30 21:08:00,880 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 36
- Total Relationships: 27
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:08:00,880 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:08:00,880 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_0 ~177 words, content: Time: 00:29-00:34 Content: The video captures a scene in a laboratory setting where a person is conducting a chemistry experiment. The central focus is on...
2025-11-30 21:08:00,880 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_1 ~205 words, content: or the product of the reaction. - A white, circular device with multiple holes, possibly a multi-well plate or a component of the experimental setup....
2025-11-30 21:08:00,880 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_2 ~204 words, content: the report, which is laid out on the table. The report details an experiment to produce hydrogen gas by reacting aluminum with sodium hydroxide. The...
2025-11-30 21:08:00,881 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3 ~193 words, content: , protected by a blue nitrile glove, as they write on a printed document titled "AR 眼镜训练用化学实验报告 (简版)" (AR Glasses Training Chemistry Experiment Report -...
2025-11-30 21:08:00,907 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:08:00,934 - src.components.pre_llm_injector - DEBUG - Found 9 existing chunk embeddings for similarity lookup
2025-11-30 21:08:00,936 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.791'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_1', '0.731')]
2025-11-30 21:08:00,937 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4 via source_chunk_ids
2025-11-30 21:08:00,938 - src.components.pre_llm_injector - DEBUG - Found 7 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_1
2025-11-30 21:08:00,938 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:08:00,941 - src.components.pre_llm_injector - DEBUG - Limited Person from 9 to 2 external connections
2025-11-30 21:08:00,941 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 19 total -> 12 (internal: 8, external: 4)
2025-11-30 21:08:00,941 - src.components.pre_llm_injector - DEBUG - Subgraph: (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1), (Person / ID: 0_0)-[INTERACTS_WITH]->(Paper / ID: 0_1), (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS]->(Laboratory / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Workbench / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Bottle / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Apparatus / ID: 1_1), (Apparatus / ID: 1_1)-[IS_PART_OF]->(Laboratory Equipment / ID: 1_1), (Person / ID: 0_0)-[WEARS]->(Turtleneck_Sweater / ID: 1_0), (Person / ID: 0_0)-[LOOKS_AT]->(Camera / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance_Scale / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Glassware / ID: 0_1)
2025-11-30 21:08:00,941 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_1', '0.731'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.663')]
2025-11-30 21:08:00,941 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_3', '0.552'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_3', '0.501')]
2025-11-30 21:08:00,942 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.514'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_1', '0.514')]
2025-11-30 21:08:00,942 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.791'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_3', '0.714')]
2025-11-30 21:08:00,942 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:08:00,942 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_0) (~177 words) with timeout=5.0s retries=3
2025-11-30 21:08:02,020 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:08:02,021 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:08:02,021 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_1) (~205 words) with timeout=5.0s retries=3
2025-11-30 21:08:03,415 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:08:03,415 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:08:03,416 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_2) (~204 words) with timeout=5.0s retries=3
2025-11-30 21:08:08,422 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 21:08:13,925 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 2/4), retrying...
2025-11-30 21:08:19,932 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 3/4), retrying...
2025-11-30 21:08:22,497 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 4)
2025-11-30 21:08:22,497 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:08:22,497 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3) (~193 words) with timeout=5.0s retries=3
2025-11-30 21:08:26,724 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:08:26,724 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:08:26,725 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 4 chunks
2025-11-30 21:08:26,725 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 25.84s
2025-11-30 21:08:26,725 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 21:08:26,725 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1), (Person / ID: 0_0)-[INTERACTS_WITH]->(Paper / ID: 0_1), (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS]->(Laboratory / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Workbench / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Bottle / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Apparatus / ID: 1_1), (Apparatus / ID: 1_1)-[IS_PART_OF]->(Laboratory Equipment / ID: 1_1), (Person / ID: 0_0)-[WEARS]->(Turtleneck_Sweater / ID: 1_0), (Person / ID: 0_0)-[LOOKS_AT]->(Camera / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance_Scale / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Glassware / ID: 0_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Glove", "source_chunks": ["2_0", "2_2"]}, {"head": "Person", "relation": "Holds", "tail": "White Marker", "source_chunks": ["2_0"]}, {"head": "Person", "relation": "Writes On", "tail": "Document", "source_chunks": ["2_0"]}, {"head": "Document", "relation": "Contains", "tail": "Chemical Equation", "source_chunks": ["2_0"]}, {"head": "Document", "relation": "Contains", "tail": "Measured Volume", "source_chunks": ["2_0"]}, {"head": "Test Tube", "relation": "Contains", "tail": "Reactants", "source_chunks": ["2_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["2_1"]}, {"head": "Person", "relation": "Fills Out", "tail": "Chemistry Experiment Report", "source_chunks": ["2_1"]}, {"head": "Chemistry Experiment Report", "relation": "Is Laid On", "tail": "Lab Bench", "source_chunks": ["2_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "White Circular Device", "source_chunks": ["2_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Black Elongated Case", "source_chunks": ["2_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Roll Of Tape", "source_chunks": ["2_1"]}, {"head": "Person", "relation": "Writes On", "tail": "Report", "source_chunks": ["2_2"]}, {"head": "Report", "relation": "Contains", "tail": "Experiment Purpose", "source_chunks": ["2_2"]}, {"head": "Report", "relation": "Contains", "tail": "Experiment Principle", "source_chunks": ["2_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:08:26,725 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~415 words, ~540 tokens)
2025-11-30 21:08:26,725 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:08:38,232 - src.components.global_refiner - DEBUG - LLM call completed in 11.51s
2025-11-30 21:08:38,233 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue Nitrile Glove', ['2_0', '2_2']], ['Person', 'Holds', 'White Marker', ['2_0']], ['Person', 'Writes On', 'Document', ['2_0']], ['Document', 'Contains', 'Chemical Equation', ['2_0']], ['Document', 'Contains', 'Measured Volume', ['2_0']], ['Test Tube', 'Contains', 'Reactants', ['2_0']], ['Person', 'Wears', 'Blue Nitrile Gloves', ['2_1']], ['Person', 'Fills Out', 'Chemistry Experiment Report', ['2_1']], ['Chemistry Experiment Report', 'Is Laid On', 'Lab Bench', ['2_1']], ['Lab Bench', 'Contains', 'White Circular Device', ['2_1']], ['Lab Bench', 'Contains', 'Black Elongated Case', ['2_1']], ['Lab Bench', 'Contains', 'Roll Of Tape', ['2_1']], ['Person', 'Writes On', 'Report', ['2_2']], ['Report', 'Contains', 'Experiment Purpose', ['2_2']], ['Report', 'Contains', 'Experiment Principle', ['2_2']]] inter_chunk_relations=[['Chemistry Experiment Report', 'Is Laid On', 'Lab Bench', ['2_1']], ['Lab Bench', 'Contains', 'White Circular Device', ['2_1']], ['Lab Bench', 'Contains', 'Black Elongated Case', ['2_1']], ['Lab Bench', 'Contains', 'Roll Of Tape', ['2_1']], ['Report', 'Contains', 'Experiment Purpose', ['2_2']], ['Report', 'Contains', 'Experiment Principle', ['2_2']]] merge_instructions=[{'local': 'Blue Nitrile Glove', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}, {'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Turtleneck_Sweater'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}]
2025-11-30 21:08:38,233 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue Nitrile Glove', ['2_0', '2_2']], ['Person', 'Holds', 'White Marker', ['2_0']], ['Person', 'Writes On', 'Document', ['2_0']]]
2025-11-30 21:08:38,233 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=6, sample=[['Chemistry Experiment Report', 'Is Laid On', 'Lab Bench', ['2_1']], ['Lab Bench', 'Contains', 'White Circular Device', ['2_1']], ['Lab Bench', 'Contains', 'Black Elongated Case', ['2_1']]]
2025-11-30 21:08:38,233 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=2, sample=[{'local': 'Blue Nitrile Glove', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}, {'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}]
2025-11-30 21:08:38,233 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=3, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Turtleneck_Sweater'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}]
2025-11-30 21:08:38,233 - src.components.global_refiner - INFO - LLM suggested 2 entity merges: [{'local': 'Blue Nitrile Glove', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}, {'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}]
2025-11-30 21:08:38,233 - src.components.global_refiner - INFO - LLM suggested 3 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Turtleneck_Sweater'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}]
2025-11-30 21:08:38,233 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 21 triplets (total: 11.51s, LLM: 11.51s)
2025-11-30 21:08:38,233 - src.pipeline.kg_builder - INFO - Global refinement: 21 triplets in 11.51s
2025-11-30 21:08:38,233 - src.pipeline.kg_builder - INFO - Using 21 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:08:38,233 - src.pipeline.kg_builder - INFO - Pushing batch 3/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:08:38,234 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:08:38,393 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=55, relationships=42
2025-11-30 21:08:38,393 - src.components.neo4j_handler - INFO - Applying 2 merge instructions
2025-11-30 21:08:38,393 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue Nitrile Glove -> Blue Nitrile Gloves
2025-11-30 21:08:38,393 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue Nitrile Gloves -> Blue Nitrile Gloves
2025-11-30 21:08:38,393 - src.components.neo4j_handler - INFO - Applying 3 prune instructions
2025-11-30 21:08:38,397 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Turtleneck_Sweater
2025-11-30 21:08:38,398 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue Nitrile Glove
2025-11-30 21:08:38,400 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Nitrile Gloves
2025-11-30 21:08:38,400 - src.components.neo4j_handler - INFO - Applying 6 inter-chunk relations
2025-11-30 21:08:38,401 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Chemistry Experiment Report -[Is Laid On]-> Lab Bench
2025-11-30 21:08:38,402 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab Bench -[Contains]-> White Circular Device
2025-11-30 21:08:38,402 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab Bench -[Contains]-> Black Elongated Case
2025-11-30 21:08:38,403 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab Bench -[Contains]-> Roll Of Tape
2025-11-30 21:08:38,404 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Report -[Contains]-> Experiment Purpose
2025-11-30 21:08:38,405 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Report -[Contains]-> Experiment Principle
2025-11-30 21:08:38,406 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:08:38,410 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=54, relationships=39
2025-11-30 21:08:38,411 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:08:38,411 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:08:38,412 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:08:38,412 - src.components.neo4j_handler - INFO - Batch injected in 0.18s (triplets: 0.18s, indexes: 0.00s)
2025-11-30 21:08:38,415 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 13, 'with_embedding': 13, 'linked_chunks': 10}
2025-11-30 21:08:38,416 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:08:38,421 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 54 nodes
2025-11-30 21:08:38,423 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 51 nodes
2025-11-30 21:08:38,428 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 54, 'relationship_count': 99, 'density': 0.0346, 'avg_degree': 3.6667, 'avg_unique_neighbors': 3.6667, 'global_efficiency': 0.3661, 'avg_path_length': 2.8063, 'avg_degree_centrality': 0.0692, 'max_degree_centrality': 0.4151, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0025, 'degree_assortativity': -0.3028, 'graph_robustness': 0.8485, 'diameter_estimate': 4, 'clustering_coefficient': 0.3026, 'weakly_connected_components': 4, 'largest_wcc_size': 51, 'pagerank_top10_percent': 46.17, 'louvain_communities': 10, 'louvain_modularity': 0.5673, 'label_entropy': 1.3981, 'computational_time': 0.012780972057953477}
2025-11-30 21:08:38,429 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 2, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508118.4289882, 'total_time': 37.55642322602216, 'aggregation': 5.549052730202675e-06, 'network_info': 0.007580915000289679, 'llm_extraction': 37.353342063957825, 'data_cleaning': 4.352908581495285e-05, 'neo4j_injection': 0.1787323650205508, 'embedding_time': 0, 'indexing_time': 0.0015760600799694657, 'graph_injection_time': 0.17682951304595917, 'acs_metrics': {'node_count': 54, 'relationship_count': 99, 'density': 0.0346, 'avg_degree': 3.6667, 'avg_unique_neighbors': 3.6667, 'global_efficiency': 0.3661, 'avg_path_length': 2.8063, 'avg_degree_centrality': 0.0692, 'max_degree_centrality': 0.4151, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0025, 'degree_assortativity': -0.3028, 'graph_robustness': 0.8485, 'diameter_estimate': 4, 'clustering_coefficient': 0.3026, 'weakly_connected_components': 4, 'largest_wcc_size': 51, 'pagerank_top10_percent': 46.17, 'louvain_communities': 10, 'louvain_modularity': 0.5673, 'label_entropy': 1.3981, 'computational_time': 0.012780972057953477}, 'retrieval_queries': []}
2025-11-30 21:08:38,429 - src.pipeline.kg_builder - DEBUG - Batch 2 metrics: {
  "batch_idx": 2,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508118.4289882,
  "total_time": 37.55642322602216,
  "aggregation": 5.549052730202675e-06,
  "network_info": 0.007580915000289679,
  "llm_extraction": 37.353342063957825,
  "data_cleaning": 4.352908581495285e-05,
  "neo4j_injection": 0.1787323650205508,
  "embedding_time": 0,
  "indexing_time": 0.0015760600799694657,
  "graph_injection_time": 0.17682951304595917,
  "acs_metrics": {
    "node_count": 54,
    "relationship_count": 99,
    "density": 0.0346,
    "avg_degree": 3.6667,
    "avg_unique_neighbors": 3.6667,
    "global_efficiency": 0.3661,
    "avg_path_length": 2.8063,
    "avg_degree_centrality": 0.0692,
    "max_degree_centrality": 0.4151,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0025,
    "degree_assortativity": -0.3028,
    "graph_robustness": 0.8485,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.3026,
    "weakly_connected_components": 4,
    "largest_wcc_size": 51,
    "pagerank_top10_percent": 46.17,
    "louvain_communities": 10,
    "louvain_modularity": 0.5673,
    "label_entropy": 1.3981,
    "computational_time": 0.012780972057953477
  },
  "retrieval_queries": []
}
2025-11-30 21:08:38,429 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:08:38,429 - src.pipeline.kg_builder - INFO - Batch 3 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 37.35s, Clean: 0.00s, Neo4j: 0.18s, ACS: 0.01s
2025-11-30 21:08:38,429 - src.pipeline.kg_builder - INFO - Batch 3 completed in 37.56s
Processing KG batches:   4%|▍         | 3/72 [01:41<41:53, 36.43s/it]2025-11-30 21:08:38,429 - src.pipeline.kg_builder - INFO - Processing batch 4/72 (3 items)
2025-11-30 21:08:38,429 - src.pipeline.kg_builder - DEBUG - Batch 4 current_video_time: 00:54-00:59
2025-11-30 21:08:38,435 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 54
- Total Relationships: 39
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:08:38,435 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:08:38,435 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0 ~186 words, content: Time: 00:44-00:49 Content: The video sequence captures a person conducting a chemistry experiment in a laboratory setting, focusing on the preparation and documentation of a...
2025-11-30 21:08:38,435 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_1 ~240 words, content: to a wider, slightly elevated view of the laboratory. This broader shot reveals more of the workspace, including a power strip with multiple plugs, a...
2025-11-30 21:08:38,435 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_2 ~241 words, content: , and a yellow box. A person wearing blue gloves is seen handling a piece of aluminum foil, which is likely being used to cover...
2025-11-30 21:08:38,435 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3 ~164 words, content: :59 Content: The video sequence captures a person preparing to conduct a precise measurement in a laboratory setting. The scene is set in a well-equipped...
2025-11-30 21:08:38,456 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:08:38,485 - src.components.pre_llm_injector - DEBUG - Found 13 existing chunk embeddings for similarity lookup
2025-11-30 21:08:38,488 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.798'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.784')]
2025-11-30 21:08:38,490 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4 via source_chunk_ids
2025-11-30 21:08:38,490 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3 via source_chunk_ids
2025-11-30 21:08:38,490 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.726'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.699')]
2025-11-30 21:08:38,490 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.646'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.632')]
2025-11-30 21:08:38,490 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.618'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.608')]
2025-11-30 21:08:38,490 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.798'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.784')]
2025-11-30 21:08:38,490 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:08:38,490 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0) (~186 words) with timeout=5.0s retries=3
2025-11-30 21:08:40,194 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:08:40,194 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:08:40,195 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_1) (~240 words) with timeout=5.0s retries=3
2025-11-30 21:08:41,276 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:08:41,276 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:08:41,276 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_2) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:08:42,461 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:08:42,461 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:08:42,461 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3) (~164 words) with timeout=5.0s retries=3
2025-11-30 21:08:44,210 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:08:44,210 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:08:44,211 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 4 chunks
2025-11-30 21:08:44,211 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 5.78s
2025-11-30 21:08:44,211 - src.components.global_refiner - INFO - Capping refinement input: 22 → 15 triplets
2025-11-30 21:08:44,211 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.

RULE: If CONTEXT SUBGRAPHS is empty or says "No subgraph context available", set "inter_chunk_relations", "merge_instructions", and "prune_instructions" to []. ONLY add to "new_triplets" from NEW CANDIDATES. DO NOT invent IDs, entities, or relations—stick to provided data. For merges/links, match EXACT entity names/IDs from CONTEXT only.

### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
No subgraph context available
No existing entities or relations.

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["3_0", "3_3"]}, {"head": "Person", "relation": "Writes On", "tail": "Chemistry_Experiment_Report", "source_chunks": ["3_0"]}, {"head": "Chemistry_Experiment_Report", "relation": "Contains", "tail": "Chemical_Equation", "source_chunks": ["3_0"]}, {"head": "Chemical_Equation", "relation": "Describes", "tail": "Reaction_Of_Aluminum_With_Sodium_Hydroxide", "source_chunks": ["3_0"]}, {"head": "Lab_Bench", "relation": "Holds", "tail": "Test_Tube_With_Blue_Cap", "source_chunks": ["3_0"]}, {"head": "Lab_Bench", "relation": "Holds", "tail": "Ar_Headset_Case", "source_chunks": ["3_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Power Strip", "source_chunks": ["3_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Balance Scale", "source_chunks": ["3_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Lab Apparatus", "source_chunks": ["3_1"]}, {"head": "Document", "relation": "Is On", "tail": "Lab Bench", "source_chunks": ["3_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["3_1", "3_2"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Test Tube", "source_chunks": ["3_1"]}, {"head": "Person", "relation": "Handles", "tail": "Aluminum Foil", "source_chunks": ["3_2"]}, {"head": "Person", "relation": "Places", "tail": "Aluminum Foil", "source_chunks": ["3_2"]}, {"head": "Aluminum Foil", "relation": "Is Used For", "tail": "Containing Substance", "source_chunks": ["3_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:08:44,212 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~369 words, ~480 tokens)
2025-11-30 21:08:44,212 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:08:51,073 - src.components.global_refiner - DEBUG - LLM call completed in 6.86s
2025-11-30 21:08:51,073 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['3_0', '3_3']], ['Person', 'Writes On', 'Chemistry_Experiment_Report', ['3_0']], ['Chemistry_Experiment_Report', 'Contains', 'Chemical_Equation', ['3_0']], ['Chemical_Equation', 'Describes', 'Reaction_Of_Aluminum_With_Sodium_Hydroxide', ['3_0']], ['Lab_Bench', 'Holds', 'Test_Tube_With_Blue_Cap', ['3_0']], ['Lab_Bench', 'Holds', 'Ar_Headset_Case', ['3_0']], ['Laboratory', 'Contains', 'Power Strip', ['3_1']], ['Laboratory', 'Contains', 'Balance Scale', ['3_1']], ['Laboratory', 'Contains', 'Lab Apparatus', ['3_1']], ['Document', 'Is On', 'Lab Bench', ['3_1']], ['Person', 'Wears', 'Blue Gloves', ['3_1', '3_2']], ['Person', 'Handles', 'Aluminum Foil', ['3_2']], ['Person', 'Places', 'Aluminum Foil', ['3_2']], ['Aluminum Foil', 'Is Used For', 'Containing Substance', ['3_2']]] inter_chunk_relations=[] merge_instructions=[] prune_instructions=[]
2025-11-30 21:08:51,073 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=14, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['3_0', '3_3']], ['Person', 'Writes On', 'Chemistry_Experiment_Report', ['3_0']], ['Chemistry_Experiment_Report', 'Contains', 'Chemical_Equation', ['3_0']]]
2025-11-30 21:08:51,074 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=0, sample=[]
2025-11-30 21:08:51,074 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=0, sample=[]
2025-11-30 21:08:51,074 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=0, sample=[]
2025-11-30 21:08:51,074 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 14 triplets (total: 6.86s, LLM: 6.86s)
2025-11-30 21:08:51,074 - src.pipeline.kg_builder - INFO - Global refinement: 14 triplets in 6.86s
2025-11-30 21:08:51,074 - src.pipeline.kg_builder - INFO - Using 14 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:08:51,074 - src.pipeline.kg_builder - INFO - Pushing batch 4/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:08:51,074 - src.components.neo4j_handler - INFO - Adding 14 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:08:51,242 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=71, relationships=53
2025-11-30 21:08:51,243 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:08:51,251 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=71, relationships=53
2025-11-30 21:08:51,253 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:08:51,253 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:08:51,253 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:08:51,253 - src.components.neo4j_handler - INFO - Batch injected in 0.18s (triplets: 0.18s, indexes: 0.00s)
2025-11-30 21:08:51,254 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 17, 'with_embedding': 17, 'linked_chunks': 14}
2025-11-30 21:08:51,254 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:08:51,259 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 71 nodes
2025-11-30 21:08:51,262 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 68 nodes
2025-11-30 21:08:51,270 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 71, 'relationship_count': 134, 'density': 0.027, 'avg_degree': 3.7746, 'avg_unique_neighbors': 3.7746, 'global_efficiency': 0.3667, 'avg_path_length': 2.8244, 'avg_degree_centrality': 0.0539, 'max_degree_centrality': 0.4286, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0023, 'degree_assortativity': -0.298, 'graph_robustness': 0.8284, 'diameter_estimate': 4, 'clustering_coefficient': 0.3191, 'weakly_connected_components': 4, 'largest_wcc_size': 68, 'pagerank_top10_percent': 39.69, 'louvain_communities': 12, 'louvain_modularity': 0.5769, 'label_entropy': 1.3971, 'computational_time': 0.015704439021646976}
2025-11-30 21:08:51,270 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 3, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508131.2705994, 'total_time': 12.841121855075471, 'aggregation': 4.898989573121071e-06, 'network_info': 0.0058037040289491415, 'llm_extraction': 12.63886576902587, 'data_cleaning': 3.157102037221193e-05, 'neo4j_injection': 0.17923796398099512, 'embedding_time': 0, 'indexing_time': 0.0019331930670887232, 'graph_injection_time': 0.1770015659276396, 'acs_metrics': {'node_count': 71, 'relationship_count': 134, 'density': 0.027, 'avg_degree': 3.7746, 'avg_unique_neighbors': 3.7746, 'global_efficiency': 0.3667, 'avg_path_length': 2.8244, 'avg_degree_centrality': 0.0539, 'max_degree_centrality': 0.4286, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0023, 'degree_assortativity': -0.298, 'graph_robustness': 0.8284, 'diameter_estimate': 4, 'clustering_coefficient': 0.3191, 'weakly_connected_components': 4, 'largest_wcc_size': 68, 'pagerank_top10_percent': 39.69, 'louvain_communities': 12, 'louvain_modularity': 0.5769, 'label_entropy': 1.3971, 'computational_time': 0.015704439021646976}, 'retrieval_queries': []}
2025-11-30 21:08:51,270 - src.pipeline.kg_builder - DEBUG - Batch 3 metrics: {
  "batch_idx": 3,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508131.2705994,
  "total_time": 12.841121855075471,
  "aggregation": 4.898989573121071e-06,
  "network_info": 0.0058037040289491415,
  "llm_extraction": 12.63886576902587,
  "data_cleaning": 3.157102037221193e-05,
  "neo4j_injection": 0.17923796398099512,
  "embedding_time": 0,
  "indexing_time": 0.0019331930670887232,
  "graph_injection_time": 0.1770015659276396,
  "acs_metrics": {
    "node_count": 71,
    "relationship_count": 134,
    "density": 0.027,
    "avg_degree": 3.7746,
    "avg_unique_neighbors": 3.7746,
    "global_efficiency": 0.3667,
    "avg_path_length": 2.8244,
    "avg_degree_centrality": 0.0539,
    "max_degree_centrality": 0.4286,
    "avg_betweenness_centrality": 0.0002,
    "max_betweenness_centrality": 0.0023,
    "degree_assortativity": -0.298,
    "graph_robustness": 0.8284,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.3191,
    "weakly_connected_components": 4,
    "largest_wcc_size": 68,
    "pagerank_top10_percent": 39.69,
    "louvain_communities": 12,
    "louvain_modularity": 0.5769,
    "label_entropy": 1.3971,
    "computational_time": 0.015704439021646976
  },
  "retrieval_queries": []
}
2025-11-30 21:08:51,270 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:08:51,270 - src.pipeline.kg_builder - INFO - Batch 4 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 12.64s, Clean: 0.00s, Neo4j: 0.18s, ACS: 0.02s
2025-11-30 21:08:51,270 - src.pipeline.kg_builder - INFO - Batch 4 completed in 12.84s
Processing KG batches:   6%|▌         | 4/72 [01:54<30:43, 27.12s/it]2025-11-30 21:08:51,271 - src.pipeline.kg_builder - INFO - Processing batch 5/72 (3 items)
2025-11-30 21:08:51,271 - src.pipeline.kg_builder - DEBUG - Batch 5 current_video_time: 01:09-01:14
2025-11-30 21:08:51,279 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 71
- Total Relationships: 53
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:08:51,280 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:08:51,280 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_0 ~233 words, content: Time: 00:59-01:04 Content: The video sequence captures a series of actions performed by a person in a laboratory setting, focusing on the preparation of a...
2025-11-30 21:08:51,280 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_1 ~241 words, content: they continue to use the pipette. The liquid is being carefully transferred into the beaker, which is still on the balance scale. The person's movements...
2025-11-30 21:08:51,280 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_2 ~236 words, content: and safety throughout the process. The sequence of actions, from weighing the beaker to transferring the liquid and stirring it, indicates a methodical approach to...
2025-11-30 21:08:51,280 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_3 ~225 words, content: and attention to detail. The overall atmosphere is one of concentration and scientific rigor. Time: 01:09-01:14 Content: The video sequence captures a series of actions...
2025-11-30 21:08:51,280 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4 ~226 words, content: - **Frame 3:** The person's hands are now actively engaged in opening the bottle. The left hand holds the bottle while the right hand, also...
2025-11-30 21:08:51,300 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:08:51,331 - src.components.pre_llm_injector - DEBUG - Found 17 existing chunk embeddings for similarity lookup
2025-11-30 21:08:51,336 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.814'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.774')]
2025-11-30 21:08:51,337 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3
2025-11-30 21:08:51,337 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:08:51,337 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4 via source_chunk_ids
2025-11-30 21:08:51,339 - src.components.pre_llm_injector - DEBUG - Limited Person from 19 to 2 external connections
2025-11-30 21:08:51,339 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 20 total -> 3 (internal: 1, external: 2)
2025-11-30 21:08:51,339 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WEARS]->(Blue_Nitrile_Gloves / ID: 3_0), (Person / ID: 0_0)-[WEARS]->(Jeans / ID: 1_0), (Person / ID: 0_0)-[PLACES]->(Aluminum Foil / ID: 3_2)
2025-11-30 21:08:51,339 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.670'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.625')]
2025-11-30 21:08:51,339 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_2', '0.607'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.600')]
2025-11-30 21:08:51,339 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_2', '0.644'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_1', '0.596')]
2025-11-30 21:08:51,339 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.715'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.687')]
2025-11-30 21:08:51,339 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.814'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.774')]
2025-11-30 21:08:51,339 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:08:51,339 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_0) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:08:52,553 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:08:52,554 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:08:52,554 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_1) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:08:53,724 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:08:53,725 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:08:53,725 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_2) (~236 words) with timeout=5.0s retries=3
2025-11-30 21:08:54,855 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:08:54,855 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:08:54,855 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_3) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:08:56,254 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:08:56,254 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:08:56,254 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:08:59,644 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:08:59,645 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:08:59,645 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 5 chunks
2025-11-30 21:08:59,645 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 8.37s
2025-11-30 21:08:59,646 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 21:08:59,646 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[WEARS]->(Blue_Nitrile_Gloves / ID: 3_0), (Person / ID: 0_0)-[WEARS]->(Jeans / ID: 1_0), (Person / ID: 0_0)-[PLACES]->(Aluminum Foil / ID: 3_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["4_0", "4_2", "4_3"]}, {"head": "Person", "relation": "Handles", "tail": "Beaker", "source_chunks": ["4_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Balance_Scale", "source_chunks": ["4_0", "4_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["4_0", "4_1", "4_2"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["4_0"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Beaker", "source_chunks": ["4_0", "4_1"]}, {"head": "Person", "relation": "Closes", "tail": "Container", "source_chunks": ["4_1"]}, {"head": "Person", "relation": "Stirs", "tail": "Liquid", "source_chunks": ["4_1"]}, {"head": "Glass_Rod", "relation": "Is Used To Stir", "tail": "Liquid", "source_chunks": ["4_1"]}, {"head": "Person", "relation": "Uses", "tail": "Magnetic_Stirrer", "source_chunks": ["4_2"]}, {"head": "Person", "relation": "Uses", "tail": "Burette", "source_chunks": ["4_2"]}, {"head": "Person", "relation": "Uses", "tail": "Balance", "source_chunks": ["4_2"]}, {"head": "Person", "relation": "Handles", "tail": "Laboratory_Glassware", "source_chunks": ["4_2"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["4_3"]}, {"head": "Person", "relation": "Holds", "tail": "White_Bottle", "source_chunks": ["4_3"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:08:59,646 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~334 words, ~434 tokens)
2025-11-30 21:08:59,646 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:09:21,581 - src.components.global_refiner - DEBUG - LLM call completed in 21.93s
2025-11-30 21:09:21,581 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['4_0', '4_2', '4_3']], ['Person', 'Handles', 'Beaker', ['4_0']], ['Beaker', 'Is On', 'Balance_Scale', ['4_0', '4_1']], ['Person', 'Uses', 'Pipette', ['4_0', '4_1', '4_2']], ['Pipette', 'Transfers', 'Liquid', ['4_0']], ['Liquid', 'Is Transferred To', 'Beaker', ['4_0', '4_1']], ['Person', 'Closes', 'Container', ['4_1']], ['Person', 'Stirs', 'Liquid', ['4_1']], ['Glass_Rod', 'Is Used To Stir', 'Liquid', ['4_1']], ['Person', 'Uses', 'Magnetic_Stirrer', ['4_2']], ['Person', 'Uses', 'Burette', ['4_2']], ['Person', 'Uses', 'Balance', ['4_2']], ['Person', 'Handles', 'Laboratory_Glassware', ['4_2']], ['Person', 'Holds', 'Beaker', ['4_3']], ['Person', 'Holds', 'White_Bottle', ['4_3']]] inter_chunk_relations=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['4_0', '4_2', '4_3']], ['Person', 'Handles', 'Beaker', ['4_0']], ['Beaker', 'Is On', 'Balance_Scale', ['4_0', '4_1']], ['Person', 'Uses', 'Pipette', ['4_0', '4_1', '4_2']], ['Pipette', 'Transfers', 'Liquid', ['4_0']], ['Liquid', 'Is Transferred To', 'Beaker', ['4_0', '4_1']], ['Person', 'Closes', 'Container', ['4_1']], ['Person', 'Stirs', 'Liquid', ['4_1']], ['Glass_Rod', 'Is Used To Stir', 'Liquid', ['4_1']], ['Person', 'Uses', 'Magnetic_Stirrer', ['4_2']], ['Person', 'Uses', 'Burette', ['4_2']], ['Person', 'Uses', 'Balance', ['4_2']], ['Person', 'Handles', 'Laboratory_Glassware', ['4_2']], ['Person', 'Holds', 'Beaker', ['4_3']], ['Person', 'Holds', 'White_Bottle', ['4_3']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '3_0'}, {'local': 'Beaker', 'existing': 'Beaker', 'existing_id': '3_1'}, {'local': 'Balance_Scale', 'existing': 'Balance_Scale', 'existing_id': '3_3'}, {'local': 'Pipette', 'existing': 'Pipette', 'existing_id': '3_4'}, {'local': 'Liquid', 'existing': 'Liquid', 'existing_id': '3_5'}, {'local': 'Container', 'existing': 'Container', 'existing_id': '3_6'}, {'local': 'Glass_Rod', 'existing': 'Glass_Rod', 'existing_id': '3_7'}, {'local': 'Magnetic_Stirrer', 'existing': 'Magnetic_Stirrer', 'existing_id': '3_8'}, {'local': 'Burette', 'existing': 'Burette', 'existing_id': '3_9'}, {'local': 'Laboratory_Glassware', 'existing': 'Laboratory_Glassware', 'existing_id': '3_10'}, {'local': 'Beaker', 'existing': 'Beaker', 'existing_id': '3_11'}, {'local': 'White_Bottle', 'existing': 'White_Bottle', 'existing_id': '3_12'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}]
2025-11-30 21:09:21,582 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['4_0', '4_2', '4_3']], ['Person', 'Handles', 'Beaker', ['4_0']], ['Beaker', 'Is On', 'Balance_Scale', ['4_0', '4_1']]]
2025-11-30 21:09:21,582 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['4_0', '4_2', '4_3']], ['Person', 'Handles', 'Beaker', ['4_0']], ['Beaker', 'Is On', 'Balance_Scale', ['4_0', '4_1']]]
2025-11-30 21:09:21,582 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=12, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '3_0'}, {'local': 'Beaker', 'existing': 'Beaker', 'existing_id': '3_1'}, {'local': 'Balance_Scale', 'existing': 'Balance_Scale', 'existing_id': '3_3'}]
2025-11-30 21:09:21,582 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}]
2025-11-30 21:09:21,582 - src.components.global_refiner - INFO - LLM suggested 12 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '3_0'}, {'local': 'Beaker', 'existing': 'Beaker', 'existing_id': '3_1'}, {'local': 'Balance_Scale', 'existing': 'Balance_Scale', 'existing_id': '3_3'}, {'local': 'Pipette', 'existing': 'Pipette', 'existing_id': '3_4'}, {'local': 'Liquid', 'existing': 'Liquid', 'existing_id': '3_5'}, {'local': 'Container', 'existing': 'Container', 'existing_id': '3_6'}, {'local': 'Glass_Rod', 'existing': 'Glass_Rod', 'existing_id': '3_7'}, {'local': 'Magnetic_Stirrer', 'existing': 'Magnetic_Stirrer', 'existing_id': '3_8'}, {'local': 'Burette', 'existing': 'Burette', 'existing_id': '3_9'}, {'local': 'Laboratory_Glassware', 'existing': 'Laboratory_Glassware', 'existing_id': '3_10'}, {'local': 'Beaker', 'existing': 'Beaker', 'existing_id': '3_11'}, {'local': 'White_Bottle', 'existing': 'White_Bottle', 'existing_id': '3_12'}]
2025-11-30 21:09:21,582 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}]
2025-11-30 21:09:21,582 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 30 triplets (total: 21.94s, LLM: 21.93s)
2025-11-30 21:09:21,582 - src.pipeline.kg_builder - INFO - Global refinement: 30 triplets in 21.94s
2025-11-30 21:09:21,582 - src.pipeline.kg_builder - INFO - Using 30 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:09:21,582 - src.pipeline.kg_builder - INFO - Pushing batch 5/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:09:21,582 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:09:21,772 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=86, relationships=67
2025-11-30 21:09:21,772 - src.components.neo4j_handler - INFO - Applying 12 merge instructions
2025-11-30 21:09:21,772 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue_Nitrile_Gloves -> Blue_Nitrile_Gloves
2025-11-30 21:09:21,772 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Beaker -> Beaker
2025-11-30 21:09:21,772 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Balance_Scale -> Balance_Scale
2025-11-30 21:09:21,772 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Pipette -> Pipette
2025-11-30 21:09:21,772 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Liquid -> Liquid
2025-11-30 21:09:21,772 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Container -> Container
2025-11-30 21:09:21,772 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Glass_Rod -> Glass_Rod
2025-11-30 21:09:21,772 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Magnetic_Stirrer -> Magnetic_Stirrer
2025-11-30 21:09:21,772 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Burette -> Burette
2025-11-30 21:09:21,772 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Laboratory_Glassware -> Laboratory_Glassware
2025-11-30 21:09:21,772 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Beaker -> Beaker
2025-11-30 21:09:21,772 - src.components.neo4j_handler - DEBUG - Skipping self-merge: White_Bottle -> White_Bottle
2025-11-30 21:09:21,772 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:09:21,774 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:09:21,775 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:09:21,776 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:09:21,777 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:09:21,777 - src.components.neo4j_handler - INFO - Applying 15 inter-chunk relations
2025-11-30 21:09:21,778 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:09:21,779 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Handles]-> Beaker
2025-11-30 21:09:21,781 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Is On]-> Balance_Scale
2025-11-30 21:09:21,783 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> Pipette
2025-11-30 21:09:21,784 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Pipette -[Transfers]-> Liquid
2025-11-30 21:09:21,817 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Liquid -[Is Transferred To]-> Beaker
2025-11-30 21:09:21,820 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Closes]-> Container
2025-11-30 21:09:21,822 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Stirs]-> Liquid
2025-11-30 21:09:21,850 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Glass_Rod -[Is Used To Stir]-> Liquid
2025-11-30 21:09:21,852 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> Magnetic_Stirrer
2025-11-30 21:09:21,854 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> Burette
2025-11-30 21:09:21,855 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> Balance
2025-11-30 21:09:21,857 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Handles]-> Laboratory_Glassware
2025-11-30 21:09:21,858 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Beaker
2025-11-30 21:09:21,859 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> White_Bottle
2025-11-30 21:09:21,860 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:09:21,865 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=86, relationships=67
2025-11-30 21:09:21,866 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:09:21,866 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:09:21,867 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:09:21,867 - src.components.neo4j_handler - INFO - Batch injected in 0.28s (triplets: 0.28s, indexes: 0.00s)
2025-11-30 21:09:21,868 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 22, 'with_embedding': 22, 'linked_chunks': 18}
2025-11-30 21:09:21,868 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:09:21,873 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 86 nodes
2025-11-30 21:09:21,878 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 82 nodes
2025-11-30 21:09:21,888 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 86, 'relationship_count': 171, 'density': 0.0234, 'avg_degree': 3.9767, 'avg_unique_neighbors': 3.9767, 'global_efficiency': 0.3714, 'avg_path_length': 2.7296, 'avg_degree_centrality': 0.0468, 'max_degree_centrality': 0.5059, 'avg_betweenness_centrality': 0.0001, 'max_betweenness_centrality': 0.0015, 'degree_assortativity': -0.3353, 'graph_robustness': 0.8304, 'diameter_estimate': 4, 'clustering_coefficient': 0.3176, 'weakly_connected_components': 5, 'largest_wcc_size': 82, 'pagerank_top10_percent': 33.32, 'louvain_communities': 14, 'louvain_modularity': 0.5721, 'label_entropy': 1.4102, 'computational_time': 0.020527601009234786}
2025-11-30 21:09:21,888 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 4, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508161.888795, 'total_time': 30.617718236055225, 'aggregation': 3.3499673008918762e-06, 'network_info': 0.008434801013208926, 'llm_extraction': 30.30291818093974, 'data_cleaning': 3.8134981878101826e-05, 'neo4j_injection': 0.28454813500866294, 'embedding_time': 0, 'indexing_time': 0.0015468249330297112, 'graph_injection_time': 0.28268691210541874, 'acs_metrics': {'node_count': 86, 'relationship_count': 171, 'density': 0.0234, 'avg_degree': 3.9767, 'avg_unique_neighbors': 3.9767, 'global_efficiency': 0.3714, 'avg_path_length': 2.7296, 'avg_degree_centrality': 0.0468, 'max_degree_centrality': 0.5059, 'avg_betweenness_centrality': 0.0001, 'max_betweenness_centrality': 0.0015, 'degree_assortativity': -0.3353, 'graph_robustness': 0.8304, 'diameter_estimate': 4, 'clustering_coefficient': 0.3176, 'weakly_connected_components': 5, 'largest_wcc_size': 82, 'pagerank_top10_percent': 33.32, 'louvain_communities': 14, 'louvain_modularity': 0.5721, 'label_entropy': 1.4102, 'computational_time': 0.020527601009234786}, 'retrieval_queries': []}
2025-11-30 21:09:21,888 - src.pipeline.kg_builder - DEBUG - Batch 4 metrics: {
  "batch_idx": 4,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508161.888795,
  "total_time": 30.617718236055225,
  "aggregation": 3.3499673008918762e-06,
  "network_info": 0.008434801013208926,
  "llm_extraction": 30.30291818093974,
  "data_cleaning": 3.8134981878101826e-05,
  "neo4j_injection": 0.28454813500866294,
  "embedding_time": 0,
  "indexing_time": 0.0015468249330297112,
  "graph_injection_time": 0.28268691210541874,
  "acs_metrics": {
    "node_count": 86,
    "relationship_count": 171,
    "density": 0.0234,
    "avg_degree": 3.9767,
    "avg_unique_neighbors": 3.9767,
    "global_efficiency": 0.3714,
    "avg_path_length": 2.7296,
    "avg_degree_centrality": 0.0468,
    "max_degree_centrality": 0.5059,
    "avg_betweenness_centrality": 0.0001,
    "max_betweenness_centrality": 0.0015,
    "degree_assortativity": -0.3353,
    "graph_robustness": 0.8304,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.3176,
    "weakly_connected_components": 5,
    "largest_wcc_size": 82,
    "pagerank_top10_percent": 33.32,
    "louvain_communities": 14,
    "louvain_modularity": 0.5721,
    "label_entropy": 1.4102,
    "computational_time": 0.020527601009234786
  },
  "retrieval_queries": []
}
2025-11-30 21:09:21,889 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:09:21,889 - src.pipeline.kg_builder - INFO - Batch 5 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 30.30s, Clean: 0.00s, Neo4j: 0.28s, ACS: 0.02s
2025-11-30 21:09:21,889 - src.pipeline.kg_builder - INFO - Batch 5 completed in 30.62s
Processing KG batches:   7%|▋         | 5/72 [02:24<31:41, 28.38s/it]2025-11-30 21:09:21,889 - src.pipeline.kg_builder - INFO - Processing batch 6/72 (3 items)
2025-11-30 21:09:21,889 - src.pipeline.kg_builder - DEBUG - Batch 6 current_video_time: 01:24-01:29
2025-11-30 21:09:21,894 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 86
- Total Relationships: 67
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:09:21,895 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:09:21,895 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_0 ~233 words, content: Time: 01:14-01:19 Content: The video captures a sequence of actions in a laboratory setting, focusing on a person preparing a chemical experiment. The scene is...
2025-11-30 21:09:21,895 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1 ~228 words, content: , star-shaped component at the top, which is connected by tubing to the beaker on the stirrer. This suggests a setup for a reaction that...
2025-11-30 21:09:21,895 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_2 ~203 words, content: - **Frame 2:** The scene shifts to a different area of the lab. A person, wearing a beige sweater, is holding a white plastic bottle....
2025-11-30 21:09:21,895 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_3 ~209 words, content: a well-organized laboratory with a glass-fronted storage cabinet filled with various chemicals and reagents. The overall environment is clean and orderly. In summary, the video...
2025-11-30 21:09:21,895 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_4 ~205 words, content: and can cause severe skin burns and eye damage. The background shows a laboratory environment with a glass-enclosed storage cabinet, a door, and a workbench....
2025-11-30 21:09:21,895 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_5 ~113 words, content: the bottle. The powder is then carefully transferred into a small, clear glass beaker that is resting on a digital balance scale. This indicates that...
2025-11-30 21:09:21,916 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:09:21,955 - src.components.pre_llm_injector - DEBUG - Found 22 existing chunk embeddings for similarity lookup
2025-11-30 21:09:21,962 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4', '0.797'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.758')]
2025-11-30 21:09:21,964 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4 via source_chunk_ids
2025-11-30 21:09:21,964 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4 via source_chunk_ids
2025-11-30 21:09:21,964 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.722'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_0', '0.715')]
2025-11-30 21:09:21,964 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_0', '0.732'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.725')]
2025-11-30 21:09:21,964 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.540'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_3', '0.522')]
2025-11-30 21:09:21,964 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_1', '0.510'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.493')]
2025-11-30 21:09:21,964 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.655'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_3', '0.655')]
2025-11-30 21:09:21,964 - src.components.pre_llm_injector - DEBUG - Chunk 5 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4', '0.797'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.758')]
2025-11-30 21:09:21,964 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:09:21,964 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_0) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:09:23,475 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:09:23,475 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:09:23,475 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1) (~228 words) with timeout=5.0s retries=3
2025-11-30 21:09:28,482 - src.components.pre_llm_injector - WARNING - Chunk 1 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 21:09:30,236 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 2)
2025-11-30 21:09:30,236 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:09:30,236 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_2) (~203 words) with timeout=5.0s retries=3
2025-11-30 21:09:31,581 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:09:31,581 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:09:31,582 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_3) (~209 words) with timeout=5.0s retries=3
2025-11-30 21:09:33,358 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:09:33,358 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:09:33,358 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_4) (~205 words) with timeout=5.0s retries=3
2025-11-30 21:09:34,581 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:09:34,582 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:09:34,582 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_5) (~113 words) with timeout=5.0s retries=3
2025-11-30 21:09:36,035 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:09:36,035 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:09:36,035 - src.components.pre_llm_injector - INFO - Extracted 34 local triplets from 6 chunks
2025-11-30 21:09:36,035 - src.pipeline.kg_builder - INFO - Pre-extraction: 34 triplets in 14.14s
2025-11-30 21:09:36,035 - src.components.global_refiner - INFO - Capping refinement input: 34 → 15 triplets
2025-11-30 21:09:36,035 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.

RULE: If CONTEXT SUBGRAPHS is empty or says "No subgraph context available", set "inter_chunk_relations", "merge_instructions", and "prune_instructions" to []. ONLY add to "new_triplets" from NEW CANDIDATES. DO NOT invent IDs, entities, or relations—stick to provided data. For merges/links, match EXACT entity names/IDs from CONTEXT only.

### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
No subgraph context available
No existing entities or relations.

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["5_0", "5_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Rod", "source_chunks": ["5_0"]}, {"head": "Glass_Rod", "relation": "Stirs", "tail": "Liquid_In_Small_Container", "source_chunks": ["5_0"]}, {"head": "Magnetic_Stirrer", "relation": "Contains", "tail": "Beaker", "source_chunks": ["5_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["5_0"]}, {"head": "Magnetic_Stirrer", "relation": "Rotates", "tail": "Magnetic_Stir_Bar", "source_chunks": ["5_0"]}, {"head": "Person", "relation": "Interacts With", "tail": "Equipment", "source_chunks": ["5_1"]}, {"head": "Equipment", "relation": "Contains", "tail": "Magnetic_Stirrer", "source_chunks": ["5_1"]}, {"head": "Magnetic_Stirrer", "relation": "Holds", "tail": "Beaker", "source_chunks": ["5_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["5_1"]}, {"head": "Liquid", "relation": "Is Part Of", "tail": "Chemical_Solution", "source_chunks": ["5_1"]}, {"head": "Person", "relation": "Wears", "tail": "Beige Sweater", "source_chunks": ["5_2"]}, {"head": "Person", "relation": "Holds", "tail": "White Plastic Bottle", "source_chunks": ["5_2"]}, {"head": "White Plastic Bottle", "relation": "Has Label", "tail": "Sodium Hydroxide", "source_chunks": ["5_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["5_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:09:36,035 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~364 words, ~473 tokens)
2025-11-30 21:09:36,035 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:09:42,780 - src.components.global_refiner - DEBUG - LLM call completed in 6.74s
2025-11-30 21:09:42,780 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Glove', ['5_0']], ['Person', 'Holds', 'Glass_Rod', ['5_0']], ['Glass_Rod', 'Stirs', 'Liquid_In_Small_Container', ['5_0']], ['Magnetic_Stirrer', 'Contains', 'Beaker', ['5_0']], ['Beaker', 'Contains', 'Clear_Liquid', ['5_0']], ['Magnetic_Stirrer', 'Rotates', 'Magnetic_Stir_Bar', ['5_0']], ['Person', 'Interacts With', 'Equipment', ['5_1']], ['Equipment', 'Contains', 'Magnetic_Stirrer', ['5_1']], ['Magnetic_Stirrer', 'Holds', 'Beaker', ['5_1']], ['Beaker', 'Contains', 'Liquid', ['5_1']], ['Liquid', 'Is Part Of', 'Chemical_Solution', ['5_1']], ['Person', 'Wears', 'Beige Sweater', ['5_2']], ['Person', 'Holds', 'White Plastic Bottle', ['5_2']], ['White Plastic Bottle', 'Has Label', 'Sodium Hydroxide', ['5_2']], ['Person', 'Wears', 'Blue Gloves', ['5_2']]] inter_chunk_relations=[] merge_instructions=[] prune_instructions=[]
2025-11-30 21:09:42,780 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Glove', ['5_0']], ['Person', 'Holds', 'Glass_Rod', ['5_0']], ['Glass_Rod', 'Stirs', 'Liquid_In_Small_Container', ['5_0']]]
2025-11-30 21:09:42,780 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=0, sample=[]
2025-11-30 21:09:42,780 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=0, sample=[]
2025-11-30 21:09:42,780 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=0, sample=[]
2025-11-30 21:09:42,780 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 15 triplets (total: 6.74s, LLM: 6.74s)
2025-11-30 21:09:42,780 - src.pipeline.kg_builder - INFO - Global refinement: 15 triplets in 6.74s
2025-11-30 21:09:42,780 - src.pipeline.kg_builder - INFO - Using 15 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:09:42,780 - src.pipeline.kg_builder - INFO - Pushing batch 6/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:09:42,781 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:09:42,960 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=100, relationships=81
2025-11-30 21:09:42,961 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:09:42,966 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=100, relationships=81
2025-11-30 21:09:42,968 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:09:42,968 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:09:42,969 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:09:42,969 - src.components.neo4j_handler - INFO - Batch injected in 0.19s (triplets: 0.19s, indexes: 0.00s)
2025-11-30 21:09:42,970 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 28, 'with_embedding': 28, 'linked_chunks': 21}
2025-11-30 21:09:42,970 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:09:42,980 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 100 nodes
2025-11-30 21:09:42,988 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 93 nodes
2025-11-30 21:09:43,004 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 100, 'relationship_count': 203, 'density': 0.0205, 'avg_degree': 4.06, 'avg_unique_neighbors': 4.04, 'global_efficiency': 0.354, 'avg_path_length': 2.7115, 'avg_degree_centrality': 0.041, 'max_degree_centrality': 0.5152, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0048, 'degree_assortativity': -0.325, 'graph_robustness': 0.8128, 'diameter_estimate': 4, 'clustering_coefficient': 0.3087, 'weakly_connected_components': 8, 'largest_wcc_size': 93, 'pagerank_top10_percent': 29.08, 'louvain_communities': 15, 'louvain_modularity': 0.5518, 'label_entropy': 1.4277, 'computational_time': 0.03395209496375173}
2025-11-30 21:09:43,004 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 5, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508183.0047963, 'total_time': 21.115496159996837, 'aggregation': 4.829023964703083e-06, 'network_info': 0.0055727059952914715, 'llm_extraction': 20.885738588985987, 'data_cleaning': 3.462890163064003e-05, 'neo4j_injection': 0.18835813202895224, 'embedding_time': 0, 'indexing_time': 0.002212263992987573, 'graph_injection_time': 0.1857897749869153, 'acs_metrics': {'node_count': 100, 'relationship_count': 203, 'density': 0.0205, 'avg_degree': 4.06, 'avg_unique_neighbors': 4.04, 'global_efficiency': 0.354, 'avg_path_length': 2.7115, 'avg_degree_centrality': 0.041, 'max_degree_centrality': 0.5152, 'avg_betweenness_centrality': 0.0002, 'max_betweenness_centrality': 0.0048, 'degree_assortativity': -0.325, 'graph_robustness': 0.8128, 'diameter_estimate': 4, 'clustering_coefficient': 0.3087, 'weakly_connected_components': 8, 'largest_wcc_size': 93, 'pagerank_top10_percent': 29.08, 'louvain_communities': 15, 'louvain_modularity': 0.5518, 'label_entropy': 1.4277, 'computational_time': 0.03395209496375173}, 'retrieval_queries': []}
2025-11-30 21:09:43,004 - src.pipeline.kg_builder - DEBUG - Batch 5 metrics: {
  "batch_idx": 5,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508183.0047963,
  "total_time": 21.115496159996837,
  "aggregation": 4.829023964703083e-06,
  "network_info": 0.0055727059952914715,
  "llm_extraction": 20.885738588985987,
  "data_cleaning": 3.462890163064003e-05,
  "neo4j_injection": 0.18835813202895224,
  "embedding_time": 0,
  "indexing_time": 0.002212263992987573,
  "graph_injection_time": 0.1857897749869153,
  "acs_metrics": {
    "node_count": 100,
    "relationship_count": 203,
    "density": 0.0205,
    "avg_degree": 4.06,
    "avg_unique_neighbors": 4.04,
    "global_efficiency": 0.354,
    "avg_path_length": 2.7115,
    "avg_degree_centrality": 0.041,
    "max_degree_centrality": 0.5152,
    "avg_betweenness_centrality": 0.0002,
    "max_betweenness_centrality": 0.0048,
    "degree_assortativity": -0.325,
    "graph_robustness": 0.8128,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.3087,
    "weakly_connected_components": 8,
    "largest_wcc_size": 93,
    "pagerank_top10_percent": 29.08,
    "louvain_communities": 15,
    "louvain_modularity": 0.5518,
    "label_entropy": 1.4277,
    "computational_time": 0.03395209496375173
  },
  "retrieval_queries": []
}
2025-11-30 21:09:43,005 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:09:43,005 - src.pipeline.kg_builder - INFO - Batch 6 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 20.89s, Clean: 0.00s, Neo4j: 0.19s, ACS: 0.03s
2025-11-30 21:09:43,005 - src.pipeline.kg_builder - INFO - Batch 6 completed in 21.12s
Processing KG batches:   8%|▊         | 6/72 [02:45<28:30, 25.91s/it]2025-11-30 21:09:43,005 - src.pipeline.kg_builder - INFO - Processing batch 7/72 (3 items)
2025-11-30 21:09:43,005 - src.pipeline.kg_builder - DEBUG - Batch 7 current_video_time: 01:39-01:44
2025-11-30 21:09:43,013 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 100
- Total Relationships: 81
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:09:43,014 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:09:43,014 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_0 ~214 words, content: Time: 01:29-01:34 Content: The video sequence captures a scientific procedure, likely a chemical experiment, taking place in a laboratory setting. The perspective is first-person, showing...
2025-11-30 21:09:43,014 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_1 ~218 words, content: **Preparation for Addition:** The experimenter holds the white bottle, which is labeled as a "GENERAL REAGENT" and has hazard symbols, indicating it contains a chemical...
2025-11-30 21:09:43,014 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2 ~221 words, content: opens the glass enclosure of the balance scale. They then use a small metal spatula to carefully scoop a white, powdery substance from the bottle....
2025-11-30 21:09:43,014 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_3 ~132 words, content: substance being added. - **Procedure:** The person uses a small metal spatula to scoop the powder from the bottle. The action is deliberate and controlled,...
2025-11-30 21:09:43,040 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:09:43,076 - src.components.pre_llm_injector - DEBUG - Found 28 existing chunk embeddings for similarity lookup
2025-11-30 21:09:43,082 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.804'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.789')]
2025-11-30 21:09:43,084 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3
2025-11-30 21:09:43,084 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:09:43,084 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3 via source_chunk_ids
2025-11-30 21:09:43,086 - src.components.pre_llm_injector - DEBUG - Limited Person from 34 to 2 external connections
2025-11-30 21:09:43,086 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 35 total -> 3 (internal: 1, external: 2)
2025-11-30 21:09:43,086 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WEARS]->(Blue_Nitrile_Gloves / ID: 3_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2)
2025-11-30 21:09:43,086 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_3', '0.640'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.597')]
2025-11-30 21:09:43,086 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_3', '0.651'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.622')]
2025-11-30 21:09:43,086 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.691'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_4', '0.676')]
2025-11-30 21:09:43,086 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.804'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.789')]
2025-11-30 21:09:43,086 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:09:43,086 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_0) (~214 words) with timeout=5.0s retries=3
2025-11-30 21:09:44,621 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:09:44,621 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:09:44,621 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_1) (~218 words) with timeout=5.0s retries=3
2025-11-30 21:09:45,871 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:09:45,871 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:09:45,871 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2) (~221 words) with timeout=5.0s retries=3
2025-11-30 21:09:47,292 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:09:47,292 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:09:47,292 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_3) (~132 words) with timeout=5.0s retries=3
2025-11-30 21:09:48,262 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:09:48,262 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:09:48,262 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 4 chunks
2025-11-30 21:09:48,262 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 5.25s
2025-11-30 21:09:48,262 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 21:09:48,263 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[WEARS]->(Blue_Nitrile_Gloves / ID: 3_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Experimenter", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["6_0"]}, {"head": "Experimenter", "relation": "Holds", "tail": "White Bottle", "source_chunks": ["6_0", "6_1"]}, {"head": "White Bottle", "relation": "Contains", "tail": "White Solid Substance", "source_chunks": ["6_0"]}, {"head": "Beaker", "relation": "Is Placed On", "tail": "Precision Balance", "source_chunks": ["6_0"]}, {"head": "Precision Balance", "relation": "Displays", "tail": "56.303 G", "source_chunks": ["6_0"]}, {"head": "Experimenter", "relation": "Tares", "tail": "Precision Balance", "source_chunks": ["6_0"]}, {"head": "White Bottle", "relation": "Contains", "tail": "General Reagent", "source_chunks": ["6_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Precision Balance", "source_chunks": ["6_1"]}, {"head": "Experimenter", "relation": "Opens", "tail": "Balance Scale Enclosure", "source_chunks": ["6_1"]}, {"head": "Person", "relation": "Observes", "tail": "Laboratory", "source_chunks": ["6_1"]}, {"head": "Beaker", "relation": "Is Positioned On", "tail": "Precision Balance", "source_chunks": ["6_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["6_2"]}, {"head": "Person", "relation": "Opens", "tail": "Glass_Enclosure", "source_chunks": ["6_2"]}, {"head": "Person", "relation": "Uses", "tail": "Metal_Spatula", "source_chunks": ["6_2"]}, {"head": "Person", "relation": "Transfers", "tail": "White_Powdery_Substance", "source_chunks": ["6_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:09:48,263 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~343 words, ~446 tokens)
2025-11-30 21:09:48,263 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:10:05,824 - src.components.global_refiner - DEBUG - LLM call completed in 17.56s
2025-11-30 21:10:05,824 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Experimenter', 'Wears', 'Blue Nitrile Gloves', ['6_0']], ['Experimenter', 'Holds', 'White Bottle', ['6_0', '6_1']], ['White Bottle', 'Contains', 'White Solid Substance', ['6_0']], ['Beaker', 'Is Placed On', 'Precision Balance', ['6_0']], ['Precision Balance', 'Displays', '56.303 G', ['6_0']], ['Experimenter', 'Tares', 'Precision Balance', ['6_0']], ['White Bottle', 'Contains', 'General Reagent', ['6_1']], ['Beaker', 'Is On', 'Precision Balance', ['6_1']], ['Experimenter', 'Opens', 'Balance Scale Enclosure', ['6_1']], ['Person', 'Observes', 'Laboratory', ['6_1']], ['Beaker', 'Is Positioned On', 'Precision Balance', ['6_1']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['6_2']], ['Person', 'Opens', 'Glass_Enclosure', ['6_2']], ['Person', 'Uses', 'Metal_Spatula', ['6_2']], ['Person', 'Transfers', 'White_Powdery_Substance', ['6_2']]] inter_chunk_relations=[['Experimenter', 'Wears', 'Blue_Nitrile_Gloves', ['6_0']], ['Experimenter', 'Holds', 'White Bottle', ['6_0', '6_1']], ['Beaker', 'Is Placed On', 'Precision Balance', ['6_0']], ['Precision Balance', 'Displays', '56.303 G', ['6_0']], ['Experimenter', 'Tares', 'Precision Balance', ['6_0']], ['Beaker', 'Is On', 'Precision Balance', ['6_1']], ['Experimenter', 'Opens', 'Balance Scale Enclosure', ['6_1']], ['Person', 'Observes', 'Laboratory', ['6_1']], ['Beaker', 'Is Positioned On', 'Precision Balance', ['6_1']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['6_2']], ['Person', 'Opens', 'Glass_Enclosure', ['6_2']], ['Person', 'Uses', 'Metal_Spatula', ['6_2']], ['Person', 'Transfers', 'White_Powdery_Substance', ['6_2']]] merge_instructions=[{'local': 'Experimenter', 'existing': 'Person', 'existing_id': '0_0'}, {'local': 'White Bottle', 'existing': 'Equipment', 'existing_id': '1_0'}, {'local': 'Beaker', 'existing': 'Laboratory_Glassware', 'existing_id': '4_2'}, {'local': 'Precision Balance', 'existing': 'Equipment', 'existing_id': '1_0'}] prune_instructions=[{'head': 'Experimenter', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Observes', 'tail': 'Laboratory'}, {'head': 'Person', 'relation': 'Opens', 'tail': 'Glass_Enclosure'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Metal_Spatula'}, {'head': 'Person', 'relation': 'Transfers', 'tail': 'White_Powdery_Substance'}]
2025-11-30 21:10:05,824 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Experimenter', 'Wears', 'Blue Nitrile Gloves', ['6_0']], ['Experimenter', 'Holds', 'White Bottle', ['6_0', '6_1']], ['White Bottle', 'Contains', 'White Solid Substance', ['6_0']]]
2025-11-30 21:10:05,824 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=13, sample=[['Experimenter', 'Wears', 'Blue_Nitrile_Gloves', ['6_0']], ['Experimenter', 'Holds', 'White Bottle', ['6_0', '6_1']], ['Beaker', 'Is Placed On', 'Precision Balance', ['6_0']]]
2025-11-30 21:10:05,824 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Experimenter', 'existing': 'Person', 'existing_id': '0_0'}, {'local': 'White Bottle', 'existing': 'Equipment', 'existing_id': '1_0'}, {'local': 'Beaker', 'existing': 'Laboratory_Glassware', 'existing_id': '4_2'}]
2025-11-30 21:10:05,825 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=6, sample=[{'head': 'Experimenter', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Observes', 'tail': 'Laboratory'}]
2025-11-30 21:10:05,825 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Experimenter', 'existing': 'Person', 'existing_id': '0_0'}, {'local': 'White Bottle', 'existing': 'Equipment', 'existing_id': '1_0'}, {'local': 'Beaker', 'existing': 'Laboratory_Glassware', 'existing_id': '4_2'}, {'local': 'Precision Balance', 'existing': 'Equipment', 'existing_id': '1_0'}]
2025-11-30 21:10:05,825 - src.components.global_refiner - INFO - LLM suggested 6 triplets to prune: [{'head': 'Experimenter', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Observes', 'tail': 'Laboratory'}, {'head': 'Person', 'relation': 'Opens', 'tail': 'Glass_Enclosure'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Metal_Spatula'}, {'head': 'Person', 'relation': 'Transfers', 'tail': 'White_Powdery_Substance'}]
2025-11-30 21:10:05,825 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 28 triplets (total: 17.56s, LLM: 17.56s)
2025-11-30 21:10:05,825 - src.pipeline.kg_builder - INFO - Global refinement: 28 triplets in 17.56s
2025-11-30 21:10:05,825 - src.pipeline.kg_builder - INFO - Using 28 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:10:05,825 - src.pipeline.kg_builder - INFO - Pushing batch 7/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:10:05,825 - src.components.neo4j_handler - INFO - Adding 16 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:10:06,100 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=113, relationships=96
2025-11-30 21:10:06,100 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:10:06,101 - src.components.neo4j_handler - DEBUG - APOC merge successful: Experimenter -> Person
2025-11-30 21:10:06,106 - src.components.neo4j_handler - DEBUG - APOC merge successful: White Bottle -> Equipment
2025-11-30 21:10:06,109 - src.components.neo4j_handler - DEBUG - APOC merge successful: Beaker -> Laboratory_Glassware
2025-11-30 21:10:06,113 - src.components.neo4j_handler - DEBUG - APOC merge successful: Precision Balance -> Equipment
2025-11-30 21:10:06,113 - src.components.neo4j_handler - INFO - Applying 6 prune instructions
2025-11-30 21:10:06,116 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Experimenter -[Wears]-> Blue Nitrile Gloves
2025-11-30 21:10:06,117 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:10:06,119 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Observes]-> Laboratory
2025-11-30 21:10:06,120 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Opens]-> Glass_Enclosure
2025-11-30 21:10:06,124 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Uses]-> Metal_Spatula
2025-11-30 21:10:06,125 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Transfers]-> White_Powdery_Substance
2025-11-30 21:10:06,125 - src.components.neo4j_handler - INFO - Applying 13 inter-chunk relations
2025-11-30 21:10:06,126 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Experimenter -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:10:06,157 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Experimenter -[Holds]-> White Bottle
2025-11-30 21:10:06,158 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Is Placed On]-> Precision Balance
2025-11-30 21:10:06,158 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Precision Balance -[Displays]-> 56.303 G
2025-11-30 21:10:06,159 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Experimenter -[Tares]-> Precision Balance
2025-11-30 21:10:06,159 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Is On]-> Precision Balance
2025-11-30 21:10:06,183 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Experimenter -[Opens]-> Balance Scale Enclosure
2025-11-30 21:10:06,186 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Observes]-> Laboratory
2025-11-30 21:10:06,210 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Is Positioned On]-> Precision Balance
2025-11-30 21:10:06,212 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:10:06,213 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Opens]-> Glass_Enclosure
2025-11-30 21:10:06,214 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> Metal_Spatula
2025-11-30 21:10:06,216 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Transfers]-> White_Powdery_Substance
2025-11-30 21:10:06,217 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:10:06,221 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=109, relationships=95
2025-11-30 21:10:06,222 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:10:06,223 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:10:06,223 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:10:06,223 - src.components.neo4j_handler - INFO - Batch injected in 0.40s (triplets: 0.40s, indexes: 0.00s)
2025-11-30 21:10:06,224 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 32, 'with_embedding': 32, 'linked_chunks': 24}
2025-11-30 21:10:06,224 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:10:06,235 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 109 nodes
2025-11-30 21:10:06,247 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 101 nodes
2025-11-30 21:10:06,267 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 109, 'relationship_count': 229, 'density': 0.0195, 'avg_degree': 4.2018, 'avg_unique_neighbors': 4.1835, 'global_efficiency': 0.3559, 'avg_path_length': 2.6661, 'avg_degree_centrality': 0.0389, 'max_degree_centrality': 0.537, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0078, 'degree_assortativity': -0.3304, 'graph_robustness': 0.8734, 'diameter_estimate': 4, 'clustering_coefficient': 0.3131, 'weakly_connected_components': 9, 'largest_wcc_size': 101, 'pagerank_top10_percent': 25.88, 'louvain_communities': 16, 'louvain_modularity': 0.5343, 'label_entropy': 1.4366, 'computational_time': 0.043009478016756475}
2025-11-30 21:10:06,267 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 6, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508206.2675052, 'total_time': 23.26205691008363, 'aggregation': 3.4800032153725624e-06, 'network_info': 0.008349362993612885, 'llm_extraction': 22.81111452798359, 'data_cleaning': 1.6035046428442e-05, 'neo4j_injection': 0.3981838959734887, 'embedding_time': 0, 'indexing_time': 0.0013975020265206695, 'graph_injection_time': 0.39657677500508726, 'acs_metrics': {'node_count': 109, 'relationship_count': 229, 'density': 0.0195, 'avg_degree': 4.2018, 'avg_unique_neighbors': 4.1835, 'global_efficiency': 0.3559, 'avg_path_length': 2.6661, 'avg_degree_centrality': 0.0389, 'max_degree_centrality': 0.537, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0078, 'degree_assortativity': -0.3304, 'graph_robustness': 0.8734, 'diameter_estimate': 4, 'clustering_coefficient': 0.3131, 'weakly_connected_components': 9, 'largest_wcc_size': 101, 'pagerank_top10_percent': 25.88, 'louvain_communities': 16, 'louvain_modularity': 0.5343, 'label_entropy': 1.4366, 'computational_time': 0.043009478016756475}, 'retrieval_queries': []}
2025-11-30 21:10:06,267 - src.pipeline.kg_builder - DEBUG - Batch 6 metrics: {
  "batch_idx": 6,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508206.2675052,
  "total_time": 23.26205691008363,
  "aggregation": 3.4800032153725624e-06,
  "network_info": 0.008349362993612885,
  "llm_extraction": 22.81111452798359,
  "data_cleaning": 1.6035046428442e-05,
  "neo4j_injection": 0.3981838959734887,
  "embedding_time": 0,
  "indexing_time": 0.0013975020265206695,
  "graph_injection_time": 0.39657677500508726,
  "acs_metrics": {
    "node_count": 109,
    "relationship_count": 229,
    "density": 0.0195,
    "avg_degree": 4.2018,
    "avg_unique_neighbors": 4.1835,
    "global_efficiency": 0.3559,
    "avg_path_length": 2.6661,
    "avg_degree_centrality": 0.0389,
    "max_degree_centrality": 0.537,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0078,
    "degree_assortativity": -0.3304,
    "graph_robustness": 0.8734,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.3131,
    "weakly_connected_components": 9,
    "largest_wcc_size": 101,
    "pagerank_top10_percent": 25.88,
    "louvain_communities": 16,
    "louvain_modularity": 0.5343,
    "label_entropy": 1.4366,
    "computational_time": 0.043009478016756475
  },
  "retrieval_queries": []
}
2025-11-30 21:10:06,268 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:10:06,268 - src.pipeline.kg_builder - INFO - Batch 7 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 22.81s, Clean: 0.00s, Neo4j: 0.40s, ACS: 0.04s
2025-11-30 21:10:06,268 - src.pipeline.kg_builder - INFO - Batch 7 completed in 23.26s
Processing KG batches:  10%|▉         | 7/72 [03:09<27:07, 25.04s/it]2025-11-30 21:10:06,268 - src.pipeline.kg_builder - INFO - Processing batch 8/72 (3 items)
2025-11-30 21:10:06,268 - src.pipeline.kg_builder - DEBUG - Batch 8 current_video_time: 01:54-01:59
2025-11-30 21:10:06,275 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 109
- Total Relationships: 95
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:10:06,275 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:10:06,275 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_0 ~236 words, content: Time: 01:44-01:49 Content: The video shows a person in a laboratory setting performing a precise measurement. The scene is viewed from a first-person perspective, focusing...
2025-11-30 21:10:06,275 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_1 ~229 words, content: from air currents. The person uses a small metal spatula to scoop the powder from a white container with a red lid. The powder is...
2025-11-30 21:10:06,275 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2 ~91 words, content: , indicating a need for accuracy. - **Environment:** The scene is a laboratory, identifiable by the workbench, cabinets, and a fire extinguisher visible in the...
2025-11-30 21:10:06,301 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:10:06,332 - src.components.pre_llm_injector - DEBUG - Found 32 existing chunk embeddings for similarity lookup
2025-11-30 21:10:06,338 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.822'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.799')]
2025-11-30 21:10:06,339 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3
2025-11-30 21:10:06,339 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:10:06,340 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4 via source_chunk_ids
2025-11-30 21:10:06,342 - src.components.pre_llm_injector - DEBUG - Limited Person from 42 to 2 external connections
2025-11-30 21:10:06,342 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 43 total -> 3 (internal: 1, external: 2)
2025-11-30 21:10:06,342 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WEARS]->(Blue_Nitrile_Gloves / ID: 3_0), (Person / ID: 0_0)-[WEARS]->(Jeans / ID: 1_0), (Person / ID: 0_0)-[HOLDS]->(White_Bottle / ID: 4_3)
2025-11-30 21:10:06,342 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_0', '0.525'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_1', '0.505')]
2025-11-30 21:10:06,342 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.665'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_1', '0.632')]
2025-11-30 21:10:06,342 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.822'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.799')]
2025-11-30 21:10:06,343 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:10:06,343 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_0) (~236 words) with timeout=5.0s retries=3
2025-11-30 21:10:07,710 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:10:07,710 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:10:07,711 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_1) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:10:08,865 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:10:08,865 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:10:08,865 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2) (~91 words) with timeout=5.0s retries=3
2025-11-30 21:10:10,011 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:10:10,011 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:10:10,011 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 3 chunks
2025-11-30 21:10:10,011 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 3.74s
2025-11-30 21:10:10,012 - src.components.global_refiner - INFO - Capping refinement input: 17 → 15 triplets
2025-11-30 21:10:10,012 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[WEARS]->(Blue_Nitrile_Gloves / ID: 3_0), (Person / ID: 0_0)-[WEARS]->(Jeans / ID: 1_0), (Person / ID: 0_0)-[HOLDS]->(White_Bottle / ID: 4_3)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["7_0", "7_1"]}, {"head": "Person", "relation": "Holds", "tail": "White_Plastic_Bottle", "source_chunks": ["7_0"]}, {"head": "Person", "relation": "Uses", "tail": "Metal_Spatula", "source_chunks": ["7_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Beaker", "source_chunks": ["7_0"]}, {"head": "Glass_Beaker", "relation": "Is On", "tail": "Balance_Scale", "source_chunks": ["7_0"]}, {"head": "Balance_Scale", "relation": "Is Inside", "tail": "Glass_Draft_Shield", "source_chunks": ["7_0"]}, {"head": "Person", "relation": "Holds", "tail": "Container", "source_chunks": ["7_1"]}, {"head": "Person", "relation": "Uses", "tail": "Spatula", "source_chunks": ["7_1"]}, {"head": "Spatula", "relation": "Transfers", "tail": "Powder", "source_chunks": ["7_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Powder", "source_chunks": ["7_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Scale_Platform", "source_chunks": ["7_1"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["7_2"]}, {"head": "Person", "relation": "Performs", "tail": "Weighing_By_Difference", "source_chunks": ["7_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Workbench", "source_chunks": ["7_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Cabinets", "source_chunks": ["7_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:10:10,012 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~325 words, ~422 tokens)
2025-11-30 21:10:10,012 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:10:23,242 - src.components.global_refiner - DEBUG - LLM call completed in 13.23s
2025-11-30 21:10:23,242 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['7_0', '7_1']], ['Person', 'Holds', 'White_Plastic_Bottle', ['7_0']], ['Person', 'Uses', 'Metal_Spatula', ['7_0']], ['Person', 'Holds', 'Glass_Beaker', ['7_0']], ['Glass_Beaker', 'Is On', 'Balance_Scale', ['7_0']], ['Balance_Scale', 'Is Inside', 'Glass_Draft_Shield', ['7_0']], ['Person', 'Holds', 'Container', ['7_1']], ['Person', 'Uses', 'Spatula', ['7_1']], ['Spatula', 'Transfers', 'Powder', ['7_1']], ['Beaker', 'Contains', 'Powder', ['7_1']], ['Beaker', 'Is On', 'Scale_Platform', ['7_1']], ['Person', 'Wears', 'Watch', ['7_2']], ['Person', 'Performs', 'Weighing_By_Difference', ['7_2']], ['Laboratory', 'Contains', 'Workbench', ['7_2']], ['Laboratory', 'Contains', 'Cabinets', ['7_2']]] inter_chunk_relations=[['Glass_Beaker', 'Is On', 'Balance_Scale', ['7_0']], ['Balance_Scale', 'Is Inside', 'Glass_Draft_Shield', ['7_0']], ['Beaker', 'Is On', 'Scale_Platform', ['7_1']], ['Person', 'Wears', 'Watch', ['7_2']], ['Laboratory', 'Contains', 'Workbench', ['7_2']], ['Laboratory', 'Contains', 'Cabinets', ['7_2']]] merge_instructions=[{'local': 'White_Plastic_Bottle', 'existing': 'White_Bottle', 'existing_id': '4_3'}, {'local': 'Spatula', 'existing': 'Metal_Spatula', 'existing_id': '3_1'}, {'local': 'Beaker', 'existing': 'Glass_Beaker', 'existing_id': '2_0'}, {'local': 'Powder', 'existing': 'Powder', 'existing_id': '5_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'White_Bottle'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Glass_Beaker'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Container'}]
2025-11-30 21:10:23,243 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['7_0', '7_1']], ['Person', 'Holds', 'White_Plastic_Bottle', ['7_0']], ['Person', 'Uses', 'Metal_Spatula', ['7_0']]]
2025-11-30 21:10:23,243 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=6, sample=[['Glass_Beaker', 'Is On', 'Balance_Scale', ['7_0']], ['Balance_Scale', 'Is Inside', 'Glass_Draft_Shield', ['7_0']], ['Beaker', 'Is On', 'Scale_Platform', ['7_1']]]
2025-11-30 21:10:23,243 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'White_Plastic_Bottle', 'existing': 'White_Bottle', 'existing_id': '4_3'}, {'local': 'Spatula', 'existing': 'Metal_Spatula', 'existing_id': '3_1'}, {'local': 'Beaker', 'existing': 'Glass_Beaker', 'existing_id': '2_0'}]
2025-11-30 21:10:23,243 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'White_Bottle'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Glass_Beaker'}]
2025-11-30 21:10:23,243 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'White_Plastic_Bottle', 'existing': 'White_Bottle', 'existing_id': '4_3'}, {'local': 'Spatula', 'existing': 'Metal_Spatula', 'existing_id': '3_1'}, {'local': 'Beaker', 'existing': 'Glass_Beaker', 'existing_id': '2_0'}, {'local': 'Powder', 'existing': 'Powder', 'existing_id': '5_0'}]
2025-11-30 21:10:23,243 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'White_Bottle'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Glass_Beaker'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Container'}]
2025-11-30 21:10:23,243 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 21 triplets (total: 13.23s, LLM: 13.23s)
2025-11-30 21:10:23,243 - src.pipeline.kg_builder - INFO - Global refinement: 21 triplets in 13.23s
2025-11-30 21:10:23,243 - src.pipeline.kg_builder - INFO - Using 21 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:10:23,243 - src.pipeline.kg_builder - INFO - Pushing batch 8/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:10:23,243 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:10:23,371 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=122, relationships=107
2025-11-30 21:10:23,372 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:10:23,372 - src.components.neo4j_handler - DEBUG - APOC merge successful: White_Plastic_Bottle -> White_Bottle
2025-11-30 21:10:23,375 - src.components.neo4j_handler - DEBUG - APOC merge successful: Spatula -> Metal_Spatula
2025-11-30 21:10:23,377 - src.components.neo4j_handler - DEBUG - APOC merge successful: Beaker -> Glass_Beaker
2025-11-30 21:10:23,377 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Powder -> Powder
2025-11-30 21:10:23,377 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:10:23,381 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:10:23,382 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> White_Bottle
2025-11-30 21:10:23,383 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Glass_Beaker
2025-11-30 21:10:23,384 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Container
2025-11-30 21:10:23,384 - src.components.neo4j_handler - INFO - Applying 6 inter-chunk relations
2025-11-30 21:10:23,385 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Glass_Beaker -[Is On]-> Balance_Scale
2025-11-30 21:10:23,386 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Balance_Scale -[Is Inside]-> Glass_Draft_Shield
2025-11-30 21:10:23,388 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Is On]-> Scale_Platform
2025-11-30 21:10:23,389 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Watch
2025-11-30 21:10:23,390 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Laboratory -[Contains]-> Workbench
2025-11-30 21:10:23,391 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Laboratory -[Contains]-> Cabinets
2025-11-30 21:10:23,391 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:10:23,396 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=119, relationships=102
2025-11-30 21:10:23,397 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:10:23,397 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:10:23,397 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:10:23,397 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.15s, indexes: 0.00s)
2025-11-30 21:10:23,398 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 35, 'with_embedding': 35, 'linked_chunks': 27}
2025-11-30 21:10:23,398 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:10:23,410 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 119 nodes
2025-11-30 21:10:23,424 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 111 nodes
2025-11-30 21:10:23,446 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 119, 'relationship_count': 255, 'density': 0.0182, 'avg_degree': 4.2857, 'avg_unique_neighbors': 4.2689, 'global_efficiency': 0.354, 'avg_path_length': 2.7147, 'avg_degree_centrality': 0.0363, 'max_degree_centrality': 0.5169, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0094, 'degree_assortativity': -0.3094, 'graph_robustness': 0.8941, 'diameter_estimate': 4, 'clustering_coefficient': 0.298, 'weakly_connected_components': 9, 'largest_wcc_size': 111, 'pagerank_top10_percent': 23.78, 'louvain_communities': 16, 'louvain_modularity': 0.5376, 'label_entropy': 1.437, 'computational_time': 0.04801285092253238}
2025-11-30 21:10:23,446 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 7, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508223.446695, 'total_time': 17.17847820208408, 'aggregation': 3.458932042121887e-06, 'network_info': 0.006862639915198088, 'llm_extraction': 16.96828872698825, 'data_cleaning': 6.039906293153763e-05, 'neo4j_injection': 0.15384793397970498, 'embedding_time': 0, 'indexing_time': 0.0011355919996276498, 'graph_injection_time': 0.1523832461098209, 'acs_metrics': {'node_count': 119, 'relationship_count': 255, 'density': 0.0182, 'avg_degree': 4.2857, 'avg_unique_neighbors': 4.2689, 'global_efficiency': 0.354, 'avg_path_length': 2.7147, 'avg_degree_centrality': 0.0363, 'max_degree_centrality': 0.5169, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0094, 'degree_assortativity': -0.3094, 'graph_robustness': 0.8941, 'diameter_estimate': 4, 'clustering_coefficient': 0.298, 'weakly_connected_components': 9, 'largest_wcc_size': 111, 'pagerank_top10_percent': 23.78, 'louvain_communities': 16, 'louvain_modularity': 0.5376, 'label_entropy': 1.437, 'computational_time': 0.04801285092253238}, 'retrieval_queries': []}
2025-11-30 21:10:23,446 - src.pipeline.kg_builder - DEBUG - Batch 7 metrics: {
  "batch_idx": 7,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508223.446695,
  "total_time": 17.17847820208408,
  "aggregation": 3.458932042121887e-06,
  "network_info": 0.006862639915198088,
  "llm_extraction": 16.96828872698825,
  "data_cleaning": 6.039906293153763e-05,
  "neo4j_injection": 0.15384793397970498,
  "embedding_time": 0,
  "indexing_time": 0.0011355919996276498,
  "graph_injection_time": 0.1523832461098209,
  "acs_metrics": {
    "node_count": 119,
    "relationship_count": 255,
    "density": 0.0182,
    "avg_degree": 4.2857,
    "avg_unique_neighbors": 4.2689,
    "global_efficiency": 0.354,
    "avg_path_length": 2.7147,
    "avg_degree_centrality": 0.0363,
    "max_degree_centrality": 0.5169,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0094,
    "degree_assortativity": -0.3094,
    "graph_robustness": 0.8941,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.298,
    "weakly_connected_components": 9,
    "largest_wcc_size": 111,
    "pagerank_top10_percent": 23.78,
    "louvain_communities": 16,
    "louvain_modularity": 0.5376,
    "label_entropy": 1.437,
    "computational_time": 0.04801285092253238
  },
  "retrieval_queries": []
}
2025-11-30 21:10:23,447 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:10:23,447 - src.pipeline.kg_builder - INFO - Batch 8 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 16.97s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.05s
2025-11-30 21:10:23,447 - src.pipeline.kg_builder - INFO - Batch 8 completed in 17.18s
Processing KG batches:  11%|█         | 8/72 [03:26<24:02, 22.54s/it]2025-11-30 21:10:23,447 - src.pipeline.kg_builder - INFO - Processing batch 9/72 (3 items)
2025-11-30 21:10:23,447 - src.pipeline.kg_builder - DEBUG - Batch 9 current_video_time: 02:09-02:14
2025-11-30 21:10:23,455 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 119
- Total Relationships: 102
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:10:23,456 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:10:23,456 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_0 ~222 words, content: Time: 01:59-02:04 Content: The video sequence captures a precise laboratory procedure, likely the weighing of a solid chemical. The scene is set in a laboratory...
2025-11-30 21:10:23,456 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_1 ~222 words, content: **Final Steps:** After adding the desired amount of the substance, the person closes the glass draft shield. The video ends with the person having completed...
2025-11-30 21:10:23,456 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2 ~209 words, content: spatula to carefully scoop the powder from the bottle and deposit it into the beaker. The digital display of the balance shows a reading of...
2025-11-30 21:10:23,482 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:10:23,516 - src.components.pre_llm_injector - DEBUG - Found 35 existing chunk embeddings for similarity lookup
2025-11-30 21:10:23,522 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_4', '0.849'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.775')]
2025-11-30 21:10:23,523 - src.components.pre_llm_injector - DEBUG - Found 6 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2
2025-11-30 21:10:23,523 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:10:23,524 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_4 via source_chunk_ids
2025-11-30 21:10:23,526 - src.components.pre_llm_injector - DEBUG - Limited Person from 39 to 2 external connections
2025-11-30 21:10:23,526 - src.components.pre_llm_injector - DEBUG - Limited Workbench from 3 to 2 external connections
2025-11-30 21:10:23,526 - src.components.pre_llm_injector - DEBUG - Limited Laboratory from 5 to 2 external connections
2025-11-30 21:10:23,526 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 54 total -> 13 (internal: 7, external: 6)
2025-11-30 21:10:23,526 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[OBSERVES]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Workbench / ID: 1_1), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[PERFORMS]->(Weighing_By_Difference / ID: 7_2), (Laboratory / ID: 0_1)-[CONTAINS]->(Cabinets / ID: 7_2), (Person / ID: 0_0)-[WEARS]->(Blue_Nitrile_Glove / ID: 5_0), (Person / ID: 0_0)-[WEARS]->(Blue Jeans / ID: 0_0), (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1), (Workbench / ID: 1_1)-[HOLDS]->(Bottle / ID: 1_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Power Strip / ID: 3_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Glassware / ID: 0_1)
2025-11-30 21:10:23,526 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.526'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_1', '0.524')]
2025-11-30 21:10:23,526 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_4', '0.849'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.666')]
2025-11-30 21:10:23,526 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.775'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4', '0.770')]
2025-11-30 21:10:23,526 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:10:23,527 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_0) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:10:25,015 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:10:25,016 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:10:25,016 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_1) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:10:26,072 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:10:26,072 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:10:26,073 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2) (~209 words) with timeout=5.0s retries=3
2025-11-30 21:10:27,346 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:10:27,346 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:10:27,346 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 3 chunks
2025-11-30 21:10:27,346 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 3.89s
2025-11-30 21:10:27,347 - src.components.global_refiner - INFO - Capping refinement input: 17 → 15 triplets
2025-11-30 21:10:27,347 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[OBSERVES]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Workbench / ID: 1_1), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[PERFORMS]->(Weighing_By_Difference / ID: 7_2), (Laboratory / ID: 0_1)-[CONTAINS]->(Cabinets / ID: 7_2), (Person / ID: 0_0)-[WEARS]->(Blue_Nitrile_Glove / ID: 5_0), (Person / ID: 0_0)-[WEARS]->(Blue Jeans / ID: 0_0), (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1), (Workbench / ID: 1_1)-[HOLDS]->(Bottle / ID: 1_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Power Strip / ID: 3_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Glassware / ID: 0_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["8_0", "8_2"]}, {"head": "Person", "relation": "Holds", "tail": "Reagent_Bottle", "source_chunks": ["8_0"]}, {"head": "Reagent_Bottle", "relation": "Contains", "tail": "White_Powder", "source_chunks": ["8_0"]}, {"head": "Person", "relation": "Uses", "tail": "Metal_Spoon", "source_chunks": ["8_0"]}, {"head": "Metal_Spoon", "relation": "Transfers", "tail": "White_Powder", "source_chunks": ["8_0"]}, {"head": "White_Powder", "relation": "Is Added To", "tail": "Glass_Beaker", "source_chunks": ["8_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["8_1"]}, {"head": "Person", "relation": "Uses", "tail": "Balance", "source_chunks": ["8_1"]}, {"head": "Balance", "relation": "Contains", "tail": "Beaker", "source_chunks": ["8_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "White Powder", "source_chunks": ["8_1"]}, {"head": "Person", "relation": "Transfers", "tail": "White Powder", "source_chunks": ["8_1"]}, {"head": "Balance", "relation": "Is Inside", "tail": "Glass Draft Shield", "source_chunks": ["8_1"]}, {"head": "Person", "relation": "Uses", "tail": "Spatula", "source_chunks": ["8_2"]}, {"head": "Spatula", "relation": "Transfers", "tail": "Powder", "source_chunks": ["8_2"]}, {"head": "Powder", "relation": "Is Deposited In", "tail": "Beaker", "source_chunks": ["8_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:10:27,347 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~405 words, ~526 tokens)
2025-11-30 21:10:27,347 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:10:39,943 - src.components.global_refiner - DEBUG - LLM call completed in 12.60s
2025-11-30 21:10:39,943 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['8_0', '8_1']], ['Person', 'Holds', 'Reagent_Bottle', ['8_0']], ['Reagent_Bottle', 'Contains', 'White_Powder', ['8_0']], ['Person', 'Uses', 'Metal_Spoon', ['8_0']], ['Metal_Spoon', 'Transfers', 'White_Powder', ['8_0']], ['White_Powder', 'Is Added To', 'Glass_Beaker', ['8_0']], ['Person', 'Uses', 'Balance', ['8_1']], ['Balance', 'Contains', 'Beaker', ['8_1']], ['Beaker', 'Contains', 'White_Powder', ['8_1']], ['Person', 'Transfers', 'White_Powder', ['8_1']], ['Balance', 'Is Inside', 'Glass Draft Shield', ['8_1']], ['Person', 'Uses', 'Spatula', ['8_2']], ['Spatula', 'Transfers', 'Powder', ['8_2']], ['Powder', 'Is Deposited In', 'Beaker', ['8_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue_Nitrile_Glove', ['8_0', '8_1']], ['Person', 'Uses', 'Balance', ['8_1']], ['Balance', 'Is Inside', 'Glass Draft Shield', ['8_1']], ['Person', 'Uses', 'Spatula', ['8_2']], ['Spatula', 'Transfers', 'Powder', ['8_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Glove', 'existing_id': '5_0'}, {'local': 'White_Powder', 'existing': 'White_Powder', 'existing_id': '0_1'}, {'local': 'Powder', 'existing': 'White_Powder', 'existing_id': '0_1'}, {'local': 'Reagent_Bottle', 'existing': 'Bottle', 'existing_id': '1_1'}] prune_instructions=[{'head': 'Person', 'relation': 'WEARS', 'tail': 'Watch'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Jeans'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue_Nitrile_Glove'}, {'head': 'Person', 'relation': 'PERFORMS', 'tail': 'Weighing_By_Difference'}]
2025-11-30 21:10:39,943 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=14, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['8_0', '8_1']], ['Person', 'Holds', 'Reagent_Bottle', ['8_0']], ['Reagent_Bottle', 'Contains', 'White_Powder', ['8_0']]]
2025-11-30 21:10:39,944 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Person', 'Wears', 'Blue_Nitrile_Glove', ['8_0', '8_1']], ['Person', 'Uses', 'Balance', ['8_1']], ['Balance', 'Is Inside', 'Glass Draft Shield', ['8_1']]]
2025-11-30 21:10:39,944 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Glove', 'existing_id': '5_0'}, {'local': 'White_Powder', 'existing': 'White_Powder', 'existing_id': '0_1'}, {'local': 'Powder', 'existing': 'White_Powder', 'existing_id': '0_1'}]
2025-11-30 21:10:39,944 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'WEARS', 'tail': 'Watch'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Jeans'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue_Nitrile_Glove'}]
2025-11-30 21:10:39,944 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Glove', 'existing_id': '5_0'}, {'local': 'White_Powder', 'existing': 'White_Powder', 'existing_id': '0_1'}, {'local': 'Powder', 'existing': 'White_Powder', 'existing_id': '0_1'}, {'local': 'Reagent_Bottle', 'existing': 'Bottle', 'existing_id': '1_1'}]
2025-11-30 21:10:39,944 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'WEARS', 'tail': 'Watch'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Jeans'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue_Nitrile_Glove'}, {'head': 'Person', 'relation': 'PERFORMS', 'tail': 'Weighing_By_Difference'}]
2025-11-30 21:10:39,944 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 19 triplets (total: 12.60s, LLM: 12.60s)
2025-11-30 21:10:39,944 - src.pipeline.kg_builder - INFO - Global refinement: 19 triplets in 12.60s
2025-11-30 21:10:39,944 - src.pipeline.kg_builder - INFO - Using 19 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:10:39,944 - src.pipeline.kg_builder - INFO - Pushing batch 9/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:10:39,944 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:10:40,071 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=128, relationships=115
2025-11-30 21:10:40,071 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:10:40,071 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue_Nitrile_Glove
2025-11-30 21:10:40,071 - src.components.neo4j_handler - DEBUG - Skipping self-merge: White_Powder -> White_Powder
2025-11-30 21:10:40,075 - src.components.neo4j_handler - DEBUG - APOC merge successful: Powder -> White_Powder
2025-11-30 21:10:40,078 - src.components.neo4j_handler - DEBUG - APOC merge successful: Reagent_Bottle -> Bottle
2025-11-30 21:10:40,078 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:10:40,081 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[WEARS]-> Watch
2025-11-30 21:10:40,082 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[WEARS]-> Blue Jeans
2025-11-30 21:10:40,084 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[WEARS]-> Blue_Nitrile_Glove
2025-11-30 21:10:40,085 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[PERFORMS]-> Weighing_By_Difference
2025-11-30 21:10:40,085 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:10:40,086 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue_Nitrile_Glove
2025-11-30 21:10:40,087 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> Balance
2025-11-30 21:10:40,088 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Balance -[Is Inside]-> Glass Draft Shield
2025-11-30 21:10:40,090 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> Spatula
2025-11-30 21:10:40,090 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Spatula -[Transfers]-> Powder
2025-11-30 21:10:40,091 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:10:40,095 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=125, relationships=111
2025-11-30 21:10:40,096 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:10:40,096 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:10:40,096 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:10:40,096 - src.components.neo4j_handler - INFO - Batch injected in 0.15s (triplets: 0.15s, indexes: 0.00s)
2025-11-30 21:10:40,097 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 38, 'with_embedding': 38, 'linked_chunks': 30}
2025-11-30 21:10:40,097 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:10:40,110 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 125 nodes
2025-11-30 21:10:40,126 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 117 nodes
2025-11-30 21:10:40,153 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 125, 'relationship_count': 280, 'density': 0.0181, 'avg_degree': 4.48, 'avg_unique_neighbors': 4.432, 'global_efficiency': 0.3561, 'avg_path_length': 2.7151, 'avg_degree_centrality': 0.0361, 'max_degree_centrality': 0.5242, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0091, 'degree_assortativity': -0.2892, 'graph_robustness': 0.625, 'diameter_estimate': 4, 'clustering_coefficient': 0.2915, 'weakly_connected_components': 9, 'largest_wcc_size': 117, 'pagerank_top10_percent': 21.69, 'louvain_communities': 16, 'louvain_modularity': 0.5351, 'label_entropy': 1.4431, 'computational_time': 0.05573468504007906}
2025-11-30 21:10:40,153 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 8, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508240.1539366, 'total_time': 16.706549701979384, 'aggregation': 4.085944965481758e-06, 'network_info': 0.00829597795382142, 'llm_extraction': 16.48856060707476, 'data_cleaning': 3.552797716110945e-05, 'neo4j_injection': 0.1524903120007366, 'embedding_time': 0, 'indexing_time': 0.0012057520216330886, 'graph_injection_time': 0.15095780603587627, 'acs_metrics': {'node_count': 125, 'relationship_count': 280, 'density': 0.0181, 'avg_degree': 4.48, 'avg_unique_neighbors': 4.432, 'global_efficiency': 0.3561, 'avg_path_length': 2.7151, 'avg_degree_centrality': 0.0361, 'max_degree_centrality': 0.5242, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0091, 'degree_assortativity': -0.2892, 'graph_robustness': 0.625, 'diameter_estimate': 4, 'clustering_coefficient': 0.2915, 'weakly_connected_components': 9, 'largest_wcc_size': 117, 'pagerank_top10_percent': 21.69, 'louvain_communities': 16, 'louvain_modularity': 0.5351, 'label_entropy': 1.4431, 'computational_time': 0.05573468504007906}, 'retrieval_queries': []}
2025-11-30 21:10:40,154 - src.pipeline.kg_builder - DEBUG - Batch 8 metrics: {
  "batch_idx": 8,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508240.1539366,
  "total_time": 16.706549701979384,
  "aggregation": 4.085944965481758e-06,
  "network_info": 0.00829597795382142,
  "llm_extraction": 16.48856060707476,
  "data_cleaning": 3.552797716110945e-05,
  "neo4j_injection": 0.1524903120007366,
  "embedding_time": 0,
  "indexing_time": 0.0012057520216330886,
  "graph_injection_time": 0.15095780603587627,
  "acs_metrics": {
    "node_count": 125,
    "relationship_count": 280,
    "density": 0.0181,
    "avg_degree": 4.48,
    "avg_unique_neighbors": 4.432,
    "global_efficiency": 0.3561,
    "avg_path_length": 2.7151,
    "avg_degree_centrality": 0.0361,
    "max_degree_centrality": 0.5242,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0091,
    "degree_assortativity": -0.2892,
    "graph_robustness": 0.625,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.2915,
    "weakly_connected_components": 9,
    "largest_wcc_size": 117,
    "pagerank_top10_percent": 21.69,
    "louvain_communities": 16,
    "louvain_modularity": 0.5351,
    "label_entropy": 1.4431,
    "computational_time": 0.05573468504007906
  },
  "retrieval_queries": []
}
2025-11-30 21:10:40,154 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:10:40,154 - src.pipeline.kg_builder - INFO - Batch 9 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 16.49s, Clean: 0.00s, Neo4j: 0.15s, ACS: 0.06s
2025-11-30 21:10:40,155 - src.pipeline.kg_builder - INFO - Batch 9 completed in 16.71s
Processing KG batches:  12%|█▎        | 9/72 [03:43<21:45, 20.72s/it]2025-11-30 21:10:40,155 - src.pipeline.kg_builder - INFO - Processing batch 10/72 (3 items)
2025-11-30 21:10:40,155 - src.pipeline.kg_builder - DEBUG - Batch 10 current_video_time: 02:24-02:29
2025-11-30 21:10:40,163 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 125
- Total Relationships: 111
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:10:40,164 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:10:40,164 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_0 ~203 words, content: Time: 02:14-02:19 Content: The video captures a precise laboratory procedure, likely the preparation of a chemical solution or a standard sample. The sequence of frames...
2025-11-30 21:10:40,164 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1 ~209 words, content: the white powder. The display shows `20.23`, indicating the final mass of the substance added to the beaker. - **Final Measurement (Frame 5):** The person...
2025-11-30 21:10:40,164 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_2 ~221 words, content: to carefully add a white, powdery substance into a glass beaker. The beaker is placed on a digital balance scale, a Mettler Toledo model, which...
2025-11-30 21:10:40,164 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_3 ~239 words, content: in the beaker after the addition. The person is in the process of completing the weighing step. In summary, the video documents the careful and...
2025-11-30 21:10:40,164 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_4 ~246 words, content: substance. The background shows a laboratory environment with various equipment and supplies, including a box labeled "Dell" and a yellow bag. In the second frame,...
2025-11-30 21:10:40,164 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_5 ~244 words, content: been measured. The person's right hand is placing the bottle on the table, while the left hand is holding the bottle. The beaker is still...
2025-11-30 21:10:40,184 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:10:40,227 - src.components.pre_llm_injector - DEBUG - Found 38 existing chunk embeddings for similarity lookup
2025-11-30 21:10:40,241 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.771'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.722')]
2025-11-30 21:10:40,242 - src.components.pre_llm_injector - DEBUG - Found 4 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2
2025-11-30 21:10:40,242 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:10:40,243 - src.components.pre_llm_injector - DEBUG - Found 7 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0
2025-11-30 21:10:40,243 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:10:40,245 - src.components.pre_llm_injector - DEBUG - Limited Person from 41 to 2 external connections
2025-11-30 21:10:40,245 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 46 total -> 7 (internal: 4, external: 3)
2025-11-30 21:10:40,245 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[OPENS]->(Glass_Enclosure / ID: 6_2), (Person / ID: 0_0)-[TRANSFERS]->(White_Powdery_Substance / ID: 6_2), (Person / ID: 0_0)-[USES]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[USES]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[OPENS]->(Balance Scale Enclosure / ID: 6_1), (Person / ID: 0_0)-[INTERACTS_WITH]->(Paper / ID: 0_1), (Metal_Spatula / ID: 6_2)-[TRANSFERS]->(White_Powder / ID: 8_0)
2025-11-30 21:10:40,246 - src.components.pre_llm_injector - DEBUG - Limited Person from 44 to 2 external connections
2025-11-30 21:10:40,246 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 49 total -> 7 (internal: 5, external: 2)
2025-11-30 21:10:40,246 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WRITES_ON]->(Chemistry_Experiment_Report / ID: 3_0), (Chemistry_Experiment_Report / ID: 3_0)-[CONTAINS]->(Chemical_Equation / ID: 3_0), (Chemical_Equation / ID: 3_0)-[DESCRIBES]->(Reaction_Of_Aluminum_With_Sodium_Hydroxide / ID: 3_0), (Lab_Bench / ID: 3_0)-[HOLDS]->(Test_Tube_With_Blue_Cap / ID: 3_0), (Lab_Bench / ID: 3_0)-[HOLDS]->(Ar_Headset_Case / ID: 3_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Paper / ID: 0_1), (Person / ID: 0_0)-[USES]->(Burette / ID: 4_2)
2025-11-30 21:10:40,246 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.706'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_1', '0.673')]
2025-11-30 21:10:40,247 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.722'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.706')]
2025-11-30 21:10:40,247 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.704'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.698')]
2025-11-30 21:10:40,247 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.771'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_4', '0.657')]
2025-11-30 21:10:40,247 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.621'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_3', '0.618')]
2025-11-30 21:10:40,247 - src.components.pre_llm_injector - DEBUG - Chunk 5 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_5', '0.710'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4', '0.702')]
2025-11-30 21:10:40,247 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:10:40,247 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_0) (~203 words) with timeout=5.0s retries=3
2025-11-30 21:10:41,858 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:10:41,858 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:10:41,858 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1) (~209 words) with timeout=5.0s retries=3
2025-11-30 21:10:43,133 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:10:43,134 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:10:43,134 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_2) (~221 words) with timeout=5.0s retries=3
2025-11-30 21:10:44,609 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:10:44,609 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:10:44,609 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_3) (~239 words) with timeout=5.0s retries=3
2025-11-30 21:10:45,958 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:10:45,959 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:10:45,959 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_4) (~246 words) with timeout=5.0s retries=3
2025-11-30 21:10:47,206 - src.components.pre_llm_injector - DEBUG - Extracted 5 triplets from chunk 4 (attempt 1)
2025-11-30 21:10:47,206 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 5 triplets
2025-11-30 21:10:47,206 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_5) (~244 words) with timeout=5.0s retries=3
2025-11-30 21:10:48,382 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:10:48,382 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:10:48,383 - src.components.pre_llm_injector - INFO - Extracted 28 local triplets from 6 chunks
2025-11-30 21:10:48,383 - src.pipeline.kg_builder - INFO - Pre-extraction: 28 triplets in 8.22s
2025-11-30 21:10:48,383 - src.components.global_refiner - INFO - Capping refinement input: 28 → 15 triplets
2025-11-30 21:10:48,384 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[OPENS]->(Glass_Enclosure / ID: 6_2), (Person / ID: 0_0)-[TRANSFERS]->(White_Powdery_Substance / ID: 6_2), (Person / ID: 0_0)-[USES]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[USES]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[OPENS]->(Balance Scale Enclosure / ID: 6_1), (Person / ID: 0_0)-[INTERACTS_WITH]->(Paper / ID: 0_1), (Metal_Spatula / ID: 6_2)-[TRANSFERS]->(White_Powder / ID: 8_0)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[WRITES_ON]->(Chemistry_Experiment_Report / ID: 3_0), (Chemistry_Experiment_Report / ID: 3_0)-[CONTAINS]->(Chemical_Equation / ID: 3_0), (Chemical_Equation / ID: 3_0)-[DESCRIBES]->(Reaction_Of_Aluminum_With_Sodium_Hydroxide / ID: 3_0), (Lab_Bench / ID: 3_0)-[HOLDS]->(Test_Tube_With_Blue_Cap / ID: 3_0), (Lab_Bench / ID: 3_0)-[HOLDS]->(Ar_Headset_Case / ID: 3_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Paper / ID: 0_1), (Person / ID: 0_0)-[USES]->(Burette / ID: 4_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["9_0", "9_1", "9_3"]}, {"head": "Person", "relation": "Holds", "tail": "Metal_Spatula", "source_chunks": ["9_0", "9_2"]}, {"head": "Metal_Spatula", "relation": "Contains", "tail": "White_Powder", "source_chunks": ["9_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Analytical_Balance", "source_chunks": ["9_0"]}, {"head": "Analytical_Balance", "relation": "Displays", "tail": "20.20", "source_chunks": ["9_0"]}, {"head": "Analytical_Balance", "relation": "Displays", "tail": "20.23", "source_chunks": ["9_0"]}, {"head": "Person", "relation": "Adds", "tail": "White_Powder", "source_chunks": ["9_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "White_Powder", "source_chunks": ["9_1", "9_3"]}, {"head": "Balance", "relation": "Displays", "tail": "Final_Mass", "source_chunks": ["9_1"]}, {"head": "Person", "relation": "Holds", "tail": "Spatula", "source_chunks": ["9_1", "9_4"]}, {"head": "Lab_Equipment", "relation": "Contains", "tail": "Beaker", "source_chunks": ["9_1"]}, {"head": "Person", "relation": "Adds", "tail": "White_Powdery_Substance", "source_chunks": ["9_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "White_Powdery_Substance", "source_chunks": ["9_2"]}, {"head": "Digital_Balance_Scale", "relation": "Measures", "tail": "Mass", "source_chunks": ["9_2"]}, {"head": "Person", "relation": "Holds", "tail": "White_Plastic_Bottle", "source_chunks": ["9_2", "9_3"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:10:48,384 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~409 words, ~532 tokens)
2025-11-30 21:10:48,384 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:11:14,228 - src.components.global_refiner - DEBUG - LLM call completed in 25.84s
2025-11-30 21:11:14,228 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['9_0', '9_1', '9_3']], ['Person', 'Holds', 'Metal_Spatula', ['9_0', '9_2']], ['Metal_Spatula', 'Contains', 'White_Powder', ['9_0']], ['Beaker', 'Is On', 'Analytical_Balance', ['9_0']], ['Analytical_Balance', 'Displays', '20.20', ['9_0']], ['Analytical_Balance', 'Displays', '20.23', ['9_0']], ['Person', 'Adds', 'White_Powder', ['9_1']], ['Beaker', 'Contains', 'White_Powder', ['9_1', '9_3']], ['Balance', 'Displays', 'Final_Mass', ['9_1']], ['Person', 'Holds', 'Spatula', ['9_1', '9_4']], ['Lab_Equipment', 'Contains', 'Beaker', ['9_1']], ['Person', 'Adds', 'White_Powdery_Substance', ['9_2']], ['Beaker', 'Contains', 'White_Powdery_Substance', ['9_2']], ['Digital_Balance_Scale', 'Measures', 'Mass', ['9_2']], ['Person', 'Holds', 'White_Plastic_Bottle', ['9_2', '9_3']]] inter_chunk_relations=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['9_0', '9_1', '9_3']], ['Person', 'Holds', 'Metal_Spatula', ['9_0', '9_2']], ['Metal_Spatula', 'Contains', 'White_Powder', ['9_0']], ['Beaker', 'Is On', 'Analytical_Balance', ['9_0']], ['Analytical_Balance', 'Displays', '20.20', ['9_0']], ['Analytical_Balance', 'Displays', '20.23', ['9_0']], ['Person', 'Adds', 'White_Powder', ['9_1']], ['Beaker', 'Contains', 'White_Powder', ['9_1', '9_3']], ['Balance', 'Displays', 'Final_Mass', ['9_1']], ['Person', 'Holds', 'Spatula', ['9_1', '9_4']], ['Lab_Equipment', 'Contains', 'Beaker', ['9_1']], ['Person', 'Adds', 'White_Powdery_Substance', ['9_2']], ['Beaker', 'Contains', 'White_Powdery_Substance', ['9_2']], ['Digital_Balance_Scale', 'Measures', 'Mass', ['9_2']], ['Person', 'Holds', 'White_Plastic_Bottle', ['9_2', '9_3']]] merge_instructions=[{'local': 'Metal_Spatula', 'existing': 'Metal_Spatula', 'existing_id': '6_2'}, {'local': 'White_Powder', 'existing': 'White_Powdery_Substance', 'existing_id': '6_2'}, {'local': 'Beaker', 'existing': 'Beaker', 'existing_id': '6_2'}, {'local': 'Analytical_Balance', 'existing': 'Balance Scale Enclosure', 'existing_id': '6_1'}, {'local': 'Digital_Balance_Scale', 'existing': 'Balance Scale Enclosure', 'existing_id': '6_1'}, {'local': 'Spatula', 'existing': 'Metal_Spatula', 'existing_id': '6_2'}, {'local': 'White_Plastic_Bottle', 'existing': 'White_Plastic_Bottle', 'existing_id': '6_2'}, {'local': 'Lab_Equipment', 'existing': 'Lab_Bench', 'existing_id': '3_0'}] prune_instructions=[{'head': 'Person', 'relation': 'USES', 'tail': 'Metal_Spatula'}, {'head': 'Metal_Spatula', 'relation': 'TRANSFERS', 'tail': 'White_Powder'}, {'head': 'Person', 'relation': 'OPENS', 'tail': 'Glass_Enclosure'}, {'head': 'Person', 'relation': 'OPENS', 'tail': 'Balance Scale Enclosure'}, {'head': 'Person', 'relation': 'TRANSFERS', 'tail': 'White_Powdery_Substance'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Metal_Spatula'}, {'head': 'Person', 'relation': 'INTERACTS_WITH', 'tail': 'Paper'}, {'head': 'Person', 'relation': 'WRITES_ON', 'tail': 'Chemistry_Experiment_Report'}, {'head': 'Chemistry_Experiment_Report', 'relation': 'CONTAINS', 'tail': 'Chemical_Equation'}, {'head': 'Chemical_Equation', 'relation': 'DESCRIBES', 'tail': 'Reaction_Of_Aluminum_With_Sodium_Hydroxide'}, {'head': 'Lab_Bench', 'relation': 'HOLDS', 'tail': 'Test_Tube_With_Blue_Cap'}, {'head': 'Lab_Bench', 'relation': 'HOLDS', 'tail': 'Ar_Headset_Case'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Burette'}]
2025-11-30 21:11:14,229 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['9_0', '9_1', '9_3']], ['Person', 'Holds', 'Metal_Spatula', ['9_0', '9_2']], ['Metal_Spatula', 'Contains', 'White_Powder', ['9_0']]]
2025-11-30 21:11:14,229 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['9_0', '9_1', '9_3']], ['Person', 'Holds', 'Metal_Spatula', ['9_0', '9_2']], ['Metal_Spatula', 'Contains', 'White_Powder', ['9_0']]]
2025-11-30 21:11:14,229 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=8, sample=[{'local': 'Metal_Spatula', 'existing': 'Metal_Spatula', 'existing_id': '6_2'}, {'local': 'White_Powder', 'existing': 'White_Powdery_Substance', 'existing_id': '6_2'}, {'local': 'Beaker', 'existing': 'Beaker', 'existing_id': '6_2'}]
2025-11-30 21:11:14,229 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=13, sample=[{'head': 'Person', 'relation': 'USES', 'tail': 'Metal_Spatula'}, {'head': 'Metal_Spatula', 'relation': 'TRANSFERS', 'tail': 'White_Powder'}, {'head': 'Person', 'relation': 'OPENS', 'tail': 'Glass_Enclosure'}]
2025-11-30 21:11:14,229 - src.components.global_refiner - INFO - LLM suggested 8 entity merges: [{'local': 'Metal_Spatula', 'existing': 'Metal_Spatula', 'existing_id': '6_2'}, {'local': 'White_Powder', 'existing': 'White_Powdery_Substance', 'existing_id': '6_2'}, {'local': 'Beaker', 'existing': 'Beaker', 'existing_id': '6_2'}, {'local': 'Analytical_Balance', 'existing': 'Balance Scale Enclosure', 'existing_id': '6_1'}, {'local': 'Digital_Balance_Scale', 'existing': 'Balance Scale Enclosure', 'existing_id': '6_1'}, {'local': 'Spatula', 'existing': 'Metal_Spatula', 'existing_id': '6_2'}, {'local': 'White_Plastic_Bottle', 'existing': 'White_Plastic_Bottle', 'existing_id': '6_2'}, {'local': 'Lab_Equipment', 'existing': 'Lab_Bench', 'existing_id': '3_0'}]
2025-11-30 21:11:14,229 - src.components.global_refiner - INFO - LLM suggested 13 triplets to prune: [{'head': 'Person', 'relation': 'USES', 'tail': 'Metal_Spatula'}, {'head': 'Metal_Spatula', 'relation': 'TRANSFERS', 'tail': 'White_Powder'}, {'head': 'Person', 'relation': 'OPENS', 'tail': 'Glass_Enclosure'}, {'head': 'Person', 'relation': 'OPENS', 'tail': 'Balance Scale Enclosure'}, {'head': 'Person', 'relation': 'TRANSFERS', 'tail': 'White_Powdery_Substance'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Metal_Spatula'}, {'head': 'Person', 'relation': 'INTERACTS_WITH', 'tail': 'Paper'}, {'head': 'Person', 'relation': 'WRITES_ON', 'tail': 'Chemistry_Experiment_Report'}, {'head': 'Chemistry_Experiment_Report', 'relation': 'CONTAINS', 'tail': 'Chemical_Equation'}, {'head': 'Chemical_Equation', 'relation': 'DESCRIBES', 'tail': 'Reaction_Of_Aluminum_With_Sodium_Hydroxide'}, {'head': 'Lab_Bench', 'relation': 'HOLDS', 'tail': 'Test_Tube_With_Blue_Cap'}, {'head': 'Lab_Bench', 'relation': 'HOLDS', 'tail': 'Ar_Headset_Case'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Burette'}]
2025-11-30 21:11:14,229 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 30 triplets (total: 25.85s, LLM: 25.84s)
2025-11-30 21:11:14,229 - src.pipeline.kg_builder - INFO - Global refinement: 30 triplets in 25.85s
2025-11-30 21:11:14,229 - src.pipeline.kg_builder - INFO - Using 30 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:11:14,229 - src.pipeline.kg_builder - INFO - Pushing batch 10/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:11:14,229 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:11:14,390 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=140, relationships=125
2025-11-30 21:11:14,390 - src.components.neo4j_handler - INFO - Applying 8 merge instructions
2025-11-30 21:11:14,390 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Metal_Spatula -> Metal_Spatula
2025-11-30 21:11:14,391 - src.components.neo4j_handler - DEBUG - APOC merge successful: White_Powder -> White_Powdery_Substance
2025-11-30 21:11:14,391 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Beaker -> Beaker
2025-11-30 21:11:14,395 - src.components.neo4j_handler - DEBUG - APOC merge successful: Analytical_Balance -> Balance Scale Enclosure
2025-11-30 21:11:14,397 - src.components.neo4j_handler - DEBUG - APOC merge successful: Digital_Balance_Scale -> Balance Scale Enclosure
2025-11-30 21:11:14,400 - src.components.neo4j_handler - DEBUG - APOC merge successful: Spatula -> Metal_Spatula
2025-11-30 21:11:14,400 - src.components.neo4j_handler - DEBUG - Skipping self-merge: White_Plastic_Bottle -> White_Plastic_Bottle
2025-11-30 21:11:14,402 - src.components.neo4j_handler - DEBUG - APOC merge successful: Lab_Equipment -> Lab_Bench
2025-11-30 21:11:14,402 - src.components.neo4j_handler - INFO - Applying 13 prune instructions
2025-11-30 21:11:14,406 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[USES]-> Metal_Spatula
2025-11-30 21:11:14,407 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Metal_Spatula -[TRANSFERS]-> White_Powder
2025-11-30 21:11:14,409 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[OPENS]-> Glass_Enclosure
2025-11-30 21:11:14,411 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[OPENS]-> Balance Scale Enclosure
2025-11-30 21:11:14,413 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[TRANSFERS]-> White_Powdery_Substance
2025-11-30 21:11:14,414 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[USES]-> Metal_Spatula
2025-11-30 21:11:14,415 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[INTERACTS_WITH]-> Paper
2025-11-30 21:11:14,417 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[WRITES_ON]-> Chemistry_Experiment_Report
2025-11-30 21:11:14,419 - src.components.neo4j_handler - DEBUG - Pruned relationship: Chemistry_Experiment_Report -[CONTAINS]-> Chemical_Equation
2025-11-30 21:11:14,440 - src.components.neo4j_handler - DEBUG - Pruned relationship: Chemical_Equation -[DESCRIBES]-> Reaction_Of_Aluminum_With_Sodium_Hydroxide
2025-11-30 21:11:14,442 - src.components.neo4j_handler - DEBUG - Pruned relationship: Lab_Bench -[HOLDS]-> Test_Tube_With_Blue_Cap
2025-11-30 21:11:14,444 - src.components.neo4j_handler - DEBUG - Pruned relationship: Lab_Bench -[HOLDS]-> Ar_Headset_Case
2025-11-30 21:11:14,446 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[USES]-> Burette
2025-11-30 21:11:14,446 - src.components.neo4j_handler - INFO - Applying 15 inter-chunk relations
2025-11-30 21:11:14,447 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:11:14,449 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Metal_Spatula
2025-11-30 21:11:14,450 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Metal_Spatula -[Contains]-> White_Powder
2025-11-30 21:11:14,451 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Is On]-> Analytical_Balance
2025-11-30 21:11:14,451 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Analytical_Balance -[Displays]-> 20.20
2025-11-30 21:11:14,452 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Analytical_Balance -[Displays]-> 20.23
2025-11-30 21:11:14,452 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Adds]-> White_Powder
2025-11-30 21:11:14,452 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Contains]-> White_Powder
2025-11-30 21:11:14,453 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Balance -[Displays]-> Final_Mass
2025-11-30 21:11:14,454 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Spatula
2025-11-30 21:11:14,454 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Lab_Equipment -[Contains]-> Beaker
2025-11-30 21:11:14,455 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Adds]-> White_Powdery_Substance
2025-11-30 21:11:14,456 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Contains]-> White_Powdery_Substance
2025-11-30 21:11:14,457 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Digital_Balance_Scale -[Measures]-> Mass
2025-11-30 21:11:14,459 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> White_Plastic_Bottle
2025-11-30 21:11:14,460 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:11:14,466 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=135, relationships=111
2025-11-30 21:11:14,468 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:11:14,468 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:11:14,468 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:11:14,468 - src.components.neo4j_handler - INFO - Batch injected in 0.24s (triplets: 0.24s, indexes: 0.00s)
2025-11-30 21:11:14,469 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 44, 'with_embedding': 44, 'linked_chunks': 35}
2025-11-30 21:11:14,469 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:11:14,479 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 135 nodes
2025-11-30 21:11:14,492 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 126 nodes
2025-11-30 21:11:14,513 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 135, 'relationship_count': 306, 'density': 0.0169, 'avg_degree': 4.5333, 'avg_unique_neighbors': 4.4889, 'global_efficiency': 0.3448, 'avg_path_length': 2.7909, 'avg_degree_centrality': 0.0338, 'max_degree_centrality': 0.4851, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0051, 'degree_assortativity': -0.2533, 'graph_robustness': 0.8562, 'diameter_estimate': 4, 'clustering_coefficient': 0.2598, 'weakly_connected_components': 10, 'largest_wcc_size': 126, 'pagerank_top10_percent': 20.44, 'louvain_communities': 18, 'louvain_modularity': 0.5372, 'label_entropy': 1.4554, 'computational_time': 0.0438298269873485}
2025-11-30 21:11:14,513 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 9, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508274.5135157, 'total_time': 34.35834497201722, 'aggregation': 9.282026439905167e-06, 'network_info': 0.008323083049617708, 'llm_extraction': 34.06571781402454, 'data_cleaning': 4.104699473828077e-05, 'neo4j_injection': 0.23913195298518986, 'embedding_time': 0, 'indexing_time': 0.0019566300325095654, 'graph_injection_time': 0.23687453102320433, 'acs_metrics': {'node_count': 135, 'relationship_count': 306, 'density': 0.0169, 'avg_degree': 4.5333, 'avg_unique_neighbors': 4.4889, 'global_efficiency': 0.3448, 'avg_path_length': 2.7909, 'avg_degree_centrality': 0.0338, 'max_degree_centrality': 0.4851, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0051, 'degree_assortativity': -0.2533, 'graph_robustness': 0.8562, 'diameter_estimate': 4, 'clustering_coefficient': 0.2598, 'weakly_connected_components': 10, 'largest_wcc_size': 126, 'pagerank_top10_percent': 20.44, 'louvain_communities': 18, 'louvain_modularity': 0.5372, 'label_entropy': 1.4554, 'computational_time': 0.0438298269873485}, 'retrieval_queries': []}
2025-11-30 21:11:14,513 - src.pipeline.kg_builder - DEBUG - Batch 9 metrics: {
  "batch_idx": 9,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508274.5135157,
  "total_time": 34.35834497201722,
  "aggregation": 9.282026439905167e-06,
  "network_info": 0.008323083049617708,
  "llm_extraction": 34.06571781402454,
  "data_cleaning": 4.104699473828077e-05,
  "neo4j_injection": 0.23913195298518986,
  "embedding_time": 0,
  "indexing_time": 0.0019566300325095654,
  "graph_injection_time": 0.23687453102320433,
  "acs_metrics": {
    "node_count": 135,
    "relationship_count": 306,
    "density": 0.0169,
    "avg_degree": 4.5333,
    "avg_unique_neighbors": 4.4889,
    "global_efficiency": 0.3448,
    "avg_path_length": 2.7909,
    "avg_degree_centrality": 0.0338,
    "max_degree_centrality": 0.4851,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0051,
    "degree_assortativity": -0.2533,
    "graph_robustness": 0.8562,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.2598,
    "weakly_connected_components": 10,
    "largest_wcc_size": 126,
    "pagerank_top10_percent": 20.44,
    "louvain_communities": 18,
    "louvain_modularity": 0.5372,
    "label_entropy": 1.4554,
    "computational_time": 0.0438298269873485
  },
  "retrieval_queries": []
}
2025-11-30 21:11:14,513 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:11:14,514 - src.pipeline.kg_builder - INFO - Batch 10 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 34.07s, Clean: 0.00s, Neo4j: 0.24s, ACS: 0.04s
2025-11-30 21:11:14,514 - src.pipeline.kg_builder - INFO - Batch 10 completed in 34.36s
Processing KG batches:  14%|█▍        | 10/72 [04:17<25:45, 24.93s/it]2025-11-30 21:11:14,514 - src.pipeline.kg_builder - INFO - Processing batch 11/72 (3 items)
2025-11-30 21:11:14,514 - src.pipeline.kg_builder - DEBUG - Batch 11 current_video_time: 02:39-02:44
2025-11-30 21:11:14,519 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 135
- Total Relationships: 111
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:11:14,519 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:11:14,519 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_0 ~235 words, content: Time: 02:29-02:34 Content: The video sequence captures a scientific procedure, likely a chemical experiment, being conducted in a laboratory setting. The process involves the precise...
2025-11-30 21:11:14,519 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_1 ~229 words, content: a reading of "80.15 g". A hand wearing a blue glove is seen opening the glass door of the balance's draft shield. The beaker with...
2025-11-30 21:11:14,520 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_2 ~220 words, content: Time: 02:34-02:39 Content: The video sequence captures a scientific procedure, likely a titration or a similar chemical analysis, being performed in a laboratory setting. The...
2025-11-30 21:11:14,520 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_3 ~228 words, content: background reveals more of the laboratory, including a white door, a wall-mounted electrical panel with a high-voltage warning symbol, and a shelf with various items....
2025-11-30 21:11:14,520 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_4 ~225 words, content: conducted with precision, using an analytical balance to ensure accurate measurements. Time: 02:39-02:44 Content: The video captures a sequence of a laboratory procedure, likely a...
2025-11-30 21:11:14,520 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_5 ~114 words, content: has been added. The final reading on the balance is shown to be -56.30, which is a stable reading, indicating that the addition is complete....
2025-11-30 21:11:14,539 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:11:14,583 - src.components.pre_llm_injector - DEBUG - Found 44 existing chunk embeddings for similarity lookup
2025-11-30 21:11:14,597 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.808'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_3', '0.792')]
2025-11-30 21:11:14,599 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3 via source_chunk_ids
2025-11-30 21:11:14,599 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_3
2025-11-30 21:11:14,599 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:11:14,601 - src.components.pre_llm_injector - DEBUG - Limited Document from 6 to 2 external connections
2025-11-30 21:11:14,601 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 7 total -> 3 (internal: 1, external: 2)
2025-11-30 21:11:14,601 - src.components.pre_llm_injector - DEBUG - Subgraph: (Document / ID: 0_2)-[IS_ABOUT]->(Chemistry Experiment / ID: 0_2), (Document / ID: 0_2)-[CONTAINS]->(Chemical Equation / ID: 2_0), (Document / ID: 0_2)-[CONTAINS]->(Measured Volume / ID: 2_0)
2025-11-30 21:11:14,601 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.739'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_3', '0.705')]
2025-11-30 21:11:14,601 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_3', '0.710'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.707')]
2025-11-30 21:11:14,601 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.709'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_2', '0.679')]
2025-11-30 21:11:14,601 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_4', '0.419'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_0', '0.416')]
2025-11-30 21:11:14,601 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_2', '0.648'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_2', '0.640')]
2025-11-30 21:11:14,601 - src.components.pre_llm_injector - DEBUG - Chunk 5 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.808'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_3', '0.792')]
2025-11-30 21:11:14,601 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:11:14,601 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_0) (~235 words) with timeout=5.0s retries=3
2025-11-30 21:11:15,912 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:11:15,912 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:11:15,912 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_1) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:11:17,021 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:11:17,021 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:11:17,021 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_2) (~220 words) with timeout=5.0s retries=3
2025-11-30 21:11:18,618 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:11:18,618 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:11:18,618 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_3) (~228 words) with timeout=5.0s retries=3
2025-11-30 21:11:19,877 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:11:19,877 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:11:19,877 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_4) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:11:21,342 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:11:21,342 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:11:21,343 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_5) (~114 words) with timeout=5.0s retries=3
2025-11-30 21:11:22,489 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:11:22,489 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:11:22,489 - src.components.pre_llm_injector - INFO - Extracted 34 local triplets from 6 chunks
2025-11-30 21:11:22,489 - src.pipeline.kg_builder - INFO - Pre-extraction: 34 triplets in 7.97s
2025-11-30 21:11:22,490 - src.components.global_refiner - INFO - Capping refinement input: 34 → 15 triplets
2025-11-30 21:11:22,490 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Document / ID: 0_2)-[IS_ABOUT]->(Chemistry Experiment / ID: 0_2), (Document / ID: 0_2)-[CONTAINS]->(Chemical Equation / ID: 2_0), (Document / ID: 0_2)-[CONTAINS]->(Measured Volume / ID: 2_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Glove", "source_chunks": ["10_0"]}, {"head": "Person", "relation": "Holds", "tail": "White Plastic Bottle", "source_chunks": ["10_0"]}, {"head": "White Plastic Bottle", "relation": "Has", "tail": "Red Cap", "source_chunks": ["10_0"]}, {"head": "White Plastic Bottle", "relation": "Contains", "tail": "Chemical Substance", "source_chunks": ["10_0"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "80.15 G", "source_chunks": ["10_0"]}, {"head": "Digital Balance", "relation": "Is Inside", "tail": "Draft Shield", "source_chunks": ["10_0"]}, {"head": "Hand", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["10_1"]}, {"head": "Hand", "relation": "Opens", "tail": "Draft Shield", "source_chunks": ["10_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Weighing Pan", "source_chunks": ["10_1"]}, {"head": "Hand", "relation": "Points To", "tail": "Scale Display", "source_chunks": ["10_1"]}, {"head": "Person", "relation": "Removes", "tail": "Beaker", "source_chunks": ["10_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "White Powder", "source_chunks": ["10_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["10_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Beaker", "source_chunks": ["10_2", "10_4"]}, {"head": "Glass_Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["10_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:11:22,490 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~347 words, ~451 tokens)
2025-11-30 21:11:22,490 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:11:33,921 - src.components.global_refiner - DEBUG - LLM call completed in 11.43s
2025-11-30 21:11:33,922 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue Nitrile Glove', ['10_0']], ['Person', 'Holds', 'White Plastic Bottle', ['10_0']], ['White Plastic Bottle', 'Has', 'Red Cap', ['10_0']], ['White Plastic Bottle', 'Contains', 'Chemical Substance', ['10_0']], ['Digital Balance', 'Displays', '80.15 G', ['10_0']], ['Digital Balance', 'Is Inside', 'Draft Shield', ['10_0']], ['Hand', 'Wears', 'Blue Glove', ['10_1']], ['Hand', 'Opens', 'Draft Shield', ['10_1']], ['Beaker', 'Is On', 'Weighing Pan', ['10_1']], ['Hand', 'Points To', 'Scale Display', ['10_1']], ['Person', 'Removes', 'Beaker', ['10_1']], ['Beaker', 'Contains', 'White Powder', ['10_1']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['10_2']], ['Person', 'Holds', 'Glass_Beaker', ['10_2', '10_4']], ['Glass_Beaker', 'Contains', 'Clear_Liquid', ['10_2']]] inter_chunk_relations=[['Document', 'Is About', 'Chemistry Experiment', ['0_2']], ['Document', 'Contains', 'Chemical Equation', ['0_2']], ['Document', 'Contains', 'Measured Volume', ['0_2']]] merge_instructions=[{'local': 'Blue Nitrile Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}, {'head': 'Hand', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}]
2025-11-30 21:11:33,922 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue Nitrile Glove', ['10_0']], ['Person', 'Holds', 'White Plastic Bottle', ['10_0']], ['White Plastic Bottle', 'Has', 'Red Cap', ['10_0']]]
2025-11-30 21:11:33,922 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=3, sample=[['Document', 'Is About', 'Chemistry Experiment', ['0_2']], ['Document', 'Contains', 'Chemical Equation', ['0_2']], ['Document', 'Contains', 'Measured Volume', ['0_2']]]
2025-11-30 21:11:33,922 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=2, sample=[{'local': 'Blue Nitrile Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}]
2025-11-30 21:11:33,922 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}, {'head': 'Hand', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}]
2025-11-30 21:11:33,922 - src.components.global_refiner - INFO - LLM suggested 2 entity merges: [{'local': 'Blue Nitrile Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}]
2025-11-30 21:11:33,922 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}, {'head': 'Hand', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}]
2025-11-30 21:11:33,922 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 18 triplets (total: 11.43s, LLM: 11.43s)
2025-11-30 21:11:33,922 - src.pipeline.kg_builder - INFO - Global refinement: 18 triplets in 11.43s
2025-11-30 21:11:33,922 - src.pipeline.kg_builder - INFO - Using 18 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:11:33,922 - src.pipeline.kg_builder - INFO - Pushing batch 11/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:11:33,922 - src.components.neo4j_handler - INFO - Adding 18 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:11:34,131 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=152, relationships=124
2025-11-30 21:11:34,131 - src.components.neo4j_handler - INFO - Applying 2 merge instructions
2025-11-30 21:11:34,131 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue Nitrile Glove -> Blue Glove
2025-11-30 21:11:34,134 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Glove
2025-11-30 21:11:34,134 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:11:34,137 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> No Glove
2025-11-30 21:11:34,138 - src.components.neo4j_handler - DEBUG - Pruned relationship: Hand -[Wears]-> Blue Glove
2025-11-30 21:11:34,139 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue Nitrile Glove
2025-11-30 21:11:34,139 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:11:34,139 - src.components.neo4j_handler - INFO - Applying 3 inter-chunk relations
2025-11-30 21:11:34,167 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Document -[Is About]-> Chemistry Experiment
2025-11-30 21:11:34,169 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Document -[Contains]-> Chemical Equation
2025-11-30 21:11:34,170 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Document -[Contains]-> Measured Volume
2025-11-30 21:11:34,170 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:11:34,175 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=150, relationships=123
2025-11-30 21:11:34,176 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:11:34,176 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:11:34,176 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:11:34,176 - src.components.neo4j_handler - INFO - Batch injected in 0.25s (triplets: 0.25s, indexes: 0.00s)
2025-11-30 21:11:34,177 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 50, 'with_embedding': 50, 'linked_chunks': 39}
2025-11-30 21:11:34,177 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:11:34,193 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 150 nodes
2025-11-30 21:11:34,215 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 139 nodes
2025-11-30 21:11:34,244 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 150, 'relationship_count': 343, 'density': 0.0153, 'avg_degree': 4.5733, 'avg_unique_neighbors': 4.5333, 'global_efficiency': 0.336, 'avg_path_length': 2.8172, 'avg_degree_centrality': 0.0307, 'max_degree_centrality': 0.4765, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0071, 'degree_assortativity': -0.2408, 'graph_robustness': 0.8513, 'diameter_estimate': 4, 'clustering_coefficient': 0.2603, 'weakly_connected_components': 12, 'largest_wcc_size': 139, 'pagerank_top10_percent': 19.04, 'louvain_communities': 19, 'louvain_modularity': 0.531, 'label_entropy': 1.4591, 'computational_time': 0.06729563395492733}
2025-11-30 21:11:34,244 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 10, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508294.244968, 'total_time': 19.73085756599903, 'aggregation': 3.214925527572632e-06, 'network_info': 0.0051725959638133645, 'llm_extraction': 19.403158770059235, 'data_cleaning': 3.702996764332056e-05, 'neo4j_injection': 0.25389786902815104, 'embedding_time': 0, 'indexing_time': 0.0012633820297196507, 'graph_injection_time': 0.25227941502816975, 'acs_metrics': {'node_count': 150, 'relationship_count': 343, 'density': 0.0153, 'avg_degree': 4.5733, 'avg_unique_neighbors': 4.5333, 'global_efficiency': 0.336, 'avg_path_length': 2.8172, 'avg_degree_centrality': 0.0307, 'max_degree_centrality': 0.4765, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0071, 'degree_assortativity': -0.2408, 'graph_robustness': 0.8513, 'diameter_estimate': 4, 'clustering_coefficient': 0.2603, 'weakly_connected_components': 12, 'largest_wcc_size': 139, 'pagerank_top10_percent': 19.04, 'louvain_communities': 19, 'louvain_modularity': 0.531, 'label_entropy': 1.4591, 'computational_time': 0.06729563395492733}, 'retrieval_queries': []}
2025-11-30 21:11:34,245 - src.pipeline.kg_builder - DEBUG - Batch 10 metrics: {
  "batch_idx": 10,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508294.244968,
  "total_time": 19.73085756599903,
  "aggregation": 3.214925527572632e-06,
  "network_info": 0.0051725959638133645,
  "llm_extraction": 19.403158770059235,
  "data_cleaning": 3.702996764332056e-05,
  "neo4j_injection": 0.25389786902815104,
  "embedding_time": 0,
  "indexing_time": 0.0012633820297196507,
  "graph_injection_time": 0.25227941502816975,
  "acs_metrics": {
    "node_count": 150,
    "relationship_count": 343,
    "density": 0.0153,
    "avg_degree": 4.5733,
    "avg_unique_neighbors": 4.5333,
    "global_efficiency": 0.336,
    "avg_path_length": 2.8172,
    "avg_degree_centrality": 0.0307,
    "max_degree_centrality": 0.4765,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0071,
    "degree_assortativity": -0.2408,
    "graph_robustness": 0.8513,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.2603,
    "weakly_connected_components": 12,
    "largest_wcc_size": 139,
    "pagerank_top10_percent": 19.04,
    "louvain_communities": 19,
    "louvain_modularity": 0.531,
    "label_entropy": 1.4591,
    "computational_time": 0.06729563395492733
  },
  "retrieval_queries": []
}
2025-11-30 21:11:34,245 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:11:34,245 - src.pipeline.kg_builder - INFO - Batch 11 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.40s, Clean: 0.00s, Neo4j: 0.25s, ACS: 0.07s
2025-11-30 21:11:34,245 - src.pipeline.kg_builder - INFO - Batch 11 completed in 19.73s
Processing KG batches:  15%|█▌        | 11/72 [04:37<23:43, 23.34s/it]2025-11-30 21:11:34,245 - src.pipeline.kg_builder - INFO - Processing batch 12/72 (3 items)
2025-11-30 21:11:34,245 - src.pipeline.kg_builder - DEBUG - Batch 12 current_video_time: 02:54-02:59
2025-11-30 21:11:34,251 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 150
- Total Relationships: 123
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:11:34,251 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:11:34,251 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_0 ~230 words, content: Time: 02:44-02:49 Content: The video captures a laboratory procedure, likely a titration or a similar quantitative analysis, from a first-person perspective. The scene is set...
2025-11-30 21:11:34,252 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_1 ~224 words, content: and a document with Chinese text, likely a lab protocol or experiment instructions. The overall context suggests a controlled and precise scientific experiment is in...
2025-11-30 21:11:34,252 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_2 ~233 words, content: . The digital display of the balance shows a negative weight of `-56.304 g`, which is the result of the tare function. The person is...
2025-11-30 21:11:34,252 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_3 ~224 words, content: , and then adding a solid substance to the beaker to measure its weight. This is a common procedure in chemistry for preparing solutions or...
2025-11-30 21:11:34,252 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_4 ~125 words, content: into a small, clear glass container, which is likely a conical flask or a beaker used for titration. This action is performed with precision, suggesting...
2025-11-30 21:11:34,272 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:11:34,313 - src.components.pre_llm_injector - DEBUG - Found 50 existing chunk embeddings for similarity lookup
2025-11-30 21:11:34,327 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_1', '0.820'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1', '0.786')]
2025-11-30 21:11:34,328 - src.components.pre_llm_injector - DEBUG - Found 7 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_1
2025-11-30 21:11:34,328 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:11:34,329 - src.components.pre_llm_injector - DEBUG - Found 4 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1
2025-11-30 21:11:34,329 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:11:34,331 - src.components.pre_llm_injector - DEBUG - Limited Person from 42 to 2 external connections
2025-11-30 21:11:34,332 - src.components.pre_llm_injector - DEBUG - Limited Beaker from 7 to 2 external connections
2025-11-30 21:11:34,332 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 54 total -> 9 (internal: 4, external: 5)
2025-11-30 21:11:34,332 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[USES]->(Balance / ID: 4_2), (Person / ID: 0_0)-[REMOVES]->(Beaker / ID: 8_1), (Balance / ID: 4_2)-[CONTAINS]->(Beaker / ID: 8_1), (Balance / ID: 4_2)-[DISPLAYS]->(Final_Mass / ID: 9_1), (Person / ID: 0_0)-[HOLDS]->(White_Plastic_Bottle / ID: 9_2), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Beaker / ID: 8_1)-[CONTAINS]->(White_Powdery_Substance / ID: 6_2), (White_Powdery_Substance / ID: 6_2)-[IS_DEPOSITED_IN]->(Beaker / ID: 8_1), (Balance / ID: 4_2)-[IS_INSIDE]->(Glass Draft Shield / ID: 8_1)
2025-11-30 21:11:34,334 - src.components.pre_llm_injector - DEBUG - Limited Person from 40 to 2 external connections
2025-11-30 21:11:34,334 - src.components.pre_llm_injector - DEBUG - Limited Laboratory from 6 to 2 external connections
2025-11-30 21:11:34,334 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 56 total -> 14 (internal: 9, external: 5)
2025-11-30 21:11:34,334 - src.components.pre_llm_injector - DEBUG - Subgraph: (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1), (Person / ID: 0_0)-[OBSERVES]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Workbench / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Apparatus / ID: 1_1), (Apparatus / ID: 1_1)-[IS_PART_OF]->(Laboratory Equipment / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Laboratory / ID: 0_1)-[CONTAINS]->(Glassware / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Cabinets / ID: 7_2), (Bottle / ID: 1_1)-[CONTAINS]->(White_Powdery_Substance / ID: 6_2)
2025-11-30 21:11:34,334 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1', '0.786'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.707')]
2025-11-30 21:11:34,334 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.784'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.772')]
2025-11-30 21:11:34,334 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_5', '0.666'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.658')]
2025-11-30 21:11:34,334 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1', '0.623'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.607')]
2025-11-30 21:11:34,334 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_1', '0.820'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.763')]
2025-11-30 21:11:34,334 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:11:34,334 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_0) (~230 words) with timeout=5.0s retries=3
2025-11-30 21:11:35,680 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:11:35,680 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:11:35,680 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_1) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:11:36,911 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:11:36,911 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:11:36,912 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_2) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:11:37,925 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:11:37,925 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:11:37,925 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_3) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:11:39,216 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:11:39,216 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:11:39,217 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_4) (~125 words) with timeout=5.0s retries=3
2025-11-30 21:11:40,634 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:11:40,635 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:11:40,635 - src.components.pre_llm_injector - INFO - Extracted 26 local triplets from 5 chunks
2025-11-30 21:11:40,635 - src.pipeline.kg_builder - INFO - Pre-extraction: 26 triplets in 6.38s
2025-11-30 21:11:40,636 - src.components.global_refiner - INFO - Capping refinement input: 26 → 15 triplets
2025-11-30 21:11:40,636 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[USES]->(Balance / ID: 4_2), (Person / ID: 0_0)-[REMOVES]->(Beaker / ID: 8_1), (Balance / ID: 4_2)-[CONTAINS]->(Beaker / ID: 8_1), (Balance / ID: 4_2)-[DISPLAYS]->(Final_Mass / ID: 9_1), (Person / ID: 0_0)-[HOLDS]->(White_Plastic_Bottle / ID: 9_2), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Beaker / ID: 8_1)-[CONTAINS]->(White_Powdery_Substance / ID: 6_2), (White_Powdery_Substance / ID: 6_2)-[IS_DEPOSITED_IN]->(Beaker / ID: 8_1), (Balance / ID: 4_2)-[IS_INSIDE]->(Glass Draft Shield / ID: 8_1)
Subgraph_2: Subgraph: (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1), (Person / ID: 0_0)-[OBSERVES]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Workbench / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Apparatus / ID: 1_1), (Apparatus / ID: 1_1)-[IS_PART_OF]->(Laboratory Equipment / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Laboratory / ID: 0_1)-[CONTAINS]->(Glassware / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Cabinets / ID: 7_2), (Bottle / ID: 1_1)-[CONTAINS]->(White_Powdery_Substance / ID: 6_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["11_0", "11_1"]}, {"head": "Person", "relation": "Adds", "tail": "Liquid", "source_chunks": ["11_0"]}, {"head": "Liquid", "relation": "Is Transferred By", "tail": "Pipette", "source_chunks": ["11_0"]}, {"head": "Beaker", "relation": "Is Held Over", "tail": "Digital_Balance", "source_chunks": ["11_0"]}, {"head": "Beaker", "relation": "Is Inside", "tail": "Draft_Shield", "source_chunks": ["11_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Negative_Value", "source_chunks": ["11_0"]}, {"head": "Person", "relation": "Holds", "tail": "Wash_Bottle", "source_chunks": ["11_1"]}, {"head": "Wash_Bottle", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["11_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["11_1", "11_2"]}, {"head": "Balance", "relation": "Displays", "tail": "Negative_Weight", "source_chunks": ["11_1", "11_2"]}, {"head": "Balance", "relation": "Is Used For", "tail": "Weighing", "source_chunks": ["11_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["11_2", "11_3"]}, {"head": "Person", "relation": "Adds", "tail": "Solid_Substance", "source_chunks": ["11_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Solid_Substance", "source_chunks": ["11_2"]}, {"head": "Balance", "relation": "Measures", "tail": "Weight", "source_chunks": ["11_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:11:40,636 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~477 words, ~620 tokens)
2025-11-30 21:11:40,636 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:11:54,121 - src.components.global_refiner - DEBUG - LLM call completed in 13.48s
2025-11-30 21:11:54,121 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['11_0', '11_1']], ['Person', 'Adds', 'Liquid', ['11_0']], ['Liquid', 'Is Transferred By', 'Pipette', ['11_0']], ['Beaker', 'Is Held Over', 'Digital_Balance', ['11_0']], ['Beaker', 'Is Inside', 'Draft_Shield', ['11_0']], ['Digital_Balance', 'Displays', 'Negative_Value', ['11_0']], ['Person', 'Holds', 'Wash_Bottle', ['11_1']], ['Wash_Bottle', 'Dispenses', 'Liquid', ['11_1']], ['Beaker', 'Contains', 'Liquid', ['11_1', '11_2']], ['Balance', 'Displays', 'Negative_Weight', ['11_1', '11_2']], ['Balance', 'Is Used For', 'Weighing', ['11_1']], ['Person', 'Holds', 'Beaker', ['11_2', '11_3']], ['Person', 'Adds', 'Solid_Substance', ['11_2']], ['Beaker', 'Contains', 'Solid_Substance', ['11_2']], ['Balance', 'Measures', 'Weight', ['11_2']]] inter_chunk_relations=[['Digital_Balance', 'Displays', 'Final_Mass', ['11_0']], ['Balance', 'Displays', 'Negative_Weight', ['11_1', '11_2']], ['Beaker', 'Is Inside', 'Glass Draft Shield', ['11_0']], ['Person', 'Holds', 'White_Plastic_Bottle', ['11_1']], ['Person', 'Holds', 'Document', ['11_1']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_3'}, {'local': 'Digital_Balance', 'existing': 'Balance', 'existing_id': '4_2'}, {'local': 'Negative_Value', 'existing': 'Final_Mass', 'existing_id': '9_1'}, {'local': 'Negative_Weight', 'existing': 'Final_Mass', 'existing_id': '9_1'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}, {'head': 'Balance', 'relation': 'Displays', 'tail': 'Final_Mass'}, {'head': 'Beaker', 'relation': 'Is Inside', 'tail': 'Glass Draft Shield'}, {'head': 'Balance', 'relation': 'Is Used For', 'tail': 'Weighing'}]
2025-11-30 21:11:54,121 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['11_0', '11_1']], ['Person', 'Adds', 'Liquid', ['11_0']], ['Liquid', 'Is Transferred By', 'Pipette', ['11_0']]]
2025-11-30 21:11:54,121 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Digital_Balance', 'Displays', 'Final_Mass', ['11_0']], ['Balance', 'Displays', 'Negative_Weight', ['11_1', '11_2']], ['Beaker', 'Is Inside', 'Glass Draft Shield', ['11_0']]]
2025-11-30 21:11:54,122 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_3'}, {'local': 'Digital_Balance', 'existing': 'Balance', 'existing_id': '4_2'}, {'local': 'Negative_Value', 'existing': 'Final_Mass', 'existing_id': '9_1'}]
2025-11-30 21:11:54,122 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}, {'head': 'Balance', 'relation': 'Displays', 'tail': 'Final_Mass'}, {'head': 'Beaker', 'relation': 'Is Inside', 'tail': 'Glass Draft Shield'}]
2025-11-30 21:11:54,122 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_3'}, {'local': 'Digital_Balance', 'existing': 'Balance', 'existing_id': '4_2'}, {'local': 'Negative_Value', 'existing': 'Final_Mass', 'existing_id': '9_1'}, {'local': 'Negative_Weight', 'existing': 'Final_Mass', 'existing_id': '9_1'}]
2025-11-30 21:11:54,122 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}, {'head': 'Balance', 'relation': 'Displays', 'tail': 'Final_Mass'}, {'head': 'Beaker', 'relation': 'Is Inside', 'tail': 'Glass Draft Shield'}, {'head': 'Balance', 'relation': 'Is Used For', 'tail': 'Weighing'}]
2025-11-30 21:11:54,122 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 13.49s, LLM: 13.48s)
2025-11-30 21:11:54,122 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 13.49s
2025-11-30 21:11:54,122 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:11:54,122 - src.pipeline.kg_builder - INFO - Pushing batch 12/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:11:54,122 - src.components.neo4j_handler - INFO - Adding 19 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:11:54,346 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=164, relationships=140
2025-11-30 21:11:54,346 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:11:54,346 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue_Nitrile_Gloves -> Blue_Nitrile_Gloves
2025-11-30 21:11:54,347 - src.components.neo4j_handler - DEBUG - APOC merge successful: Digital_Balance -> Balance
2025-11-30 21:11:54,351 - src.components.neo4j_handler - DEBUG - APOC merge successful: Negative_Value -> Final_Mass
2025-11-30 21:11:54,354 - src.components.neo4j_handler - DEBUG - APOC merge successful: Negative_Weight -> Final_Mass
2025-11-30 21:11:54,354 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:11:54,356 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> No Glove
2025-11-30 21:11:54,358 - src.components.neo4j_handler - DEBUG - Pruned relationship: Balance -[Displays]-> Final_Mass
2025-11-30 21:11:54,359 - src.components.neo4j_handler - DEBUG - Pruned relationship: Beaker -[Is Inside]-> Glass Draft Shield
2025-11-30 21:11:54,360 - src.components.neo4j_handler - DEBUG - Pruned relationship: Balance -[Is Used For]-> Weighing
2025-11-30 21:11:54,360 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:11:54,361 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Digital_Balance -[Displays]-> Final_Mass
2025-11-30 21:11:54,381 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Balance -[Displays]-> Negative_Weight
2025-11-30 21:11:54,383 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Is Inside]-> Glass Draft Shield
2025-11-30 21:11:54,385 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> White_Plastic_Bottle
2025-11-30 21:11:54,387 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Document
2025-11-30 21:11:54,388 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:11:54,394 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=161, relationships=135
2025-11-30 21:11:54,397 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:11:54,397 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:11:54,397 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:11:54,397 - src.components.neo4j_handler - INFO - Batch injected in 0.27s (triplets: 0.27s, indexes: 0.00s)
2025-11-30 21:11:54,398 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 55, 'with_embedding': 55, 'linked_chunks': 43}
2025-11-30 21:11:54,398 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:11:54,410 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 161 nodes
2025-11-30 21:11:54,430 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 149 nodes
2025-11-30 21:11:54,458 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 161, 'relationship_count': 381, 'density': 0.0148, 'avg_degree': 4.7329, 'avg_unique_neighbors': 4.6708, 'global_efficiency': 0.3373, 'avg_path_length': 2.7939, 'avg_degree_centrality': 0.0296, 'max_degree_centrality': 0.4875, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0169, 'degree_assortativity': -0.2531, 'graph_robustness': 0.8609, 'diameter_estimate': 4, 'clustering_coefficient': 0.2597, 'weakly_connected_components': 13, 'largest_wcc_size': 149, 'pagerank_top10_percent': 17.78, 'louvain_communities': 22, 'louvain_modularity': 0.5153, 'label_entropy': 1.4632, 'computational_time': 0.06033153797034174}
2025-11-30 21:11:54,458 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 11, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508314.458869, 'total_time': 20.21329067298211, 'aggregation': 3.1440285965800285e-06, 'network_info': 0.005769758950918913, 'llm_extraction': 19.870884895906784, 'data_cleaning': 3.93999507650733e-05, 'neo4j_injection': 0.2750399640062824, 'embedding_time': 0, 'indexing_time': 0.002992262947373092, 'graph_injection_time': 0.271693788934499, 'acs_metrics': {'node_count': 161, 'relationship_count': 381, 'density': 0.0148, 'avg_degree': 4.7329, 'avg_unique_neighbors': 4.6708, 'global_efficiency': 0.3373, 'avg_path_length': 2.7939, 'avg_degree_centrality': 0.0296, 'max_degree_centrality': 0.4875, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0169, 'degree_assortativity': -0.2531, 'graph_robustness': 0.8609, 'diameter_estimate': 4, 'clustering_coefficient': 0.2597, 'weakly_connected_components': 13, 'largest_wcc_size': 149, 'pagerank_top10_percent': 17.78, 'louvain_communities': 22, 'louvain_modularity': 0.5153, 'label_entropy': 1.4632, 'computational_time': 0.06033153797034174}, 'retrieval_queries': []}
2025-11-30 21:11:54,458 - src.pipeline.kg_builder - DEBUG - Batch 11 metrics: {
  "batch_idx": 11,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508314.458869,
  "total_time": 20.21329067298211,
  "aggregation": 3.1440285965800285e-06,
  "network_info": 0.005769758950918913,
  "llm_extraction": 19.870884895906784,
  "data_cleaning": 3.93999507650733e-05,
  "neo4j_injection": 0.2750399640062824,
  "embedding_time": 0,
  "indexing_time": 0.002992262947373092,
  "graph_injection_time": 0.271693788934499,
  "acs_metrics": {
    "node_count": 161,
    "relationship_count": 381,
    "density": 0.0148,
    "avg_degree": 4.7329,
    "avg_unique_neighbors": 4.6708,
    "global_efficiency": 0.3373,
    "avg_path_length": 2.7939,
    "avg_degree_centrality": 0.0296,
    "max_degree_centrality": 0.4875,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0169,
    "degree_assortativity": -0.2531,
    "graph_robustness": 0.8609,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.2597,
    "weakly_connected_components": 13,
    "largest_wcc_size": 149,
    "pagerank_top10_percent": 17.78,
    "louvain_communities": 22,
    "louvain_modularity": 0.5153,
    "label_entropy": 1.4632,
    "computational_time": 0.06033153797034174
  },
  "retrieval_queries": []
}
2025-11-30 21:11:54,459 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:11:54,459 - src.pipeline.kg_builder - INFO - Batch 12 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.87s, Clean: 0.00s, Neo4j: 0.28s, ACS: 0.06s
2025-11-30 21:11:54,459 - src.pipeline.kg_builder - INFO - Batch 12 completed in 20.21s
Processing KG batches:  17%|█▋        | 12/72 [04:57<22:23, 22.39s/it]2025-11-30 21:11:54,459 - src.pipeline.kg_builder - INFO - Processing batch 13/72 (3 items)
2025-11-30 21:11:54,459 - src.pipeline.kg_builder - DEBUG - Batch 13 current_video_time: 03:09-03:14
2025-11-30 21:11:54,466 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 161
- Total Relationships: 135
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:11:54,466 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:11:54,466 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_0 ~214 words, content: Time: 02:59-03:04 Content: The sequence of images captures a laboratory procedure, likely the preparation of a chemical solution, from a first-person perspective. The setting is...
2025-11-30 21:11:54,466 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_1 ~236 words, content: of liquid to achieve a desired concentration. - **Final Setup:** The final frame shows the beaker, now containing the solid and the added liquid, being...
2025-11-30 21:11:54,466 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_2 ~215 words, content: notes. The background features a door, a cabinet, and a wall with a warning sign. The overall scene suggests a controlled and precise scientific procedure....
2025-11-30 21:11:54,466 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3 ~153 words, content: step. The balance's display changes to a negative value (`-56.302 g`), which is a common feature on analytical balances to tare or zero the scale...
2025-11-30 21:11:54,487 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:11:54,528 - src.components.pre_llm_injector - DEBUG - Found 55 existing chunk embeddings for similarity lookup
2025-11-30 21:11:54,540 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.836'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4', '0.794')]
2025-11-30 21:11:54,541 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4 via source_chunk_ids
2025-11-30 21:11:54,541 - src.components.pre_llm_injector - DEBUG - Found 4 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2
2025-11-30 21:11:54,541 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:11:54,545 - src.components.pre_llm_injector - DEBUG - Limited Person from 45 to 2 external connections
2025-11-30 21:11:54,545 - src.components.pre_llm_injector - DEBUG - Limited White_Powdery_Substance from 7 to 2 external connections
2025-11-30 21:11:54,545 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 59 total -> 11 (internal: 7, external: 4)
2025-11-30 21:11:54,545 - src.components.pre_llm_injector - DEBUG - Subgraph: (Metal_Spatula / ID: 6_2)-[TRANSFERS]->(White_Powdery_Substance / ID: 6_2), (Metal_Spatula / ID: 6_2)-[CONTAINS]->(White_Powdery_Substance / ID: 6_2), (Person / ID: 0_0)-[ADDS]->(White_Powdery_Substance / ID: 6_2), (Person / ID: 0_0)-[ADDS]->(White_Powdery_Substance / ID: 6_2), (Metal_Spatula / ID: 6_2)-[TRANSFERS]->(White_Powdery_Substance / ID: 6_2), (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[STANDS]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[ADDS]->(Liquid / ID: 4_0), (Beaker / ID: 8_1)-[CONTAINS]->(White_Powdery_Substance / ID: 6_2), (White_Powdery_Substance / ID: 6_2)-[IS_DEPOSITED_IN]->(Beaker / ID: 8_1)
2025-11-30 21:11:54,545 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1', '0.696'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_3', '0.644')]
2025-11-30 21:11:54,545 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.836'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_3', '0.778')]
2025-11-30 21:11:54,545 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4', '0.794'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_1', '0.792')]
2025-11-30 21:11:54,545 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.755'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_4', '0.745')]
2025-11-30 21:11:54,545 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:11:54,545 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_0) (~214 words) with timeout=5.0s retries=3
2025-11-30 21:11:56,464 - src.components.pre_llm_injector - DEBUG - Extracted 4 triplets from chunk 0 (attempt 1)
2025-11-30 21:11:56,464 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 4 triplets
2025-11-30 21:11:56,464 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_1) (~236 words) with timeout=5.0s retries=3
2025-11-30 21:11:57,501 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:11:57,501 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:11:57,502 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_2) (~215 words) with timeout=5.0s retries=3
2025-11-30 21:11:59,231 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:11:59,231 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:11:59,231 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3) (~153 words) with timeout=5.0s retries=3
2025-11-30 21:12:00,238 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:12:00,238 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:12:00,238 - src.components.pre_llm_injector - INFO - Extracted 19 local triplets from 4 chunks
2025-11-30 21:12:00,238 - src.pipeline.kg_builder - INFO - Pre-extraction: 19 triplets in 5.77s
2025-11-30 21:12:00,238 - src.components.global_refiner - INFO - Capping refinement input: 19 → 15 triplets
2025-11-30 21:12:00,239 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Metal_Spatula / ID: 6_2)-[TRANSFERS]->(White_Powdery_Substance / ID: 6_2), (Metal_Spatula / ID: 6_2)-[CONTAINS]->(White_Powdery_Substance / ID: 6_2), (Person / ID: 0_0)-[ADDS]->(White_Powdery_Substance / ID: 6_2), (Person / ID: 0_0)-[ADDS]->(White_Powdery_Substance / ID: 6_2), (Metal_Spatula / ID: 6_2)-[TRANSFERS]->(White_Powdery_Substance / ID: 6_2), (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[STANDS]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[ADDS]->(Liquid / ID: 4_0), (Beaker / ID: 8_1)-[CONTAINS]->(White_Powdery_Substance / ID: 6_2), (White_Powdery_Substance / ID: 6_2)-[IS_DEPOSITED_IN]->(Beaker / ID: 8_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["12_0", "12_2"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "5.302_G", "source_chunks": ["12_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "White_Powder", "source_chunks": ["12_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["12_0"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["12_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Solid", "source_chunks": ["12_1", "12_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["12_1", "12_3"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["12_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["12_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital Balance", "source_chunks": ["12_1"]}, {"head": "Person", "relation": "Pours", "tail": "Clear_Liquid", "source_chunks": ["12_2"]}, {"head": "Clear_Liquid", "relation": "Is Poured Into", "tail": "Glass_Beaker", "source_chunks": ["12_2"]}, {"head": "Glass_Beaker", "relation": "Is On", "tail": "Digital_Analytical_Balance", "source_chunks": ["12_2"]}, {"head": "Digital_Analytical_Balance", "relation": "Displays", "tail": "56.302_G", "source_chunks": ["12_2"]}, {"head": "Person", "relation": "Removes", "tail": "Glass_Beaker", "source_chunks": ["12_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:12:00,239 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~385 words, ~500 tokens)
2025-11-30 21:12:00,239 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:12:19,584 - src.components.global_refiner - DEBUG - LLM call completed in 19.34s
2025-11-30 21:12:19,584 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['12_0', '12_2']], ['Digital_Balance', 'Displays', '5.302_G', ['12_0']], ['Beaker', 'Contains', 'White_Powder', ['12_0']], ['Beaker', 'Contains', 'Clear_Liquid', ['12_0']], ['Person', 'Holds', 'Beaker', ['12_1']], ['Beaker', 'Contains', 'Solid', ['12_1', '12_3']], ['Beaker', 'Contains', 'Liquid', ['12_1', '12_3']], ['Person', 'Uses', 'Pipette', ['12_1']], ['Pipette', 'Transfers', 'Liquid', ['12_1']], ['Beaker', 'Is On', 'Digital Balance', ['12_1']], ['Person', 'Pours', 'Clear_Liquid', ['12_2']], ['Clear_Liquid', 'Is Poured Into', 'Glass_Beaker', ['12_2']], ['Glass_Beaker', 'Is On', 'Digital_Analytical_Balance', ['12_2']], ['Digital_Analytical_Balance', 'Displays', '56.302_G', ['12_2']], ['Person', 'Removes', 'Glass_Beaker', ['12_2']]] inter_chunk_relations=[['Beaker', 'Contains', 'White_Powdery_Substance', ['12_0']], ['Beaker', 'Contains', 'Clear_Liquid', ['12_0']], ['Beaker', 'Is On', 'Digital Balance', ['12_1']], ['Glass_Beaker', 'Is On', 'Digital_Analytical_Balance', ['12_2']], ['Person', 'Holds', 'Beaker', ['12_1']], ['Person', 'Pours', 'Clear_Liquid', ['12_2']], ['Clear_Liquid', 'Is Poured Into', 'Glass_Beaker', ['12_2']], ['Digital_Analytical_Balance', 'Displays', '56.302_G', ['12_2']], ['Person', 'Removes', 'Glass_Beaker', ['12_2']]] merge_instructions=[{'local': 'White_Powder', 'existing': 'White_Powdery_Substance', 'existing_id': '6_2'}, {'local': 'Clear_Liquid', 'existing': 'Liquid', 'existing_id': '4_0'}, {'local': 'Solid', 'existing': 'White_Powdery_Substance', 'existing_id': '6_2'}, {'local': 'Glass_Beaker', 'existing': 'Beaker', 'existing_id': '8_1'}] prune_instructions=[{'head': 'Beaker', 'relation': 'Contains', 'tail': 'White_Powdery_Substance'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Clear_Liquid'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Solid'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Beaker'}, {'head': 'Beaker', 'relation': 'Is On', 'tail': 'Digital Balance'}, {'head': 'Person', 'relation': 'Pours', 'tail': 'Clear_Liquid'}, {'head': 'Clear_Liquid', 'relation': 'Is Poured Into', 'tail': 'Glass_Beaker'}, {'head': 'Glass_Beaker', 'relation': 'Is On', 'tail': 'Digital_Analytical_Balance'}, {'head': 'Digital_Analytical_Balance', 'relation': 'Displays', 'tail': '56.302_G'}, {'head': 'Person', 'relation': 'Removes', 'tail': 'Glass_Beaker'}]
2025-11-30 21:12:19,584 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['12_0', '12_2']], ['Digital_Balance', 'Displays', '5.302_G', ['12_0']], ['Beaker', 'Contains', 'White_Powder', ['12_0']]]
2025-11-30 21:12:19,584 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=9, sample=[['Beaker', 'Contains', 'White_Powdery_Substance', ['12_0']], ['Beaker', 'Contains', 'Clear_Liquid', ['12_0']], ['Beaker', 'Is On', 'Digital Balance', ['12_1']]]
2025-11-30 21:12:19,584 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'White_Powder', 'existing': 'White_Powdery_Substance', 'existing_id': '6_2'}, {'local': 'Clear_Liquid', 'existing': 'Liquid', 'existing_id': '4_0'}, {'local': 'Solid', 'existing': 'White_Powdery_Substance', 'existing_id': '6_2'}]
2025-11-30 21:12:19,584 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=11, sample=[{'head': 'Beaker', 'relation': 'Contains', 'tail': 'White_Powdery_Substance'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Clear_Liquid'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Solid'}]
2025-11-30 21:12:19,584 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'White_Powder', 'existing': 'White_Powdery_Substance', 'existing_id': '6_2'}, {'local': 'Clear_Liquid', 'existing': 'Liquid', 'existing_id': '4_0'}, {'local': 'Solid', 'existing': 'White_Powdery_Substance', 'existing_id': '6_2'}, {'local': 'Glass_Beaker', 'existing': 'Beaker', 'existing_id': '8_1'}]
2025-11-30 21:12:19,584 - src.components.global_refiner - INFO - LLM suggested 11 triplets to prune: [{'head': 'Beaker', 'relation': 'Contains', 'tail': 'White_Powdery_Substance'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Clear_Liquid'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Solid'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Beaker'}, {'head': 'Beaker', 'relation': 'Is On', 'tail': 'Digital Balance'}, {'head': 'Person', 'relation': 'Pours', 'tail': 'Clear_Liquid'}, {'head': 'Clear_Liquid', 'relation': 'Is Poured Into', 'tail': 'Glass_Beaker'}, {'head': 'Glass_Beaker', 'relation': 'Is On', 'tail': 'Digital_Analytical_Balance'}, {'head': 'Digital_Analytical_Balance', 'relation': 'Displays', 'tail': '56.302_G'}, {'head': 'Person', 'relation': 'Removes', 'tail': 'Glass_Beaker'}]
2025-11-30 21:12:19,584 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 24 triplets (total: 19.35s, LLM: 19.34s)
2025-11-30 21:12:19,584 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 19.35s
2025-11-30 21:12:19,584 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:12:19,584 - src.pipeline.kg_builder - INFO - Pushing batch 13/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:12:19,584 - src.components.neo4j_handler - INFO - Adding 16 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:12:19,786 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=171, relationships=145
2025-11-30 21:12:19,786 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:12:19,787 - src.components.neo4j_handler - DEBUG - APOC merge successful: White_Powder -> White_Powdery_Substance
2025-11-30 21:12:19,794 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear_Liquid -> Liquid
2025-11-30 21:12:19,850 - src.components.neo4j_handler - DEBUG - APOC merge successful: Solid -> White_Powdery_Substance
2025-11-30 21:12:19,855 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass_Beaker -> Beaker
2025-11-30 21:12:19,855 - src.components.neo4j_handler - INFO - Applying 11 prune instructions
2025-11-30 21:12:19,867 - src.components.neo4j_handler - DEBUG - Pruned relationship: Beaker -[Contains]-> White_Powdery_Substance
2025-11-30 21:12:19,868 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Beaker -[Contains]-> Clear_Liquid
2025-11-30 21:12:19,868 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Beaker -[Contains]-> Solid
2025-11-30 21:12:19,874 - src.components.neo4j_handler - DEBUG - Pruned relationship: Beaker -[Contains]-> Liquid
2025-11-30 21:12:19,880 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Beaker
2025-11-30 21:12:19,885 - src.components.neo4j_handler - DEBUG - Pruned relationship: Beaker -[Is On]-> Digital Balance
2025-11-30 21:12:19,908 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Pours]-> Clear_Liquid
2025-11-30 21:12:19,930 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Clear_Liquid -[Is Poured Into]-> Glass_Beaker
2025-11-30 21:12:19,931 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Glass_Beaker -[Is On]-> Digital_Analytical_Balance
2025-11-30 21:12:19,934 - src.components.neo4j_handler - DEBUG - Pruned relationship: Digital_Analytical_Balance -[Displays]-> 56.302_G
2025-11-30 21:12:19,955 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Removes]-> Glass_Beaker
2025-11-30 21:12:19,956 - src.components.neo4j_handler - INFO - Applying 9 inter-chunk relations
2025-11-30 21:12:19,962 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Contains]-> White_Powdery_Substance
2025-11-30 21:12:19,963 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Contains]-> Clear_Liquid
2025-11-30 21:12:19,972 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Is On]-> Digital Balance
2025-11-30 21:12:19,974 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Glass_Beaker -[Is On]-> Digital_Analytical_Balance
2025-11-30 21:12:19,977 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Beaker
2025-11-30 21:12:20,004 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Pours]-> Clear_Liquid
2025-11-30 21:12:20,029 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Clear_Liquid -[Is Poured Into]-> Glass_Beaker
2025-11-30 21:12:20,034 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital_Analytical_Balance -[Displays]-> 56.302_G
2025-11-30 21:12:20,061 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Removes]-> Glass_Beaker
2025-11-30 21:12:20,062 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:12:20,067 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=167, relationships=137
2025-11-30 21:12:20,068 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:12:20,068 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:12:20,069 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:12:20,069 - src.components.neo4j_handler - INFO - Batch injected in 0.48s (triplets: 0.48s, indexes: 0.00s)
2025-11-30 21:12:20,070 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 59, 'with_embedding': 59, 'linked_chunks': 47}
2025-11-30 21:12:20,070 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:12:20,090 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 167 nodes
2025-11-30 21:12:20,119 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 155 nodes
2025-11-30 21:12:20,152 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 167, 'relationship_count': 402, 'density': 0.0145, 'avg_degree': 4.8144, 'avg_unique_neighbors': 4.7665, 'global_efficiency': 0.3397, 'avg_path_length': 2.7875, 'avg_degree_centrality': 0.029, 'max_degree_centrality': 0.4819, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0216, 'degree_assortativity': -0.2433, 'graph_robustness': 0.8234, 'diameter_estimate': 4, 'clustering_coefficient': 0.2653, 'weakly_connected_components': 13, 'largest_wcc_size': 155, 'pagerank_top10_percent': 17.09, 'louvain_communities': 21, 'louvain_modularity': 0.4931, 'label_entropy': 1.4685, 'computational_time': 0.08142936008516699}
2025-11-30 21:12:20,152 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 12, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508340.1522114, 'total_time': 25.692730942042544, 'aggregation': 2.3649772629141808e-06, 'network_info': 0.006864066002890468, 'llm_extraction': 25.118093949975446, 'data_cleaning': 4.1045015677809715e-05, 'neo4j_injection': 0.4845281329471618, 'embedding_time': 0, 'indexing_time': 0.0017146520549431443, 'graph_injection_time': 0.4825580089818686, 'acs_metrics': {'node_count': 167, 'relationship_count': 402, 'density': 0.0145, 'avg_degree': 4.8144, 'avg_unique_neighbors': 4.7665, 'global_efficiency': 0.3397, 'avg_path_length': 2.7875, 'avg_degree_centrality': 0.029, 'max_degree_centrality': 0.4819, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0216, 'degree_assortativity': -0.2433, 'graph_robustness': 0.8234, 'diameter_estimate': 4, 'clustering_coefficient': 0.2653, 'weakly_connected_components': 13, 'largest_wcc_size': 155, 'pagerank_top10_percent': 17.09, 'louvain_communities': 21, 'louvain_modularity': 0.4931, 'label_entropy': 1.4685, 'computational_time': 0.08142936008516699}, 'retrieval_queries': []}
2025-11-30 21:12:20,152 - src.pipeline.kg_builder - DEBUG - Batch 12 metrics: {
  "batch_idx": 12,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508340.1522114,
  "total_time": 25.692730942042544,
  "aggregation": 2.3649772629141808e-06,
  "network_info": 0.006864066002890468,
  "llm_extraction": 25.118093949975446,
  "data_cleaning": 4.1045015677809715e-05,
  "neo4j_injection": 0.4845281329471618,
  "embedding_time": 0,
  "indexing_time": 0.0017146520549431443,
  "graph_injection_time": 0.4825580089818686,
  "acs_metrics": {
    "node_count": 167,
    "relationship_count": 402,
    "density": 0.0145,
    "avg_degree": 4.8144,
    "avg_unique_neighbors": 4.7665,
    "global_efficiency": 0.3397,
    "avg_path_length": 2.7875,
    "avg_degree_centrality": 0.029,
    "max_degree_centrality": 0.4819,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0216,
    "degree_assortativity": -0.2433,
    "graph_robustness": 0.8234,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.2653,
    "weakly_connected_components": 13,
    "largest_wcc_size": 155,
    "pagerank_top10_percent": 17.09,
    "louvain_communities": 21,
    "louvain_modularity": 0.4931,
    "label_entropy": 1.4685,
    "computational_time": 0.08142936008516699
  },
  "retrieval_queries": []
}
2025-11-30 21:12:20,152 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:12:20,152 - src.pipeline.kg_builder - INFO - Batch 13 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 25.12s, Clean: 0.00s, Neo4j: 0.48s, ACS: 0.08s
2025-11-30 21:12:20,152 - src.pipeline.kg_builder - INFO - Batch 13 completed in 25.69s
Processing KG batches:  18%|█▊        | 13/72 [05:23<22:59, 23.39s/it]2025-11-30 21:12:20,152 - src.pipeline.kg_builder - INFO - Processing batch 14/72 (3 items)
2025-11-30 21:12:20,152 - src.pipeline.kg_builder - DEBUG - Batch 14 current_video_time: 03:24-03:29
2025-11-30 21:12:20,159 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 167
- Total Relationships: 137
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:12:20,159 - src.components.pre_llm_injector - DEBUG - Split content into 7 chunks (chunk_size=296, overlap=16)
2025-11-30 21:12:20,159 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_0 ~211 words, content: Time: 03:14-03:19 Content: The video sequence captures a scientific procedure, likely a titration or a similar quantitative analysis, being performed in a laboratory setting. The...
2025-11-30 21:12:20,159 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_1 ~236 words, content: or experiment instructions. - **Key Equipment:** The central focus is the analytical balance. The person's hands are positioned to place the beaker onto the balance's...
2025-11-30 21:12:20,159 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_2 ~248 words, content: fume hood. The primary activity involves the precise measurement and transfer of liquids, likely as part of a chemical synthesis or analysis process. In the...
2025-11-30 21:12:20,159 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_3 ~262 words, content: to a setup that includes a glass tube and a stand, which is used to hold the flask in place. The person is carefully handling...
2025-11-30 21:12:20,159 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_4 ~227 words, content: procedures involved in a laboratory setting. The use of protective gear, such as gloves, and the careful handling of equipment highlight the importance of safety...
2025-11-30 21:12:20,159 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_5 ~228 words, content: are using a pipette to transfer a liquid from the vial into the Erlenmeyer flask. The balance continues to display the negative weight, indicating the...
2025-11-30 21:12:20,159 - src.components.pre_llm_injector - DEBUG - Chunk[6] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_6 ~64 words, content: laboratory setting using a digital balance to precisely measure and add a substance to a flask. The negative weight on the balance indicates that the...
2025-11-30 21:12:20,180 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:12:20,234 - src.components.pre_llm_injector - DEBUG - Found 59 existing chunk embeddings for similarity lookup
2025-11-30 21:12:20,256 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.814'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.803')]
2025-11-30 21:12:20,258 - src.components.pre_llm_injector - DEBUG - Found 6 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2
2025-11-30 21:12:20,258 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:12:20,258 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3
2025-11-30 21:12:20,258 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:12:20,262 - src.components.pre_llm_injector - DEBUG - Limited Person from 47 to 2 external connections
2025-11-30 21:12:20,262 - src.components.pre_llm_injector - DEBUG - Limited Workbench from 3 to 2 external connections
2025-11-30 21:12:20,262 - src.components.pre_llm_injector - DEBUG - Limited Laboratory from 5 to 2 external connections
2025-11-30 21:12:20,262 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 60 total -> 11 (internal: 5, external: 6)
2025-11-30 21:12:20,262 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[OBSERVES]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Workbench / ID: 1_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Cabinets / ID: 7_2), (Person / ID: 0_0)-[HOLDS]->(White Pen / ID: 1_3), (Person / ID: 0_0)-[ADDS]->(Liquid / ID: 4_0), (Workbench / ID: 1_1)-[HOLDS]->(Apparatus / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Bottle / ID: 1_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Glassware / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance Scale / ID: 3_1)
2025-11-30 21:12:20,264 - src.components.pre_llm_injector - DEBUG - Limited Person from 50 to 2 external connections
2025-11-30 21:12:20,264 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 50 total -> 2 (internal: 0, external: 2)
2025-11-30 21:12:20,264 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[STANDS]->(Laboratory / ID: 0_1)
2025-11-30 21:12:20,264 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_0', '0.779'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_1', '0.740')]
2025-11-30 21:12:20,264 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.722'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.689')]
2025-11-30 21:12:20,264 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3', '0.712'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_0', '0.705')]
2025-11-30 21:12:20,264 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.625'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_1', '0.620')]
2025-11-30 21:12:20,264 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.704'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.693')]
2025-11-30 21:12:20,264 - src.components.pre_llm_injector - DEBUG - Chunk 5 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.626'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_3', '0.621')]
2025-11-30 21:12:20,264 - src.components.pre_llm_injector - DEBUG - Chunk 6 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.814'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.803')]
2025-11-30 21:12:20,264 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:12:20,265 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_0) (~211 words) with timeout=5.0s retries=3
2025-11-30 21:12:21,682 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:12:21,682 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:12:21,683 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_1) (~236 words) with timeout=5.0s retries=3
2025-11-30 21:12:22,931 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:12:22,932 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:12:22,932 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_2) (~248 words) with timeout=5.0s retries=3
2025-11-30 21:12:24,428 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:12:24,428 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:12:24,429 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_3) (~262 words) with timeout=5.0s retries=3
2025-11-30 21:12:25,557 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:12:25,557 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:12:25,558 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_4) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:12:26,809 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:12:26,809 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:12:26,810 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_5) (~228 words) with timeout=5.0s retries=3
2025-11-30 21:12:27,975 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:12:27,975 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:12:27,975 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 6 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_6) (~64 words) with timeout=5.0s retries=3
2025-11-30 21:12:29,069 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 6 (attempt 1)
2025-11-30 21:12:29,069 - src.components.pre_llm_injector - DEBUG - Chunk 6 returned 6 triplets
2025-11-30 21:12:29,070 - src.components.pre_llm_injector - INFO - Extracted 35 local triplets from 7 chunks
2025-11-30 21:12:29,070 - src.pipeline.kg_builder - INFO - Pre-extraction: 35 triplets in 8.91s
2025-11-30 21:12:29,070 - src.components.global_refiner - INFO - Capping refinement input: 35 → 15 triplets
2025-11-30 21:12:29,070 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[OBSERVES]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Workbench / ID: 1_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Cabinets / ID: 7_2), (Person / ID: 0_0)-[HOLDS]->(White Pen / ID: 1_3), (Person / ID: 0_0)-[ADDS]->(Liquid / ID: 4_0), (Workbench / ID: 1_1)-[HOLDS]->(Apparatus / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Bottle / ID: 1_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Glassware / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance Scale / ID: 3_1)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[HOLDS]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[STANDS]->(Laboratory / ID: 0_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Nitrile_Gloves", "source_chunks": ["13_0"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["13_0", "13_1", "13_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["13_0", "13_2"]}, {"head": "Beaker", "relation": "Is Placed On", "tail": "Precision_Balance", "source_chunks": ["13_0"]}, {"head": "Precision_Balance", "relation": "Displays", "tail": "Negative_Weight_Reading", "source_chunks": ["13_0"]}, {"head": "Laboratory_Bench", "relation": "Contains", "tail": "Magnetic_Stirrer", "source_chunks": ["13_0"]}, {"head": "Person", "relation": "Places", "tail": "Beaker", "source_chunks": ["13_1"]}, {"head": "Beaker", "relation": "Is Placed On", "tail": "Analytical Balance", "source_chunks": ["13_1"]}, {"head": "Analytical Balance", "relation": "Has", "tail": "Glass Shield", "source_chunks": ["13_1"]}, {"head": "Glass Shield", "relation": "Is Open", "tail": "Analytical Balance", "source_chunks": ["13_1"]}, {"head": "Person", "relation": "Prepares To Place", "tail": "Beaker On Balance", "source_chunks": ["13_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["13_2"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "-56.302_G", "source_chunks": ["13_2"]}, {"head": "Person", "relation": "Places", "tail": "Glass_Flask", "source_chunks": ["13_2"]}, {"head": "Glass_Flask", "relation": "Is Connected To", "tail": "Magnetic_Stirrer", "source_chunks": ["13_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:12:29,070 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~414 words, ~538 tokens)
2025-11-30 21:12:29,070 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:12:44,704 - src.components.global_refiner - DEBUG - LLM call completed in 15.63s
2025-11-30 21:12:44,705 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Nitrile_Gloves', ['13_0']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['13_2']], ['Person', 'Holds', 'Beaker', ['13_0', '13_1', '13_2']], ['Beaker', 'Contains', 'Clear_Liquid', ['13_0', '13_2']], ['Beaker', 'Is Placed On', 'Precision_Balance', ['13_0']], ['Precision_Balance', 'Displays', 'Negative_Weight_Reading', ['13_0']], ['Laboratory_Bench', 'Contains', 'Magnetic_Stirrer', ['13_0']], ['Person', 'Places', 'Beaker', ['13_1']], ['Beaker', 'Is Placed On', 'Analytical Balance', ['13_1']], ['Analytical Balance', 'Has', 'Glass Shield', ['13_1']], ['Glass Shield', 'Is Open', 'Analytical Balance', ['13_1']], ['Person', 'Prepares To Place', 'Beaker On Balance', ['13_1']], ['Digital_Balance', 'Displays', '-56.302_G', ['13_2']], ['Person', 'Places', 'Glass_Flask', ['13_2']], ['Glass_Flask', 'Is Connected To', 'Magnetic_Stirrer', ['13_2']]] inter_chunk_relations=[['Beaker', 'Is Placed On', 'Precision_Balance', ['13_0']], ['Beaker', 'Is Placed On', 'Analytical Balance', ['13_1']], ['Digital_Balance', 'Displays', '-56.302_G', ['13_2']], ['Person', 'Holds', 'Beaker', ['13_0', '13_1', '13_2']], ['Person', 'Wears', 'Nitrile_Gloves', ['13_0']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['13_2']]] merge_instructions=[{'local': 'Nitrile_Gloves', 'existing': 'Nitrile_Gloves', 'existing_id': '0_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_0'}, {'local': 'Precision_Balance', 'existing': 'Balance Scale', 'existing_id': '3_1'}, {'local': 'Analytical Balance', 'existing': 'Balance Scale', 'existing_id': '3_1'}, {'local': 'Digital_Balance', 'existing': 'Balance Scale', 'existing_id': '3_1'}] prune_instructions=[{'head': 'Person', 'relation': 'Holds', 'tail': 'White Pen'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Equipment'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}]
2025-11-30 21:12:44,705 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Nitrile_Gloves', ['13_0']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['13_2']], ['Person', 'Holds', 'Beaker', ['13_0', '13_1', '13_2']]]
2025-11-30 21:12:44,705 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=6, sample=[['Beaker', 'Is Placed On', 'Precision_Balance', ['13_0']], ['Beaker', 'Is Placed On', 'Analytical Balance', ['13_1']], ['Digital_Balance', 'Displays', '-56.302_G', ['13_2']]]
2025-11-30 21:12:44,705 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=5, sample=[{'local': 'Nitrile_Gloves', 'existing': 'Nitrile_Gloves', 'existing_id': '0_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_0'}, {'local': 'Precision_Balance', 'existing': 'Balance Scale', 'existing_id': '3_1'}]
2025-11-30 21:12:44,705 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Holds', 'tail': 'White Pen'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Equipment'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Nitrile_Gloves'}]
2025-11-30 21:12:44,705 - src.components.global_refiner - INFO - LLM suggested 5 entity merges: [{'local': 'Nitrile_Gloves', 'existing': 'Nitrile_Gloves', 'existing_id': '0_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_0'}, {'local': 'Precision_Balance', 'existing': 'Balance Scale', 'existing_id': '3_1'}, {'local': 'Analytical Balance', 'existing': 'Balance Scale', 'existing_id': '3_1'}, {'local': 'Digital_Balance', 'existing': 'Balance Scale', 'existing_id': '3_1'}]
2025-11-30 21:12:44,705 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Holds', 'tail': 'White Pen'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Equipment'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}]
2025-11-30 21:12:44,705 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 21 triplets (total: 15.63s, LLM: 15.63s)
2025-11-30 21:12:44,705 - src.pipeline.kg_builder - INFO - Global refinement: 21 triplets in 15.64s
2025-11-30 21:12:44,705 - src.pipeline.kg_builder - INFO - Using 21 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:12:44,705 - src.pipeline.kg_builder - INFO - Pushing batch 14/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:12:44,705 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:12:44,901 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=184, relationships=150
2025-11-30 21:12:44,901 - src.components.neo4j_handler - INFO - Applying 5 merge instructions
2025-11-30 21:12:44,901 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Nitrile_Gloves -> Nitrile_Gloves
2025-11-30 21:12:44,901 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue_Nitrile_Gloves -> Blue_Nitrile_Gloves
2025-11-30 21:12:44,902 - src.components.neo4j_handler - DEBUG - APOC merge successful: Precision_Balance -> Balance Scale
2025-11-30 21:12:44,905 - src.components.neo4j_handler - DEBUG - APOC merge successful: Analytical Balance -> Balance Scale
2025-11-30 21:12:44,908 - src.components.neo4j_handler - DEBUG - APOC merge successful: Digital_Balance -> Balance Scale
2025-11-30 21:12:44,908 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:12:44,911 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> White Pen
2025-11-30 21:12:44,912 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Equipment
2025-11-30 21:12:44,914 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Nitrile_Gloves
2025-11-30 21:12:44,915 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:12:44,915 - src.components.neo4j_handler - INFO - Applying 6 inter-chunk relations
2025-11-30 21:12:44,918 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Is Placed On]-> Precision_Balance
2025-11-30 21:12:44,919 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Is Placed On]-> Analytical Balance
2025-11-30 21:12:44,919 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Digital_Balance -[Displays]-> -56.302_G
2025-11-30 21:12:44,921 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Beaker
2025-11-30 21:12:44,922 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Nitrile_Gloves
2025-11-30 21:12:44,923 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:12:44,923 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:12:44,928 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=181, relationships=148
2025-11-30 21:12:44,929 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:12:44,929 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:12:44,930 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:12:44,930 - src.components.neo4j_handler - INFO - Batch injected in 0.22s (triplets: 0.22s, indexes: 0.00s)
2025-11-30 21:12:44,931 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 66, 'with_embedding': 66, 'linked_chunks': 50}
2025-11-30 21:12:44,931 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:12:44,952 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 181 nodes
2025-11-30 21:12:44,984 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 165 nodes
2025-11-30 21:12:45,018 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 181, 'relationship_count': 433, 'density': 0.0133, 'avg_degree': 4.7845, 'avg_unique_neighbors': 4.7293, 'global_efficiency': 0.3276, 'avg_path_length': 2.7834, 'avg_degree_centrality': 0.0266, 'max_degree_centrality': 0.4722, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0289, 'degree_assortativity': -0.2417, 'graph_robustness': 0.8083, 'diameter_estimate': 4, 'clustering_coefficient': 0.2634, 'weakly_connected_components': 17, 'largest_wcc_size': 165, 'pagerank_top10_percent': 15.75, 'louvain_communities': 24, 'louvain_modularity': 0.4907, 'label_entropy': 1.4732, 'computational_time': 0.08775022998452187}
2025-11-30 21:12:45,019 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 13, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508365.0190454, 'total_time': 24.866176718031056, 'aggregation': 4.600035026669502e-06, 'network_info': 0.006123762927018106, 'llm_extraction': 24.546136623015627, 'data_cleaning': 1.4069024473428726e-05, 'neo4j_injection': 0.22488684498239309, 'embedding_time': 0, 'indexing_time': 0.0014102590503171086, 'graph_injection_time': 0.22329008392989635, 'acs_metrics': {'node_count': 181, 'relationship_count': 433, 'density': 0.0133, 'avg_degree': 4.7845, 'avg_unique_neighbors': 4.7293, 'global_efficiency': 0.3276, 'avg_path_length': 2.7834, 'avg_degree_centrality': 0.0266, 'max_degree_centrality': 0.4722, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0289, 'degree_assortativity': -0.2417, 'graph_robustness': 0.8083, 'diameter_estimate': 4, 'clustering_coefficient': 0.2634, 'weakly_connected_components': 17, 'largest_wcc_size': 165, 'pagerank_top10_percent': 15.75, 'louvain_communities': 24, 'louvain_modularity': 0.4907, 'label_entropy': 1.4732, 'computational_time': 0.08775022998452187}, 'retrieval_queries': []}
2025-11-30 21:12:45,019 - src.pipeline.kg_builder - DEBUG - Batch 13 metrics: {
  "batch_idx": 13,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508365.0190454,
  "total_time": 24.866176718031056,
  "aggregation": 4.600035026669502e-06,
  "network_info": 0.006123762927018106,
  "llm_extraction": 24.546136623015627,
  "data_cleaning": 1.4069024473428726e-05,
  "neo4j_injection": 0.22488684498239309,
  "embedding_time": 0,
  "indexing_time": 0.0014102590503171086,
  "graph_injection_time": 0.22329008392989635,
  "acs_metrics": {
    "node_count": 181,
    "relationship_count": 433,
    "density": 0.0133,
    "avg_degree": 4.7845,
    "avg_unique_neighbors": 4.7293,
    "global_efficiency": 0.3276,
    "avg_path_length": 2.7834,
    "avg_degree_centrality": 0.0266,
    "max_degree_centrality": 0.4722,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0289,
    "degree_assortativity": -0.2417,
    "graph_robustness": 0.8083,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.2634,
    "weakly_connected_components": 17,
    "largest_wcc_size": 165,
    "pagerank_top10_percent": 15.75,
    "louvain_communities": 24,
    "louvain_modularity": 0.4907,
    "label_entropy": 1.4732,
    "computational_time": 0.08775022998452187
  },
  "retrieval_queries": []
}
2025-11-30 21:12:45,019 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:12:45,019 - src.pipeline.kg_builder - INFO - Batch 14 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 24.55s, Clean: 0.00s, Neo4j: 0.22s, ACS: 0.09s
2025-11-30 21:12:45,019 - src.pipeline.kg_builder - INFO - Batch 14 completed in 24.87s
Processing KG batches:  19%|█▉        | 14/72 [05:47<23:02, 23.84s/it]2025-11-30 21:12:45,019 - src.pipeline.kg_builder - INFO - Processing batch 15/72 (3 items)
2025-11-30 21:12:45,019 - src.pipeline.kg_builder - DEBUG - Batch 15 current_video_time: 03:39-03:44
2025-11-30 21:12:45,026 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 181
- Total Relationships: 148
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:12:45,026 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:12:45,026 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_0 ~211 words, content: Time: 03:29-03:34 Content: The sequence of images captures a detailed laboratory procedure, likely the preparation of a chemical solution. The perspective is first-person, showing the...
2025-11-30 21:12:45,026 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_1 ~196 words, content: etric flask, possibly to add a reagent. In frame 5, the scientist is seen using a pipette to transfer a liquid from a beaker into...
2025-11-30 21:12:45,026 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_2 ~230 words, content: Content: The sequence of frames captures a detailed process in a laboratory setting, focusing on the precise measurement and transfer of a liquid. The scene...
2025-11-30 21:12:45,026 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_3 ~230 words, content: . Another person, dressed in a beige sweater and blue jeans, walks past in the background, indicating that the laboratory is active and not isolated....
2025-11-30 21:12:45,026 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_4 ~218 words, content: The reading on the balance fluctuates slightly, indicating the ongoing process of adding the liquid. - **Key Equipment and Environment:** - The person is wearing...
2025-11-30 21:12:45,026 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_5 ~33 words, content: , the pipette, and the balance highlights the importance of accuracy and precision in this scientific task. The entire sequence demonstrates a standard laboratory technique...
2025-11-30 21:12:45,046 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:12:45,098 - src.components.pre_llm_injector - DEBUG - Found 66 existing chunk embeddings for similarity lookup
2025-11-30 21:12:45,120 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3', '0.809'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.771')]
2025-11-30 21:12:45,122 - src.components.pre_llm_injector - DEBUG - Found 5 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1
2025-11-30 21:12:45,122 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:12:45,122 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3
2025-11-30 21:12:45,122 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:12:45,126 - src.components.pre_llm_injector - DEBUG - Limited Person from 46 to 2 external connections
2025-11-30 21:12:45,126 - src.components.pre_llm_injector - DEBUG - Limited Equipment from 8 to 2 external connections
2025-11-30 21:12:45,126 - src.components.pre_llm_injector - DEBUG - Limited Liquid from 8 to 2 external connections
2025-11-30 21:12:45,126 - src.components.pre_llm_injector - DEBUG - Limited Magnetic_Stirrer from 5 to 2 external connections
2025-11-30 21:12:45,126 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 75 total -> 16 (internal: 8, external: 8)
2025-11-30 21:12:45,126 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[TARES]->(Equipment / ID: 1_0), (Equipment / ID: 1_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[USES]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[ADDS]->(Liquid / ID: 4_0), (Person / ID: 0_0)-[STIRS]->(Liquid / ID: 4_0), (Person / ID: 0_0)-[POURS]->(Liquid / ID: 4_0), (Liquid / ID: 4_0)-[IS_PART_OF]->(Chemical_Solution / ID: 5_1), (Person / ID: 0_0)-[USES]->(Ar Glasses / ID: 1_3), (Person / ID: 0_0)-[FILLS_OUT]->(Chemistry Experiment Report / ID: 2_1), (Laboratory Table / ID: 0_0)-[CONTAINS]->(Equipment / ID: 1_0), (Laboratory_Glassware / ID: 4_2)-[IS_POSITIONED_ON]->(Equipment / ID: 1_0), (Liquid / ID: 4_0)-[IS_TRANSFERRED_TO]->(Laboratory_Glassware / ID: 4_2), (Wash_Bottle / ID: 11_1)-[DISPENSES]->(Liquid / ID: 4_0), (Magnetic_Stirrer / ID: 4_2)-[ROTATES]->(Magnetic_Stir_Bar / ID: 5_0), (Magnetic_Stirrer / ID: 4_2)-[HOLDS]->(Laboratory_Glassware / ID: 4_2)
2025-11-30 21:12:45,127 - src.components.pre_llm_injector - DEBUG - Limited Beaker from 23 to 2 external connections
2025-11-30 21:12:45,127 - src.components.pre_llm_injector - DEBUG - Limited Liquid from 11 to 2 external connections
2025-11-30 21:12:45,127 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 35 total -> 5 (internal: 1, external: 4)
2025-11-30 21:12:45,127 - src.components.pre_llm_injector - DEBUG - Subgraph: (Liquid / ID: 4_0)-[IS_POURED_INTO]->(Beaker / ID: 8_1), (Beaker / ID: 8_1)-[IS_INSIDE]->(Glass Draft Shield / ID: 8_1), (Person / ID: 0_0)-[PLACES]->(Beaker / ID: 8_1), (Liquid / ID: 4_0)-[IS_TRANSFERRED_TO]->(Laboratory_Glassware / ID: 4_2), (Laboratory_Glassware / ID: 4_2)-[CONTAINS]->(Liquid / ID: 4_0)
2025-11-30 21:12:45,127 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_2', '0.653'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_2', '0.642')]
2025-11-30 21:12:45,127 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_1', '0.525'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_4', '0.499')]
2025-11-30 21:12:45,127 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_0', '0.655'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.625')]
2025-11-30 21:12:45,127 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3', '0.809'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.771')]
2025-11-30 21:12:45,127 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_3', '0.724'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.690')]
2025-11-30 21:12:45,127 - src.components.pre_llm_injector - DEBUG - Chunk 5 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.639'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_3', '0.630')]
2025-11-30 21:12:45,127 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:12:45,128 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_0) (~211 words) with timeout=5.0s retries=3
2025-11-30 21:12:46,476 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:12:46,476 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:12:46,476 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_1) (~196 words) with timeout=5.0s retries=3
2025-11-30 21:12:47,534 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:12:47,534 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:12:47,534 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_2) (~230 words) with timeout=5.0s retries=3
2025-11-30 21:12:48,831 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:12:48,831 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:12:48,832 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_3) (~230 words) with timeout=5.0s retries=3
2025-11-30 21:12:49,928 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:12:49,928 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:12:49,929 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_4) (~218 words) with timeout=5.0s retries=3
2025-11-30 21:12:50,935 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:12:50,935 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:12:50,935 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_5) (~33 words) with timeout=5.0s retries=3
2025-11-30 21:12:52,372 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:12:52,373 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:12:52,373 - src.components.pre_llm_injector - INFO - Extracted 29 local triplets from 6 chunks
2025-11-30 21:12:52,373 - src.pipeline.kg_builder - INFO - Pre-extraction: 29 triplets in 7.35s
2025-11-30 21:12:52,373 - src.components.global_refiner - INFO - Capping refinement input: 29 → 15 triplets
2025-11-30 21:12:52,373 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[TARES]->(Equipment / ID: 1_0), (Equipment / ID: 1_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[USES]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[ADDS]->(Liquid / ID: 4_0), (Person / ID: 0_0)-[STIRS]->(Liquid / ID: 4_0), (Person / ID: 0_0)-[POURS]->(Liquid / ID: 4_0), (Liquid / ID: 4_0)-[IS_PART_OF]->(Chemical_Solution / ID: 5_1), (Person / ID: 0_0)-[USES]->(Ar Glasses / ID: 1_3), (Person / ID: 0_0)-[FILLS_OUT]->(Chemistry Experiment Report / ID: 2_1), (Laboratory Table / ID: 0_0)-[CONTAINS]->(Equipment / ID: 1_0), (Laboratory_Glassware / ID: 4_2)-[IS_POSITIONED_ON]->(Equipment / ID: 1_0), (Liquid / ID: 4_0)-[IS_TRANSFERRED_TO]->(Laboratory_Glassware / ID: 4_2), (Wash_Bottle / ID: 11_1)-[DISPENSES]->(Liquid / ID: 4_0), (Magnetic_Stirrer / ID: 4_2)-[ROTATES]->(Magnetic_Stir_Bar / ID: 5_0), (Magnetic_Stirrer / ID: 4_2)-[HOLDS]->(Laboratory_Glassware / ID: 4_2)
Subgraph_2: Subgraph: (Liquid / ID: 4_0)-[IS_POURED_INTO]->(Beaker / ID: 8_1), (Beaker / ID: 8_1)-[IS_INSIDE]->(Glass Draft Shield / ID: 8_1), (Person / ID: 0_0)-[PLACES]->(Beaker / ID: 8_1), (Liquid / ID: 4_0)-[IS_TRANSFERRED_TO]->(Laboratory_Glassware / ID: 4_2), (Laboratory_Glassware / ID: 4_2)-[CONTAINS]->(Liquid / ID: 4_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Scientist", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["14_0"]}, {"head": "Scientist", "relation": "Places", "tail": "Glass_Vial", "source_chunks": ["14_0"]}, {"head": "Glass_Vial", "relation": "Is On", "tail": "Precision_Balance", "source_chunks": ["14_0"]}, {"head": "Precision_Balance", "relation": "Displays", "tail": "Negative_Weight", "source_chunks": ["14_0"]}, {"head": "Scientist", "relation": "Uses", "tail": "Pipette", "source_chunks": ["14_0", "14_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["14_0", "14_1", "14_2", "14_3"]}, {"head": "Liquid", "relation": "Comes From", "tail": "Beaker", "source_chunks": ["14_1"]}, {"head": "Liquid", "relation": "Goes To", "tail": "Test Tube", "source_chunks": ["14_1"]}, {"head": "Scientist", "relation": "Holds", "tail": "Beaker", "source_chunks": ["14_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["14_1", "14_4"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["14_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["14_2", "14_3", "14_4"]}, {"head": "Liquid", "relation": "Is In", "tail": "Beaker", "source_chunks": ["14_2"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Volumetric_Flask", "source_chunks": ["14_2"]}, {"head": "Person", "relation": "Walks Past", "tail": "Laboratory_Equipment", "source_chunks": ["14_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:12:52,374 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~470 words, ~611 tokens)
2025-11-30 21:12:52,374 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:13:06,576 - src.components.global_refiner - DEBUG - LLM call completed in 14.20s
2025-11-30 21:13:06,576 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Scientist', 'Wears', 'Blue_Nitrile_Gloves', ['14_0']], ['Scientist', 'Places', 'Glass_Vial', ['14_0']], ['Glass_Vial', 'Is On', 'Precision_Balance', ['14_0']], ['Precision_Balance', 'Displays', 'Negative_Weight', ['14_0']], ['Scientist', 'Uses', 'Pipette', ['14_0', '14_1']], ['Pipette', 'Transfers', 'Liquid', ['14_0', '14_1', '14_2', '14_3']], ['Liquid', 'Comes From', 'Beaker', ['14_1']], ['Liquid', 'Goes To', 'Test Tube', ['14_1']], ['Scientist', 'Holds', 'Beaker', ['14_1']], ['Beaker', 'Contains', 'Liquid', ['14_1', '14_4']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['14_2']], ['Person', 'Uses', 'Pipette', ['14_2', '14_3', '14_4']], ['Liquid', 'Is In', 'Beaker', ['14_2']], ['Liquid', 'Is Transferred To', 'Volumetric_Flask', ['14_2']], ['Person', 'Walks Past', 'Laboratory_Equipment', ['14_2']]] inter_chunk_relations=[['Scientist', 'Wears', 'Ar Glasses', ['14_0']], ['Scientist', 'Uses', 'Pipette', ['14_0', '14_1']], ['Liquid', 'Is Transferred To', 'Volumetric_Flask', ['14_2']], ['Person', 'Walks Past', 'Laboratory_Equipment', ['14_2']], ['Scientist', 'Places', 'Glass_Vial', ['14_0']]] merge_instructions=[{'local': 'Scientist', 'existing': 'Person', 'existing_id': '0_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Pipette', 'existing': 'Pipette', 'existing_id': '1_2'}, {'local': 'Liquid', 'existing': 'Liquid', 'existing_id': '4_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Scientist', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Pipette'}, {'head': 'Scientist', 'relation': 'Uses', 'tail': 'Pipette'}]
2025-11-30 21:13:06,576 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Scientist', 'Wears', 'Blue_Nitrile_Gloves', ['14_0']], ['Scientist', 'Places', 'Glass_Vial', ['14_0']], ['Glass_Vial', 'Is On', 'Precision_Balance', ['14_0']]]
2025-11-30 21:13:06,576 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Scientist', 'Wears', 'Ar Glasses', ['14_0']], ['Scientist', 'Uses', 'Pipette', ['14_0', '14_1']], ['Liquid', 'Is Transferred To', 'Volumetric_Flask', ['14_2']]]
2025-11-30 21:13:06,576 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Scientist', 'existing': 'Person', 'existing_id': '0_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Pipette', 'existing': 'Pipette', 'existing_id': '1_2'}]
2025-11-30 21:13:06,576 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Scientist', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Pipette'}]
2025-11-30 21:13:06,576 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Scientist', 'existing': 'Person', 'existing_id': '0_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Pipette', 'existing': 'Pipette', 'existing_id': '1_2'}, {'local': 'Liquid', 'existing': 'Liquid', 'existing_id': '4_0'}]
2025-11-30 21:13:06,576 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Scientist', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Pipette'}, {'head': 'Scientist', 'relation': 'Uses', 'tail': 'Pipette'}]
2025-11-30 21:13:06,576 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 14.20s, LLM: 14.20s)
2025-11-30 21:13:06,576 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 14.20s
2025-11-30 21:13:06,577 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:13:06,577 - src.pipeline.kg_builder - INFO - Pushing batch 15/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:13:06,577 - src.components.neo4j_handler - INFO - Adding 16 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:13:06,732 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=193, relationships=161
2025-11-30 21:13:06,732 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:13:06,732 - src.components.neo4j_handler - DEBUG - APOC merge successful: Scientist -> Person
2025-11-30 21:13:06,736 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Glove
2025-11-30 21:13:06,736 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Pipette -> Pipette
2025-11-30 21:13:06,736 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Liquid -> Liquid
2025-11-30 21:13:06,736 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:13:06,739 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:13:06,740 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Scientist -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:13:06,741 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Uses]-> Pipette
2025-11-30 21:13:06,742 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Scientist -[Uses]-> Pipette
2025-11-30 21:13:06,742 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:13:06,742 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Scientist -[Wears]-> Ar Glasses
2025-11-30 21:13:06,742 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Scientist -[Uses]-> Pipette
2025-11-30 21:13:06,743 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Liquid -[Is Transferred To]-> Volumetric_Flask
2025-11-30 21:13:06,771 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Walks Past]-> Laboratory_Equipment
2025-11-30 21:13:06,771 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Scientist -[Places]-> Glass_Vial
2025-11-30 21:13:06,772 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:13:06,777 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=191, relationships=159
2025-11-30 21:13:06,778 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:13:06,778 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:13:06,778 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:13:06,778 - src.components.neo4j_handler - INFO - Batch injected in 0.20s (triplets: 0.20s, indexes: 0.00s)
2025-11-30 21:13:06,779 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 72, 'with_embedding': 72, 'linked_chunks': 55}
2025-11-30 21:13:06,779 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:13:06,802 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 191 nodes
2025-11-30 21:13:06,841 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 174 nodes
2025-11-30 21:13:06,878 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 191, 'relationship_count': 465, 'density': 0.0128, 'avg_degree': 4.8691, 'avg_unique_neighbors': 4.8063, 'global_efficiency': 0.3272, 'avg_path_length': 2.7795, 'avg_degree_centrality': 0.0256, 'max_degree_centrality': 0.4737, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0288, 'degree_assortativity': -0.2276, 'graph_robustness': 0.8172, 'diameter_estimate': 4, 'clustering_coefficient': 0.2663, 'weakly_connected_components': 18, 'largest_wcc_size': 174, 'pagerank_top10_percent': 14.96, 'louvain_communities': 27, 'louvain_modularity': 0.4805, 'label_entropy': 1.4779, 'computational_time': 0.09854570089373738}
2025-11-30 21:13:06,878 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 14, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508386.8786304, 'total_time': 21.858879836043343, 'aggregation': 2.7390196919441223e-06, 'network_info': 0.006423410959541798, 'llm_extraction': 21.550693189026788, 'data_cleaning': 3.518792800605297e-05, 'neo4j_injection': 0.20176505099516362, 'embedding_time': 0, 'indexing_time': 0.0017323860665783286, 'graph_injection_time': 0.1996753360144794, 'acs_metrics': {'node_count': 191, 'relationship_count': 465, 'density': 0.0128, 'avg_degree': 4.8691, 'avg_unique_neighbors': 4.8063, 'global_efficiency': 0.3272, 'avg_path_length': 2.7795, 'avg_degree_centrality': 0.0256, 'max_degree_centrality': 0.4737, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0288, 'degree_assortativity': -0.2276, 'graph_robustness': 0.8172, 'diameter_estimate': 4, 'clustering_coefficient': 0.2663, 'weakly_connected_components': 18, 'largest_wcc_size': 174, 'pagerank_top10_percent': 14.96, 'louvain_communities': 27, 'louvain_modularity': 0.4805, 'label_entropy': 1.4779, 'computational_time': 0.09854570089373738}, 'retrieval_queries': []}
2025-11-30 21:13:06,878 - src.pipeline.kg_builder - DEBUG - Batch 14 metrics: {
  "batch_idx": 14,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508386.8786304,
  "total_time": 21.858879836043343,
  "aggregation": 2.7390196919441223e-06,
  "network_info": 0.006423410959541798,
  "llm_extraction": 21.550693189026788,
  "data_cleaning": 3.518792800605297e-05,
  "neo4j_injection": 0.20176505099516362,
  "embedding_time": 0,
  "indexing_time": 0.0017323860665783286,
  "graph_injection_time": 0.1996753360144794,
  "acs_metrics": {
    "node_count": 191,
    "relationship_count": 465,
    "density": 0.0128,
    "avg_degree": 4.8691,
    "avg_unique_neighbors": 4.8063,
    "global_efficiency": 0.3272,
    "avg_path_length": 2.7795,
    "avg_degree_centrality": 0.0256,
    "max_degree_centrality": 0.4737,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0288,
    "degree_assortativity": -0.2276,
    "graph_robustness": 0.8172,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.2663,
    "weakly_connected_components": 18,
    "largest_wcc_size": 174,
    "pagerank_top10_percent": 14.96,
    "louvain_communities": 27,
    "louvain_modularity": 0.4805,
    "label_entropy": 1.4779,
    "computational_time": 0.09854570089373738
  },
  "retrieval_queries": []
}
2025-11-30 21:13:06,879 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:13:06,879 - src.pipeline.kg_builder - INFO - Batch 15 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 21.55s, Clean: 0.00s, Neo4j: 0.20s, ACS: 0.10s
2025-11-30 21:13:06,879 - src.pipeline.kg_builder - INFO - Batch 15 completed in 21.86s
Processing KG batches:  21%|██        | 15/72 [06:09<22:04, 23.24s/it]2025-11-30 21:13:06,879 - src.pipeline.kg_builder - INFO - Processing batch 16/72 (3 items)
2025-11-30 21:13:06,879 - src.pipeline.kg_builder - DEBUG - Batch 16 current_video_time: 03:54-03:59
2025-11-30 21:13:06,885 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 191
- Total Relationships: 159
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:13:06,885 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:13:06,885 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_15_0 ~215 words, content: Time: 03:44-03:49 Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a precise liquid transfer. The person is using...
2025-11-30 21:13:06,885 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_15_1 ~223 words, content: balance. The balance, a Mettler Toledo model, is actively being used to measure the mass of the liquid being transferred. The display on the balance...
2025-11-30 21:13:06,886 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_15_2 ~122 words, content: , which is resting on a digital balance. The digital balance, a Mettler Toledo model, is actively measuring the weight of the contents. The display...
2025-11-30 21:13:06,905 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:13:06,947 - src.components.pre_llm_injector - DEBUG - Found 72 existing chunk embeddings for similarity lookup
2025-11-30 21:13:06,958 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_3', '0.818'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.805')]
2025-11-30 21:13:06,960 - src.components.pre_llm_injector - DEBUG - Found 6 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2
2025-11-30 21:13:06,960 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:13:06,960 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_3 via source_chunk_ids
2025-11-30 21:13:06,965 - src.components.pre_llm_injector - DEBUG - Limited Person from 53 to 2 external connections
2025-11-30 21:13:06,965 - src.components.pre_llm_injector - DEBUG - Limited Workbench from 3 to 2 external connections
2025-11-30 21:13:06,965 - src.components.pre_llm_injector - DEBUG - Limited Laboratory from 5 to 2 external connections
2025-11-30 21:13:06,965 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 66 total -> 11 (internal: 5, external: 6)
2025-11-30 21:13:06,965 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[OBSERVES]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS]->(Laboratory / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Workbench / ID: 1_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Cabinets / ID: 7_2), (Person / ID: 0_0)-[WEARS]->(Cream-Colored Sweater / ID: 0_0), (Person / ID: 0_0)-[STIRS]->(Liquid / ID: 4_0), (Workbench / ID: 1_1)-[HOLDS]->(Apparatus / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Bottle / ID: 1_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Power Strip / ID: 3_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Lab Apparatus / ID: 3_1)
2025-11-30 21:13:06,965 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_4', '0.584'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_1', '0.561')]
2025-11-30 21:13:06,965 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_1', '0.767'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.743')]
2025-11-30 21:13:06,965 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_3', '0.818'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.805')]
2025-11-30 21:13:06,965 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:13:06,965 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_15_0) (~215 words) with timeout=5.0s retries=3
2025-11-30 21:13:08,151 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:13:08,152 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:13:08,152 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_15_1) (~223 words) with timeout=5.0s retries=3
2025-11-30 21:13:09,370 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:13:09,370 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:13:09,371 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_15_2) (~122 words) with timeout=5.0s retries=3
2025-11-30 21:13:10,554 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:13:10,554 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:13:10,554 - src.components.pre_llm_injector - INFO - Extracted 18 local triplets from 3 chunks
2025-11-30 21:13:10,554 - src.pipeline.kg_builder - INFO - Pre-extraction: 18 triplets in 3.67s
2025-11-30 21:13:10,555 - src.components.global_refiner - INFO - Capping refinement input: 18 → 15 triplets
2025-11-30 21:13:10,555 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[OBSERVES]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[STANDS]->(Laboratory / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Workbench / ID: 1_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Cabinets / ID: 7_2), (Person / ID: 0_0)-[WEARS]->(Cream-Colored Sweater / ID: 0_0), (Person / ID: 0_0)-[STIRS]->(Liquid / ID: 4_0), (Workbench / ID: 1_1)-[HOLDS]->(Apparatus / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Bottle / ID: 1_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Power Strip / ID: 3_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Lab Apparatus / ID: 3_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["15_0"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["15_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["15_0"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["15_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Weight", "source_chunks": ["15_0"]}, {"head": "Person", "relation": "Stabilizes", "tail": "Volumetric_Flask", "source_chunks": ["15_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["15_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Beaker", "source_chunks": ["15_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Pipette", "source_chunks": ["15_1"]}, {"head": "Glass Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["15_1"]}, {"head": "Glass Volumetric Flask", "relation": "Rests On", "tail": "Digital Balance", "source_chunks": ["15_1"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass Of Liquid", "source_chunks": ["15_1"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["15_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "Negative_Value", "source_chunks": ["15_2"]}, {"head": "Negative_Value", "relation": "Represents", "tail": "Tared_Weight", "source_chunks": ["15_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:13:10,555 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~394 words, ~512 tokens)
2025-11-30 21:13:10,555 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:13:29,923 - src.components.global_refiner - DEBUG - LLM call completed in 19.37s
2025-11-30 21:13:29,923 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['15_0']], ['Person', 'Holds', 'Beaker', ['15_0']], ['Person', 'Uses', 'Pipette', ['15_0']], ['Pipette', 'Transfers', 'Liquid', ['15_0']], ['Person', 'Stabilizes', 'Volumetric_Flask', ['15_0']], ['Person', 'Wears', 'Blue Nitrile Gloves', ['15_1']], ['Person', 'Holds', 'Glass Beaker', ['15_1']], ['Person', 'Holds', 'Glass Pipette', ['15_1']], ['Glass Pipette', 'Transfers', 'Liquid', ['15_1']], ['Glass Volumetric Flask', 'Rests On', 'Digital Balance', ['15_1']], ['Digital Balance', 'Measures', 'Mass Of Liquid', ['15_1']], ['Digital Balance', 'Measures', 'Mass', ['15_2']], ['Digital Balance', 'Displays', 'Negative_Value', ['15_2']], ['Negative_Value', 'Represents', 'Tared_Weight', ['15_2']]] inter_chunk_relations=[['Digital Balance', 'Displays', 'Power Strip', ['15_2']], ['Digital Balance', 'Measures', 'Mass', ['15_2']], ['Digital Balance', 'Displays', 'Negative_Value', ['15_2']], ['Glass Volumetric Flask', 'Rests On', 'Digital Balance', ['15_1']], ['Person', 'Wears', 'Blue Nitrile Gloves', ['15_1']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_0'}, {'local': 'Beaker', 'existing': 'Bottle', 'existing_id': '1_1'}, {'local': 'Pipette', 'existing': 'Apparatus', 'existing_id': '1_1'}, {'local': 'Glass Beaker', 'existing': 'Bottle', 'existing_id': '1_1'}, {'local': 'Glass Pipette', 'existing': 'Apparatus', 'existing_id': '1_1'}, {'local': 'Glass Volumetric Flask', 'existing': 'Apparatus', 'existing_id': '1_1'}, {'local': 'Digital Balance', 'existing': 'Power Strip', 'existing_id': '3_1'}, {'local': 'Negative_Value', 'existing': 'Weight', 'existing_id': '4_0'}] prune_instructions=[{'head': 'Person', 'relation': 'WEARS', 'tail': 'Cream-Colored Sweater'}, {'head': 'Person', 'relation': 'STANDS_IN', 'tail': 'Laboratory'}, {'head': 'Person', 'relation': 'OBSERVES', 'tail': 'Laboratory'}, {'head': 'Person', 'relation': 'STANDS', 'tail': 'Laboratory'}, {'head': 'Laboratory', 'relation': 'CONTAINS', 'tail': 'Workbench'}, {'head': 'Laboratory', 'relation': 'CONTAINS', 'tail': 'Cabinets'}, {'head': 'Laboratory', 'relation': 'CONTAINS', 'tail': 'Power Strip'}, {'head': 'Laboratory', 'relation': 'CONTAINS', 'tail': 'Lab Apparatus'}, {'head': 'Workbench', 'relation': 'HOLDS', 'tail': 'Apparatus'}, {'head': 'Workbench', 'relation': 'HOLDS', 'tail': 'Bottle'}, {'head': 'Person', 'relation': 'STIRS', 'tail': 'Liquid'}, {'head': 'Digital Balance', 'relation': 'Displays', 'tail': 'Weight'}, {'head': 'Digital Balance', 'relation': 'Measures', 'tail': 'Mass'}, {'head': 'Negative_Value', 'relation': 'Represents', 'tail': 'Tared_Weight'}]
2025-11-30 21:13:29,923 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=14, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['15_0']], ['Person', 'Holds', 'Beaker', ['15_0']], ['Person', 'Uses', 'Pipette', ['15_0']]]
2025-11-30 21:13:29,924 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Digital Balance', 'Displays', 'Power Strip', ['15_2']], ['Digital Balance', 'Measures', 'Mass', ['15_2']], ['Digital Balance', 'Displays', 'Negative_Value', ['15_2']]]
2025-11-30 21:13:29,924 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=8, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_0'}, {'local': 'Beaker', 'existing': 'Bottle', 'existing_id': '1_1'}, {'local': 'Pipette', 'existing': 'Apparatus', 'existing_id': '1_1'}]
2025-11-30 21:13:29,924 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=14, sample=[{'head': 'Person', 'relation': 'WEARS', 'tail': 'Cream-Colored Sweater'}, {'head': 'Person', 'relation': 'STANDS_IN', 'tail': 'Laboratory'}, {'head': 'Person', 'relation': 'OBSERVES', 'tail': 'Laboratory'}]
2025-11-30 21:13:29,924 - src.components.global_refiner - INFO - LLM suggested 8 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_0'}, {'local': 'Beaker', 'existing': 'Bottle', 'existing_id': '1_1'}, {'local': 'Pipette', 'existing': 'Apparatus', 'existing_id': '1_1'}, {'local': 'Glass Beaker', 'existing': 'Bottle', 'existing_id': '1_1'}, {'local': 'Glass Pipette', 'existing': 'Apparatus', 'existing_id': '1_1'}, {'local': 'Glass Volumetric Flask', 'existing': 'Apparatus', 'existing_id': '1_1'}, {'local': 'Digital Balance', 'existing': 'Power Strip', 'existing_id': '3_1'}, {'local': 'Negative_Value', 'existing': 'Weight', 'existing_id': '4_0'}]
2025-11-30 21:13:29,924 - src.components.global_refiner - INFO - LLM suggested 14 triplets to prune: [{'head': 'Person', 'relation': 'WEARS', 'tail': 'Cream-Colored Sweater'}, {'head': 'Person', 'relation': 'STANDS_IN', 'tail': 'Laboratory'}, {'head': 'Person', 'relation': 'OBSERVES', 'tail': 'Laboratory'}, {'head': 'Person', 'relation': 'STANDS', 'tail': 'Laboratory'}, {'head': 'Laboratory', 'relation': 'CONTAINS', 'tail': 'Workbench'}, {'head': 'Laboratory', 'relation': 'CONTAINS', 'tail': 'Cabinets'}, {'head': 'Laboratory', 'relation': 'CONTAINS', 'tail': 'Power Strip'}, {'head': 'Laboratory', 'relation': 'CONTAINS', 'tail': 'Lab Apparatus'}, {'head': 'Workbench', 'relation': 'HOLDS', 'tail': 'Apparatus'}, {'head': 'Workbench', 'relation': 'HOLDS', 'tail': 'Bottle'}, {'head': 'Person', 'relation': 'STIRS', 'tail': 'Liquid'}, {'head': 'Digital Balance', 'relation': 'Displays', 'tail': 'Weight'}, {'head': 'Digital Balance', 'relation': 'Measures', 'tail': 'Mass'}, {'head': 'Negative_Value', 'relation': 'Represents', 'tail': 'Tared_Weight'}]
2025-11-30 21:13:29,924 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 19 triplets (total: 19.37s, LLM: 19.37s)
2025-11-30 21:13:29,924 - src.pipeline.kg_builder - INFO - Global refinement: 19 triplets in 19.37s
2025-11-30 21:13:29,924 - src.pipeline.kg_builder - INFO - Using 19 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:13:29,924 - src.pipeline.kg_builder - INFO - Pushing batch 16/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:13:29,924 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:13:30,116 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=201, relationships=171
2025-11-30 21:13:30,116 - src.components.neo4j_handler - INFO - Applying 8 merge instructions
2025-11-30 21:13:30,117 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Nitrile Gloves
2025-11-30 21:13:30,120 - src.components.neo4j_handler - DEBUG - APOC merge successful: Beaker -> Bottle
2025-11-30 21:13:30,123 - src.components.neo4j_handler - DEBUG - APOC merge successful: Pipette -> Apparatus
2025-11-30 21:13:30,126 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass Beaker -> Bottle
2025-11-30 21:13:30,130 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass Pipette -> Apparatus
2025-11-30 21:13:30,133 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass Volumetric Flask -> Apparatus
2025-11-30 21:13:30,136 - src.components.neo4j_handler - DEBUG - APOC merge successful: Digital Balance -> Power Strip
2025-11-30 21:13:30,138 - src.components.neo4j_handler - DEBUG - APOC merge successful: Negative_Value -> Weight
2025-11-30 21:13:30,138 - src.components.neo4j_handler - INFO - Applying 14 prune instructions
2025-11-30 21:13:30,142 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[WEARS]-> Cream-Colored Sweater
2025-11-30 21:13:30,144 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[STANDS_IN]-> Laboratory
2025-11-30 21:13:30,145 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[OBSERVES]-> Laboratory
2025-11-30 21:13:30,164 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[STANDS]-> Laboratory
2025-11-30 21:13:30,166 - src.components.neo4j_handler - DEBUG - Pruned relationship: Laboratory -[CONTAINS]-> Workbench
2025-11-30 21:13:30,167 - src.components.neo4j_handler - DEBUG - Pruned relationship: Laboratory -[CONTAINS]-> Cabinets
2025-11-30 21:13:30,169 - src.components.neo4j_handler - DEBUG - Pruned relationship: Laboratory -[CONTAINS]-> Power Strip
2025-11-30 21:13:30,170 - src.components.neo4j_handler - DEBUG - Pruned relationship: Laboratory -[CONTAINS]-> Lab Apparatus
2025-11-30 21:13:30,172 - src.components.neo4j_handler - DEBUG - Pruned relationship: Workbench -[HOLDS]-> Apparatus
2025-11-30 21:13:30,173 - src.components.neo4j_handler - DEBUG - Pruned relationship: Workbench -[HOLDS]-> Bottle
2025-11-30 21:13:30,174 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[STIRS]-> Liquid
2025-11-30 21:13:30,175 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Digital Balance -[Displays]-> Weight
2025-11-30 21:13:30,176 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Digital Balance -[Measures]-> Mass
2025-11-30 21:13:30,196 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Negative_Value -[Represents]-> Tared_Weight
2025-11-30 21:13:30,196 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:13:30,197 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Digital Balance -[Displays]-> Power Strip
2025-11-30 21:13:30,197 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Digital Balance -[Measures]-> Mass
2025-11-30 21:13:30,198 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Digital Balance -[Displays]-> Negative_Value
2025-11-30 21:13:30,199 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Glass Volumetric Flask -[Rests On]-> Digital Balance
2025-11-30 21:13:30,201 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue Nitrile Gloves
2025-11-30 21:13:30,201 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:13:30,206 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=193, relationships=160
2025-11-30 21:13:30,207 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:13:30,207 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:13:30,207 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:13:30,207 - src.components.neo4j_handler - INFO - Batch injected in 0.28s (triplets: 0.28s, indexes: 0.00s)
2025-11-30 21:13:30,208 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 75, 'with_embedding': 75, 'linked_chunks': 58}
2025-11-30 21:13:30,208 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:13:30,232 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 193 nodes
2025-11-30 21:13:30,274 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 176 nodes
2025-11-30 21:13:30,317 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 193, 'relationship_count': 479, 'density': 0.0129, 'avg_degree': 4.9637, 'avg_unique_neighbors': 4.8912, 'global_efficiency': 0.3275, 'avg_path_length': 2.7883, 'avg_degree_centrality': 0.0259, 'max_degree_centrality': 0.474, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0209, 'degree_assortativity': -0.2195, 'graph_robustness': 0.8622, 'diameter_estimate': 5, 'clustering_coefficient': 0.2569, 'weakly_connected_components': 18, 'largest_wcc_size': 176, 'pagerank_top10_percent': 14.79, 'louvain_communities': 27, 'louvain_modularity': 0.4713, 'label_entropy': 1.4819, 'computational_time': 0.10899994510691613}
2025-11-30 21:13:30,317 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 15, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508410.3177314, 'total_time': 23.438426454900764, 'aggregation': 2.6170164346694946e-06, 'network_info': 0.006167226005345583, 'llm_extraction': 23.03887480904814, 'data_cleaning': 3.352703060954809e-05, 'neo4j_injection': 0.2828978659817949, 'embedding_time': 0, 'indexing_time': 0.0011621100129559636, 'graph_injection_time': 0.28138821001630276, 'acs_metrics': {'node_count': 193, 'relationship_count': 479, 'density': 0.0129, 'avg_degree': 4.9637, 'avg_unique_neighbors': 4.8912, 'global_efficiency': 0.3275, 'avg_path_length': 2.7883, 'avg_degree_centrality': 0.0259, 'max_degree_centrality': 0.474, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0209, 'degree_assortativity': -0.2195, 'graph_robustness': 0.8622, 'diameter_estimate': 5, 'clustering_coefficient': 0.2569, 'weakly_connected_components': 18, 'largest_wcc_size': 176, 'pagerank_top10_percent': 14.79, 'louvain_communities': 27, 'louvain_modularity': 0.4713, 'label_entropy': 1.4819, 'computational_time': 0.10899994510691613}, 'retrieval_queries': []}
2025-11-30 21:13:30,317 - src.pipeline.kg_builder - DEBUG - Batch 15 metrics: {
  "batch_idx": 15,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508410.3177314,
  "total_time": 23.438426454900764,
  "aggregation": 2.6170164346694946e-06,
  "network_info": 0.006167226005345583,
  "llm_extraction": 23.03887480904814,
  "data_cleaning": 3.352703060954809e-05,
  "neo4j_injection": 0.2828978659817949,
  "embedding_time": 0,
  "indexing_time": 0.0011621100129559636,
  "graph_injection_time": 0.28138821001630276,
  "acs_metrics": {
    "node_count": 193,
    "relationship_count": 479,
    "density": 0.0129,
    "avg_degree": 4.9637,
    "avg_unique_neighbors": 4.8912,
    "global_efficiency": 0.3275,
    "avg_path_length": 2.7883,
    "avg_degree_centrality": 0.0259,
    "max_degree_centrality": 0.474,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0209,
    "degree_assortativity": -0.2195,
    "graph_robustness": 0.8622,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2569,
    "weakly_connected_components": 18,
    "largest_wcc_size": 176,
    "pagerank_top10_percent": 14.79,
    "louvain_communities": 27,
    "louvain_modularity": 0.4713,
    "label_entropy": 1.4819,
    "computational_time": 0.10899994510691613
  },
  "retrieval_queries": []
}
2025-11-30 21:13:30,318 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:13:30,318 - src.pipeline.kg_builder - INFO - Batch 16 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 23.04s, Clean: 0.00s, Neo4j: 0.28s, ACS: 0.11s
2025-11-30 21:13:30,318 - src.pipeline.kg_builder - INFO - Batch 16 completed in 23.44s
Processing KG batches:  22%|██▏       | 16/72 [06:33<21:44, 23.30s/it]2025-11-30 21:13:30,318 - src.pipeline.kg_builder - INFO - Processing batch 17/72 (3 items)
2025-11-30 21:13:30,318 - src.pipeline.kg_builder - DEBUG - Batch 17 current_video_time: 04:09-04:14
2025-11-30 21:13:30,324 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 193
- Total Relationships: 160
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:13:30,324 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:13:30,324 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_0 ~218 words, content: Time: 03:59-04:04 Content: In a laboratory setting, a person wearing blue nitrile gloves is performing a precise measurement. The scene is viewed from a first-person...
2025-11-30 21:13:30,324 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_1 ~223 words, content: a first-person perspective, with the person's left arm, which has a watch with a black leather strap, visible in the foreground. The primary action involves...
2025-11-30 21:13:30,324 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_2 ~222 words, content: person, whose arm and hand are visible, wearing blue nitrile gloves and a black watch. They are performing a quantitative transfer of a liquid using...
2025-11-30 21:13:30,324 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3 ~56 words, content: the pipette is positioned directly above the flask's opening to ensure accurate transfer. The overall context suggests a methodical and precise scientific task, such as...
2025-11-30 21:13:30,346 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:13:30,389 - src.components.pre_llm_injector - DEBUG - Found 75 existing chunk embeddings for similarity lookup
2025-11-30 21:13:30,405 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_15_2', '0.808'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_3', '0.798')]
2025-11-30 21:13:30,406 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_3
2025-11-30 21:13:30,406 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:13:30,406 - src.components.pre_llm_injector - DEBUG - Found 3 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_15_2
2025-11-30 21:13:30,406 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:13:30,410 - src.components.pre_llm_injector - DEBUG - Limited Person from 55 to 2 external connections
2025-11-30 21:13:30,410 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 56 total -> 3 (internal: 1, external: 2)
2025-11-30 21:13:30,410 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(White_Plastic_Bottle / ID: 9_2), (Person / ID: 0_0)-[HOLDS]->(Apparatus / ID: 1_1), (Person / ID: 0_0)-[WRITES_ON]->(Report / ID: 2_2)
2025-11-30 21:13:30,411 - src.components.pre_llm_injector - DEBUG - Limited Power Strip from 6 to 2 external connections
2025-11-30 21:13:30,411 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 10 total -> 6 (internal: 2, external: 4)
2025-11-30 21:13:30,411 - src.components.pre_llm_injector - DEBUG - Subgraph: (Power Strip / ID: 3_1)-[MEASURES]->(Mass / ID: 9_2), (Power Strip / ID: 3_1)-[DISPLAYS]->(Power Strip / ID: 3_1), (Balance Scale Enclosure / ID: 6_1)-[MEASURES]->(Mass / ID: 9_2), (Bottle / ID: 1_1)-[IS_ON]->(Power Strip / ID: 3_1), (Power Strip / ID: 3_1)-[MEASURES]->(Mass Of Liquid / ID: 15_1), (Weight / ID: 11_2)-[REPRESENTS]->(Tared_Weight / ID: 15_2)
2025-11-30 21:13:30,411 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_3', '0.798'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.771')]
2025-11-30 21:13:30,411 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.720'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_6', '0.711')]
2025-11-30 21:13:30,411 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.658'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3', '0.645')]
2025-11-30 21:13:30,411 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_15_2', '0.808'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_6', '0.797')]
2025-11-30 21:13:30,411 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:13:30,411 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_0) (~218 words) with timeout=5.0s retries=3
2025-11-30 21:13:31,753 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:13:31,753 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:13:31,753 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_1) (~223 words) with timeout=5.0s retries=3
2025-11-30 21:13:33,000 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:13:33,000 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:13:33,000 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_2) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:13:34,184 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:13:34,185 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:13:34,185 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3) (~56 words) with timeout=5.0s retries=3
2025-11-30 21:13:35,711 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:13:35,711 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:13:35,712 - src.components.pre_llm_injector - INFO - Extracted 19 local triplets from 4 chunks
2025-11-30 21:13:35,712 - src.pipeline.kg_builder - INFO - Pre-extraction: 19 triplets in 5.39s
2025-11-30 21:13:35,712 - src.components.global_refiner - INFO - Capping refinement input: 19 → 15 triplets
2025-11-30 21:13:35,712 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[HOLDS]->(White_Plastic_Bottle / ID: 9_2), (Person / ID: 0_0)-[HOLDS]->(Apparatus / ID: 1_1), (Person / ID: 0_0)-[WRITES_ON]->(Report / ID: 2_2)
Subgraph_2: Subgraph: (Power Strip / ID: 3_1)-[MEASURES]->(Mass / ID: 9_2), (Power Strip / ID: 3_1)-[DISPLAYS]->(Power Strip / ID: 3_1), (Balance Scale Enclosure / ID: 6_1)-[MEASURES]->(Mass / ID: 9_2), (Bottle / ID: 1_1)-[IS_ON]->(Power Strip / ID: 3_1), (Power Strip / ID: 3_1)-[MEASURES]->(Mass Of Liquid / ID: 15_1), (Weight / ID: 11_2)-[REPRESENTS]->(Tared_Weight / ID: 15_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["16_0", "16_2"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["16_0", "16_1", "16_2"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["16_0", "16_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["16_0", "16_1"]}, {"head": "Volumetric_Flask", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["16_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "-56.301_G", "source_chunks": ["16_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["16_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital Balance", "source_chunks": ["16_1"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "-56.301 G", "source_chunks": ["16_1"]}, {"head": "Person", "relation": "Wears", "tail": "Black_Watch", "source_chunks": ["16_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["16_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["16_2"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["16_2"]}, {"head": "Pipette", "relation": "Is Positioned Above", "tail": "Flask", "source_chunks": ["16_3"]}, {"head": "Pipette", "relation": "Ensures", "tail": "Accurate_Transfer", "source_chunks": ["16_3"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:13:35,712 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~388 words, ~504 tokens)
2025-11-30 21:13:35,712 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:13:55,468 - src.components.global_refiner - DEBUG - LLM call completed in 19.76s
2025-11-30 21:13:55,468 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['16_0', '16_2']], ['Person', 'Holds', 'Beaker', ['16_0', '16_1', '16_2']], ['Person', 'Holds', 'Pipette', ['16_0', '16_1']], ['Pipette', 'Transfers', 'Liquid', ['16_0', '16_1']], ['Volumetric_Flask', 'Is On', 'Digital_Balance', ['16_0']], ['Digital_Balance', 'Displays', '-56.301_G', ['16_0']], ['Person', 'Wears', 'Blue Nitrile Gloves', ['16_1']], ['Beaker', 'Is On', 'Digital Balance', ['16_1']], ['Digital_Balance', 'Displays', '-56.301 G', ['16_1']], ['Person', 'Wears', 'Black_Watch', ['16_2']], ['Beaker', 'Contains', 'Clear_Liquid', ['16_2']], ['Person', 'Uses', 'Pipette', ['16_2']], ['Pipette', 'Transfers', 'Clear_Liquid', ['16_2']], ['Pipette', 'Is Positioned Above', 'Flask', ['16_3']], ['Pipette', 'Ensures', 'Accurate_Transfer', ['16_3']]] inter_chunk_relations=[['Digital_Balance', 'Displays', '-56.301_G', ['16_0']], ['Digital_Balance', 'Displays', '-56.301 G', ['16_1']], ['Beaker', 'Is On', 'Digital Balance', ['16_1']], ['Volumetric_Flask', 'Is On', 'Digital_Balance', ['16_0']], ['Pipette', 'Transfers', 'Clear_Liquid', ['16_2']], ['Pipette', 'Transfers', 'Liquid', ['16_0', '16_1']], ['Person', 'Holds', 'Beaker', ['16_0', '16_1', '16_2']], ['Person', 'Holds', 'Pipette', ['16_0', '16_1']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['16_0', '16_2']], ['Person', 'Wears', 'Blue Nitrile Gloves', ['16_1']], ['Person', 'Wears', 'Black_Watch', ['16_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue Nitrile Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Clear_Liquid', 'existing': 'Liquid', 'existing_id': '9_2'}, {'local': 'Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}] prune_instructions=[{'head': 'Person', 'relation': 'Holds', 'tail': 'White_Plastic_Bottle'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Apparatus'}, {'head': 'Person', 'relation': 'WRITES_ON', 'tail': 'Report'}, {'head': 'Power Strip', 'relation': 'MEASURES', 'tail': 'Mass'}, {'head': 'Power Strip', 'relation': 'DISPLAYS', 'tail': 'Power Strip'}, {'head': 'Balance Scale Enclosure', 'relation': 'MEASURES', 'tail': 'Mass'}, {'head': 'Bottle', 'relation': 'IS_ON', 'tail': 'Power Strip'}, {'head': 'Power Strip', 'relation': 'MEASURES', 'tail': 'Mass Of Liquid'}, {'head': 'Weight', 'relation': 'REPRESENTS', 'tail': 'Tared_Weight'}]
2025-11-30 21:13:55,468 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['16_0', '16_2']], ['Person', 'Holds', 'Beaker', ['16_0', '16_1', '16_2']], ['Person', 'Holds', 'Pipette', ['16_0', '16_1']]]
2025-11-30 21:13:55,468 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=11, sample=[['Digital_Balance', 'Displays', '-56.301_G', ['16_0']], ['Digital_Balance', 'Displays', '-56.301 G', ['16_1']], ['Beaker', 'Is On', 'Digital Balance', ['16_1']]]
2025-11-30 21:13:55,468 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue Nitrile Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Clear_Liquid', 'existing': 'Liquid', 'existing_id': '9_2'}]
2025-11-30 21:13:55,468 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=9, sample=[{'head': 'Person', 'relation': 'Holds', 'tail': 'White_Plastic_Bottle'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Apparatus'}, {'head': 'Person', 'relation': 'WRITES_ON', 'tail': 'Report'}]
2025-11-30 21:13:55,468 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue Nitrile Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Clear_Liquid', 'existing': 'Liquid', 'existing_id': '9_2'}, {'local': 'Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}]
2025-11-30 21:13:55,469 - src.components.global_refiner - INFO - LLM suggested 9 triplets to prune: [{'head': 'Person', 'relation': 'Holds', 'tail': 'White_Plastic_Bottle'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Apparatus'}, {'head': 'Person', 'relation': 'WRITES_ON', 'tail': 'Report'}, {'head': 'Power Strip', 'relation': 'MEASURES', 'tail': 'Mass'}, {'head': 'Power Strip', 'relation': 'DISPLAYS', 'tail': 'Power Strip'}, {'head': 'Balance Scale Enclosure', 'relation': 'MEASURES', 'tail': 'Mass'}, {'head': 'Bottle', 'relation': 'IS_ON', 'tail': 'Power Strip'}, {'head': 'Power Strip', 'relation': 'MEASURES', 'tail': 'Mass Of Liquid'}, {'head': 'Weight', 'relation': 'REPRESENTS', 'tail': 'Tared_Weight'}]
2025-11-30 21:13:55,469 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 26 triplets (total: 19.76s, LLM: 19.76s)
2025-11-30 21:13:55,469 - src.pipeline.kg_builder - INFO - Global refinement: 26 triplets in 19.76s
2025-11-30 21:13:55,469 - src.pipeline.kg_builder - INFO - Using 26 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:13:55,469 - src.pipeline.kg_builder - INFO - Pushing batch 17/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:13:55,469 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:13:55,625 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=207, relationships=174
2025-11-30 21:13:55,625 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:13:55,626 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Glove
2025-11-30 21:13:55,630 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue Nitrile Gloves -> Blue Glove
2025-11-30 21:13:55,634 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear_Liquid -> Liquid
2025-11-30 21:13:55,637 - src.components.neo4j_handler - DEBUG - APOC merge successful: Liquid -> Mass Of Liquid
2025-11-30 21:13:55,638 - src.components.neo4j_handler - INFO - Applying 9 prune instructions
2025-11-30 21:13:55,641 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> White_Plastic_Bottle
2025-11-30 21:13:55,642 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Apparatus
2025-11-30 21:13:55,643 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[WRITES_ON]-> Report
2025-11-30 21:13:55,645 - src.components.neo4j_handler - DEBUG - Pruned relationship: Power Strip -[MEASURES]-> Mass
2025-11-30 21:13:55,646 - src.components.neo4j_handler - DEBUG - Pruned relationship: Power Strip -[DISPLAYS]-> Power Strip
2025-11-30 21:13:55,647 - src.components.neo4j_handler - DEBUG - Pruned relationship: Balance Scale Enclosure -[MEASURES]-> Mass
2025-11-30 21:13:55,648 - src.components.neo4j_handler - DEBUG - Pruned relationship: Bottle -[IS_ON]-> Power Strip
2025-11-30 21:13:55,649 - src.components.neo4j_handler - DEBUG - Pruned relationship: Power Strip -[MEASURES]-> Mass Of Liquid
2025-11-30 21:13:55,673 - src.components.neo4j_handler - DEBUG - Pruned relationship: Weight -[REPRESENTS]-> Tared_Weight
2025-11-30 21:13:55,673 - src.components.neo4j_handler - INFO - Applying 11 inter-chunk relations
2025-11-30 21:13:55,674 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital_Balance -[Displays]-> -56.301_G
2025-11-30 21:13:55,676 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital_Balance -[Displays]-> -56.301 G
2025-11-30 21:13:55,677 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Is On]-> Digital Balance
2025-11-30 21:13:55,678 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Volumetric_Flask -[Is On]-> Digital_Balance
2025-11-30 21:13:55,678 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Pipette -[Transfers]-> Clear_Liquid
2025-11-30 21:13:55,679 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Pipette -[Transfers]-> Liquid
2025-11-30 21:13:55,680 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Beaker
2025-11-30 21:13:55,681 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Pipette
2025-11-30 21:13:55,681 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:13:55,682 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue Nitrile Gloves
2025-11-30 21:13:55,683 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Black_Watch
2025-11-30 21:13:55,683 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:13:55,690 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=203, relationships=165
2025-11-30 21:13:55,691 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:13:55,691 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:13:55,691 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:13:55,691 - src.components.neo4j_handler - INFO - Batch injected in 0.22s (triplets: 0.22s, indexes: 0.00s)
2025-11-30 21:13:55,692 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 79, 'with_embedding': 79, 'linked_chunks': 62}
2025-11-30 21:13:55,692 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:13:55,717 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 203 nodes
2025-11-30 21:13:55,769 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 186 nodes
2025-11-30 21:13:55,820 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 203, 'relationship_count': 504, 'density': 0.0123, 'avg_degree': 4.9655, 'avg_unique_neighbors': 4.9064, 'global_efficiency': 0.325, 'avg_path_length': 2.8409, 'avg_degree_centrality': 0.0246, 'max_degree_centrality': 0.4653, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0313, 'degree_assortativity': -0.1928, 'graph_robustness': 0.8353, 'diameter_estimate': 6, 'clustering_coefficient': 0.2553, 'weakly_connected_components': 18, 'largest_wcc_size': 186, 'pagerank_top10_percent': 13.89, 'louvain_communities': 27, 'louvain_modularity': 0.468, 'label_entropy': 1.4821, 'computational_time': 0.1277137229917571}
2025-11-30 21:13:55,820 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 16, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508435.8207352, 'total_time': 25.502318675047718, 'aggregation': 2.7989735826849937e-06, 'network_info': 0.005896974937058985, 'llm_extraction': 25.14471964794211, 'data_cleaning': 5.8072968386113644e-05, 'neo4j_injection': 0.22250407398678362, 'embedding_time': 0, 'indexing_time': 0.0012225019745528698, 'graph_injection_time': 0.2209306579316035, 'acs_metrics': {'node_count': 203, 'relationship_count': 504, 'density': 0.0123, 'avg_degree': 4.9655, 'avg_unique_neighbors': 4.9064, 'global_efficiency': 0.325, 'avg_path_length': 2.8409, 'avg_degree_centrality': 0.0246, 'max_degree_centrality': 0.4653, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0313, 'degree_assortativity': -0.1928, 'graph_robustness': 0.8353, 'diameter_estimate': 6, 'clustering_coefficient': 0.2553, 'weakly_connected_components': 18, 'largest_wcc_size': 186, 'pagerank_top10_percent': 13.89, 'louvain_communities': 27, 'louvain_modularity': 0.468, 'label_entropy': 1.4821, 'computational_time': 0.1277137229917571}, 'retrieval_queries': []}
2025-11-30 21:13:55,820 - src.pipeline.kg_builder - DEBUG - Batch 16 metrics: {
  "batch_idx": 16,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508435.8207352,
  "total_time": 25.502318675047718,
  "aggregation": 2.7989735826849937e-06,
  "network_info": 0.005896974937058985,
  "llm_extraction": 25.14471964794211,
  "data_cleaning": 5.8072968386113644e-05,
  "neo4j_injection": 0.22250407398678362,
  "embedding_time": 0,
  "indexing_time": 0.0012225019745528698,
  "graph_injection_time": 0.2209306579316035,
  "acs_metrics": {
    "node_count": 203,
    "relationship_count": 504,
    "density": 0.0123,
    "avg_degree": 4.9655,
    "avg_unique_neighbors": 4.9064,
    "global_efficiency": 0.325,
    "avg_path_length": 2.8409,
    "avg_degree_centrality": 0.0246,
    "max_degree_centrality": 0.4653,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0313,
    "degree_assortativity": -0.1928,
    "graph_robustness": 0.8353,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2553,
    "weakly_connected_components": 18,
    "largest_wcc_size": 186,
    "pagerank_top10_percent": 13.89,
    "louvain_communities": 27,
    "louvain_modularity": 0.468,
    "label_entropy": 1.4821,
    "computational_time": 0.1277137229917571
  },
  "retrieval_queries": []
}
2025-11-30 21:13:55,821 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:13:55,821 - src.pipeline.kg_builder - INFO - Batch 17 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 25.14s, Clean: 0.00s, Neo4j: 0.22s, ACS: 0.13s
2025-11-30 21:13:55,821 - src.pipeline.kg_builder - INFO - Batch 17 completed in 25.50s
Processing KG batches:  24%|██▎       | 17/72 [06:58<21:57, 23.96s/it]2025-11-30 21:13:55,821 - src.pipeline.kg_builder - INFO - Processing batch 18/72 (3 items)
2025-11-30 21:13:55,821 - src.pipeline.kg_builder - DEBUG - Batch 18 current_video_time: 04:24-04:29
2025-11-30 21:13:55,833 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 203
- Total Relationships: 165
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:13:55,834 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:13:55,834 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_0 ~224 words, content: Time: 04:14-04:19 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a precise liquid transfer, performed with care and precision. The...
2025-11-30 21:13:55,834 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_1 ~229 words, content: used to add a liquid to the beaker. The person's hands are steady, and the focus remains on the precise measurement of the liquid. The...
2025-11-30 21:13:55,834 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2 ~218 words, content: aker. - **Equipment and Setup:** The central focus is the digital balance, which displays a reading of approximately $56.30$ grams. This indicates the person is...
2025-11-30 21:13:55,834 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_3 ~222 words, content: bench. A person, whose arm is visible, is using a pipette to transfer a liquid. The liquid is being added to a glass beaker that...
2025-11-30 21:13:55,834 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_4 ~106 words, content: - The background shows a typical lab environment with a glass-fronted cabinet, a door, and other equipment. - The digital balance's display changes slightly throughout...
2025-11-30 21:13:55,854 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:13:55,906 - src.components.pre_llm_injector - DEBUG - Found 79 existing chunk embeddings for similarity lookup
2025-11-30 21:13:55,927 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_15_2', '0.790'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_0', '0.788')]
2025-11-30 21:13:55,929 - src.components.pre_llm_injector - DEBUG - Found 5 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_0
2025-11-30 21:13:55,929 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:13:55,930 - src.components.pre_llm_injector - DEBUG - Found 3 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_15_2
2025-11-30 21:13:55,930 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:13:55,934 - src.components.pre_llm_injector - DEBUG - Limited Person from 56 to 2 external connections
2025-11-30 21:13:55,934 - src.components.pre_llm_injector - DEBUG - Limited Magnetic_Stirrer from 5 to 2 external connections
2025-11-30 21:13:55,934 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 65 total -> 8 (internal: 3, external: 5)
2025-11-30 21:13:55,934 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[USES]->(Magnetic_Stirrer / ID: 4_2), (Laboratory_Bench / ID: 13_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[WEARS]->(Nitrile_Gloves / ID: 13_0), (Person / ID: 0_0)-[HOLDS]->(Wash_Bottle / ID: 11_1), (Person / ID: 0_0)-[WEARS]->(Blue Glove / ID: 10_1), (Magnetic_Stirrer / ID: 4_2)-[ROTATES]->(Magnetic_Stir_Bar / ID: 5_0), (Glass_Flask / ID: 13_2)-[IS_CONNECTED_TO]->(Magnetic_Stirrer / ID: 4_2), (Balance Scale / ID: 3_1)-[DISPLAYS]->(Negative_Weight_Reading / ID: 13_0)
2025-11-30 21:13:55,934 - src.components.pre_llm_injector - DEBUG - Limited Power Strip from 4 to 2 external connections
2025-11-30 21:13:55,934 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 4 total -> 2 (internal: 0, external: 2)
2025-11-30 21:13:55,934 - src.components.pre_llm_injector - DEBUG - Subgraph: (Power Strip / ID: 3_1)-[IS_INSIDE]->(Draft Shield / ID: 10_0), (Apparatus / ID: 1_1)-[RESTS_ON]->(Power Strip / ID: 3_1)
2025-11-30 21:13:55,934 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_1', '0.567'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_1', '0.558')]
2025-11-30 21:13:55,934 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_0', '0.788'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_1', '0.774')]
2025-11-30 21:13:55,934 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.767'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_1', '0.759')]
2025-11-30 21:13:55,934 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.582'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_1', '0.567')]
2025-11-30 21:13:55,934 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_15_2', '0.790'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3', '0.786')]
2025-11-30 21:13:55,934 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:13:55,935 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_0) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:13:57,109 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:13:57,109 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:13:57,109 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_1) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:13:58,127 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:13:58,127 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:13:58,127 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2) (~218 words) with timeout=5.0s retries=3
2025-11-30 21:13:59,080 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:13:59,080 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:13:59,081 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_3) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:14:00,330 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:14:00,331 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:14:00,331 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_4) (~106 words) with timeout=5.0s retries=3
2025-11-30 21:14:01,503 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:14:01,503 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:14:01,503 - src.components.pre_llm_injector - INFO - Extracted 25 local triplets from 5 chunks
2025-11-30 21:14:01,503 - src.pipeline.kg_builder - INFO - Pre-extraction: 25 triplets in 5.67s
2025-11-30 21:14:01,504 - src.components.global_refiner - INFO - Capping refinement input: 25 → 15 triplets
2025-11-30 21:14:01,504 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[USES]->(Magnetic_Stirrer / ID: 4_2), (Laboratory_Bench / ID: 13_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[WEARS]->(Nitrile_Gloves / ID: 13_0), (Person / ID: 0_0)-[HOLDS]->(Wash_Bottle / ID: 11_1), (Person / ID: 0_0)-[WEARS]->(Blue Glove / ID: 10_1), (Magnetic_Stirrer / ID: 4_2)-[ROTATES]->(Magnetic_Stir_Bar / ID: 5_0), (Glass_Flask / ID: 13_2)-[IS_CONNECTED_TO]->(Magnetic_Stirrer / ID: 4_2), (Balance Scale / ID: 3_1)-[DISPLAYS]->(Negative_Weight_Reading / ID: 13_0)
Subgraph_2: Subgraph: (Power Strip / ID: 3_1)-[IS_INSIDE]->(Draft Shield / ID: 10_0), (Apparatus / ID: 1_1)-[RESTS_ON]->(Power Strip / ID: 3_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["17_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["17_0", "17_2", "17_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["17_0", "17_1", "17_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["17_0", "17_2"]}, {"head": "Beaker", "relation": "Placed On", "tail": "Digital_Balance", "source_chunks": ["17_0"]}, {"head": "Person", "relation": "Uses", "tail": "Digital_Balance", "source_chunks": ["17_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["17_1"]}, {"head": "Person", "relation": "Holds", "tail": "Wash Bottle", "source_chunks": ["17_1"]}, {"head": "Beaker", "relation": "Receives", "tail": "Liquid", "source_chunks": ["17_1"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Liquid", "source_chunks": ["17_1"]}, {"head": "Person", "relation": "Wears", "tail": "Nitrile Gloves", "source_chunks": ["17_1"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["17_2"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["17_2"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Beaker", "source_chunks": ["17_2"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Document", "source_chunks": ["17_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:14:01,505 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~389 words, ~506 tokens)
2025-11-30 21:14:01,505 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:14:14,037 - src.components.global_refiner - DEBUG - LLM call completed in 12.53s
2025-11-30 21:14:14,037 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['17_0']], ['Person', 'Holds', 'Pipette', ['17_0', '17_2', '17_3']], ['Pipette', 'Transfers', 'Liquid', ['17_0', '17_1', '17_3']], ['Beaker', 'Contains', 'Liquid', ['17_0', '17_2']], ['Beaker', 'Placed On', 'Digital_Balance', ['17_0']], ['Person', 'Uses', 'Digital_Balance', ['17_0']], ['Person', 'Uses', 'Pipette', ['17_1']], ['Person', 'Holds', 'Wash Bottle', ['17_1']], ['Beaker', 'Receives', 'Liquid', ['17_1']], ['Digital Balance', 'Measures', 'Liquid', ['17_1']], ['Person', 'Wears', 'Nitrile Gloves', ['17_1']], ['Person', 'Wears', 'Watch', ['17_2']], ['Digital Balance', 'Measures', 'Mass', ['17_2']], ['Lab Table', 'Contains', 'Beaker', ['17_2']], ['Lab Table', 'Contains', 'Document', ['17_2']]] inter_chunk_relations=[['Digital Balance', 'Measures', 'Mass', ['17_2']], ['Lab Table', 'Contains', 'Beaker', ['17_2']], ['Lab Table', 'Contains', 'Document', ['17_2']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['17_0']], ['Person', 'Holds', 'Pipette', ['17_0', '17_2', '17_3']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '10_1'}, {'local': 'Nitrile Gloves', 'existing': 'Nitrile_Gloves', 'existing_id': '13_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Nitrile Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Wash Bottle'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Magnetic_Stirrer'}]
2025-11-30 21:14:14,038 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['17_0']], ['Person', 'Holds', 'Pipette', ['17_0', '17_2', '17_3']], ['Pipette', 'Transfers', 'Liquid', ['17_0', '17_1', '17_3']]]
2025-11-30 21:14:14,038 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Digital Balance', 'Measures', 'Mass', ['17_2']], ['Lab Table', 'Contains', 'Beaker', ['17_2']], ['Lab Table', 'Contains', 'Document', ['17_2']]]
2025-11-30 21:14:14,038 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=2, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '10_1'}, {'local': 'Nitrile Gloves', 'existing': 'Nitrile_Gloves', 'existing_id': '13_0'}]
2025-11-30 21:14:14,038 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Nitrile Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Wash Bottle'}]
2025-11-30 21:14:14,038 - src.components.global_refiner - INFO - LLM suggested 2 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '10_1'}, {'local': 'Nitrile Gloves', 'existing': 'Nitrile_Gloves', 'existing_id': '13_0'}]
2025-11-30 21:14:14,038 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Nitrile Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Wash Bottle'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Magnetic_Stirrer'}]
2025-11-30 21:14:14,038 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 12.53s, LLM: 12.53s)
2025-11-30 21:14:14,038 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 12.53s
2025-11-30 21:14:14,038 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:14:14,038 - src.pipeline.kg_builder - INFO - Pushing batch 18/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:14:14,038 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:14:14,226 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=213, relationships=178
2025-11-30 21:14:14,226 - src.components.neo4j_handler - INFO - Applying 2 merge instructions
2025-11-30 21:14:14,227 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Glove
2025-11-30 21:14:14,231 - src.components.neo4j_handler - DEBUG - APOC merge successful: Nitrile Gloves -> Nitrile_Gloves
2025-11-30 21:14:14,231 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:14:14,238 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Glove
2025-11-30 21:14:14,239 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Nitrile Gloves
2025-11-30 21:14:14,240 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Wash Bottle
2025-11-30 21:14:14,242 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Uses]-> Magnetic_Stirrer
2025-11-30 21:14:14,242 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:14:14,243 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital Balance -[Measures]-> Mass
2025-11-30 21:14:14,245 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab Table -[Contains]-> Beaker
2025-11-30 21:14:14,247 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab Table -[Contains]-> Document
2025-11-30 21:14:14,248 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:14:14,250 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Pipette
2025-11-30 21:14:14,251 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:14:14,259 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=211, relationships=168
2025-11-30 21:14:14,263 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:14:14,263 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:14:14,263 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:14:14,263 - src.components.neo4j_handler - INFO - Batch injected in 0.22s (triplets: 0.22s, indexes: 0.00s)
2025-11-30 21:14:14,264 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 84, 'with_embedding': 84, 'linked_chunks': 66}
2025-11-30 21:14:14,264 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:14:14,284 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 211 nodes
2025-11-30 21:14:14,328 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 193 nodes
2025-11-30 21:14:14,384 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 211, 'relationship_count': 536, 'density': 0.0121, 'avg_degree': 5.0806, 'avg_unique_neighbors': 5.0237, 'global_efficiency': 0.3251, 'avg_path_length': 2.8266, 'avg_degree_centrality': 0.0242, 'max_degree_centrality': 0.4667, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0202, 'degree_assortativity': -0.182, 'graph_robustness': 0.8004, 'diameter_estimate': 6, 'clustering_coefficient': 0.248, 'weakly_connected_components': 19, 'largest_wcc_size': 193, 'pagerank_top10_percent': 13.36, 'louvain_communities': 30, 'louvain_modularity': 0.48, 'label_entropy': 1.4849, 'computational_time': 0.12002785596996546}
2025-11-30 21:14:14,384 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 17, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508454.38482, 'total_time': 18.563395340926945, 'aggregation': 3.2330863177776337e-06, 'network_info': 0.012090834090486169, 'llm_extraction': 18.2048363359645, 'data_cleaning': 3.6088982596993446e-05, 'neo4j_injection': 0.224936906946823, 'embedding_time': 0, 'indexing_time': 0.004153999965637922, 'graph_injection_time': 0.2204522320535034, 'acs_metrics': {'node_count': 211, 'relationship_count': 536, 'density': 0.0121, 'avg_degree': 5.0806, 'avg_unique_neighbors': 5.0237, 'global_efficiency': 0.3251, 'avg_path_length': 2.8266, 'avg_degree_centrality': 0.0242, 'max_degree_centrality': 0.4667, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0202, 'degree_assortativity': -0.182, 'graph_robustness': 0.8004, 'diameter_estimate': 6, 'clustering_coefficient': 0.248, 'weakly_connected_components': 19, 'largest_wcc_size': 193, 'pagerank_top10_percent': 13.36, 'louvain_communities': 30, 'louvain_modularity': 0.48, 'label_entropy': 1.4849, 'computational_time': 0.12002785596996546}, 'retrieval_queries': []}
2025-11-30 21:14:14,384 - src.pipeline.kg_builder - DEBUG - Batch 17 metrics: {
  "batch_idx": 17,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508454.38482,
  "total_time": 18.563395340926945,
  "aggregation": 3.2330863177776337e-06,
  "network_info": 0.012090834090486169,
  "llm_extraction": 18.2048363359645,
  "data_cleaning": 3.6088982596993446e-05,
  "neo4j_injection": 0.224936906946823,
  "embedding_time": 0,
  "indexing_time": 0.004153999965637922,
  "graph_injection_time": 0.2204522320535034,
  "acs_metrics": {
    "node_count": 211,
    "relationship_count": 536,
    "density": 0.0121,
    "avg_degree": 5.0806,
    "avg_unique_neighbors": 5.0237,
    "global_efficiency": 0.3251,
    "avg_path_length": 2.8266,
    "avg_degree_centrality": 0.0242,
    "max_degree_centrality": 0.4667,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0202,
    "degree_assortativity": -0.182,
    "graph_robustness": 0.8004,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.248,
    "weakly_connected_components": 19,
    "largest_wcc_size": 193,
    "pagerank_top10_percent": 13.36,
    "louvain_communities": 30,
    "louvain_modularity": 0.48,
    "label_entropy": 1.4849,
    "computational_time": 0.12002785596996546
  },
  "retrieval_queries": []
}
2025-11-30 21:14:14,385 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:14:14,385 - src.pipeline.kg_builder - INFO - Batch 18 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 18.20s, Clean: 0.00s, Neo4j: 0.22s, ACS: 0.12s
2025-11-30 21:14:14,385 - src.pipeline.kg_builder - INFO - Batch 18 completed in 18.56s
Processing KG batches:  25%|██▌       | 18/72 [07:17<20:06, 22.34s/it]2025-11-30 21:14:14,385 - src.pipeline.kg_builder - INFO - Processing batch 19/72 (3 items)
2025-11-30 21:14:14,385 - src.pipeline.kg_builder - DEBUG - Batch 19 current_video_time: 04:39-04:44
2025-11-30 21:14:14,396 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 211
- Total Relationships: 168
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:14:14,397 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:14:14,397 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_0 ~217 words, content: Time: 04:29-04:34 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a precise liquid transfer, performed by a person wearing blue...
2025-11-30 21:14:14,397 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_1 ~200 words, content: a counter in the background. A sign with Chinese characters, "当心火灾" (Beware of fire), is visible on the wall, indicating a safety precaution. - **Procedure:**...
2025-11-30 21:14:14,397 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_2 ~214 words, content: - A **volumetric flask**, which is a round-bottomed flask with a long neck, is positioned on the table to receive the liquid. - A **digital...
2025-11-30 21:14:14,397 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_3 ~197 words, content: **Primary Action:** A person wearing blue nitrile gloves is carefully pouring a clear liquid from a small, transparent glass beaker into a long, thin glass...
2025-11-30 21:14:14,397 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_4 ~106 words, content: to receive the liquid. The liquid is being dispensed into this flask. - **Other Lab Equipment:** In the background, there is a white shelving unit...
2025-11-30 21:14:14,417 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:14:14,463 - src.components.pre_llm_injector - DEBUG - Found 84 existing chunk embeddings for similarity lookup
2025-11-30 21:14:14,486 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2', '0.790'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3', '0.784')]
2025-11-30 21:14:14,488 - src.components.pre_llm_injector - DEBUG - Found 3 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3
2025-11-30 21:14:14,488 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:14:14,488 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2
2025-11-30 21:14:14,488 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:14:14,492 - src.components.pre_llm_injector - DEBUG - Limited Person from 53 to 2 external connections
2025-11-30 21:14:14,492 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 53 total -> 2 (internal: 0, external: 2)
2025-11-30 21:14:14,492 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[LOOKS_AT]->(Camera / ID: 0_1), (Person / ID: 0_0)-[POURS]->(Mass Of Liquid / ID: 15_1)
2025-11-30 21:14:14,493 - src.components.pre_llm_injector - DEBUG - Limited Pipette from 5 to 2 external connections
2025-11-30 21:14:14,493 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 7 total -> 4 (internal: 2, external: 2)
2025-11-30 21:14:14,493 - src.components.pre_llm_injector - DEBUG - Subgraph: (Pipette / ID: 16_0)-[IS_POSITIONED_ABOVE]->(Flask / ID: 16_3), (Pipette / ID: 16_0)-[ENSURES]->(Accurate_Transfer / ID: 16_3), (Pipette / ID: 16_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Pipette / ID: 16_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1)
2025-11-30 21:14:14,493 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_4', '0.760'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_4', '0.732')]
2025-11-30 21:14:14,493 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2', '0.667'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.634')]
2025-11-30 21:14:14,493 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.541'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_3', '0.521')]
2025-11-30 21:14:14,493 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_5', '0.720'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_2', '0.664')]
2025-11-30 21:14:14,493 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2', '0.790'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3', '0.784')]
2025-11-30 21:14:14,493 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:14:14,493 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_0) (~217 words) with timeout=5.0s retries=3
2025-11-30 21:14:15,705 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:14:15,705 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:14:15,705 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_1) (~200 words) with timeout=5.0s retries=3
2025-11-30 21:14:16,770 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:14:16,770 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:14:16,770 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_2) (~214 words) with timeout=5.0s retries=3
2025-11-30 21:14:18,020 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:14:18,021 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:14:18,021 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_3) (~197 words) with timeout=5.0s retries=3
2025-11-30 21:14:19,305 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:14:19,305 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:14:19,306 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_4) (~106 words) with timeout=5.0s retries=3
2025-11-30 21:14:20,631 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:14:20,632 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:14:20,632 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 5 chunks
2025-11-30 21:14:20,632 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 6.24s
2025-11-30 21:14:20,633 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 21:14:20,633 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[LOOKS_AT]->(Camera / ID: 0_1), (Person / ID: 0_0)-[POURS]->(Mass Of Liquid / ID: 15_1)
Subgraph_2: Subgraph: (Pipette / ID: 16_0)-[IS_POSITIONED_ABOVE]->(Flask / ID: 16_3), (Pipette / ID: 16_0)-[ENSURES]->(Accurate_Transfer / ID: 16_3), (Pipette / ID: 16_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Pipette / ID: 16_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["18_0", "18_3"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["18_0", "18_2", "18_3"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["18_0", "18_1", "18_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["18_0", "18_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["18_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Mass_Value", "source_chunks": ["18_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["18_1", "18_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["18_1"]}, {"head": "Volumetric Flask", "relation": "Receives", "tail": "Liquid", "source_chunks": ["18_1"]}, {"head": "Wall", "relation": "Displays", "tail": "Sign", "source_chunks": ["18_1"]}, {"head": "Volumetric Flask", "relation": "Is Positioned On", "tail": "Lab Table", "source_chunks": ["18_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "Weight", "source_chunks": ["18_2"]}, {"head": "Beaker", "relation": "Is Held Over", "tail": "Digital Balance", "source_chunks": ["18_2"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Piece Of Paper", "source_chunks": ["18_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["18_3"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:14:20,633 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~372 words, ~484 tokens)
2025-11-30 21:14:20,633 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:14:35,009 - src.components.global_refiner - DEBUG - LLM call completed in 14.38s
2025-11-30 21:14:35,009 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['18_0', '18_3']], ['Person', 'Holds', 'Beaker', ['18_0', '18_2', '18_3']], ['Person', 'Holds', 'Pipette', ['18_0', '18_1', '18_3']], ['Pipette', 'Transfers', 'Liquid', ['18_0', '18_1']], ['Beaker', 'Is On', 'Digital_Balance', ['18_0']], ['Digital_Balance', 'Displays', 'Mass_Value', ['18_0']], ['Person', 'Wears', 'Blue Nitrile Gloves', ['18_1', '18_2']], ['Beaker', 'Contains', 'Liquid', ['18_1']], ['Volumetric Flask', 'Receives', 'Liquid', ['18_1']], ['Wall', 'Displays', 'Sign', ['18_1']], ['Volumetric Flask', 'Is Positioned On', 'Lab Table', ['18_2']], ['Digital Balance', 'Displays', 'Weight', ['18_2']], ['Beaker', 'Is Held Over', 'Digital Balance', ['18_2']], ['Lab Table', 'Contains', 'Piece Of Paper', ['18_2']], ['Beaker', 'Contains', 'Clear_Liquid', ['18_3']]] inter_chunk_relations=[['Beaker', 'Is On', 'Digital_Balance', ['18_0']], ['Digital_Balance', 'Displays', 'Mass_Value', ['18_0']], ['Digital_Balance', 'Displays', 'Weight', ['18_2']], ['Beaker', 'Is Held Over', 'Digital Balance', ['18_2']], ['Volumetric Flask', 'Is Positioned On', 'Lab Table', ['18_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_0'}, {'local': 'Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Clear_Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Mass_Value', 'existing': 'Mass_Value', 'existing_id': '0_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Pipette', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Clear_Liquid'}]
2025-11-30 21:14:35,010 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['18_0', '18_3']], ['Person', 'Holds', 'Beaker', ['18_0', '18_2', '18_3']], ['Person', 'Holds', 'Pipette', ['18_0', '18_1', '18_3']]]
2025-11-30 21:14:35,010 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Beaker', 'Is On', 'Digital_Balance', ['18_0']], ['Digital_Balance', 'Displays', 'Mass_Value', ['18_0']], ['Digital_Balance', 'Displays', 'Weight', ['18_2']]]
2025-11-30 21:14:35,010 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_0'}, {'local': 'Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Clear_Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}]
2025-11-30 21:14:35,010 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=5, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Pipette', 'relation': 'Transfers', 'tail': 'Liquid'}]
2025-11-30 21:14:35,010 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_0'}, {'local': 'Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Clear_Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Mass_Value', 'existing': 'Mass_Value', 'existing_id': '0_0'}]
2025-11-30 21:14:35,010 - src.components.global_refiner - INFO - LLM suggested 5 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Pipette', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Clear_Liquid'}]
2025-11-30 21:14:35,010 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 14.38s, LLM: 14.38s)
2025-11-30 21:14:35,010 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 14.38s
2025-11-30 21:14:35,010 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:14:35,010 - src.pipeline.kg_builder - INFO - Pushing batch 19/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:14:35,010 - src.components.neo4j_handler - INFO - Adding 16 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:14:35,180 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=224, relationships=180
2025-11-30 21:14:35,180 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:14:35,181 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Nitrile Gloves
2025-11-30 21:14:35,184 - src.components.neo4j_handler - DEBUG - APOC merge successful: Liquid -> Mass Of Liquid
2025-11-30 21:14:35,188 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear_Liquid -> Mass Of Liquid
2025-11-30 21:14:35,188 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Mass_Value -> Mass_Value
2025-11-30 21:14:35,188 - src.components.neo4j_handler - INFO - Applying 5 prune instructions
2025-11-30 21:14:35,192 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:14:35,193 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Nitrile Gloves
2025-11-30 21:14:35,194 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Pipette -[Transfers]-> Liquid
2025-11-30 21:14:35,194 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Beaker -[Contains]-> Liquid
2025-11-30 21:14:35,194 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Beaker -[Contains]-> Clear_Liquid
2025-11-30 21:14:35,194 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:14:35,195 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Is On]-> Digital_Balance
2025-11-30 21:14:35,196 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital_Balance -[Displays]-> Mass_Value
2025-11-30 21:14:35,197 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital_Balance -[Displays]-> Weight
2025-11-30 21:14:35,198 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Is Held Over]-> Digital Balance
2025-11-30 21:14:35,199 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Volumetric Flask -[Is Positioned On]-> Lab Table
2025-11-30 21:14:35,200 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:14:35,206 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=221, relationships=178
2025-11-30 21:14:35,208 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:14:35,208 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:14:35,208 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:14:35,208 - src.components.neo4j_handler - INFO - Batch injected in 0.20s (triplets: 0.20s, indexes: 0.00s)
2025-11-30 21:14:35,209 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 89, 'with_embedding': 89, 'linked_chunks': 70}
2025-11-30 21:14:35,209 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:14:35,238 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 221 nodes
2025-11-30 21:14:35,303 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 202 nodes
2025-11-30 21:14:35,364 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 221, 'relationship_count': 570, 'density': 0.0117, 'avg_degree': 5.1584, 'avg_unique_neighbors': 5.1041, 'global_efficiency': 0.324, 'avg_path_length': 2.8288, 'avg_degree_centrality': 0.0234, 'max_degree_centrality': 0.4636, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0372, 'degree_assortativity': -0.1773, 'graph_robustness': 0.7982, 'diameter_estimate': 6, 'clustering_coefficient': 0.248, 'weakly_connected_components': 20, 'largest_wcc_size': 202, 'pagerank_top10_percent': 12.79, 'louvain_communities': 31, 'louvain_modularity': 0.4762, 'label_entropy': 1.4863, 'computational_time': 0.1546779980417341}
2025-11-30 21:14:35,364 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 18, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508475.3647778, 'total_time': 20.979210708057508, 'aggregation': 4.097004421055317e-06, 'network_info': 0.010910850018262863, 'llm_extraction': 20.61386236094404, 'data_cleaning': 2.8857961297035217e-05, 'neo4j_injection': 0.1980787890497595, 'embedding_time': 0, 'indexing_time': 0.0018087619682773948, 'graph_injection_time': 0.19597350095864385, 'acs_metrics': {'node_count': 221, 'relationship_count': 570, 'density': 0.0117, 'avg_degree': 5.1584, 'avg_unique_neighbors': 5.1041, 'global_efficiency': 0.324, 'avg_path_length': 2.8288, 'avg_degree_centrality': 0.0234, 'max_degree_centrality': 0.4636, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0372, 'degree_assortativity': -0.1773, 'graph_robustness': 0.7982, 'diameter_estimate': 6, 'clustering_coefficient': 0.248, 'weakly_connected_components': 20, 'largest_wcc_size': 202, 'pagerank_top10_percent': 12.79, 'louvain_communities': 31, 'louvain_modularity': 0.4762, 'label_entropy': 1.4863, 'computational_time': 0.1546779980417341}, 'retrieval_queries': []}
2025-11-30 21:14:35,364 - src.pipeline.kg_builder - DEBUG - Batch 18 metrics: {
  "batch_idx": 18,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508475.3647778,
  "total_time": 20.979210708057508,
  "aggregation": 4.097004421055317e-06,
  "network_info": 0.010910850018262863,
  "llm_extraction": 20.61386236094404,
  "data_cleaning": 2.8857961297035217e-05,
  "neo4j_injection": 0.1980787890497595,
  "embedding_time": 0,
  "indexing_time": 0.0018087619682773948,
  "graph_injection_time": 0.19597350095864385,
  "acs_metrics": {
    "node_count": 221,
    "relationship_count": 570,
    "density": 0.0117,
    "avg_degree": 5.1584,
    "avg_unique_neighbors": 5.1041,
    "global_efficiency": 0.324,
    "avg_path_length": 2.8288,
    "avg_degree_centrality": 0.0234,
    "max_degree_centrality": 0.4636,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0372,
    "degree_assortativity": -0.1773,
    "graph_robustness": 0.7982,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.248,
    "weakly_connected_components": 20,
    "largest_wcc_size": 202,
    "pagerank_top10_percent": 12.79,
    "louvain_communities": 31,
    "louvain_modularity": 0.4762,
    "label_entropy": 1.4863,
    "computational_time": 0.1546779980417341
  },
  "retrieval_queries": []
}
2025-11-30 21:14:35,365 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:14:35,365 - src.pipeline.kg_builder - INFO - Batch 19 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 20.61s, Clean: 0.00s, Neo4j: 0.20s, ACS: 0.15s
2025-11-30 21:14:35,365 - src.pipeline.kg_builder - INFO - Batch 19 completed in 20.98s
Processing KG batches:  26%|██▋       | 19/72 [07:38<19:22, 21.93s/it]2025-11-30 21:14:35,365 - src.pipeline.kg_builder - INFO - Processing batch 20/72 (3 items)
2025-11-30 21:14:35,365 - src.pipeline.kg_builder - DEBUG - Batch 20 current_video_time: 04:54-04:59
2025-11-30 21:14:35,373 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 221
- Total Relationships: 178
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:14:35,373 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:14:35,373 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_0 ~214 words, content: Time: 04:44-04:49 Content: The video captures a detailed, first-person perspective of a precise laboratory procedure, likely the preparation of a solution. The sequence of actions...
2025-11-30 21:14:35,373 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_1 ~225 words, content: **Step 2: Measuring and Transferring:** The person continues to use the pipette to draw liquid from the beaker. The beaker is then placed on the...
2025-11-30 21:14:35,374 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_2 ~222 words, content: . Time: 04:49-04:54 Content: The video sequence captures a detailed, first-person perspective of a precise laboratory procedure, likely a titration or a solution preparation step....
2025-11-30 21:14:35,374 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_3 ~226 words, content: ette." The liquid being used for the rinse is likely a solvent or a diluent, as indicated by the "10%" label on the wash bottle....
2025-11-30 21:14:35,374 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_4 ~146 words, content: achieve a specific weight. - **Equipment and Setup:** The experiment is taking place on a black laboratory bench. In addition to the balance and beaker,...
2025-11-30 21:14:35,393 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:14:35,445 - src.components.pre_llm_injector - DEBUG - Found 89 existing chunk embeddings for similarity lookup
2025-11-30 21:14:35,469 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_1', '0.895'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.832')]
2025-11-30 21:14:35,471 - src.components.pre_llm_injector - DEBUG - Found 6 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2
2025-11-30 21:14:35,471 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:14:35,472 - src.components.pre_llm_injector - DEBUG - Found 6 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_1
2025-11-30 21:14:35,472 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:14:35,476 - src.components.pre_llm_injector - DEBUG - Limited Person from 52 to 2 external connections
2025-11-30 21:14:35,476 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 58 total -> 8 (internal: 5, external: 3)
2025-11-30 21:14:35,476 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[FILLS_OUT]->(Chemistry Experiment Report / ID: 2_1), (Chemistry Experiment Report / ID: 2_1)-[IS_LAID_ON]->(Lab Bench / ID: 2_1), (Lab Bench / ID: 2_1)-[CONTAINS]->(White Circular Device / ID: 2_1), (Lab Bench / ID: 2_1)-[CONTAINS]->(Black Elongated Case / ID: 2_1), (Lab Bench / ID: 2_1)-[CONTAINS]->(Roll Of Tape / ID: 2_1), (Person / ID: 0_0)-[HOLDS]->(Smartphone / ID: 0_0), (Person / ID: 0_0)-[ADDS]->(White_Powdery_Substance / ID: 6_2), (Document / ID: 0_2)-[IS_ON]->(Lab Bench / ID: 2_1)
2025-11-30 21:14:35,479 - src.components.pre_llm_injector - DEBUG - Limited Person from 52 to 2 external connections
2025-11-30 21:14:35,479 - src.components.pre_llm_injector - DEBUG - Limited Laboratory from 3 to 2 external connections
2025-11-30 21:14:35,479 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 57 total -> 6 (internal: 1, external: 5)
2025-11-30 21:14:35,479 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[PLACES]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance_Scale / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance Scale / ID: 3_1)
2025-11-30 21:14:35,479 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_0', '0.769'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_4', '0.755')]
2025-11-30 21:14:35,479 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1', '0.768'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_0', '0.737')]
2025-11-30 21:14:35,479 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_2', '0.562'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_2', '0.509')]
2025-11-30 21:14:35,479 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_1', '0.895'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_2', '0.684')]
2025-11-30 21:14:35,479 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.832'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.791')]
2025-11-30 21:14:35,479 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:14:35,479 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_0) (~214 words) with timeout=5.0s retries=3
2025-11-30 21:14:36,725 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:14:36,726 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:14:36,726 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_1) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:14:37,781 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:14:37,781 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:14:37,782 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_2) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:14:38,911 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:14:38,911 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:14:38,911 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_3) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:14:40,268 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:14:40,268 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:14:40,268 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_4) (~146 words) with timeout=5.0s retries=3
2025-11-30 21:14:41,314 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:14:41,314 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:14:41,314 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 5 chunks
2025-11-30 21:14:41,314 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 5.94s
2025-11-30 21:14:41,314 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 21:14:41,314 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[FILLS_OUT]->(Chemistry Experiment Report / ID: 2_1), (Chemistry Experiment Report / ID: 2_1)-[IS_LAID_ON]->(Lab Bench / ID: 2_1), (Lab Bench / ID: 2_1)-[CONTAINS]->(White Circular Device / ID: 2_1), (Lab Bench / ID: 2_1)-[CONTAINS]->(Black Elongated Case / ID: 2_1), (Lab Bench / ID: 2_1)-[CONTAINS]->(Roll Of Tape / ID: 2_1), (Person / ID: 0_0)-[HOLDS]->(Smartphone / ID: 0_0), (Person / ID: 0_0)-[ADDS]->(White_Powdery_Substance / ID: 6_2), (Document / ID: 0_2)-[IS_ON]->(Lab Bench / ID: 2_1)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[PLACES]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance_Scale / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance Scale / ID: 3_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["19_0", "19_2", "19_3"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["19_0", "19_3"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Beaker", "source_chunks": ["19_0"]}, {"head": "Glass_Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["19_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["19_0", "19_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["19_0"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["19_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["19_1", "19_2"]}, {"head": "Volumetric Flask", "relation": "Receives", "tail": "Liquid", "source_chunks": ["19_1"]}, {"head": "Beaker", "relation": "Is Placed On", "tail": "Balance", "source_chunks": ["19_1"]}, {"head": "Person", "relation": "Measures", "tail": "Liquid", "source_chunks": ["19_1"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["19_2", "19_4"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["19_2"]}, {"head": "Person", "relation": "Uses", "tail": "Wash_Bottle", "source_chunks": ["19_2"]}, {"head": "Pipette", "relation": "Contains", "tail": "Liquid", "source_chunks": ["19_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:14:41,315 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~425 words, ~552 tokens)
2025-11-30 21:14:41,315 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:14:53,804 - src.components.global_refiner - DEBUG - LLM call completed in 12.49s
2025-11-30 21:14:53,805 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['19_0', '19_2', '19_3']], ['Person', 'Holds', 'Glass_Beaker', ['19_0']], ['Glass_Beaker', 'Contains', 'Clear_Liquid', ['19_0']], ['Person', 'Uses', 'Pipette', ['19_0', '19_1']], ['Pipette', 'Transfers', 'Clear_Liquid', ['19_0']], ['Pipette', 'Transfers', 'Liquid', ['19_1']], ['Beaker', 'Contains', 'Liquid', ['19_1', '19_2']], ['Volumetric Flask', 'Receives', 'Liquid', ['19_1']], ['Beaker', 'Is Placed On', 'Balance', ['19_1']], ['Person', 'Measures', 'Liquid', ['19_1']], ['Person', 'Holds', 'Pipette', ['19_2', '19_4']], ['Person', 'Holds', 'Beaker', ['19_2']], ['Person', 'Uses', 'Wash_Bottle', ['19_2']], ['Pipette', 'Contains', 'Liquid', ['19_2']]] inter_chunk_relations=[['Person', 'Wears', 'Watch', ['19_0', '19_3']], ['Person', 'Holds', 'Bottle', ['19_0']], ['Person', 'Places', 'Bottle', ['19_0']], ['Person', 'Holds', 'Smartphone', ['0_0']], ['Document', 'Is On', 'Lab Bench', ['0_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_3'}, {'local': 'Glass_Beaker', 'existing': 'Glass Beaker', 'existing_id': '0_1'}, {'local': 'Clear_Liquid', 'existing': 'Clear Liquid', 'existing_id': '0_1'}, {'local': 'Liquid', 'existing': 'Liquid', 'existing_id': '0_1'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}, {'entity': 'White_Powdery_Substance'}, {'entity': 'White Circular Device'}, {'entity': 'Black Elongated Case'}, {'entity': 'Roll Of Tape'}]
2025-11-30 21:14:53,805 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=14, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['19_0', '19_2', '19_3']], ['Person', 'Holds', 'Glass_Beaker', ['19_0']], ['Glass_Beaker', 'Contains', 'Clear_Liquid', ['19_0']]]
2025-11-30 21:14:53,805 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Person', 'Wears', 'Watch', ['19_0', '19_3']], ['Person', 'Holds', 'Bottle', ['19_0']], ['Person', 'Places', 'Bottle', ['19_0']]]
2025-11-30 21:14:53,805 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_3'}, {'local': 'Glass_Beaker', 'existing': 'Glass Beaker', 'existing_id': '0_1'}, {'local': 'Clear_Liquid', 'existing': 'Clear Liquid', 'existing_id': '0_1'}]
2025-11-30 21:14:53,805 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=5, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}, {'entity': 'White_Powdery_Substance'}, {'entity': 'White Circular Device'}]
2025-11-30 21:14:53,805 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_3'}, {'local': 'Glass_Beaker', 'existing': 'Glass Beaker', 'existing_id': '0_1'}, {'local': 'Clear_Liquid', 'existing': 'Clear Liquid', 'existing_id': '0_1'}, {'local': 'Liquid', 'existing': 'Liquid', 'existing_id': '0_1'}]
2025-11-30 21:14:53,805 - src.components.global_refiner - INFO - LLM suggested 5 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}, {'entity': 'White_Powdery_Substance'}, {'entity': 'White Circular Device'}, {'entity': 'Black Elongated Case'}, {'entity': 'Roll Of Tape'}]
2025-11-30 21:14:53,805 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 19 triplets (total: 12.49s, LLM: 12.49s)
2025-11-30 21:14:53,805 - src.pipeline.kg_builder - INFO - Global refinement: 19 triplets in 12.49s
2025-11-30 21:14:53,805 - src.pipeline.kg_builder - INFO - Using 19 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:14:53,805 - src.pipeline.kg_builder - INFO - Pushing batch 20/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:14:53,805 - src.components.neo4j_handler - INFO - Adding 19 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:14:54,054 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=230, relationships=189
2025-11-30 21:14:54,054 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:14:54,054 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue_Nitrile_Gloves -> Blue_Nitrile_Gloves
2025-11-30 21:14:54,055 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass_Beaker -> Glass Beaker
2025-11-30 21:14:54,056 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear_Liquid -> Clear Liquid
2025-11-30 21:14:54,056 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Liquid -> Liquid
2025-11-30 21:14:54,056 - src.components.neo4j_handler - INFO - Applying 5 prune instructions
2025-11-30 21:14:54,056 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> No Glove
2025-11-30 21:14:54,059 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: White_Powdery_Substance
2025-11-30 21:14:54,061 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: White Circular Device
2025-11-30 21:14:54,062 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Black Elongated Case
2025-11-30 21:14:54,064 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Roll Of Tape
2025-11-30 21:14:54,064 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:14:54,066 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Watch
2025-11-30 21:14:54,067 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Bottle
2025-11-30 21:14:54,068 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Places]-> Bottle
2025-11-30 21:14:54,070 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Smartphone
2025-11-30 21:14:54,071 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Document -[Is On]-> Lab Bench
2025-11-30 21:14:54,072 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:14:54,080 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=226, relationships=176
2025-11-30 21:14:54,083 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:14:54,083 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:14:54,083 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:14:54,083 - src.components.neo4j_handler - INFO - Batch injected in 0.28s (triplets: 0.27s, indexes: 0.00s)
2025-11-30 21:14:54,084 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 94, 'with_embedding': 94, 'linked_chunks': 75}
2025-11-30 21:14:54,084 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:14:54,106 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 226 nodes
2025-11-30 21:14:54,156 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 207 nodes
2025-11-30 21:14:54,221 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 226, 'relationship_count': 583, 'density': 0.0115, 'avg_degree': 5.1593, 'avg_unique_neighbors': 5.115, 'global_efficiency': 0.3291, 'avg_path_length': 2.7922, 'avg_degree_centrality': 0.0229, 'max_degree_centrality': 0.4844, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0214, 'degree_assortativity': -0.1959, 'graph_robustness': 0.8611, 'diameter_estimate': 6, 'clustering_coefficient': 0.2432, 'weakly_connected_components': 20, 'largest_wcc_size': 207, 'pagerank_top10_percent': 12.19, 'louvain_communities': 30, 'louvain_modularity': 0.4619, 'label_entropy': 1.4898, 'computational_time': 0.1368966830195859}
2025-11-30 21:14:54,221 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 19, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508494.2219603, 'total_time': 18.856430490966886, 'aggregation': 3.8529979065060616e-06, 'network_info': 0.00775500200688839, 'llm_extraction': 18.432047232985497, 'data_cleaning': 2.4363049305975437e-05, 'neo4j_injection': 0.27827088988851756, 'embedding_time': 0, 'indexing_time': 0.0034175700275227427, 'graph_injection_time': 0.2745850330684334, 'acs_metrics': {'node_count': 226, 'relationship_count': 583, 'density': 0.0115, 'avg_degree': 5.1593, 'avg_unique_neighbors': 5.115, 'global_efficiency': 0.3291, 'avg_path_length': 2.7922, 'avg_degree_centrality': 0.0229, 'max_degree_centrality': 0.4844, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0214, 'degree_assortativity': -0.1959, 'graph_robustness': 0.8611, 'diameter_estimate': 6, 'clustering_coefficient': 0.2432, 'weakly_connected_components': 20, 'largest_wcc_size': 207, 'pagerank_top10_percent': 12.19, 'louvain_communities': 30, 'louvain_modularity': 0.4619, 'label_entropy': 1.4898, 'computational_time': 0.1368966830195859}, 'retrieval_queries': []}
2025-11-30 21:14:54,222 - src.pipeline.kg_builder - DEBUG - Batch 19 metrics: {
  "batch_idx": 19,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508494.2219603,
  "total_time": 18.856430490966886,
  "aggregation": 3.8529979065060616e-06,
  "network_info": 0.00775500200688839,
  "llm_extraction": 18.432047232985497,
  "data_cleaning": 2.4363049305975437e-05,
  "neo4j_injection": 0.27827088988851756,
  "embedding_time": 0,
  "indexing_time": 0.0034175700275227427,
  "graph_injection_time": 0.2745850330684334,
  "acs_metrics": {
    "node_count": 226,
    "relationship_count": 583,
    "density": 0.0115,
    "avg_degree": 5.1593,
    "avg_unique_neighbors": 5.115,
    "global_efficiency": 0.3291,
    "avg_path_length": 2.7922,
    "avg_degree_centrality": 0.0229,
    "max_degree_centrality": 0.4844,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0214,
    "degree_assortativity": -0.1959,
    "graph_robustness": 0.8611,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2432,
    "weakly_connected_components": 20,
    "largest_wcc_size": 207,
    "pagerank_top10_percent": 12.19,
    "louvain_communities": 30,
    "louvain_modularity": 0.4619,
    "label_entropy": 1.4898,
    "computational_time": 0.1368966830195859
  },
  "retrieval_queries": []
}
2025-11-30 21:14:54,222 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:14:54,222 - src.pipeline.kg_builder - INFO - Batch 20 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 18.43s, Clean: 0.00s, Neo4j: 0.28s, ACS: 0.14s
2025-11-30 21:14:54,222 - src.pipeline.kg_builder - INFO - Batch 20 completed in 18.86s
Processing KG batches:  28%|██▊       | 20/72 [07:57<18:12, 21.01s/it]2025-11-30 21:14:54,222 - src.pipeline.kg_builder - INFO - Processing batch 21/72 (3 items)
2025-11-30 21:14:54,222 - src.pipeline.kg_builder - DEBUG - Batch 21 current_video_time: 05:09-05:14
2025-11-30 21:14:54,230 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 226
- Total Relationships: 176
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:14:54,230 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:14:54,231 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_0 ~215 words, content: Time: 04:59-05:04 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a precise liquid transfer, performed by a person wearing blue...
2025-11-30 21:14:54,231 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_1 ~230 words, content: ** The person then uses their right hand to pick up the beaker, which is still on the balance. They lift it slightly, likely to...
2025-11-30 21:14:54,231 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_2 ~224 words, content: aker into a larger, empty volumetric flask. This is a standard technique in analytical chemistry for preparing a solution of a specific concentration. - **Measurement:**...
2025-11-30 21:14:54,231 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_3 ~122 words, content: . The individual, wearing blue nitrile gloves, is carefully transferring a liquid from a small beaker into a volumetric flask. The process is being conducted...
2025-11-30 21:14:54,252 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:14:54,303 - src.components.pre_llm_injector - DEBUG - Found 94 existing chunk embeddings for similarity lookup
2025-11-30 21:14:54,324 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_3', '0.773'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2', '0.759')]
2025-11-30 21:14:54,326 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_3 via source_chunk_ids
2025-11-30 21:14:54,326 - src.components.pre_llm_injector - DEBUG - Found 8 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2
2025-11-30 21:14:54,326 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:14:54,332 - src.components.pre_llm_injector - DEBUG - Limited Person from 49 to 2 external connections
2025-11-30 21:14:54,332 - src.components.pre_llm_injector - DEBUG - Limited Document from 5 to 2 external connections
2025-11-30 21:14:54,332 - src.components.pre_llm_injector - DEBUG - Limited Beaker from 8 to 2 external connections
2025-11-30 21:14:54,332 - src.components.pre_llm_injector - DEBUG - Limited Pipette from 8 to 2 external connections
2025-11-30 21:14:54,332 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 85 total -> 23 (internal: 11, external: 12)
2025-11-30 21:14:54,332 - src.components.pre_llm_injector - DEBUG - Subgraph: (Lab Table / ID: 17_2)-[CONTAINS]->(Document / ID: 0_2), (Person / ID: 0_0)-[WRITES_ON]->(Document / ID: 0_2), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Digital Balance / ID: 16_1)-[MEASURES]->(Mass / ID: 9_2), (Lab Table / ID: 17_2)-[CONTAINS]->(Beaker / ID: 16_0), (Person / ID: 0_0)-[HOLDS]->(Beaker / ID: 16_0), (Person / ID: 0_0)-[USES]->(Pipette / ID: 16_0), (Person / ID: 0_0)-[HOLDS]->(Pipette / ID: 16_0), (Beaker / ID: 16_0)-[IS_HELD_OVER]->(Digital Balance / ID: 16_1), (Beaker / ID: 16_0)-[IS_ON]->(Digital Balance / ID: 16_1), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[CLOSES]->(Container / ID: 4_1), (Document / ID: 0_2)-[HAS_TITLE]->(Ar Glasses Training Chemistry Experiment Report (Simplified Version) / ID: 0_2), (Document / ID: 0_2)-[CONTAINS]->(Chemical Equation / ID: 2_0), (Beaker / ID: 16_0)-[IS_ON]->(Digital_Balance / ID: 16_0), (Beaker / ID: 16_0)-[CONTAINS]->(Liquid / ID: 19_1), (Digital Balance / ID: 16_1)-[DISPLAYS]->(Weight / ID: 11_2), (Digital Balance / ID: 16_1)-[MEASURES]->(Mass Of Liquid / ID: 15_1), (Pipette / ID: 16_0)-[TRANSFERS]->(Clear_Liquid / ID: 19_0), (Pipette / ID: 16_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Volumetric Flask / ID: 18_1)-[IS_POSITIONED_ON]->(Lab Table / ID: 17_2), (Lab Table / ID: 17_2)-[CONTAINS]->(Piece Of Paper / ID: 18_2)
2025-11-30 21:14:54,332 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2', '0.759'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.696')]
2025-11-30 21:14:54,332 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_4', '0.682'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_0', '0.680')]
2025-11-30 21:14:54,332 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_3', '0.621'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_1', '0.609')]
2025-11-30 21:14:54,332 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_3', '0.773'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_4', '0.753')]
2025-11-30 21:14:54,332 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:14:54,333 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_0) (~215 words) with timeout=5.0s retries=3
2025-11-30 21:14:55,633 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:14:55,633 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:14:55,634 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_1) (~230 words) with timeout=5.0s retries=3
2025-11-30 21:14:56,705 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:14:56,706 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:14:56,706 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_2) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:14:57,956 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:14:57,956 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:14:57,957 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_3) (~122 words) with timeout=5.0s retries=3
2025-11-30 21:14:59,278 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:14:59,278 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:14:59,278 - src.components.pre_llm_injector - INFO - Extracted 20 local triplets from 4 chunks
2025-11-30 21:14:59,278 - src.pipeline.kg_builder - INFO - Pre-extraction: 20 triplets in 5.05s
2025-11-30 21:14:59,278 - src.components.global_refiner - INFO - Capping refinement input: 20 → 15 triplets
2025-11-30 21:14:59,279 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Lab Table / ID: 17_2)-[CONTAINS]->(Document / ID: 0_2), (Person / ID: 0_0)-[WRITES_ON]->(Document / ID: 0_2), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Digital Balance / ID: 16_1)-[MEASURES]->(Mass / ID: 9_2), (Lab Table / ID: 17_2)-[CONTAINS]->(Beaker / ID: 16_0), (Person / ID: 0_0)-[HOLDS]->(Beaker / ID: 16_0), (Person / ID: 0_0)-[USES]->(Pipette / ID: 16_0), (Person / ID: 0_0)-[HOLDS]->(Pipette / ID: 16_0), (Beaker / ID: 16_0)-[IS_HELD_OVER]->(Digital Balance / ID: 16_1), (Beaker / ID: 16_0)-[IS_ON]->(Digital Balance / ID: 16_1), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[CLOSES]->(Container / ID: 4_1), (Document / ID: 0_2)-[HAS_TITLE]->(Ar Glasses Training Chemistry Experiment Report (Simplified Version) / ID: 0_2), (Document / ID: 0_2)-[CONTAINS]->(Chemical Equation / ID: 2_0), (Beaker / ID: 16_0)-[IS_ON]->(Digital_Balance / ID: 16_0), (Beaker / ID: 16_0)-[CONTAINS]->(Liquid / ID: 19_1), (Digital Balance / ID: 16_1)-[DISPLAYS]->(Weight / ID: 11_2), (Digital Balance / ID: 16_1)-[MEASURES]->(Mass Of Liquid / ID: 15_1), (Pipette / ID: 16_0)-[TRANSFERS]->(Clear_Liquid / ID: 19_0), (Pipette / ID: 16_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Volumetric Flask / ID: 18_1)-[IS_POSITIONED_ON]->(Lab Table / ID: 17_2), (Lab Table / ID: 17_2)-[CONTAINS]->(Piece Of Paper / ID: 18_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["20_0", "20_1", "20_3"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Pipette", "source_chunks": ["20_0"]}, {"head": "Person", "relation": "Holds", "tail": "Wash_Bottle", "source_chunks": ["20_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["20_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Solution", "source_chunks": ["20_0"]}, {"head": "Person", "relation": "Adds Liquid To", "tail": "Beaker", "source_chunks": ["20_0"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["20_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["20_1", "20_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["20_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Balance", "source_chunks": ["20_1"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["20_1", "20_3"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["20_2"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["20_2"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["20_2"]}, {"head": "Liquid", "relation": "Is Measured On", "tail": "Digital Balance", "source_chunks": ["20_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:14:59,279 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~498 words, ~647 tokens)
2025-11-30 21:14:59,279 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:15:15,310 - src.components.global_refiner - DEBUG - LLM call completed in 16.03s
2025-11-30 21:15:15,311 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['20_0', '20_1', '20_3']], ['Person', 'Holds', 'Glass_Pipette', ['20_0']], ['Person', 'Holds', 'Wash_Bottle', ['20_0']], ['Beaker', 'Is On', 'Digital_Balance', ['20_0']], ['Beaker', 'Contains', 'Clear_Solution', ['20_0']], ['Person', 'Adds Liquid To', 'Beaker', ['20_0']], ['Person', 'Holds', 'Beaker', ['20_1']], ['Person', 'Uses', 'Pipette', ['20_1', '20_3']], ['Beaker', 'Contains', 'Liquid', ['20_1']], ['Beaker', 'Is On', 'Balance', ['20_1']], ['Person', 'Transfers', 'Liquid', ['20_1', '20_3']], ['Person', 'Wears', 'Blue Nitrile Gloves', ['20_2']], ['Person', 'Holds', 'Pipette', ['20_2']], ['Pipette', 'Transfers', 'Liquid', ['20_2']], ['Liquid', 'Is Measured On', 'Digital Balance', ['20_2']]] inter_chunk_relations=[['Person', 'Wears', 'Watch', ['20_0', '20_1', '20_2', '20_3']], ['Beaker', 'Is On', 'Digital_Balance', ['20_0', '20_1']], ['Beaker', 'Contains', 'Liquid', ['20_1']], ['Person', 'Holds', 'Beaker', ['20_1']], ['Person', 'Uses', 'Pipette', ['20_1', '20_3']], ['Person', 'Transfers', 'Liquid', ['20_1', '20_3']], ['Pipette', 'Transfers', 'Liquid', ['20_2']], ['Liquid', 'Is Measured On', 'Digital Balance', ['20_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}, {'local': 'Glass_Pipette', 'existing': 'Pipette', 'existing_id': '16_0'}, {'local': 'Clear_Solution', 'existing': 'Clear_Liquid', 'existing_id': '19_0'}, {'local': 'Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}] prune_instructions=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Pipette'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Beaker'}, {'head': 'Beaker', 'relation': 'Is On', 'tail': 'Digital_Balance'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Liquid', 'relation': 'Is Measured On', 'tail': 'Digital Balance'}]
2025-11-30 21:15:15,311 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['20_0', '20_1', '20_3']], ['Person', 'Holds', 'Glass_Pipette', ['20_0']], ['Person', 'Holds', 'Wash_Bottle', ['20_0']]]
2025-11-30 21:15:15,311 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=8, sample=[['Person', 'Wears', 'Watch', ['20_0', '20_1', '20_2', '20_3']], ['Beaker', 'Is On', 'Digital_Balance', ['20_0', '20_1']], ['Beaker', 'Contains', 'Liquid', ['20_1']]]
2025-11-30 21:15:15,311 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}, {'local': 'Glass_Pipette', 'existing': 'Pipette', 'existing_id': '16_0'}, {'local': 'Clear_Solution', 'existing': 'Clear_Liquid', 'existing_id': '19_0'}]
2025-11-30 21:15:15,311 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=6, sample=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Pipette'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Beaker'}, {'head': 'Beaker', 'relation': 'Is On', 'tail': 'Digital_Balance'}]
2025-11-30 21:15:15,311 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}, {'local': 'Glass_Pipette', 'existing': 'Pipette', 'existing_id': '16_0'}, {'local': 'Clear_Solution', 'existing': 'Clear_Liquid', 'existing_id': '19_0'}, {'local': 'Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}]
2025-11-30 21:15:15,311 - src.components.global_refiner - INFO - LLM suggested 6 triplets to prune: [{'head': 'Person', 'relation': 'Holds', 'tail': 'Pipette'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Beaker'}, {'head': 'Beaker', 'relation': 'Is On', 'tail': 'Digital_Balance'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Liquid', 'relation': 'Is Measured On', 'tail': 'Digital Balance'}]
2025-11-30 21:15:15,311 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 23 triplets (total: 16.03s, LLM: 16.03s)
2025-11-30 21:15:15,311 - src.pipeline.kg_builder - INFO - Global refinement: 23 triplets in 16.03s
2025-11-30 21:15:15,311 - src.pipeline.kg_builder - INFO - Using 23 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:15:15,311 - src.pipeline.kg_builder - INFO - Pushing batch 21/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:15:15,311 - src.components.neo4j_handler - INFO - Adding 16 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:15:15,527 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=232, relationships=183
2025-11-30 21:15:15,527 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:15:15,528 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Nitrile Gloves
2025-11-30 21:15:15,531 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass_Pipette -> Pipette
2025-11-30 21:15:15,535 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear_Solution -> Clear_Liquid
2025-11-30 21:15:15,538 - src.components.neo4j_handler - DEBUG - APOC merge successful: Liquid -> Mass Of Liquid
2025-11-30 21:15:15,538 - src.components.neo4j_handler - INFO - Applying 6 prune instructions
2025-11-30 21:15:15,543 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Pipette
2025-11-30 21:15:15,544 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Beaker
2025-11-30 21:15:15,546 - src.components.neo4j_handler - DEBUG - Pruned relationship: Beaker -[Is On]-> Digital_Balance
2025-11-30 21:15:15,547 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Beaker -[Contains]-> Liquid
2025-11-30 21:15:15,548 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Transfers]-> Liquid
2025-11-30 21:15:15,549 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Liquid -[Is Measured On]-> Digital Balance
2025-11-30 21:15:15,549 - src.components.neo4j_handler - INFO - Applying 8 inter-chunk relations
2025-11-30 21:15:15,550 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Watch
2025-11-30 21:15:15,552 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Is On]-> Digital_Balance
2025-11-30 21:15:15,553 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Contains]-> Liquid
2025-11-30 21:15:15,554 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Beaker
2025-11-30 21:15:15,556 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> Pipette
2025-11-30 21:15:15,557 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Transfers]-> Liquid
2025-11-30 21:15:15,558 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Pipette -[Transfers]-> Liquid
2025-11-30 21:15:15,559 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Liquid -[Is Measured On]-> Digital Balance
2025-11-30 21:15:15,560 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:15:15,568 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=228, relationships=181
2025-11-30 21:15:15,573 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:15:15,573 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:15:15,573 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:15:15,573 - src.components.neo4j_handler - INFO - Batch injected in 0.26s (triplets: 0.26s, indexes: 0.00s)
2025-11-30 21:15:15,575 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 98, 'with_embedding': 98, 'linked_chunks': 79}
2025-11-30 21:15:15,575 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:15:15,597 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 228 nodes
2025-11-30 21:15:15,649 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 209 nodes
2025-11-30 21:15:15,714 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 228, 'relationship_count': 607, 'density': 0.0117, 'avg_degree': 5.3246, 'avg_unique_neighbors': 5.2719, 'global_efficiency': 0.3318, 'avg_path_length': 2.7743, 'avg_degree_centrality': 0.0235, 'max_degree_centrality': 0.4934, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.022, 'degree_assortativity': -0.1908, 'graph_robustness': 0.8633, 'diameter_estimate': 6, 'clustering_coefficient': 0.2425, 'weakly_connected_components': 20, 'largest_wcc_size': 209, 'pagerank_top10_percent': 12.18, 'louvain_communities': 29, 'louvain_modularity': 0.4509, 'label_entropy': 1.4929, 'computational_time': 0.139084218069911}
2025-11-30 21:15:15,714 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 20, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508515.7146337, 'total_time': 21.491868555080146, 'aggregation': 3.2869866117835045e-06, 'network_info': 0.0076872099889442325, 'llm_extraction': 21.08071974501945, 'data_cleaning': 1.842703204602003e-05, 'neo4j_injection': 0.2623248059535399, 'embedding_time': 0, 'indexing_time': 0.0048599389847368, 'graph_injection_time': 0.25723944103810936, 'acs_metrics': {'node_count': 228, 'relationship_count': 607, 'density': 0.0117, 'avg_degree': 5.3246, 'avg_unique_neighbors': 5.2719, 'global_efficiency': 0.3318, 'avg_path_length': 2.7743, 'avg_degree_centrality': 0.0235, 'max_degree_centrality': 0.4934, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.022, 'degree_assortativity': -0.1908, 'graph_robustness': 0.8633, 'diameter_estimate': 6, 'clustering_coefficient': 0.2425, 'weakly_connected_components': 20, 'largest_wcc_size': 209, 'pagerank_top10_percent': 12.18, 'louvain_communities': 29, 'louvain_modularity': 0.4509, 'label_entropy': 1.4929, 'computational_time': 0.139084218069911}, 'retrieval_queries': []}
2025-11-30 21:15:15,714 - src.pipeline.kg_builder - DEBUG - Batch 20 metrics: {
  "batch_idx": 20,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508515.7146337,
  "total_time": 21.491868555080146,
  "aggregation": 3.2869866117835045e-06,
  "network_info": 0.0076872099889442325,
  "llm_extraction": 21.08071974501945,
  "data_cleaning": 1.842703204602003e-05,
  "neo4j_injection": 0.2623248059535399,
  "embedding_time": 0,
  "indexing_time": 0.0048599389847368,
  "graph_injection_time": 0.25723944103810936,
  "acs_metrics": {
    "node_count": 228,
    "relationship_count": 607,
    "density": 0.0117,
    "avg_degree": 5.3246,
    "avg_unique_neighbors": 5.2719,
    "global_efficiency": 0.3318,
    "avg_path_length": 2.7743,
    "avg_degree_centrality": 0.0235,
    "max_degree_centrality": 0.4934,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.022,
    "degree_assortativity": -0.1908,
    "graph_robustness": 0.8633,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2425,
    "weakly_connected_components": 20,
    "largest_wcc_size": 209,
    "pagerank_top10_percent": 12.18,
    "louvain_communities": 29,
    "louvain_modularity": 0.4509,
    "label_entropy": 1.4929,
    "computational_time": 0.139084218069911
  },
  "retrieval_queries": []
}
2025-11-30 21:15:15,715 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:15:15,715 - src.pipeline.kg_builder - INFO - Batch 21 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 21.08s, Clean: 0.00s, Neo4j: 0.26s, ACS: 0.14s
2025-11-30 21:15:15,715 - src.pipeline.kg_builder - INFO - Batch 21 completed in 21.49s
Processing KG batches:  29%|██▉       | 21/72 [08:18<17:58, 21.15s/it]2025-11-30 21:15:15,715 - src.pipeline.kg_builder - INFO - Processing batch 22/72 (3 items)
2025-11-30 21:15:15,715 - src.pipeline.kg_builder - DEBUG - Batch 22 current_video_time: 05:24-05:29
2025-11-30 21:15:15,727 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 228
- Total Relationships: 181
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:15:15,727 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:15:15,727 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_0 ~222 words, content: Time: 05:14-05:19 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a solution preparation, performed by a scientist wearing blue nitrile...
2025-11-30 21:15:15,727 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_1 ~247 words, content: **Frame 3:** The perspective changes to a wider shot, showing more of the laboratory bench. The person is now using a pipette to transfer liquid...
2025-11-30 21:15:15,727 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_2 ~225 words, content: suggests that the procedure requires high accuracy, possibly for preparing a standard solution or conducting a titration. The person is carefully handling the equipment and...
2025-11-30 21:15:15,727 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_3 ~228 words, content: - **Final Action:** After the liquid has been added, the person removes the pipette from the beaker. The beaker is then lifted and placed onto...
2025-11-30 21:15:15,727 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_4 ~184 words, content: involves a person wearing blue nitrile gloves, who is carefully handling laboratory equipment. The process begins with the person using a pipette to transfer a...
2025-11-30 21:15:15,747 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:15:15,803 - src.components.pre_llm_injector - DEBUG - Found 98 existing chunk embeddings for similarity lookup
2025-11-30 21:15:15,829 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2', '0.898'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.803')]
2025-11-30 21:15:15,831 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2
2025-11-30 21:15:15,831 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:15:15,831 - src.components.pre_llm_injector - DEBUG - Found 7 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0
2025-11-30 21:15:15,831 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:15:15,837 - src.components.pre_llm_injector - DEBUG - Limited Person from 57 to 2 external connections
2025-11-30 21:15:15,837 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 57 total -> 2 (internal: 0, external: 2)
2025-11-30 21:15:15,837 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[PLACES]->(Glass_Vial / ID: 14_0), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2)
2025-11-30 21:15:15,840 - src.components.pre_llm_injector - DEBUG - Limited Person from 57 to 2 external connections
2025-11-30 21:15:15,840 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 58 total -> 3 (internal: 0, external: 3)
2025-11-30 21:15:15,840 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WEARS]->(Ar Glasses / ID: 1_3), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Lab_Bench / ID: 3_0)-[CONTAINS]->(Bottle / ID: 1_1)
2025-11-30 21:15:15,840 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.803'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.772')]
2025-11-30 21:15:15,840 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_1', '0.560'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_2', '0.554')]
2025-11-30 21:15:15,840 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_2', '0.600'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_3', '0.575')]
2025-11-30 21:15:15,840 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2', '0.653'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_1', '0.652')]
2025-11-30 21:15:15,840 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2', '0.898'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_4', '0.781')]
2025-11-30 21:15:15,840 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:15:15,840 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_0) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:15:17,079 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:15:17,079 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:15:17,079 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_1) (~247 words) with timeout=5.0s retries=3
2025-11-30 21:15:18,097 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:15:18,097 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:15:18,098 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_2) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:15:19,356 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:15:19,356 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:15:19,356 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_3) (~228 words) with timeout=5.0s retries=3
2025-11-30 21:15:20,511 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:15:20,511 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:15:20,512 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_4) (~184 words) with timeout=5.0s retries=3
2025-11-30 21:15:21,824 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:15:21,824 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:15:21,824 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 5 chunks
2025-11-30 21:15:21,825 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 6.10s
2025-11-30 21:15:21,825 - src.components.global_refiner - INFO - Capping refinement input: 22 → 15 triplets
2025-11-30 21:15:21,825 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[PLACES]->(Glass_Vial / ID: 14_0), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[WEARS]->(Ar Glasses / ID: 1_3), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Lab_Bench / ID: 3_0)-[CONTAINS]->(Bottle / ID: 1_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["21_0", "21_2", "21_4"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["21_0"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["21_0", "21_1", "21_4"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["21_0", "21_1", "21_3", "21_4"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "-56.301_G", "source_chunks": ["21_0"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["21_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["21_1", "21_4"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["21_1"]}, {"head": "Digital Balance", "relation": "Is Used By", "tail": "Person", "source_chunks": ["21_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Beaker", "source_chunks": ["21_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Pipette", "source_chunks": ["21_2"]}, {"head": "Person", "relation": "Holds", "tail": "Wash_Bottle", "source_chunks": ["21_2"]}, {"head": "Wash_Bottle", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["21_2"]}, {"head": "Glass_Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["21_2"]}, {"head": "Digital_Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["21_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:15:21,825 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~350 words, ~455 tokens)
2025-11-30 21:15:21,825 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:15:34,221 - src.components.global_refiner - DEBUG - LLM call completed in 12.40s
2025-11-30 21:15:34,221 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['21_0', '21_2', '21_4']], ['Person', 'Holds', 'Pipette', ['21_0']], ['Pipette', 'Transfers', 'Liquid', ['21_0', '21_1', '21_4']], ['Beaker', 'Contains', 'Liquid', ['21_0', '21_1', '21_3', '21_4']], ['Digital_Balance', 'Displays', '-56.301_G', ['21_0']], ['Person', 'Uses', 'Pipette', ['21_1', '21_4']], ['Person', 'Transfers', 'Liquid', ['21_1']], ['Digital_Balance', 'Is Used By', 'Person', ['21_1']], ['Lab_Bench', 'Contains', 'Beaker', ['21_1']], ['Person', 'Holds', 'Glass_Pipette', ['21_2']], ['Person', 'Holds', 'Wash_Bottle', ['21_2']], ['Wash_Bottle', 'Dispenses', 'Liquid', ['21_2']], ['Glass_Pipette', 'Transfers', 'Liquid', ['21_2']], ['Digital_Balance', 'Measures', 'Mass', ['21_2']]] inter_chunk_relations=[['Person', 'Wears', 'Watch', ['21_0']], ['Person', 'Wears', 'Ar Glasses', ['21_0']], ['Lab_Bench', 'Contains', 'Bottle', ['21_0']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_3'}, {'local': 'Pipette', 'existing': 'Laboratory_Glassware', 'existing_id': '4_2'}, {'local': 'Glass_Pipette', 'existing': 'Laboratory_Glassware', 'existing_id': '4_2'}, {'local': 'Digital_Balance', 'existing': 'Digital_Balance', 'existing_id': '0_1'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Watch'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Ar Glasses'}, {'head': 'Lab_Bench', 'relation': 'Contains', 'tail': 'Bottle'}]
2025-11-30 21:15:34,221 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=14, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['21_0', '21_2', '21_4']], ['Person', 'Holds', 'Pipette', ['21_0']], ['Pipette', 'Transfers', 'Liquid', ['21_0', '21_1', '21_4']]]
2025-11-30 21:15:34,221 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=3, sample=[['Person', 'Wears', 'Watch', ['21_0']], ['Person', 'Wears', 'Ar Glasses', ['21_0']], ['Lab_Bench', 'Contains', 'Bottle', ['21_0']]]
2025-11-30 21:15:34,221 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_3'}, {'local': 'Pipette', 'existing': 'Laboratory_Glassware', 'existing_id': '4_2'}, {'local': 'Glass_Pipette', 'existing': 'Laboratory_Glassware', 'existing_id': '4_2'}]
2025-11-30 21:15:34,221 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=3, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Watch'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Ar Glasses'}, {'head': 'Lab_Bench', 'relation': 'Contains', 'tail': 'Bottle'}]
2025-11-30 21:15:34,221 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_3'}, {'local': 'Pipette', 'existing': 'Laboratory_Glassware', 'existing_id': '4_2'}, {'local': 'Glass_Pipette', 'existing': 'Laboratory_Glassware', 'existing_id': '4_2'}, {'local': 'Digital_Balance', 'existing': 'Digital_Balance', 'existing_id': '0_1'}]
2025-11-30 21:15:34,221 - src.components.global_refiner - INFO - LLM suggested 3 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Watch'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Ar Glasses'}, {'head': 'Lab_Bench', 'relation': 'Contains', 'tail': 'Bottle'}]
2025-11-30 21:15:34,221 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 17 triplets (total: 12.40s, LLM: 12.40s)
2025-11-30 21:15:34,221 - src.pipeline.kg_builder - INFO - Global refinement: 17 triplets in 12.40s
2025-11-30 21:15:34,221 - src.pipeline.kg_builder - INFO - Using 17 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:15:34,221 - src.pipeline.kg_builder - INFO - Pushing batch 22/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:15:34,221 - src.components.neo4j_handler - INFO - Adding 17 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:15:34,451 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=236, relationships=192
2025-11-30 21:15:34,451 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:15:34,451 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue_Nitrile_Gloves -> Blue_Nitrile_Gloves
2025-11-30 21:15:34,451 - src.components.neo4j_handler - DEBUG - APOC merge successful: Pipette -> Laboratory_Glassware
2025-11-30 21:15:34,455 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass_Pipette -> Laboratory_Glassware
2025-11-30 21:15:34,455 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Digital_Balance -> Digital_Balance
2025-11-30 21:15:34,455 - src.components.neo4j_handler - INFO - Applying 3 prune instructions
2025-11-30 21:15:34,460 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Watch
2025-11-30 21:15:34,461 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Ar Glasses
2025-11-30 21:15:34,462 - src.components.neo4j_handler - DEBUG - Pruned relationship: Lab_Bench -[Contains]-> Bottle
2025-11-30 21:15:34,462 - src.components.neo4j_handler - INFO - Applying 3 inter-chunk relations
2025-11-30 21:15:34,463 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Watch
2025-11-30 21:15:34,465 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Ar Glasses
2025-11-30 21:15:34,466 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab_Bench -[Contains]-> Bottle
2025-11-30 21:15:34,467 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:15:34,473 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=234, relationships=192
2025-11-30 21:15:34,474 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:15:34,474 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:15:34,474 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:15:34,474 - src.components.neo4j_handler - INFO - Batch injected in 0.25s (triplets: 0.25s, indexes: 0.00s)
2025-11-30 21:15:34,475 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 103, 'with_embedding': 103, 'linked_chunks': 84}
2025-11-30 21:15:34,476 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:15:34,507 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 234 nodes
2025-11-30 21:15:34,572 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 215 nodes
2025-11-30 21:15:34,643 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 234, 'relationship_count': 644, 'density': 0.0118, 'avg_degree': 5.5043, 'avg_unique_neighbors': 5.4444, 'global_efficiency': 0.336, 'avg_path_length': 2.7501, 'avg_degree_centrality': 0.0236, 'max_degree_centrality': 0.5064, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.025, 'degree_assortativity': -0.181, 'graph_robustness': 0.6941, 'diameter_estimate': 6, 'clustering_coefficient': 0.2451, 'weakly_connected_components': 20, 'largest_wcc_size': 215, 'pagerank_top10_percent': 11.85, 'louvain_communities': 29, 'louvain_modularity': 0.4392, 'label_entropy': 1.4948, 'computational_time': 0.16779775102622807}
2025-11-30 21:15:34,643 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 21, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508534.6439598, 'total_time': 18.928548793075606, 'aggregation': 3.2139942049980164e-06, 'network_info': 0.011785686016082764, 'llm_extraction': 18.494303672923706, 'data_cleaning': 1.253106165677309e-05, 'neo4j_injection': 0.2531320929992944, 'embedding_time': 0, 'indexing_time': 0.001283929101191461, 'graph_injection_time': 0.2516401510220021, 'acs_metrics': {'node_count': 234, 'relationship_count': 644, 'density': 0.0118, 'avg_degree': 5.5043, 'avg_unique_neighbors': 5.4444, 'global_efficiency': 0.336, 'avg_path_length': 2.7501, 'avg_degree_centrality': 0.0236, 'max_degree_centrality': 0.5064, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.025, 'degree_assortativity': -0.181, 'graph_robustness': 0.6941, 'diameter_estimate': 6, 'clustering_coefficient': 0.2451, 'weakly_connected_components': 20, 'largest_wcc_size': 215, 'pagerank_top10_percent': 11.85, 'louvain_communities': 29, 'louvain_modularity': 0.4392, 'label_entropy': 1.4948, 'computational_time': 0.16779775102622807}, 'retrieval_queries': []}
2025-11-30 21:15:34,644 - src.pipeline.kg_builder - DEBUG - Batch 21 metrics: {
  "batch_idx": 21,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508534.6439598,
  "total_time": 18.928548793075606,
  "aggregation": 3.2139942049980164e-06,
  "network_info": 0.011785686016082764,
  "llm_extraction": 18.494303672923706,
  "data_cleaning": 1.253106165677309e-05,
  "neo4j_injection": 0.2531320929992944,
  "embedding_time": 0,
  "indexing_time": 0.001283929101191461,
  "graph_injection_time": 0.2516401510220021,
  "acs_metrics": {
    "node_count": 234,
    "relationship_count": 644,
    "density": 0.0118,
    "avg_degree": 5.5043,
    "avg_unique_neighbors": 5.4444,
    "global_efficiency": 0.336,
    "avg_path_length": 2.7501,
    "avg_degree_centrality": 0.0236,
    "max_degree_centrality": 0.5064,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.025,
    "degree_assortativity": -0.181,
    "graph_robustness": 0.6941,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2451,
    "weakly_connected_components": 20,
    "largest_wcc_size": 215,
    "pagerank_top10_percent": 11.85,
    "louvain_communities": 29,
    "louvain_modularity": 0.4392,
    "label_entropy": 1.4948,
    "computational_time": 0.16779775102622807
  },
  "retrieval_queries": []
}
2025-11-30 21:15:34,644 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:15:34,644 - src.pipeline.kg_builder - INFO - Batch 22 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 18.49s, Clean: 0.00s, Neo4j: 0.25s, ACS: 0.17s
2025-11-30 21:15:34,644 - src.pipeline.kg_builder - INFO - Batch 22 completed in 18.93s
Processing KG batches:  31%|███       | 22/72 [08:37<17:04, 20.49s/it]2025-11-30 21:15:34,644 - src.pipeline.kg_builder - INFO - Processing batch 23/72 (3 items)
2025-11-30 21:15:34,644 - src.pipeline.kg_builder - DEBUG - Batch 23 current_video_time: 05:39-05:44
2025-11-30 21:15:34,656 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 234
- Total Relationships: 192
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:15:34,656 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:15:34,657 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_22_0 ~213 words, content: Time: 05:29-05:34 Content: The sequence of images captures a detailed laboratory procedure, likely a titration or a precise liquid transfer, performed by a person wearing...
2025-11-30 21:15:34,657 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_22_1 ~220 words, content: A white bottle with a red cap, which appears to be a chemical reagent. The label is partially visible and shows hazard symbols, including a...
2025-11-30 21:15:34,657 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_22_2 ~231 words, content: le gloves, performing a careful measurement. The person is using a pipette to transfer a liquid from a small, clear glass beaker into a larger,...
2025-11-30 21:15:34,657 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_22_3 ~109 words, content: pipette in their left hand and a small, clear glass beaker in their right hand. They are carefully using the pipette to draw liquid from...
2025-11-30 21:15:34,677 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:15:34,729 - src.components.pre_llm_injector - DEBUG - Found 103 existing chunk embeddings for similarity lookup
2025-11-30 21:15:34,752 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2', '0.877'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3', '0.847')]
2025-11-30 21:15:34,754 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3
2025-11-30 21:15:34,754 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:15:34,754 - src.components.pre_llm_injector - DEBUG - Found 7 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2
2025-11-30 21:15:34,754 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:15:34,760 - src.components.pre_llm_injector - DEBUG - Limited Person from 57 to 2 external connections
2025-11-30 21:15:34,761 - src.components.pre_llm_injector - DEBUG - Limited Document from 5 to 2 external connections
2025-11-30 21:15:34,761 - src.components.pre_llm_injector - DEBUG - Limited Beaker from 12 to 2 external connections
2025-11-30 21:15:34,761 - src.components.pre_llm_injector - DEBUG - Limited Digital Balance from 3 to 2 external connections
2025-11-30 21:15:34,761 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 90 total -> 21 (internal: 10, external: 11)
2025-11-30 21:15:34,761 - src.components.pre_llm_injector - DEBUG - Subgraph: (Lab Table / ID: 17_2)-[CONTAINS]->(Document / ID: 0_2), (Person / ID: 0_0)-[WRITES_ON]->(Document / ID: 0_2), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Digital Balance / ID: 16_1)-[MEASURES]->(Mass / ID: 9_2), (Person / ID: 0_0)-[HOLDS]->(Beaker / ID: 16_0), (Person / ID: 0_0)-[ADDS_LIQUID_TO]->(Beaker / ID: 16_0), (Lab Table / ID: 17_2)-[CONTAINS]->(Beaker / ID: 16_0), (Beaker / ID: 16_0)-[IS_HELD_OVER]->(Digital Balance / ID: 16_1), (Beaker / ID: 16_0)-[IS_ON]->(Digital Balance / ID: 16_1), (Person / ID: 0_0)-[WEARS]->(Blue Nitrile Gloves / ID: 18_1), (Person / ID: 0_0)-[HOLDS]->(Laboratory_Glassware / ID: 4_2), (Document / ID: 0_2)-[IS_ON]->(Lab Bench / ID: 2_1), (Document / ID: 0_2)-[CONTAINS]->(Chemical Equation / ID: 2_0), (Digital_Balance / ID: 16_0)-[MEASURES]->(Mass / ID: 9_2), (Beaker / ID: 16_0)-[CONTAINS]->(Clear_Liquid / ID: 19_0), (Beaker / ID: 16_0)-[IS_PLACED_ON]->(Balance / ID: 4_2), (Digital Balance / ID: 16_1)-[DISPLAYS]->(Weight / ID: 11_2), (Mass Of Liquid / ID: 15_1)-[IS_MEASURED_ON]->(Digital Balance / ID: 16_1), (Volumetric Flask / ID: 18_1)-[IS_POSITIONED_ON]->(Lab Table / ID: 17_2), (Lab Table / ID: 17_2)-[CONTAINS]->(Piece Of Paper / ID: 18_2)
2025-11-30 21:15:34,761 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 2 total -> 2 (internal: 0, external: 2)
2025-11-30 21:15:34,761 - src.components.pre_llm_injector - DEBUG - Subgraph: (Laboratory_Glassware / ID: 4_2)-[IS_POSITIONED_ABOVE]->(Flask / ID: 16_3), (Laboratory_Glassware / ID: 4_2)-[ENSURES]->(Accurate_Transfer / ID: 16_3)
2025-11-30 21:15:34,761 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.690'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_2', '0.680')]
2025-11-30 21:15:34,761 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2', '0.877'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_1', '0.769')]
2025-11-30 21:15:34,761 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_0', '0.636'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_3', '0.614')]
2025-11-30 21:15:34,761 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3', '0.847'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_15_2', '0.813')]
2025-11-30 21:15:34,761 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:15:34,761 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_22_0) (~213 words) with timeout=5.0s retries=3
2025-11-30 21:15:36,252 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:15:36,252 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:15:36,253 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_22_1) (~220 words) with timeout=5.0s retries=3
2025-11-30 21:15:37,381 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:15:37,381 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:15:37,382 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_22_2) (~231 words) with timeout=5.0s retries=3
2025-11-30 21:15:38,496 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:15:38,497 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:15:38,497 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_22_3) (~109 words) with timeout=5.0s retries=3
2025-11-30 21:15:39,716 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:15:39,717 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:15:39,717 - src.components.pre_llm_injector - INFO - Extracted 18 local triplets from 4 chunks
2025-11-30 21:15:39,717 - src.pipeline.kg_builder - INFO - Pre-extraction: 18 triplets in 5.06s
2025-11-30 21:15:39,717 - src.components.global_refiner - INFO - Capping refinement input: 18 → 15 triplets
2025-11-30 21:15:39,718 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Lab Table / ID: 17_2)-[CONTAINS]->(Document / ID: 0_2), (Person / ID: 0_0)-[WRITES_ON]->(Document / ID: 0_2), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Digital Balance / ID: 16_1)-[MEASURES]->(Mass / ID: 9_2), (Person / ID: 0_0)-[HOLDS]->(Beaker / ID: 16_0), (Person / ID: 0_0)-[ADDS_LIQUID_TO]->(Beaker / ID: 16_0), (Lab Table / ID: 17_2)-[CONTAINS]->(Beaker / ID: 16_0), (Beaker / ID: 16_0)-[IS_HELD_OVER]->(Digital Balance / ID: 16_1), (Beaker / ID: 16_0)-[IS_ON]->(Digital Balance / ID: 16_1), (Person / ID: 0_0)-[WEARS]->(Blue Nitrile Gloves / ID: 18_1), (Person / ID: 0_0)-[HOLDS]->(Laboratory_Glassware / ID: 4_2), (Document / ID: 0_2)-[IS_ON]->(Lab Bench / ID: 2_1), (Document / ID: 0_2)-[CONTAINS]->(Chemical Equation / ID: 2_0), (Digital_Balance / ID: 16_0)-[MEASURES]->(Mass / ID: 9_2), (Beaker / ID: 16_0)-[CONTAINS]->(Clear_Liquid / ID: 19_0), (Beaker / ID: 16_0)-[IS_PLACED_ON]->(Balance / ID: 4_2), (Digital Balance / ID: 16_1)-[DISPLAYS]->(Weight / ID: 11_2), (Mass Of Liquid / ID: 15_1)-[IS_MEASURED_ON]->(Digital Balance / ID: 16_1), (Volumetric Flask / ID: 18_1)-[IS_POSITIONED_ON]->(Lab Table / ID: 17_2), (Lab Table / ID: 17_2)-[CONTAINS]->(Piece Of Paper / ID: 18_2)
Subgraph_2: Subgraph: (Laboratory_Glassware / ID: 4_2)-[IS_POSITIONED_ABOVE]->(Flask / ID: 16_3), (Laboratory_Glassware / ID: 4_2)-[ENSURES]->(Accurate_Transfer / ID: 16_3)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["22_0", "22_2"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["22_0", "22_2", "22_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["22_0", "22_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Dark_Liquid", "source_chunks": ["22_0"]}, {"head": "Beaker", "relation": "Placed On", "tail": "Digital_Analytical_Balance", "source_chunks": ["22_0"]}, {"head": "Digital_Analytical_Balance", "relation": "Displays", "tail": "6.301_G", "source_chunks": ["22_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["22_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["22_1"]}, {"head": "Pipette", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["22_1"]}, {"head": "Liquid", "relation": "Is Added To", "tail": "Sample", "source_chunks": ["22_1"]}, {"head": "Sample", "relation": "Is Placed On", "tail": "Digital Balance", "source_chunks": ["22_1"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["22_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["22_2", "22_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["22_2", "22_3"]}, {"head": "Digital_Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["22_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:15:39,718 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~496 words, ~645 tokens)
2025-11-30 21:15:39,718 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:15:53,672 - src.components.global_refiner - DEBUG - LLM call completed in 13.95s
2025-11-30 21:15:53,672 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue Nitrile Gloves', ['22_0', '22_1', '22_2']], ['Person', 'Holds', 'Pipette', ['22_0', '22_2', '22_3']], ['Pipette', 'Transfers', 'Liquid', ['22_0', '22_2']], ['Beaker', 'Contains', 'Dark_Liquid', ['22_0']], ['Beaker', 'Placed On', 'Digital_Analytical_Balance', ['22_0']], ['Digital_Analytical_Balance', 'Displays', '6.301_G', ['22_0']], ['Person', 'Uses', 'Pipette', ['22_1']], ['Pipette', 'Dispenses', 'Liquid', ['22_1']], ['Liquid', 'Is Added To', 'Sample', ['22_1']], ['Sample', 'Is Placed On', 'Digital Balance', ['22_1']], ['Digital Balance', 'Measures', 'Mass', ['22_1']], ['Person', 'Holds', 'Beaker', ['22_2', '22_3']], ['Beaker', 'Contains', 'Liquid', ['22_2', '22_3']], ['Digital_Balance', 'Measures', 'Mass', ['22_2']]] inter_chunk_relations=[['Digital_Analytical_Balance', 'Displays', 'Weight', ['22_0']], ['Digital_Balance', 'Measures', 'Mass', ['22_2']], ['Beaker', 'Contains', 'Clear_Liquid', ['22_2', '22_3']], ['Digital_Balance', 'Measures', 'Mass', ['22_1']], ['Person', 'Holds', 'Laboratory_Glassware', ['22_2', '22_3']]] merge_instructions=[{'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '18_1'}, {'local': 'Digital Analytical Balance', 'existing': 'Digital Balance', 'existing_id': '16_1'}, {'local': 'Digital Balance', 'existing': 'Digital Balance', 'existing_id': '16_1'}, {'local': 'Liquid', 'existing': 'Clear_Liquid', 'existing_id': '19_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Dark_Liquid'}, {'head': 'Digital_Balance', 'relation': 'Measures', 'tail': 'Mass'}, {'head': 'Digital_Analytical_Balance', 'relation': 'Displays', 'tail': '6.301_G'}]
2025-11-30 21:15:53,672 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=14, sample=[['Person', 'Wears', 'Blue Nitrile Gloves', ['22_0', '22_1', '22_2']], ['Person', 'Holds', 'Pipette', ['22_0', '22_2', '22_3']], ['Pipette', 'Transfers', 'Liquid', ['22_0', '22_2']]]
2025-11-30 21:15:53,672 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Digital_Analytical_Balance', 'Displays', 'Weight', ['22_0']], ['Digital_Balance', 'Measures', 'Mass', ['22_2']], ['Beaker', 'Contains', 'Clear_Liquid', ['22_2', '22_3']]]
2025-11-30 21:15:53,672 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '18_1'}, {'local': 'Digital Analytical Balance', 'existing': 'Digital Balance', 'existing_id': '16_1'}, {'local': 'Digital Balance', 'existing': 'Digital Balance', 'existing_id': '16_1'}]
2025-11-30 21:15:53,672 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Dark_Liquid'}, {'head': 'Digital_Balance', 'relation': 'Measures', 'tail': 'Mass'}]
2025-11-30 21:15:53,673 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '18_1'}, {'local': 'Digital Analytical Balance', 'existing': 'Digital Balance', 'existing_id': '16_1'}, {'local': 'Digital Balance', 'existing': 'Digital Balance', 'existing_id': '16_1'}, {'local': 'Liquid', 'existing': 'Clear_Liquid', 'existing_id': '19_0'}]
2025-11-30 21:15:53,673 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Dark_Liquid'}, {'head': 'Digital_Balance', 'relation': 'Measures', 'tail': 'Mass'}, {'head': 'Digital_Analytical_Balance', 'relation': 'Displays', 'tail': '6.301_G'}]
2025-11-30 21:15:53,673 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 19 triplets (total: 13.96s, LLM: 13.95s)
2025-11-30 21:15:53,673 - src.pipeline.kg_builder - INFO - Global refinement: 19 triplets in 13.96s
2025-11-30 21:15:53,673 - src.pipeline.kg_builder - INFO - Using 19 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:15:53,673 - src.pipeline.kg_builder - INFO - Pushing batch 23/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:15:53,673 - src.components.neo4j_handler - INFO - Adding 17 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:15:53,827 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=242, relationships=202
2025-11-30 21:15:53,827 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:15:53,827 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue Nitrile Gloves -> Blue Nitrile Gloves
2025-11-30 21:15:53,828 - src.components.neo4j_handler - DEBUG - APOC merge successful: Digital Analytical Balance -> Digital Balance
2025-11-30 21:15:53,828 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Digital Balance -> Digital Balance
2025-11-30 21:15:53,828 - src.components.neo4j_handler - DEBUG - APOC merge successful: Liquid -> Clear_Liquid
2025-11-30 21:15:53,828 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:15:53,832 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Nitrile Gloves
2025-11-30 21:15:53,833 - src.components.neo4j_handler - DEBUG - Pruned relationship: Beaker -[Contains]-> Dark_Liquid
2025-11-30 21:15:53,834 - src.components.neo4j_handler - DEBUG - Pruned relationship: Digital_Balance -[Measures]-> Mass
2025-11-30 21:15:53,835 - src.components.neo4j_handler - DEBUG - Pruned relationship: Digital_Analytical_Balance -[Displays]-> 6.301_G
2025-11-30 21:15:53,835 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:15:53,836 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital_Analytical_Balance -[Displays]-> Weight
2025-11-30 21:15:53,837 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital_Balance -[Measures]-> Mass
2025-11-30 21:15:53,838 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Contains]-> Clear_Liquid
2025-11-30 21:15:53,838 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital_Balance -[Measures]-> Mass
2025-11-30 21:15:53,839 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Laboratory_Glassware
2025-11-30 21:15:53,840 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:15:53,844 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=241, relationships=198
2025-11-30 21:15:53,845 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:15:53,845 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:15:53,845 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:15:53,845 - src.components.neo4j_handler - INFO - Batch injected in 0.17s (triplets: 0.17s, indexes: 0.00s)
2025-11-30 21:15:53,846 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 107, 'with_embedding': 107, 'linked_chunks': 88}
2025-11-30 21:15:53,846 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:15:53,880 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 241 nodes
2025-11-30 21:15:53,947 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 222 nodes
2025-11-30 21:15:54,064 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 241, 'relationship_count': 676, 'density': 0.0117, 'avg_degree': 5.61, 'avg_unique_neighbors': 5.5519, 'global_efficiency': 0.3375, 'avg_path_length': 2.7503, 'avg_degree_centrality': 0.0234, 'max_degree_centrality': 0.5083, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0393, 'degree_assortativity': -0.1798, 'graph_robustness': 0.6805, 'diameter_estimate': 6, 'clustering_coefficient': 0.2404, 'weakly_connected_components': 20, 'largest_wcc_size': 222, 'pagerank_top10_percent': 11.57, 'louvain_communities': 28, 'louvain_modularity': 0.4468, 'label_entropy': 1.4955, 'computational_time': 0.2174794099992141}
2025-11-30 21:15:54,064 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 22, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508554.0645854, 'total_time': 19.419831751962192, 'aggregation': 2.9189977794885635e-06, 'network_info': 0.011698968010023236, 'llm_extraction': 19.016649829107337, 'data_cleaning': 3.46810556948185e-05, 'neo4j_injection': 0.1725564629305154, 'embedding_time': 0, 'indexing_time': 0.0012356550432741642, 'graph_injection_time': 0.17098260193597525, 'acs_metrics': {'node_count': 241, 'relationship_count': 676, 'density': 0.0117, 'avg_degree': 5.61, 'avg_unique_neighbors': 5.5519, 'global_efficiency': 0.3375, 'avg_path_length': 2.7503, 'avg_degree_centrality': 0.0234, 'max_degree_centrality': 0.5083, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0393, 'degree_assortativity': -0.1798, 'graph_robustness': 0.6805, 'diameter_estimate': 6, 'clustering_coefficient': 0.2404, 'weakly_connected_components': 20, 'largest_wcc_size': 222, 'pagerank_top10_percent': 11.57, 'louvain_communities': 28, 'louvain_modularity': 0.4468, 'label_entropy': 1.4955, 'computational_time': 0.2174794099992141}, 'retrieval_queries': []}
2025-11-30 21:15:54,064 - src.pipeline.kg_builder - DEBUG - Batch 22 metrics: {
  "batch_idx": 22,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508554.0645854,
  "total_time": 19.419831751962192,
  "aggregation": 2.9189977794885635e-06,
  "network_info": 0.011698968010023236,
  "llm_extraction": 19.016649829107337,
  "data_cleaning": 3.46810556948185e-05,
  "neo4j_injection": 0.1725564629305154,
  "embedding_time": 0,
  "indexing_time": 0.0012356550432741642,
  "graph_injection_time": 0.17098260193597525,
  "acs_metrics": {
    "node_count": 241,
    "relationship_count": 676,
    "density": 0.0117,
    "avg_degree": 5.61,
    "avg_unique_neighbors": 5.5519,
    "global_efficiency": 0.3375,
    "avg_path_length": 2.7503,
    "avg_degree_centrality": 0.0234,
    "max_degree_centrality": 0.5083,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0393,
    "degree_assortativity": -0.1798,
    "graph_robustness": 0.6805,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2404,
    "weakly_connected_components": 20,
    "largest_wcc_size": 222,
    "pagerank_top10_percent": 11.57,
    "louvain_communities": 28,
    "louvain_modularity": 0.4468,
    "label_entropy": 1.4955,
    "computational_time": 0.2174794099992141
  },
  "retrieval_queries": []
}
2025-11-30 21:15:54,065 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:15:54,065 - src.pipeline.kg_builder - INFO - Batch 23 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.02s, Clean: 0.00s, Neo4j: 0.17s, ACS: 0.22s
2025-11-30 21:15:54,065 - src.pipeline.kg_builder - INFO - Batch 23 completed in 19.42s
Processing KG batches:  32%|███▏      | 23/72 [08:57<16:28, 20.17s/it]2025-11-30 21:15:54,065 - src.pipeline.kg_builder - INFO - Processing batch 24/72 (3 items)
2025-11-30 21:15:54,065 - src.pipeline.kg_builder - DEBUG - Batch 24 current_video_time: 05:54-05:59
2025-11-30 21:15:54,072 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 241
- Total Relationships: 198
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:15:54,072 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:15:54,072 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_23_0 ~213 words, content: Time: 05:44-05:49 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a precise weighing process, from a first-person perspective. The setting...
2025-11-30 21:15:54,072 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_23_1 ~233 words, content: of the pipette and the beaker. The person's left hand, with the watch, is visible, and they are carefully controlling the flow of the liquid....
2025-11-30 21:15:54,072 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_23_2 ~219 words, content: added. Time: 05:49-05:54 Content: The video sequence captures a detailed laboratory procedure, likely the preparation of a solution, from a first-person perspective. The scene is...
2025-11-30 21:15:54,072 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_23_3 ~227 words, content: In summary, the video shows a person using a balance to accurately measure a liquid by adding it to a volumetric flask, a common technique...
2025-11-30 21:15:54,072 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_23_4 ~82 words, content: a window, and a cardboard box with a "小心易燃" (Caution: Flammable) warning sign. A printed document with Chinese text, likely a lab protocol, is also...
2025-11-30 21:15:54,092 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:15:54,150 - src.components.pre_llm_injector - DEBUG - Found 107 existing chunk embeddings for similarity lookup
2025-11-30 21:15:54,179 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3', '0.815'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_4', '0.766')]
2025-11-30 21:15:54,181 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3
2025-11-30 21:15:54,181 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:15:54,182 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_4
2025-11-30 21:15:54,182 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:15:54,187 - src.components.pre_llm_injector - DEBUG - Limited Person from 62 to 2 external connections
2025-11-30 21:15:54,187 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 62 total -> 2 (internal: 0, external: 2)
2025-11-30 21:15:54,187 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[ADDS_LIQUID_TO]->(Beaker / ID: 16_0), (Person / ID: 0_0)-[WEARS]->(Blue_Nitrile_Gloves / ID: 21_0)
2025-11-30 21:15:54,187 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 2 total -> 2 (internal: 0, external: 2)
2025-11-30 21:15:54,187 - src.components.pre_llm_injector - DEBUG - Subgraph: (Laboratory_Glassware / ID: 4_2)-[IS_POSITIONED_ABOVE]->(Flask / ID: 16_3), (Laboratory_Glassware / ID: 4_2)-[ENSURES]->(Accurate_Transfer / ID: 16_3)
2025-11-30 21:15:54,187 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_1', '0.617'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_0', '0.604')]
2025-11-30 21:15:54,187 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_1', '0.727'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_0', '0.718')]
2025-11-30 21:15:54,187 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_2', '0.598'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_2', '0.571')]
2025-11-30 21:15:54,187 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_4', '0.587'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.585')]
2025-11-30 21:15:54,187 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3', '0.815'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_4', '0.766')]
2025-11-30 21:15:54,187 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:15:54,188 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_23_0) (~213 words) with timeout=5.0s retries=3
2025-11-30 21:15:55,334 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:15:55,334 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:15:55,334 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_23_1) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:15:56,256 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:15:56,256 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:15:56,257 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_23_2) (~219 words) with timeout=5.0s retries=3
2025-11-30 21:15:57,584 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:15:57,584 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:15:57,584 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_23_3) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:15:59,007 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:15:59,007 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:15:59,007 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_23_4) (~82 words) with timeout=5.0s retries=3
2025-11-30 21:16:00,163 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:16:00,163 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:16:00,163 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 5 chunks
2025-11-30 21:16:00,163 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 6.09s
2025-11-30 21:16:00,163 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 21:16:00,163 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[ADDS_LIQUID_TO]->(Beaker / ID: 16_0), (Person / ID: 0_0)-[WEARS]->(Blue_Nitrile_Gloves / ID: 21_0)
Subgraph_2: Subgraph: (Laboratory_Glassware / ID: 4_2)-[IS_POSITIONED_ABOVE]->(Flask / ID: 16_3), (Laboratory_Glassware / ID: 4_2)-[ENSURES]->(Accurate_Transfer / ID: 16_3)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["23_0", "23_2", "23_3"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["23_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["23_0", "23_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["23_0", "23_1"]}, {"head": "Pipette", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["23_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["23_0"]}, {"head": "Person", "relation": "Holds", "tail": "White Bottle", "source_chunks": ["23_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["23_1"]}, {"head": "Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["23_1"]}, {"head": "Person", "relation": "Adds", "tail": "Liquid", "source_chunks": ["23_1"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["23_2", "23_3"]}, {"head": "Person", "relation": "Holds", "tail": "Wash_Bottle", "source_chunks": ["23_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["23_2", "23_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["23_2"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["23_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:16:00,164 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~338 words, ~439 tokens)
2025-11-30 21:16:00,164 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:16:20,144 - src.components.global_refiner - DEBUG - LLM call completed in 19.98s
2025-11-30 21:16:20,144 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Watch', ['23_0']], ['Person', 'Holds', 'Pipette', ['23_0', '23_1']], ['Person', 'Holds', 'Beaker', ['23_0', '23_1']], ['Pipette', 'Dispenses', 'Liquid', ['23_0']], ['Beaker', 'Is On', 'Digital_Balance', ['23_0']], ['Person', 'Holds', 'White Bottle', ['23_1']], ['Beaker', 'Contains', 'Liquid', ['23_1']], ['Balance', 'Measures', 'Mass', ['23_1']], ['Person', 'Adds', 'Liquid', ['23_1']], ['Person', 'Holds', 'Volumetric_Flask', ['23_2', '23_3']], ['Person', 'Holds', 'Wash_Bottle', ['23_2']], ['Person', 'Uses', 'Pipette', ['23_2', '23_3']], ['Pipette', 'Transfers', 'Liquid', ['23_2']], ['Volumetric_Flask', 'Contains', 'Liquid', ['23_2']]] inter_chunk_relations=[['Person', 'Holds', 'Blue_Nitrile_Gloves', ['23_0']], ['Person', 'Holds', 'Beaker', ['23_0', '23_1']], ['Person', 'Holds', 'Volumetric_Flask', ['23_2', '23_3']], ['Pipette', 'Transfers', 'Liquid', ['23_2']], ['Beaker', 'Is On', 'Digital_Balance', ['23_0']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '21_0'}, {'local': 'Digital_Balance', 'existing': 'Digital_Balance', 'existing_id': '4_2'}, {'local': 'Beaker', 'existing': 'Beaker', 'existing_id': '16_0'}, {'local': 'Pipette', 'existing': 'Pipette', 'existing_id': '16_3'}, {'local': 'Volumetric_Flask', 'existing': 'Volumetric_Flask', 'existing_id': '16_3'}, {'local': 'Liquid', 'existing': 'Liquid', 'existing_id': '16_3'}, {'local': 'Mass', 'existing': 'Mass', 'existing_id': '16_3'}, {'local': 'Watch', 'existing': 'Watch', 'existing_id': '0_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Beaker'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Pipette'}, {'head': 'Pipette', 'relation': 'Dispenses', 'tail': 'Liquid'}, {'head': 'Beaker', 'relation': 'Is On', 'tail': 'Digital_Balance'}, {'head': 'Person', 'relation': 'Adds', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'White Bottle'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Balance', 'relation': 'Measures', 'tail': 'Mass'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric_Flask'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Wash_Bottle'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Pipette'}, {'head': 'Pipette', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Volumetric_Flask', 'relation': 'Contains', 'tail': 'Liquid'}]
2025-11-30 21:16:20,145 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=14, sample=[['Person', 'Wears', 'Watch', ['23_0']], ['Person', 'Holds', 'Pipette', ['23_0', '23_1']], ['Person', 'Holds', 'Beaker', ['23_0', '23_1']]]
2025-11-30 21:16:20,145 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Person', 'Holds', 'Blue_Nitrile_Gloves', ['23_0']], ['Person', 'Holds', 'Beaker', ['23_0', '23_1']], ['Person', 'Holds', 'Volumetric_Flask', ['23_2', '23_3']]]
2025-11-30 21:16:20,145 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=8, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '21_0'}, {'local': 'Digital_Balance', 'existing': 'Digital_Balance', 'existing_id': '4_2'}, {'local': 'Beaker', 'existing': 'Beaker', 'existing_id': '16_0'}]
2025-11-30 21:16:20,145 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=14, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Beaker'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Pipette'}]
2025-11-30 21:16:20,145 - src.components.global_refiner - INFO - LLM suggested 8 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '21_0'}, {'local': 'Digital_Balance', 'existing': 'Digital_Balance', 'existing_id': '4_2'}, {'local': 'Beaker', 'existing': 'Beaker', 'existing_id': '16_0'}, {'local': 'Pipette', 'existing': 'Pipette', 'existing_id': '16_3'}, {'local': 'Volumetric_Flask', 'existing': 'Volumetric_Flask', 'existing_id': '16_3'}, {'local': 'Liquid', 'existing': 'Liquid', 'existing_id': '16_3'}, {'local': 'Mass', 'existing': 'Mass', 'existing_id': '16_3'}, {'local': 'Watch', 'existing': 'Watch', 'existing_id': '0_0'}]
2025-11-30 21:16:20,145 - src.components.global_refiner - INFO - LLM suggested 14 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Beaker'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Pipette'}, {'head': 'Pipette', 'relation': 'Dispenses', 'tail': 'Liquid'}, {'head': 'Beaker', 'relation': 'Is On', 'tail': 'Digital_Balance'}, {'head': 'Person', 'relation': 'Adds', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'White Bottle'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Balance', 'relation': 'Measures', 'tail': 'Mass'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric_Flask'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Wash_Bottle'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Pipette'}, {'head': 'Pipette', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Volumetric_Flask', 'relation': 'Contains', 'tail': 'Liquid'}]
2025-11-30 21:16:20,145 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 19 triplets (total: 19.98s, LLM: 19.98s)
2025-11-30 21:16:20,145 - src.pipeline.kg_builder - INFO - Global refinement: 19 triplets in 19.98s
2025-11-30 21:16:20,145 - src.pipeline.kg_builder - INFO - Using 19 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:16:20,145 - src.pipeline.kg_builder - INFO - Pushing batch 24/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:16:20,145 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:16:20,371 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=248, relationships=207
2025-11-30 21:16:20,371 - src.components.neo4j_handler - INFO - Applying 8 merge instructions
2025-11-30 21:16:20,371 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue_Nitrile_Gloves -> Blue_Nitrile_Gloves
2025-11-30 21:16:20,371 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Digital_Balance -> Digital_Balance
2025-11-30 21:16:20,371 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Beaker -> Beaker
2025-11-30 21:16:20,371 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Pipette -> Pipette
2025-11-30 21:16:20,371 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Volumetric_Flask -> Volumetric_Flask
2025-11-30 21:16:20,371 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Liquid -> Liquid
2025-11-30 21:16:20,371 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Mass -> Mass
2025-11-30 21:16:20,371 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Watch -> Watch
2025-11-30 21:16:20,371 - src.components.neo4j_handler - INFO - Applying 14 prune instructions
2025-11-30 21:16:20,373 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:16:20,376 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Beaker
2025-11-30 21:16:20,379 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Pipette
2025-11-30 21:16:20,380 - src.components.neo4j_handler - DEBUG - Pruned relationship: Pipette -[Dispenses]-> Liquid
2025-11-30 21:16:20,383 - src.components.neo4j_handler - DEBUG - Pruned relationship: Beaker -[Is On]-> Digital_Balance
2025-11-30 21:16:20,385 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Adds]-> Liquid
2025-11-30 21:16:20,386 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> White Bottle
2025-11-30 21:16:20,389 - src.components.neo4j_handler - DEBUG - Pruned relationship: Beaker -[Contains]-> Liquid
2025-11-30 21:16:20,391 - src.components.neo4j_handler - DEBUG - Pruned relationship: Balance -[Measures]-> Mass
2025-11-30 21:16:20,393 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Volumetric_Flask
2025-11-30 21:16:20,395 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Wash_Bottle
2025-11-30 21:16:20,399 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Uses]-> Pipette
2025-11-30 21:16:20,400 - src.components.neo4j_handler - DEBUG - Pruned relationship: Pipette -[Transfers]-> Liquid
2025-11-30 21:16:20,402 - src.components.neo4j_handler - DEBUG - Pruned relationship: Volumetric_Flask -[Contains]-> Liquid
2025-11-30 21:16:20,403 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:16:20,404 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Blue_Nitrile_Gloves
2025-11-30 21:16:20,408 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Beaker
2025-11-30 21:16:20,409 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Volumetric_Flask
2025-11-30 21:16:20,411 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Pipette -[Transfers]-> Liquid
2025-11-30 21:16:20,412 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Is On]-> Digital_Balance
2025-11-30 21:16:20,413 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:16:20,420 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=248, relationships=197
2025-11-30 21:16:20,422 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:16:20,422 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:16:20,422 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:16:20,422 - src.components.neo4j_handler - INFO - Batch injected in 0.28s (triplets: 0.27s, indexes: 0.00s)
2025-11-30 21:16:20,423 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 112, 'with_embedding': 112, 'linked_chunks': 92}
2025-11-30 21:16:20,423 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:16:20,449 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 248 nodes
2025-11-30 21:16:20,512 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 228 nodes
2025-11-30 21:16:20,590 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 248, 'relationship_count': 698, 'density': 0.0114, 'avg_degree': 5.629, 'avg_unique_neighbors': 5.5726, 'global_efficiency': 0.3354, 'avg_path_length': 2.7554, 'avg_degree_centrality': 0.0228, 'max_degree_centrality': 0.5061, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0373, 'degree_assortativity': -0.1711, 'graph_robustness': 0.6891, 'diameter_estimate': 6, 'clustering_coefficient': 0.2346, 'weakly_connected_components': 21, 'largest_wcc_size': 228, 'pagerank_top10_percent': 11.28, 'louvain_communities': 29, 'louvain_modularity': 0.4363, 'label_entropy': 1.4966, 'computational_time': 0.1670377200935036}
2025-11-30 21:16:20,591 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 23, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508580.591094, 'total_time': 26.525703195948154, 'aggregation': 3.527035005390644e-06, 'network_info': 0.006832765997387469, 'llm_extraction': 26.073122117086314, 'data_cleaning': 3.033608663827181e-05, 'neo4j_injection': 0.27722196793183684, 'embedding_time': 0, 'indexing_time': 0.002516664913855493, 'graph_injection_time': 0.2743876068852842, 'acs_metrics': {'node_count': 248, 'relationship_count': 698, 'density': 0.0114, 'avg_degree': 5.629, 'avg_unique_neighbors': 5.5726, 'global_efficiency': 0.3354, 'avg_path_length': 2.7554, 'avg_degree_centrality': 0.0228, 'max_degree_centrality': 0.5061, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0373, 'degree_assortativity': -0.1711, 'graph_robustness': 0.6891, 'diameter_estimate': 6, 'clustering_coefficient': 0.2346, 'weakly_connected_components': 21, 'largest_wcc_size': 228, 'pagerank_top10_percent': 11.28, 'louvain_communities': 29, 'louvain_modularity': 0.4363, 'label_entropy': 1.4966, 'computational_time': 0.1670377200935036}, 'retrieval_queries': []}
2025-11-30 21:16:20,591 - src.pipeline.kg_builder - DEBUG - Batch 23 metrics: {
  "batch_idx": 23,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508580.591094,
  "total_time": 26.525703195948154,
  "aggregation": 3.527035005390644e-06,
  "network_info": 0.006832765997387469,
  "llm_extraction": 26.073122117086314,
  "data_cleaning": 3.033608663827181e-05,
  "neo4j_injection": 0.27722196793183684,
  "embedding_time": 0,
  "indexing_time": 0.002516664913855493,
  "graph_injection_time": 0.2743876068852842,
  "acs_metrics": {
    "node_count": 248,
    "relationship_count": 698,
    "density": 0.0114,
    "avg_degree": 5.629,
    "avg_unique_neighbors": 5.5726,
    "global_efficiency": 0.3354,
    "avg_path_length": 2.7554,
    "avg_degree_centrality": 0.0228,
    "max_degree_centrality": 0.5061,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0373,
    "degree_assortativity": -0.1711,
    "graph_robustness": 0.6891,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2346,
    "weakly_connected_components": 21,
    "largest_wcc_size": 228,
    "pagerank_top10_percent": 11.28,
    "louvain_communities": 29,
    "louvain_modularity": 0.4363,
    "label_entropy": 1.4966,
    "computational_time": 0.1670377200935036
  },
  "retrieval_queries": []
}
2025-11-30 21:16:20,591 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:16:20,591 - src.pipeline.kg_builder - INFO - Batch 24 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 26.07s, Clean: 0.00s, Neo4j: 0.28s, ACS: 0.17s
2025-11-30 21:16:20,591 - src.pipeline.kg_builder - INFO - Batch 24 completed in 26.53s
Processing KG batches:  33%|███▎      | 24/72 [09:23<17:39, 22.07s/it]2025-11-30 21:16:20,591 - src.pipeline.kg_builder - INFO - Processing batch 25/72 (3 items)
2025-11-30 21:16:20,591 - src.pipeline.kg_builder - DEBUG - Batch 25 current_video_time: 06:09-06:14
2025-11-30 21:16:20,603 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 248
- Total Relationships: 197
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:16:20,603 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:16:20,603 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_24_0 ~224 words, content: Time: 05:59-06:04 Content: The video sequence captures a first-person perspective of a laboratory procedure, likely a titration or solution preparation, taking place on a black...
2025-11-30 21:16:20,603 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_24_1 ~229 words, content: - **Other Objects:** A white bottle with a red cap, likely containing a chemical reagent, sits on the bench. A printed document with Chinese text,...
2025-11-30 21:16:20,603 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_24_2 ~226 words, content: On the table, there is a white bottle with a red cap, a box of aluminum foil, a pen, and a document with handwritten notes....
2025-11-30 21:16:20,603 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_24_3 ~234 words, content: overall atmosphere suggests a methodical and careful approach to the experiment. In summary, the video depicts a detailed and precise laboratory procedure, likely involving the...
2025-11-30 21:16:20,603 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_24_4 ~28 words, content: liquid level in the volumetric flask is accurate. The camera remains relatively stable, focusing on the hand and the flask, with slight movements that follow...
2025-11-30 21:16:20,623 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:16:20,685 - src.components.pre_llm_injector - DEBUG - Found 112 existing chunk embeddings for similarity lookup
2025-11-30 21:16:20,715 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2', '0.738'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_3', '0.720')]
2025-11-30 21:16:20,717 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_3
2025-11-30 21:16:20,717 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:16:20,717 - src.components.pre_llm_injector - DEBUG - Found 7 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2
2025-11-30 21:16:20,717 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:16:20,726 - src.components.pre_llm_injector - DEBUG - Limited Person from 60 to 2 external connections
2025-11-30 21:16:20,726 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 60 total -> 2 (internal: 0, external: 2)
2025-11-30 21:16:20,726 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WEARS]->(Ar Glasses / ID: 1_3), (Person / ID: 0_0)-[HOLDS]->(Laboratory_Glassware / ID: 4_2)
2025-11-30 21:16:20,727 - src.components.pre_llm_injector - DEBUG - Limited Person from 55 to 2 external connections
2025-11-30 21:16:20,728 - src.components.pre_llm_injector - DEBUG - Limited Document from 5 to 2 external connections
2025-11-30 21:16:20,728 - src.components.pre_llm_injector - DEBUG - Limited Beaker from 13 to 2 external connections
2025-11-30 21:16:20,728 - src.components.pre_llm_injector - DEBUG - Limited Digital Balance from 4 to 2 external connections
2025-11-30 21:16:20,728 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 90 total -> 21 (internal: 10, external: 11)
2025-11-30 21:16:20,728 - src.components.pre_llm_injector - DEBUG - Subgraph: (Lab Table / ID: 17_2)-[CONTAINS]->(Document / ID: 0_2), (Person / ID: 0_0)-[WRITES_ON]->(Document / ID: 0_2), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Digital Balance / ID: 16_1)-[MEASURES]->(Mass / ID: 9_2), (Person / ID: 0_0)-[HOLDS]->(Beaker / ID: 16_0), (Person / ID: 0_0)-[ADDS_LIQUID_TO]->(Beaker / ID: 16_0), (Lab Table / ID: 17_2)-[CONTAINS]->(Beaker / ID: 16_0), (Beaker / ID: 16_0)-[IS_HELD_OVER]->(Digital Balance / ID: 16_1), (Beaker / ID: 16_0)-[IS_ON]->(Digital Balance / ID: 16_1), (Person / ID: 0_0)-[USES]->(Ar Glasses / ID: 1_3), (Person / ID: 0_0)-[HOLDS]->(Blue_Nitrile_Gloves / ID: 21_0), (Document / ID: 0_2)-[IS_ON]->(Lab Bench / ID: 2_1), (Document / ID: 0_2)-[HAS_TITLE]->(Ar Glasses Training Chemistry Experiment Report (Simplified Version) / ID: 0_2), (Digital_Balance / ID: 16_0)-[MEASURES]->(Mass / ID: 9_2), (Beaker / ID: 16_0)-[IS_ON]->(Digital_Balance / ID: 16_0), (Beaker / ID: 16_0)-[CONTAINS]->(Clear_Liquid / ID: 19_0), (Sample / ID: 22_1)-[IS_PLACED_ON]->(Digital Balance / ID: 16_1), (Mass Of Liquid / ID: 15_1)-[IS_MEASURED_ON]->(Digital Balance / ID: 16_1), (Volumetric Flask / ID: 18_1)-[IS_POSITIONED_ON]->(Lab Table / ID: 17_2), (Lab Table / ID: 17_2)-[CONTAINS]->(Piece Of Paper / ID: 18_2)
2025-11-30 21:16:20,728 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_1', '0.620'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_1', '0.601')]
2025-11-30 21:16:20,728 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2', '0.738'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_3', '0.720')]
2025-11-30 21:16:20,728 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.675'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_0', '0.674')]
2025-11-30 21:16:20,728 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_2', '0.598'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_4', '0.561')]
2025-11-30 21:16:20,728 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_0', '0.701'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_6', '0.701')]
2025-11-30 21:16:20,728 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:16:20,728 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_24_0) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:16:22,121 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:16:22,121 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:16:22,121 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_24_1) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:16:23,309 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:16:23,310 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:16:23,310 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_24_2) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:16:28,316 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 21:16:33,823 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 2/4), retrying...
2025-11-30 21:16:39,830 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 3/4), retrying...
2025-11-30 21:16:46,338 - src.components.pre_llm_injector - WARNING - ⚠️ Chunk 2 TIMED OUT after 5.0s on final attempt. Skipping.
2025-11-30 21:16:46,338 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 0 triplets
2025-11-30 21:16:46,339 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_24_3) (~234 words) with timeout=5.0s retries=3
2025-11-30 21:16:47,704 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:16:47,704 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:16:47,705 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_24_4) (~28 words) with timeout=5.0s retries=3
2025-11-30 21:16:48,798 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:16:48,799 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:16:48,799 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 5 chunks
2025-11-30 21:16:48,799 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 28.20s
2025-11-30 21:16:48,799 - src.components.global_refiner - INFO - Capping refinement input: 22 → 15 triplets
2025-11-30 21:16:48,800 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[WEARS]->(Ar Glasses / ID: 1_3), (Person / ID: 0_0)-[HOLDS]->(Laboratory_Glassware / ID: 4_2)
Subgraph_2: Subgraph: (Lab Table / ID: 17_2)-[CONTAINS]->(Document / ID: 0_2), (Person / ID: 0_0)-[WRITES_ON]->(Document / ID: 0_2), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Digital Balance / ID: 16_1)-[MEASURES]->(Mass / ID: 9_2), (Person / ID: 0_0)-[HOLDS]->(Beaker / ID: 16_0), (Person / ID: 0_0)-[ADDS_LIQUID_TO]->(Beaker / ID: 16_0), (Lab Table / ID: 17_2)-[CONTAINS]->(Beaker / ID: 16_0), (Beaker / ID: 16_0)-[IS_HELD_OVER]->(Digital Balance / ID: 16_1), (Beaker / ID: 16_0)-[IS_ON]->(Digital Balance / ID: 16_1), (Person / ID: 0_0)-[USES]->(Ar Glasses / ID: 1_3), (Person / ID: 0_0)-[HOLDS]->(Blue_Nitrile_Gloves / ID: 21_0), (Document / ID: 0_2)-[IS_ON]->(Lab Bench / ID: 2_1), (Document / ID: 0_2)-[HAS_TITLE]->(Ar Glasses Training Chemistry Experiment Report (Simplified Version) / ID: 0_2), (Digital_Balance / ID: 16_0)-[MEASURES]->(Mass / ID: 9_2), (Beaker / ID: 16_0)-[IS_ON]->(Digital_Balance / ID: 16_0), (Beaker / ID: 16_0)-[CONTAINS]->(Clear_Liquid / ID: 19_0), (Sample / ID: 22_1)-[IS_PLACED_ON]->(Digital Balance / ID: 16_1), (Mass Of Liquid / ID: 15_1)-[IS_MEASURED_ON]->(Digital Balance / ID: 16_1), (Volumetric Flask / ID: 18_1)-[IS_POSITIONED_ON]->(Lab Table / ID: 17_2), (Lab Table / ID: 17_2)-[CONTAINS]->(Piece Of Paper / ID: 18_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["24_0"]}, {"head": "Person", "relation": "Wears", "tail": "Gold_Watch", "source_chunks": ["24_0"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["24_0", "24_3"]}, {"head": "Person", "relation": "Uses", "tail": "Squeeze_Bottle", "source_chunks": ["24_0"]}, {"head": "Squeeze_Bottle", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["24_0"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["24_0", "24_3"]}, {"head": "Person", "relation": "Holds", "tail": "Squeeze Bottle", "source_chunks": ["24_1"]}, {"head": "Squeeze Bottle", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["24_1"]}, {"head": "Liquid", "relation": "Enters", "tail": "Volumetric Flask", "source_chunks": ["24_1"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["24_1"]}, {"head": "Volumetric Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["24_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "White Bottle", "source_chunks": ["24_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["24_3"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["24_3"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Volumetric_Flask", "source_chunks": ["24_3"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:16:48,800 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~496 words, ~645 tokens)
2025-11-30 21:16:48,800 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:17:12,851 - src.components.global_refiner - DEBUG - LLM call completed in 24.05s
2025-11-30 21:17:12,851 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['24_0']], ['Person', 'Wears', 'Gold_Watch', ['24_0']], ['Person', 'Holds', 'Volumetric_Flask', ['24_0', '24_3']], ['Person', 'Uses', 'Squeeze_Bottle', ['24_0']], ['Squeeze_Bottle', 'Contains', 'Clear_Liquid', ['24_0']], ['Volumetric_Flask', 'Contains', 'Clear_Liquid', ['24_0', '24_3']], ['Person', 'Holds', 'Squeeze_Bottle', ['24_1']], ['Squeeze_Bottle', 'Dispenses', 'Liquid', ['24_1']], ['Liquid', 'Enters', 'Volumetric_Flask', ['24_1']], ['Person', 'Holds', 'Volumetric_Flask', ['24_1']], ['Volumetric_Flask', 'Contains', 'Liquid', ['24_1']], ['Lab_Bench', 'Contains', 'White_Bottle', ['24_1']], ['Person', 'Wears', 'Blue_Nitrile_Glove', ['24_3']], ['Person', 'Wears', 'Watch', ['24_3']], ['Lab_Bench', 'Contains', 'Volumetric_Flask', ['24_3']]] inter_chunk_relations=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['24_0']], ['Person', 'Wears', 'Gold_Watch', ['24_0']], ['Person', 'Holds', 'Volumetric_Flask', ['24_0', '24_3']], ['Person', 'Uses', 'Squeeze_Bottle', ['24_0']], ['Squeeze_Bottle', 'Contains', 'Clear_Liquid', ['24_0']], ['Volumetric_Flask', 'Contains', 'Clear_Liquid', ['24_0', '24_3']], ['Person', 'Holds', 'Squeeze_Bottle', ['24_1']], ['Squeeze_Bottle', 'Dispenses', 'Liquid', ['24_1']], ['Liquid', 'Enters', 'Volumetric_Flask', ['24_1']], ['Person', 'Holds', 'Volumetric_Flask', ['24_1']], ['Volumetric_Flask', 'Contains', 'Liquid', ['24_1']], ['Lab_Bench', 'Contains', 'White_Bottle', ['24_1']], ['Person', 'Wears', 'Blue_Nitrile_Glove', ['24_3']], ['Person', 'Wears', 'Watch', ['24_3']], ['Lab_Bench', 'Contains', 'Volumetric_Flask', ['24_3']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '21_0'}, {'local': 'Watch', 'existing': 'Watch', 'existing_id': '7_2'}, {'local': 'Blue_Nitrile_Glove', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '21_0'}, {'local': 'Gold_Watch', 'existing': 'Watch', 'existing_id': '7_2'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Gold_Watch'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric_Flask'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Squeeze_Bottle'}, {'head': 'Squeeze_Bottle', 'relation': 'Contains', 'tail': 'Clear_Liquid'}, {'head': 'Volumetric_Flask', 'relation': 'Contains', 'tail': 'Clear_Liquid'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Squeeze_Bottle'}, {'head': 'Squeeze_Bottle', 'relation': 'Dispenses', 'tail': 'Liquid'}, {'head': 'Liquid', 'relation': 'Enters', 'tail': 'Volumetric_Flask'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric_Flask'}, {'head': 'Volumetric_Flask', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Lab_Bench', 'relation': 'Contains', 'tail': 'White_Bottle'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Watch'}, {'head': 'Lab_Bench', 'relation': 'Contains', 'tail': 'Volumetric_Flask'}]
2025-11-30 21:17:12,851 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['24_0']], ['Person', 'Wears', 'Gold_Watch', ['24_0']], ['Person', 'Holds', 'Volumetric_Flask', ['24_0', '24_3']]]
2025-11-30 21:17:12,851 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['24_0']], ['Person', 'Wears', 'Gold_Watch', ['24_0']], ['Person', 'Holds', 'Volumetric_Flask', ['24_0', '24_3']]]
2025-11-30 21:17:12,851 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '21_0'}, {'local': 'Watch', 'existing': 'Watch', 'existing_id': '7_2'}, {'local': 'Blue_Nitrile_Glove', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '21_0'}]
2025-11-30 21:17:12,851 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=15, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Gold_Watch'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric_Flask'}]
2025-11-30 21:17:12,851 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '21_0'}, {'local': 'Watch', 'existing': 'Watch', 'existing_id': '7_2'}, {'local': 'Blue_Nitrile_Glove', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '21_0'}, {'local': 'Gold_Watch', 'existing': 'Watch', 'existing_id': '7_2'}]
2025-11-30 21:17:12,852 - src.components.global_refiner - INFO - LLM suggested 15 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Gold_Watch'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric_Flask'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Squeeze_Bottle'}, {'head': 'Squeeze_Bottle', 'relation': 'Contains', 'tail': 'Clear_Liquid'}, {'head': 'Volumetric_Flask', 'relation': 'Contains', 'tail': 'Clear_Liquid'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Squeeze_Bottle'}, {'head': 'Squeeze_Bottle', 'relation': 'Dispenses', 'tail': 'Liquid'}, {'head': 'Liquid', 'relation': 'Enters', 'tail': 'Volumetric_Flask'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric_Flask'}, {'head': 'Volumetric_Flask', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Lab_Bench', 'relation': 'Contains', 'tail': 'White_Bottle'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Watch'}, {'head': 'Lab_Bench', 'relation': 'Contains', 'tail': 'Volumetric_Flask'}]
2025-11-30 21:17:12,852 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 30 triplets (total: 24.05s, LLM: 24.05s)
2025-11-30 21:17:12,852 - src.pipeline.kg_builder - INFO - Global refinement: 30 triplets in 24.05s
2025-11-30 21:17:12,852 - src.pipeline.kg_builder - INFO - Using 30 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:17:12,852 - src.pipeline.kg_builder - INFO - Pushing batch 25/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:17:12,852 - src.components.neo4j_handler - INFO - Adding 14 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:17:13,031 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=255, relationships=208
2025-11-30 21:17:13,031 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:17:13,031 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue_Nitrile_Gloves -> Blue_Nitrile_Gloves
2025-11-30 21:17:13,031 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Watch -> Watch
2025-11-30 21:17:13,032 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Glove -> Blue_Nitrile_Gloves
2025-11-30 21:17:13,036 - src.components.neo4j_handler - DEBUG - APOC merge successful: Gold_Watch -> Watch
2025-11-30 21:17:13,036 - src.components.neo4j_handler - INFO - Applying 15 prune instructions
2025-11-30 21:17:13,041 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:17:13,042 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Gold_Watch
2025-11-30 21:17:13,044 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Volumetric_Flask
2025-11-30 21:17:13,046 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Uses]-> Squeeze_Bottle
2025-11-30 21:17:13,047 - src.components.neo4j_handler - DEBUG - Pruned relationship: Squeeze_Bottle -[Contains]-> Clear_Liquid
2025-11-30 21:17:13,049 - src.components.neo4j_handler - DEBUG - Pruned relationship: Volumetric_Flask -[Contains]-> Clear_Liquid
2025-11-30 21:17:13,051 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Squeeze_Bottle
2025-11-30 21:17:13,053 - src.components.neo4j_handler - DEBUG - Pruned relationship: Squeeze_Bottle -[Dispenses]-> Liquid
2025-11-30 21:17:13,054 - src.components.neo4j_handler - DEBUG - Pruned relationship: Liquid -[Enters]-> Volumetric_Flask
2025-11-30 21:17:13,055 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Volumetric_Flask
2025-11-30 21:17:13,057 - src.components.neo4j_handler - DEBUG - Pruned relationship: Volumetric_Flask -[Contains]-> Liquid
2025-11-30 21:17:13,059 - src.components.neo4j_handler - DEBUG - Pruned relationship: Lab_Bench -[Contains]-> White_Bottle
2025-11-30 21:17:13,060 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Glove
2025-11-30 21:17:13,061 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Watch
2025-11-30 21:17:13,063 - src.components.neo4j_handler - DEBUG - Pruned relationship: Lab_Bench -[Contains]-> Volumetric_Flask
2025-11-30 21:17:13,063 - src.components.neo4j_handler - INFO - Applying 15 inter-chunk relations
2025-11-30 21:17:13,065 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:17:13,066 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Gold_Watch
2025-11-30 21:17:13,067 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Volumetric_Flask
2025-11-30 21:17:13,070 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> Squeeze_Bottle
2025-11-30 21:17:13,071 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Squeeze_Bottle -[Contains]-> Clear_Liquid
2025-11-30 21:17:13,073 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Volumetric_Flask -[Contains]-> Clear_Liquid
2025-11-30 21:17:13,074 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Squeeze_Bottle
2025-11-30 21:17:13,077 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Squeeze_Bottle -[Dispenses]-> Liquid
2025-11-30 21:17:13,109 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Liquid -[Enters]-> Volumetric_Flask
2025-11-30 21:17:13,111 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Volumetric_Flask
2025-11-30 21:17:13,113 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Volumetric_Flask -[Contains]-> Liquid
2025-11-30 21:17:13,114 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab_Bench -[Contains]-> White_Bottle
2025-11-30 21:17:13,116 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue_Nitrile_Glove
2025-11-30 21:17:13,119 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Watch
2025-11-30 21:17:13,121 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab_Bench -[Contains]-> Volumetric_Flask
2025-11-30 21:17:13,122 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:17:13,130 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=253, relationships=206
2025-11-30 21:17:13,133 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:17:13,133 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:17:13,133 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:17:13,133 - src.components.neo4j_handler - INFO - Batch injected in 0.28s (triplets: 0.28s, indexes: 0.00s)
2025-11-30 21:17:13,134 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 117, 'with_embedding': 117, 'linked_chunks': 95}
2025-11-30 21:17:13,134 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:17:13,161 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 253 nodes
2025-11-30 21:17:13,226 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 231 nodes
2025-11-30 21:17:13,307 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 253, 'relationship_count': 723, 'density': 0.0113, 'avg_degree': 5.7154, 'avg_unique_neighbors': 5.6522, 'global_efficiency': 0.332, 'avg_path_length': 2.7448, 'avg_degree_centrality': 0.0227, 'max_degree_centrality': 0.5079, 'avg_betweenness_centrality': 0.0011, 'max_betweenness_centrality': 0.0431, 'degree_assortativity': -0.1622, 'graph_robustness': 0.8741, 'diameter_estimate': 6, 'clustering_coefficient': 0.2322, 'weakly_connected_components': 23, 'largest_wcc_size': 231, 'pagerank_top10_percent': 11.08, 'louvain_communities': 33, 'louvain_modularity': 0.4329, 'label_entropy': 1.498, 'computational_time': 0.1726379890460521}
2025-11-30 21:17:13,307 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 24, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508633.3074808, 'total_time': 52.71554569597356, 'aggregation': 2.7971109375357628e-06, 'network_info': 0.011069645988754928, 'llm_extraction': 52.249025469995104, 'data_cleaning': 4.187691956758499e-05, 'neo4j_injection': 0.2813163520768285, 'embedding_time': 0, 'indexing_time': 0.003154720994643867, 'graph_injection_time': 0.27793033397756517, 'acs_metrics': {'node_count': 253, 'relationship_count': 723, 'density': 0.0113, 'avg_degree': 5.7154, 'avg_unique_neighbors': 5.6522, 'global_efficiency': 0.332, 'avg_path_length': 2.7448, 'avg_degree_centrality': 0.0227, 'max_degree_centrality': 0.5079, 'avg_betweenness_centrality': 0.0011, 'max_betweenness_centrality': 0.0431, 'degree_assortativity': -0.1622, 'graph_robustness': 0.8741, 'diameter_estimate': 6, 'clustering_coefficient': 0.2322, 'weakly_connected_components': 23, 'largest_wcc_size': 231, 'pagerank_top10_percent': 11.08, 'louvain_communities': 33, 'louvain_modularity': 0.4329, 'label_entropy': 1.498, 'computational_time': 0.1726379890460521}, 'retrieval_queries': []}
2025-11-30 21:17:13,307 - src.pipeline.kg_builder - DEBUG - Batch 24 metrics: {
  "batch_idx": 24,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508633.3074808,
  "total_time": 52.71554569597356,
  "aggregation": 2.7971109375357628e-06,
  "network_info": 0.011069645988754928,
  "llm_extraction": 52.249025469995104,
  "data_cleaning": 4.187691956758499e-05,
  "neo4j_injection": 0.2813163520768285,
  "embedding_time": 0,
  "indexing_time": 0.003154720994643867,
  "graph_injection_time": 0.27793033397756517,
  "acs_metrics": {
    "node_count": 253,
    "relationship_count": 723,
    "density": 0.0113,
    "avg_degree": 5.7154,
    "avg_unique_neighbors": 5.6522,
    "global_efficiency": 0.332,
    "avg_path_length": 2.7448,
    "avg_degree_centrality": 0.0227,
    "max_degree_centrality": 0.5079,
    "avg_betweenness_centrality": 0.0011,
    "max_betweenness_centrality": 0.0431,
    "degree_assortativity": -0.1622,
    "graph_robustness": 0.8741,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2322,
    "weakly_connected_components": 23,
    "largest_wcc_size": 231,
    "pagerank_top10_percent": 11.08,
    "louvain_communities": 33,
    "louvain_modularity": 0.4329,
    "label_entropy": 1.498,
    "computational_time": 0.1726379890460521
  },
  "retrieval_queries": []
}
2025-11-30 21:17:13,308 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:17:13,308 - src.pipeline.kg_builder - INFO - Batch 25 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 52.25s, Clean: 0.00s, Neo4j: 0.28s, ACS: 0.17s
2025-11-30 21:17:13,308 - src.pipeline.kg_builder - INFO - Batch 25 completed in 52.72s
Processing KG batches:  35%|███▍      | 25/72 [10:16<24:29, 31.27s/it]2025-11-30 21:17:13,308 - src.pipeline.kg_builder - INFO - Processing batch 26/72 (3 items)
2025-11-30 21:17:13,308 - src.pipeline.kg_builder - DEBUG - Batch 26 current_video_time: 06:24-06:29
2025-11-30 21:17:13,316 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 253
- Total Relationships: 206
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:17:13,317 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:17:13,317 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_0 ~202 words, content: Time: 06:14-06:19 Content: The video captures a close-up, first-person perspective of a laboratory procedure, likely the preparation of a solution. The scene is set in...
2025-11-30 21:17:13,317 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_1 ~209 words, content: reaction is complete. - **Balance:** A digital analytical balance is visible in the background, which is used for precise weighing of chemicals. - **Chemical Containers:**...
2025-11-30 21:17:13,317 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_2 ~242 words, content: laboratory setting. The frames show a person, wearing a blue nitrile glove, handling laboratory equipment with precision. - **In the first four frames**, the focus...
2025-11-30 21:17:13,317 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_3 ~238 words, content: flask, likely as part of a chemical experiment. The sequence transitions from a close-up of the precise action to a wider shot of the laboratory,...
2025-11-30 21:17:13,317 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_4 ~249 words, content: background includes a cabinet with various items, and the overall environment remains consistent with a laboratory setting. - In the third frame, the camera angle...
2025-11-30 21:17:13,317 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_5 ~214 words, content: - In the final frame, the camera angle changes to show a different part of the laboratory. The balance scale is still visible, but now...
2025-11-30 21:17:13,337 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:17:13,399 - src.components.pre_llm_injector - DEBUG - Found 117 existing chunk embeddings for similarity lookup
2025-11-30 21:17:13,437 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_1', '0.819'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.790')]
2025-11-30 21:17:13,439 - src.components.pre_llm_injector - DEBUG - Found 3 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2
2025-11-30 21:17:13,439 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:17:13,440 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_1
2025-11-30 21:17:13,440 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:17:13,448 - src.components.pre_llm_injector - DEBUG - Limited Person from 62 to 2 external connections
2025-11-30 21:17:13,448 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 62 total -> 2 (internal: 0, external: 2)
2025-11-30 21:17:13,448 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WALKS_PAST]->(Laboratory_Equipment / ID: 14_2), (Person / ID: 0_0)-[STABILIZES]->(Volumetric_Flask / ID: 14_2)
2025-11-30 21:17:13,449 - src.components.pre_llm_injector - DEBUG - Limited Person from 60 to 2 external connections
2025-11-30 21:17:13,449 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 62 total -> 4 (internal: 2, external: 2)
2025-11-30 21:17:13,450 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[CLOSES]->(Container / ID: 4_1), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2)
2025-11-30 21:17:13,450 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_0', '0.713'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_3', '0.709')]
2025-11-30 21:17:13,450 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_0', '0.684'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_22_0', '0.639')]
2025-11-30 21:17:13,450 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.737'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_0', '0.711')]
2025-11-30 21:17:13,450 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_1', '0.819'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.790')]
2025-11-30 21:17:13,450 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_0', '0.735'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.695')]
2025-11-30 21:17:13,450 - src.components.pre_llm_injector - DEBUG - Chunk 5 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_6', '0.790'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.784')]
2025-11-30 21:17:13,450 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:17:13,450 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_0) (~202 words) with timeout=5.0s retries=3
2025-11-30 21:17:14,893 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:17:14,893 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:17:14,893 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_1) (~209 words) with timeout=5.0s retries=3
2025-11-30 21:17:16,379 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:17:16,379 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:17:16,380 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_2) (~242 words) with timeout=5.0s retries=3
2025-11-30 21:17:17,880 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:17:17,880 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:17:17,880 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_3) (~238 words) with timeout=5.0s retries=3
2025-11-30 21:17:18,967 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:17:18,967 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:17:18,967 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_4) (~249 words) with timeout=5.0s retries=3
2025-11-30 21:17:19,987 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:17:19,987 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:17:19,988 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_5) (~214 words) with timeout=5.0s retries=3
2025-11-30 21:17:21,175 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:17:21,175 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:17:21,175 - src.components.pre_llm_injector - INFO - Extracted 31 local triplets from 6 chunks
2025-11-30 21:17:21,175 - src.pipeline.kg_builder - INFO - Pre-extraction: 31 triplets in 7.86s
2025-11-30 21:17:21,175 - src.components.global_refiner - INFO - Capping refinement input: 31 → 15 triplets
2025-11-30 21:17:21,176 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[WALKS_PAST]->(Laboratory_Equipment / ID: 14_2), (Person / ID: 0_0)-[STABILIZES]->(Volumetric_Flask / ID: 14_2)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[CLOSES]->(Container / ID: 4_1), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["25_0", "25_2"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["25_0", "25_2"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["25_0", "25_2"]}, {"head": "Burette", "relation": "Dispenses", "tail": "Clear_Liquid", "source_chunks": ["25_0"]}, {"head": "Burette", "relation": "Is Above", "tail": "Volumetric_Flask", "source_chunks": ["25_0"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["25_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Glove", "source_chunks": ["25_1"]}, {"head": "Digital Analytical Balance", "relation": "Is Used For", "tail": "Precise Weighing", "source_chunks": ["25_1"]}, {"head": "White Bottle", "relation": "Has Label", "tail": "Corrosive Hazard Symbol", "source_chunks": ["25_1"]}, {"head": "Volumetric Flask", "relation": "Receives", "tail": "Liquid From Burette", "source_chunks": ["25_1"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Glass Beaker", "source_chunks": ["25_1"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Pen", "source_chunks": ["25_1"]}, {"head": "Person", "relation": "Adjusts", "tail": "Volumetric_Flask", "source_chunks": ["25_2"]}, {"head": "Volumetric_Flask", "relation": "Rests On", "tail": "Black_Laboratory_Bench", "source_chunks": ["25_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Digital_Scale", "source_chunks": ["25_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:17:21,176 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~366 words, ~476 tokens)
2025-11-30 21:17:21,176 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:17:34,895 - src.components.global_refiner - DEBUG - LLM call completed in 13.72s
2025-11-30 21:17:34,896 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Glove', ['25_0', '25_2']], ['Person', 'Holds', 'Volumetric_Flask', ['25_0', '25_2']], ['Volumetric_Flask', 'Contains', 'Clear_Liquid', ['25_0', '25_2']], ['Burette', 'Dispenses', 'Clear_Liquid', ['25_0']], ['Burette', 'Is Above', 'Volumetric_Flask', ['25_0']], ['Person', 'Wears', 'Watch', ['25_0']], ['Person', 'Wears', 'Blue Nitrile Glove', ['25_1']], ['Digital Analytical Balance', 'Is Used For', 'Precise Weighing', ['25_1']], ['White Bottle', 'Has Label', 'Corrosive Hazard Symbol', ['25_1']], ['Volumetric Flask', 'Receives', 'Liquid From Burette', ['25_1']], ['Lab Table', 'Contains', 'Glass Beaker', ['25_1']], ['Lab Table', 'Contains', 'Pen', ['25_1']], ['Person', 'Adjusts', 'Volumetric_Flask', ['25_2']], ['Volumetric_Flask', 'Rests On', 'Black_Laboratory_Bench', ['25_2']], ['Laboratory', 'Contains', 'Digital_Scale', ['25_2']]] inter_chunk_relations=[['Person', 'Wears', 'Watch', ['25_0']], ['Person', 'Holds', 'Volumetric_Flask', ['25_0', '25_2']], ['Volumetric_Flask', 'Contains', 'Clear_Liquid', ['25_0', '25_2']], ['Burette', 'Is Above', 'Volumetric_Flask', ['25_0']], ['Volumetric_Flask', 'Rests On', 'Black_Laboratory_Bench', ['25_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue Nitrile Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}]
2025-11-30 21:17:34,896 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Glove', ['25_0', '25_2']], ['Person', 'Holds', 'Volumetric_Flask', ['25_0', '25_2']], ['Volumetric_Flask', 'Contains', 'Clear_Liquid', ['25_0', '25_2']]]
2025-11-30 21:17:34,896 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Person', 'Wears', 'Watch', ['25_0']], ['Person', 'Holds', 'Volumetric_Flask', ['25_0', '25_2']], ['Volumetric_Flask', 'Contains', 'Clear_Liquid', ['25_0', '25_2']]]
2025-11-30 21:17:34,896 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=2, sample=[{'local': 'Blue_Nitrile_Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue Nitrile Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}]
2025-11-30 21:17:34,896 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}]
2025-11-30 21:17:34,896 - src.components.global_refiner - INFO - LLM suggested 2 entity merges: [{'local': 'Blue_Nitrile_Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue Nitrile Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}]
2025-11-30 21:17:34,896 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}]
2025-11-30 21:17:34,896 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 13.72s, LLM: 13.72s)
2025-11-30 21:17:34,896 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 13.72s
2025-11-30 21:17:34,896 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:17:34,896 - src.pipeline.kg_builder - INFO - Pushing batch 26/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:17:34,896 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:17:35,083 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=269, relationships=218
2025-11-30 21:17:35,083 - src.components.neo4j_handler - INFO - Applying 2 merge instructions
2025-11-30 21:17:35,084 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Glove -> Blue Glove
2025-11-30 21:17:35,089 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue Nitrile Glove -> Blue Glove
2025-11-30 21:17:35,089 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:17:35,094 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Glove
2025-11-30 21:17:35,094 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue Nitrile Glove
2025-11-30 21:17:35,095 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue Nitrile Glove
2025-11-30 21:17:35,096 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue Glove
2025-11-30 21:17:35,096 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:17:35,097 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Watch
2025-11-30 21:17:35,098 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Volumetric_Flask
2025-11-30 21:17:35,100 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Volumetric_Flask -[Contains]-> Clear_Liquid
2025-11-30 21:17:35,102 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Burette -[Is Above]-> Volumetric_Flask
2025-11-30 21:17:35,104 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Volumetric_Flask -[Rests On]-> Black_Laboratory_Bench
2025-11-30 21:17:35,105 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:17:35,113 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=267, relationships=216
2025-11-30 21:17:35,116 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:17:35,116 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:17:35,117 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:17:35,117 - src.components.neo4j_handler - INFO - Batch injected in 0.22s (triplets: 0.22s, indexes: 0.00s)
2025-11-30 21:17:35,118 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 123, 'with_embedding': 123, 'linked_chunks': 98}
2025-11-30 21:17:35,118 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:17:35,145 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 267 nodes
2025-11-30 21:17:35,216 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 242 nodes
2025-11-30 21:17:35,301 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 267, 'relationship_count': 756, 'density': 0.0106, 'avg_degree': 5.6629, 'avg_unique_neighbors': 5.603, 'global_efficiency': 0.3238, 'avg_path_length': 2.7716, 'avg_degree_centrality': 0.0213, 'max_degree_centrality': 0.4925, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0306, 'degree_assortativity': -0.1543, 'graph_robustness': 0.8466, 'diameter_estimate': 6, 'clustering_coefficient': 0.2375, 'weakly_connected_components': 26, 'largest_wcc_size': 242, 'pagerank_top10_percent': 11.35, 'louvain_communities': 35, 'louvain_modularity': 0.4382, 'label_entropy': 1.4978, 'computational_time': 0.18252936797216535}
2025-11-30 21:17:35,301 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 25, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508655.301479, 'total_time': 21.9931314480491, 'aggregation': 3.720051608979702e-06, 'network_info': 0.008098487975075841, 'llm_extraction': 21.579725627903827, 'data_cleaning': 1.9878032617270947e-05, 'neo4j_injection': 0.22130620398093015, 'embedding_time': 0, 'indexing_time': 0.004492989042773843, 'graph_injection_time': 0.21659821993671358, 'acs_metrics': {'node_count': 267, 'relationship_count': 756, 'density': 0.0106, 'avg_degree': 5.6629, 'avg_unique_neighbors': 5.603, 'global_efficiency': 0.3238, 'avg_path_length': 2.7716, 'avg_degree_centrality': 0.0213, 'max_degree_centrality': 0.4925, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0306, 'degree_assortativity': -0.1543, 'graph_robustness': 0.8466, 'diameter_estimate': 6, 'clustering_coefficient': 0.2375, 'weakly_connected_components': 26, 'largest_wcc_size': 242, 'pagerank_top10_percent': 11.35, 'louvain_communities': 35, 'louvain_modularity': 0.4382, 'label_entropy': 1.4978, 'computational_time': 0.18252936797216535}, 'retrieval_queries': []}
2025-11-30 21:17:35,301 - src.pipeline.kg_builder - DEBUG - Batch 25 metrics: {
  "batch_idx": 25,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508655.301479,
  "total_time": 21.9931314480491,
  "aggregation": 3.720051608979702e-06,
  "network_info": 0.008098487975075841,
  "llm_extraction": 21.579725627903827,
  "data_cleaning": 1.9878032617270947e-05,
  "neo4j_injection": 0.22130620398093015,
  "embedding_time": 0,
  "indexing_time": 0.004492989042773843,
  "graph_injection_time": 0.21659821993671358,
  "acs_metrics": {
    "node_count": 267,
    "relationship_count": 756,
    "density": 0.0106,
    "avg_degree": 5.6629,
    "avg_unique_neighbors": 5.603,
    "global_efficiency": 0.3238,
    "avg_path_length": 2.7716,
    "avg_degree_centrality": 0.0213,
    "max_degree_centrality": 0.4925,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.0306,
    "degree_assortativity": -0.1543,
    "graph_robustness": 0.8466,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2375,
    "weakly_connected_components": 26,
    "largest_wcc_size": 242,
    "pagerank_top10_percent": 11.35,
    "louvain_communities": 35,
    "louvain_modularity": 0.4382,
    "label_entropy": 1.4978,
    "computational_time": 0.18252936797216535
  },
  "retrieval_queries": []
}
2025-11-30 21:17:35,302 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:17:35,302 - src.pipeline.kg_builder - INFO - Batch 26 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 21.58s, Clean: 0.00s, Neo4j: 0.22s, ACS: 0.18s
2025-11-30 21:17:35,302 - src.pipeline.kg_builder - INFO - Batch 26 completed in 21.99s
Processing KG batches:  36%|███▌      | 26/72 [10:38<21:50, 28.49s/it]2025-11-30 21:17:35,302 - src.pipeline.kg_builder - INFO - Processing batch 27/72 (3 items)
2025-11-30 21:17:35,302 - src.pipeline.kg_builder - DEBUG - Batch 27 current_video_time: 06:39-06:44
2025-11-30 21:17:35,312 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 267
- Total Relationships: 216
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:17:35,313 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:17:35,313 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0 ~229 words, content: Time: 06:29-06:34 Content: The sequence of images captures a laboratory procedure, likely the preparation of a chemical solution. The scene is set on a black...
2025-11-30 21:17:35,313 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_1 ~225 words, content: is being added to a container that is already on the balance. The overall context implies that a precise amount of a chemical is being...
2025-11-30 21:17:35,313 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_2 ~224 words, content: , is positioned nearby, indicating that the solution is being weighed as part of the process. The person's left wrist, adorned with a watch, is...
2025-11-30 21:17:35,313 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_3 ~145 words, content: This flask, which has a long neck and a flat bottom, is already partially filled with a clear liquid. The person is using the pipette...
2025-11-30 21:17:35,333 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:17:35,396 - src.components.pre_llm_injector - DEBUG - Found 123 existing chunk embeddings for similarity lookup
2025-11-30 21:17:35,422 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_3', '0.880'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_0', '0.833')]
2025-11-30 21:17:35,423 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_3
2025-11-30 21:17:35,423 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:17:35,424 - src.components.pre_llm_injector - DEBUG - Found 9 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_0
2025-11-30 21:17:35,424 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:17:35,429 - src.components.pre_llm_injector - DEBUG - Limited Person from 62 to 2 external connections
2025-11-30 21:17:35,429 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 63 total -> 3 (internal: 1, external: 2)
2025-11-30 21:17:35,430 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[USES]->(Laboratory_Glassware / ID: 4_2), (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2)
2025-11-30 21:17:35,435 - src.components.pre_llm_injector - DEBUG - Limited Person from 47 to 2 external connections
2025-11-30 21:17:35,435 - src.components.pre_llm_injector - DEBUG - Limited Bottle from 18 to 2 external connections
2025-11-30 21:17:35,435 - src.components.pre_llm_injector - DEBUG - Limited Digital_Balance from 5 to 2 external connections
2025-11-30 21:17:35,435 - src.components.pre_llm_injector - DEBUG - Limited Beaker from 13 to 2 external connections
2025-11-30 21:17:35,435 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 106 total -> 31 (internal: 21, external: 10)
2025-11-30 21:17:35,435 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WEARS]->(Ar Glasses / ID: 1_3), (Person / ID: 0_0)-[USES]->(Ar Glasses / ID: 1_3), (Person / ID: 0_0)-[WEARS]->(Blue_Nitrile_Gloves / ID: 21_0), (Person / ID: 0_0)-[HOLDS]->(Blue_Nitrile_Gloves / ID: 21_0), (Digital_Balance / ID: 16_0)-[IS_USED_BY]->(Person / ID: 0_0), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Lab_Bench / ID: 3_0)-[CONTAINS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[PLACES]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[REMOVES]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[REMOVES]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HOLDS]->(Beaker / ID: 16_0), (Lab_Bench / ID: 3_0)-[CONTAINS]->(Beaker / ID: 16_0), (Person / ID: 0_0)-[ADDS_LIQUID_TO]->(Beaker / ID: 16_0), (Beaker / ID: 16_0)-[IS_ON]->(Digital_Balance / ID: 16_0), (Person / ID: 0_0)-[USES]->(Digital_Balance / ID: 16_0), (Beaker / ID: 16_0)-[PLACED_ON]->(Digital_Balance / ID: 16_0), (Digital_Balance / ID: 16_0)-[DISPLAYS]->(-56.301_G / ID: 16_0), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[HOLDS]->(Glass_Rod / ID: 4_1), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2), (Bottle / ID: 1_1)-[IS_INSIDE]->(Draft_Shield / ID: 11_0), (Bottle / ID: 1_1)-[IS_ON]->(Balance Scale Enclosure / ID: 6_1), (Lab_Bench / ID: 3_0)-[CONTAINS]->(White_Bottle / ID: 4_3), (Lab_Bench / ID: 3_0)-[CONTAINS]->(Volumetric_Flask / ID: 14_2), (Volumetric_Flask / ID: 14_2)-[IS_ON]->(Digital_Balance / ID: 16_0), (Digital_Balance / ID: 16_0)-[DISPLAYS]->(-56.301 G / ID: 16_1), (Beaker / ID: 16_0)-[CONTAINS]->(Mass Of Liquid / ID: 15_1), (Beaker / ID: 16_0)-[CONTAINS]->(Clear_Liquid / ID: 19_0)
2025-11-30 21:17:35,435 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_0', '0.833'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.805')]
2025-11-30 21:17:35,435 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_3', '0.799'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_0', '0.788')]
2025-11-30 21:17:35,435 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_0', '0.757'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_22_1', '0.730')]
2025-11-30 21:17:35,435 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_3', '0.880'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.798')]
2025-11-30 21:17:35,435 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:17:35,436 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:17:36,685 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:17:36,685 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:17:36,685 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_1) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:17:37,935 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:17:37,935 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:17:37,935 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_2) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:17:39,218 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:17:39,218 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:17:39,219 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_3) (~145 words) with timeout=5.0s retries=3
2025-11-30 21:17:40,276 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:17:40,276 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:17:40,276 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 4 chunks
2025-11-30 21:17:40,276 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 4.96s
2025-11-30 21:17:40,277 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 21:17:40,277 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[USES]->(Laboratory_Glassware / ID: 4_2), (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[WEARS]->(Ar Glasses / ID: 1_3), (Person / ID: 0_0)-[USES]->(Ar Glasses / ID: 1_3), (Person / ID: 0_0)-[WEARS]->(Blue_Nitrile_Gloves / ID: 21_0), (Person / ID: 0_0)-[HOLDS]->(Blue_Nitrile_Gloves / ID: 21_0), (Digital_Balance / ID: 16_0)-[IS_USED_BY]->(Person / ID: 0_0), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Lab_Bench / ID: 3_0)-[CONTAINS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[PLACES]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[REMOVES]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[REMOVES]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HOLDS]->(Beaker / ID: 16_0), (Lab_Bench / ID: 3_0)-[CONTAINS]->(Beaker / ID: 16_0), (Person / ID: 0_0)-[ADDS_LIQUID_TO]->(Beaker / ID: 16_0), (Beaker / ID: 16_0)-[IS_ON]->(Digital_Balance / ID: 16_0), (Person / ID: 0_0)-[USES]->(Digital_Balance / ID: 16_0), (Beaker / ID: 16_0)-[PLACED_ON]->(Digital_Balance / ID: 16_0), (Digital_Balance / ID: 16_0)-[DISPLAYS]->(-56.301_G / ID: 16_0), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[HOLDS]->(Glass_Rod / ID: 4_1), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2), (Bottle / ID: 1_1)-[IS_INSIDE]->(Draft_Shield / ID: 11_0), (Bottle / ID: 1_1)-[IS_ON]->(Balance Scale Enclosure / ID: 6_1), (Lab_Bench / ID: 3_0)-[CONTAINS]->(White_Bottle / ID: 4_3), (Lab_Bench / ID: 3_0)-[CONTAINS]->(Volumetric_Flask / ID: 14_2), (Volumetric_Flask / ID: 14_2)-[IS_ON]->(Digital_Balance / ID: 16_0), (Digital_Balance / ID: 16_0)-[DISPLAYS]->(-56.301 G / ID: 16_1), (Beaker / ID: 16_0)-[CONTAINS]->(Mass Of Liquid / ID: 15_1), (Beaker / ID: 16_0)-[CONTAINS]->(Clear_Liquid / ID: 19_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["26_0", "26_2"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["26_0"]}, {"head": "Person", "relation": "Adds", "tail": "Liquid", "source_chunks": ["26_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Dark_Opaque_Liquid", "source_chunks": ["26_0"]}, {"head": "Balance", "relation": "Displays", "tail": "Negative_Mass", "source_chunks": ["26_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Magnetic_Stirrer", "source_chunks": ["26_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["26_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Beaker", "source_chunks": ["26_1"]}, {"head": "Person", "relation": "Uses", "tail": "Glass Pipette", "source_chunks": ["26_1"]}, {"head": "Glass Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["26_1"]}, {"head": "Glass Beaker", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["26_1"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "56.30", "source_chunks": ["26_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["26_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["26_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Glass_Pipette", "source_chunks": ["26_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:17:40,277 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~557 words, ~724 tokens)
2025-11-30 21:17:40,277 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:17:56,620 - src.components.global_refiner - DEBUG - LLM call completed in 16.34s
2025-11-30 21:17:56,620 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['26_0', '26_1']], ['Person', 'Holds', 'Pipette', ['26_0']], ['Person', 'Adds', 'Liquid', ['26_0']], ['Beaker', 'Contains', 'Dark_Opaque_Liquid', ['26_0']], ['Balance', 'Displays', 'Negative_Mass', ['26_0']], ['Beaker', 'Is On', 'Magnetic_Stirrer', ['26_0']], ['Person', 'Holds', 'Glass Beaker', ['26_1']], ['Person', 'Uses', 'Glass Pipette', ['26_1']], ['Glass Pipette', 'Transfers', 'Liquid', ['26_1']], ['Glass Beaker', 'Contains', 'Clear_Liquid', ['26_1']], ['Digital Balance', 'Displays', '56.30', ['26_1']], ['Person', 'Holds', 'Beaker', ['26_2']], ['Beaker', 'Contains', 'Clear_Liquid', ['26_2']], ['Beaker', 'Contains', 'Glass_Pipette', ['26_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['26_0', '26_1']], ['Beaker', 'Contains', 'Dark_Opaque_Liquid', ['26_0']], ['Balance', 'Displays', 'Negative_Mass', ['26_0']], ['Beaker', 'Is On', 'Magnetic_Stirrer', ['26_0']], ['Digital Balance', 'Displays', '56.30', ['26_1']], ['Beaker', 'Contains', 'Clear_Liquid', ['26_2']], ['Beaker', 'Contains', 'Glass_Pipette', ['26_2']]] merge_instructions=[{'local': 'Pipette', 'existing': 'Glass Pipette', 'existing_id': '4_1'}, {'local': 'Glass Beaker', 'existing': 'Beaker', 'existing_id': '16_0'}, {'local': 'Dark_Opaque_Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Negative_Mass', 'existing': '-56.301_G', 'existing_id': '16_0'}, {'local': 'Clear_Liquid', 'existing': 'Clear_Liquid', 'existing_id': '19_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Dark_Opaque_Liquid'}, {'head': 'Balance', 'relation': 'Displays', 'tail': 'Negative_Mass'}, {'head': 'Beaker', 'relation': 'Is On', 'tail': 'Magnetic_Stirrer'}, {'head': 'Digital Balance', 'relation': 'Displays', 'tail': '56.30'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Beaker'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Clear_Liquid'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Glass_Pipette'}]
2025-11-30 21:17:56,620 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=14, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['26_0', '26_1']], ['Person', 'Holds', 'Pipette', ['26_0']], ['Person', 'Adds', 'Liquid', ['26_0']]]
2025-11-30 21:17:56,620 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=7, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['26_0', '26_1']], ['Beaker', 'Contains', 'Dark_Opaque_Liquid', ['26_0']], ['Balance', 'Displays', 'Negative_Mass', ['26_0']]]
2025-11-30 21:17:56,620 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=5, sample=[{'local': 'Pipette', 'existing': 'Glass Pipette', 'existing_id': '4_1'}, {'local': 'Glass Beaker', 'existing': 'Beaker', 'existing_id': '16_0'}, {'local': 'Dark_Opaque_Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}]
2025-11-30 21:17:56,620 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=8, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Dark_Opaque_Liquid'}, {'head': 'Balance', 'relation': 'Displays', 'tail': 'Negative_Mass'}]
2025-11-30 21:17:56,620 - src.components.global_refiner - INFO - LLM suggested 5 entity merges: [{'local': 'Pipette', 'existing': 'Glass Pipette', 'existing_id': '4_1'}, {'local': 'Glass Beaker', 'existing': 'Beaker', 'existing_id': '16_0'}, {'local': 'Dark_Opaque_Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Negative_Mass', 'existing': '-56.301_G', 'existing_id': '16_0'}, {'local': 'Clear_Liquid', 'existing': 'Clear_Liquid', 'existing_id': '19_0'}]
2025-11-30 21:17:56,620 - src.components.global_refiner - INFO - LLM suggested 8 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Dark_Opaque_Liquid'}, {'head': 'Balance', 'relation': 'Displays', 'tail': 'Negative_Mass'}, {'head': 'Beaker', 'relation': 'Is On', 'tail': 'Magnetic_Stirrer'}, {'head': 'Digital Balance', 'relation': 'Displays', 'tail': '56.30'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Beaker'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Clear_Liquid'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Glass_Pipette'}]
2025-11-30 21:17:56,620 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 21 triplets (total: 16.34s, LLM: 16.34s)
2025-11-30 21:17:56,620 - src.pipeline.kg_builder - INFO - Global refinement: 21 triplets in 16.34s
2025-11-30 21:17:56,620 - src.pipeline.kg_builder - INFO - Using 21 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:17:56,621 - src.pipeline.kg_builder - INFO - Pushing batch 27/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:17:56,621 - src.components.neo4j_handler - INFO - Adding 14 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:17:56,764 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=276, relationships=227
2025-11-30 21:17:56,764 - src.components.neo4j_handler - INFO - Applying 5 merge instructions
2025-11-30 21:17:56,765 - src.components.neo4j_handler - DEBUG - APOC merge successful: Pipette -> Glass Pipette
2025-11-30 21:17:56,769 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass Beaker -> Beaker
2025-11-30 21:17:56,772 - src.components.neo4j_handler - DEBUG - APOC merge successful: Dark_Opaque_Liquid -> Mass Of Liquid
2025-11-30 21:17:56,777 - src.components.neo4j_handler - DEBUG - APOC merge successful: Negative_Mass -> -56.301_G
2025-11-30 21:17:56,777 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Clear_Liquid -> Clear_Liquid
2025-11-30 21:17:56,777 - src.components.neo4j_handler - INFO - Applying 8 prune instructions
2025-11-30 21:17:56,781 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:17:56,782 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Beaker -[Contains]-> Dark_Opaque_Liquid
2025-11-30 21:17:56,782 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Balance -[Displays]-> Negative_Mass
2025-11-30 21:17:56,783 - src.components.neo4j_handler - DEBUG - Pruned relationship: Beaker -[Is On]-> Magnetic_Stirrer
2025-11-30 21:17:56,784 - src.components.neo4j_handler - DEBUG - Pruned relationship: Digital Balance -[Displays]-> 56.30
2025-11-30 21:17:56,786 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Beaker
2025-11-30 21:17:56,787 - src.components.neo4j_handler - DEBUG - Pruned relationship: Beaker -[Contains]-> Clear_Liquid
2025-11-30 21:17:56,788 - src.components.neo4j_handler - DEBUG - Pruned relationship: Beaker -[Contains]-> Glass_Pipette
2025-11-30 21:17:56,788 - src.components.neo4j_handler - INFO - Applying 7 inter-chunk relations
2025-11-30 21:17:56,790 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:17:56,791 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Contains]-> Dark_Opaque_Liquid
2025-11-30 21:17:56,792 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Balance -[Displays]-> Negative_Mass
2025-11-30 21:17:56,793 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Is On]-> Magnetic_Stirrer
2025-11-30 21:17:56,795 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital Balance -[Displays]-> 56.30
2025-11-30 21:17:56,796 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Contains]-> Clear_Liquid
2025-11-30 21:17:56,799 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Contains]-> Glass_Pipette
2025-11-30 21:17:56,799 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:17:56,805 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=272, relationships=223
2025-11-30 21:17:56,807 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:17:56,807 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:17:56,807 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:17:56,807 - src.components.neo4j_handler - INFO - Batch injected in 0.19s (triplets: 0.18s, indexes: 0.00s)
2025-11-30 21:17:56,808 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 127, 'with_embedding': 127, 'linked_chunks': 101}
2025-11-30 21:17:56,808 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:17:56,836 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 272 nodes
2025-11-30 21:17:56,911 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 246 nodes
2025-11-30 21:17:57,000 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 272, 'relationship_count': 782, 'density': 0.0106, 'avg_degree': 5.75, 'avg_unique_neighbors': 5.6912, 'global_efficiency': 0.3247, 'avg_path_length': 2.7504, 'avg_degree_centrality': 0.0212, 'max_degree_centrality': 0.5018, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0287, 'degree_assortativity': -0.1577, 'graph_robustness': 0.8568, 'diameter_estimate': 6, 'clustering_coefficient': 0.2389, 'weakly_connected_components': 27, 'largest_wcc_size': 246, 'pagerank_top10_percent': 10.96, 'louvain_communities': 37, 'louvain_modularity': 0.4258, 'label_entropy': 1.4984, 'computational_time': 0.19194144499488175}
2025-11-30 21:17:57,000 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 26, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508677.000832, 'total_time': 21.69848555792123, 'aggregation': 3.134016878902912e-06, 'network_info': 0.010212275898084044, 'llm_extraction': 21.308177042985335, 'data_cleaning': 3.536802250891924e-05, 'neo4j_injection': 0.18679381208494306, 'embedding_time': 0, 'indexing_time': 0.002371569979004562, 'graph_injection_time': 0.18408606690354645, 'acs_metrics': {'node_count': 272, 'relationship_count': 782, 'density': 0.0106, 'avg_degree': 5.75, 'avg_unique_neighbors': 5.6912, 'global_efficiency': 0.3247, 'avg_path_length': 2.7504, 'avg_degree_centrality': 0.0212, 'max_degree_centrality': 0.5018, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0287, 'degree_assortativity': -0.1577, 'graph_robustness': 0.8568, 'diameter_estimate': 6, 'clustering_coefficient': 0.2389, 'weakly_connected_components': 27, 'largest_wcc_size': 246, 'pagerank_top10_percent': 10.96, 'louvain_communities': 37, 'louvain_modularity': 0.4258, 'label_entropy': 1.4984, 'computational_time': 0.19194144499488175}, 'retrieval_queries': []}
2025-11-30 21:17:57,000 - src.pipeline.kg_builder - DEBUG - Batch 26 metrics: {
  "batch_idx": 26,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508677.000832,
  "total_time": 21.69848555792123,
  "aggregation": 3.134016878902912e-06,
  "network_info": 0.010212275898084044,
  "llm_extraction": 21.308177042985335,
  "data_cleaning": 3.536802250891924e-05,
  "neo4j_injection": 0.18679381208494306,
  "embedding_time": 0,
  "indexing_time": 0.002371569979004562,
  "graph_injection_time": 0.18408606690354645,
  "acs_metrics": {
    "node_count": 272,
    "relationship_count": 782,
    "density": 0.0106,
    "avg_degree": 5.75,
    "avg_unique_neighbors": 5.6912,
    "global_efficiency": 0.3247,
    "avg_path_length": 2.7504,
    "avg_degree_centrality": 0.0212,
    "max_degree_centrality": 0.5018,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0287,
    "degree_assortativity": -0.1577,
    "graph_robustness": 0.8568,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2389,
    "weakly_connected_components": 27,
    "largest_wcc_size": 246,
    "pagerank_top10_percent": 10.96,
    "louvain_communities": 37,
    "louvain_modularity": 0.4258,
    "label_entropy": 1.4984,
    "computational_time": 0.19194144499488175
  },
  "retrieval_queries": []
}
2025-11-30 21:17:57,001 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:17:57,001 - src.pipeline.kg_builder - INFO - Batch 27 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 21.31s, Clean: 0.00s, Neo4j: 0.19s, ACS: 0.19s
2025-11-30 21:17:57,001 - src.pipeline.kg_builder - INFO - Batch 27 completed in 21.70s
Processing KG batches:  38%|███▊      | 27/72 [10:59<19:50, 26.45s/it]2025-11-30 21:17:57,001 - src.pipeline.kg_builder - INFO - Processing batch 28/72 (3 items)
2025-11-30 21:17:57,001 - src.pipeline.kg_builder - DEBUG - Batch 28 current_video_time: 06:54-06:59
2025-11-30 21:17:57,008 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 272
- Total Relationships: 223
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:17:57,009 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:17:57,009 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_0 ~224 words, content: Time: 06:44-06:49 Content: The video captures a sequence of actions in a laboratory setting, focusing on the preparation of a chemical solution. The scene is...
2025-11-30 21:17:57,009 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_1 ~227 words, content: the table, which appears to be a reagent vial, and hold it in their right hand. The Erlenmeyer flask, now containing the transferred liquid, remains...
2025-11-30 21:17:57,009 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_2 ~243 words, content: , working at a large black lab bench. The digital balance is prominently featured in the foreground, with its display showing a negative reading, which...
2025-11-30 21:17:57,009 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_3 ~233 words, content: adding a substance to the container, possibly to achieve a specific concentration or to prepare a solution. The surrounding lab environment remains unchanged, with various...
2025-11-30 21:17:57,009 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_4 ~241 words, content: Action Sequence:** The person carefully places the glass flask onto the balance. The digital display on the balance shows a reading of -56.302 g, which...
2025-11-30 21:17:57,009 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_5 ~28 words, content: laboratory setting, emphasizing the importance of precision and safety in scientific experiments. The person's actions are deliberate and careful, highlighting the attention to detail required...
2025-11-30 21:17:57,029 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:17:57,092 - src.components.pre_llm_injector - DEBUG - Found 127 existing chunk embeddings for similarity lookup
2025-11-30 21:17:57,132 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1', '0.859'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_1', '0.842')]
2025-11-30 21:17:57,134 - src.components.pre_llm_injector - DEBUG - Found 3 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1
2025-11-30 21:17:57,134 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:17:57,134 - src.components.pre_llm_injector - DEBUG - Found 4 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_1
2025-11-30 21:17:57,134 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:17:57,140 - src.components.pre_llm_injector - DEBUG - Limited Person from 64 to 2 external connections
2025-11-30 21:17:57,140 - src.components.pre_llm_injector - DEBUG - Limited Balance from 7 to 2 external connections
2025-11-30 21:17:57,140 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 72 total -> 5 (internal: 1, external: 4)
2025-11-30 21:17:57,140 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[USES]->(Balance / ID: 4_2), (Person / ID: 0_0)-[HOLDS]->(Laboratory_Glassware / ID: 4_2), (Person / ID: 0_0)-[WRITES_ON]->(Document / ID: 0_2), (Balance / ID: 4_2)-[DISPLAYS]->(-56.301_G / ID: 16_0), (Bottle / ID: 1_1)-[IS_HELD_OVER]->(Balance / ID: 4_2)
2025-11-30 21:17:57,146 - src.components.pre_llm_injector - DEBUG - Limited Person from 63 to 2 external connections
2025-11-30 21:17:57,146 - src.components.pre_llm_injector - DEBUG - Limited Beaker from 17 to 2 external connections
2025-11-30 21:17:57,146 - src.components.pre_llm_injector - DEBUG - Limited Balance from 5 to 2 external connections
2025-11-30 21:17:57,146 - src.components.pre_llm_injector - DEBUG - Limited Volumetric Flask from 4 to 2 external connections
2025-11-30 21:17:57,146 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 93 total -> 12 (internal: 4, external: 8)
2025-11-30 21:17:57,146 - src.components.pre_llm_injector - DEBUG - Subgraph: (Beaker / ID: 16_0)-[IS_PLACED_ON]->(Balance / ID: 4_2), (Beaker / ID: 16_0)-[IS_ON]->(Balance / ID: 4_2), (Person / ID: 0_0)-[USES]->(Balance / ID: 4_2), (Person / ID: 0_0)-[ADDS_LIQUID_TO]->(Beaker / ID: 16_0), (Person / ID: 0_0)-[HANDLES]->(Aluminum Foil / ID: 3_2), (Person / ID: 0_0)-[HOLDS]->(Blue_Nitrile_Gloves / ID: 21_0), (Beaker / ID: 16_0)-[CONTAINS]->(Mass Of Liquid / ID: 15_1), (Beaker / ID: 16_0)-[CONTAINS]->(Mass Of Liquid / ID: 15_1), (Balance / ID: 4_2)-[CONTAINS]->(Bottle / ID: 1_1), (Bottle / ID: 1_1)-[IS_HELD_OVER]->(Balance / ID: 4_2), (Volumetric Flask / ID: 18_1)-[RECEIVES]->(Liquid From Burette / ID: 25_1), (Volumetric Flask / ID: 18_1)-[IS_POSITIONED_ON]->(Lab Table / ID: 17_2)
2025-11-30 21:17:57,146 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.732'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_2', '0.728')]
2025-11-30 21:17:57,146 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_4', '0.769'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_0', '0.752')]
2025-11-30 21:17:57,146 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_2', '0.617'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_2', '0.581')]
2025-11-30 21:17:57,146 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1', '0.859'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_1', '0.842')]
2025-11-30 21:17:57,146 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_0', '0.824'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_2', '0.596')]
2025-11-30 21:17:57,146 - src.components.pre_llm_injector - DEBUG - Chunk 5 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_3', '0.748'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_3', '0.734')]
2025-11-30 21:17:57,146 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:17:57,146 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_0) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:17:58,595 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:17:58,595 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:17:58,595 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_1) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:17:59,768 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:17:59,768 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:17:59,768 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_2) (~243 words) with timeout=5.0s retries=3
2025-11-30 21:18:00,872 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:18:00,873 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:18:00,873 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_3) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:18:02,276 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:18:02,276 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:18:02,276 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_4) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:18:03,446 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:18:03,446 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:18:03,446 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_5) (~28 words) with timeout=5.0s retries=3
2025-11-30 21:18:04,411 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:18:04,411 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:18:04,411 - src.components.pre_llm_injector - INFO - Extracted 33 local triplets from 6 chunks
2025-11-30 21:18:04,411 - src.pipeline.kg_builder - INFO - Pre-extraction: 33 triplets in 7.40s
2025-11-30 21:18:04,412 - src.components.global_refiner - INFO - Capping refinement input: 33 → 15 triplets
2025-11-30 21:18:04,412 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[USES]->(Balance / ID: 4_2), (Person / ID: 0_0)-[HOLDS]->(Laboratory_Glassware / ID: 4_2), (Person / ID: 0_0)-[WRITES_ON]->(Document / ID: 0_2), (Balance / ID: 4_2)-[DISPLAYS]->(-56.301_G / ID: 16_0), (Bottle / ID: 1_1)-[IS_HELD_OVER]->(Balance / ID: 4_2)
Subgraph_2: Subgraph: (Beaker / ID: 16_0)-[IS_PLACED_ON]->(Balance / ID: 4_2), (Beaker / ID: 16_0)-[IS_ON]->(Balance / ID: 4_2), (Person / ID: 0_0)-[USES]->(Balance / ID: 4_2), (Person / ID: 0_0)-[ADDS_LIQUID_TO]->(Beaker / ID: 16_0), (Person / ID: 0_0)-[HANDLES]->(Aluminum Foil / ID: 3_2), (Person / ID: 0_0)-[HOLDS]->(Blue_Nitrile_Gloves / ID: 21_0), (Beaker / ID: 16_0)-[CONTAINS]->(Mass Of Liquid / ID: 15_1), (Beaker / ID: 16_0)-[CONTAINS]->(Mass Of Liquid / ID: 15_1), (Balance / ID: 4_2)-[CONTAINS]->(Bottle / ID: 1_1), (Bottle / ID: 1_1)-[IS_HELD_OVER]->(Balance / ID: 4_2), (Volumetric Flask / ID: 18_1)-[RECEIVES]->(Liquid From Burette / ID: 25_1), (Volumetric Flask / ID: 18_1)-[IS_POSITIONED_ON]->(Lab Table / ID: 17_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["27_0", "27_3"]}, {"head": "Person", "relation": "Holds", "tail": "Erlenmeyer_Flask", "source_chunks": ["27_0"]}, {"head": "Erlenmeyer_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["27_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["27_0", "27_1", "27_2"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["27_0"]}, {"head": "Person", "relation": "Holds", "tail": "Reagent_Vial", "source_chunks": ["27_0"]}, {"head": "Person", "relation": "Holds", "tail": "Reagent Vial", "source_chunks": ["27_1"]}, {"head": "Person", "relation": "Holds", "tail": "Erlenmeyer Flask", "source_chunks": ["27_1"]}, {"head": "Reagent Vial", "relation": "Contains", "tail": "Liquid", "source_chunks": ["27_1"]}, {"head": "Erlenmeyer Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["27_1"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["27_1"]}, {"head": "Person", "relation": "Handles", "tail": "Glass Container", "source_chunks": ["27_2"]}, {"head": "Glass Container", "relation": "Is Placed On", "tail": "Digital Balance", "source_chunks": ["27_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "Negative Reading", "source_chunks": ["27_2"]}, {"head": "Glass Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["27_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:18:04,412 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~446 words, ~580 tokens)
2025-11-30 21:18:04,412 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:18:21,906 - src.components.global_refiner - DEBUG - LLM call completed in 17.49s
2025-11-30 21:18:21,906 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['27_0', '27_3']], ['Person', 'Holds', 'Erlenmeyer_Flask', ['27_0']], ['Erlenmeyer_Flask', 'Contains', 'Clear_Liquid', ['27_0']], ['Person', 'Uses', 'Pipette', ['27_0', '27_1', '27_2']], ['Pipette', 'Transfers', 'Clear_Liquid', ['27_0']], ['Person', 'Holds', 'Reagent_Vial', ['27_0']], ['Person', 'Holds', 'Reagent Vial', ['27_1']], ['Person', 'Holds', 'Erlenmeyer Flask', ['27_1']], ['Reagent Vial', 'Contains', 'Liquid', ['27_1']], ['Erlenmeyer Flask', 'Contains', 'Liquid', ['27_1']], ['Person', 'Transfers', 'Liquid', ['27_1']], ['Person', 'Handles', 'Glass Container', ['27_2']], ['Glass Container', 'Is Placed On', 'Digital Balance', ['27_2']], ['Digital Balance', 'Displays', 'Negative Reading', ['27_2']], ['Glass Container', 'Contains', 'Liquid', ['27_2']]] inter_chunk_relations=[['Person', 'Holds', 'Erlenmeyer_Flask', ['27_0']], ['Person', 'Holds', 'Erlenmeyer Flask', ['27_1']], ['Reagent Vial', 'Contains', 'Liquid', ['27_1']], ['Erlenmeyer Flask', 'Contains', 'Liquid', ['27_1']], ['Person', 'Transfers', 'Liquid', ['27_1']], ['Person', 'Handles', 'Glass Container', ['27_2']], ['Glass Container', 'Is Placed On', 'Digital Balance', ['27_2']], ['Digital Balance', 'Displays', 'Negative Reading', ['27_2']], ['Glass Container', 'Contains', 'Liquid', ['27_2']]] merge_instructions=[{'local': 'Erlenmeyer_Flask', 'existing': 'Beaker', 'existing_id': '16_0'}, {'local': 'Erlenmeyer Flask', 'existing': 'Beaker', 'existing_id': '16_0'}, {'local': 'Reagent Vial', 'existing': 'Bottle', 'existing_id': '1_1'}, {'local': 'Glass Container', 'existing': 'Beaker', 'existing_id': '16_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Erlenmeyer_Flask'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Erlenmeyer Flask'}, {'head': 'Reagent Vial', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Erlenmeyer Flask', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Handles', 'tail': 'Glass Container'}, {'head': 'Glass Container', 'relation': 'Is Placed On', 'tail': 'Digital Balance'}, {'head': 'Digital Balance', 'relation': 'Displays', 'tail': 'Negative Reading'}, {'head': 'Glass Container', 'relation': 'Contains', 'tail': 'Liquid'}]
2025-11-30 21:18:21,906 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['27_0', '27_3']], ['Person', 'Holds', 'Erlenmeyer_Flask', ['27_0']], ['Erlenmeyer_Flask', 'Contains', 'Clear_Liquid', ['27_0']]]
2025-11-30 21:18:21,906 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=9, sample=[['Person', 'Holds', 'Erlenmeyer_Flask', ['27_0']], ['Person', 'Holds', 'Erlenmeyer Flask', ['27_1']], ['Reagent Vial', 'Contains', 'Liquid', ['27_1']]]
2025-11-30 21:18:21,906 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Erlenmeyer_Flask', 'existing': 'Beaker', 'existing_id': '16_0'}, {'local': 'Erlenmeyer Flask', 'existing': 'Beaker', 'existing_id': '16_0'}, {'local': 'Reagent Vial', 'existing': 'Bottle', 'existing_id': '1_1'}]
2025-11-30 21:18:21,906 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=9, sample=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Erlenmeyer_Flask'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Erlenmeyer Flask'}, {'head': 'Reagent Vial', 'relation': 'Contains', 'tail': 'Liquid'}]
2025-11-30 21:18:21,906 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Erlenmeyer_Flask', 'existing': 'Beaker', 'existing_id': '16_0'}, {'local': 'Erlenmeyer Flask', 'existing': 'Beaker', 'existing_id': '16_0'}, {'local': 'Reagent Vial', 'existing': 'Bottle', 'existing_id': '1_1'}, {'local': 'Glass Container', 'existing': 'Beaker', 'existing_id': '16_0'}]
2025-11-30 21:18:21,906 - src.components.global_refiner - INFO - LLM suggested 9 triplets to prune: [{'head': 'Person', 'relation': 'Holds', 'tail': 'Erlenmeyer_Flask'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Erlenmeyer Flask'}, {'head': 'Reagent Vial', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Erlenmeyer Flask', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Handles', 'tail': 'Glass Container'}, {'head': 'Glass Container', 'relation': 'Is Placed On', 'tail': 'Digital Balance'}, {'head': 'Digital Balance', 'relation': 'Displays', 'tail': 'Negative Reading'}, {'head': 'Glass Container', 'relation': 'Contains', 'tail': 'Liquid'}]
2025-11-30 21:18:21,906 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 24 triplets (total: 17.49s, LLM: 17.49s)
2025-11-30 21:18:21,906 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 17.49s
2025-11-30 21:18:21,906 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:18:21,906 - src.pipeline.kg_builder - INFO - Pushing batch 28/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:18:21,906 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:18:22,058 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=285, relationships=237
2025-11-30 21:18:22,058 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:18:22,059 - src.components.neo4j_handler - DEBUG - APOC merge successful: Erlenmeyer_Flask -> Beaker
2025-11-30 21:18:22,062 - src.components.neo4j_handler - DEBUG - APOC merge successful: Erlenmeyer Flask -> Beaker
2025-11-30 21:18:22,065 - src.components.neo4j_handler - DEBUG - APOC merge successful: Reagent Vial -> Bottle
2025-11-30 21:18:22,068 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass Container -> Beaker
2025-11-30 21:18:22,068 - src.components.neo4j_handler - INFO - Applying 9 prune instructions
2025-11-30 21:18:22,072 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Erlenmeyer_Flask
2025-11-30 21:18:22,072 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Erlenmeyer Flask
2025-11-30 21:18:22,074 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Reagent Vial -[Contains]-> Liquid
2025-11-30 21:18:22,075 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Erlenmeyer Flask -[Contains]-> Liquid
2025-11-30 21:18:22,076 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Transfers]-> Liquid
2025-11-30 21:18:22,077 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Handles]-> Glass Container
2025-11-30 21:18:22,078 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Glass Container -[Is Placed On]-> Digital Balance
2025-11-30 21:18:22,080 - src.components.neo4j_handler - DEBUG - Pruned relationship: Digital Balance -[Displays]-> Negative Reading
2025-11-30 21:18:22,080 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Glass Container -[Contains]-> Liquid
2025-11-30 21:18:22,080 - src.components.neo4j_handler - INFO - Applying 9 inter-chunk relations
2025-11-30 21:18:22,081 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Erlenmeyer_Flask
2025-11-30 21:18:22,081 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Erlenmeyer Flask
2025-11-30 21:18:22,082 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Reagent Vial -[Contains]-> Liquid
2025-11-30 21:18:22,082 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Erlenmeyer Flask -[Contains]-> Liquid
2025-11-30 21:18:22,083 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Transfers]-> Liquid
2025-11-30 21:18:22,084 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Handles]-> Glass Container
2025-11-30 21:18:22,084 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Glass Container -[Is Placed On]-> Digital Balance
2025-11-30 21:18:22,085 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital Balance -[Displays]-> Negative Reading
2025-11-30 21:18:22,085 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Glass Container -[Contains]-> Liquid
2025-11-30 21:18:22,086 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:18:22,090 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=281, relationships=237
2025-11-30 21:18:22,091 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:18:22,091 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:18:22,092 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:18:22,092 - src.components.neo4j_handler - INFO - Batch injected in 0.19s (triplets: 0.18s, indexes: 0.00s)
2025-11-30 21:18:22,093 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 133, 'with_embedding': 133, 'linked_chunks': 105}
2025-11-30 21:18:22,093 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:18:22,135 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 281 nodes
2025-11-30 21:18:22,221 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 253 nodes
2025-11-30 21:18:22,319 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 281, 'relationship_count': 807, 'density': 0.0103, 'avg_degree': 5.7438, 'avg_unique_neighbors': 5.6868, 'global_efficiency': 0.3229, 'avg_path_length': 2.7383, 'avg_degree_centrality': 0.0205, 'max_degree_centrality': 0.5071, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.015, 'degree_assortativity': -0.1658, 'graph_robustness': 0.86, 'diameter_estimate': 6, 'clustering_coefficient': 0.2402, 'weakly_connected_components': 29, 'largest_wcc_size': 253, 'pagerank_top10_percent': 10.65, 'louvain_communities': 37, 'louvain_modularity': 0.4249, 'label_entropy': 1.499, 'computational_time': 0.2261500230524689}
2025-11-30 21:18:22,319 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 27, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508702.3194613, 'total_time': 25.3177722429391, 'aggregation': 2.903980202972889e-06, 'network_info': 0.0070194260915741324, 'llm_extraction': 24.897834115079604, 'data_cleaning': 2.0032981410622597e-05, 'neo4j_injection': 0.18536688096355647, 'embedding_time': 0, 'indexing_time': 0.0012235780013725162, 'graph_injection_time': 0.1839256410021335, 'acs_metrics': {'node_count': 281, 'relationship_count': 807, 'density': 0.0103, 'avg_degree': 5.7438, 'avg_unique_neighbors': 5.6868, 'global_efficiency': 0.3229, 'avg_path_length': 2.7383, 'avg_degree_centrality': 0.0205, 'max_degree_centrality': 0.5071, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.015, 'degree_assortativity': -0.1658, 'graph_robustness': 0.86, 'diameter_estimate': 6, 'clustering_coefficient': 0.2402, 'weakly_connected_components': 29, 'largest_wcc_size': 253, 'pagerank_top10_percent': 10.65, 'louvain_communities': 37, 'louvain_modularity': 0.4249, 'label_entropy': 1.499, 'computational_time': 0.2261500230524689}, 'retrieval_queries': []}
2025-11-30 21:18:22,319 - src.pipeline.kg_builder - DEBUG - Batch 27 metrics: {
  "batch_idx": 27,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508702.3194613,
  "total_time": 25.3177722429391,
  "aggregation": 2.903980202972889e-06,
  "network_info": 0.0070194260915741324,
  "llm_extraction": 24.897834115079604,
  "data_cleaning": 2.0032981410622597e-05,
  "neo4j_injection": 0.18536688096355647,
  "embedding_time": 0,
  "indexing_time": 0.0012235780013725162,
  "graph_injection_time": 0.1839256410021335,
  "acs_metrics": {
    "node_count": 281,
    "relationship_count": 807,
    "density": 0.0103,
    "avg_degree": 5.7438,
    "avg_unique_neighbors": 5.6868,
    "global_efficiency": 0.3229,
    "avg_path_length": 2.7383,
    "avg_degree_centrality": 0.0205,
    "max_degree_centrality": 0.5071,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.015,
    "degree_assortativity": -0.1658,
    "graph_robustness": 0.86,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2402,
    "weakly_connected_components": 29,
    "largest_wcc_size": 253,
    "pagerank_top10_percent": 10.65,
    "louvain_communities": 37,
    "louvain_modularity": 0.4249,
    "label_entropy": 1.499,
    "computational_time": 0.2261500230524689
  },
  "retrieval_queries": []
}
2025-11-30 21:18:22,320 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:18:22,320 - src.pipeline.kg_builder - INFO - Batch 28 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 24.90s, Clean: 0.00s, Neo4j: 0.19s, ACS: 0.23s
2025-11-30 21:18:22,320 - src.pipeline.kg_builder - INFO - Batch 28 completed in 25.32s
Processing KG batches:  39%|███▉      | 28/72 [11:25<19:08, 26.11s/it]2025-11-30 21:18:22,320 - src.pipeline.kg_builder - INFO - Processing batch 29/72 (3 items)
2025-11-30 21:18:22,320 - src.pipeline.kg_builder - DEBUG - Batch 29 current_video_time: 07:08-07:13
2025-11-30 21:18:22,327 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 281
- Total Relationships: 237
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:18:22,327 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:18:22,327 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_0 ~226 words, content: Time: 06:59-07:03 Content: The sequence of frames captures a person in a laboratory setting performing a precise task, likely related to preparing a chemical solution....
2025-11-30 21:18:22,327 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_1 ~225 words, content: the Seal (Frame 4):** The person continues to hold the flask, now with the stopper fully in place. They are likely in the process of...
2025-11-30 21:18:22,327 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_2 ~226 words, content: the person holding a glass volumetric flask, which is a piece of laboratory glassware used to prepare a solution of precise concentration. The flask is...
2025-11-30 21:18:22,327 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_3 ~227 words, content: . In summary, the video shows a person in a lab, wearing protective gloves, preparing a solution by carefully adding a liquid to a volumetric...
2025-11-30 21:18:22,327 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_4 ~102 words, content: to adjust or secure the stopper. The camera angle shifts slightly, providing a clearer view of the person in the background, who remains focused on...
2025-11-30 21:18:22,347 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:18:22,413 - src.components.pre_llm_injector - DEBUG - Found 133 existing chunk embeddings for similarity lookup
2025-11-30 21:18:22,447 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.808'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3', '0.801')]
2025-11-30 21:18:22,449 - src.components.pre_llm_injector - DEBUG - Found 3 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2
2025-11-30 21:18:22,449 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:18:22,450 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3 via source_chunk_ids
2025-11-30 21:18:22,456 - src.components.pre_llm_injector - DEBUG - Limited Person from 70 to 2 external connections
2025-11-30 21:18:22,456 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 72 total -> 4 (internal: 2, external: 2)
2025-11-30 21:18:22,456 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2), (Person / ID: 0_0)-[HOLDS]->(Laboratory_Glassware / ID: 4_2)
2025-11-30 21:18:22,456 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_0', '0.724'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_4', '0.717')]
2025-11-30 21:18:22,456 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_1', '0.610'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_3', '0.602')]
2025-11-30 21:18:22,456 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3', '0.727'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_0', '0.705')]
2025-11-30 21:18:22,456 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.808'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_0', '0.795')]
2025-11-30 21:18:22,456 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3', '0.801'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4', '0.773')]
2025-11-30 21:18:22,456 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:18:22,456 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_0) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:18:23,757 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:18:23,757 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:18:23,758 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_1) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:18:24,721 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:18:24,721 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:18:24,722 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_2) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:18:25,913 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:18:25,913 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:18:25,914 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_3) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:18:26,992 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:18:26,993 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:18:26,993 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_4) (~102 words) with timeout=5.0s retries=3
2025-11-30 21:18:28,492 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:18:28,492 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:18:28,492 - src.components.pre_llm_injector - INFO - Extracted 27 local triplets from 5 chunks
2025-11-30 21:18:28,492 - src.pipeline.kg_builder - INFO - Pre-extraction: 27 triplets in 6.17s
2025-11-30 21:18:28,492 - src.components.global_refiner - INFO - Capping refinement input: 27 → 15 triplets
2025-11-30 21:18:28,492 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2), (Person / ID: 0_0)-[HOLDS]->(Laboratory_Glassware / ID: 4_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["28_0"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["28_0"]}, {"head": "Person", "relation": "Places", "tail": "Stopper", "source_chunks": ["28_0"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["28_0", "28_4"]}, {"head": "Person", "relation": "Checks", "tail": "Liquid_Level", "source_chunks": ["28_0"]}, {"head": "Person", "relation": "Holds", "tail": "Flask_Steady", "source_chunks": ["28_0"]}, {"head": "Person", "relation": "Holds", "tail": "Flask", "source_chunks": ["28_1"]}, {"head": "Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["28_1"]}, {"head": "Person", "relation": "Inverts", "tail": "Flask", "source_chunks": ["28_1"]}, {"head": "Flask", "relation": "Contains", "tail": "Stopper", "source_chunks": ["28_1"]}, {"head": "Person", "relation": "Holds", "tail": "Stopper", "source_chunks": ["28_1"]}, {"head": "Flask", "relation": "Contains", "tail": "Solution", "source_chunks": ["28_1"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["28_2", "28_3"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["28_2"]}, {"head": "Volumetric Flask", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["28_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:18:28,492 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~333 words, ~433 tokens)
2025-11-30 21:18:28,492 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:18:44,508 - src.components.global_refiner - DEBUG - LLM call completed in 16.02s
2025-11-30 21:18:44,509 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['28_0']], ['Person', 'Holds', 'Volumetric_Flask', ['28_0']], ['Person', 'Places', 'Stopper', ['28_0']], ['Volumetric_Flask', 'Contains', 'Clear_Liquid', ['28_0', '28_4']], ['Person', 'Checks', 'Liquid_Level', ['28_0']], ['Person', 'Holds', 'Flask_Steady', ['28_0']], ['Person', 'Holds', 'Flask', ['28_1']], ['Flask', 'Contains', 'Liquid', ['28_1']], ['Person', 'Inverts', 'Flask', ['28_1']], ['Flask', 'Contains', 'Stopper', ['28_1']], ['Person', 'Holds', 'Stopper', ['28_1']], ['Flask', 'Contains', 'Solution', ['28_1']], ['Person', 'Holds', 'Volumetric Flask', ['28_2', '28_3']], ['Person', 'Uses', 'Pipette', ['28_2']], ['Volumetric Flask', 'Contains', 'Clear Liquid', ['28_2']]] inter_chunk_relations=[['Person', 'Holds', 'Metal_Spatula', ['28_0']], ['Person', 'Holds', 'Laboratory_Glassware', ['28_0']], ['Person', 'Holds', 'Volumetric_Flask', ['28_0']], ['Person', 'Holds', 'Flask', ['28_1']], ['Person', 'Holds', 'Volumetric Flask', ['28_2', '28_3']]] merge_instructions=[{'local': 'Volumetric_Flask', 'existing': 'Volumetric Flask', 'existing_id': '4_2'}, {'local': 'Flask', 'existing': 'Laboratory_Glassware', 'existing_id': '4_2'}, {'local': 'Clear_Liquid', 'existing': 'Clear Liquid', 'existing_id': '4_2'}, {'local': 'Stopper', 'existing': 'Stopper', 'existing_id': '4_2'}] prune_instructions=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Metal_Spatula'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Laboratory_Glassware'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Flask_Steady'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Flask'}, {'head': 'Flask', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Flask', 'relation': 'Contains', 'tail': 'Stopper'}, {'head': 'Flask', 'relation': 'Contains', 'tail': 'Solution'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Stopper'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric Flask'}, {'head': 'Volumetric Flask', 'relation': 'Contains', 'tail': 'Clear Liquid'}]
2025-11-30 21:18:44,509 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['28_0']], ['Person', 'Holds', 'Volumetric_Flask', ['28_0']], ['Person', 'Places', 'Stopper', ['28_0']]]
2025-11-30 21:18:44,509 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Person', 'Holds', 'Metal_Spatula', ['28_0']], ['Person', 'Holds', 'Laboratory_Glassware', ['28_0']], ['Person', 'Holds', 'Volumetric_Flask', ['28_0']]]
2025-11-30 21:18:44,509 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Volumetric_Flask', 'existing': 'Volumetric Flask', 'existing_id': '4_2'}, {'local': 'Flask', 'existing': 'Laboratory_Glassware', 'existing_id': '4_2'}, {'local': 'Clear_Liquid', 'existing': 'Clear Liquid', 'existing_id': '4_2'}]
2025-11-30 21:18:44,509 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=10, sample=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Metal_Spatula'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Laboratory_Glassware'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Flask_Steady'}]
2025-11-30 21:18:44,509 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Volumetric_Flask', 'existing': 'Volumetric Flask', 'existing_id': '4_2'}, {'local': 'Flask', 'existing': 'Laboratory_Glassware', 'existing_id': '4_2'}, {'local': 'Clear_Liquid', 'existing': 'Clear Liquid', 'existing_id': '4_2'}, {'local': 'Stopper', 'existing': 'Stopper', 'existing_id': '4_2'}]
2025-11-30 21:18:44,509 - src.components.global_refiner - INFO - LLM suggested 10 triplets to prune: [{'head': 'Person', 'relation': 'Holds', 'tail': 'Metal_Spatula'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Laboratory_Glassware'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Flask_Steady'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Flask'}, {'head': 'Flask', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Flask', 'relation': 'Contains', 'tail': 'Stopper'}, {'head': 'Flask', 'relation': 'Contains', 'tail': 'Solution'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Stopper'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric Flask'}, {'head': 'Volumetric Flask', 'relation': 'Contains', 'tail': 'Clear Liquid'}]
2025-11-30 21:18:44,509 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 16.02s, LLM: 16.02s)
2025-11-30 21:18:44,509 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 16.02s
2025-11-30 21:18:44,509 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:18:44,509 - src.pipeline.kg_builder - INFO - Pushing batch 29/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:18:44,509 - src.components.neo4j_handler - INFO - Adding 17 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:18:44,659 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=291, relationships=248
2025-11-30 21:18:44,659 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:18:44,659 - src.components.neo4j_handler - DEBUG - APOC merge successful: Volumetric_Flask -> Volumetric Flask
2025-11-30 21:18:44,663 - src.components.neo4j_handler - DEBUG - APOC merge successful: Flask -> Laboratory_Glassware
2025-11-30 21:18:44,666 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear_Liquid -> Clear Liquid
2025-11-30 21:18:44,666 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Stopper -> Stopper
2025-11-30 21:18:44,666 - src.components.neo4j_handler - INFO - Applying 10 prune instructions
2025-11-30 21:18:44,670 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Metal_Spatula
2025-11-30 21:18:44,671 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Laboratory_Glassware
2025-11-30 21:18:44,672 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Flask_Steady
2025-11-30 21:18:44,672 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Flask
2025-11-30 21:18:44,672 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Flask -[Contains]-> Liquid
2025-11-30 21:18:44,673 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Flask -[Contains]-> Stopper
2025-11-30 21:18:44,673 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Flask -[Contains]-> Solution
2025-11-30 21:18:44,675 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Stopper
2025-11-30 21:18:44,676 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Volumetric Flask
2025-11-30 21:18:44,677 - src.components.neo4j_handler - DEBUG - Pruned relationship: Volumetric Flask -[Contains]-> Clear Liquid
2025-11-30 21:18:44,677 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:18:44,678 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Metal_Spatula
2025-11-30 21:18:44,679 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Laboratory_Glassware
2025-11-30 21:18:44,680 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Volumetric_Flask
2025-11-30 21:18:44,680 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Flask
2025-11-30 21:18:44,681 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Volumetric Flask
2025-11-30 21:18:44,682 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:18:44,687 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=288, relationships=239
2025-11-30 21:18:44,688 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:18:44,688 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:18:44,689 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:18:44,689 - src.components.neo4j_handler - INFO - Batch injected in 0.18s (triplets: 0.18s, indexes: 0.00s)
2025-11-30 21:18:44,690 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 138, 'with_embedding': 138, 'linked_chunks': 110}
2025-11-30 21:18:44,690 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:18:44,733 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 288 nodes
2025-11-30 21:18:44,823 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 260 nodes
2025-11-30 21:18:44,926 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 288, 'relationship_count': 832, 'density': 0.0101, 'avg_degree': 5.7778, 'avg_unique_neighbors': 5.7083, 'global_efficiency': 0.3256, 'avg_path_length': 2.7271, 'avg_degree_centrality': 0.0201, 'max_degree_centrality': 0.5157, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0229, 'degree_assortativity': -0.172, 'graph_robustness': 0.8582, 'diameter_estimate': 6, 'clustering_coefficient': 0.2417, 'weakly_connected_components': 29, 'largest_wcc_size': 260, 'pagerank_top10_percent': 10.41, 'louvain_communities': 39, 'louvain_modularity': 0.4167, 'label_entropy': 1.4994, 'computational_time': 0.2367212630342692}
2025-11-30 21:18:44,927 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 28, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508724.927126, 'total_time': 22.606779270106927, 'aggregation': 3.003980964422226e-06, 'network_info': 0.0065752610098570585, 'llm_extraction': 22.182563437032513, 'data_cleaning': 3.271503373980522e-05, 'neo4j_injection': 0.17944986396469176, 'embedding_time': 0, 'indexing_time': 0.0012080140877515078, 'graph_injection_time': 0.17788175505120307, 'acs_metrics': {'node_count': 288, 'relationship_count': 832, 'density': 0.0101, 'avg_degree': 5.7778, 'avg_unique_neighbors': 5.7083, 'global_efficiency': 0.3256, 'avg_path_length': 2.7271, 'avg_degree_centrality': 0.0201, 'max_degree_centrality': 0.5157, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0229, 'degree_assortativity': -0.172, 'graph_robustness': 0.8582, 'diameter_estimate': 6, 'clustering_coefficient': 0.2417, 'weakly_connected_components': 29, 'largest_wcc_size': 260, 'pagerank_top10_percent': 10.41, 'louvain_communities': 39, 'louvain_modularity': 0.4167, 'label_entropy': 1.4994, 'computational_time': 0.2367212630342692}, 'retrieval_queries': []}
2025-11-30 21:18:44,927 - src.pipeline.kg_builder - DEBUG - Batch 28 metrics: {
  "batch_idx": 28,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508724.927126,
  "total_time": 22.606779270106927,
  "aggregation": 3.003980964422226e-06,
  "network_info": 0.0065752610098570585,
  "llm_extraction": 22.182563437032513,
  "data_cleaning": 3.271503373980522e-05,
  "neo4j_injection": 0.17944986396469176,
  "embedding_time": 0,
  "indexing_time": 0.0012080140877515078,
  "graph_injection_time": 0.17788175505120307,
  "acs_metrics": {
    "node_count": 288,
    "relationship_count": 832,
    "density": 0.0101,
    "avg_degree": 5.7778,
    "avg_unique_neighbors": 5.7083,
    "global_efficiency": 0.3256,
    "avg_path_length": 2.7271,
    "avg_degree_centrality": 0.0201,
    "max_degree_centrality": 0.5157,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0229,
    "degree_assortativity": -0.172,
    "graph_robustness": 0.8582,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2417,
    "weakly_connected_components": 29,
    "largest_wcc_size": 260,
    "pagerank_top10_percent": 10.41,
    "louvain_communities": 39,
    "louvain_modularity": 0.4167,
    "label_entropy": 1.4994,
    "computational_time": 0.2367212630342692
  },
  "retrieval_queries": []
}
2025-11-30 21:18:44,927 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:18:44,927 - src.pipeline.kg_builder - INFO - Batch 29 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 22.18s, Clean: 0.00s, Neo4j: 0.18s, ACS: 0.24s
2025-11-30 21:18:44,927 - src.pipeline.kg_builder - INFO - Batch 29 completed in 22.61s
Processing KG batches:  40%|████      | 29/72 [11:47<17:57, 25.06s/it]2025-11-30 21:18:44,928 - src.pipeline.kg_builder - INFO - Processing batch 30/72 (3 items)
2025-11-30 21:18:44,928 - src.pipeline.kg_builder - DEBUG - Batch 30 current_video_time: 07:23-07:28
2025-11-30 21:18:44,934 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 288
- Total Relationships: 239
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:18:44,935 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:18:44,935 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_0 ~241 words, content: Time: 07:13-07:18 Content: The video captures a scene in a laboratory setting, likely a chemistry or research lab, where a scientific procedure is being performed....
2025-11-30 21:18:44,935 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_1 ~225 words, content: precision, which is essential in scientific research. The video likely aims to document a specific scientific procedure, emphasizing the importance of careful handling and observation...
2025-11-30 21:18:44,935 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_2 ~210 words, content: final frame shows the person's arm and a gold watch, confirming the first-person viewpoint. The overall atmosphere suggests a teaching or research demonstration. Time: 07:23-07:28...
2025-11-30 21:18:44,955 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:18:45,014 - src.components.pre_llm_injector - DEBUG - Found 138 existing chunk embeddings for similarity lookup
2025-11-30 21:18:45,036 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.835'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_3', '0.833')]
2025-11-30 21:18:45,038 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_3 via source_chunk_ids
2025-11-30 21:18:45,038 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3
2025-11-30 21:18:45,038 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:18:45,045 - src.components.pre_llm_injector - DEBUG - Limited Person from 72 to 2 external connections
2025-11-30 21:18:45,045 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 72 total -> 2 (internal: 0, external: 2)
2025-11-30 21:18:45,045 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[USES]->(Digital_Balance / ID: 16_0), (Person / ID: 0_0)-[USES]->(Metal_Spoon / ID: 8_0)
2025-11-30 21:18:45,045 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_3', '0.833'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_3', '0.813')]
2025-11-30 21:18:45,045 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.771'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.761')]
2025-11-30 21:18:45,045 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.835'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.795')]
2025-11-30 21:18:45,045 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:18:45,045 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_0) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:18:46,575 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:18:46,575 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:18:46,575 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_1) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:18:48,033 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:18:48,033 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:18:48,033 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_2) (~210 words) with timeout=5.0s retries=3
2025-11-30 21:18:49,354 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:18:49,354 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:18:49,354 - src.components.pre_llm_injector - INFO - Extracted 15 local triplets from 3 chunks
2025-11-30 21:18:49,354 - src.pipeline.kg_builder - INFO - Pre-extraction: 15 triplets in 4.42s
2025-11-30 21:18:49,354 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[USES]->(Digital_Balance / ID: 16_0), (Person / ID: 0_0)-[USES]->(Metal_Spoon / ID: 8_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["29_0", "29_1", "29_2"]}, {"head": "Person", "relation": "Handles", "tail": "Volumetric_Flask", "source_chunks": ["29_0"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["29_0", "29_1"]}, {"head": "Person", "relation": "Observes", "tail": "Background_Person", "source_chunks": ["29_0"]}, {"head": "Background_Person", "relation": "Stands", "tail": "With_Arms_Crossed", "source_chunks": ["29_0"]}, {"head": "Lab", "relation": "Contains", "tail": "Fire_Extinguisher", "source_chunks": ["29_0"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["29_1"]}, {"head": "Man", "relation": "Observes", "tail": "Person", "source_chunks": ["29_1"]}, {"head": "Man", "relation": "Wears", "tail": "Cream_Color_Turtleneck", "source_chunks": ["29_1"]}, {"head": "Lab_Room", "relation": "Contains", "tail": "Fire_Extinguisher", "source_chunks": ["29_1"]}, {"head": "Person", "relation": "Performs", "tail": "Titration", "source_chunks": ["29_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Volumetric_Flask", "source_chunks": ["29_2"]}, {"head": "Person", "relation": "Observes", "tail": "Scientific_Procedure", "source_chunks": ["29_2"]}, {"head": "Scientific_Procedure", "relation": "Involves", "tail": "Liquid_Transfer", "source_chunks": ["29_2"]}, {"head": "Person", "relation": "Wears", "tail": "Gold_Watch", "source_chunks": ["29_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:18:49,354 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~317 words, ~412 tokens)
2025-11-30 21:18:49,354 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:19:08,217 - src.components.global_refiner - DEBUG - LLM call completed in 18.86s
2025-11-30 21:19:08,218 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['29_0', '29_1', '29_2']], ['Person', 'Handles', 'Volumetric_Flask', ['29_0']], ['Volumetric_Flask', 'Contains', 'Clear_Liquid', ['29_0', '29_1']], ['Person', 'Observes', 'Background_Person', ['29_0']], ['Background_Person', 'Stands', 'With_Arms_Crossed', ['29_0']], ['Lab', 'Contains', 'Fire_Extinguisher', ['29_0']], ['Person', 'Holds', 'Volumetric_Flask', ['29_1']], ['Man', 'Observes', 'Person', ['29_1']], ['Man', 'Wears', 'Cream_Color_Turtleneck', ['29_1']], ['Lab_Room', 'Contains', 'Fire_Extinguisher', ['29_1']], ['Person', 'Performs', 'Titration', ['29_2']], ['Person', 'Holds', 'Glass_Volumetric_Flask', ['29_2']], ['Person', 'Observes', 'Scientific_Procedure', ['29_2']], ['Scientific_Procedure', 'Involves', 'Liquid_Transfer', ['29_2']], ['Person', 'Wears', 'Gold_Watch', ['29_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['29_0', '29_1', '29_2']], ['Person', 'Handles', 'Volumetric_Flask', ['29_0']], ['Volumetric_Flask', 'Contains', 'Clear_Liquid', ['29_0', '29_1']], ['Person', 'Observes', 'Background_Person', ['29_0']], ['Background_Person', 'Stands', 'With_Arms_Crossed', ['29_0']], ['Lab', 'Contains', 'Fire_Extinguisher', ['29_0']], ['Person', 'Holds', 'Volumetric_Flask', ['29_1']], ['Man', 'Observes', 'Person', ['29_1']], ['Man', 'Wears', 'Cream_Color_Turtleneck', ['29_1']], ['Lab_Room', 'Contains', 'Fire_Extinguisher', ['29_1']], ['Person', 'Performs', 'Titration', ['29_2']], ['Person', 'Holds', 'Glass_Volumetric_Flask', ['29_2']], ['Person', 'Observes', 'Scientific_Procedure', ['29_2']], ['Scientific_Procedure', 'Involves', 'Liquid_Transfer', ['29_2']], ['Person', 'Wears', 'Gold_Watch', ['29_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Volumetric_Flask', 'existing': 'Glass_Volumetric_Flask', 'existing_id': '16_0'}, {'local': 'Glass_Volumetric_Flask', 'existing': 'Volumetric_Flask', 'existing_id': '16_0'}, {'local': 'Scientific_Procedure', 'existing': 'Titration', 'existing_id': '0_0'}] prune_instructions=[{'entity': 'Metal_Spoon'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric_Flask'}, {'head': 'Person', 'relation': 'Performs', 'tail': 'Titration'}]
2025-11-30 21:19:08,218 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['29_0', '29_1', '29_2']], ['Person', 'Handles', 'Volumetric_Flask', ['29_0']], ['Volumetric_Flask', 'Contains', 'Clear_Liquid', ['29_0', '29_1']]]
2025-11-30 21:19:08,218 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['29_0', '29_1', '29_2']], ['Person', 'Handles', 'Volumetric_Flask', ['29_0']], ['Volumetric_Flask', 'Contains', 'Clear_Liquid', ['29_0', '29_1']]]
2025-11-30 21:19:08,218 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Volumetric_Flask', 'existing': 'Glass_Volumetric_Flask', 'existing_id': '16_0'}, {'local': 'Glass_Volumetric_Flask', 'existing': 'Volumetric_Flask', 'existing_id': '16_0'}]
2025-11-30 21:19:08,218 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'entity': 'Metal_Spoon'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric_Flask'}]
2025-11-30 21:19:08,218 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Volumetric_Flask', 'existing': 'Glass_Volumetric_Flask', 'existing_id': '16_0'}, {'local': 'Glass_Volumetric_Flask', 'existing': 'Volumetric_Flask', 'existing_id': '16_0'}, {'local': 'Scientific_Procedure', 'existing': 'Titration', 'existing_id': '0_0'}]
2025-11-30 21:19:08,218 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'entity': 'Metal_Spoon'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric_Flask'}, {'head': 'Person', 'relation': 'Performs', 'tail': 'Titration'}]
2025-11-30 21:19:08,218 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 30 triplets (total: 18.86s, LLM: 18.86s)
2025-11-30 21:19:08,218 - src.pipeline.kg_builder - INFO - Global refinement: 30 triplets in 18.86s
2025-11-30 21:19:08,218 - src.pipeline.kg_builder - INFO - Using 30 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:19:08,218 - src.pipeline.kg_builder - INFO - Pushing batch 30/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:19:08,219 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:19:08,471 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=305, relationships=253
2025-11-30 21:19:08,471 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:19:08,472 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Glove
2025-11-30 21:19:08,477 - src.components.neo4j_handler - DEBUG - APOC merge successful: Volumetric_Flask -> Glass_Volumetric_Flask
2025-11-30 21:19:08,480 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass_Volumetric_Flask -> Volumetric_Flask
2025-11-30 21:19:08,481 - src.components.neo4j_handler - DEBUG - APOC merge successful: Scientific_Procedure -> Titration
2025-11-30 21:19:08,481 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:19:08,485 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Metal_Spoon
2025-11-30 21:19:08,486 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:19:08,487 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Volumetric_Flask
2025-11-30 21:19:08,489 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Performs]-> Titration
2025-11-30 21:19:08,489 - src.components.neo4j_handler - INFO - Applying 15 inter-chunk relations
2025-11-30 21:19:08,489 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:19:08,490 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Handles]-> Volumetric_Flask
2025-11-30 21:19:08,490 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Volumetric_Flask -[Contains]-> Clear_Liquid
2025-11-30 21:19:08,491 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Observes]-> Background_Person
2025-11-30 21:19:08,519 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Background_Person -[Stands]-> With_Arms_Crossed
2025-11-30 21:19:08,521 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab -[Contains]-> Fire_Extinguisher
2025-11-30 21:19:08,521 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Volumetric_Flask
2025-11-30 21:19:08,522 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Man -[Observes]-> Person
2025-11-30 21:19:08,524 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Man -[Wears]-> Cream_Color_Turtleneck
2025-11-30 21:19:08,526 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab_Room -[Contains]-> Fire_Extinguisher
2025-11-30 21:19:08,527 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Performs]-> Titration
2025-11-30 21:19:08,528 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Glass_Volumetric_Flask
2025-11-30 21:19:08,529 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Observes]-> Scientific_Procedure
2025-11-30 21:19:08,555 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Scientific_Procedure -[Involves]-> Liquid_Transfer
2025-11-30 21:19:08,558 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Gold_Watch
2025-11-30 21:19:08,559 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:19:08,565 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=301, relationships=252
2025-11-30 21:19:08,569 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:19:08,569 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:19:08,569 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:19:08,569 - src.components.neo4j_handler - INFO - Batch injected in 0.35s (triplets: 0.35s, indexes: 0.00s)
2025-11-30 21:19:08,570 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 141, 'with_embedding': 141, 'linked_chunks': 113}
2025-11-30 21:19:08,570 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:19:08,603 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 301 nodes
2025-11-30 21:19:08,699 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 273 nodes
2025-11-30 21:19:08,813 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 301, 'relationship_count': 862, 'density': 0.0095, 'avg_degree': 5.7276, 'avg_unique_neighbors': 5.6611, 'global_efficiency': 0.3264, 'avg_path_length': 2.7448, 'avg_degree_centrality': 0.0191, 'max_degree_centrality': 0.5167, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.021, 'degree_assortativity': -0.1654, 'graph_robustness': 0.8016, 'diameter_estimate': 6, 'clustering_coefficient': 0.2494, 'weakly_connected_components': 29, 'largest_wcc_size': 273, 'pagerank_top10_percent': 10.22, 'louvain_communities': 39, 'louvain_modularity': 0.432, 'label_entropy': 1.4986, 'computational_time': 0.24268383590970188}
2025-11-30 21:19:08,813 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 29, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508748.81334, 'total_time': 23.885301143978722, 'aggregation': 2.6030465960502625e-06, 'network_info': 0.0065419989405199885, 'llm_extraction': 23.284085443010554, 'data_cleaning': 4.237995017319918e-05, 'neo4j_injection': 0.3505270059686154, 'embedding_time': 0, 'indexing_time': 0.003456078004091978, 'graph_injection_time': 0.34674103499855846, 'acs_metrics': {'node_count': 301, 'relationship_count': 862, 'density': 0.0095, 'avg_degree': 5.7276, 'avg_unique_neighbors': 5.6611, 'global_efficiency': 0.3264, 'avg_path_length': 2.7448, 'avg_degree_centrality': 0.0191, 'max_degree_centrality': 0.5167, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.021, 'degree_assortativity': -0.1654, 'graph_robustness': 0.8016, 'diameter_estimate': 6, 'clustering_coefficient': 0.2494, 'weakly_connected_components': 29, 'largest_wcc_size': 273, 'pagerank_top10_percent': 10.22, 'louvain_communities': 39, 'louvain_modularity': 0.432, 'label_entropy': 1.4986, 'computational_time': 0.24268383590970188}, 'retrieval_queries': []}
2025-11-30 21:19:08,813 - src.pipeline.kg_builder - DEBUG - Batch 29 metrics: {
  "batch_idx": 29,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508748.81334,
  "total_time": 23.885301143978722,
  "aggregation": 2.6030465960502625e-06,
  "network_info": 0.0065419989405199885,
  "llm_extraction": 23.284085443010554,
  "data_cleaning": 4.237995017319918e-05,
  "neo4j_injection": 0.3505270059686154,
  "embedding_time": 0,
  "indexing_time": 0.003456078004091978,
  "graph_injection_time": 0.34674103499855846,
  "acs_metrics": {
    "node_count": 301,
    "relationship_count": 862,
    "density": 0.0095,
    "avg_degree": 5.7276,
    "avg_unique_neighbors": 5.6611,
    "global_efficiency": 0.3264,
    "avg_path_length": 2.7448,
    "avg_degree_centrality": 0.0191,
    "max_degree_centrality": 0.5167,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.021,
    "degree_assortativity": -0.1654,
    "graph_robustness": 0.8016,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2494,
    "weakly_connected_components": 29,
    "largest_wcc_size": 273,
    "pagerank_top10_percent": 10.22,
    "louvain_communities": 39,
    "louvain_modularity": 0.432,
    "label_entropy": 1.4986,
    "computational_time": 0.24268383590970188
  },
  "retrieval_queries": []
}
2025-11-30 21:19:08,814 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:19:08,814 - src.pipeline.kg_builder - INFO - Batch 30 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 23.28s, Clean: 0.00s, Neo4j: 0.35s, ACS: 0.24s
2025-11-30 21:19:08,814 - src.pipeline.kg_builder - INFO - Batch 30 completed in 23.89s
Processing KG batches:  42%|████▏     | 30/72 [12:11<17:17, 24.71s/it]2025-11-30 21:19:08,814 - src.pipeline.kg_builder - INFO - Processing batch 31/72 (3 items)
2025-11-30 21:19:08,814 - src.pipeline.kg_builder - DEBUG - Batch 31 current_video_time: 07:38-07:43
2025-11-30 21:19:08,821 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 301
- Total Relationships: 252
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:19:08,821 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:19:08,821 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_0 ~233 words, content: Time: 07:28-07:33 Content: The video captures a scene in a laboratory where a person is performing a precise liquid measurement. The sequence of frames shows...
2025-11-30 21:19:08,821 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_1 ~229 words, content: the frame, observing the procedure. The overall context suggests that the person is preparing a solution of a specific concentration, a common task in chemistry...
2025-11-30 21:19:08,821 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_2 ~225 words, content: and the person is seen adjusting the settings on the device. This suggests that the next step in the experiment involves mixing the contents of...
2025-11-30 21:19:08,821 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_3 ~227 words, content: rile glove is holding a round-bottom flask, which is a type of laboratory glassware. The flask contains a clear liquid and is connected to a...
2025-11-30 21:19:08,821 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_4 ~53 words, content: person is now holding a different piece of glassware, possibly a pipette or a burette, and is preparing to use it. The scene suggests that...
2025-11-30 21:19:08,841 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:19:08,910 - src.components.pre_llm_injector - DEBUG - Found 141 existing chunk embeddings for similarity lookup
2025-11-30 21:19:08,948 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_0', '0.791'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_3', '0.783')]
2025-11-30 21:19:08,950 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_0
2025-11-30 21:19:08,950 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:19:08,951 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_3
2025-11-30 21:19:08,951 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:19:08,964 - src.components.pre_llm_injector - DEBUG - Limited Person from 79 to 2 external connections
2025-11-30 21:19:08,964 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 79 total -> 2 (internal: 0, external: 2)
2025-11-30 21:19:08,964 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[PLACES]->(Aluminum Foil / ID: 3_2), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2)
2025-11-30 21:19:08,964 - src.components.pre_llm_injector - DEBUG - Limited Person from 79 to 2 external connections
2025-11-30 21:19:08,964 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 79 total -> 2 (internal: 0, external: 2)
2025-11-30 21:19:08,964 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[REMOVES]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2)
2025-11-30 21:19:08,965 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_0', '0.791'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_4', '0.778')]
2025-11-30 21:19:08,965 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_1', '0.763'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.750')]
2025-11-30 21:19:08,965 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_0', '0.762'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_4', '0.754')]
2025-11-30 21:19:08,965 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_3', '0.783'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_0', '0.664')]
2025-11-30 21:19:08,965 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_3', '0.765'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_3', '0.756')]
2025-11-30 21:19:08,965 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:19:08,965 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_0) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:19:10,380 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:19:10,380 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:19:10,381 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_1) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:19:11,885 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:19:11,885 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:19:11,885 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_2) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:19:13,088 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:19:13,088 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:19:13,088 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_3) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:19:14,737 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:19:14,737 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:19:14,738 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_4) (~53 words) with timeout=5.0s retries=3
2025-11-30 21:19:15,708 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:19:15,708 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:19:15,708 - src.components.pre_llm_injector - INFO - Extracted 28 local triplets from 5 chunks
2025-11-30 21:19:15,708 - src.pipeline.kg_builder - INFO - Pre-extraction: 28 triplets in 6.89s
2025-11-30 21:19:15,709 - src.components.global_refiner - INFO - Capping refinement input: 28 → 15 triplets
2025-11-30 21:19:15,709 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[PLACES]->(Aluminum Foil / ID: 3_2), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[REMOVES]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["30_0", "30_1"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["30_0"]}, {"head": "Person", "relation": "Performs", "tail": "Liquid_Measurement", "source_chunks": ["30_0"]}, {"head": "Volumetric_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["30_0"]}, {"head": "Person", "relation": "Checks", "tail": "Meniscus", "source_chunks": ["30_0"]}, {"head": "Person", "relation": "Looks At", "tail": "Meniscus", "source_chunks": ["30_0"]}, {"head": "Person", "relation": "Holds", "tail": "Round_Bottom_Flask", "source_chunks": ["30_1", "30_2"]}, {"head": "Round_Bottom_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["30_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["30_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["30_1"]}, {"head": "Round_Bottom_Flask", "relation": "Is Placed On", "tail": "Magnetic_Stirrer", "source_chunks": ["30_1"]}, {"head": "Person", "relation": "Wears", "tail": "Lab Coat", "source_chunks": ["30_2"]}, {"head": "Person", "relation": "Wears", "tail": "Gloves", "source_chunks": ["30_2"]}, {"head": "Round_Bottom_Flask", "relation": "Is On", "tail": "Magnetic_Stirrer", "source_chunks": ["30_2"]}, {"head": "Person", "relation": "Adjusts", "tail": "Device", "source_chunks": ["30_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:19:15,709 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~338 words, ~439 tokens)
2025-11-30 21:19:15,709 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:19:32,252 - src.components.global_refiner - DEBUG - LLM call completed in 16.54s
2025-11-30 21:19:32,252 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['30_0', '30_1']], ['Person', 'Holds', 'Volumetric_Flask', ['30_0']], ['Person', 'Performs', 'Liquid_Measurement', ['30_0']], ['Volumetric_Flask', 'Contains', 'Clear_Liquid', ['30_0']], ['Person', 'Checks', 'Meniscus', ['30_0']], ['Person', 'Looks At', 'Meniscus', ['30_0']], ['Person', 'Holds', 'Round_Bottom_Flask', ['30_1', '30_2']], ['Round_Bottom_Flask', 'Contains', 'Clear_Liquid', ['30_1']], ['Person', 'Uses', 'Pipette', ['30_1']], ['Pipette', 'Transfers', 'Liquid', ['30_1']], ['Round_Bottom_Flask', 'Is Placed On', 'Magnetic_Stirrer', ['30_1']], ['Person', 'Wears', 'Lab Coat', ['30_2']], ['Person', 'Wears', 'Gloves', ['30_2']], ['Round_Bottom_Flask', 'Is On', 'Magnetic_Stirrer', ['30_2']], ['Person', 'Adjusts', 'Device', ['30_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['30_0', '30_1']], ['Person', 'Holds', 'Volumetric_Flask', ['30_0']], ['Person', 'Performs', 'Liquid_Measurement', ['30_0']], ['Volumetric_Flask', 'Contains', 'Clear_Liquid', ['30_0']], ['Person', 'Checks', 'Meniscus', ['30_0']], ['Person', 'Looks At', 'Meniscus', ['30_0']], ['Person', 'Holds', 'Round_Bottom_Flask', ['30_1', '30_2']], ['Round_Bottom_Flask', 'Contains', 'Clear_Liquid', ['30_1']], ['Person', 'Uses', 'Pipette', ['30_1']], ['Pipette', 'Transfers', 'Liquid', ['30_1']], ['Round_Bottom_Flask', 'Is Placed On', 'Magnetic_Stirrer', ['30_1']], ['Person', 'Wears', 'Lab Coat', ['30_2']], ['Person', 'Wears', 'Gloves', ['30_2']], ['Round_Bottom_Flask', 'Is On', 'Magnetic_Stirrer', ['30_2']], ['Person', 'Adjusts', 'Device', ['30_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_3'}, {'local': 'Lab Coat', 'existing': 'Lab Coat', 'existing_id': '0_4'}, {'local': 'Gloves', 'existing': 'Gloves', 'existing_id': '0_5'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}]
2025-11-30 21:19:32,252 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['30_0', '30_1']], ['Person', 'Holds', 'Volumetric_Flask', ['30_0']], ['Person', 'Performs', 'Liquid_Measurement', ['30_0']]]
2025-11-30 21:19:32,252 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['30_0', '30_1']], ['Person', 'Holds', 'Volumetric_Flask', ['30_0']], ['Person', 'Performs', 'Liquid_Measurement', ['30_0']]]
2025-11-30 21:19:32,252 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=3, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_3'}, {'local': 'Lab Coat', 'existing': 'Lab Coat', 'existing_id': '0_4'}, {'local': 'Gloves', 'existing': 'Gloves', 'existing_id': '0_5'}]
2025-11-30 21:19:32,252 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=1, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}]
2025-11-30 21:19:32,252 - src.components.global_refiner - INFO - LLM suggested 3 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_3'}, {'local': 'Lab Coat', 'existing': 'Lab Coat', 'existing_id': '0_4'}, {'local': 'Gloves', 'existing': 'Gloves', 'existing_id': '0_5'}]
2025-11-30 21:19:32,252 - src.components.global_refiner - INFO - LLM suggested 1 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}]
2025-11-30 21:19:32,252 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 30 triplets (total: 16.54s, LLM: 16.54s)
2025-11-30 21:19:32,252 - src.pipeline.kg_builder - INFO - Global refinement: 30 triplets in 16.54s
2025-11-30 21:19:32,252 - src.pipeline.kg_builder - INFO - Using 30 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:19:32,252 - src.pipeline.kg_builder - INFO - Pushing batch 31/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:19:32,252 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:19:32,433 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=314, relationships=266
2025-11-30 21:19:32,433 - src.components.neo4j_handler - INFO - Applying 3 merge instructions
2025-11-30 21:19:32,433 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue_Nitrile_Gloves -> Blue_Nitrile_Gloves
2025-11-30 21:19:32,433 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Lab Coat -> Lab Coat
2025-11-30 21:19:32,433 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Gloves -> Gloves
2025-11-30 21:19:32,433 - src.components.neo4j_handler - INFO - Applying 1 prune instructions
2025-11-30 21:19:32,435 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> No Glove
2025-11-30 21:19:32,435 - src.components.neo4j_handler - INFO - Applying 15 inter-chunk relations
2025-11-30 21:19:32,437 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:19:32,439 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Volumetric_Flask
2025-11-30 21:19:32,441 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Performs]-> Liquid_Measurement
2025-11-30 21:19:32,443 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Volumetric_Flask -[Contains]-> Clear_Liquid
2025-11-30 21:19:32,445 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Checks]-> Meniscus
2025-11-30 21:19:32,447 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Looks At]-> Meniscus
2025-11-30 21:19:32,448 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Round_Bottom_Flask
2025-11-30 21:19:32,450 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Round_Bottom_Flask -[Contains]-> Clear_Liquid
2025-11-30 21:19:32,451 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> Pipette
2025-11-30 21:19:32,453 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Pipette -[Transfers]-> Liquid
2025-11-30 21:19:32,455 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Round_Bottom_Flask -[Is Placed On]-> Magnetic_Stirrer
2025-11-30 21:19:32,456 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Lab Coat
2025-11-30 21:19:32,458 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Gloves
2025-11-30 21:19:32,460 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Round_Bottom_Flask -[Is On]-> Magnetic_Stirrer
2025-11-30 21:19:32,461 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Adjusts]-> Device
2025-11-30 21:19:32,462 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:19:32,469 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=314, relationships=266
2025-11-30 21:19:32,472 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:19:32,472 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:19:32,472 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:19:32,472 - src.components.neo4j_handler - INFO - Batch injected in 0.22s (triplets: 0.22s, indexes: 0.00s)
2025-11-30 21:19:32,473 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 146, 'with_embedding': 146, 'linked_chunks': 116}
2025-11-30 21:19:32,473 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:19:32,508 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 314 nodes
2025-11-30 21:19:32,610 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 284 nodes
2025-11-30 21:19:32,728 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 314, 'relationship_count': 893, 'density': 0.0091, 'avg_degree': 5.6879, 'avg_unique_neighbors': 5.6242, 'global_efficiency': 0.3269, 'avg_path_length': 2.7198, 'avg_degree_centrality': 0.0182, 'max_degree_centrality': 0.5304, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0397, 'degree_assortativity': -0.1928, 'graph_robustness': 0.8052, 'diameter_estimate': 6, 'clustering_coefficient': 0.2509, 'weakly_connected_components': 31, 'largest_wcc_size': 284, 'pagerank_top10_percent': 9.81, 'louvain_communities': 38, 'louvain_modularity': 0.4384, 'label_entropy': 1.4982, 'computational_time': 0.2547908879350871}
2025-11-30 21:19:32,728 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 30, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508772.728946, 'total_time': 23.91468117001932, 'aggregation': 4.166038706898689e-06, 'network_info': 0.006720258970744908, 'llm_extraction': 23.43161006399896, 'data_cleaning': 2.1539977751672268e-05, 'neo4j_injection': 0.21976983302738518, 'embedding_time': 0, 'indexing_time': 0.002850507036782801, 'graph_injection_time': 0.21675383998081088, 'acs_metrics': {'node_count': 314, 'relationship_count': 893, 'density': 0.0091, 'avg_degree': 5.6879, 'avg_unique_neighbors': 5.6242, 'global_efficiency': 0.3269, 'avg_path_length': 2.7198, 'avg_degree_centrality': 0.0182, 'max_degree_centrality': 0.5304, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0397, 'degree_assortativity': -0.1928, 'graph_robustness': 0.8052, 'diameter_estimate': 6, 'clustering_coefficient': 0.2509, 'weakly_connected_components': 31, 'largest_wcc_size': 284, 'pagerank_top10_percent': 9.81, 'louvain_communities': 38, 'louvain_modularity': 0.4384, 'label_entropy': 1.4982, 'computational_time': 0.2547908879350871}, 'retrieval_queries': []}
2025-11-30 21:19:32,729 - src.pipeline.kg_builder - DEBUG - Batch 30 metrics: {
  "batch_idx": 30,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508772.728946,
  "total_time": 23.91468117001932,
  "aggregation": 4.166038706898689e-06,
  "network_info": 0.006720258970744908,
  "llm_extraction": 23.43161006399896,
  "data_cleaning": 2.1539977751672268e-05,
  "neo4j_injection": 0.21976983302738518,
  "embedding_time": 0,
  "indexing_time": 0.002850507036782801,
  "graph_injection_time": 0.21675383998081088,
  "acs_metrics": {
    "node_count": 314,
    "relationship_count": 893,
    "density": 0.0091,
    "avg_degree": 5.6879,
    "avg_unique_neighbors": 5.6242,
    "global_efficiency": 0.3269,
    "avg_path_length": 2.7198,
    "avg_degree_centrality": 0.0182,
    "max_degree_centrality": 0.5304,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0397,
    "degree_assortativity": -0.1928,
    "graph_robustness": 0.8052,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2509,
    "weakly_connected_components": 31,
    "largest_wcc_size": 284,
    "pagerank_top10_percent": 9.81,
    "louvain_communities": 38,
    "louvain_modularity": 0.4384,
    "label_entropy": 1.4982,
    "computational_time": 0.2547908879350871
  },
  "retrieval_queries": []
}
2025-11-30 21:19:32,729 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:19:32,729 - src.pipeline.kg_builder - INFO - Batch 31 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 23.43s, Clean: 0.00s, Neo4j: 0.22s, ACS: 0.26s
2025-11-30 21:19:32,729 - src.pipeline.kg_builder - INFO - Batch 31 completed in 23.91s
Processing KG batches:  43%|████▎     | 31/72 [12:35<16:43, 24.47s/it]2025-11-30 21:19:32,729 - src.pipeline.kg_builder - INFO - Processing batch 32/72 (3 items)
2025-11-30 21:19:32,729 - src.pipeline.kg_builder - DEBUG - Batch 32 current_video_time: 07:53-07:58
2025-11-30 21:19:32,738 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 314
- Total Relationships: 266
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:19:32,738 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:19:32,738 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_31_0 ~235 words, content: Time: 07:43-07:48 Content: The video sequence captures a series of actions within a laboratory setting, focusing on a person conducting an experiment or a procedure....
2025-11-30 21:19:32,738 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_31_1 ~235 words, content: involved in the experiment. The background shows a white cabinet with shelves containing various items, and a fire extinguisher is mounted on the wall, emphasizing...
2025-11-30 21:19:32,738 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_31_2 ~227 words, content: precision analytical balance, identified by the "METTLER TOLEDO" brand name. The process unfolds as follows: - **Initial Setup:** The person prepares a small piece of...
2025-11-30 21:19:32,738 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_31_3 ~226 words, content: , indicating adherence to safety protocols. The overall scene depicts a careful and methodical scientific procedure. Time: 07:53-07:58 Content: The sequence of frames captures a...
2025-11-30 21:19:32,738 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_31_4 ~143 words, content: .300 g`, which is a very slight change, suggesting the foil's weight is minimal. The person then opens the glass door of the balance again,...
2025-11-30 21:19:32,759 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:19:32,824 - src.components.pre_llm_injector - DEBUG - Found 146 existing chunk embeddings for similarity lookup
2025-11-30 21:19:32,863 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_6', '0.786'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.782')]
2025-11-30 21:19:32,865 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_6 via source_chunk_ids
2025-11-30 21:19:32,865 - src.components.pre_llm_injector - DEBUG - Found 6 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2
2025-11-30 21:19:32,865 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:19:32,873 - src.components.pre_llm_injector - DEBUG - Limited Person from 87 to 2 external connections
2025-11-30 21:19:32,873 - src.components.pre_llm_injector - DEBUG - Limited Laboratory from 4 to 2 external connections
2025-11-30 21:19:32,873 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 93 total -> 6 (internal: 1, external: 5)
2025-11-30 21:19:32,873 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[WEARS]->(Gloves / ID: 30_2), (Person / ID: 0_0)-[ADDS]->(Liquid / ID: 23_0), (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Glassware / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance Scale / ID: 3_1)
2025-11-30 21:19:32,873 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.647'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.634')]
2025-11-30 21:19:32,873 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_0', '0.567'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_2', '0.557')]
2025-11-30 21:19:32,873 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_6', '0.576'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.564')]
2025-11-30 21:19:32,873 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_3', '0.620'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.613')]
2025-11-30 21:19:32,873 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_6', '0.786'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.782')]
2025-11-30 21:19:32,873 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:19:32,874 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_31_0) (~235 words) with timeout=5.0s retries=3
2025-11-30 21:19:34,247 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:19:34,247 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:19:34,247 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_31_1) (~235 words) with timeout=5.0s retries=3
2025-11-30 21:19:35,415 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:19:35,415 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:19:35,416 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_31_2) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:19:36,987 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:19:36,987 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:19:36,987 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_31_3) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:19:38,361 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:19:38,362 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:19:38,362 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_31_4) (~143 words) with timeout=5.0s retries=3
2025-11-30 21:19:39,630 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:19:39,630 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:19:39,630 - src.components.pre_llm_injector - INFO - Extracted 29 local triplets from 5 chunks
2025-11-30 21:19:39,630 - src.pipeline.kg_builder - INFO - Pre-extraction: 29 triplets in 6.89s
2025-11-30 21:19:39,630 - src.components.global_refiner - INFO - Capping refinement input: 29 → 15 triplets
2025-11-30 21:19:39,631 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[WEARS]->(Gloves / ID: 30_2), (Person / ID: 0_0)-[ADDS]->(Liquid / ID: 23_0), (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Glassware / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance Scale / ID: 3_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["31_0"]}, {"head": "Person", "relation": "Handles", "tail": "Small Container", "source_chunks": ["31_0"]}, {"head": "Digital Scale", "relation": "Displays", "tail": "-5630.1", "source_chunks": ["31_0"]}, {"head": "Digital Scale", "relation": "Is On", "tail": "Black Countertop", "source_chunks": ["31_0"]}, {"head": "Person", "relation": "Has Hand On", "tail": "Digital Scale", "source_chunks": ["31_0"]}, {"head": "Digital Scale", "relation": "Is Near", "tail": "Bottle With Red Cap", "source_chunks": ["31_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["31_1"]}, {"head": "Person", "relation": "Uses", "tail": "Analytical Balance", "source_chunks": ["31_1", "31_4"]}, {"head": "Analytical Balance", "relation": "Has Brand", "tail": "Mettler Toledo", "source_chunks": ["31_1"]}, {"head": "Person", "relation": "Handles", "tail": "Aluminum Foil", "source_chunks": ["31_1"]}, {"head": "Lab", "relation": "Contains", "tail": "Fire Extinguisher", "source_chunks": ["31_1"]}, {"head": "Lab", "relation": "Contains", "tail": "White Cabinet", "source_chunks": ["31_1"]}, {"head": "Person", "relation": "Places", "tail": "Aluminum Foil", "source_chunks": ["31_2"]}, {"head": "Aluminum Foil", "relation": "Is Inside", "tail": "Weighing Chamber", "source_chunks": ["31_2"]}, {"head": "Weighing Chamber", "relation": "Has", "tail": "Precision Analytical Balance", "source_chunks": ["31_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:19:39,631 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~373 words, ~485 tokens)
2025-11-30 21:19:39,631 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:19:55,515 - src.components.global_refiner - DEBUG - LLM call completed in 15.88s
2025-11-30 21:19:55,515 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue Gloves', ['31_0']], ['Person', 'Handles', 'Small Container', ['31_0']], ['Digital Scale', 'Displays', '-5630.1', ['31_0']], ['Digital Scale', 'Is On', 'Black Countertop', ['31_0']], ['Person', 'Has Hand On', 'Digital Scale', ['31_0']], ['Digital Scale', 'Is Near', 'Bottle With Red Cap', ['31_0']], ['Person', 'Wears', 'Blue Glove', ['31_1']], ['Person', 'Uses', 'Analytical Balance', ['31_1', '31_4']], ['Analytical Balance', 'Has Brand', 'Mettler Toledo', ['31_1']], ['Person', 'Handles', 'Aluminum Foil', ['31_1']], ['Lab', 'Contains', 'Fire Extinguisher', ['31_1']], ['Lab', 'Contains', 'White Cabinet', ['31_1']], ['Person', 'Places', 'Aluminum Foil', ['31_2']], ['Aluminum Foil', 'Is Inside', 'Weighing Chamber', ['31_2']], ['Weighing Chamber', 'Has', 'Precision Analytical Balance', ['31_2']]] inter_chunk_relations=[['Digital Scale', 'Is On', 'Black Countertop', ['31_0']], ['Person', 'Has Hand On', 'Digital Scale', ['31_0']], ['Digital Scale', 'Is Near', 'Bottle With Red Cap', ['31_0']], ['Person', 'Uses', 'Analytical Balance', ['31_1', '31_4']], ['Analytical Balance', 'Has Brand', 'Mettler Toledo', ['31_1']], ['Person', 'Handles', 'Aluminum Foil', ['31_1']], ['Lab', 'Contains', 'Fire Extinguisher', ['31_1']], ['Lab', 'Contains', 'White Cabinet', ['31_1']], ['Person', 'Places', 'Aluminum Foil', ['31_2']], ['Aluminum Foil', 'Is Inside', 'Weighing Chamber', ['31_2']], ['Weighing Chamber', 'Has', 'Precision Analytical Balance', ['31_2']]] merge_instructions=[{'local': 'Blue Gloves', 'existing': 'Gloves', 'existing_id': '30_2'}, {'local': 'Blue Glove', 'existing': 'Gloves', 'existing_id': '30_2'}, {'local': 'Analytical Balance', 'existing': 'Balance Scale', 'existing_id': '3_1'}, {'local': 'Precision Analytical Balance', 'existing': 'Balance Scale', 'existing_id': '3_1'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}]
2025-11-30 21:19:55,515 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue Gloves', ['31_0']], ['Person', 'Handles', 'Small Container', ['31_0']], ['Digital Scale', 'Displays', '-5630.1', ['31_0']]]
2025-11-30 21:19:55,516 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=11, sample=[['Digital Scale', 'Is On', 'Black Countertop', ['31_0']], ['Person', 'Has Hand On', 'Digital Scale', ['31_0']], ['Digital Scale', 'Is Near', 'Bottle With Red Cap', ['31_0']]]
2025-11-30 21:19:55,516 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue Gloves', 'existing': 'Gloves', 'existing_id': '30_2'}, {'local': 'Blue Glove', 'existing': 'Gloves', 'existing_id': '30_2'}, {'local': 'Analytical Balance', 'existing': 'Balance Scale', 'existing_id': '3_1'}]
2025-11-30 21:19:55,516 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}]
2025-11-30 21:19:55,516 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue Gloves', 'existing': 'Gloves', 'existing_id': '30_2'}, {'local': 'Blue Glove', 'existing': 'Gloves', 'existing_id': '30_2'}, {'local': 'Analytical Balance', 'existing': 'Balance Scale', 'existing_id': '3_1'}, {'local': 'Precision Analytical Balance', 'existing': 'Balance Scale', 'existing_id': '3_1'}]
2025-11-30 21:19:55,516 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}]
2025-11-30 21:19:55,516 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 26 triplets (total: 15.89s, LLM: 15.88s)
2025-11-30 21:19:55,516 - src.pipeline.kg_builder - INFO - Global refinement: 26 triplets in 15.89s
2025-11-30 21:19:55,516 - src.pipeline.kg_builder - INFO - Using 26 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:19:55,516 - src.pipeline.kg_builder - INFO - Pushing batch 32/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:19:55,516 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:19:55,701 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=330, relationships=277
2025-11-30 21:19:55,701 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:19:55,702 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue Gloves -> Gloves
2025-11-30 21:19:55,706 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue Glove -> Gloves
2025-11-30 21:19:55,709 - src.components.neo4j_handler - DEBUG - APOC merge successful: Analytical Balance -> Balance Scale
2025-11-30 21:19:55,712 - src.components.neo4j_handler - DEBUG - APOC merge successful: Precision Analytical Balance -> Balance Scale
2025-11-30 21:19:55,712 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:19:55,716 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Gloves
2025-11-30 21:19:55,717 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue Gloves
2025-11-30 21:19:55,717 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue Glove
2025-11-30 21:19:55,718 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> No Glove
2025-11-30 21:19:55,718 - src.components.neo4j_handler - INFO - Applying 11 inter-chunk relations
2025-11-30 21:19:55,719 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital Scale -[Is On]-> Black Countertop
2025-11-30 21:19:55,752 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Has Hand On]-> Digital Scale
2025-11-30 21:19:55,754 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital Scale -[Is Near]-> Bottle With Red Cap
2025-11-30 21:19:55,754 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Uses]-> Analytical Balance
2025-11-30 21:19:55,780 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Analytical Balance -[Has Brand]-> Mettler Toledo
2025-11-30 21:19:55,782 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Handles]-> Aluminum Foil
2025-11-30 21:19:55,783 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab -[Contains]-> Fire Extinguisher
2025-11-30 21:19:55,785 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab -[Contains]-> White Cabinet
2025-11-30 21:19:55,786 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Places]-> Aluminum Foil
2025-11-30 21:19:55,787 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Aluminum Foil -[Is Inside]-> Weighing Chamber
2025-11-30 21:19:55,788 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Weighing Chamber -[Has]-> Precision Analytical Balance
2025-11-30 21:19:55,788 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:19:55,794 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=326, relationships=274
2025-11-30 21:19:55,795 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:19:55,795 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:19:55,795 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:19:55,795 - src.components.neo4j_handler - INFO - Batch injected in 0.28s (triplets: 0.28s, indexes: 0.00s)
2025-11-30 21:19:55,796 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 151, 'with_embedding': 151, 'linked_chunks': 120}
2025-11-30 21:19:55,796 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:19:55,833 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 326 nodes
2025-11-30 21:19:55,943 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 295 nodes
2025-11-30 21:19:56,073 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 326, 'relationship_count': 923, 'density': 0.0087, 'avg_degree': 5.6626, 'avg_unique_neighbors': 5.6012, 'global_efficiency': 0.3252, 'avg_path_length': 2.736, 'avg_degree_centrality': 0.0174, 'max_degree_centrality': 0.5262, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0228, 'degree_assortativity': -0.1823, 'graph_robustness': 0.8581, 'diameter_estimate': 6, 'clustering_coefficient': 0.2539, 'weakly_connected_components': 32, 'largest_wcc_size': 295, 'pagerank_top10_percent': 9.68, 'louvain_communities': 39, 'louvain_modularity': 0.4371, 'label_entropy': 1.498, 'computational_time': 0.2771324060158804}
2025-11-30 21:19:56,073 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 31, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508796.0737407, 'total_time': 23.343806613003835, 'aggregation': 3.1410017982125282e-06, 'network_info': 0.008115622098557651, 'llm_extraction': 22.778230440919288, 'data_cleaning': 4.082405939698219e-05, 'neo4j_injection': 0.27893466292880476, 'embedding_time': 0, 'indexing_time': 0.001169760012999177, 'graph_injection_time': 0.27742527809459716, 'acs_metrics': {'node_count': 326, 'relationship_count': 923, 'density': 0.0087, 'avg_degree': 5.6626, 'avg_unique_neighbors': 5.6012, 'global_efficiency': 0.3252, 'avg_path_length': 2.736, 'avg_degree_centrality': 0.0174, 'max_degree_centrality': 0.5262, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0228, 'degree_assortativity': -0.1823, 'graph_robustness': 0.8581, 'diameter_estimate': 6, 'clustering_coefficient': 0.2539, 'weakly_connected_components': 32, 'largest_wcc_size': 295, 'pagerank_top10_percent': 9.68, 'louvain_communities': 39, 'louvain_modularity': 0.4371, 'label_entropy': 1.498, 'computational_time': 0.2771324060158804}, 'retrieval_queries': []}
2025-11-30 21:19:56,073 - src.pipeline.kg_builder - DEBUG - Batch 31 metrics: {
  "batch_idx": 31,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508796.0737407,
  "total_time": 23.343806613003835,
  "aggregation": 3.1410017982125282e-06,
  "network_info": 0.008115622098557651,
  "llm_extraction": 22.778230440919288,
  "data_cleaning": 4.082405939698219e-05,
  "neo4j_injection": 0.27893466292880476,
  "embedding_time": 0,
  "indexing_time": 0.001169760012999177,
  "graph_injection_time": 0.27742527809459716,
  "acs_metrics": {
    "node_count": 326,
    "relationship_count": 923,
    "density": 0.0087,
    "avg_degree": 5.6626,
    "avg_unique_neighbors": 5.6012,
    "global_efficiency": 0.3252,
    "avg_path_length": 2.736,
    "avg_degree_centrality": 0.0174,
    "max_degree_centrality": 0.5262,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0228,
    "degree_assortativity": -0.1823,
    "graph_robustness": 0.8581,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2539,
    "weakly_connected_components": 32,
    "largest_wcc_size": 295,
    "pagerank_top10_percent": 9.68,
    "louvain_communities": 39,
    "louvain_modularity": 0.4371,
    "label_entropy": 1.498,
    "computational_time": 0.2771324060158804
  },
  "retrieval_queries": []
}
2025-11-30 21:19:56,074 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:19:56,074 - src.pipeline.kg_builder - INFO - Batch 32 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 22.78s, Clean: 0.00s, Neo4j: 0.28s, ACS: 0.28s
2025-11-30 21:19:56,074 - src.pipeline.kg_builder - INFO - Batch 32 completed in 23.34s
Processing KG batches:  44%|████▍     | 32/72 [12:59<16:05, 24.13s/it]2025-11-30 21:19:56,074 - src.pipeline.kg_builder - INFO - Processing batch 33/72 (3 items)
2025-11-30 21:19:56,074 - src.pipeline.kg_builder - DEBUG - Batch 33 current_video_time: 08:08-08:13
2025-11-30 21:19:56,080 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 326
- Total Relationships: 274
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:19:56,081 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:19:56,081 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_32_0 ~212 words, content: Time: 07:58-08:03 Content: The video sequence captures a scientific procedure, likely a chemical experiment, being conducted in a laboratory setting. The perspective is first-person, showing...
2025-11-30 21:19:56,081 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_32_1 ~226 words, content: positive weight, indicating the mass of the substance that was added to the beaker. The final reading on the display is $0.191$ grams, which is...
2025-11-30 21:19:56,081 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_32_2 ~238 words, content: the measurement. The person then carefully places a small, circular piece of aluminum foil onto the weighing pan. After closing the draft shield, the balance's...
2025-11-30 21:19:56,081 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_32_3 ~232 words, content: precise measurement in a laboratory setting. The scene is set on a black laboratory bench, with various pieces of equipment and materials arranged around the...
2025-11-30 21:19:56,081 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_32_4 ~84 words, content: the bench. This suggests the next step in the procedure might involve using the foil, perhaps to cover the sample or to prepare for the...
2025-11-30 21:19:56,101 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:19:56,172 - src.components.pre_llm_injector - DEBUG - Found 151 existing chunk embeddings for similarity lookup
2025-11-30 21:19:56,212 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_0', '0.786'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_1', '0.783')]
2025-11-30 21:19:56,214 - src.components.pre_llm_injector - DEBUG - Found 5 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_0
2025-11-30 21:19:56,214 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:19:56,214 - src.components.pre_llm_injector - DEBUG - Found 4 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_1
2025-11-30 21:19:56,214 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:19:56,230 - src.components.pre_llm_injector - DEBUG - Limited Person from 86 to 2 external connections
2025-11-30 21:19:56,230 - src.components.pre_llm_injector - DEBUG - Limited Balance_Scale from 4 to 2 external connections
2025-11-30 21:19:56,230 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 94 total -> 8 (internal: 2, external: 6)
2025-11-30 21:19:56,230 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[CLOSES]->(Container / ID: 4_1), (Person / ID: 0_0)-[HOLDS]->(Glass_Rod / ID: 4_1), (Person / ID: 0_0)-[HAS_HAND_ON]->(Digital Scale / ID: 31_0), (Person / ID: 0_0)-[FILLS_OUT]->(Chemistry Experiment Report / ID: 2_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance_Scale / ID: 0_1), (Balance_Scale / ID: 0_1)-[IS_INSIDE]->(Glass_Draft_Shield / ID: 7_0), (Glass_Rod / ID: 4_1)-[STIRS]->(Liquid_In_Small_Container / ID: 5_0), (Glass_Rod / ID: 4_1)-[IS_USED_TO_STIR]->(Mass Of Liquid / ID: 15_1)
2025-11-30 21:19:56,231 - src.components.pre_llm_injector - DEBUG - Limited Person from 86 to 2 external connections
2025-11-30 21:19:56,231 - src.components.pre_llm_injector - DEBUG - Limited Magnetic_Stirrer from 8 to 2 external connections
2025-11-30 21:19:56,231 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 98 total -> 8 (internal: 3, external: 5)
2025-11-30 21:19:56,231 - src.components.pre_llm_injector - DEBUG - Subgraph: (Laboratory_Bench / ID: 13_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[WEARS]->(Nitrile_Gloves / ID: 13_0), (Person / ID: 0_0)-[WEARS]->(Nitrile_Gloves / ID: 13_0), (Person / ID: 0_0)-[HAS_HAND_ON]->(Digital Scale / ID: 31_0), (Person / ID: 0_0)-[WEARS]->(Lab Coat / ID: 30_2), (Magnetic_Stirrer / ID: 4_2)-[ROTATES]->(Magnetic_Stir_Bar / ID: 5_0), (Round_Bottom_Flask / ID: 30_1)-[IS_ON]->(Magnetic_Stirrer / ID: 4_2), (Balance Scale / ID: 3_1)-[DISPLAYS]->(Negative_Weight_Reading / ID: 13_0)
2025-11-30 21:19:56,231 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_0', '0.786'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_1', '0.783')]
2025-11-30 21:19:56,231 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_2', '0.655'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_1', '0.637')]
2025-11-30 21:19:56,231 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_2', '0.711'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.689')]
2025-11-30 21:19:56,231 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_1', '0.574'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_2', '0.554')]
2025-11-30 21:19:56,231 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3', '0.779'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_15_2', '0.772')]
2025-11-30 21:19:56,231 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:19:56,231 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_32_0) (~212 words) with timeout=5.0s retries=3
2025-11-30 21:19:57,489 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:19:57,489 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:19:57,489 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_32_1) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:19:58,827 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:19:58,828 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:19:58,828 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_32_2) (~238 words) with timeout=5.0s retries=3
2025-11-30 21:20:00,024 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:20:00,024 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:20:00,025 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_32_3) (~232 words) with timeout=5.0s retries=3
2025-11-30 21:20:01,333 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:20:01,334 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:20:01,334 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_32_4) (~84 words) with timeout=5.0s retries=3
2025-11-30 21:20:02,706 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:20:02,707 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:20:02,707 - src.components.pre_llm_injector - INFO - Extracted 27 local triplets from 5 chunks
2025-11-30 21:20:02,707 - src.pipeline.kg_builder - INFO - Pre-extraction: 27 triplets in 6.63s
2025-11-30 21:20:02,707 - src.components.global_refiner - INFO - Capping refinement input: 27 → 15 triplets
2025-11-30 21:20:02,708 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[CLOSES]->(Container / ID: 4_1), (Person / ID: 0_0)-[HOLDS]->(Glass_Rod / ID: 4_1), (Person / ID: 0_0)-[HAS_HAND_ON]->(Digital Scale / ID: 31_0), (Person / ID: 0_0)-[FILLS_OUT]->(Chemistry Experiment Report / ID: 2_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance_Scale / ID: 0_1), (Balance_Scale / ID: 0_1)-[IS_INSIDE]->(Glass_Draft_Shield / ID: 7_0), (Glass_Rod / ID: 4_1)-[STIRS]->(Liquid_In_Small_Container / ID: 5_0), (Glass_Rod / ID: 4_1)-[IS_USED_TO_STIR]->(Mass Of Liquid / ID: 15_1)
Subgraph_2: Subgraph: (Laboratory_Bench / ID: 13_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[WEARS]->(Nitrile_Gloves / ID: 13_0), (Person / ID: 0_0)-[WEARS]->(Nitrile_Gloves / ID: 13_0), (Person / ID: 0_0)-[HAS_HAND_ON]->(Digital Scale / ID: 31_0), (Person / ID: 0_0)-[WEARS]->(Lab Coat / ID: 30_2), (Magnetic_Stirrer / ID: 4_2)-[ROTATES]->(Magnetic_Stir_Bar / ID: 5_0), (Round_Bottom_Flask / ID: 30_1)-[IS_ON]->(Magnetic_Stirrer / ID: 4_2), (Balance Scale / ID: 3_1)-[DISPLAYS]->(Negative_Weight_Reading / ID: 13_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Researcher", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["32_0"]}, {"head": "Researcher", "relation": "Opens", "tail": "Glass Draft Shield", "source_chunks": ["32_0"]}, {"head": "Researcher", "relation": "Places", "tail": "Beaker", "source_chunks": ["32_0"]}, {"head": "Beaker", "relation": "Is On", "tail": "Analytical Balance", "source_chunks": ["32_0"]}, {"head": "Researcher", "relation": "Adds", "tail": "White Powder", "source_chunks": ["32_0"]}, {"head": "Analytical Balance", "relation": "Displays", "tail": "Weight Reading", "source_chunks": ["32_0"]}, {"head": "Analytical Balance", "relation": "Displays", "tail": "0.191 Grams", "source_chunks": ["32_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Glove", "source_chunks": ["32_1", "32_3"]}, {"head": "Person", "relation": "Opens", "tail": "Draft Shield", "source_chunks": ["32_1", "32_2"]}, {"head": "Person", "relation": "Places", "tail": "Aluminum Foil", "source_chunks": ["32_1", "32_2"]}, {"head": "Analytical Balance", "relation": "Contains", "tail": "Beaker", "source_chunks": ["32_1"]}, {"head": "Laboratory Environment", "relation": "Includes", "tail": "Black Laboratory Bench", "source_chunks": ["32_1"]}, {"head": "Aluminum Foil", "relation": "Has Mass", "tail": "Balance", "source_chunks": ["32_2"]}, {"head": "Balance", "relation": "Displays", "tail": "0.193_G", "source_chunks": ["32_2"]}, {"head": "Person", "relation": "Closes", "tail": "Draft Shield", "source_chunks": ["32_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:20:02,708 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~447 words, ~581 tokens)
2025-11-30 21:20:02,708 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:20:29,359 - src.components.global_refiner - DEBUG - LLM call completed in 26.65s
2025-11-30 21:20:29,359 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Researcher', 'Wears', 'Blue Nitrile Gloves', ['32_0']], ['Researcher', 'Opens', 'Glass Draft Shield', ['32_0']], ['Researcher', 'Places', 'Beaker', ['32_0']], ['Beaker', 'Is On', 'Analytical Balance', ['32_0']], ['Researcher', 'Adds', 'White Powder', ['32_0']], ['Analytical Balance', 'Displays', 'Weight Reading', ['32_0']], ['Analytical Balance', 'Displays', '0.191 Grams', ['32_1']], ['Person', 'Wears', 'Blue Nitrile Glove', ['32_1', '32_3']], ['Person', 'Opens', 'Draft Shield', ['32_1', '32_2']], ['Person', 'Places', 'Aluminum Foil', ['32_1', '32_2']], ['Analytical Balance', 'Contains', 'Beaker', ['32_1']], ['Laboratory Environment', 'Includes', 'Black Laboratory Bench', ['32_1']], ['Aluminum Foil', 'Has Mass', 'Balance', ['32_2']], ['Balance', 'Displays', '0.193_G', ['32_2']], ['Person', 'Closes', 'Draft Shield', ['32_2']]] inter_chunk_relations=[['Researcher', 'Wears', 'Nitrile_Gloves', ['32_0']], ['Researcher', 'Opens', 'Glass_Draft_Shield', ['32_0']], ['Researcher', 'Places', 'Beaker', ['32_0']], ['Beaker', 'Is On', 'Analytical Balance', ['32_0']], ['Researcher', 'Adds', 'White Powder', ['32_0']], ['Analytical Balance', 'Displays', 'Weight Reading', ['32_0']], ['Analytical Balance', 'Displays', '0.191 Grams', ['32_1']], ['Person', 'Wears', 'Blue Nitrile Glove', ['32_1', '32_3']], ['Person', 'Opens', 'Draft Shield', ['32_1', '32_2']], ['Person', 'Places', 'Aluminum Foil', ['32_1', '32_2']], ['Analytical Balance', 'Contains', 'Beaker', ['32_1']], ['Laboratory Environment', 'Includes', 'Black Laboratory Bench', ['32_1']], ['Aluminum Foil', 'Has Mass', 'Balance', ['32_2']], ['Balance', 'Displays', '0.193_G', ['32_2']], ['Person', 'Closes', 'Draft Shield', ['32_2']]] merge_instructions=[{'local': 'Blue Nitrile Gloves', 'existing': 'Nitrile_Gloves', 'existing_id': '13_0'}, {'local': 'Blue Nitrile Glove', 'existing': 'Nitrile_Gloves', 'existing_id': '13_0'}, {'local': 'Glass Draft Shield', 'existing': 'Glass_Draft_Shield', 'existing_id': '7_0'}, {'local': 'Draft Shield', 'existing': 'Glass_Draft_Shield', 'existing_id': '7_0'}, {'local': 'Analytical Balance', 'existing': 'Digital Scale', 'existing_id': '31_0'}, {'local': 'Balance', 'existing': 'Digital Scale', 'existing_id': '31_0'}, {'local': 'Beaker', 'existing': 'Liquid_In_Small_Container', 'existing_id': '5_0'}, {'local': 'White Powder', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Black Laboratory Bench', 'existing': 'Laboratory_Bench', 'existing_id': '13_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Researcher', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'Opens', 'tail': 'Glass Draft Shield'}, {'head': 'Person', 'relation': 'Opens', 'tail': 'Draft Shield'}, {'head': 'Person', 'relation': 'Closes', 'tail': 'Draft Shield'}, {'head': 'Person', 'relation': 'Closes', 'tail': 'Glass Draft Shield'}, {'head': 'Person', 'relation': 'Places', 'tail': 'Beaker'}, {'head': 'Person', 'relation': 'Places', 'tail': 'Aluminum Foil'}, {'head': 'Beaker', 'relation': 'Is On', 'tail': 'Analytical Balance'}, {'head': 'Analytical Balance', 'relation': 'Contains', 'tail': 'Beaker'}, {'head': 'Analytical Balance', 'relation': 'Displays', 'tail': 'Weight Reading'}, {'head': 'Analytical Balance', 'relation': 'Displays', 'tail': '0.191 Grams'}, {'head': 'Balance', 'relation': 'Displays', 'tail': '0.193_G'}, {'head': 'Aluminum Foil', 'relation': 'Has Mass', 'tail': 'Balance'}, {'head': 'Laboratory Environment', 'relation': 'Includes', 'tail': 'Black Laboratory Bench'}]
2025-11-30 21:20:29,359 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Researcher', 'Wears', 'Blue Nitrile Gloves', ['32_0']], ['Researcher', 'Opens', 'Glass Draft Shield', ['32_0']], ['Researcher', 'Places', 'Beaker', ['32_0']]]
2025-11-30 21:20:29,359 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=15, sample=[['Researcher', 'Wears', 'Nitrile_Gloves', ['32_0']], ['Researcher', 'Opens', 'Glass_Draft_Shield', ['32_0']], ['Researcher', 'Places', 'Beaker', ['32_0']]]
2025-11-30 21:20:29,359 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=9, sample=[{'local': 'Blue Nitrile Gloves', 'existing': 'Nitrile_Gloves', 'existing_id': '13_0'}, {'local': 'Blue Nitrile Glove', 'existing': 'Nitrile_Gloves', 'existing_id': '13_0'}, {'local': 'Glass Draft Shield', 'existing': 'Glass_Draft_Shield', 'existing_id': '7_0'}]
2025-11-30 21:20:29,359 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=16, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Researcher', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}]
2025-11-30 21:20:29,359 - src.components.global_refiner - INFO - LLM suggested 9 entity merges: [{'local': 'Blue Nitrile Gloves', 'existing': 'Nitrile_Gloves', 'existing_id': '13_0'}, {'local': 'Blue Nitrile Glove', 'existing': 'Nitrile_Gloves', 'existing_id': '13_0'}, {'local': 'Glass Draft Shield', 'existing': 'Glass_Draft_Shield', 'existing_id': '7_0'}, {'local': 'Draft Shield', 'existing': 'Glass_Draft_Shield', 'existing_id': '7_0'}, {'local': 'Analytical Balance', 'existing': 'Digital Scale', 'existing_id': '31_0'}, {'local': 'Balance', 'existing': 'Digital Scale', 'existing_id': '31_0'}, {'local': 'Beaker', 'existing': 'Liquid_In_Small_Container', 'existing_id': '5_0'}, {'local': 'White Powder', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Black Laboratory Bench', 'existing': 'Laboratory_Bench', 'existing_id': '13_0'}]
2025-11-30 21:20:29,359 - src.components.global_refiner - INFO - LLM suggested 16 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Researcher', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'Opens', 'tail': 'Glass Draft Shield'}, {'head': 'Person', 'relation': 'Opens', 'tail': 'Draft Shield'}, {'head': 'Person', 'relation': 'Closes', 'tail': 'Draft Shield'}, {'head': 'Person', 'relation': 'Closes', 'tail': 'Glass Draft Shield'}, {'head': 'Person', 'relation': 'Places', 'tail': 'Beaker'}, {'head': 'Person', 'relation': 'Places', 'tail': 'Aluminum Foil'}, {'head': 'Beaker', 'relation': 'Is On', 'tail': 'Analytical Balance'}, {'head': 'Analytical Balance', 'relation': 'Contains', 'tail': 'Beaker'}, {'head': 'Analytical Balance', 'relation': 'Displays', 'tail': 'Weight Reading'}, {'head': 'Analytical Balance', 'relation': 'Displays', 'tail': '0.191 Grams'}, {'head': 'Balance', 'relation': 'Displays', 'tail': '0.193_G'}, {'head': 'Aluminum Foil', 'relation': 'Has Mass', 'tail': 'Balance'}, {'head': 'Laboratory Environment', 'relation': 'Includes', 'tail': 'Black Laboratory Bench'}]
2025-11-30 21:20:29,359 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 30 triplets (total: 26.65s, LLM: 26.65s)
2025-11-30 21:20:29,359 - src.pipeline.kg_builder - INFO - Global refinement: 30 triplets in 26.65s
2025-11-30 21:20:29,360 - src.pipeline.kg_builder - INFO - Using 30 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:20:29,360 - src.pipeline.kg_builder - INFO - Pushing batch 33/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:20:29,360 - src.components.neo4j_handler - INFO - Adding 17 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:20:29,558 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=339, relationships=290
2025-11-30 21:20:29,558 - src.components.neo4j_handler - INFO - Applying 9 merge instructions
2025-11-30 21:20:29,559 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue Nitrile Gloves -> Nitrile_Gloves
2025-11-30 21:20:29,562 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue Nitrile Glove -> Nitrile_Gloves
2025-11-30 21:20:29,566 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass Draft Shield -> Glass_Draft_Shield
2025-11-30 21:20:29,569 - src.components.neo4j_handler - DEBUG - APOC merge successful: Draft Shield -> Glass_Draft_Shield
2025-11-30 21:20:29,572 - src.components.neo4j_handler - DEBUG - APOC merge successful: Analytical Balance -> Digital Scale
2025-11-30 21:20:29,574 - src.components.neo4j_handler - DEBUG - APOC merge successful: Balance -> Digital Scale
2025-11-30 21:20:29,577 - src.components.neo4j_handler - DEBUG - APOC merge successful: Beaker -> Liquid_In_Small_Container
2025-11-30 21:20:29,580 - src.components.neo4j_handler - DEBUG - APOC merge successful: White Powder -> Mass Of Liquid
2025-11-30 21:20:29,583 - src.components.neo4j_handler - DEBUG - APOC merge successful: Black Laboratory Bench -> Laboratory_Bench
2025-11-30 21:20:29,583 - src.components.neo4j_handler - INFO - Applying 16 prune instructions
2025-11-30 21:20:29,588 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Nitrile_Gloves
2025-11-30 21:20:29,589 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue Nitrile Glove
2025-11-30 21:20:29,590 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Researcher -[Wears]-> Blue Nitrile Gloves
2025-11-30 21:20:29,590 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Opens]-> Glass Draft Shield
2025-11-30 21:20:29,591 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Opens]-> Draft Shield
2025-11-30 21:20:29,591 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Closes]-> Draft Shield
2025-11-30 21:20:29,592 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Closes]-> Glass Draft Shield
2025-11-30 21:20:29,593 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Places]-> Beaker
2025-11-30 21:20:29,594 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Places]-> Aluminum Foil
2025-11-30 21:20:29,595 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Beaker -[Is On]-> Analytical Balance
2025-11-30 21:20:29,595 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Analytical Balance -[Contains]-> Beaker
2025-11-30 21:20:29,596 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Analytical Balance -[Displays]-> Weight Reading
2025-11-30 21:20:29,596 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Analytical Balance -[Displays]-> 0.191 Grams
2025-11-30 21:20:29,596 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Balance -[Displays]-> 0.193_G
2025-11-30 21:20:29,597 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Aluminum Foil -[Has Mass]-> Balance
2025-11-30 21:20:29,621 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Laboratory Environment -[Includes]-> Black Laboratory Bench
2025-11-30 21:20:29,621 - src.components.neo4j_handler - INFO - Applying 15 inter-chunk relations
2025-11-30 21:20:29,624 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Researcher -[Wears]-> Nitrile_Gloves
2025-11-30 21:20:29,626 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Researcher -[Opens]-> Glass_Draft_Shield
2025-11-30 21:20:29,627 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Researcher -[Places]-> Beaker
2025-11-30 21:20:29,629 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Is On]-> Analytical Balance
2025-11-30 21:20:29,630 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Researcher -[Adds]-> White Powder
2025-11-30 21:20:29,631 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Analytical Balance -[Displays]-> Weight Reading
2025-11-30 21:20:29,632 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Analytical Balance -[Displays]-> 0.191 Grams
2025-11-30 21:20:29,632 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue Nitrile Glove
2025-11-30 21:20:29,633 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Opens]-> Draft Shield
2025-11-30 21:20:29,635 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Places]-> Aluminum Foil
2025-11-30 21:20:29,636 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Analytical Balance -[Contains]-> Beaker
2025-11-30 21:20:29,656 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Laboratory Environment -[Includes]-> Black Laboratory Bench
2025-11-30 21:20:29,658 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Aluminum Foil -[Has Mass]-> Balance
2025-11-30 21:20:29,659 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Balance -[Displays]-> 0.193_G
2025-11-30 21:20:29,659 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Closes]-> Draft Shield
2025-11-30 21:20:29,660 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:20:29,664 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=330, relationships=287
2025-11-30 21:20:29,667 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:20:29,667 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:20:29,667 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:20:29,667 - src.components.neo4j_handler - INFO - Batch injected in 0.31s (triplets: 0.30s, indexes: 0.00s)
2025-11-30 21:20:29,668 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 156, 'with_embedding': 156, 'linked_chunks': 124}
2025-11-30 21:20:29,668 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:20:29,707 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 330 nodes
2025-11-30 21:20:29,818 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 298 nodes
2025-11-30 21:20:29,947 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 330, 'relationship_count': 954, 'density': 0.0088, 'avg_degree': 5.7818, 'avg_unique_neighbors': 5.7152, 'global_efficiency': 0.3252, 'avg_path_length': 2.7232, 'avg_degree_centrality': 0.0176, 'max_degree_centrality': 0.5258, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0312, 'degree_assortativity': -0.1778, 'graph_robustness': 0.8407, 'diameter_estimate': 6, 'clustering_coefficient': 0.2518, 'weakly_connected_components': 33, 'largest_wcc_size': 298, 'pagerank_top10_percent': 9.23, 'louvain_communities': 41, 'louvain_modularity': 0.4319, 'label_entropy': 1.4989, 'computational_time': 0.2788796570384875}
2025-11-30 21:20:29,947 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 32, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508829.9478652, 'total_time': 33.873198622022755, 'aggregation': 3.418070264160633e-06, 'network_info': 0.006210742052644491, 'llm_extraction': 33.279001055052504, 'data_cleaning': 4.5520951971411705e-05, 'neo4j_injection': 0.3073732699267566, 'embedding_time': 0, 'indexing_time': 0.0025399329606443644, 'graph_injection_time': 0.30450209497939795, 'acs_metrics': {'node_count': 330, 'relationship_count': 954, 'density': 0.0088, 'avg_degree': 5.7818, 'avg_unique_neighbors': 5.7152, 'global_efficiency': 0.3252, 'avg_path_length': 2.7232, 'avg_degree_centrality': 0.0176, 'max_degree_centrality': 0.5258, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0312, 'degree_assortativity': -0.1778, 'graph_robustness': 0.8407, 'diameter_estimate': 6, 'clustering_coefficient': 0.2518, 'weakly_connected_components': 33, 'largest_wcc_size': 298, 'pagerank_top10_percent': 9.23, 'louvain_communities': 41, 'louvain_modularity': 0.4319, 'label_entropy': 1.4989, 'computational_time': 0.2788796570384875}, 'retrieval_queries': []}
2025-11-30 21:20:29,947 - src.pipeline.kg_builder - DEBUG - Batch 32 metrics: {
  "batch_idx": 32,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508829.9478652,
  "total_time": 33.873198622022755,
  "aggregation": 3.418070264160633e-06,
  "network_info": 0.006210742052644491,
  "llm_extraction": 33.279001055052504,
  "data_cleaning": 4.5520951971411705e-05,
  "neo4j_injection": 0.3073732699267566,
  "embedding_time": 0,
  "indexing_time": 0.0025399329606443644,
  "graph_injection_time": 0.30450209497939795,
  "acs_metrics": {
    "node_count": 330,
    "relationship_count": 954,
    "density": 0.0088,
    "avg_degree": 5.7818,
    "avg_unique_neighbors": 5.7152,
    "global_efficiency": 0.3252,
    "avg_path_length": 2.7232,
    "avg_degree_centrality": 0.0176,
    "max_degree_centrality": 0.5258,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0312,
    "degree_assortativity": -0.1778,
    "graph_robustness": 0.8407,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2518,
    "weakly_connected_components": 33,
    "largest_wcc_size": 298,
    "pagerank_top10_percent": 9.23,
    "louvain_communities": 41,
    "louvain_modularity": 0.4319,
    "label_entropy": 1.4989,
    "computational_time": 0.2788796570384875
  },
  "retrieval_queries": []
}
2025-11-30 21:20:29,948 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:20:29,948 - src.pipeline.kg_builder - INFO - Batch 33 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 33.28s, Clean: 0.00s, Neo4j: 0.31s, ACS: 0.28s
2025-11-30 21:20:29,948 - src.pipeline.kg_builder - INFO - Batch 33 completed in 33.87s
Processing KG batches:  46%|████▌     | 33/72 [13:32<17:35, 27.05s/it]2025-11-30 21:20:29,948 - src.pipeline.kg_builder - INFO - Processing batch 34/72 (3 items)
2025-11-30 21:20:29,948 - src.pipeline.kg_builder - DEBUG - Batch 34 current_video_time: 08:23-08:28
2025-11-30 21:20:29,958 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 330
- Total Relationships: 287
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:20:29,959 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:20:29,959 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_0 ~245 words, content: Time: 08:13-08:18 Content: The video sequence captures a series of actions within a laboratory setting, focusing on a person conducting an experiment. The scene is...
2025-11-30 21:20:29,959 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_1 ~236 words, content: the contents of the container are not contaminated. The surrounding area includes a blue stand with a glass tube, a beaker, and a pair of...
2025-11-30 21:20:29,959 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_2 ~248 words, content: the camera provides a wide view of the lab. A person wearing blue gloves is seen interacting with a piece of equipment, possibly a balance...
2025-11-30 21:20:29,959 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_3 ~245 words, content: and other lab equipment remain in the foreground, but the primary action is the documentation of the experiment. Overall, the video depicts a scientific procedure...
2025-11-30 21:20:29,959 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_4 ~221 words, content: A glass container is placed on a magnetic stirrer, which is actively mixing a liquid. The stirrer is connected to a power source, and the...
2025-11-30 21:20:29,979 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:20:30,051 - src.components.pre_llm_injector - DEBUG - Found 156 existing chunk embeddings for similarity lookup
2025-11-30 21:20:30,093 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_0', '0.826'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_1', '0.810')]
2025-11-30 21:20:30,095 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_1
2025-11-30 21:20:30,095 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:20:30,095 - src.components.pre_llm_injector - DEBUG - Found 6 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_0
2025-11-30 21:20:30,095 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:20:30,108 - src.components.pre_llm_injector - DEBUG - Limited Person from 88 to 2 external connections
2025-11-30 21:20:30,108 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 88 total -> 2 (internal: 0, external: 2)
2025-11-30 21:20:30,109 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[LOOKS_AT]->(Camera / ID: 0_1), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2)
2025-11-30 21:20:30,112 - src.components.pre_llm_injector - DEBUG - Limited Person from 87 to 2 external connections
2025-11-30 21:20:30,112 - src.components.pre_llm_injector - DEBUG - Limited Clear_Liquid from 3 to 2 external connections
2025-11-30 21:20:30,112 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 96 total -> 10 (internal: 3, external: 7)
2025-11-30 21:20:30,112 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[OBSERVES]->(Background_Person / ID: 29_0), (Background_Person / ID: 29_0)-[STANDS]->(With_Arms_Crossed / ID: 29_0), (Lab / ID: 29_0)-[CONTAINS]->(Fire_Extinguisher / ID: 29_0), (Digital_Balance / ID: 16_0)-[IS_USED_BY]->(Person / ID: 0_0), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Glass_Volumetric_Flask / ID: 29_2)-[CONTAINS]->(Clear_Liquid / ID: 29_0), (Round_Bottom_Flask / ID: 30_1)-[CONTAINS]->(Clear_Liquid / ID: 29_0), (Lab_Room / ID: 29_1)-[CONTAINS]->(Fire_Extinguisher / ID: 29_0), (Lab / ID: 29_0)-[CONTAINS]->(Fire Extinguisher / ID: 31_1), (Lab / ID: 29_0)-[CONTAINS]->(White Cabinet / ID: 31_1)
2025-11-30 21:20:30,112 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.717'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2', '0.701')]
2025-11-30 21:20:30,112 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_1', '0.784'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_0', '0.736')]
2025-11-30 21:20:30,112 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_2', '0.671'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_2', '0.667')]
2025-11-30 21:20:30,112 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_0', '0.826'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_1', '0.810')]
2025-11-30 21:20:30,112 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_3', '0.769'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.748')]
2025-11-30 21:20:30,112 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:20:30,112 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_0) (~245 words) with timeout=5.0s retries=3
2025-11-30 21:20:31,143 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:20:31,143 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:20:31,144 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_1) (~236 words) with timeout=5.0s retries=3
2025-11-30 21:20:32,175 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:20:32,175 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:20:32,175 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_2) (~248 words) with timeout=5.0s retries=3
2025-11-30 21:20:33,236 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:20:33,236 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:20:33,237 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_3) (~245 words) with timeout=5.0s retries=3
2025-11-30 21:20:34,314 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:20:34,314 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:20:34,314 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_4) (~221 words) with timeout=5.0s retries=3
2025-11-30 21:20:35,659 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:20:35,659 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:20:35,659 - src.components.pre_llm_injector - INFO - Extracted 28 local triplets from 5 chunks
2025-11-30 21:20:35,660 - src.pipeline.kg_builder - INFO - Pre-extraction: 28 triplets in 5.70s
2025-11-30 21:20:35,660 - src.components.global_refiner - INFO - Capping refinement input: 28 → 15 triplets
2025-11-30 21:20:35,660 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[LOOKS_AT]->(Camera / ID: 0_1), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[OBSERVES]->(Background_Person / ID: 29_0), (Background_Person / ID: 29_0)-[STANDS]->(With_Arms_Crossed / ID: 29_0), (Lab / ID: 29_0)-[CONTAINS]->(Fire_Extinguisher / ID: 29_0), (Digital_Balance / ID: 16_0)-[IS_USED_BY]->(Person / ID: 0_0), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Glass_Volumetric_Flask / ID: 29_2)-[CONTAINS]->(Clear_Liquid / ID: 29_0), (Round_Bottom_Flask / ID: 30_1)-[CONTAINS]->(Clear_Liquid / ID: 29_0), (Lab_Room / ID: 29_1)-[CONTAINS]->(Fire_Extinguisher / ID: 29_0), (Lab / ID: 29_0)-[CONTAINS]->(Fire Extinguisher / ID: 31_1), (Lab / ID: 29_0)-[CONTAINS]->(White Cabinet / ID: 31_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["33_0"]}, {"head": "Person", "relation": "Handles", "tail": "Aluminum Foil", "source_chunks": ["33_0", "33_1"]}, {"head": "Person", "relation": "Uses", "tail": "Balance Scale", "source_chunks": ["33_0"]}, {"head": "Balance Scale", "relation": "Measures", "tail": "Mass", "source_chunks": ["33_0"]}, {"head": "Person", "relation": "Places", "tail": "Container", "source_chunks": ["33_0"]}, {"head": "Container", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["33_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["33_1"]}, {"head": "Person", "relation": "Works At", "tail": "Countertop", "source_chunks": ["33_1"]}, {"head": "Lab", "relation": "Contains", "tail": "Balance Scale", "source_chunks": ["33_1"]}, {"head": "Lab", "relation": "Contains", "tail": "Glass Tube", "source_chunks": ["33_1"]}, {"head": "Lab", "relation": "Contains", "tail": "Beaker", "source_chunks": ["33_1"]}, {"head": "Camera", "relation": "Provides", "tail": "Wide_View", "source_chunks": ["33_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Gloves", "source_chunks": ["33_2"]}, {"head": "Person", "relation": "Interacts With", "tail": "Balance_Scale", "source_chunks": ["33_2"]}, {"head": "Person", "relation": "Holds", "tail": "Smartphone", "source_chunks": ["33_2", "33_3"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:20:35,660 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~401 words, ~521 tokens)
2025-11-30 21:20:35,660 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:20:48,774 - src.components.global_refiner - DEBUG - LLM call completed in 13.11s
2025-11-30 21:20:48,775 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue Glove', ['33_0']], ['Person', 'Handles', 'Aluminum Foil', ['33_0', '33_1']], ['Person', 'Uses', 'Balance Scale', ['33_0']], ['Balance Scale', 'Measures', 'Mass', ['33_0']], ['Person', 'Places', 'Container', ['33_0']], ['Container', 'Is On', 'Magnetic Stirrer', ['33_0']], ['Person', 'Wears', 'Blue Gloves', ['33_1']], ['Person', 'Works At', 'Countertop', ['33_1']], ['Lab', 'Contains', 'Balance Scale', ['33_1']], ['Lab', 'Contains', 'Glass Tube', ['33_1']], ['Lab', 'Contains', 'Beaker', ['33_1']], ['Camera', 'Provides', 'Wide_View', ['33_2']], ['Person', 'Wears', 'Blue_Gloves', ['33_2']], ['Person', 'Interacts With', 'Balance_Scale', ['33_2']], ['Person', 'Holds', 'Smartphone', ['33_2', '33_3']]] inter_chunk_relations=[['Person', 'Wears', 'Blue Glove', ['33_0']], ['Person', 'Wears', 'Blue Gloves', ['33_1']], ['Person', 'Wears', 'Blue_Gloves', ['33_2']], ['Lab', 'Contains', 'Balance Scale', ['33_1']], ['Lab', 'Contains', 'Glass Tube', ['33_1']], ['Lab', 'Contains', 'Beaker', ['33_1']], ['Camera', 'Provides', 'Wide_View', ['33_2']], ['Person', 'Interacts With', 'Balance_Scale', ['33_2']], ['Person', 'Holds', 'Smartphone', ['33_2', '33_3']]] merge_instructions=[{'local': 'Blue Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Gloves'}]
2025-11-30 21:20:48,775 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue Glove', ['33_0']], ['Person', 'Handles', 'Aluminum Foil', ['33_0', '33_1']], ['Person', 'Uses', 'Balance Scale', ['33_0']]]
2025-11-30 21:20:48,775 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=9, sample=[['Person', 'Wears', 'Blue Glove', ['33_0']], ['Person', 'Wears', 'Blue Gloves', ['33_1']], ['Person', 'Wears', 'Blue_Gloves', ['33_2']]]
2025-11-30 21:20:48,775 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=3, sample=[{'local': 'Blue Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}]
2025-11-30 21:20:48,775 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=3, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Gloves'}]
2025-11-30 21:20:48,775 - src.components.global_refiner - INFO - LLM suggested 3 entity merges: [{'local': 'Blue Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}]
2025-11-30 21:20:48,775 - src.components.global_refiner - INFO - LLM suggested 3 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Gloves'}]
2025-11-30 21:20:48,775 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 24 triplets (total: 13.12s, LLM: 13.11s)
2025-11-30 21:20:48,775 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 13.12s
2025-11-30 21:20:48,775 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:20:48,775 - src.pipeline.kg_builder - INFO - Pushing batch 34/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:20:48,776 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:20:48,949 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=342, relationships=299
2025-11-30 21:20:48,949 - src.components.neo4j_handler - INFO - Applying 3 merge instructions
2025-11-30 21:20:48,950 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue Glove -> Blue Glove
2025-11-30 21:20:48,950 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue Gloves -> Blue Glove
2025-11-30 21:20:48,954 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Gloves -> Blue Glove
2025-11-30 21:20:48,954 - src.components.neo4j_handler - INFO - Applying 3 prune instructions
2025-11-30 21:20:48,959 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Glove
2025-11-30 21:20:48,959 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue Gloves
2025-11-30 21:20:48,960 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Gloves
2025-11-30 21:20:48,960 - src.components.neo4j_handler - INFO - Applying 9 inter-chunk relations
2025-11-30 21:20:48,961 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue Glove
2025-11-30 21:20:48,962 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue Gloves
2025-11-30 21:20:48,963 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue_Gloves
2025-11-30 21:20:48,964 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab -[Contains]-> Balance Scale
2025-11-30 21:20:48,966 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab -[Contains]-> Glass Tube
2025-11-30 21:20:48,967 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab -[Contains]-> Beaker
2025-11-30 21:20:49,000 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Camera -[Provides]-> Wide_View
2025-11-30 21:20:49,002 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Interacts With]-> Balance_Scale
2025-11-30 21:20:49,004 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Smartphone
2025-11-30 21:20:49,005 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:20:49,010 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=340, relationships=297
2025-11-30 21:20:49,011 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:20:49,011 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:20:49,011 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:20:49,011 - src.components.neo4j_handler - INFO - Batch injected in 0.24s (triplets: 0.23s, indexes: 0.00s)
2025-11-30 21:20:49,013 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 161, 'with_embedding': 161, 'linked_chunks': 128}
2025-11-30 21:20:49,013 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:20:49,071 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 340 nodes
2025-11-30 21:20:49,196 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 307 nodes
2025-11-30 21:20:49,337 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 340, 'relationship_count': 986, 'density': 0.0086, 'avg_degree': 5.8, 'avg_unique_neighbors': 5.7353, 'global_efficiency': 0.3256, 'avg_path_length': 2.7171, 'avg_degree_centrality': 0.0171, 'max_degree_centrality': 0.531, 'avg_betweenness_centrality': 0.0009, 'max_betweenness_centrality': 0.0406, 'degree_assortativity': -0.1824, 'graph_robustness': 0.8438, 'diameter_estimate': 6, 'clustering_coefficient': 0.2533, 'weakly_connected_components': 34, 'largest_wcc_size': 307, 'pagerank_top10_percent': 8.83, 'louvain_communities': 44, 'louvain_modularity': 0.4351, 'label_entropy': 1.499, 'computational_time': 0.3238935339031741}
2025-11-30 21:20:49,337 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 33, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508849.3373153, 'total_time': 19.38843959500082, 'aggregation': 3.085937350988388e-06, 'network_info': 0.009905504994094372, 'llm_extraction': 18.816739663947374, 'data_cleaning': 3.7806923501193523e-05, 'neo4j_injection': 0.2362382410792634, 'embedding_time': 0, 'indexing_time': 0.0016561539378017187, 'graph_injection_time': 0.23422299302183092, 'acs_metrics': {'node_count': 340, 'relationship_count': 986, 'density': 0.0086, 'avg_degree': 5.8, 'avg_unique_neighbors': 5.7353, 'global_efficiency': 0.3256, 'avg_path_length': 2.7171, 'avg_degree_centrality': 0.0171, 'max_degree_centrality': 0.531, 'avg_betweenness_centrality': 0.0009, 'max_betweenness_centrality': 0.0406, 'degree_assortativity': -0.1824, 'graph_robustness': 0.8438, 'diameter_estimate': 6, 'clustering_coefficient': 0.2533, 'weakly_connected_components': 34, 'largest_wcc_size': 307, 'pagerank_top10_percent': 8.83, 'louvain_communities': 44, 'louvain_modularity': 0.4351, 'label_entropy': 1.499, 'computational_time': 0.3238935339031741}, 'retrieval_queries': []}
2025-11-30 21:20:49,337 - src.pipeline.kg_builder - DEBUG - Batch 33 metrics: {
  "batch_idx": 33,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508849.3373153,
  "total_time": 19.38843959500082,
  "aggregation": 3.085937350988388e-06,
  "network_info": 0.009905504994094372,
  "llm_extraction": 18.816739663947374,
  "data_cleaning": 3.7806923501193523e-05,
  "neo4j_injection": 0.2362382410792634,
  "embedding_time": 0,
  "indexing_time": 0.0016561539378017187,
  "graph_injection_time": 0.23422299302183092,
  "acs_metrics": {
    "node_count": 340,
    "relationship_count": 986,
    "density": 0.0086,
    "avg_degree": 5.8,
    "avg_unique_neighbors": 5.7353,
    "global_efficiency": 0.3256,
    "avg_path_length": 2.7171,
    "avg_degree_centrality": 0.0171,
    "max_degree_centrality": 0.531,
    "avg_betweenness_centrality": 0.0009,
    "max_betweenness_centrality": 0.0406,
    "degree_assortativity": -0.1824,
    "graph_robustness": 0.8438,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2533,
    "weakly_connected_components": 34,
    "largest_wcc_size": 307,
    "pagerank_top10_percent": 8.83,
    "louvain_communities": 44,
    "louvain_modularity": 0.4351,
    "label_entropy": 1.499,
    "computational_time": 0.3238935339031741
  },
  "retrieval_queries": []
}
2025-11-30 21:20:49,338 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:20:49,338 - src.pipeline.kg_builder - INFO - Batch 34 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 18.82s, Clean: 0.00s, Neo4j: 0.24s, ACS: 0.32s
2025-11-30 21:20:49,338 - src.pipeline.kg_builder - INFO - Batch 34 completed in 19.39s
Processing KG batches:  47%|████▋     | 34/72 [13:52<15:40, 24.76s/it]2025-11-30 21:20:49,338 - src.pipeline.kg_builder - INFO - Processing batch 35/72 (3 items)
2025-11-30 21:20:49,338 - src.pipeline.kg_builder - DEBUG - Batch 35 current_video_time: 08:38-08:43
2025-11-30 21:20:49,343 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 340
- Total Relationships: 297
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:20:49,344 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:20:49,344 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_34_0 ~235 words, content: Time: 08:28-08:33 Content: The video captures a sequence of actions in a laboratory setting, focusing on a chemical experiment. The scene is set on a...
2025-11-30 21:20:49,344 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_34_1 ~224 words, content: show the person continuing to use the pipette to transfer the liquid. The test tube is held steady, and the liquid is being drawn into...
2025-11-30 21:20:49,344 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_34_2 ~223 words, content: with precision, suggesting a controlled experiment. The person's hands are the primary focus, demonstrating careful handling of the chemicals. - **Final State:** After the transfer,...
2025-11-30 21:20:49,344 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_34_3 ~226 words, content: weighing balance or a stir plate. - **Transfer to a Volumetric Flask:** The researcher then carefully transfers the liquid from the small vial into a...
2025-11-30 21:20:49,344 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_34_4 ~71 words, content: which might contain a reagent. In summary, the video shows a researcher meticulously preparing a chemical solution in a laboratory setting. The process involves precise...
2025-11-30 21:20:49,364 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:20:49,438 - src.components.pre_llm_injector - DEBUG - Found 161 existing chunk embeddings for similarity lookup
2025-11-30 21:20:49,481 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.814'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_3', '0.794')]
2025-11-30 21:20:49,483 - src.components.pre_llm_injector - DEBUG - Found 3 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2
2025-11-30 21:20:49,483 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:20:49,483 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_3
2025-11-30 21:20:49,483 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:20:49,498 - src.components.pre_llm_injector - DEBUG - Limited Person from 91 to 2 external connections
2025-11-30 21:20:49,498 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 92 total -> 3 (internal: 1, external: 2)
2025-11-30 21:20:49,498 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(Smartphone / ID: 0_0), (Person / ID: 0_0)-[PLACES]->(Aluminum Foil / ID: 3_2), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2)
2025-11-30 21:20:49,501 - src.components.pre_llm_injector - DEBUG - Limited Person from 91 to 2 external connections
2025-11-30 21:20:49,501 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 92 total -> 3 (internal: 1, external: 2)
2025-11-30 21:20:49,501 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[USES]->(Digital Scale / ID: 31_0), (Person / ID: 0_0)-[OPENS]->(Glass_Draft_Shield / ID: 7_0)
2025-11-30 21:20:49,501 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.670'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_1', '0.656')]
2025-11-30 21:20:49,501 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.625'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_6', '0.620')]
2025-11-30 21:20:49,501 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_0', '0.586'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_0', '0.584')]
2025-11-30 21:20:49,501 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.814'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_3', '0.794')]
2025-11-30 21:20:49,501 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_5', '0.770'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_4', '0.759')]
2025-11-30 21:20:49,501 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:20:49,501 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_34_0) (~235 words) with timeout=5.0s retries=3
2025-11-30 21:20:50,625 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:20:50,625 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:20:50,626 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_34_1) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:20:52,063 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:20:52,063 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:20:52,063 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_34_2) (~223 words) with timeout=5.0s retries=3
2025-11-30 21:20:53,346 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:20:53,346 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:20:53,347 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_34_3) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:20:54,672 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:20:54,672 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:20:54,672 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_34_4) (~71 words) with timeout=5.0s retries=3
2025-11-30 21:20:55,925 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:20:55,925 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:20:55,925 - src.components.pre_llm_injector - INFO - Extracted 28 local triplets from 5 chunks
2025-11-30 21:20:55,925 - src.pipeline.kg_builder - INFO - Pre-extraction: 28 triplets in 6.58s
2025-11-30 21:20:55,925 - src.components.global_refiner - INFO - Capping refinement input: 28 → 15 triplets
2025-11-30 21:20:55,926 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[HOLDS]->(Smartphone / ID: 0_0), (Person / ID: 0_0)-[PLACES]->(Aluminum Foil / ID: 3_2), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[USES]->(Digital Scale / ID: 31_0), (Person / ID: 0_0)-[OPENS]->(Glass_Draft_Shield / ID: 7_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Lab Bench", "relation": "Contains", "tail": "Glass Flask", "source_chunks": ["34_0"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Electronic Balance", "source_chunks": ["34_0"]}, {"head": "Glass Flask", "relation": "Connected To", "tail": "Flexible Tube", "source_chunks": ["34_0"]}, {"head": "Flexible Tube", "relation": "Connected To", "tail": "Plastic Beaker", "source_chunks": ["34_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["34_0"]}, {"head": "Person", "relation": "Holds", "tail": "Test Tube", "source_chunks": ["34_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["34_1", "34_2"]}, {"head": "Person", "relation": "Holds", "tail": "Test_Tube", "source_chunks": ["34_1", "34_2"]}, {"head": "Test_Tube", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["34_1"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["34_1"]}, {"head": "Test_Tube", "relation": "Is Transferred To", "tail": "Volumetric_Flask", "source_chunks": ["34_1"]}, {"head": "Laboratory_Bench", "relation": "Contains", "tail": "Analytical_Balance", "source_chunks": ["34_1"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["34_2"]}, {"head": "Person", "relation": "Uses", "tail": "Vial", "source_chunks": ["34_2"]}, {"head": "Vial", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["34_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:20:55,926 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~362 words, ~471 tokens)
2025-11-30 21:20:55,926 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:21:09,685 - src.components.global_refiner - DEBUG - LLM call completed in 13.76s
2025-11-30 21:21:09,685 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Lab Bench', 'Contains', 'Glass Flask', ['34_0']], ['Glass Flask', 'Is On', 'Electronic Balance', ['34_0']], ['Glass Flask', 'Connected To', 'Flexible Tube', ['34_0']], ['Flexible Tube', 'Connected To', 'Plastic Beaker', ['34_0']], ['Person', 'Holds', 'Pipette', ['34_0']], ['Person', 'Holds', 'Test Tube', ['34_0']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['34_1', '34_2']], ['Person', 'Holds', 'Test_Tube', ['34_1', '34_2']], ['Test_Tube', 'Contains', 'Clear_Liquid', ['34_1']], ['Person', 'Transfers', 'Liquid', ['34_1']], ['Test_Tube', 'Is Transferred To', 'Volumetric_Flask', ['34_1']], ['Laboratory_Bench', 'Contains', 'Analytical_Balance', ['34_1']], ['Person', 'Holds', 'Volumetric_Flask', ['34_2']], ['Person', 'Uses', 'Vial', ['34_2']], ['Vial', 'Contains', 'Clear_Liquid', ['34_2']]] inter_chunk_relations=[['Person', 'Holds', 'Smartphone', ['34_0']], ['Person', 'Holds', 'Metal_Spatula', ['34_0']], ['Person', 'Uses', 'Digital Scale', ['34_0']], ['Person', 'Opens', 'Glass_Draft_Shield', ['34_0']], ['Person', 'Holds', 'Aluminum Foil', ['34_0']], ['Person', 'Wears', 'Watch', ['34_0']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Test_Tube', 'existing': 'Test Tube', 'existing_id': '0_1'}, {'local': 'Volumetric_Flask', 'existing': 'Volumetric Flask', 'existing_id': '0_2'}, {'local': 'Electronic Balance', 'existing': 'Digital Scale', 'existing_id': '31_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Pipette'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Test Tube'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric_Flask'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Vial'}]
2025-11-30 21:21:09,685 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Lab Bench', 'Contains', 'Glass Flask', ['34_0']], ['Glass Flask', 'Is On', 'Electronic Balance', ['34_0']], ['Glass Flask', 'Connected To', 'Flexible Tube', ['34_0']]]
2025-11-30 21:21:09,685 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=6, sample=[['Person', 'Holds', 'Smartphone', ['34_0']], ['Person', 'Holds', 'Metal_Spatula', ['34_0']], ['Person', 'Uses', 'Digital Scale', ['34_0']]]
2025-11-30 21:21:09,685 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Test_Tube', 'existing': 'Test Tube', 'existing_id': '0_1'}, {'local': 'Volumetric_Flask', 'existing': 'Volumetric Flask', 'existing_id': '0_2'}]
2025-11-30 21:21:09,685 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Pipette'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Test Tube'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric_Flask'}]
2025-11-30 21:21:09,685 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Test_Tube', 'existing': 'Test Tube', 'existing_id': '0_1'}, {'local': 'Volumetric_Flask', 'existing': 'Volumetric Flask', 'existing_id': '0_2'}, {'local': 'Electronic Balance', 'existing': 'Digital Scale', 'existing_id': '31_0'}]
2025-11-30 21:21:09,685 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Holds', 'tail': 'Pipette'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Test Tube'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric_Flask'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Vial'}]
2025-11-30 21:21:09,685 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 21 triplets (total: 13.76s, LLM: 13.76s)
2025-11-30 21:21:09,685 - src.pipeline.kg_builder - INFO - Global refinement: 21 triplets in 13.76s
2025-11-30 21:21:09,685 - src.pipeline.kg_builder - INFO - Using 21 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:21:09,686 - src.pipeline.kg_builder - INFO - Pushing batch 35/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:21:09,686 - src.components.neo4j_handler - INFO - Adding 21 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:21:09,921 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=352, relationships=310
2025-11-30 21:21:09,921 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:21:09,922 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Glove
2025-11-30 21:21:09,927 - src.components.neo4j_handler - DEBUG - APOC merge successful: Test_Tube -> Test Tube
2025-11-30 21:21:09,931 - src.components.neo4j_handler - DEBUG - APOC merge successful: Volumetric_Flask -> Volumetric Flask
2025-11-30 21:21:09,934 - src.components.neo4j_handler - DEBUG - APOC merge successful: Electronic Balance -> Digital Scale
2025-11-30 21:21:09,934 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:21:09,939 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Pipette
2025-11-30 21:21:09,942 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Test Tube
2025-11-30 21:21:09,943 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Volumetric_Flask
2025-11-30 21:21:09,945 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Uses]-> Vial
2025-11-30 21:21:09,945 - src.components.neo4j_handler - INFO - Applying 6 inter-chunk relations
2025-11-30 21:21:09,947 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Smartphone
2025-11-30 21:21:09,949 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Metal_Spatula
2025-11-30 21:21:09,951 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> Digital Scale
2025-11-30 21:21:09,953 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Opens]-> Glass_Draft_Shield
2025-11-30 21:21:09,954 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Aluminum Foil
2025-11-30 21:21:09,956 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Watch
2025-11-30 21:21:09,956 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:21:09,963 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=348, relationships=306
2025-11-30 21:21:09,964 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:21:09,964 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:21:09,964 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:21:09,964 - src.components.neo4j_handler - INFO - Batch injected in 0.28s (triplets: 0.28s, indexes: 0.00s)
2025-11-30 21:21:09,966 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 166, 'with_embedding': 166, 'linked_chunks': 131}
2025-11-30 21:21:09,966 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:21:10,024 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 348 nodes
2025-11-30 21:21:10,147 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 313 nodes
2025-11-30 21:21:10,342 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 348, 'relationship_count': 1019, 'density': 0.0084, 'avg_degree': 5.8563, 'avg_unique_neighbors': 5.7931, 'global_efficiency': 0.3217, 'avg_path_length': 2.7286, 'avg_degree_centrality': 0.0169, 'max_degree_centrality': 0.5216, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0338, 'degree_assortativity': -0.1764, 'graph_robustness': 0.8273, 'diameter_estimate': 6, 'clustering_coefficient': 0.2517, 'weakly_connected_components': 36, 'largest_wcc_size': 313, 'pagerank_top10_percent': 8.59, 'louvain_communities': 45, 'louvain_modularity': 0.4295, 'label_entropy': 1.4992, 'computational_time': 0.3759422419825569}
2025-11-30 21:21:10,342 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 34, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508870.3422945, 'total_time': 21.004010305041447, 'aggregation': 2.6170164346694946e-06, 'network_info': 0.005271965987049043, 'llm_extraction': 20.342202030937187, 'data_cleaning': 4.4792890548706055e-05, 'neo4j_injection': 0.2787301279604435, 'embedding_time': 0, 'indexing_time': 0.0013904509833082557, 'graph_injection_time': 0.2769868510076776, 'acs_metrics': {'node_count': 348, 'relationship_count': 1019, 'density': 0.0084, 'avg_degree': 5.8563, 'avg_unique_neighbors': 5.7931, 'global_efficiency': 0.3217, 'avg_path_length': 2.7286, 'avg_degree_centrality': 0.0169, 'max_degree_centrality': 0.5216, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0338, 'degree_assortativity': -0.1764, 'graph_robustness': 0.8273, 'diameter_estimate': 6, 'clustering_coefficient': 0.2517, 'weakly_connected_components': 36, 'largest_wcc_size': 313, 'pagerank_top10_percent': 8.59, 'louvain_communities': 45, 'louvain_modularity': 0.4295, 'label_entropy': 1.4992, 'computational_time': 0.3759422419825569}, 'retrieval_queries': []}
2025-11-30 21:21:10,342 - src.pipeline.kg_builder - DEBUG - Batch 34 metrics: {
  "batch_idx": 34,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508870.3422945,
  "total_time": 21.004010305041447,
  "aggregation": 2.6170164346694946e-06,
  "network_info": 0.005271965987049043,
  "llm_extraction": 20.342202030937187,
  "data_cleaning": 4.4792890548706055e-05,
  "neo4j_injection": 0.2787301279604435,
  "embedding_time": 0,
  "indexing_time": 0.0013904509833082557,
  "graph_injection_time": 0.2769868510076776,
  "acs_metrics": {
    "node_count": 348,
    "relationship_count": 1019,
    "density": 0.0084,
    "avg_degree": 5.8563,
    "avg_unique_neighbors": 5.7931,
    "global_efficiency": 0.3217,
    "avg_path_length": 2.7286,
    "avg_degree_centrality": 0.0169,
    "max_degree_centrality": 0.5216,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0338,
    "degree_assortativity": -0.1764,
    "graph_robustness": 0.8273,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2517,
    "weakly_connected_components": 36,
    "largest_wcc_size": 313,
    "pagerank_top10_percent": 8.59,
    "louvain_communities": 45,
    "louvain_modularity": 0.4295,
    "label_entropy": 1.4992,
    "computational_time": 0.3759422419825569
  },
  "retrieval_queries": []
}
2025-11-30 21:21:10,343 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:21:10,343 - src.pipeline.kg_builder - INFO - Batch 35 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 20.34s, Clean: 0.00s, Neo4j: 0.28s, ACS: 0.38s
2025-11-30 21:21:10,343 - src.pipeline.kg_builder - INFO - Batch 35 completed in 21.00s
Processing KG batches:  49%|████▊     | 35/72 [14:13<14:34, 23.63s/it]2025-11-30 21:21:10,343 - src.pipeline.kg_builder - INFO - Processing batch 36/72 (3 items)
2025-11-30 21:21:10,343 - src.pipeline.kg_builder - DEBUG - Batch 36 current_video_time: 08:53-08:58
2025-11-30 21:21:10,354 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 348
- Total Relationships: 306
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:21:10,354 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:21:10,354 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_0 ~235 words, content: Time: 08:43-08:48 Content: The video sequence captures a series of actions within a laboratory setting, focusing on a person conducting an experiment. The environment is...
2025-11-30 21:21:10,354 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_1 ~240 words, content: - In the third frame, the person is seen adjusting a piece of equipment, possibly a pipette or a similar device, which is connected to...
2025-11-30 21:21:10,354 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_2 ~249 words, content: scientific experiment. The scene begins with a close-up of a laboratory bench, where a person wearing blue gloves is handling a glass container. The bench...
2025-11-30 21:21:10,354 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_3 ~233 words, content: video suggests a professional and organized laboratory setting, with a focus on scientific research and experimentation. In summary, the video depicts a laboratory scene where...
2025-11-30 21:21:10,354 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_4 ~119 words, content: The balance's digital display shows "0.0000 g", indicating it has been tared. The person then uses a metal spatula to transfer a white solid from...
2025-11-30 21:21:10,375 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:21:10,445 - src.components.pre_llm_injector - DEBUG - Found 166 existing chunk embeddings for similarity lookup
2025-11-30 21:21:10,490 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2', '0.811'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4', '0.801')]
2025-11-30 21:21:10,492 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4 via source_chunk_ids
2025-11-30 21:21:10,492 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2
2025-11-30 21:21:10,492 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:21:10,502 - src.components.pre_llm_injector - DEBUG - Limited Person from 93 to 2 external connections
2025-11-30 21:21:10,502 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 93 total -> 2 (internal: 0, external: 2)
2025-11-30 21:21:10,502 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[HANDLES]->(Small Container / ID: 31_0)
2025-11-30 21:21:10,502 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_3', '0.785'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_4', '0.683')]
2025-11-30 21:21:10,502 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_5', '0.768'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3', '0.763')]
2025-11-30 21:21:10,502 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_3', '0.765'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_3', '0.761')]
2025-11-30 21:21:10,502 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_6', '0.731'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3', '0.731')]
2025-11-30 21:21:10,502 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2', '0.811'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4', '0.801')]
2025-11-30 21:21:10,502 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:21:10,502 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_0) (~235 words) with timeout=5.0s retries=3
2025-11-30 21:21:11,827 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:21:11,827 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:21:11,827 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_1) (~240 words) with timeout=5.0s retries=3
2025-11-30 21:21:12,764 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:21:12,764 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:21:12,764 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_2) (~249 words) with timeout=5.0s retries=3
2025-11-30 21:21:13,771 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:21:13,771 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:21:13,772 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_3) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:21:15,191 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:21:15,191 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:21:15,191 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_4) (~119 words) with timeout=5.0s retries=3
2025-11-30 21:21:16,440 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:21:16,440 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:21:16,440 - src.components.pre_llm_injector - INFO - Extracted 28 local triplets from 5 chunks
2025-11-30 21:21:16,440 - src.pipeline.kg_builder - INFO - Pre-extraction: 28 triplets in 6.09s
2025-11-30 21:21:16,440 - src.components.global_refiner - INFO - Capping refinement input: 28 → 15 triplets
2025-11-30 21:21:16,440 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[HANDLES]->(Small Container / ID: 31_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["35_0"]}, {"head": "Person", "relation": "Handles", "tail": "Test_Tube", "source_chunks": ["35_0"]}, {"head": "Person", "relation": "Interacts With", "tail": "Magnetic_Stirrer", "source_chunks": ["35_0"]}, {"head": "Magnetic_Stirrer", "relation": "Contains", "tail": "Beaker", "source_chunks": ["35_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["35_0"]}, {"head": "Person", "relation": "Adjusts", "tail": "Magnetic_Stirrer_Settings", "source_chunks": ["35_0"]}, {"head": "Person", "relation": "Handles", "tail": "Equipment", "source_chunks": ["35_1"]}, {"head": "Person", "relation": "Handles", "tail": "Glass Container", "source_chunks": ["35_1", "35_2"]}, {"head": "Equipment", "relation": "Connected To", "tail": "Tube", "source_chunks": ["35_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["35_1", "35_2"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "Equipment", "source_chunks": ["35_1"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "Supplies", "source_chunks": ["35_1"]}, {"head": "Person", "relation": "Wears", "tail": "Beige Sweater", "source_chunks": ["35_2"]}, {"head": "Person", "relation": "Stands Near", "tail": "Glass Cabinet", "source_chunks": ["35_2"]}, {"head": "Person", "relation": "Observes", "tail": "Experiment", "source_chunks": ["35_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:21:16,440 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~326 words, ~424 tokens)
2025-11-30 21:21:16,440 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:21:32,030 - src.components.global_refiner - DEBUG - LLM call completed in 15.59s
2025-11-30 21:21:32,031 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['35_0']], ['Person', 'Handles', 'Test_Tube', ['35_0']], ['Person', 'Interacts With', 'Magnetic_Stirrer', ['35_0']], ['Magnetic_Stirrer', 'Contains', 'Beaker', ['35_0']], ['Beaker', 'Contains', 'Liquid', ['35_0']], ['Person', 'Adjusts', 'Magnetic_Stirrer_Settings', ['35_0']], ['Person', 'Handles', 'Equipment', ['35_1']], ['Person', 'Handles', 'Glass Container', ['35_1', '35_2']], ['Equipment', 'Connected To', 'Tube', ['35_1']], ['Person', 'Wears', 'Blue Gloves', ['35_1', '35_2']], ['Lab Environment', 'Contains', 'Equipment', ['35_1']], ['Lab Environment', 'Contains', 'Supplies', ['35_1']], ['Person', 'Wears', 'Beige Sweater', ['35_2']], ['Person', 'Stands Near', 'Glass Cabinet', ['35_2']], ['Person', 'Observes', 'Experiment', ['35_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['35_0']], ['Person', 'Handles', 'Test_Tube', ['35_0']], ['Person', 'Interacts With', 'Magnetic_Stirrer', ['35_0']], ['Magnetic_Stirrer', 'Contains', 'Beaker', ['35_0']], ['Beaker', 'Contains', 'Liquid', ['35_0']], ['Person', 'Adjusts', 'Magnetic_Stirrer_Settings', ['35_0']], ['Person', 'Handles', 'Equipment', ['35_1']], ['Person', 'Handles', 'Glass Container', ['35_1', '35_2']], ['Equipment', 'Connected To', 'Tube', ['35_1']], ['Person', 'Wears', 'Blue Gloves', ['35_1', '35_2']], ['Lab Environment', 'Contains', 'Equipment', ['35_1']], ['Lab Environment', 'Contains', 'Supplies', ['35_1']], ['Person', 'Wears', 'Beige Sweater', ['35_2']], ['Person', 'Stands Near', 'Glass Cabinet', ['35_2']], ['Person', 'Observes', 'Experiment', ['35_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Gloves', 'existing_id': '0_3'}, {'local': 'Blue Gloves', 'existing': 'Blue Gloves', 'existing_id': '0_3'}, {'local': 'Beige Sweater', 'existing': 'Beige Sweater', 'existing_id': '0_4'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}]
2025-11-30 21:21:32,031 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['35_0']], ['Person', 'Handles', 'Test_Tube', ['35_0']], ['Person', 'Interacts With', 'Magnetic_Stirrer', ['35_0']]]
2025-11-30 21:21:32,031 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['35_0']], ['Person', 'Handles', 'Test_Tube', ['35_0']], ['Person', 'Interacts With', 'Magnetic_Stirrer', ['35_0']]]
2025-11-30 21:21:32,031 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=3, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Gloves', 'existing_id': '0_3'}, {'local': 'Blue Gloves', 'existing': 'Blue Gloves', 'existing_id': '0_3'}, {'local': 'Beige Sweater', 'existing': 'Beige Sweater', 'existing_id': '0_4'}]
2025-11-30 21:21:32,031 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=2, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}]
2025-11-30 21:21:32,031 - src.components.global_refiner - INFO - LLM suggested 3 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Gloves', 'existing_id': '0_3'}, {'local': 'Blue Gloves', 'existing': 'Blue Gloves', 'existing_id': '0_3'}, {'local': 'Beige Sweater', 'existing': 'Beige Sweater', 'existing_id': '0_4'}]
2025-11-30 21:21:32,031 - src.components.global_refiner - INFO - LLM suggested 2 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}]
2025-11-30 21:21:32,031 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 30 triplets (total: 15.59s, LLM: 15.59s)
2025-11-30 21:21:32,031 - src.pipeline.kg_builder - INFO - Global refinement: 30 triplets in 15.59s
2025-11-30 21:21:32,031 - src.pipeline.kg_builder - INFO - Using 30 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:21:32,031 - src.pipeline.kg_builder - INFO - Pushing batch 36/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:21:32,032 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:21:32,222 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=363, relationships=320
2025-11-30 21:21:32,222 - src.components.neo4j_handler - INFO - Applying 3 merge instructions
2025-11-30 21:21:32,222 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Gloves
2025-11-30 21:21:32,223 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue Gloves -> Blue Gloves
2025-11-30 21:21:32,223 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Beige Sweater -> Beige Sweater
2025-11-30 21:21:32,223 - src.components.neo4j_handler - INFO - Applying 2 prune instructions
2025-11-30 21:21:32,228 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:21:32,231 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Gloves
2025-11-30 21:21:32,231 - src.components.neo4j_handler - INFO - Applying 15 inter-chunk relations
2025-11-30 21:21:32,232 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:21:32,234 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Handles]-> Test_Tube
2025-11-30 21:21:32,236 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Interacts With]-> Magnetic_Stirrer
2025-11-30 21:21:32,238 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Magnetic_Stirrer -[Contains]-> Beaker
2025-11-30 21:21:32,240 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Contains]-> Liquid
2025-11-30 21:21:32,266 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Adjusts]-> Magnetic_Stirrer_Settings
2025-11-30 21:21:32,268 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Handles]-> Equipment
2025-11-30 21:21:32,271 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Handles]-> Glass Container
2025-11-30 21:21:32,273 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Equipment -[Connected To]-> Tube
2025-11-30 21:21:32,275 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue Gloves
2025-11-30 21:21:32,278 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab Environment -[Contains]-> Equipment
2025-11-30 21:21:32,280 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab Environment -[Contains]-> Supplies
2025-11-30 21:21:32,283 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Beige Sweater
2025-11-30 21:21:32,285 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Stands Near]-> Glass Cabinet
2025-11-30 21:21:32,287 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Observes]-> Experiment
2025-11-30 21:21:32,288 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:21:32,296 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=362, relationships=319
2025-11-30 21:21:32,299 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:21:32,299 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:21:32,300 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:21:32,300 - src.components.neo4j_handler - INFO - Batch injected in 0.27s (triplets: 0.26s, indexes: 0.00s)
2025-11-30 21:21:32,301 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 171, 'with_embedding': 171, 'linked_chunks': 134}
2025-11-30 21:21:32,301 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:21:32,346 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 362 nodes
2025-11-30 21:21:32,483 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 325 nodes
2025-11-30 21:21:32,637 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 362, 'relationship_count': 1051, 'density': 0.008, 'avg_degree': 5.8066, 'avg_unique_neighbors': 5.7459, 'global_efficiency': 0.3214, 'avg_path_length': 2.7179, 'avg_degree_centrality': 0.0161, 'max_degree_centrality': 0.5291, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0305, 'degree_assortativity': -0.1913, 'graph_robustness': 0.8202, 'diameter_estimate': 6, 'clustering_coefficient': 0.2537, 'weakly_connected_components': 38, 'largest_wcc_size': 325, 'pagerank_top10_percent': 8.29, 'louvain_communities': 46, 'louvain_modularity': 0.4362, 'label_entropy': 1.4989, 'computational_time': 0.3352827050257474}
2025-11-30 21:21:32,637 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 35, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508892.6372118, 'total_time': 22.293905230006203, 'aggregation': 2.859043888747692e-06, 'network_info': 0.01066114695277065, 'llm_extraction': 21.67753584298771, 'data_cleaning': 4.3120002374053e-05, 'neo4j_injection': 0.2685340989846736, 'embedding_time': 0, 'indexing_time': 0.003947413992136717, 'graph_injection_time': 0.26423001498915255, 'acs_metrics': {'node_count': 362, 'relationship_count': 1051, 'density': 0.008, 'avg_degree': 5.8066, 'avg_unique_neighbors': 5.7459, 'global_efficiency': 0.3214, 'avg_path_length': 2.7179, 'avg_degree_centrality': 0.0161, 'max_degree_centrality': 0.5291, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0305, 'degree_assortativity': -0.1913, 'graph_robustness': 0.8202, 'diameter_estimate': 6, 'clustering_coefficient': 0.2537, 'weakly_connected_components': 38, 'largest_wcc_size': 325, 'pagerank_top10_percent': 8.29, 'louvain_communities': 46, 'louvain_modularity': 0.4362, 'label_entropy': 1.4989, 'computational_time': 0.3352827050257474}, 'retrieval_queries': []}
2025-11-30 21:21:32,637 - src.pipeline.kg_builder - DEBUG - Batch 35 metrics: {
  "batch_idx": 35,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508892.6372118,
  "total_time": 22.293905230006203,
  "aggregation": 2.859043888747692e-06,
  "network_info": 0.01066114695277065,
  "llm_extraction": 21.67753584298771,
  "data_cleaning": 4.3120002374053e-05,
  "neo4j_injection": 0.2685340989846736,
  "embedding_time": 0,
  "indexing_time": 0.003947413992136717,
  "graph_injection_time": 0.26423001498915255,
  "acs_metrics": {
    "node_count": 362,
    "relationship_count": 1051,
    "density": 0.008,
    "avg_degree": 5.8066,
    "avg_unique_neighbors": 5.7459,
    "global_efficiency": 0.3214,
    "avg_path_length": 2.7179,
    "avg_degree_centrality": 0.0161,
    "max_degree_centrality": 0.5291,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0305,
    "degree_assortativity": -0.1913,
    "graph_robustness": 0.8202,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2537,
    "weakly_connected_components": 38,
    "largest_wcc_size": 325,
    "pagerank_top10_percent": 8.29,
    "louvain_communities": 46,
    "louvain_modularity": 0.4362,
    "label_entropy": 1.4989,
    "computational_time": 0.3352827050257474
  },
  "retrieval_queries": []
}
2025-11-30 21:21:32,638 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:21:32,638 - src.pipeline.kg_builder - INFO - Batch 36 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 21.68s, Clean: 0.00s, Neo4j: 0.27s, ACS: 0.34s
2025-11-30 21:21:32,638 - src.pipeline.kg_builder - INFO - Batch 36 completed in 22.29s
Processing KG batches:  50%|█████     | 36/72 [14:35<13:56, 23.23s/it]2025-11-30 21:21:32,638 - src.pipeline.kg_builder - INFO - Processing batch 37/72 (3 items)
2025-11-30 21:21:32,638 - src.pipeline.kg_builder - DEBUG - Batch 37 current_video_time: 09:08-09:13
2025-11-30 21:21:32,650 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 362
- Total Relationships: 319
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:21:32,650 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:21:32,650 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_0 ~221 words, content: Time: 08:58-09:03 Content: The video sequence captures a detailed laboratory procedure, likely a chemical synthesis or analysis, performed by a scientist wearing blue nitrile gloves....
2025-11-30 21:21:32,650 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_1 ~224 words, content: The presence of the magnetic stirrer in the background indicates that the contents of the flask will be mixed, likely to ensure homogeneity or to...
2025-11-30 21:21:32,650 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_2 ~208 words, content: steady, while their right hand controls the vial, tilting it to pour the liquid. This action is being performed with great care to ensure an...
2025-11-30 21:21:32,650 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_3 ~221 words, content: laboratory setting with a white door, a wall-mounted electrical panel with a high-voltage warning sign, and cardboard boxes. The overall environment suggests a controlled and...
2025-11-30 21:21:32,650 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_4 ~69 words, content: process. The digital scale in the background displays a reading of "0.18," which could be the mass of a substance being weighed, possibly the reagent...
2025-11-30 21:21:32,670 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:21:32,741 - src.components.pre_llm_injector - DEBUG - Found 171 existing chunk embeddings for similarity lookup
2025-11-30 21:21:32,788 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3', '0.793'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.788')]
2025-11-30 21:21:32,790 - src.components.pre_llm_injector - DEBUG - Found 4 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1
2025-11-30 21:21:32,790 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:21:32,790 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3
2025-11-30 21:21:32,790 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:21:32,798 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 1 total -> 1 (internal: 0, external: 1)
2025-11-30 21:21:32,798 - src.components.pre_llm_injector - DEBUG - Subgraph: (Laboratory_Glassware / ID: 4_2)-[ENSURES]->(Accurate_Transfer / ID: 16_3)
2025-11-30 21:21:32,801 - src.components.pre_llm_injector - DEBUG - Limited Person from 97 to 2 external connections
2025-11-30 21:21:32,801 - src.components.pre_llm_injector - DEBUG - Limited Equipment from 10 to 2 external connections
2025-11-30 21:21:32,801 - src.components.pre_llm_injector - DEBUG - Limited Magnetic_Stirrer from 9 to 2 external connections
2025-11-30 21:21:32,801 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 122 total -> 12 (internal: 5, external: 7)
2025-11-30 21:21:32,801 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HANDLES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[TARES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Magnetic_Stirrer / ID: 4_2), (Equipment / ID: 1_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[STANDS_NEAR]->(Glass Cabinet / ID: 35_2), (Equipment / ID: 1_0)-[DISPLAYS]->(56.303 G / ID: 6_0), (Equipment / ID: 1_0)-[CONNECTED_TO]->(Tube / ID: 35_1), (Glass_Flask / ID: 13_2)-[IS_CONNECTED_TO]->(Magnetic_Stirrer / ID: 4_2), (Liquid_In_Small_Container / ID: 5_0)-[IS_ON]->(Magnetic_Stirrer / ID: 4_2), (Mass Of Liquid / ID: 15_1)-[IS_PART_OF]->(Chemical_Solution / ID: 5_1)
2025-11-30 21:21:32,801 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.788'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_0', '0.778')]
2025-11-30 21:21:32,801 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.717'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_2', '0.694')]
2025-11-30 21:21:32,801 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_1', '0.593'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_2', '0.571')]
2025-11-30 21:21:32,801 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_0', '0.610'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.597')]
2025-11-30 21:21:32,801 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3', '0.793'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.782')]
2025-11-30 21:21:32,801 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:21:32,802 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_0) (~221 words) with timeout=5.0s retries=3
2025-11-30 21:21:34,203 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:21:34,203 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:21:34,204 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_1) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:21:35,266 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:21:35,266 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:21:35,266 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_2) (~208 words) with timeout=5.0s retries=3
2025-11-30 21:21:36,410 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:21:36,410 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:21:36,410 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_3) (~221 words) with timeout=5.0s retries=3
2025-11-30 21:21:37,621 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:21:37,621 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:21:37,622 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_4) (~69 words) with timeout=5.0s retries=3
2025-11-30 21:21:38,653 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:21:38,653 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:21:38,653 - src.components.pre_llm_injector - INFO - Extracted 26 local triplets from 5 chunks
2025-11-30 21:21:38,653 - src.pipeline.kg_builder - INFO - Pre-extraction: 26 triplets in 6.00s
2025-11-30 21:21:38,653 - src.components.global_refiner - INFO - Capping refinement input: 26 → 15 triplets
2025-11-30 21:21:38,653 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Laboratory_Glassware / ID: 4_2)-[ENSURES]->(Accurate_Transfer / ID: 16_3)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[HANDLES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[TARES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Magnetic_Stirrer / ID: 4_2), (Equipment / ID: 1_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[HOLDS]->(Metal_Spatula / ID: 6_2), (Person / ID: 0_0)-[STANDS_NEAR]->(Glass Cabinet / ID: 35_2), (Equipment / ID: 1_0)-[DISPLAYS]->(56.303 G / ID: 6_0), (Equipment / ID: 1_0)-[CONNECTED_TO]->(Tube / ID: 35_1), (Glass_Flask / ID: 13_2)-[IS_CONNECTED_TO]->(Magnetic_Stirrer / ID: 4_2), (Liquid_In_Small_Container / ID: 5_0)-[IS_ON]->(Magnetic_Stirrer / ID: 4_2), (Mass Of Liquid / ID: 15_1)-[IS_PART_OF]->(Chemical_Solution / ID: 5_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Scientist", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["36_0"]}, {"head": "Scientist", "relation": "Holds", "tail": "Glass_Cylinder", "source_chunks": ["36_0"]}, {"head": "Glass_Cylinder", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["36_0"]}, {"head": "Scientist", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["36_0", "36_1"]}, {"head": "Round_Bottom_Flask", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["36_0"]}, {"head": "Magnetic_Stirrer", "relation": "Mixes", "tail": "Solution", "source_chunks": ["36_0"]}, {"head": "Scientist", "relation": "Holds", "tail": "Glass Cylinder", "source_chunks": ["36_1"]}, {"head": "Liquid", "relation": "Is In", "tail": "Glass Cylinder", "source_chunks": ["36_1"]}, {"head": "Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["36_1"]}, {"head": "Magnetic Stirrer", "relation": "Mixes", "tail": "Contents", "source_chunks": ["36_1"]}, {"head": "Scientist", "relation": "Handles", "tail": "Chemicals", "source_chunks": ["36_1"]}, {"head": "Person", "relation": "Holds", "tail": "Vial", "source_chunks": ["36_2"]}, {"head": "Person", "relation": "Controls", "tail": "Burette", "source_chunks": ["36_2"]}, {"head": "Burette", "relation": "Contains", "tail": "Liquid", "source_chunks": ["36_2", "36_3", "36_4"]}, {"head": "Balance", "relation": "Displays", "tail": "0.18_G", "source_chunks": ["36_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:21:38,653 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~404 words, ~525 tokens)
2025-11-30 21:21:38,653 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:21:52,121 - src.components.global_refiner - DEBUG - LLM call completed in 13.47s
2025-11-30 21:21:52,122 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Scientist', 'Wears', 'Blue_Nitrile_Gloves', ['36_0']], ['Scientist', 'Holds', 'Glass_Cylinder', ['36_0']], ['Glass_Cylinder', 'Contains', 'Clear_Liquid', ['36_0']], ['Scientist', 'Transfers', 'Liquid', ['36_0', '36_1']], ['Round_Bottom_Flask', 'Contains', 'Clear_Liquid', ['36_0']], ['Magnetic_Stirrer', 'Mixes', 'Solution', ['36_0']], ['Scientist', 'Holds', 'Glass Cylinder', ['36_1']], ['Liquid', 'Is In', 'Glass Cylinder', ['36_1']], ['Flask', 'Contains', 'Liquid', ['36_1']], ['Magnetic Stirrer', 'Mixes', 'Contents', ['36_1']], ['Scientist', 'Handles', 'Chemicals', ['36_1']], ['Person', 'Holds', 'Vial', ['36_2']], ['Person', 'Controls', 'Burette', ['36_2']], ['Burette', 'Contains', 'Liquid', ['36_2', '36_3', '36_4']], ['Balance', 'Displays', '0.18_G', ['36_2']]] inter_chunk_relations=[['Scientist', 'Holds', 'Glass Cylinder', ['36_1']], ['Scientist', 'Transfers', 'Liquid', ['36_0', '36_1']], ['Person', 'Holds', 'Vial', ['36_2']], ['Person', 'Controls', 'Burette', ['36_2']], ['Balance', 'Displays', '0.18_G', ['36_2']]] merge_instructions=[{'local': 'Glass Cylinder', 'existing': 'Glass_Cylinder', 'existing_id': '6_2'}, {'local': 'Round_Bottom_Flask', 'existing': 'Glass_Flask', 'existing_id': '13_2'}, {'local': 'Magnetic Stirrer', 'existing': 'Magnetic_Stirrer', 'existing_id': '4_2'}, {'local': 'Scientist', 'existing': 'Person', 'existing_id': '0_0'}] prune_instructions=[{'head': 'Person', 'relation': 'HOLDS', 'tail': 'Metal_Spatula'}, {'head': 'Person', 'relation': 'STANDS_NEAR', 'tail': 'Glass Cabinet'}, {'head': 'Equipment', 'relation': 'DISPLAYS', 'tail': '56.303 G'}, {'head': 'Equipment', 'relation': 'CONNECTED_TO', 'tail': 'Tube'}]
2025-11-30 21:21:52,122 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Scientist', 'Wears', 'Blue_Nitrile_Gloves', ['36_0']], ['Scientist', 'Holds', 'Glass_Cylinder', ['36_0']], ['Glass_Cylinder', 'Contains', 'Clear_Liquid', ['36_0']]]
2025-11-30 21:21:52,122 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Scientist', 'Holds', 'Glass Cylinder', ['36_1']], ['Scientist', 'Transfers', 'Liquid', ['36_0', '36_1']], ['Person', 'Holds', 'Vial', ['36_2']]]
2025-11-30 21:21:52,122 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Glass Cylinder', 'existing': 'Glass_Cylinder', 'existing_id': '6_2'}, {'local': 'Round_Bottom_Flask', 'existing': 'Glass_Flask', 'existing_id': '13_2'}, {'local': 'Magnetic Stirrer', 'existing': 'Magnetic_Stirrer', 'existing_id': '4_2'}]
2025-11-30 21:21:52,122 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'HOLDS', 'tail': 'Metal_Spatula'}, {'head': 'Person', 'relation': 'STANDS_NEAR', 'tail': 'Glass Cabinet'}, {'head': 'Equipment', 'relation': 'DISPLAYS', 'tail': '56.303 G'}]
2025-11-30 21:21:52,122 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Glass Cylinder', 'existing': 'Glass_Cylinder', 'existing_id': '6_2'}, {'local': 'Round_Bottom_Flask', 'existing': 'Glass_Flask', 'existing_id': '13_2'}, {'local': 'Magnetic Stirrer', 'existing': 'Magnetic_Stirrer', 'existing_id': '4_2'}, {'local': 'Scientist', 'existing': 'Person', 'existing_id': '0_0'}]
2025-11-30 21:21:52,122 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'HOLDS', 'tail': 'Metal_Spatula'}, {'head': 'Person', 'relation': 'STANDS_NEAR', 'tail': 'Glass Cabinet'}, {'head': 'Equipment', 'relation': 'DISPLAYS', 'tail': '56.303 G'}, {'head': 'Equipment', 'relation': 'CONNECTED_TO', 'tail': 'Tube'}]
2025-11-30 21:21:52,122 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 13.47s, LLM: 13.47s)
2025-11-30 21:21:52,122 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 13.47s
2025-11-30 21:21:52,122 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:21:52,122 - src.pipeline.kg_builder - INFO - Pushing batch 37/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:21:52,122 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:21:52,305 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=376, relationships=333
2025-11-30 21:21:52,305 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:21:52,306 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass Cylinder -> Glass_Cylinder
2025-11-30 21:21:52,309 - src.components.neo4j_handler - DEBUG - APOC merge successful: Round_Bottom_Flask -> Glass_Flask
2025-11-30 21:21:52,312 - src.components.neo4j_handler - DEBUG - APOC merge successful: Magnetic Stirrer -> Magnetic_Stirrer
2025-11-30 21:21:52,316 - src.components.neo4j_handler - DEBUG - APOC merge successful: Scientist -> Person
2025-11-30 21:21:52,316 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:21:52,322 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[HOLDS]-> Metal_Spatula
2025-11-30 21:21:52,323 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[STANDS_NEAR]-> Glass Cabinet
2025-11-30 21:21:52,325 - src.components.neo4j_handler - DEBUG - Pruned relationship: Equipment -[DISPLAYS]-> 56.303 G
2025-11-30 21:21:52,326 - src.components.neo4j_handler - DEBUG - Pruned relationship: Equipment -[CONNECTED_TO]-> Tube
2025-11-30 21:21:52,326 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:21:52,326 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Scientist -[Holds]-> Glass Cylinder
2025-11-30 21:21:52,327 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Scientist -[Transfers]-> Liquid
2025-11-30 21:21:52,328 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Vial
2025-11-30 21:21:52,329 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Controls]-> Burette
2025-11-30 21:21:52,330 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Balance -[Displays]-> 0.18_G
2025-11-30 21:21:52,331 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:21:52,337 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=372, relationships=329
2025-11-30 21:21:52,338 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:21:52,338 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:21:52,338 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:21:52,338 - src.components.neo4j_handler - INFO - Batch injected in 0.22s (triplets: 0.21s, indexes: 0.00s)
2025-11-30 21:21:52,339 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 176, 'with_embedding': 176, 'linked_chunks': 139}
2025-11-30 21:21:52,340 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:21:52,393 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 372 nodes
2025-11-30 21:21:52,535 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 335 nodes
2025-11-30 21:21:52,700 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 372, 'relationship_count': 1082, 'density': 0.0078, 'avg_degree': 5.8172, 'avg_unique_neighbors': 5.7581, 'global_efficiency': 0.3223, 'avg_path_length': 2.7258, 'avg_degree_centrality': 0.0157, 'max_degree_centrality': 0.5283, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0401, 'degree_assortativity': -0.1939, 'graph_robustness': 0.6691, 'diameter_estimate': 6, 'clustering_coefficient': 0.2491, 'weakly_connected_components': 38, 'largest_wcc_size': 335, 'pagerank_top10_percent': 8.06, 'louvain_communities': 48, 'louvain_modularity': 0.4404, 'label_entropy': 1.499, 'computational_time': 0.3601689989445731}
2025-11-30 21:21:52,700 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 36, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508912.7004614, 'total_time': 20.062212573946454, 'aggregation': 3.2139942049980164e-06, 'network_info': 0.011781294015236199, 'llm_extraction': 19.472156292991713, 'data_cleaning': 1.870701089501381e-05, 'neo4j_injection': 0.21644026401918381, 'embedding_time': 0, 'indexing_time': 0.0012407610192894936, 'graph_injection_time': 0.21497118496336043, 'acs_metrics': {'node_count': 372, 'relationship_count': 1082, 'density': 0.0078, 'avg_degree': 5.8172, 'avg_unique_neighbors': 5.7581, 'global_efficiency': 0.3223, 'avg_path_length': 2.7258, 'avg_degree_centrality': 0.0157, 'max_degree_centrality': 0.5283, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0401, 'degree_assortativity': -0.1939, 'graph_robustness': 0.6691, 'diameter_estimate': 6, 'clustering_coefficient': 0.2491, 'weakly_connected_components': 38, 'largest_wcc_size': 335, 'pagerank_top10_percent': 8.06, 'louvain_communities': 48, 'louvain_modularity': 0.4404, 'label_entropy': 1.499, 'computational_time': 0.3601689989445731}, 'retrieval_queries': []}
2025-11-30 21:21:52,700 - src.pipeline.kg_builder - DEBUG - Batch 36 metrics: {
  "batch_idx": 36,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508912.7004614,
  "total_time": 20.062212573946454,
  "aggregation": 3.2139942049980164e-06,
  "network_info": 0.011781294015236199,
  "llm_extraction": 19.472156292991713,
  "data_cleaning": 1.870701089501381e-05,
  "neo4j_injection": 0.21644026401918381,
  "embedding_time": 0,
  "indexing_time": 0.0012407610192894936,
  "graph_injection_time": 0.21497118496336043,
  "acs_metrics": {
    "node_count": 372,
    "relationship_count": 1082,
    "density": 0.0078,
    "avg_degree": 5.8172,
    "avg_unique_neighbors": 5.7581,
    "global_efficiency": 0.3223,
    "avg_path_length": 2.7258,
    "avg_degree_centrality": 0.0157,
    "max_degree_centrality": 0.5283,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.0401,
    "degree_assortativity": -0.1939,
    "graph_robustness": 0.6691,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2491,
    "weakly_connected_components": 38,
    "largest_wcc_size": 335,
    "pagerank_top10_percent": 8.06,
    "louvain_communities": 48,
    "louvain_modularity": 0.4404,
    "label_entropy": 1.499,
    "computational_time": 0.3601689989445731
  },
  "retrieval_queries": []
}
2025-11-30 21:21:52,701 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:21:52,701 - src.pipeline.kg_builder - INFO - Batch 37 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.47s, Clean: 0.00s, Neo4j: 0.22s, ACS: 0.36s
2025-11-30 21:21:52,701 - src.pipeline.kg_builder - INFO - Batch 37 completed in 20.06s
Processing KG batches:  51%|█████▏    | 37/72 [14:55<12:59, 22.28s/it]2025-11-30 21:21:52,701 - src.pipeline.kg_builder - INFO - Processing batch 38/72 (3 items)
2025-11-30 21:21:52,701 - src.pipeline.kg_builder - DEBUG - Batch 38 current_video_time: 09:23-09:28
2025-11-30 21:21:52,712 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 372
- Total Relationships: 329
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:21:52,712 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:21:52,712 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_37_0 ~224 words, content: Time: 09:13-09:18 Content: The video sequence captures a detailed laboratory procedure, likely a chemical titration or solution preparation, performed by a person wearing blue nitrile...
2025-11-30 21:21:52,712 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_37_1 ~231 words, content: step in the procedure is to weigh the cylinder to determine the exact mass of the liquid that was added. This is a critical step...
2025-11-30 21:21:52,712 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_37_2 ~222 words, content: Mettler Toledo model, is visible on the left, with its display showing "0.000 g," suggesting it is used for weighing. To the right, a white...
2025-11-30 21:21:52,712 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_37_3 ~225 words, content: **Initial Setup**: The person, wearing blue nitrile gloves, is handling laboratory glassware. Their left hand holds a tall, graduated cylinder, which contains a clear liquid....
2025-11-30 21:21:52,712 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_37_4 ~46 words, content: In summary, the video shows a person in a laboratory setting, using a pipette to transfer a liquid from one container to another, likely as...
2025-11-30 21:21:52,732 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:21:52,807 - src.components.pre_llm_injector - DEBUG - Found 176 existing chunk embeddings for similarity lookup
2025-11-30 21:21:52,854 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_0', '0.815'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_4', '0.810')]
2025-11-30 21:21:52,856 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_4 via source_chunk_ids
2025-11-30 21:21:52,857 - src.components.pre_llm_injector - DEBUG - Found 5 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_0
2025-11-30 21:21:52,857 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:21:52,867 - src.components.pre_llm_injector - DEBUG - Limited Person from 105 to 2 external connections
2025-11-30 21:21:52,867 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 110 total -> 7 (internal: 3, external: 4)
2025-11-30 21:21:52,867 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(White Plastic Bottle / ID: 5_2), (White Plastic Bottle / ID: 5_2)-[HAS]->(Red Cap / ID: 10_0), (White Plastic Bottle / ID: 5_2)-[CONTAINS]->(Chemical Substance / ID: 10_0), (Person / ID: 0_0)-[OBSERVES]->(Experiment / ID: 35_2), (Digital_Balance / ID: 16_0)-[IS_USED_BY]->(Person / ID: 0_0), (White Plastic Bottle / ID: 5_2)-[HAS_LABEL]->(Sodium Hydroxide / ID: 5_2), (Power Strip / ID: 3_1)-[DISPLAYS]->(80.15 G / ID: 10_0)
2025-11-30 21:21:52,868 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_0', '0.776'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.764')]
2025-11-30 21:21:52,868 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_2', '0.619'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_4', '0.609')]
2025-11-30 21:21:52,868 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_0', '0.815'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_1', '0.790')]
2025-11-30 21:21:52,868 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1', '0.763'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_3', '0.728')]
2025-11-30 21:21:52,868 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_4', '0.810'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2', '0.808')]
2025-11-30 21:21:52,868 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:21:52,868 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_37_0) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:21:54,276 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:21:54,276 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:21:54,276 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_37_1) (~231 words) with timeout=5.0s retries=3
2025-11-30 21:21:55,325 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:21:55,325 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:21:55,326 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_37_2) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:21:56,595 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:21:56,595 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:21:56,595 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_37_3) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:21:57,923 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:21:57,924 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:21:57,924 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_37_4) (~46 words) with timeout=5.0s retries=3
2025-11-30 21:21:58,920 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:21:58,920 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:21:58,920 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 5 chunks
2025-11-30 21:21:58,920 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 6.21s
2025-11-30 21:21:58,920 - src.components.global_refiner - INFO - Capping refinement input: 22 → 15 triplets
2025-11-30 21:21:58,921 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[HOLDS]->(White Plastic Bottle / ID: 5_2), (White Plastic Bottle / ID: 5_2)-[HAS]->(Red Cap / ID: 10_0), (White Plastic Bottle / ID: 5_2)-[CONTAINS]->(Chemical Substance / ID: 10_0), (Person / ID: 0_0)-[OBSERVES]->(Experiment / ID: 35_2), (Digital_Balance / ID: 16_0)-[IS_USED_BY]->(Person / ID: 0_0), (White Plastic Bottle / ID: 5_2)-[HAS_LABEL]->(Sodium Hydroxide / ID: 5_2), (Power Strip / ID: 3_1)-[DISPLAYS]->(80.15 G / ID: 10_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["37_0", "37_3"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated_Cylinder", "source_chunks": ["37_0", "37_3"]}, {"head": "Graduated_Cylinder", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["37_0", "37_3"]}, {"head": "Person", "relation": "Uses", "tail": "Digital_Balance", "source_chunks": ["37_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "0.000_G", "source_chunks": ["37_0"]}, {"head": "Person", "relation": "Performs", "tail": "Solution_Preparation", "source_chunks": ["37_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["37_1"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated Cylinder", "source_chunks": ["37_1", "37_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["37_1", "37_2", "37_3", "37_4"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["37_1"]}, {"head": "Graduated Cylinder", "relation": "Contains", "tail": "Liquid", "source_chunks": ["37_1"]}, {"head": "Digital Balance", "relation": "Measures", "tail": "Mass", "source_chunks": ["37_1"]}, {"head": "Mettler Toledo", "relation": "Displays", "tail": "0.000 G", "source_chunks": ["37_2"]}, {"head": "White Magnetic Stirrer", "relation": "Has", "tail": "Glass Container", "source_chunks": ["37_2"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Beaker", "source_chunks": ["37_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:21:58,921 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~380 words, ~494 tokens)
2025-11-30 21:21:58,921 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:22:15,789 - src.components.global_refiner - DEBUG - LLM call completed in 16.87s
2025-11-30 21:22:15,789 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue Nitrile Gloves', ['37_0', '37_1']], ['Person', 'Holds', 'Graduated Cylinder', ['37_0', '37_1', '37_2']], ['Graduated Cylinder', 'Contains', 'Clear Liquid', ['37_0', '37_3']], ['Person', 'Uses', 'Digital Balance', ['37_0']], ['Digital Balance', 'Displays', '0.000 G', ['37_0']], ['Person', 'Performs', 'Solution Preparation', ['37_0']], ['Person', 'Uses', 'Pipette', ['37_1', '37_2', '37_3', '37_4']], ['Person', 'Transfers', 'Liquid', ['37_1']], ['Graduated Cylinder', 'Contains', 'Liquid', ['37_1']], ['Digital Balance', 'Measures', 'Mass', ['37_1']], ['Mettler Toledo', 'Displays', '0.000 G', ['37_2']], ['White Magnetic Stirrer', 'Has', 'Glass Container', ['37_2']], ['Lab Table', 'Contains', 'Beaker', ['37_2']]] inter_chunk_relations=[['Digital Balance', 'Displays', '80.15 G', ['37_0']], ['Digital Balance', 'Displays', '0.000 G', ['37_0', '37_2']], ['Person', 'Holds', 'White Plastic Bottle', ['37_0']], ['Person', 'Observes', 'Experiment', ['37_0']], ['Person', 'Uses', 'Pipette', ['37_0', '37_1', '37_2', '37_3', '37_4']], ['Person', 'Wears', 'Blue Nitrile Gloves', ['37_0', '37_1']], ['Person', 'Holds', 'Graduated Cylinder', ['37_0', '37_1', '37_2']], ['Digital Balance', 'Measures', 'Mass', ['37_1']], ['Mettler Toledo', 'Displays', '0.000 G', ['37_2']], ['White Magnetic Stirrer', 'Has', 'Glass Container', ['37_2']], ['Lab Table', 'Contains', 'Beaker', ['37_2']]] merge_instructions=[{'local': 'Blue Nitrile Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_0'}, {'local': 'Graduated Cylinder', 'existing': 'Graduated_Cylinder', 'existing_id': '0_0'}, {'local': 'Clear Liquid', 'existing': 'Chemical Substance', 'existing_id': '10_0'}, {'local': 'Liquid', 'existing': 'Chemical Substance', 'existing_id': '10_0'}] prune_instructions=[{'head': 'Digital Balance', 'relation': 'Displays', 'tail': '80.15 G'}, {'head': 'Digital Balance', 'relation': 'Displays', 'tail': '0.000 G'}, {'head': 'Digital Balance', 'relation': 'Displays', 'tail': '80.15 G'}, {'head': 'Digital Balance', 'relation': 'Displays', 'tail': '0.000 G'}]
2025-11-30 21:22:15,789 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=13, sample=[['Person', 'Wears', 'Blue Nitrile Gloves', ['37_0', '37_1']], ['Person', 'Holds', 'Graduated Cylinder', ['37_0', '37_1', '37_2']], ['Graduated Cylinder', 'Contains', 'Clear Liquid', ['37_0', '37_3']]]
2025-11-30 21:22:15,790 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=11, sample=[['Digital Balance', 'Displays', '80.15 G', ['37_0']], ['Digital Balance', 'Displays', '0.000 G', ['37_0', '37_2']], ['Person', 'Holds', 'White Plastic Bottle', ['37_0']]]
2025-11-30 21:22:15,790 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue Nitrile Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_0'}, {'local': 'Graduated Cylinder', 'existing': 'Graduated_Cylinder', 'existing_id': '0_0'}, {'local': 'Clear Liquid', 'existing': 'Chemical Substance', 'existing_id': '10_0'}]
2025-11-30 21:22:15,790 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Digital Balance', 'relation': 'Displays', 'tail': '80.15 G'}, {'head': 'Digital Balance', 'relation': 'Displays', 'tail': '0.000 G'}, {'head': 'Digital Balance', 'relation': 'Displays', 'tail': '80.15 G'}]
2025-11-30 21:22:15,790 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue Nitrile Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_0'}, {'local': 'Graduated Cylinder', 'existing': 'Graduated_Cylinder', 'existing_id': '0_0'}, {'local': 'Clear Liquid', 'existing': 'Chemical Substance', 'existing_id': '10_0'}, {'local': 'Liquid', 'existing': 'Chemical Substance', 'existing_id': '10_0'}]
2025-11-30 21:22:15,790 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Digital Balance', 'relation': 'Displays', 'tail': '80.15 G'}, {'head': 'Digital Balance', 'relation': 'Displays', 'tail': '0.000 G'}, {'head': 'Digital Balance', 'relation': 'Displays', 'tail': '80.15 G'}, {'head': 'Digital Balance', 'relation': 'Displays', 'tail': '0.000 G'}]
2025-11-30 21:22:15,790 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 24 triplets (total: 16.87s, LLM: 16.87s)
2025-11-30 21:22:15,790 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 16.87s
2025-11-30 21:22:15,790 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:22:15,790 - src.pipeline.kg_builder - INFO - Pushing batch 38/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:22:15,790 - src.components.neo4j_handler - INFO - Adding 16 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:22:16,020 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=382, relationships=340
2025-11-30 21:22:16,021 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:22:16,021 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue Nitrile Gloves -> Blue_Nitrile_Gloves
2025-11-30 21:22:16,026 - src.components.neo4j_handler - DEBUG - APOC merge successful: Graduated Cylinder -> Graduated_Cylinder
2025-11-30 21:22:16,028 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear Liquid -> Chemical Substance
2025-11-30 21:22:16,032 - src.components.neo4j_handler - DEBUG - APOC merge successful: Liquid -> Chemical Substance
2025-11-30 21:22:16,032 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:22:16,037 - src.components.neo4j_handler - DEBUG - Pruned relationship: Digital Balance -[Displays]-> 80.15 G
2025-11-30 21:22:16,040 - src.components.neo4j_handler - DEBUG - Pruned relationship: Digital Balance -[Displays]-> 0.000 G
2025-11-30 21:22:16,041 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Digital Balance -[Displays]-> 80.15 G
2025-11-30 21:22:16,042 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Digital Balance -[Displays]-> 0.000 G
2025-11-30 21:22:16,042 - src.components.neo4j_handler - INFO - Applying 11 inter-chunk relations
2025-11-30 21:22:16,043 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital Balance -[Displays]-> 80.15 G
2025-11-30 21:22:16,045 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital Balance -[Displays]-> 0.000 G
2025-11-30 21:22:16,047 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> White Plastic Bottle
2025-11-30 21:22:16,049 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Observes]-> Experiment
2025-11-30 21:22:16,051 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> Pipette
2025-11-30 21:22:16,052 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue Nitrile Gloves
2025-11-30 21:22:16,054 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Graduated Cylinder
2025-11-30 21:22:16,055 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital Balance -[Measures]-> Mass
2025-11-30 21:22:16,057 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Mettler Toledo -[Displays]-> 0.000 G
2025-11-30 21:22:16,061 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: White Magnetic Stirrer -[Has]-> Glass Container
2025-11-30 21:22:16,063 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab Table -[Contains]-> Beaker
2025-11-30 21:22:16,064 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:22:16,071 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=379, relationships=340
2025-11-30 21:22:16,074 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:22:16,074 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:22:16,074 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:22:16,074 - src.components.neo4j_handler - INFO - Batch injected in 0.28s (triplets: 0.28s, indexes: 0.00s)
2025-11-30 21:22:16,076 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 181, 'with_embedding': 181, 'linked_chunks': 144}
2025-11-30 21:22:16,076 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:22:16,123 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 379 nodes
2025-11-30 21:22:16,268 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 342 nodes
2025-11-30 21:22:16,435 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 379, 'relationship_count': 1115, 'density': 0.0078, 'avg_degree': 5.8839, 'avg_unique_neighbors': 5.8259, 'global_efficiency': 0.3255, 'avg_path_length': 2.7081, 'avg_degree_centrality': 0.0156, 'max_degree_centrality': 0.537, 'avg_betweenness_centrality': 0.0009, 'max_betweenness_centrality': 0.0571, 'degree_assortativity': -0.2024, 'graph_robustness': 0.6915, 'diameter_estimate': 6, 'clustering_coefficient': 0.2517, 'weakly_connected_components': 38, 'largest_wcc_size': 342, 'pagerank_top10_percent': 7.82, 'louvain_communities': 46, 'louvain_modularity': 0.4249, 'label_entropy': 1.4993, 'computational_time': 0.35864257090725005}
2025-11-30 21:22:16,435 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 37, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508936.4354322, 'total_time': 23.733914119075052, 'aggregation': 3.2940879464149475e-06, 'network_info': 0.010478844051249325, 'llm_extraction': 23.078195884940214, 'data_cleaning': 2.930604387074709e-05, 'neo4j_injection': 0.2841933980816975, 'embedding_time': 0, 'indexing_time': 0.0027063110610470176, 'graph_injection_time': 0.28120208997279406, 'acs_metrics': {'node_count': 379, 'relationship_count': 1115, 'density': 0.0078, 'avg_degree': 5.8839, 'avg_unique_neighbors': 5.8259, 'global_efficiency': 0.3255, 'avg_path_length': 2.7081, 'avg_degree_centrality': 0.0156, 'max_degree_centrality': 0.537, 'avg_betweenness_centrality': 0.0009, 'max_betweenness_centrality': 0.0571, 'degree_assortativity': -0.2024, 'graph_robustness': 0.6915, 'diameter_estimate': 6, 'clustering_coefficient': 0.2517, 'weakly_connected_components': 38, 'largest_wcc_size': 342, 'pagerank_top10_percent': 7.82, 'louvain_communities': 46, 'louvain_modularity': 0.4249, 'label_entropy': 1.4993, 'computational_time': 0.35864257090725005}, 'retrieval_queries': []}
2025-11-30 21:22:16,435 - src.pipeline.kg_builder - DEBUG - Batch 37 metrics: {
  "batch_idx": 37,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508936.4354322,
  "total_time": 23.733914119075052,
  "aggregation": 3.2940879464149475e-06,
  "network_info": 0.010478844051249325,
  "llm_extraction": 23.078195884940214,
  "data_cleaning": 2.930604387074709e-05,
  "neo4j_injection": 0.2841933980816975,
  "embedding_time": 0,
  "indexing_time": 0.0027063110610470176,
  "graph_injection_time": 0.28120208997279406,
  "acs_metrics": {
    "node_count": 379,
    "relationship_count": 1115,
    "density": 0.0078,
    "avg_degree": 5.8839,
    "avg_unique_neighbors": 5.8259,
    "global_efficiency": 0.3255,
    "avg_path_length": 2.7081,
    "avg_degree_centrality": 0.0156,
    "max_degree_centrality": 0.537,
    "avg_betweenness_centrality": 0.0009,
    "max_betweenness_centrality": 0.0571,
    "degree_assortativity": -0.2024,
    "graph_robustness": 0.6915,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2517,
    "weakly_connected_components": 38,
    "largest_wcc_size": 342,
    "pagerank_top10_percent": 7.82,
    "louvain_communities": 46,
    "louvain_modularity": 0.4249,
    "label_entropy": 1.4993,
    "computational_time": 0.35864257090725005
  },
  "retrieval_queries": []
}
2025-11-30 21:22:16,436 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:22:16,436 - src.pipeline.kg_builder - INFO - Batch 38 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 23.08s, Clean: 0.00s, Neo4j: 0.28s, ACS: 0.36s
2025-11-30 21:22:16,436 - src.pipeline.kg_builder - INFO - Batch 38 completed in 23.73s
Processing KG batches:  53%|█████▎    | 38/72 [15:19<12:52, 22.72s/it]2025-11-30 21:22:16,436 - src.pipeline.kg_builder - INFO - Processing batch 39/72 (3 items)
2025-11-30 21:22:16,436 - src.pipeline.kg_builder - DEBUG - Batch 39 current_video_time: 09:38-09:43
2025-11-30 21:22:16,446 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 379
- Total Relationships: 340
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:22:16,446 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:22:16,446 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_38_0 ~217 words, content: Time: 09:28-09:33 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a precise liquid transfer, performed by a scientist. The scene...
2025-11-30 21:22:16,446 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_38_1 ~236 words, content: used for weighing. - **Final Adjustment (Frame 3):** The person has now lifted the graduated cylinder, holding it up for a final inspection. The liquid...
2025-11-30 21:22:16,446 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_38_2 ~239 words, content: is conducted with care and precision, which is essential in a laboratory setting. The person is likely preparing a solution of a specific concentration, a...
2025-11-30 21:22:16,446 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_38_3 ~232 words, content: person is wearing a blue glove on their right hand and a black glove on their left hand. The video ends with the person still...
2025-11-30 21:22:16,446 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_38_4 ~123 words, content: critical to the experiment's outcome. - **Progression of the Procedure:** The person continues to add the clear liquid from the pipette into the volumetric flask....
2025-11-30 21:22:16,466 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:22:16,544 - src.components.pre_llm_injector - DEBUG - Found 181 existing chunk embeddings for similarity lookup
2025-11-30 21:22:16,593 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_3', '0.793'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1', '0.773')]
2025-11-30 21:22:16,596 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1
2025-11-30 21:22:16,596 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:22:16,596 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_3
2025-11-30 21:22:16,596 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:22:16,615 - src.components.pre_llm_injector - DEBUG - Limited Person from 110 to 2 external connections
2025-11-30 21:22:16,615 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 110 total -> 2 (internal: 0, external: 2)
2025-11-30 21:22:16,616 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WORKS_AT]->(Countertop / ID: 1_0), (Person / ID: 0_0)-[USES]->(Balance Scale / ID: 3_1)
2025-11-30 21:22:16,618 - src.components.pre_llm_injector - DEBUG - Limited Person from 110 to 2 external connections
2025-11-30 21:22:16,618 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 110 total -> 2 (internal: 0, external: 2)
2025-11-30 21:22:16,618 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[USES]->(Digital_Balance / ID: 16_0), (Person / ID: 0_0)-[USES]->(Wash_Bottle / ID: 11_1)
2025-11-30 21:22:16,618 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_0', '0.752'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_4', '0.736')]
2025-11-30 21:22:16,618 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_3', '0.793'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1', '0.773')]
2025-11-30 21:22:16,618 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_22_2', '0.723'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_1', '0.678')]
2025-11-30 21:22:16,618 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_1', '0.660'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.655')]
2025-11-30 21:22:16,618 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.768'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_5', '0.738')]
2025-11-30 21:22:16,618 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:22:16,619 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_38_0) (~217 words) with timeout=5.0s retries=3
2025-11-30 21:22:17,898 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:22:17,898 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:22:17,898 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_38_1) (~236 words) with timeout=5.0s retries=3
2025-11-30 21:22:18,929 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:22:18,929 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:22:18,929 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_38_2) (~239 words) with timeout=5.0s retries=3
2025-11-30 21:22:20,199 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:22:20,200 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:22:20,200 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_38_3) (~232 words) with timeout=5.0s retries=3
2025-11-30 21:22:21,319 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:22:21,319 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:22:21,320 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_38_4) (~123 words) with timeout=5.0s retries=3
2025-11-30 21:22:22,373 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:22:22,373 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:22:22,373 - src.components.pre_llm_injector - INFO - Extracted 27 local triplets from 5 chunks
2025-11-30 21:22:22,373 - src.pipeline.kg_builder - INFO - Pre-extraction: 27 triplets in 5.93s
2025-11-30 21:22:22,373 - src.components.global_refiner - INFO - Capping refinement input: 27 → 15 triplets
2025-11-30 21:22:22,373 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[WORKS_AT]->(Countertop / ID: 1_0), (Person / ID: 0_0)-[USES]->(Balance Scale / ID: 3_1)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[USES]->(Digital_Balance / ID: 16_0), (Person / ID: 0_0)-[USES]->(Wash_Bottle / ID: 11_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["38_0", "38_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Pipette", "source_chunks": ["38_0"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated_Cylinder", "source_chunks": ["38_0", "38_2"]}, {"head": "Glass_Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["38_0"]}, {"head": "Graduated_Cylinder", "relation": "Contains", "tail": "Liquid", "source_chunks": ["38_0"]}, {"head": "Person", "relation": "Uses", "tail": "Digital_Scale", "source_chunks": ["38_0"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated Cylinder", "source_chunks": ["38_1"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["38_1"]}, {"head": "Graduated Cylinder", "relation": "Contains", "tail": "Liquid", "source_chunks": ["38_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["38_1", "38_2"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Beaker", "source_chunks": ["38_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Vial", "source_chunks": ["38_1"]}, {"head": "Graduated_Cylinder", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["38_2"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["38_2"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Glass_Vial", "source_chunks": ["38_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:22:22,373 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~340 words, ~442 tokens)
2025-11-30 21:22:22,373 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:22:49,315 - src.components.global_refiner - DEBUG - LLM call completed in 26.94s
2025-11-30 21:22:49,315 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['38_0', '38_2']], ['Person', 'Holds', 'Glass_Pipette', ['38_0']], ['Person', 'Holds', 'Graduated_Cylinder', ['38_0', '38_2']], ['Glass_Pipette', 'Transfers', 'Liquid', ['38_0']], ['Graduated_Cylinder', 'Contains', 'Liquid', ['38_0']], ['Person', 'Uses', 'Digital_Scale', ['38_0']], ['Person', 'Holds', 'Graduated Cylinder', ['38_1']], ['Person', 'Wears', 'Watch', ['38_1']], ['Graduated_Cylinder', 'Contains', 'Liquid', ['38_1']], ['Person', 'Uses', 'Pipette', ['38_1', '38_2']], ['Lab Bench', 'Contains', 'Beaker', ['38_1']], ['Lab Bench', 'Contains', 'Vial', ['38_1']], ['Graduated_Cylinder', 'Contains', 'Clear_Liquid', ['38_2']], ['Person', 'Transfers', 'Liquid', ['38_2']], ['Liquid', 'Is Transferred To', 'Glass_Vial', ['38_2']]] inter_chunk_relations=[['Person', 'WORKS_AT', 'Countertop', ['38_0']], ['Person', 'USES', 'Balance Scale', ['38_0']], ['Person', 'USES', 'Digital_Balance', ['38_0']], ['Person', 'USES', 'Wash_Bottle', ['38_0']], ['Person', 'Holds', 'Graduated Cylinder', ['38_1']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['38_0', '38_2']], ['Person', 'Holds', 'Glass_Pipette', ['38_0']], ['Person', 'Holds', 'Graduated_Cylinder', ['38_0', '38_2']], ['Glass_Pipette', 'Transfers', 'Liquid', ['38_0']], ['Graduated_Cylinder', 'Contains', 'Liquid', ['38_0']], ['Person', 'Uses', 'Digital_Scale', ['38_0']], ['Person', 'Holds', 'Graduated Cylinder', ['38_1']], ['Person', 'Wears', 'Watch', ['38_1']], ['Graduated_Cylinder', 'Contains', 'Liquid', ['38_1']], ['Person', 'Uses', 'Pipette', ['38_1', '38_2']], ['Lab Bench', 'Contains', 'Beaker', ['38_1']], ['Lab Bench', 'Contains', 'Vial', ['38_1']], ['Graduated_Cylinder', 'Contains', 'Clear_Liquid', ['38_2']], ['Person', 'Transfers', 'Liquid', ['38_2']], ['Liquid', 'Is Transferred To', 'Glass_Vial', ['38_2']]] merge_instructions=[{'local': 'Digital_Scale', 'existing': 'Digital_Balance', 'existing_id': '16_0'}, {'local': 'Pipette', 'existing': 'Glass_Pipette', 'existing_id': '3_1'}, {'local': 'Graduated Cylinder', 'existing': 'Graduated_Cylinder', 'existing_id': '1_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}] prune_instructions=[{'head': 'Person', 'relation': 'WORKS_AT', 'tail': 'Countertop'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Balance Scale'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Digital_Balance'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Wash_Bottle'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Graduated Cylinder'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Glass_Pipette'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Graduated_Cylinder'}, {'head': 'Glass_Pipette', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Graduated_Cylinder', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Digital_Scale'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Graduated Cylinder'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Watch'}, {'head': 'Graduated_Cylinder', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Pipette'}, {'head': 'Lab Bench', 'relation': 'Contains', 'tail': 'Beaker'}, {'head': 'Lab Bench', 'relation': 'Contains', 'tail': 'Vial'}, {'head': 'Graduated_Cylinder', 'relation': 'Contains', 'tail': 'Clear_Liquid'}, {'head': 'Person', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Liquid', 'relation': 'Is Transferred To', 'tail': 'Glass_Vial'}]
2025-11-30 21:22:49,315 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['38_0', '38_2']], ['Person', 'Holds', 'Glass_Pipette', ['38_0']], ['Person', 'Holds', 'Graduated_Cylinder', ['38_0', '38_2']]]
2025-11-30 21:22:49,315 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=20, sample=[['Person', 'WORKS_AT', 'Countertop', ['38_0']], ['Person', 'USES', 'Balance Scale', ['38_0']], ['Person', 'USES', 'Digital_Balance', ['38_0']]]
2025-11-30 21:22:49,315 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Digital_Scale', 'existing': 'Digital_Balance', 'existing_id': '16_0'}, {'local': 'Pipette', 'existing': 'Glass_Pipette', 'existing_id': '3_1'}, {'local': 'Graduated Cylinder', 'existing': 'Graduated_Cylinder', 'existing_id': '1_0'}]
2025-11-30 21:22:49,315 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=20, sample=[{'head': 'Person', 'relation': 'WORKS_AT', 'tail': 'Countertop'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Balance Scale'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Digital_Balance'}]
2025-11-30 21:22:49,315 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Digital_Scale', 'existing': 'Digital_Balance', 'existing_id': '16_0'}, {'local': 'Pipette', 'existing': 'Glass_Pipette', 'existing_id': '3_1'}, {'local': 'Graduated Cylinder', 'existing': 'Graduated_Cylinder', 'existing_id': '1_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}]
2025-11-30 21:22:49,315 - src.components.global_refiner - INFO - LLM suggested 20 triplets to prune: [{'head': 'Person', 'relation': 'WORKS_AT', 'tail': 'Countertop'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Balance Scale'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Digital_Balance'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Wash_Bottle'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Graduated Cylinder'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Glass_Pipette'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Graduated_Cylinder'}, {'head': 'Glass_Pipette', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Graduated_Cylinder', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Digital_Scale'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Graduated Cylinder'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Watch'}, {'head': 'Graduated_Cylinder', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Pipette'}, {'head': 'Lab Bench', 'relation': 'Contains', 'tail': 'Beaker'}, {'head': 'Lab Bench', 'relation': 'Contains', 'tail': 'Vial'}, {'head': 'Graduated_Cylinder', 'relation': 'Contains', 'tail': 'Clear_Liquid'}, {'head': 'Person', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Liquid', 'relation': 'Is Transferred To', 'tail': 'Glass_Vial'}]
2025-11-30 21:22:49,315 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 35 triplets (total: 26.94s, LLM: 26.94s)
2025-11-30 21:22:49,315 - src.pipeline.kg_builder - INFO - Global refinement: 35 triplets in 26.94s
2025-11-30 21:22:49,315 - src.pipeline.kg_builder - INFO - Using 35 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:22:49,315 - src.pipeline.kg_builder - INFO - Pushing batch 39/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:22:49,315 - src.components.neo4j_handler - INFO - Adding 18 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:22:49,486 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=386, relationships=350
2025-11-30 21:22:49,486 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:22:49,486 - src.components.neo4j_handler - DEBUG - APOC merge successful: Digital_Scale -> Digital_Balance
2025-11-30 21:22:49,489 - src.components.neo4j_handler - DEBUG - APOC merge successful: Pipette -> Glass_Pipette
2025-11-30 21:22:49,491 - src.components.neo4j_handler - DEBUG - APOC merge successful: Graduated Cylinder -> Graduated_Cylinder
2025-11-30 21:22:49,494 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Glove
2025-11-30 21:22:49,494 - src.components.neo4j_handler - INFO - Applying 20 prune instructions
2025-11-30 21:22:49,516 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[WORKS_AT]-> Countertop
2025-11-30 21:22:49,518 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[USES]-> Balance Scale
2025-11-30 21:22:49,519 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[USES]-> Digital_Balance
2025-11-30 21:22:49,521 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[USES]-> Wash_Bottle
2025-11-30 21:22:49,521 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Graduated Cylinder
2025-11-30 21:22:49,522 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:22:49,523 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Glass_Pipette
2025-11-30 21:22:49,525 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Graduated_Cylinder
2025-11-30 21:22:49,526 - src.components.neo4j_handler - DEBUG - Pruned relationship: Glass_Pipette -[Transfers]-> Liquid
2025-11-30 21:22:49,527 - src.components.neo4j_handler - DEBUG - Pruned relationship: Graduated_Cylinder -[Contains]-> Liquid
2025-11-30 21:22:49,527 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Uses]-> Digital_Scale
2025-11-30 21:22:49,527 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Graduated Cylinder
2025-11-30 21:22:49,528 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Watch
2025-11-30 21:22:49,529 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Graduated_Cylinder -[Contains]-> Liquid
2025-11-30 21:22:49,529 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Uses]-> Pipette
2025-11-30 21:22:49,531 - src.components.neo4j_handler - DEBUG - Pruned relationship: Lab Bench -[Contains]-> Beaker
2025-11-30 21:22:49,531 - src.components.neo4j_handler - DEBUG - Pruned relationship: Lab Bench -[Contains]-> Vial
2025-11-30 21:22:49,532 - src.components.neo4j_handler - DEBUG - Pruned relationship: Graduated_Cylinder -[Contains]-> Clear_Liquid
2025-11-30 21:22:49,534 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Transfers]-> Liquid
2025-11-30 21:22:49,535 - src.components.neo4j_handler - DEBUG - Pruned relationship: Liquid -[Is Transferred To]-> Glass_Vial
2025-11-30 21:22:49,535 - src.components.neo4j_handler - INFO - Applying 20 inter-chunk relations
2025-11-30 21:22:49,536 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[WORKS_AT]-> Countertop
2025-11-30 21:22:49,537 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[USES]-> Balance Scale
2025-11-30 21:22:49,539 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[USES]-> Digital_Balance
2025-11-30 21:22:49,540 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[USES]-> Wash_Bottle
2025-11-30 21:22:49,540 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Graduated Cylinder
2025-11-30 21:22:49,541 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:22:49,542 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Glass_Pipette
2025-11-30 21:22:49,543 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Graduated_Cylinder
2025-11-30 21:22:49,545 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Glass_Pipette -[Transfers]-> Liquid
2025-11-30 21:22:49,546 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Graduated_Cylinder -[Contains]-> Liquid
2025-11-30 21:22:49,547 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Uses]-> Digital_Scale
2025-11-30 21:22:49,547 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Graduated Cylinder
2025-11-30 21:22:49,549 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Watch
2025-11-30 21:22:49,550 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Graduated_Cylinder -[Contains]-> Liquid
2025-11-30 21:22:49,550 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Uses]-> Pipette
2025-11-30 21:22:49,551 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab Bench -[Contains]-> Beaker
2025-11-30 21:22:49,553 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab Bench -[Contains]-> Vial
2025-11-30 21:22:49,554 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Graduated_Cylinder -[Contains]-> Clear_Liquid
2025-11-30 21:22:49,555 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Transfers]-> Liquid
2025-11-30 21:22:49,556 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Liquid -[Is Transferred To]-> Glass_Vial
2025-11-30 21:22:49,557 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:22:49,562 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=382, relationships=348
2025-11-30 21:22:49,563 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:22:49,563 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:22:49,564 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:22:49,564 - src.components.neo4j_handler - INFO - Batch injected in 0.25s (triplets: 0.25s, indexes: 0.00s)
2025-11-30 21:22:49,565 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 186, 'with_embedding': 186, 'linked_chunks': 147}
2025-11-30 21:22:49,565 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:22:49,635 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 382 nodes
2025-11-30 21:22:49,786 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 343 nodes
2025-11-30 21:22:49,960 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 382, 'relationship_count': 1144, 'density': 0.0079, 'avg_degree': 5.9895, 'avg_unique_neighbors': 5.9319, 'global_efficiency': 0.3239, 'avg_path_length': 2.6949, 'avg_degree_centrality': 0.0157, 'max_degree_centrality': 0.5407, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0349, 'degree_assortativity': -0.1981, 'graph_robustness': 0.7972, 'diameter_estimate': 6, 'clustering_coefficient': 0.2481, 'weakly_connected_components': 40, 'largest_wcc_size': 343, 'pagerank_top10_percent': 7.69, 'louvain_communities': 48, 'louvain_modularity': 0.4269, 'label_entropy': 1.4998, 'computational_time': 0.39549512800294906}
2025-11-30 21:22:49,961 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 38, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508969.9612117, 'total_time': 33.524787914939225, 'aggregation': 2.2529857233166695e-06, 'network_info': 0.009855575975961983, 'llm_extraction': 32.86895429191645, 'data_cleaning': 1.7354963347315788e-05, 'neo4j_injection': 0.24885197402909398, 'embedding_time': 0, 'indexing_time': 0.0018535340204834938, 'graph_injection_time': 0.24680341605562717, 'acs_metrics': {'node_count': 382, 'relationship_count': 1144, 'density': 0.0079, 'avg_degree': 5.9895, 'avg_unique_neighbors': 5.9319, 'global_efficiency': 0.3239, 'avg_path_length': 2.6949, 'avg_degree_centrality': 0.0157, 'max_degree_centrality': 0.5407, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0349, 'degree_assortativity': -0.1981, 'graph_robustness': 0.7972, 'diameter_estimate': 6, 'clustering_coefficient': 0.2481, 'weakly_connected_components': 40, 'largest_wcc_size': 343, 'pagerank_top10_percent': 7.69, 'louvain_communities': 48, 'louvain_modularity': 0.4269, 'label_entropy': 1.4998, 'computational_time': 0.39549512800294906}, 'retrieval_queries': []}
2025-11-30 21:22:49,961 - src.pipeline.kg_builder - DEBUG - Batch 38 metrics: {
  "batch_idx": 38,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508969.9612117,
  "total_time": 33.524787914939225,
  "aggregation": 2.2529857233166695e-06,
  "network_info": 0.009855575975961983,
  "llm_extraction": 32.86895429191645,
  "data_cleaning": 1.7354963347315788e-05,
  "neo4j_injection": 0.24885197402909398,
  "embedding_time": 0,
  "indexing_time": 0.0018535340204834938,
  "graph_injection_time": 0.24680341605562717,
  "acs_metrics": {
    "node_count": 382,
    "relationship_count": 1144,
    "density": 0.0079,
    "avg_degree": 5.9895,
    "avg_unique_neighbors": 5.9319,
    "global_efficiency": 0.3239,
    "avg_path_length": 2.6949,
    "avg_degree_centrality": 0.0157,
    "max_degree_centrality": 0.5407,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0349,
    "degree_assortativity": -0.1981,
    "graph_robustness": 0.7972,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2481,
    "weakly_connected_components": 40,
    "largest_wcc_size": 343,
    "pagerank_top10_percent": 7.69,
    "louvain_communities": 48,
    "louvain_modularity": 0.4269,
    "label_entropy": 1.4998,
    "computational_time": 0.39549512800294906
  },
  "retrieval_queries": []
}
2025-11-30 21:22:49,962 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:22:49,962 - src.pipeline.kg_builder - INFO - Batch 39 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 32.87s, Clean: 0.00s, Neo4j: 0.25s, ACS: 0.40s
2025-11-30 21:22:49,962 - src.pipeline.kg_builder - INFO - Batch 39 completed in 33.52s
Processing KG batches:  54%|█████▍    | 39/72 [15:52<14:16, 25.96s/it]2025-11-30 21:22:49,962 - src.pipeline.kg_builder - INFO - Processing batch 40/72 (3 items)
2025-11-30 21:22:49,962 - src.pipeline.kg_builder - DEBUG - Batch 40 current_video_time: 09:53-09:58
2025-11-30 21:22:49,968 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 382
- Total Relationships: 348
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:22:49,968 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:22:49,969 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_39_0 ~222 words, content: Time: 09:43-09:48 Content: The video sequence captures a detailed laboratory procedure, likely the preparation of a chemical solution, from a first-person perspective. The scene is...
2025-11-30 21:22:49,969 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_39_1 ~235 words, content: **Final Transfer:** In the final frames, the person is again seen pouring a liquid from a small test tube into the larger flask. This action...
2025-11-30 21:22:49,969 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_39_2 ~225 words, content: contributing to the context of a scientific experiment. The overall action is one of meticulous measurement and preparation. Time: 09:53-09:58 Content: The video sequence captures...
2025-11-30 21:22:49,969 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_39_3 ~227 words, content: . - **Frame 3:** The person has placed the volumetric flask back on the balance. The display now shows a non-zero value, indicating that the...
2025-11-30 21:22:49,989 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:22:50,069 - src.components.pre_llm_injector - DEBUG - Found 186 existing chunk embeddings for similarity lookup
2025-11-30 21:22:50,109 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_2', '0.879'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_4', '0.812')]
2025-11-30 21:22:50,111 - src.components.pre_llm_injector - DEBUG - Found 7 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_2
2025-11-30 21:22:50,111 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:22:50,111 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_4 via source_chunk_ids
2025-11-30 21:22:50,124 - src.components.pre_llm_injector - DEBUG - Limited Person from 105 to 2 external connections
2025-11-30 21:22:50,124 - src.components.pre_llm_injector - DEBUG - Limited Lab Table from 5 to 2 external connections
2025-11-30 21:22:50,124 - src.components.pre_llm_injector - DEBUG - Limited Digital_Balance from 7 to 2 external connections
2025-11-30 21:22:50,124 - src.components.pre_llm_injector - DEBUG - Limited Digital Balance from 11 to 2 external connections
2025-11-30 21:22:50,124 - src.components.pre_llm_injector - DEBUG - Limited Volumetric Flask from 11 to 2 external connections
2025-11-30 21:22:50,124 - src.components.pre_llm_injector - DEBUG - Limited Weight from 3 to 2 external connections
2025-11-30 21:22:50,124 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 154 total -> 24 (internal: 12, external: 12)
2025-11-30 21:22:50,124 - src.components.pre_llm_injector - DEBUG - Subgraph: (Digital_Balance / ID: 16_0)-[DISPLAYS]->(Weight / ID: 11_2), (Digital Balance / ID: 16_1)-[DISPLAYS]->(Weight / ID: 11_2), (Person / ID: 0_0)-[USES]->(Digital Balance / ID: 16_1), (Volumetric Flask / ID: 18_1)-[IS_POSITIONED_ON]->(Lab Table / ID: 17_2), (Lab Table / ID: 17_2)-[CONTAINS]->(Piece Of Paper / ID: 18_2), (Person / ID: 0_0)-[USES]->(Digital_Balance / ID: 16_0), (Volumetric Flask / ID: 18_1)-[IS_ON]->(Digital_Balance / ID: 16_0), (Person / ID: 0_0)-[STABILIZES]->(Volumetric Flask / ID: 18_1), (Person / ID: 0_0)-[ADJUSTS]->(Volumetric Flask / ID: 18_1), (Person / ID: 0_0)-[HOLDS]->(Volumetric Flask / ID: 18_1), (Person / ID: 0_0)-[HOLDS]->(Volumetric Flask / ID: 18_1), (Digital_Balance / ID: 16_0)-[IS_USED_BY]->(Person / ID: 0_0), (Person / ID: 0_0)-[USES]->(Wash_Bottle / ID: 11_1), (Person / ID: 0_0)-[WALKS_PAST]->(Laboratory_Equipment / ID: 14_2), (Lab Table / ID: 17_2)-[CONTAINS]->(Liquid_In_Small_Container / ID: 5_0), (Lab Table / ID: 17_2)-[CONTAINS]->(Beaker / ID: 33_1), (Liquid_In_Small_Container / ID: 5_0)-[IS_ON]->(Digital_Balance / ID: 16_0), (Digital_Balance / ID: 16_0)-[MEASURES]->(Mass / ID: 9_2), (Digital Balance / ID: 16_1)-[MEASURES]->(Mass Of Liquid / ID: 15_1), (Digital Balance / ID: 16_1)-[DISPLAYS]->(0.000 G / ID: 37_0), (Volumetric Flask / ID: 18_1)-[RECEIVES]->(Liquid From Burette / ID: 25_1), (Burette / ID: 4_2)-[IS_ABOVE]->(Volumetric Flask / ID: 18_1), (Power Strip / ID: 3_1)-[DISPLAYS]->(Weight / ID: 11_2), (Digital Scale / ID: 31_0)-[MEASURES]->(Weight / ID: 11_2)
2025-11-30 21:22:50,124 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_2', '0.879'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_4', '0.514')]
2025-11-30 21:22:50,124 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_2', '0.722'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1', '0.698')]
2025-11-30 21:22:50,124 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_2', '0.599'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_2', '0.585')]
2025-11-30 21:22:50,124 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_4', '0.812'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.795')]
2025-11-30 21:22:50,124 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:22:50,124 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_39_0) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:22:51,403 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:22:51,403 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:22:51,403 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_39_1) (~235 words) with timeout=5.0s retries=3
2025-11-30 21:22:52,697 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:22:52,697 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:22:52,698 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_39_2) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:22:54,062 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:22:54,062 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:22:54,062 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_39_3) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:22:55,055 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:22:55,055 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:22:55,055 - src.components.pre_llm_injector - INFO - Extracted 20 local triplets from 4 chunks
2025-11-30 21:22:55,055 - src.pipeline.kg_builder - INFO - Pre-extraction: 20 triplets in 5.09s
2025-11-30 21:22:55,055 - src.components.global_refiner - INFO - Capping refinement input: 20 → 15 triplets
2025-11-30 21:22:55,056 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Digital_Balance / ID: 16_0)-[DISPLAYS]->(Weight / ID: 11_2), (Digital Balance / ID: 16_1)-[DISPLAYS]->(Weight / ID: 11_2), (Person / ID: 0_0)-[USES]->(Digital Balance / ID: 16_1), (Volumetric Flask / ID: 18_1)-[IS_POSITIONED_ON]->(Lab Table / ID: 17_2), (Lab Table / ID: 17_2)-[CONTAINS]->(Piece Of Paper / ID: 18_2), (Person / ID: 0_0)-[USES]->(Digital_Balance / ID: 16_0), (Volumetric Flask / ID: 18_1)-[IS_ON]->(Digital_Balance / ID: 16_0), (Person / ID: 0_0)-[STABILIZES]->(Volumetric Flask / ID: 18_1), (Person / ID: 0_0)-[ADJUSTS]->(Volumetric Flask / ID: 18_1), (Person / ID: 0_0)-[HOLDS]->(Volumetric Flask / ID: 18_1), (Person / ID: 0_0)-[HOLDS]->(Volumetric Flask / ID: 18_1), (Digital_Balance / ID: 16_0)-[IS_USED_BY]->(Person / ID: 0_0), (Person / ID: 0_0)-[USES]->(Wash_Bottle / ID: 11_1), (Person / ID: 0_0)-[WALKS_PAST]->(Laboratory_Equipment / ID: 14_2), (Lab Table / ID: 17_2)-[CONTAINS]->(Liquid_In_Small_Container / ID: 5_0), (Lab Table / ID: 17_2)-[CONTAINS]->(Beaker / ID: 33_1), (Liquid_In_Small_Container / ID: 5_0)-[IS_ON]->(Digital_Balance / ID: 16_0), (Digital_Balance / ID: 16_0)-[MEASURES]->(Mass / ID: 9_2), (Digital Balance / ID: 16_1)-[MEASURES]->(Mass Of Liquid / ID: 15_1), (Digital Balance / ID: 16_1)-[DISPLAYS]->(0.000 G / ID: 37_0), (Volumetric Flask / ID: 18_1)-[RECEIVES]->(Liquid From Burette / ID: 25_1), (Burette / ID: 4_2)-[IS_ABOVE]->(Volumetric Flask / ID: 18_1), (Power Strip / ID: 3_1)-[DISPLAYS]->(Weight / ID: 11_2), (Digital Scale / ID: 31_0)-[MEASURES]->(Weight / ID: 11_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["39_0", "39_1", "39_2"]}, {"head": "Person", "relation": "Holds", "tail": "Test_Tube", "source_chunks": ["39_0"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["39_0", "39_1", "39_2"]}, {"head": "Liquid", "relation": "Flows Into", "tail": "Flask", "source_chunks": ["39_0"]}, {"head": "Person", "relation": "Uses", "tail": "Digital_Balance", "source_chunks": ["39_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "0.0000_G", "source_chunks": ["39_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Pipette", "source_chunks": ["39_1"]}, {"head": "Glass_Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["39_1"]}, {"head": "Digital_Balance", "relation": "Is On", "tail": "Lab_Bench", "source_chunks": ["39_1"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Digital_Balance", "source_chunks": ["39_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["39_2"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric_Flask", "source_chunks": ["39_2"]}, {"head": "Volumetric_Flask", "relation": "Is On", "tail": "Precision_Balance", "source_chunks": ["39_2"]}, {"head": "Precision_Balance", "relation": "Displays", "tail": "Zero_Gram", "source_chunks": ["39_2"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["39_3"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:22:55,056 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~501 words, ~651 tokens)
2025-11-30 21:22:55,056 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:23:06,253 - src.components.global_refiner - DEBUG - LLM call completed in 11.20s
2025-11-30 21:23:06,253 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['39_0', '39_1', '39_2']], ['Person', 'Holds', 'Test_Tube', ['39_0']], ['Person', 'Transfers', 'Liquid', ['39_0', '39_1', '39_2']], ['Liquid', 'Flows Into', 'Flask', ['39_0']], ['Person', 'Uses', 'Digital_Balance', ['39_0']], ['Digital_Balance', 'Displays', '0.0000_G', ['39_0']], ['Person', 'Holds', 'Glass_Pipette', ['39_1']], ['Glass_Pipette', 'Transfers', 'Liquid', ['39_1']], ['Digital_Balance', 'Is On', 'Lab_Bench', ['39_1']], ['Lab_Bench', 'Contains', 'Digital_Balance', ['39_1']]] inter_chunk_relations=[['Digital_Balance', 'Displays', 'Weight', ['39_0']], ['Digital_Balance', 'Is On', 'Lab_Bench', ['39_1']], ['Lab_Bench', 'Contains', 'Digital_Balance', ['39_1']], ['Person', 'Uses', 'Digital_Balance', ['39_0']], ['Person', 'Holds', 'Volumetric_Flask', ['39_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}, {'local': 'Test_Tube', 'existing': 'Test Tube', 'existing_id': '18_0'}, {'local': 'Glass_Pipette', 'existing': 'Pipette', 'existing_id': '11_0'}, {'local': 'Precision_Balance', 'existing': 'Digital_Balance', 'existing_id': '16_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric Flask'}, {'head': 'Digital_Balance', 'relation': 'Displays', 'tail': '0.000 G'}, {'entity': 'Power Strip'}, {'entity': 'Digital Scale'}]
2025-11-30 21:23:06,253 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=10, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['39_0', '39_1', '39_2']], ['Person', 'Holds', 'Test_Tube', ['39_0']], ['Person', 'Transfers', 'Liquid', ['39_0', '39_1', '39_2']]]
2025-11-30 21:23:06,253 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Digital_Balance', 'Displays', 'Weight', ['39_0']], ['Digital_Balance', 'Is On', 'Lab_Bench', ['39_1']], ['Lab_Bench', 'Contains', 'Digital_Balance', ['39_1']]]
2025-11-30 21:23:06,253 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}, {'local': 'Test_Tube', 'existing': 'Test Tube', 'existing_id': '18_0'}, {'local': 'Glass_Pipette', 'existing': 'Pipette', 'existing_id': '11_0'}]
2025-11-30 21:23:06,254 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric Flask'}, {'head': 'Digital_Balance', 'relation': 'Displays', 'tail': '0.000 G'}, {'entity': 'Power Strip'}]
2025-11-30 21:23:06,254 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}, {'local': 'Test_Tube', 'existing': 'Test Tube', 'existing_id': '18_0'}, {'local': 'Glass_Pipette', 'existing': 'Pipette', 'existing_id': '11_0'}, {'local': 'Precision_Balance', 'existing': 'Digital_Balance', 'existing_id': '16_0'}]
2025-11-30 21:23:06,254 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric Flask'}, {'head': 'Digital_Balance', 'relation': 'Displays', 'tail': '0.000 G'}, {'entity': 'Power Strip'}, {'entity': 'Digital Scale'}]
2025-11-30 21:23:06,254 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 15 triplets (total: 11.20s, LLM: 11.20s)
2025-11-30 21:23:06,254 - src.pipeline.kg_builder - INFO - Global refinement: 15 triplets in 11.20s
2025-11-30 21:23:06,254 - src.pipeline.kg_builder - INFO - Using 15 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:23:06,254 - src.pipeline.kg_builder - INFO - Pushing batch 40/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:23:06,254 - src.components.neo4j_handler - INFO - Adding 12 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:23:06,435 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=389, relationships=355
2025-11-30 21:23:06,435 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:23:06,436 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Nitrile Gloves
2025-11-30 21:23:06,437 - src.components.neo4j_handler - DEBUG - APOC merge successful: Test_Tube -> Test Tube
2025-11-30 21:23:06,441 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass_Pipette -> Pipette
2025-11-30 21:23:06,442 - src.components.neo4j_handler - DEBUG - APOC merge successful: Precision_Balance -> Digital_Balance
2025-11-30 21:23:06,442 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:23:06,448 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Volumetric Flask
2025-11-30 21:23:06,449 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Digital_Balance -[Displays]-> 0.000 G
2025-11-30 21:23:06,451 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Power Strip
2025-11-30 21:23:06,454 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Digital Scale
2025-11-30 21:23:06,454 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:23:06,456 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital_Balance -[Displays]-> Weight
2025-11-30 21:23:06,458 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital_Balance -[Is On]-> Lab_Bench
2025-11-30 21:23:06,459 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab_Bench -[Contains]-> Digital_Balance
2025-11-30 21:23:06,461 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> Digital_Balance
2025-11-30 21:23:06,463 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Volumetric_Flask
2025-11-30 21:23:06,464 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:23:06,472 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=385, relationships=330
2025-11-30 21:23:06,474 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:23:06,474 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:23:06,474 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:23:06,474 - src.components.neo4j_handler - INFO - Batch injected in 0.22s (triplets: 0.22s, indexes: 0.00s)
2025-11-30 21:23:06,476 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 190, 'with_embedding': 190, 'linked_chunks': 150}
2025-11-30 21:23:06,476 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:23:06,525 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 385 nodes
2025-11-30 21:23:06,682 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 345 nodes
2025-11-30 21:23:06,861 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 385, 'relationship_count': 1128, 'density': 0.0076, 'avg_degree': 5.8597, 'avg_unique_neighbors': 5.8078, 'global_efficiency': 0.3228, 'avg_path_length': 2.6954, 'avg_degree_centrality': 0.0153, 'max_degree_centrality': 0.5469, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0368, 'degree_assortativity': -0.207, 'graph_robustness': 0.8085, 'diameter_estimate': 6, 'clustering_coefficient': 0.24, 'weakly_connected_components': 41, 'largest_wcc_size': 345, 'pagerank_top10_percent': 7.67, 'louvain_communities': 51, 'louvain_modularity': 0.4205, 'label_entropy': 1.4999, 'computational_time': 0.3846906080143526}
2025-11-30 21:23:06,861 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 39, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764508986.8612053, 'total_time': 16.898905362933874, 'aggregation': 2.8419308364391327e-06, 'network_info': 0.006107848021201789, 'llm_extraction': 16.285777259035967, 'data_cleaning': 2.9732007533311844e-05, 'neo4j_injection': 0.22038559091743082, 'embedding_time': 0, 'indexing_time': 0.002464677905663848, 'graph_injection_time': 0.2175777549855411, 'acs_metrics': {'node_count': 385, 'relationship_count': 1128, 'density': 0.0076, 'avg_degree': 5.8597, 'avg_unique_neighbors': 5.8078, 'global_efficiency': 0.3228, 'avg_path_length': 2.6954, 'avg_degree_centrality': 0.0153, 'max_degree_centrality': 0.5469, 'avg_betweenness_centrality': 0.0007, 'max_betweenness_centrality': 0.0368, 'degree_assortativity': -0.207, 'graph_robustness': 0.8085, 'diameter_estimate': 6, 'clustering_coefficient': 0.24, 'weakly_connected_components': 41, 'largest_wcc_size': 345, 'pagerank_top10_percent': 7.67, 'louvain_communities': 51, 'louvain_modularity': 0.4205, 'label_entropy': 1.4999, 'computational_time': 0.3846906080143526}, 'retrieval_queries': []}
2025-11-30 21:23:06,861 - src.pipeline.kg_builder - DEBUG - Batch 39 metrics: {
  "batch_idx": 39,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764508986.8612053,
  "total_time": 16.898905362933874,
  "aggregation": 2.8419308364391327e-06,
  "network_info": 0.006107848021201789,
  "llm_extraction": 16.285777259035967,
  "data_cleaning": 2.9732007533311844e-05,
  "neo4j_injection": 0.22038559091743082,
  "embedding_time": 0,
  "indexing_time": 0.002464677905663848,
  "graph_injection_time": 0.2175777549855411,
  "acs_metrics": {
    "node_count": 385,
    "relationship_count": 1128,
    "density": 0.0076,
    "avg_degree": 5.8597,
    "avg_unique_neighbors": 5.8078,
    "global_efficiency": 0.3228,
    "avg_path_length": 2.6954,
    "avg_degree_centrality": 0.0153,
    "max_degree_centrality": 0.5469,
    "avg_betweenness_centrality": 0.0007,
    "max_betweenness_centrality": 0.0368,
    "degree_assortativity": -0.207,
    "graph_robustness": 0.8085,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.24,
    "weakly_connected_components": 41,
    "largest_wcc_size": 345,
    "pagerank_top10_percent": 7.67,
    "louvain_communities": 51,
    "louvain_modularity": 0.4205,
    "label_entropy": 1.4999,
    "computational_time": 0.3846906080143526
  },
  "retrieval_queries": []
}
2025-11-30 21:23:06,862 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:23:06,862 - src.pipeline.kg_builder - INFO - Batch 40 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 16.29s, Clean: 0.00s, Neo4j: 0.22s, ACS: 0.38s
2025-11-30 21:23:06,862 - src.pipeline.kg_builder - INFO - Batch 40 completed in 16.90s
Processing KG batches:  56%|█████▌    | 40/72 [16:09<12:23, 23.24s/it]2025-11-30 21:23:06,862 - src.pipeline.kg_builder - INFO - Processing batch 41/72 (3 items)
2025-11-30 21:23:06,862 - src.pipeline.kg_builder - DEBUG - Batch 41 current_video_time: 10:08-10:13
2025-11-30 21:23:06,873 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 385
- Total Relationships: 330
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:23:06,874 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:23:06,874 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_0 ~209 words, content: Time: 09:58-10:03 Content: The video sequence captures a detailed laboratory procedure, likely a chemical titration or solution preparation, from a first-person perspective. The scene is...
2025-11-30 21:23:06,874 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_1 ~224 words, content: , which is a METTLER TOLEDO model, is visible in the background, indicating that the procedure may involve weighing the liquid to ensure accuracy. The...
2025-11-30 21:23:06,874 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_2 ~233 words, content: tte, filled with a clear liquid. The person is carefully adjusting the liquid level in the burette, a common step in titration experiments to ensure...
2025-11-30 21:23:06,874 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_3 ~207 words, content: of precision and accuracy in laboratory work. In summary, the video shows a person preparing a solution for a titration experiment. They carefully adjust the...
2025-11-30 21:23:06,874 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_4 ~170 words, content: markings. - **Pipette:** Used to transfer a precise volume of liquid from the flask to the burette. - **Round-Bottom Flask:** Contains a clear liquid and...
2025-11-30 21:23:06,894 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:23:06,976 - src.components.pre_llm_injector - DEBUG - Found 190 existing chunk embeddings for similarity lookup
2025-11-30 21:23:07,028 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.838'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_4', '0.833')]
2025-11-30 21:23:07,030 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_4 via source_chunk_ids
2025-11-30 21:23:07,030 - src.components.pre_llm_injector - DEBUG - Found 6 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2
2025-11-30 21:23:07,030 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:23:07,043 - src.components.pre_llm_injector - DEBUG - Limited Person from 110 to 2 external connections
2025-11-30 21:23:07,043 - src.components.pre_llm_injector - DEBUG - Limited Laboratory from 4 to 2 external connections
2025-11-30 21:23:07,043 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 116 total -> 6 (internal: 1, external: 5)
2025-11-30 21:23:07,043 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[HOLDS]->(Volumetric_Flask / ID: 39_2), (Man / ID: 29_1)-[OBSERVES]->(Person / ID: 0_0), (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance Scale / ID: 3_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Glassware / ID: 0_1)
2025-11-30 21:23:07,043 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_1', '0.762'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_4', '0.758')]
2025-11-30 21:23:07,043 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_2', '0.825'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_1', '0.703')]
2025-11-30 21:23:07,043 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.709'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_1', '0.692')]
2025-11-30 21:23:07,043 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_2', '0.733'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.721')]
2025-11-30 21:23:07,043 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.838'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_4', '0.833')]
2025-11-30 21:23:07,043 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:23:07,043 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_0) (~209 words) with timeout=5.0s retries=3
2025-11-30 21:23:08,135 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:23:08,135 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:23:08,135 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_1) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:23:09,231 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:23:09,231 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:23:09,231 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_2) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:23:10,204 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:23:10,204 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:23:10,205 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_3) (~207 words) with timeout=5.0s retries=3
2025-11-30 21:23:11,334 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:23:11,334 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:23:11,335 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_4) (~170 words) with timeout=5.0s retries=3
2025-11-30 21:23:12,926 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:23:12,926 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:23:12,926 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 5 chunks
2025-11-30 21:23:12,926 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 6.05s
2025-11-30 21:23:12,927 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 21:23:12,927 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[HOLDS]->(Volumetric_Flask / ID: 39_2), (Man / ID: 29_1)-[OBSERVES]->(Person / ID: 0_0), (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance Scale / ID: 3_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Glassware / ID: 0_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["40_0", "40_1"]}, {"head": "Person", "relation": "Holds", "tail": "Burette", "source_chunks": ["40_0", "40_3"]}, {"head": "Person", "relation": "Holds", "tail": "Volumetric Flask", "source_chunks": ["40_0"]}, {"head": "Burette", "relation": "Contains", "tail": "Liquid", "source_chunks": ["40_0", "40_2", "40_3"]}, {"head": "Volumetric Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["40_0"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["40_0", "40_2"]}, {"head": "Person", "relation": "Handles", "tail": "Burette", "source_chunks": ["40_1"]}, {"head": "Burette", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["40_1"]}, {"head": "Digital Balance", "relation": "Is Visible In Background", "tail": "Laboratory", "source_chunks": ["40_1"]}, {"head": "Person", "relation": "Uses", "tail": "Gloves", "source_chunks": ["40_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Equipment", "source_chunks": ["40_1"]}, {"head": "Person", "relation": "Adjusts", "tail": "Burette", "source_chunks": ["40_2"]}, {"head": "Liquid", "relation": "Is In", "tail": "Flask", "source_chunks": ["40_2"]}, {"head": "Liquid", "relation": "Is In", "tail": "Burette", "source_chunks": ["40_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["40_2", "40_3"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:23:12,927 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~360 words, ~468 tokens)
2025-11-30 21:23:12,927 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:23:25,083 - src.components.global_refiner - DEBUG - LLM call completed in 12.16s
2025-11-30 21:23:25,084 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue Nitrile Gloves', ['40_0', '40_1']], ['Person', 'Holds', 'Burette', ['40_0', '40_3']], ['Burette', 'Contains', 'Liquid', ['40_0', '40_2', '40_3']], ['Burette', 'Contains', 'Clear Liquid', ['40_1']], ['Person', 'Transfers', 'Liquid', ['40_0', '40_2']], ['Person', 'Handles', 'Burette', ['40_1']], ['Person', 'Adjusts', 'Burette', ['40_2']], ['Liquid', 'Is In', 'Flask', ['40_2']], ['Liquid', 'Is In', 'Burette', ['40_2']], ['Person', 'Uses', 'Pipette', ['40_2', '40_3']]] inter_chunk_relations=[['Burette', 'Is Visible In Background', 'Laboratory', ['40_1']], ['Digital Balance', 'Is Visible In Background', 'Laboratory', ['40_1']], ['Person', 'Uses', 'Gloves', ['40_1']], ['Laboratory', 'Contains', 'Equipment', ['40_1']], ['Person', 'Holds', 'Volumetric Flask', ['40_0']]] merge_instructions=[{'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_0'}, {'local': 'Clear Liquid', 'existing': 'Liquid', 'existing_id': '0_0'}, {'local': 'Pipette', 'existing': 'Pipette', 'existing_id': '0_0'}, {'local': 'Equipment', 'existing': 'Equipment', 'existing_id': '0_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric Flask'}, {'head': 'Burette', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Liquid', 'relation': 'Is In', 'tail': 'Burette'}]
2025-11-30 21:23:25,084 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=10, sample=[['Person', 'Wears', 'Blue Nitrile Gloves', ['40_0', '40_1']], ['Person', 'Holds', 'Burette', ['40_0', '40_3']], ['Burette', 'Contains', 'Liquid', ['40_0', '40_2', '40_3']]]
2025-11-30 21:23:25,084 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Burette', 'Is Visible In Background', 'Laboratory', ['40_1']], ['Digital Balance', 'Is Visible In Background', 'Laboratory', ['40_1']], ['Person', 'Uses', 'Gloves', ['40_1']]]
2025-11-30 21:23:25,084 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_0'}, {'local': 'Clear Liquid', 'existing': 'Liquid', 'existing_id': '0_0'}, {'local': 'Pipette', 'existing': 'Pipette', 'existing_id': '0_0'}]
2025-11-30 21:23:25,084 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric Flask'}, {'head': 'Burette', 'relation': 'Contains', 'tail': 'Liquid'}]
2025-11-30 21:23:25,084 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_0'}, {'local': 'Clear Liquid', 'existing': 'Liquid', 'existing_id': '0_0'}, {'local': 'Pipette', 'existing': 'Pipette', 'existing_id': '0_0'}, {'local': 'Equipment', 'existing': 'Equipment', 'existing_id': '0_0'}]
2025-11-30 21:23:25,084 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Volumetric Flask'}, {'head': 'Burette', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Liquid', 'relation': 'Is In', 'tail': 'Burette'}]
2025-11-30 21:23:25,084 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 15 triplets (total: 12.16s, LLM: 12.16s)
2025-11-30 21:23:25,084 - src.pipeline.kg_builder - INFO - Global refinement: 15 triplets in 12.16s
2025-11-30 21:23:25,084 - src.pipeline.kg_builder - INFO - Using 15 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:23:25,084 - src.pipeline.kg_builder - INFO - Pushing batch 41/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:23:25,085 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:23:25,306 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=393, relationships=344
2025-11-30 21:23:25,306 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:23:25,306 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue Nitrile Gloves -> Blue Nitrile Gloves
2025-11-30 21:23:25,306 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear Liquid -> Liquid
2025-11-30 21:23:25,306 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Pipette -> Pipette
2025-11-30 21:23:25,306 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Equipment -> Equipment
2025-11-30 21:23:25,306 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:23:25,312 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Nitrile Gloves
2025-11-30 21:23:25,314 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Volumetric Flask
2025-11-30 21:23:25,317 - src.components.neo4j_handler - DEBUG - Pruned relationship: Burette -[Contains]-> Liquid
2025-11-30 21:23:25,319 - src.components.neo4j_handler - DEBUG - Pruned relationship: Liquid -[Is In]-> Burette
2025-11-30 21:23:25,319 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:23:25,351 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Burette -[Is Visible In Background]-> Laboratory
2025-11-30 21:23:25,356 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital Balance -[Is Visible In Background]-> Laboratory
2025-11-30 21:23:25,357 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> Gloves
2025-11-30 21:23:25,359 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Laboratory -[Contains]-> Equipment
2025-11-30 21:23:25,362 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Volumetric Flask
2025-11-30 21:23:25,362 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:23:25,370 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=392, relationships=340
2025-11-30 21:23:25,372 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:23:25,372 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:23:25,372 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:23:25,372 - src.components.neo4j_handler - INFO - Batch injected in 0.29s (triplets: 0.29s, indexes: 0.00s)
2025-11-30 21:23:25,373 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 195, 'with_embedding': 195, 'linked_chunks': 154}
2025-11-30 21:23:25,373 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:23:25,445 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 392 nodes
2025-11-30 21:23:25,601 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 351 nodes
2025-11-30 21:23:25,784 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 392, 'relationship_count': 1154, 'density': 0.0075, 'avg_degree': 5.8878, 'avg_unique_neighbors': 5.8367, 'global_efficiency': 0.3229, 'avg_path_length': 2.6885, 'avg_degree_centrality': 0.0151, 'max_degree_centrality': 0.5499, 'avg_betweenness_centrality': 0.0009, 'max_betweenness_centrality': 0.039, 'degree_assortativity': -0.2061, 'graph_robustness': 0.8024, 'diameter_estimate': 6, 'clustering_coefficient': 0.2383, 'weakly_connected_components': 42, 'largest_wcc_size': 351, 'pagerank_top10_percent': 7.55, 'louvain_communities': 54, 'louvain_modularity': 0.4168, 'label_entropy': 1.5, 'computational_time': 0.4107537950621918}
2025-11-30 21:23:25,784 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 40, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509005.7847917, 'total_time': 18.922519634012133, 'aggregation': 2.486049197614193e-06, 'network_info': 0.011455292929895222, 'llm_extraction': 18.2107854509959, 'data_cleaning': 3.2791984267532825e-05, 'neo4j_injection': 0.2877199159702286, 'embedding_time': 0, 'indexing_time': 0.0023431190056726336, 'graph_injection_time': 0.2850321199512109, 'acs_metrics': {'node_count': 392, 'relationship_count': 1154, 'density': 0.0075, 'avg_degree': 5.8878, 'avg_unique_neighbors': 5.8367, 'global_efficiency': 0.3229, 'avg_path_length': 2.6885, 'avg_degree_centrality': 0.0151, 'max_degree_centrality': 0.5499, 'avg_betweenness_centrality': 0.0009, 'max_betweenness_centrality': 0.039, 'degree_assortativity': -0.2061, 'graph_robustness': 0.8024, 'diameter_estimate': 6, 'clustering_coefficient': 0.2383, 'weakly_connected_components': 42, 'largest_wcc_size': 351, 'pagerank_top10_percent': 7.55, 'louvain_communities': 54, 'louvain_modularity': 0.4168, 'label_entropy': 1.5, 'computational_time': 0.4107537950621918}, 'retrieval_queries': []}
2025-11-30 21:23:25,784 - src.pipeline.kg_builder - DEBUG - Batch 40 metrics: {
  "batch_idx": 40,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509005.7847917,
  "total_time": 18.922519634012133,
  "aggregation": 2.486049197614193e-06,
  "network_info": 0.011455292929895222,
  "llm_extraction": 18.2107854509959,
  "data_cleaning": 3.2791984267532825e-05,
  "neo4j_injection": 0.2877199159702286,
  "embedding_time": 0,
  "indexing_time": 0.0023431190056726336,
  "graph_injection_time": 0.2850321199512109,
  "acs_metrics": {
    "node_count": 392,
    "relationship_count": 1154,
    "density": 0.0075,
    "avg_degree": 5.8878,
    "avg_unique_neighbors": 5.8367,
    "global_efficiency": 0.3229,
    "avg_path_length": 2.6885,
    "avg_degree_centrality": 0.0151,
    "max_degree_centrality": 0.5499,
    "avg_betweenness_centrality": 0.0009,
    "max_betweenness_centrality": 0.039,
    "degree_assortativity": -0.2061,
    "graph_robustness": 0.8024,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2383,
    "weakly_connected_components": 42,
    "largest_wcc_size": 351,
    "pagerank_top10_percent": 7.55,
    "louvain_communities": 54,
    "louvain_modularity": 0.4168,
    "label_entropy": 1.5,
    "computational_time": 0.4107537950621918
  },
  "retrieval_queries": []
}
2025-11-30 21:23:25,785 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:23:25,785 - src.pipeline.kg_builder - INFO - Batch 41 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 18.21s, Clean: 0.00s, Neo4j: 0.29s, ACS: 0.41s
2025-11-30 21:23:25,785 - src.pipeline.kg_builder - INFO - Batch 41 completed in 18.92s
Processing KG batches:  57%|█████▋    | 41/72 [16:28<11:20, 21.95s/it]2025-11-30 21:23:25,785 - src.pipeline.kg_builder - INFO - Processing batch 42/72 (3 items)
2025-11-30 21:23:25,785 - src.pipeline.kg_builder - DEBUG - Batch 42 current_video_time: 10:23-10:28
2025-11-30 21:23:25,795 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 392
- Total Relationships: 340
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:23:25,796 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:23:25,796 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_0 ~220 words, content: Time: 10:13-10:18 Content: The sequence of frames captures a precise laboratory procedure, likely a titration or the preparation of a solution, from a first-person perspective....
2025-11-30 21:23:25,796 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_1 ~227 words, content: clear. The action is deliberate and controlled, suggesting a need for precision. - **Final Adjustment:** The person continues to add the liquid from the pipette...
2025-11-30 21:23:25,796 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_2 ~229 words, content: The person's right hand is using a pipette to add a clear liquid drop by drop into the graduated cylinder. The liquid being added is...
2025-11-30 21:23:25,796 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3 ~226 words, content: digital balance, a magnetic stirrer, and a volumetric flask. - **Initial Action:** The primary focus is on a person wearing blue nitrile gloves, who is...
2025-11-30 21:23:25,796 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_4 ~54 words, content: is one of concentration and precision, highlighting the importance of accuracy in scientific research. In summary, the video shows a detailed and methodical process of...
2025-11-30 21:23:25,817 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:23:25,898 - src.components.pre_llm_injector - DEBUG - Found 195 existing chunk embeddings for similarity lookup
2025-11-30 21:23:25,952 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_1', '0.843'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.842')]
2025-11-30 21:23:25,954 - src.components.pre_llm_injector - DEBUG - Found 6 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2
2025-11-30 21:23:25,954 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:23:25,954 - src.components.pre_llm_injector - DEBUG - Found 5 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_1
2025-11-30 21:23:25,954 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:23:25,978 - src.components.pre_llm_injector - DEBUG - Limited Person from 114 to 2 external connections
2025-11-30 21:23:25,978 - src.components.pre_llm_injector - DEBUG - Limited Document from 6 to 2 external connections
2025-11-30 21:23:25,978 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 125 total -> 9 (internal: 3, external: 6)
2025-11-30 21:23:25,978 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Person / ID: 0_0)-[WRITES_ON]->(Document / ID: 0_2), (Person / ID: 0_0)-[USES]->(Wash_Bottle / ID: 11_1), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2), (Document / ID: 0_2)-[CONTAINS]->(Measured Volume / ID: 2_0), (Document / ID: 0_2)-[CONTAINS]->(Chemical Equation / ID: 2_0), (Wash_Bottle / ID: 11_1)-[DISPENSES]->(Mass Of Liquid / ID: 15_1), (Wash_Bottle / ID: 11_1)-[DISPENSES]->(Chemical Substance / ID: 10_0)
2025-11-30 21:23:25,979 - src.components.pre_llm_injector - DEBUG - Limited Person from 116 to 2 external connections
2025-11-30 21:23:25,979 - src.components.pre_llm_injector - DEBUG - Limited Laboratory from 7 to 2 external connections
2025-11-30 21:23:25,979 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 125 total -> 6 (internal: 1, external: 5)
2025-11-30 21:23:25,979 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[TRANSFERS]->(Chemical Substance / ID: 10_0), (Person / ID: 0_0)-[WRITES_ON]->(Document / ID: 0_2), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance_Scale / ID: 0_1), (Digital Balance / ID: 16_1)-[IS_VISIBLE_IN_BACKGROUND]->(Laboratory / ID: 0_1), (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1)
2025-11-30 21:23:25,979 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_3', '0.780'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_3', '0.624')]
2025-11-30 21:23:25,979 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_1', '0.819'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_2', '0.787')]
2025-11-30 21:23:25,979 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_3', '0.838'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_5', '0.659')]
2025-11-30 21:23:25,979 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_1', '0.843'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.842')]
2025-11-30 21:23:25,979 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3', '0.798'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_5', '0.770')]
2025-11-30 21:23:25,979 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:23:25,980 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_0) (~220 words) with timeout=5.0s retries=3
2025-11-30 21:23:27,243 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:23:27,244 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:23:27,244 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_1) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:23:28,377 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:23:28,378 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:23:28,378 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_2) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:23:29,653 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:23:29,654 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:23:29,654 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:23:30,947 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:23:30,948 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:23:30,948 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_4) (~54 words) with timeout=5.0s retries=3
2025-11-30 21:23:32,321 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:23:32,321 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:23:32,321 - src.components.pre_llm_injector - INFO - Extracted 28 local triplets from 5 chunks
2025-11-30 21:23:32,321 - src.pipeline.kg_builder - INFO - Pre-extraction: 28 triplets in 6.53s
2025-11-30 21:23:32,322 - src.components.global_refiner - INFO - Capping refinement input: 28 → 15 triplets
2025-11-30 21:23:32,322 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Person / ID: 0_0)-[WRITES_ON]->(Document / ID: 0_2), (Person / ID: 0_0)-[USES]->(Wash_Bottle / ID: 11_1), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2), (Document / ID: 0_2)-[CONTAINS]->(Measured Volume / ID: 2_0), (Document / ID: 0_2)-[CONTAINS]->(Chemical Equation / ID: 2_0), (Wash_Bottle / ID: 11_1)-[DISPENSES]->(Mass Of Liquid / ID: 15_1), (Wash_Bottle / ID: 11_1)-[DISPENSES]->(Chemical Substance / ID: 10_0)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[TRANSFERS]->(Chemical Substance / ID: 10_0), (Person / ID: 0_0)-[WRITES_ON]->(Document / ID: 0_2), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance_Scale / ID: 0_1), (Digital Balance / ID: 16_1)-[IS_VISIBLE_IN_BACKGROUND]->(Laboratory / ID: 0_1), (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Nitrile_Gloves", "source_chunks": ["41_0"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated_Cylinder", "source_chunks": ["41_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["41_0", "41_2", "41_3"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["41_0"]}, {"head": "Graduated_Cylinder", "relation": "Receives", "tail": "Liquid", "source_chunks": ["41_0"]}, {"head": "Person", "relation": "Adds", "tail": "Liquid_To_Graduated_Cylinder", "source_chunks": ["41_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["41_1"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated Cylinder", "source_chunks": ["41_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["41_1"]}, {"head": "Pipette", "relation": "Delivers", "tail": "Liquid", "source_chunks": ["41_1"]}, {"head": "Graduated Cylinder", "relation": "Receives", "tail": "Liquid", "source_chunks": ["41_1"]}, {"head": "Person", "relation": "Performs", "tail": "Precise Liquid Transfer", "source_chunks": ["41_1"]}, {"head": "Pipette", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["41_2"]}, {"head": "Liquid", "relation": "Enters", "tail": "Graduated Cylinder", "source_chunks": ["41_2"]}, {"head": "Person", "relation": "Observes", "tail": "Graduated Cylinder", "source_chunks": ["41_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:23:32,322 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~424 words, ~551 tokens)
2025-11-30 21:23:32,322 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:24:55,145 - src.components.global_refiner - ERROR - Instruction-based refinement failed after 82.82s: Could not parse response content as the length limit was reached - CompletionUsage(completion_tokens=4000, prompt_tokens=1318, total_tokens=5318, completion_tokens_details=None, prompt_tokens_details=None)
2025-11-30 21:24:55,145 - src.components.global_refiner - INFO - Using fallback deduplication: 15 → 15 triplets
2025-11-30 21:24:55,145 - src.pipeline.kg_builder - INFO - Global refinement: 15 triplets in 82.82s
2025-11-30 21:24:55,145 - src.pipeline.kg_builder - INFO - Using 15 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:24:55,145 - src.pipeline.kg_builder - INFO - Pushing batch 42/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:24:55,145 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:24:55,334 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=400, relationships=353
2025-11-30 21:24:55,335 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:24:55,341 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=400, relationships=353
2025-11-30 21:24:55,342 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:24:55,342 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:24:55,342 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:24:55,342 - src.components.neo4j_handler - INFO - Batch injected in 0.20s (triplets: 0.20s, indexes: 0.00s)
2025-11-30 21:24:55,343 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 200, 'with_embedding': 200, 'linked_chunks': 158}
2025-11-30 21:24:55,344 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:24:55,396 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 400 nodes
2025-11-30 21:24:55,567 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 358 nodes
2025-11-30 21:24:55,759 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 400, 'relationship_count': 1180, 'density': 0.0074, 'avg_degree': 5.9, 'avg_unique_neighbors': 5.845, 'global_efficiency': 0.3248, 'avg_path_length': 2.6677, 'avg_degree_centrality': 0.0148, 'max_degree_centrality': 0.5614, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0429, 'degree_assortativity': -0.2156, 'graph_robustness': 0.7941, 'diameter_estimate': 6, 'clustering_coefficient': 0.2444, 'weakly_connected_components': 43, 'largest_wcc_size': 358, 'pagerank_top10_percent': 7.41, 'louvain_communities': 52, 'louvain_modularity': 0.4271, 'label_entropy': 1.5, 'computational_time': 0.4152933780569583}
2025-11-30 21:24:55,759 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 41, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509095.7595577, 'total_time': 89.97365400893614, 'aggregation': 2.8529902920126915e-06, 'network_info': 0.009528166963718832, 'llm_extraction': 89.34988472401164, 'data_cleaning': 3.2008043490350246e-05, 'neo4j_injection': 0.19740125304087996, 'embedding_time': 0, 'indexing_time': 0.0015868740156292915, 'graph_injection_time': 0.19546636589802802, 'acs_metrics': {'node_count': 400, 'relationship_count': 1180, 'density': 0.0074, 'avg_degree': 5.9, 'avg_unique_neighbors': 5.845, 'global_efficiency': 0.3248, 'avg_path_length': 2.6677, 'avg_degree_centrality': 0.0148, 'max_degree_centrality': 0.5614, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0429, 'degree_assortativity': -0.2156, 'graph_robustness': 0.7941, 'diameter_estimate': 6, 'clustering_coefficient': 0.2444, 'weakly_connected_components': 43, 'largest_wcc_size': 358, 'pagerank_top10_percent': 7.41, 'louvain_communities': 52, 'louvain_modularity': 0.4271, 'label_entropy': 1.5, 'computational_time': 0.4152933780569583}, 'retrieval_queries': []}
2025-11-30 21:24:55,759 - src.pipeline.kg_builder - DEBUG - Batch 41 metrics: {
  "batch_idx": 41,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509095.7595577,
  "total_time": 89.97365400893614,
  "aggregation": 2.8529902920126915e-06,
  "network_info": 0.009528166963718832,
  "llm_extraction": 89.34988472401164,
  "data_cleaning": 3.2008043490350246e-05,
  "neo4j_injection": 0.19740125304087996,
  "embedding_time": 0,
  "indexing_time": 0.0015868740156292915,
  "graph_injection_time": 0.19546636589802802,
  "acs_metrics": {
    "node_count": 400,
    "relationship_count": 1180,
    "density": 0.0074,
    "avg_degree": 5.9,
    "avg_unique_neighbors": 5.845,
    "global_efficiency": 0.3248,
    "avg_path_length": 2.6677,
    "avg_degree_centrality": 0.0148,
    "max_degree_centrality": 0.5614,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.0429,
    "degree_assortativity": -0.2156,
    "graph_robustness": 0.7941,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2444,
    "weakly_connected_components": 43,
    "largest_wcc_size": 358,
    "pagerank_top10_percent": 7.41,
    "louvain_communities": 52,
    "louvain_modularity": 0.4271,
    "label_entropy": 1.5,
    "computational_time": 0.4152933780569583
  },
  "retrieval_queries": []
}
2025-11-30 21:24:55,760 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:24:55,760 - src.pipeline.kg_builder - INFO - Batch 42 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 89.35s, Clean: 0.00s, Neo4j: 0.20s, ACS: 0.42s
2025-11-30 21:24:55,760 - src.pipeline.kg_builder - INFO - Batch 42 completed in 89.97s
Processing KG batches:  58%|█████▊    | 42/72 [17:58<21:10, 42.35s/it]2025-11-30 21:24:55,760 - src.pipeline.kg_builder - INFO - Processing batch 43/72 (3 items)
2025-11-30 21:24:55,760 - src.pipeline.kg_builder - DEBUG - Batch 43 current_video_time: 10:38-10:43
2025-11-30 21:24:55,766 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 400
- Total Relationships: 353
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:24:55,766 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:24:55,766 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_0 ~222 words, content: Time: 10:28-10:33 Content: The video captures a detailed, first-person perspective of a precise laboratory procedure, likely a titration or the preparation of a solution. The...
2025-11-30 21:24:55,766 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_1 ~222 words, content: graduated cylinder, ensuring it is stable and properly aligned. The left hand, which is also wearing a black wristwatch, holds the cylinder firmly. The right...
2025-11-30 21:24:55,766 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_2 ~222 words, content: and precise, suggesting the importance of accurate measurement. The surrounding environment provides context for the experiment: - To the left, a white bottle with a...
2025-11-30 21:24:55,766 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_3 ~198 words, content: pipette to transfer a clear liquid from a small vial into a larger, empty volumetric flask. The work is being done on a black countertop,...
2025-11-30 21:24:55,786 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:24:55,872 - src.components.pre_llm_injector - DEBUG - Found 200 existing chunk embeddings for similarity lookup
2025-11-30 21:24:55,915 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_0', '0.848'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3', '0.810')]
2025-11-30 21:24:55,917 - src.components.pre_llm_injector - DEBUG - Found 4 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_0
2025-11-30 21:24:55,917 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:24:55,917 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3
2025-11-30 21:24:55,917 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:24:55,942 - src.components.pre_llm_injector - DEBUG - Limited Person from 120 to 2 external connections
2025-11-30 21:24:55,942 - src.components.pre_llm_injector - DEBUG - Limited Digital_Balance from 14 to 2 external connections
2025-11-30 21:24:55,942 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 140 total -> 10 (internal: 4, external: 6)
2025-11-30 21:24:55,942 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[USES]->(Wash_Bottle / ID: 11_1), (Person / ID: 0_0)-[USES]->(Digital_Balance / ID: 16_0), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Digital_Balance / ID: 16_0)-[IS_USED_BY]->(Person / ID: 0_0), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[OPENS]->(Glass_Draft_Shield / ID: 7_0), (Volumetric Flask / ID: 18_1)-[IS_ON]->(Digital_Balance / ID: 16_0), (Lab_Bench / ID: 3_0)-[CONTAINS]->(Digital_Balance / ID: 16_0), (Wash_Bottle / ID: 11_1)-[DISPENSES]->(Mass Of Liquid / ID: 15_1), (Wash_Bottle / ID: 11_1)-[DISPENSES]->(Chemical Substance / ID: 10_0)
2025-11-30 21:24:55,943 - src.components.pre_llm_injector - DEBUG - Limited Person from 122 to 2 external connections
2025-11-30 21:24:55,943 - src.components.pre_llm_injector - DEBUG - Limited Pipette from 3 to 2 external connections
2025-11-30 21:24:55,943 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 127 total -> 6 (internal: 2, external: 4)
2025-11-30 21:24:55,943 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(Pipette / ID: 40_2), (Person / ID: 0_0)-[USES]->(Pipette / ID: 40_2), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Pipette / ID: 40_2)-[DELIVERS]->(Liquid / ID: 38_0), (Pipette / ID: 40_2)-[TRANSFERS]->(Liquid / ID: 38_0)
2025-11-30 21:24:55,943 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_0', '0.848'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.751')]
2025-11-30 21:24:55,943 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_2', '0.615'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_0', '0.603')]
2025-11-30 21:24:55,943 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3', '0.785'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.783')]
2025-11-30 21:24:55,943 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3', '0.810'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.790')]
2025-11-30 21:24:55,943 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:24:55,943 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_0) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:24:57,357 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:24:57,358 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:24:57,358 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_1) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:24:58,441 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:24:58,441 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:24:58,441 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_2) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:24:59,792 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:24:59,793 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:24:59,793 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_3) (~198 words) with timeout=5.0s retries=3
2025-11-30 21:25:01,202 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:25:01,202 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:25:01,202 - src.components.pre_llm_injector - INFO - Extracted 21 local triplets from 4 chunks
2025-11-30 21:25:01,202 - src.pipeline.kg_builder - INFO - Pre-extraction: 21 triplets in 5.44s
2025-11-30 21:25:01,202 - src.components.global_refiner - INFO - Capping refinement input: 21 → 15 triplets
2025-11-30 21:25:01,203 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[USES]->(Wash_Bottle / ID: 11_1), (Person / ID: 0_0)-[USES]->(Digital_Balance / ID: 16_0), (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Digital_Balance / ID: 16_0)-[IS_USED_BY]->(Person / ID: 0_0), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[OPENS]->(Glass_Draft_Shield / ID: 7_0), (Volumetric Flask / ID: 18_1)-[IS_ON]->(Digital_Balance / ID: 16_0), (Lab_Bench / ID: 3_0)-[CONTAINS]->(Digital_Balance / ID: 16_0), (Wash_Bottle / ID: 11_1)-[DISPENSES]->(Mass Of Liquid / ID: 15_1), (Wash_Bottle / ID: 11_1)-[DISPENSES]->(Chemical Substance / ID: 10_0)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[HOLDS]->(Pipette / ID: 40_2), (Person / ID: 0_0)-[USES]->(Pipette / ID: 40_2), (Person / ID: 0_0)-[HOLDS]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Pipette / ID: 40_2)-[DELIVERS]->(Liquid / ID: 38_0), (Pipette / ID: 40_2)-[TRANSFERS]->(Liquid / ID: 38_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["42_0"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated_Cylinder", "source_chunks": ["42_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["42_0", "42_1"]}, {"head": "Pipette", "relation": "Adds", "tail": "Clear_Liquid", "source_chunks": ["42_0"]}, {"head": "Graduated_Cylinder", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["42_0"]}, {"head": "Graduated_Cylinder", "relation": "Rests On", "tail": "Analytical_Balance", "source_chunks": ["42_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["42_1", "42_2"]}, {"head": "Person", "relation": "Holds", "tail": "Graduated Cylinder", "source_chunks": ["42_1"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["42_1", "42_2"]}, {"head": "Graduated Cylinder", "relation": "Contains", "tail": "Liquid", "source_chunks": ["42_1"]}, {"head": "Person", "relation": "Makes", "tail": "Final Adjustments", "source_chunks": ["42_1"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["42_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Dark Opaque Liquid", "source_chunks": ["42_2"]}, {"head": "Digital Balance", "relation": "Displays", "tail": "0.000 G", "source_chunks": ["42_2"]}, {"head": "Magnetic Stirrer", "relation": "Has", "tail": "Glass Beaker", "source_chunks": ["42_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:25:01,203 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~433 words, ~563 tokens)
2025-11-30 21:25:01,203 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:25:13,343 - src.components.global_refiner - DEBUG - LLM call completed in 12.14s
2025-11-30 21:25:13,343 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue Nitrile Gloves', ['42_0', '42_1', '42_2']], ['Person', 'Holds', 'Graduated Cylinder', ['42_0', '42_1']], ['Person', 'Uses', 'Pipette', ['42_0', '42_1']], ['Pipette', 'Adds', 'Clear Liquid', ['42_0']], ['Graduated Cylinder', 'Contains', 'Clear Liquid', ['42_0']], ['Graduated Cylinder', 'Rests On', 'Analytical Balance', ['42_0']], ['Person', 'Makes', 'Final Adjustments', ['42_1']], ['Pipette', 'Transfers', 'Liquid', ['42_2']], ['Beaker', 'Contains', 'Dark Opaque Liquid', ['42_2']], ['Digital Balance', 'Displays', '0.000 G', ['42_2']], ['Magnetic Stirrer', 'Has', 'Glass Beaker', ['42_2']]] inter_chunk_relations=[['Graduated Cylinder', 'Rests On', 'Analytical Balance', ['42_0']], ['Digital Balance', 'Displays', '0.000 G', ['42_2']], ['Pipette', 'Transfers', 'Liquid', ['42_2']], ['Beaker', 'Contains', 'Dark Opaque Liquid', ['42_2']], ['Magnetic Stirrer', 'Has', 'Glass Beaker', ['42_2']]] merge_instructions=[{'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}, {'local': 'Clear Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Dark Opaque Liquid', 'existing': 'Chemical Substance', 'existing_id': '10_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Bottle'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Pipette'}, {'head': 'Pipette', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Pipette', 'relation': 'Adds', 'tail': 'Clear Liquid'}]
2025-11-30 21:25:13,343 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=11, sample=[['Person', 'Wears', 'Blue Nitrile Gloves', ['42_0', '42_1', '42_2']], ['Person', 'Holds', 'Graduated Cylinder', ['42_0', '42_1']], ['Person', 'Uses', 'Pipette', ['42_0', '42_1']]]
2025-11-30 21:25:13,343 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Graduated Cylinder', 'Rests On', 'Analytical Balance', ['42_0']], ['Digital Balance', 'Displays', '0.000 G', ['42_2']], ['Pipette', 'Transfers', 'Liquid', ['42_2']]]
2025-11-30 21:25:13,343 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}, {'local': 'Clear Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}]
2025-11-30 21:25:13,343 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Bottle'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Pipette'}, {'head': 'Pipette', 'relation': 'Transfers', 'tail': 'Liquid'}]
2025-11-30 21:25:13,343 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}, {'local': 'Clear Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Dark Opaque Liquid', 'existing': 'Chemical Substance', 'existing_id': '10_0'}]
2025-11-30 21:25:13,343 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Holds', 'tail': 'Bottle'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Pipette'}, {'head': 'Pipette', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Pipette', 'relation': 'Adds', 'tail': 'Clear Liquid'}]
2025-11-30 21:25:13,343 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 16 triplets (total: 12.14s, LLM: 12.14s)
2025-11-30 21:25:13,343 - src.pipeline.kg_builder - INFO - Global refinement: 16 triplets in 12.14s
2025-11-30 21:25:13,343 - src.pipeline.kg_builder - INFO - Using 16 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:25:13,343 - src.pipeline.kg_builder - INFO - Pushing batch 43/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:25:13,343 - src.components.neo4j_handler - INFO - Adding 11 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:25:13,497 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=410, relationships=359
2025-11-30 21:25:13,497 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:25:13,497 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue Nitrile Gloves -> Blue Nitrile Gloves
2025-11-30 21:25:13,497 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear Liquid -> Mass Of Liquid
2025-11-30 21:25:13,503 - src.components.neo4j_handler - DEBUG - APOC merge successful: Liquid -> Mass Of Liquid
2025-11-30 21:25:13,507 - src.components.neo4j_handler - DEBUG - APOC merge successful: Dark Opaque Liquid -> Chemical Substance
2025-11-30 21:25:13,507 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:25:13,514 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Bottle
2025-11-30 21:25:13,515 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Pipette
2025-11-30 21:25:13,516 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Pipette -[Transfers]-> Liquid
2025-11-30 21:25:13,516 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Pipette -[Adds]-> Clear Liquid
2025-11-30 21:25:13,516 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:25:13,518 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Graduated Cylinder -[Rests On]-> Analytical Balance
2025-11-30 21:25:13,519 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital Balance -[Displays]-> 0.000 G
2025-11-30 21:25:13,519 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Pipette -[Transfers]-> Liquid
2025-11-30 21:25:13,520 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Contains]-> Dark Opaque Liquid
2025-11-30 21:25:13,521 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Magnetic Stirrer -[Has]-> Glass Beaker
2025-11-30 21:25:13,522 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:25:13,528 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=407, relationships=353
2025-11-30 21:25:13,529 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:25:13,529 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:25:13,529 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:25:13,529 - src.components.neo4j_handler - INFO - Batch injected in 0.19s (triplets: 0.18s, indexes: 0.00s)
2025-11-30 21:25:13,531 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 204, 'with_embedding': 204, 'linked_chunks': 161}
2025-11-30 21:25:13,531 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:25:13,606 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 407 nodes
2025-11-30 21:25:13,782 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 364 nodes
2025-11-30 21:25:13,981 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 407, 'relationship_count': 1203, 'density': 0.0073, 'avg_degree': 5.9115, 'avg_unique_neighbors': 5.8575, 'global_efficiency': 0.3239, 'avg_path_length': 2.6706, 'avg_degree_centrality': 0.0146, 'max_degree_centrality': 0.5591, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0403, 'degree_assortativity': -0.218, 'graph_robustness': 0.8687, 'diameter_estimate': 6, 'clustering_coefficient': 0.246, 'weakly_connected_components': 44, 'largest_wcc_size': 364, 'pagerank_top10_percent': 7.29, 'louvain_communities': 53, 'louvain_modularity': 0.4134, 'label_entropy': 1.5, 'computational_time': 0.4505561609985307}
2025-11-30 21:25:13,982 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 42, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509113.9822004, 'total_time': 18.221532891970128, 'aggregation': 2.5619519874453545e-06, 'network_info': 0.005600805045105517, 'llm_extraction': 17.577190053998493, 'data_cleaning': 1.879094634205103e-05, 'neo4j_injection': 0.1863115030573681, 'embedding_time': 0, 'indexing_time': 0.0012763519771397114, 'graph_injection_time': 0.1847737010102719, 'acs_metrics': {'node_count': 407, 'relationship_count': 1203, 'density': 0.0073, 'avg_degree': 5.9115, 'avg_unique_neighbors': 5.8575, 'global_efficiency': 0.3239, 'avg_path_length': 2.6706, 'avg_degree_centrality': 0.0146, 'max_degree_centrality': 0.5591, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0403, 'degree_assortativity': -0.218, 'graph_robustness': 0.8687, 'diameter_estimate': 6, 'clustering_coefficient': 0.246, 'weakly_connected_components': 44, 'largest_wcc_size': 364, 'pagerank_top10_percent': 7.29, 'louvain_communities': 53, 'louvain_modularity': 0.4134, 'label_entropy': 1.5, 'computational_time': 0.4505561609985307}, 'retrieval_queries': []}
2025-11-30 21:25:13,982 - src.pipeline.kg_builder - DEBUG - Batch 42 metrics: {
  "batch_idx": 42,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509113.9822004,
  "total_time": 18.221532891970128,
  "aggregation": 2.5619519874453545e-06,
  "network_info": 0.005600805045105517,
  "llm_extraction": 17.577190053998493,
  "data_cleaning": 1.879094634205103e-05,
  "neo4j_injection": 0.1863115030573681,
  "embedding_time": 0,
  "indexing_time": 0.0012763519771397114,
  "graph_injection_time": 0.1847737010102719,
  "acs_metrics": {
    "node_count": 407,
    "relationship_count": 1203,
    "density": 0.0073,
    "avg_degree": 5.9115,
    "avg_unique_neighbors": 5.8575,
    "global_efficiency": 0.3239,
    "avg_path_length": 2.6706,
    "avg_degree_centrality": 0.0146,
    "max_degree_centrality": 0.5591,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.0403,
    "degree_assortativity": -0.218,
    "graph_robustness": 0.8687,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.246,
    "weakly_connected_components": 44,
    "largest_wcc_size": 364,
    "pagerank_top10_percent": 7.29,
    "louvain_communities": 53,
    "louvain_modularity": 0.4134,
    "label_entropy": 1.5,
    "computational_time": 0.4505561609985307
  },
  "retrieval_queries": []
}
2025-11-30 21:25:13,983 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:25:13,983 - src.pipeline.kg_builder - INFO - Batch 43 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 17.58s, Clean: 0.00s, Neo4j: 0.19s, ACS: 0.45s
2025-11-30 21:25:13,983 - src.pipeline.kg_builder - INFO - Batch 43 completed in 18.22s
Processing KG batches:  60%|█████▉    | 43/72 [18:16<16:58, 35.12s/it]2025-11-30 21:25:13,983 - src.pipeline.kg_builder - INFO - Processing batch 44/72 (3 items)
2025-11-30 21:25:13,983 - src.pipeline.kg_builder - DEBUG - Batch 44 current_video_time: 10:53-10:58
2025-11-30 21:25:13,991 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 407
- Total Relationships: 353
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:25:13,991 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:25:13,991 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_43_0 ~217 words, content: Time: 10:43-10:48 Content: The video sequence captures a detailed laboratory procedure, likely a chemical preparation or analysis, performed by a person wearing blue nitrile gloves....
2025-11-30 21:25:13,991 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_43_1 ~230 words, content: an empty container before tare. This suggests the person has just tared the balance, setting the weight of the empty vial to zero. The person...
2025-11-30 21:25:13,991 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_43_2 ~230 words, content: nitrile gloves is handling a small, clear glass vial. In the foreground, a digital analytical balance is visible, with its display reading "0.000". To the...
2025-11-30 21:25:13,991 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_43_3 ~220 words, content: . The digital balance is on the left, and the magnetic stirrer is in the center. A person's hand, wearing a blue glove, is seen...
2025-11-30 21:25:13,991 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_43_4 ~217 words, content: the left, a digital balance scale is visible, with its display reading `0.000`. To the right, a magnetic stirrer holds a beaker, and a burette...
2025-11-30 21:25:13,991 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_43_5 ~82 words, content: , remains in place, indicating that the experiment is ongoing. The overall atmosphere is one of concentration and precision, typical of a scientific research environment....
2025-11-30 21:25:14,012 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:25:14,098 - src.components.pre_llm_injector - DEBUG - Found 204 existing chunk embeddings for similarity lookup
2025-11-30 21:25:14,168 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_3', '0.838'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.837')]
2025-11-30 21:25:14,170 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_3
2025-11-30 21:25:14,170 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:25:14,171 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3
2025-11-30 21:25:14,171 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:25:14,175 - src.components.pre_llm_injector - DEBUG - Limited Burette from 8 to 2 external connections
2025-11-30 21:25:14,176 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 8 total -> 2 (internal: 0, external: 2)
2025-11-30 21:25:14,176 - src.components.pre_llm_injector - DEBUG - Subgraph: (Burette / ID: 4_2)-[CONTAINS]->(Chemical Substance / ID: 10_0), (Person / ID: 0_0)-[CONTROLS]->(Burette / ID: 4_2)
2025-11-30 21:25:14,185 - src.components.pre_llm_injector - DEBUG - Limited Person from 119 to 2 external connections
2025-11-30 21:25:14,185 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 119 total -> 2 (internal: 0, external: 2)
2025-11-30 21:25:14,185 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[PERFORMS]->(Liquid_Measurement / ID: 30_0), (Person / ID: 0_0)-[WEARS]->(Blue Gloves / ID: 35_1)
2025-11-30 21:25:14,185 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.764'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_0', '0.758')]
2025-11-30 21:25:14,185 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_1', '0.779'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_2', '0.772')]
2025-11-30 21:25:14,185 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_3', '0.781'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.768')]
2025-11-30 21:25:14,185 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_3', '0.838'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_1', '0.676')]
2025-11-30 21:25:14,185 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_0', '0.806'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_0', '0.795')]
2025-11-30 21:25:14,185 - src.components.pre_llm_injector - DEBUG - Chunk 5 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.837'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4', '0.814')]
2025-11-30 21:25:14,185 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:25:14,185 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_43_0) (~217 words) with timeout=5.0s retries=3
2025-11-30 21:25:15,769 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:25:15,769 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:25:15,770 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_43_1) (~230 words) with timeout=5.0s retries=3
2025-11-30 21:25:16,949 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:25:16,949 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:25:16,950 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_43_2) (~230 words) with timeout=5.0s retries=3
2025-11-30 21:25:18,459 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:25:18,459 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:25:18,460 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_43_3) (~220 words) with timeout=5.0s retries=3
2025-11-30 21:25:19,823 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:25:19,823 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:25:19,824 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_43_4) (~217 words) with timeout=5.0s retries=3
2025-11-30 21:25:21,213 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:25:21,214 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:25:21,214 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_43_5) (~82 words) with timeout=5.0s retries=3
2025-11-30 21:25:22,274 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:25:22,275 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:25:22,275 - src.components.pre_llm_injector - INFO - Extracted 35 local triplets from 6 chunks
2025-11-30 21:25:22,275 - src.pipeline.kg_builder - INFO - Pre-extraction: 35 triplets in 8.28s
2025-11-30 21:25:22,275 - src.components.global_refiner - INFO - Capping refinement input: 35 → 15 triplets
2025-11-30 21:25:22,276 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Burette / ID: 4_2)-[CONTAINS]->(Chemical Substance / ID: 10_0), (Person / ID: 0_0)-[CONTROLS]->(Burette / ID: 4_2)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[PERFORMS]->(Liquid_Measurement / ID: 30_0), (Person / ID: 0_0)-[WEARS]->(Blue Gloves / ID: 35_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["43_0"]}, {"head": "Person", "relation": "Handles", "tail": "Glass_Vial", "source_chunks": ["43_0"]}, {"head": "Glass_Vial", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["43_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "0.000_G", "source_chunks": ["43_0"]}, {"head": "Person", "relation": "Places", "tail": "Glass_Vial_On_Digital_Balance", "source_chunks": ["43_0"]}, {"head": "Digital_Balance", "relation": "Is On", "tail": "Laboratory_Bench", "source_chunks": ["43_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["43_1", "43_4"]}, {"head": "Person", "relation": "Holds", "tail": "Vial", "source_chunks": ["43_1"]}, {"head": "Vial", "relation": "Contains", "tail": "Liquid", "source_chunks": ["43_1"]}, {"head": "Balance", "relation": "Displays", "tail": "0.000 G", "source_chunks": ["43_1"]}, {"head": "Person", "relation": "Interacts With", "tail": "Balance", "source_chunks": ["43_1"]}, {"head": "Vial", "relation": "Is Placed On", "tail": "Balance", "source_chunks": ["43_1"]}, {"head": "Person", "relation": "Handles", "tail": "Nitrile_Gloves", "source_chunks": ["43_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Vial", "source_chunks": ["43_2"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "0.000", "source_chunks": ["43_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:25:22,276 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~341 words, ~443 tokens)
2025-11-30 21:25:22,276 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:25:36,430 - src.components.global_refiner - DEBUG - LLM call completed in 14.15s
2025-11-30 21:25:36,430 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue Nitrile Gloves', ['43_0', '43_1', '43_4']], ['Person', 'Handles', 'Glass_Vial', ['43_0', '43_2']], ['Glass_Vial', 'Is On', 'Digital_Balance', ['43_0']], ['Digital_Balance', 'Displays', '0.000_G', ['43_0']], ['Person', 'Places', 'Glass_Vial_On_Digital_Balance', ['43_0']], ['Digital_Balance', 'Is On', 'Laboratory_Bench', ['43_0']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['43_0', '43_1', '43_4']], ['Person', 'Holds', 'Vial', ['43_1']], ['Vial', 'Contains', 'Liquid', ['43_1']], ['Balance', 'Displays', '0.000 G', ['43_1']], ['Person', 'Interacts With', 'Balance', ['43_1']], ['Vial', 'Is Placed On', 'Balance', ['43_1']], ['Person', 'Handles', 'Nitrile_Gloves', ['43_2']], ['Person', 'Holds', 'Glass_Vial', ['43_2']], ['Digital_Balance', 'Displays', '0.000', ['43_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue Gloves', ['43_0', '43_1', '43_4']], ['Person', 'Holds', 'Vial', ['43_1']], ['Vial', 'Contains', 'Liquid', ['43_1']], ['Person', 'Interacts With', 'Balance', ['43_1']], ['Digital_Balance', 'Is On', 'Laboratory_Bench', ['43_0']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Gloves', 'existing_id': '35_1'}, {'local': 'Glass_Vial', 'existing': 'Vial', 'existing_id': '0_0'}, {'local': 'Digital_Balance', 'existing': 'Balance', 'existing_id': '0_0'}, {'local': '0.000_G', 'existing': '0.000', 'existing_id': '0_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Digital_Balance', 'relation': 'Displays', 'tail': '0.000'}, {'head': 'Balance', 'relation': 'Displays', 'tail': '0.000 G'}]
2025-11-30 21:25:36,430 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue Nitrile Gloves', ['43_0', '43_1', '43_4']], ['Person', 'Handles', 'Glass_Vial', ['43_0', '43_2']], ['Glass_Vial', 'Is On', 'Digital_Balance', ['43_0']]]
2025-11-30 21:25:36,430 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Person', 'Wears', 'Blue Gloves', ['43_0', '43_1', '43_4']], ['Person', 'Holds', 'Vial', ['43_1']], ['Vial', 'Contains', 'Liquid', ['43_1']]]
2025-11-30 21:25:36,430 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Gloves', 'existing_id': '35_1'}, {'local': 'Glass_Vial', 'existing': 'Vial', 'existing_id': '0_0'}, {'local': 'Digital_Balance', 'existing': 'Balance', 'existing_id': '0_0'}]
2025-11-30 21:25:36,430 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Digital_Balance', 'relation': 'Displays', 'tail': '0.000'}]
2025-11-30 21:25:36,430 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Gloves', 'existing_id': '35_1'}, {'local': 'Glass_Vial', 'existing': 'Vial', 'existing_id': '0_0'}, {'local': 'Digital_Balance', 'existing': 'Balance', 'existing_id': '0_0'}, {'local': '0.000_G', 'existing': '0.000', 'existing_id': '0_0'}]
2025-11-30 21:25:36,430 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Digital_Balance', 'relation': 'Displays', 'tail': '0.000'}, {'head': 'Balance', 'relation': 'Displays', 'tail': '0.000 G'}]
2025-11-30 21:25:36,431 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 14.16s, LLM: 14.15s)
2025-11-30 21:25:36,431 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 14.16s
2025-11-30 21:25:36,431 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:25:36,431 - src.pipeline.kg_builder - INFO - Pushing batch 44/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:25:36,431 - src.components.neo4j_handler - INFO - Adding 16 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:25:36,663 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=417, relationships=364
2025-11-30 21:25:36,663 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:25:36,664 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Gloves
2025-11-30 21:25:36,669 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass_Vial -> Vial
2025-11-30 21:25:36,672 - src.components.neo4j_handler - DEBUG - APOC merge successful: Digital_Balance -> Balance
2025-11-30 21:25:36,676 - src.components.neo4j_handler - DEBUG - APOC merge successful: 0.000_G -> 0.000
2025-11-30 21:25:36,676 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:25:36,681 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Gloves
2025-11-30 21:25:36,683 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Nitrile Gloves
2025-11-30 21:25:36,684 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Digital_Balance -[Displays]-> 0.000
2025-11-30 21:25:36,686 - src.components.neo4j_handler - DEBUG - Pruned relationship: Balance -[Displays]-> 0.000 G
2025-11-30 21:25:36,686 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:25:36,689 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue Gloves
2025-11-30 21:25:36,690 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Vial
2025-11-30 21:25:36,693 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Vial -[Contains]-> Liquid
2025-11-30 21:25:36,724 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Interacts With]-> Balance
2025-11-30 21:25:36,726 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Digital_Balance -[Is On]-> Laboratory_Bench
2025-11-30 21:25:36,727 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:25:36,734 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=413, relationships=361
2025-11-30 21:25:36,735 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:25:36,735 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:25:36,736 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:25:36,736 - src.components.neo4j_handler - INFO - Batch injected in 0.30s (triplets: 0.30s, indexes: 0.00s)
2025-11-30 21:25:36,737 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 210, 'with_embedding': 210, 'linked_chunks': 165}
2025-11-30 21:25:36,737 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:25:36,813 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 413 nodes
2025-11-30 21:25:36,985 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 368 nodes
2025-11-30 21:25:37,184 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 413, 'relationship_count': 1227, 'density': 0.0072, 'avg_degree': 5.9419, 'avg_unique_neighbors': 5.8886, 'global_efficiency': 0.3216, 'avg_path_length': 2.6694, 'avg_degree_centrality': 0.0144, 'max_degree_centrality': 0.5558, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0439, 'degree_assortativity': -0.2119, 'graph_robustness': 0.6862, 'diameter_estimate': 6, 'clustering_coefficient': 0.2434, 'weakly_connected_components': 46, 'largest_wcc_size': 368, 'pagerank_top10_percent': 7.19, 'louvain_communities': 56, 'louvain_modularity': 0.4125, 'label_entropy': 1.4999, 'computational_time': 0.4474026979878545}
2025-11-30 21:25:37,185 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 43, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509137.1850498, 'total_time': 23.20170064305421, 'aggregation': 2.6728957891464233e-06, 'network_info': 0.007707811892032623, 'llm_extraction': 22.43997378705535, 'data_cleaning': 3.792403731495142e-05, 'neo4j_injection': 0.30481047299690545, 'embedding_time': 0, 'indexing_time': 0.0018703780369833112, 'graph_injection_time': 0.30261434195563197, 'acs_metrics': {'node_count': 413, 'relationship_count': 1227, 'density': 0.0072, 'avg_degree': 5.9419, 'avg_unique_neighbors': 5.8886, 'global_efficiency': 0.3216, 'avg_path_length': 2.6694, 'avg_degree_centrality': 0.0144, 'max_degree_centrality': 0.5558, 'avg_betweenness_centrality': 0.0008, 'max_betweenness_centrality': 0.0439, 'degree_assortativity': -0.2119, 'graph_robustness': 0.6862, 'diameter_estimate': 6, 'clustering_coefficient': 0.2434, 'weakly_connected_components': 46, 'largest_wcc_size': 368, 'pagerank_top10_percent': 7.19, 'louvain_communities': 56, 'louvain_modularity': 0.4125, 'label_entropy': 1.4999, 'computational_time': 0.4474026979878545}, 'retrieval_queries': []}
2025-11-30 21:25:37,185 - src.pipeline.kg_builder - DEBUG - Batch 43 metrics: {
  "batch_idx": 43,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509137.1850498,
  "total_time": 23.20170064305421,
  "aggregation": 2.6728957891464233e-06,
  "network_info": 0.007707811892032623,
  "llm_extraction": 22.43997378705535,
  "data_cleaning": 3.792403731495142e-05,
  "neo4j_injection": 0.30481047299690545,
  "embedding_time": 0,
  "indexing_time": 0.0018703780369833112,
  "graph_injection_time": 0.30261434195563197,
  "acs_metrics": {
    "node_count": 413,
    "relationship_count": 1227,
    "density": 0.0072,
    "avg_degree": 5.9419,
    "avg_unique_neighbors": 5.8886,
    "global_efficiency": 0.3216,
    "avg_path_length": 2.6694,
    "avg_degree_centrality": 0.0144,
    "max_degree_centrality": 0.5558,
    "avg_betweenness_centrality": 0.0008,
    "max_betweenness_centrality": 0.0439,
    "degree_assortativity": -0.2119,
    "graph_robustness": 0.6862,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2434,
    "weakly_connected_components": 46,
    "largest_wcc_size": 368,
    "pagerank_top10_percent": 7.19,
    "louvain_communities": 56,
    "louvain_modularity": 0.4125,
    "label_entropy": 1.4999,
    "computational_time": 0.4474026979878545
  },
  "retrieval_queries": []
}
2025-11-30 21:25:37,186 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:25:37,186 - src.pipeline.kg_builder - INFO - Batch 44 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 22.44s, Clean: 0.00s, Neo4j: 0.30s, ACS: 0.45s
2025-11-30 21:25:37,186 - src.pipeline.kg_builder - INFO - Batch 44 completed in 23.20s
Processing KG batches:  61%|██████    | 44/72 [18:40<14:43, 31.54s/it]2025-11-30 21:25:37,186 - src.pipeline.kg_builder - INFO - Processing batch 45/72 (3 items)
2025-11-30 21:25:37,186 - src.pipeline.kg_builder - DEBUG - Batch 45 current_video_time: 11:08-11:13
2025-11-30 21:25:37,197 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 413
- Total Relationships: 361
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:25:37,198 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:25:37,198 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_0 ~223 words, content: Time: 10:58-11:03 Content: The video sequence captures a detailed laboratory procedure, likely a titration or a similar chemical analysis, performed by a person wearing blue...
2025-11-30 21:25:37,198 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_1 ~222 words, content: , a glass beaker on a stirrer, and a burette clamped to a stand on the right. Other items like a bottle with a red...
2025-11-30 21:25:37,198 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_2 ~217 words, content: experiment is taking place on a black laboratory bench. The setup includes: - A glass beaker on an electronic balance. - A blue magnetic stirrer...
2025-11-30 21:25:37,198 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_3 ~225 words, content: presence of a stirrer, a stand with a tube, and other equipment suggests a chemical synthesis or a reaction setup. Another person is observing the...
2025-11-30 21:25:37,198 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_4 ~163 words, content: . The camera angle changes again, showing more of the lab environment, including white cabinets and a fire extinguisher in the background. The person's hand...
2025-11-30 21:25:37,217 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:25:37,303 - src.components.pre_llm_injector - DEBUG - Found 210 existing chunk embeddings for similarity lookup
2025-11-30 21:25:37,360 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.832'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3', '0.821')]
2025-11-30 21:25:37,362 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3
2025-11-30 21:25:37,362 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:25:37,362 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3
2025-11-30 21:25:37,362 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:25:37,387 - src.components.pre_llm_injector - DEBUG - Limited Person from 122 to 2 external connections
2025-11-30 21:25:37,387 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 122 total -> 2 (internal: 0, external: 2)
2025-11-30 21:25:37,387 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HANDLES]->(Chemicals / ID: 36_1), (Person / ID: 0_0)-[ADDS]->(Liquid_To_Graduated_Cylinder / ID: 41_0)
2025-11-30 21:25:37,389 - src.components.pre_llm_injector - DEBUG - Limited Person from 121 to 2 external connections
2025-11-30 21:25:37,389 - src.components.pre_llm_injector - DEBUG - Limited Pipette from 4 to 2 external connections
2025-11-30 21:25:37,389 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 126 total -> 5 (internal: 1, external: 4)
2025-11-30 21:25:37,389 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[USES]->(Pipette / ID: 40_2), (Person / ID: 0_0)-[HOLDS]->(Glass_Beaker / ID: 19_0), (Person / ID: 0_0)-[HANDLES]->(Vial / ID: 34_2), (Pipette / ID: 40_2)-[DELIVERS]->(Mass Of Liquid / ID: 15_1), (Pipette / ID: 40_2)-[ADDS]->(Mass Of Liquid / ID: 15_1)
2025-11-30 21:25:37,389 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_2', '0.702'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.700')]
2025-11-30 21:25:37,389 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3', '0.821'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_7_2', '0.781')]
2025-11-30 21:25:37,389 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3', '0.646'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_3', '0.642')]
2025-11-30 21:25:37,389 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.717'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_1', '0.707')]
2025-11-30 21:25:37,389 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.832'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_2', '0.818')]
2025-11-30 21:25:37,389 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:25:37,390 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_0) (~223 words) with timeout=5.0s retries=3
2025-11-30 21:25:38,767 - src.components.pre_llm_injector - DEBUG - Extracted 5 triplets from chunk 0 (attempt 1)
2025-11-30 21:25:38,767 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 5 triplets
2025-11-30 21:25:38,767 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_1) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:25:39,935 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:25:39,935 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:25:39,935 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_2) (~217 words) with timeout=5.0s retries=3
2025-11-30 21:25:40,917 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:25:40,917 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:25:40,918 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_3) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:25:42,059 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:25:42,059 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:25:42,060 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_4) (~163 words) with timeout=5.0s retries=3
2025-11-30 21:25:43,156 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:25:43,157 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:25:43,157 - src.components.pre_llm_injector - INFO - Extracted 27 local triplets from 5 chunks
2025-11-30 21:25:43,157 - src.pipeline.kg_builder - INFO - Pre-extraction: 27 triplets in 5.96s
2025-11-30 21:25:43,157 - src.components.global_refiner - INFO - Capping refinement input: 27 → 15 triplets
2025-11-30 21:25:43,158 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[HANDLES]->(Chemicals / ID: 36_1), (Person / ID: 0_0)-[ADDS]->(Liquid_To_Graduated_Cylinder / ID: 41_0)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[USES]->(Pipette / ID: 40_2), (Person / ID: 0_0)-[HOLDS]->(Glass_Beaker / ID: 19_0), (Person / ID: 0_0)-[HANDLES]->(Vial / ID: 34_2), (Pipette / ID: 40_2)-[DELIVERS]->(Mass Of Liquid / ID: 15_1), (Pipette / ID: 40_2)-[ADDS]->(Mass Of Liquid / ID: 15_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["44_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Vial", "source_chunks": ["44_0"]}, {"head": "Glass_Vial", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["44_0"]}, {"head": "Device", "relation": "Displays", "tail": "0.352", "source_chunks": ["44_0"]}, {"head": "Device", "relation": "Has", "tail": "Green_Light", "source_chunks": ["44_0"]}, {"head": "Person", "relation": "Holds", "tail": "Vial", "source_chunks": ["44_1", "44_4"]}, {"head": "Vial", "relation": "Contains", "tail": "Liquid", "source_chunks": ["44_1"]}, {"head": "Liquid", "relation": "Is Poured Into", "tail": "Beaker", "source_chunks": ["44_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Electronic Balance", "source_chunks": ["44_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Stirrer", "source_chunks": ["44_1"]}, {"head": "Burette", "relation": "Is Clamped To", "tail": "Stand", "source_chunks": ["44_1"]}, {"head": "Person", "relation": "Performs", "tail": "Experiment", "source_chunks": ["44_2"]}, {"head": "Beaker", "relation": "Is On", "tail": "Balance", "source_chunks": ["44_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["44_2"]}, {"head": "Stirrer", "relation": "Is In", "tail": "Beaker", "source_chunks": ["44_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:25:43,158 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~365 words, ~474 tokens)
2025-11-30 21:25:43,158 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:25:56,201 - src.components.global_refiner - DEBUG - LLM call completed in 13.04s
2025-11-30 21:25:56,201 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['44_0']], ['Person', 'Holds', 'Glass_Vial', ['44_0']], ['Glass_Vial', 'Contains', 'Clear_Liquid', ['44_0']], ['Device', 'Displays', '0.352', ['44_0']], ['Device', 'Has', 'Green_Light', ['44_0']], ['Person', 'Holds', 'Vial', ['44_1', '44_4']], ['Vial', 'Contains', 'Liquid', ['44_1']], ['Liquid', 'Is Poured Into', 'Beaker', ['44_1']], ['Beaker', 'Is On', 'Electronic Balance', ['44_1']], ['Beaker', 'Is On', 'Stirrer', ['44_1']], ['Burette', 'Is Clamped To', 'Stand', ['44_1']], ['Person', 'Performs', 'Experiment', ['44_2']], ['Beaker', 'Is On', 'Balance', ['44_2']], ['Beaker', 'Contains', 'Liquid', ['44_2']], ['Stirrer', 'Is In', 'Beaker', ['44_2']]] inter_chunk_relations=[['Person', 'Holds', 'Vial', ['44_1', '44_4']], ['Beaker', 'Is On', 'Electronic Balance', ['44_1']], ['Beaker', 'Is On', 'Stirrer', ['44_1']], ['Beaker', 'Is On', 'Balance', ['44_2']], ['Stirrer', 'Is In', 'Beaker', ['44_2']]] merge_instructions=[{'local': 'Glass_Vial', 'existing': 'Vial', 'existing_id': '34_2'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Clear_Liquid', 'existing': 'Liquid', 'existing_id': '36_1'}, {'local': 'Electronic Balance', 'existing': 'Balance', 'existing_id': '15_1'}] prune_instructions=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Glass_Beaker'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Glass_Vial'}, {'head': 'Pipette', 'relation': 'ADDS', 'tail': 'Mass Of Liquid'}, {'head': 'Pipette', 'relation': 'DELIVERS', 'tail': 'Mass Of Liquid'}]
2025-11-30 21:25:56,201 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['44_0']], ['Person', 'Holds', 'Glass_Vial', ['44_0']], ['Glass_Vial', 'Contains', 'Clear_Liquid', ['44_0']]]
2025-11-30 21:25:56,201 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Person', 'Holds', 'Vial', ['44_1', '44_4']], ['Beaker', 'Is On', 'Electronic Balance', ['44_1']], ['Beaker', 'Is On', 'Stirrer', ['44_1']]]
2025-11-30 21:25:56,201 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Glass_Vial', 'existing': 'Vial', 'existing_id': '34_2'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Clear_Liquid', 'existing': 'Liquid', 'existing_id': '36_1'}]
2025-11-30 21:25:56,201 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Glass_Beaker'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Glass_Vial'}, {'head': 'Pipette', 'relation': 'ADDS', 'tail': 'Mass Of Liquid'}]
2025-11-30 21:25:56,201 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Glass_Vial', 'existing': 'Vial', 'existing_id': '34_2'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Clear_Liquid', 'existing': 'Liquid', 'existing_id': '36_1'}, {'local': 'Electronic Balance', 'existing': 'Balance', 'existing_id': '15_1'}]
2025-11-30 21:25:56,201 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Holds', 'tail': 'Glass_Beaker'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Glass_Vial'}, {'head': 'Pipette', 'relation': 'ADDS', 'tail': 'Mass Of Liquid'}, {'head': 'Pipette', 'relation': 'DELIVERS', 'tail': 'Mass Of Liquid'}]
2025-11-30 21:25:56,201 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 13.04s, LLM: 13.04s)
2025-11-30 21:25:56,201 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 13.04s
2025-11-30 21:25:56,202 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:25:56,202 - src.pipeline.kg_builder - INFO - Pushing batch 45/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:25:56,202 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:25:56,389 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=425, relationships=374
2025-11-30 21:25:56,389 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:25:56,389 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass_Vial -> Vial
2025-11-30 21:25:56,394 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Glove
2025-11-30 21:25:56,398 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear_Liquid -> Liquid
2025-11-30 21:25:56,401 - src.components.neo4j_handler - DEBUG - APOC merge successful: Electronic Balance -> Balance
2025-11-30 21:25:56,401 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:25:56,407 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Glass_Beaker
2025-11-30 21:25:56,408 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Glass_Vial
2025-11-30 21:25:56,410 - src.components.neo4j_handler - DEBUG - Pruned relationship: Pipette -[ADDS]-> Mass Of Liquid
2025-11-30 21:25:56,434 - src.components.neo4j_handler - DEBUG - Pruned relationship: Pipette -[DELIVERS]-> Mass Of Liquid
2025-11-30 21:25:56,434 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:25:56,436 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Vial
2025-11-30 21:25:56,438 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Is On]-> Electronic Balance
2025-11-30 21:25:56,440 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Is On]-> Stirrer
2025-11-30 21:25:56,442 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Is On]-> Balance
2025-11-30 21:25:56,443 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Stirrer -[Is In]-> Beaker
2025-11-30 21:25:56,443 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:25:56,449 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=421, relationships=371
2025-11-30 21:25:56,451 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:25:56,451 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:25:56,451 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:25:56,451 - src.components.neo4j_handler - INFO - Batch injected in 0.25s (triplets: 0.25s, indexes: 0.00s)
2025-11-30 21:25:56,452 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 215, 'with_embedding': 215, 'linked_chunks': 169}
2025-11-30 21:25:56,452 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:25:56,509 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 421 nodes
2025-11-30 21:25:56,696 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 375 nodes
2025-11-30 21:25:56,907 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 421, 'relationship_count': 1256, 'density': 0.0071, 'avg_degree': 5.9667, 'avg_unique_neighbors': 5.905, 'global_efficiency': 0.3206, 'avg_path_length': 2.6756, 'avg_degree_centrality': 0.0142, 'max_degree_centrality': 0.5524, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0329, 'degree_assortativity': -0.209, 'graph_robustness': 0.7922, 'diameter_estimate': 6, 'clustering_coefficient': 0.2437, 'weakly_connected_components': 47, 'largest_wcc_size': 375, 'pagerank_top10_percent': 7.03, 'louvain_communities': 57, 'louvain_modularity': 0.4063, 'label_entropy': 1.4998, 'computational_time': 0.45524807495530695}
2025-11-30 21:25:56,908 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 44, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509156.90803, 'total_time': 19.721859527984634, 'aggregation': 2.663000486791134e-06, 'network_info': 0.011368901003152132, 'llm_extraction': 19.00431408197619, 'data_cleaning': 2.142100129276514e-05, 'neo4j_injection': 0.2494599890196696, 'embedding_time': 0, 'indexing_time': 0.0022165359696373343, 'graph_injection_time': 0.2469821359263733, 'acs_metrics': {'node_count': 421, 'relationship_count': 1256, 'density': 0.0071, 'avg_degree': 5.9667, 'avg_unique_neighbors': 5.905, 'global_efficiency': 0.3206, 'avg_path_length': 2.6756, 'avg_degree_centrality': 0.0142, 'max_degree_centrality': 0.5524, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0329, 'degree_assortativity': -0.209, 'graph_robustness': 0.7922, 'diameter_estimate': 6, 'clustering_coefficient': 0.2437, 'weakly_connected_components': 47, 'largest_wcc_size': 375, 'pagerank_top10_percent': 7.03, 'louvain_communities': 57, 'louvain_modularity': 0.4063, 'label_entropy': 1.4998, 'computational_time': 0.45524807495530695}, 'retrieval_queries': []}
2025-11-30 21:25:56,908 - src.pipeline.kg_builder - DEBUG - Batch 44 metrics: {
  "batch_idx": 44,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509156.90803,
  "total_time": 19.721859527984634,
  "aggregation": 2.663000486791134e-06,
  "network_info": 0.011368901003152132,
  "llm_extraction": 19.00431408197619,
  "data_cleaning": 2.142100129276514e-05,
  "neo4j_injection": 0.2494599890196696,
  "embedding_time": 0,
  "indexing_time": 0.0022165359696373343,
  "graph_injection_time": 0.2469821359263733,
  "acs_metrics": {
    "node_count": 421,
    "relationship_count": 1256,
    "density": 0.0071,
    "avg_degree": 5.9667,
    "avg_unique_neighbors": 5.905,
    "global_efficiency": 0.3206,
    "avg_path_length": 2.6756,
    "avg_degree_centrality": 0.0142,
    "max_degree_centrality": 0.5524,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0329,
    "degree_assortativity": -0.209,
    "graph_robustness": 0.7922,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2437,
    "weakly_connected_components": 47,
    "largest_wcc_size": 375,
    "pagerank_top10_percent": 7.03,
    "louvain_communities": 57,
    "louvain_modularity": 0.4063,
    "label_entropy": 1.4998,
    "computational_time": 0.45524807495530695
  },
  "retrieval_queries": []
}
2025-11-30 21:25:56,908 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:25:56,909 - src.pipeline.kg_builder - INFO - Batch 45 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.00s, Clean: 0.00s, Neo4j: 0.25s, ACS: 0.46s
2025-11-30 21:25:56,909 - src.pipeline.kg_builder - INFO - Batch 45 completed in 19.72s
Processing KG batches:  62%|██████▎   | 45/72 [18:59<12:35, 28.00s/it]2025-11-30 21:25:56,909 - src.pipeline.kg_builder - INFO - Processing batch 46/72 (3 items)
2025-11-30 21:25:56,909 - src.pipeline.kg_builder - DEBUG - Batch 46 current_video_time: 11:23-11:28
2025-11-30 21:25:56,915 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 421
- Total Relationships: 371
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:25:56,915 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:25:56,915 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_0 ~240 words, content: Time: 11:13-11:18 Content: The video captures a sequence of actions in a laboratory setting, focusing on a person conducting a chemical experiment. The scene is...
2025-11-30 21:25:56,915 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_1 ~231 words, content: and a beige sweater. This person appears to be assisting or observing the experiment, adding to the collaborative nature of the work. The laboratory environment...
2025-11-30 21:25:56,915 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_2 ~222 words, content: person is using a long, white, flexible tube, which is being inserted into the glassware. The right hand holds the tube in place while the...
2025-11-30 21:25:56,915 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_3 ~87 words, content: by the "D LAB" logo visible on the device. The person's left hand, which is adorned with a gold and black watch, is holding the...
2025-11-30 21:25:56,935 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:25:57,022 - src.components.pre_llm_injector - DEBUG - Found 215 existing chunk embeddings for similarity lookup
2025-11-30 21:25:57,069 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_1', '0.938'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_3', '0.920')]
2025-11-30 21:25:57,071 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_3
2025-11-30 21:25:57,071 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:25:57,071 - src.components.pre_llm_injector - DEBUG - Found 3 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_1
2025-11-30 21:25:57,071 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:25:57,097 - src.components.pre_llm_injector - DEBUG - Limited Person from 123 to 2 external connections
2025-11-30 21:25:57,097 - src.components.pre_llm_injector - DEBUG - Limited Lab Bench from 4 to 2 external connections
2025-11-30 21:25:57,097 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 129 total -> 6 (internal: 2, external: 4)
2025-11-30 21:25:57,097 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[FILLS_OUT]->(Chemistry Experiment Report / ID: 2_1), (Chemistry Experiment Report / ID: 2_1)-[IS_LAID_ON]->(Lab Bench / ID: 2_1), (Person / ID: 0_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[WEARS]->(Blue Glove / ID: 33_0), (Lab Bench / ID: 2_1)-[CONTAINS]->(Vial / ID: 34_2), (Lab Bench / ID: 2_1)-[CONTAINS]->(Beaker / ID: 33_1)
2025-11-30 21:25:57,100 - src.components.pre_llm_injector - DEBUG - Limited Person from 123 to 2 external connections
2025-11-30 21:25:57,100 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 124 total -> 3 (internal: 1, external: 2)
2025-11-30 21:25:57,100 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[INTERACTS_WITH]->(Balance / ID: 36_2)
2025-11-30 21:25:57,100 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_1', '0.938'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_3', '0.920')]
2025-11-30 21:25:57,100 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_4', '0.578'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_2', '0.561')]
2025-11-30 21:25:57,100 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_0', '0.703'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.699')]
2025-11-30 21:25:57,100 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_2', '0.850'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.848')]
2025-11-30 21:25:57,100 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:25:57,100 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_0) (~240 words) with timeout=5.0s retries=3
2025-11-30 21:26:02,106 - src.components.pre_llm_injector - WARNING - Chunk 0 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 21:26:07,612 - src.components.pre_llm_injector - WARNING - Chunk 0 timed out after 5.0s (attempt 2/4), retrying...
2025-11-30 21:26:09,758 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 3)
2025-11-30 21:26:09,758 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:26:09,758 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_1) (~231 words) with timeout=5.0s retries=3
2025-11-30 21:26:11,087 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:26:11,088 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:26:11,088 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_2) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:26:12,439 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:26:12,439 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:26:12,439 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_3) (~87 words) with timeout=5.0s retries=3
2025-11-30 21:26:13,592 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:26:13,592 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:26:13,592 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 4 chunks
2025-11-30 21:26:13,592 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 16.68s
2025-11-30 21:26:13,593 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 21:26:13,593 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[FILLS_OUT]->(Chemistry Experiment Report / ID: 2_1), (Chemistry Experiment Report / ID: 2_1)-[IS_LAID_ON]->(Lab Bench / ID: 2_1), (Person / ID: 0_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[WEARS]->(Blue Glove / ID: 33_0), (Lab Bench / ID: 2_1)-[CONTAINS]->(Vial / ID: 34_2), (Lab Bench / ID: 2_1)-[CONTAINS]->(Beaker / ID: 33_1)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[WEARS]->(Watch / ID: 7_2), (Person / ID: 0_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[INTERACTS_WITH]->(Balance / ID: 36_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["45_0", "45_1"]}, {"head": "Person", "relation": "Wears", "tail": "Gold_Watch", "source_chunks": ["45_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Vial", "source_chunks": ["45_0"]}, {"head": "Person", "relation": "Holds", "tail": "Aluminum_Foil", "source_chunks": ["45_0"]}, {"head": "Person", "relation": "Uses", "tail": "White_Tube", "source_chunks": ["45_0"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["45_0"]}, {"head": "Person", "relation": "Performs", "tail": "Task", "source_chunks": ["45_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Component", "source_chunks": ["45_1"]}, {"head": "Glass_Component", "relation": "Is Connected To", "tail": "Glass_Flask", "source_chunks": ["45_1"]}, {"head": "Glass_Flask", "relation": "Is On", "tail": "White_Tray", "source_chunks": ["45_1"]}, {"head": "Laboratory_Environment", "relation": "Contains", "tail": "Black_Countertop", "source_chunks": ["45_1"]}, {"head": "Person", "relation": "Wears", "tail": "Gold-Colored Watch", "source_chunks": ["45_2"]}, {"head": "Person", "relation": "Holds", "tail": "Long White Flexible Tube", "source_chunks": ["45_2"]}, {"head": "Person", "relation": "Uses", "tail": "White Cylindrical Device", "source_chunks": ["45_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["45_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:26:13,593 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~389 words, ~506 tokens)
2025-11-30 21:26:13,593 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:26:26,292 - src.components.global_refiner - DEBUG - LLM call completed in 12.70s
2025-11-30 21:26:26,292 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['45_0', '45_1', '45_2']], ['Person', 'Wears', 'Gold_Watch', ['45_0']], ['Person', 'Wears', 'Gold-Colored Watch', ['45_2']], ['Person', 'Holds', 'Glass_Vial', ['45_0']], ['Person', 'Holds', 'Aluminum_Foil', ['45_0']], ['Person', 'Uses', 'White_Tube', ['45_0']], ['Person', 'Transfers', 'Liquid', ['45_0']], ['Person', 'Performs', 'Task', ['45_1']], ['Person', 'Holds', 'Glass_Component', ['45_1']], ['Glass_Component', 'Is Connected To', 'Glass_Flask', ['45_1']], ['Glass_Flask', 'Is On', 'White_Tray', ['45_1']], ['Laboratory_Environment', 'Contains', 'Black_Countertop', ['45_1']], ['Person', 'Holds', 'Long White Flexible Tube', ['45_2']], ['Person', 'Uses', 'White Cylindrical Device', ['45_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue Glove', ['45_0', '45_1', '45_2']], ['Person', 'Wears', 'Watch', ['45_0', '45_2']], ['Person', 'Transfers', 'Mass Of Liquid', ['45_0']], ['Person', 'Interacts With', 'Balance', ['45_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '33_0'}, {'local': 'Gold_Watch', 'existing': 'Watch', 'existing_id': '7_2'}, {'local': 'Gold-Colored Watch', 'existing': 'Watch', 'existing_id': '7_2'}, {'local': 'White_Tube', 'existing': 'White Cylindrical Device', 'existing_id': '36_2'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Watch'}, {'head': 'Person', 'relation': 'Transfers', 'tail': 'Mass Of Liquid'}, {'head': 'Person', 'relation': 'Interacts With', 'tail': 'Balance'}]
2025-11-30 21:26:26,292 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=14, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['45_0', '45_1', '45_2']], ['Person', 'Wears', 'Gold_Watch', ['45_0']], ['Person', 'Wears', 'Gold-Colored Watch', ['45_2']]]
2025-11-30 21:26:26,292 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=4, sample=[['Person', 'Wears', 'Blue Glove', ['45_0', '45_1', '45_2']], ['Person', 'Wears', 'Watch', ['45_0', '45_2']], ['Person', 'Transfers', 'Mass Of Liquid', ['45_0']]]
2025-11-30 21:26:26,292 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '33_0'}, {'local': 'Gold_Watch', 'existing': 'Watch', 'existing_id': '7_2'}, {'local': 'Gold-Colored Watch', 'existing': 'Watch', 'existing_id': '7_2'}]
2025-11-30 21:26:26,292 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Watch'}, {'head': 'Person', 'relation': 'Transfers', 'tail': 'Mass Of Liquid'}]
2025-11-30 21:26:26,292 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '33_0'}, {'local': 'Gold_Watch', 'existing': 'Watch', 'existing_id': '7_2'}, {'local': 'Gold-Colored Watch', 'existing': 'Watch', 'existing_id': '7_2'}, {'local': 'White_Tube', 'existing': 'White Cylindrical Device', 'existing_id': '36_2'}]
2025-11-30 21:26:26,292 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Watch'}, {'head': 'Person', 'relation': 'Transfers', 'tail': 'Mass Of Liquid'}, {'head': 'Person', 'relation': 'Interacts With', 'tail': 'Balance'}]
2025-11-30 21:26:26,292 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 18 triplets (total: 12.70s, LLM: 12.70s)
2025-11-30 21:26:26,293 - src.pipeline.kg_builder - INFO - Global refinement: 18 triplets in 12.70s
2025-11-30 21:26:26,293 - src.pipeline.kg_builder - INFO - Using 18 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:26:26,293 - src.pipeline.kg_builder - INFO - Pushing batch 46/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:26:26,293 - src.components.neo4j_handler - INFO - Adding 18 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:26:26,473 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=437, relationships=384
2025-11-30 21:26:26,474 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:26:26,474 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Glove
2025-11-30 21:26:26,477 - src.components.neo4j_handler - DEBUG - APOC merge successful: Gold_Watch -> Watch
2025-11-30 21:26:26,480 - src.components.neo4j_handler - DEBUG - APOC merge successful: Gold-Colored Watch -> Watch
2025-11-30 21:26:26,483 - src.components.neo4j_handler - DEBUG - APOC merge successful: White_Tube -> White Cylindrical Device
2025-11-30 21:26:26,483 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:26:26,486 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Glove
2025-11-30 21:26:26,488 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Watch
2025-11-30 21:26:26,489 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Transfers]-> Mass Of Liquid
2025-11-30 21:26:26,490 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Interacts With]-> Balance
2025-11-30 21:26:26,490 - src.components.neo4j_handler - INFO - Applying 4 inter-chunk relations
2025-11-30 21:26:26,494 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue Glove
2025-11-30 21:26:26,495 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Watch
2025-11-30 21:26:26,496 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Transfers]-> Mass Of Liquid
2025-11-30 21:26:26,498 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Interacts With]-> Balance
2025-11-30 21:26:26,498 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:26:26,503 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=433, relationships=376
2025-11-30 21:26:26,504 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:26:26,504 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:26:26,504 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:26:26,504 - src.components.neo4j_handler - INFO - Batch injected in 0.21s (triplets: 0.21s, indexes: 0.00s)
2025-11-30 21:26:26,506 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 219, 'with_embedding': 219, 'linked_chunks': 172}
2025-11-30 21:26:26,506 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:26:26,584 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 433 nodes
2025-11-30 21:26:26,778 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 386 nodes
2025-11-30 21:26:26,994 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 433, 'relationship_count': 1287, 'density': 0.0069, 'avg_degree': 5.9446, 'avg_unique_neighbors': 5.8845, 'global_efficiency': 0.3215, 'avg_path_length': 2.6706, 'avg_degree_centrality': 0.0138, 'max_degree_centrality': 0.5579, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.033, 'degree_assortativity': -0.2149, 'graph_robustness': 0.8493, 'diameter_estimate': 6, 'clustering_coefficient': 0.2476, 'weakly_connected_components': 48, 'largest_wcc_size': 386, 'pagerank_top10_percent': 7.03, 'louvain_communities': 57, 'louvain_modularity': 0.4195, 'label_entropy': 1.5, 'computational_time': 0.48860724293626845}
2025-11-30 21:26:26,995 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 45, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509186.9949934, 'total_time': 30.08584603993222, 'aggregation': 2.334010787308216e-06, 'network_info': 0.005865155020728707, 'llm_extraction': 29.377923181047663, 'data_cleaning': 3.7482939660549164e-05, 'neo4j_injection': 0.21171106596011668, 'embedding_time': 0, 'indexing_time': 0.0011397900525480509, 'graph_injection_time': 0.21021635201759636, 'acs_metrics': {'node_count': 433, 'relationship_count': 1287, 'density': 0.0069, 'avg_degree': 5.9446, 'avg_unique_neighbors': 5.8845, 'global_efficiency': 0.3215, 'avg_path_length': 2.6706, 'avg_degree_centrality': 0.0138, 'max_degree_centrality': 0.5579, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.033, 'degree_assortativity': -0.2149, 'graph_robustness': 0.8493, 'diameter_estimate': 6, 'clustering_coefficient': 0.2476, 'weakly_connected_components': 48, 'largest_wcc_size': 386, 'pagerank_top10_percent': 7.03, 'louvain_communities': 57, 'louvain_modularity': 0.4195, 'label_entropy': 1.5, 'computational_time': 0.48860724293626845}, 'retrieval_queries': []}
2025-11-30 21:26:26,995 - src.pipeline.kg_builder - DEBUG - Batch 45 metrics: {
  "batch_idx": 45,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509186.9949934,
  "total_time": 30.08584603993222,
  "aggregation": 2.334010787308216e-06,
  "network_info": 0.005865155020728707,
  "llm_extraction": 29.377923181047663,
  "data_cleaning": 3.7482939660549164e-05,
  "neo4j_injection": 0.21171106596011668,
  "embedding_time": 0,
  "indexing_time": 0.0011397900525480509,
  "graph_injection_time": 0.21021635201759636,
  "acs_metrics": {
    "node_count": 433,
    "relationship_count": 1287,
    "density": 0.0069,
    "avg_degree": 5.9446,
    "avg_unique_neighbors": 5.8845,
    "global_efficiency": 0.3215,
    "avg_path_length": 2.6706,
    "avg_degree_centrality": 0.0138,
    "max_degree_centrality": 0.5579,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.033,
    "degree_assortativity": -0.2149,
    "graph_robustness": 0.8493,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2476,
    "weakly_connected_components": 48,
    "largest_wcc_size": 386,
    "pagerank_top10_percent": 7.03,
    "louvain_communities": 57,
    "louvain_modularity": 0.4195,
    "label_entropy": 1.5,
    "computational_time": 0.48860724293626845
  },
  "retrieval_queries": []
}
2025-11-30 21:26:26,996 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:26:26,996 - src.pipeline.kg_builder - INFO - Batch 46 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 29.38s, Clean: 0.00s, Neo4j: 0.21s, ACS: 0.49s
2025-11-30 21:26:26,996 - src.pipeline.kg_builder - INFO - Batch 46 completed in 30.09s
Processing KG batches:  64%|██████▍   | 46/72 [19:29<12:24, 28.62s/it]2025-11-30 21:26:26,996 - src.pipeline.kg_builder - INFO - Processing batch 47/72 (3 items)
2025-11-30 21:26:26,996 - src.pipeline.kg_builder - DEBUG - Batch 47 current_video_time: 11:38-11:43
2025-11-30 21:26:27,002 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 433
- Total Relationships: 376
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:26:27,002 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:26:27,002 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_0 ~226 words, content: Time: 11:28-11:33 Content: The video captures a scientific procedure being performed in a laboratory setting. The sequence of events unfolds as follows: - **Initial Setup:**...
2025-11-30 21:26:27,002 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_1 ~233 words, content: - **Broader Context:** The camera pulls back further, revealing more of the laboratory. The entire apparatus, including the balance, the flask, and the tubing, is...
2025-11-30 21:26:27,002 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_2 ~233 words, content: of laboratory equipment. This equipment includes a glass flask, which is being held in place by a clamp attached to a metal stand. The flask...
2025-11-30 21:26:27,002 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_3 ~238 words, content: stirring process is ongoing. In summary, the video shows a controlled laboratory experiment where a liquid is being transferred from a flask, which is being...
2025-11-30 21:26:27,002 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_4 ~88 words, content: with a clear liquid. The final frames show the tube submerged in the liquid within the measuring cup, indicating that the liquid is being pumped...
2025-11-30 21:26:27,022 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:26:27,112 - src.components.pre_llm_injector - DEBUG - Found 219 existing chunk embeddings for similarity lookup
2025-11-30 21:26:27,172 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_4', '0.823'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_1', '0.811')]
2025-11-30 21:26:27,174 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_1
2025-11-30 21:26:27,174 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:26:27,174 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_4 via source_chunk_ids
2025-11-30 21:26:27,189 - src.components.pre_llm_injector - DEBUG - Limited Person from 126 to 2 external connections
2025-11-30 21:26:27,189 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 126 total -> 2 (internal: 0, external: 2)
2025-11-30 21:26:27,189 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HANDLES]->(Glass_Volumetric_Flask / ID: 29_2), (Person / ID: 0_0)-[OBSERVES]->(Experiment / ID: 35_2)
2025-11-30 21:26:27,189 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_3', '0.637'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_1', '0.626')]
2025-11-30 21:26:27,189 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_1', '0.811'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_14_4', '0.793')]
2025-11-30 21:26:27,189 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_1', '0.803'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.676')]
2025-11-30 21:26:27,189 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.788'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_43_1', '0.786')]
2025-11-30 21:26:27,189 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_4', '0.823'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3', '0.806')]
2025-11-30 21:26:27,189 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:26:27,189 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_0) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:26:28,873 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:26:28,873 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:26:28,873 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_1) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:26:30,031 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:26:30,031 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:26:30,032 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_2) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:26:31,439 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:26:31,439 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:26:31,440 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_3) (~238 words) with timeout=5.0s retries=3
2025-11-30 21:26:33,070 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:26:33,070 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:26:33,070 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_4) (~88 words) with timeout=5.0s retries=3
2025-11-30 21:26:34,188 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:26:34,189 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:26:34,189 - src.components.pre_llm_injector - INFO - Extracted 30 local triplets from 5 chunks
2025-11-30 21:26:34,189 - src.pipeline.kg_builder - INFO - Pre-extraction: 30 triplets in 7.19s
2025-11-30 21:26:34,189 - src.components.global_refiner - INFO - Capping refinement input: 30 → 15 triplets
2025-11-30 21:26:34,190 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[HANDLES]->(Glass_Volumetric_Flask / ID: 29_2), (Person / ID: 0_0)-[OBSERVES]->(Experiment / ID: 35_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["46_0"]}, {"head": "Person", "relation": "Wears", "tail": "Gold_Watch", "source_chunks": ["46_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Erlenmeyer_Flask", "source_chunks": ["46_0"]}, {"head": "Glass_Erlenmeyer_Flask", "relation": "Is On", "tail": "Digital_Balance", "source_chunks": ["46_0"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "Liquid_Mass", "source_chunks": ["46_0"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Glass_Erlenmeyer_Flask", "source_chunks": ["46_0"]}, {"head": "Camera", "relation": "Pulls Back", "tail": "Laboratory", "source_chunks": ["46_1"]}, {"head": "Apparatus", "relation": "Contains", "tail": "Balance", "source_chunks": ["46_1"]}, {"head": "Apparatus", "relation": "Contains", "tail": "Flask", "source_chunks": ["46_1"]}, {"head": "Apparatus", "relation": "Contains", "tail": "Tubing", "source_chunks": ["46_1"]}, {"head": "Tubing", "relation": "Connected To", "tail": "Metal_Stand", "source_chunks": ["46_1"]}, {"head": "Person", "relation": "Adjusts", "tail": "Apparatus", "source_chunks": ["46_1"]}, {"head": "Glass Flask", "relation": "Is Held By", "tail": "Clamp", "source_chunks": ["46_2"]}, {"head": "Clamp", "relation": "Is Attached To", "tail": "Metal Stand", "source_chunks": ["46_2"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["46_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:26:34,190 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~328 words, ~426 tokens)
2025-11-30 21:26:34,190 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:26:51,457 - src.components.global_refiner - DEBUG - LLM call completed in 17.27s
2025-11-30 21:26:51,457 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['46_0']], ['Person', 'Wears', 'Gold_Watch', ['46_0']], ['Person', 'Holds', 'Glass_Erlenmeyer_Flask', ['46_0']], ['Glass_Erlenmeyer_Flask', 'Is On', 'Digital_Balance', ['46_0']], ['Digital_Balance', 'Displays', 'Liquid_Mass', ['46_0']], ['Liquid', 'Is Transferred To', 'Glass_Erlenmeyer_Flask', ['46_0']], ['Camera', 'Pulls Back', 'Laboratory', ['46_1']], ['Apparatus', 'Contains', 'Balance', ['46_1']], ['Apparatus', 'Contains', 'Flask', ['46_1']], ['Apparatus', 'Contains', 'Tubing', ['46_1']], ['Tubing', 'Connected To', 'Metal_Stand', ['46_1']], ['Person', 'Adjusts', 'Apparatus', ['46_1']], ['Glass Flask', 'Is Held By', 'Clamp', ['46_2']], ['Clamp', 'Is Attached To', 'Metal Stand', ['46_2']], ['Glass Flask', 'Is On', 'Magnetic Stirrer', ['46_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['46_0']], ['Person', 'Wears', 'Gold_Watch', ['46_0']], ['Person', 'Holds', 'Glass_Erlenmeyer_Flask', ['46_0']], ['Glass_Erlenmeyer_Flask', 'Is On', 'Digital_Balance', ['46_0']], ['Digital_Balance', 'Displays', 'Liquid_Mass', ['46_0']], ['Liquid', 'Is Transferred To', 'Glass_Erlenmeyer_Flask', ['46_0']], ['Camera', 'Pulls Back', 'Laboratory', ['46_1']], ['Apparatus', 'Contains', 'Balance', ['46_1']], ['Apparatus', 'Contains', 'Flask', ['46_1']], ['Apparatus', 'Contains', 'Tubing', ['46_1']], ['Tubing', 'Connected To', 'Metal_Stand', ['46_1']], ['Person', 'Adjusts', 'Apparatus', ['46_1']], ['Glass Flask', 'Is Held By', 'Clamp', ['46_2']], ['Clamp', 'Is Attached To', 'Metal Stand', ['46_2']], ['Glass Flask', 'Is On', 'Magnetic Stirrer', ['46_2']]] merge_instructions=[{'local': 'Glass Flask', 'existing': 'Glass_Volumetric_Flask', 'existing_id': '29_2'}, {'local': 'Glass_Erlenmeyer_Flask', 'existing': 'Glass_Volumetric_Flask', 'existing_id': '29_2'}, {'local': 'Digital_Balance', 'existing': 'Balance', 'existing_id': '35_2'}, {'local': 'Liquid_Mass', 'existing': 'Liquid', 'existing_id': '35_2'}] prune_instructions=[{'head': 'Person', 'relation': 'HANDLES', 'tail': 'Glass_Volumetric_Flask'}, {'head': 'Person', 'relation': 'OBSERVES', 'tail': 'Experiment'}]
2025-11-30 21:26:51,457 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['46_0']], ['Person', 'Wears', 'Gold_Watch', ['46_0']], ['Person', 'Holds', 'Glass_Erlenmeyer_Flask', ['46_0']]]
2025-11-30 21:26:51,457 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['46_0']], ['Person', 'Wears', 'Gold_Watch', ['46_0']], ['Person', 'Holds', 'Glass_Erlenmeyer_Flask', ['46_0']]]
2025-11-30 21:26:51,458 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Glass Flask', 'existing': 'Glass_Volumetric_Flask', 'existing_id': '29_2'}, {'local': 'Glass_Erlenmeyer_Flask', 'existing': 'Glass_Volumetric_Flask', 'existing_id': '29_2'}, {'local': 'Digital_Balance', 'existing': 'Balance', 'existing_id': '35_2'}]
2025-11-30 21:26:51,458 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=2, sample=[{'head': 'Person', 'relation': 'HANDLES', 'tail': 'Glass_Volumetric_Flask'}, {'head': 'Person', 'relation': 'OBSERVES', 'tail': 'Experiment'}]
2025-11-30 21:26:51,458 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Glass Flask', 'existing': 'Glass_Volumetric_Flask', 'existing_id': '29_2'}, {'local': 'Glass_Erlenmeyer_Flask', 'existing': 'Glass_Volumetric_Flask', 'existing_id': '29_2'}, {'local': 'Digital_Balance', 'existing': 'Balance', 'existing_id': '35_2'}, {'local': 'Liquid_Mass', 'existing': 'Liquid', 'existing_id': '35_2'}]
2025-11-30 21:26:51,458 - src.components.global_refiner - INFO - LLM suggested 2 triplets to prune: [{'head': 'Person', 'relation': 'HANDLES', 'tail': 'Glass_Volumetric_Flask'}, {'head': 'Person', 'relation': 'OBSERVES', 'tail': 'Experiment'}]
2025-11-30 21:26:51,458 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 30 triplets (total: 17.27s, LLM: 17.27s)
2025-11-30 21:26:51,458 - src.pipeline.kg_builder - INFO - Global refinement: 30 triplets in 17.27s
2025-11-30 21:26:51,458 - src.pipeline.kg_builder - INFO - Using 30 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:26:51,458 - src.pipeline.kg_builder - INFO - Pushing batch 47/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:26:51,458 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:26:51,663 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=447, relationships=391
2025-11-30 21:26:51,663 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:26:51,664 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass Flask -> Glass_Volumetric_Flask
2025-11-30 21:26:51,668 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass_Erlenmeyer_Flask -> Glass_Volumetric_Flask
2025-11-30 21:26:51,671 - src.components.neo4j_handler - DEBUG - APOC merge successful: Digital_Balance -> Balance
2025-11-30 21:26:51,675 - src.components.neo4j_handler - DEBUG - APOC merge successful: Liquid_Mass -> Liquid
2025-11-30 21:26:51,675 - src.components.neo4j_handler - INFO - Applying 2 prune instructions
2025-11-30 21:26:51,680 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[HANDLES]-> Glass_Volumetric_Flask
2025-11-30 21:26:51,682 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[OBSERVES]-> Experiment
2025-11-30 21:26:51,682 - src.components.neo4j_handler - INFO - Applying 15 inter-chunk relations
2025-11-30 21:26:51,684 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:26:51,686 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Gold_Watch
2025-11-30 21:26:51,688 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Glass_Erlenmeyer_Flask
2025-11-30 21:26:51,689 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Glass_Erlenmeyer_Flask -[Is On]-> Digital_Balance
2025-11-30 21:26:51,690 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Digital_Balance -[Displays]-> Liquid_Mass
2025-11-30 21:26:51,691 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Liquid -[Is Transferred To]-> Glass_Erlenmeyer_Flask
2025-11-30 21:26:51,719 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Camera -[Pulls Back]-> Laboratory
2025-11-30 21:26:51,722 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Apparatus -[Contains]-> Balance
2025-11-30 21:26:51,723 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Apparatus -[Contains]-> Flask
2025-11-30 21:26:51,724 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Apparatus -[Contains]-> Tubing
2025-11-30 21:26:51,745 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Tubing -[Connected To]-> Metal_Stand
2025-11-30 21:26:51,747 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Adjusts]-> Apparatus
2025-11-30 21:26:51,773 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Glass Flask -[Is Held By]-> Clamp
2025-11-30 21:26:51,799 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Clamp -[Is Attached To]-> Metal Stand
2025-11-30 21:26:51,800 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Glass Flask -[Is On]-> Magnetic Stirrer
2025-11-30 21:26:51,801 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:26:51,807 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=443, relationships=389
2025-11-30 21:26:51,810 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:26:51,810 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:26:51,811 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:26:51,811 - src.components.neo4j_handler - INFO - Batch injected in 0.35s (triplets: 0.35s, indexes: 0.00s)
2025-11-30 21:26:51,813 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 224, 'with_embedding': 224, 'linked_chunks': 175}
2025-11-30 21:26:51,813 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:26:51,942 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 443 nodes
2025-11-30 21:26:52,145 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 394 nodes
2025-11-30 21:26:52,372 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 443, 'relationship_count': 1318, 'density': 0.0067, 'avg_degree': 5.9503, 'avg_unique_neighbors': 5.8871, 'global_efficiency': 0.3192, 'avg_path_length': 2.6796, 'avg_degree_centrality': 0.0135, 'max_degree_centrality': 0.5543, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0259, 'degree_assortativity': -0.2107, 'graph_robustness': 0.849, 'diameter_estimate': 6, 'clustering_coefficient': 0.2482, 'weakly_connected_components': 50, 'largest_wcc_size': 394, 'pagerank_top10_percent': 6.72, 'louvain_communities': 60, 'louvain_modularity': 0.4125, 'label_entropy': 1.5, 'computational_time': 0.5582617049803957}
2025-11-30 21:26:52,372 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 46, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509212.3723257, 'total_time': 25.37615273508709, 'aggregation': 2.9120128601789474e-06, 'network_info': 0.00604594498872757, 'llm_extraction': 24.455971454037353, 'data_cleaning': 5.96360769122839e-05, 'neo4j_injection': 0.35287938197143376, 'embedding_time': 0, 'indexing_time': 0.003816418000496924, 'graph_injection_time': 0.348728853976354, 'acs_metrics': {'node_count': 443, 'relationship_count': 1318, 'density': 0.0067, 'avg_degree': 5.9503, 'avg_unique_neighbors': 5.8871, 'global_efficiency': 0.3192, 'avg_path_length': 2.6796, 'avg_degree_centrality': 0.0135, 'max_degree_centrality': 0.5543, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0259, 'degree_assortativity': -0.2107, 'graph_robustness': 0.849, 'diameter_estimate': 6, 'clustering_coefficient': 0.2482, 'weakly_connected_components': 50, 'largest_wcc_size': 394, 'pagerank_top10_percent': 6.72, 'louvain_communities': 60, 'louvain_modularity': 0.4125, 'label_entropy': 1.5, 'computational_time': 0.5582617049803957}, 'retrieval_queries': []}
2025-11-30 21:26:52,372 - src.pipeline.kg_builder - DEBUG - Batch 46 metrics: {
  "batch_idx": 46,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509212.3723257,
  "total_time": 25.37615273508709,
  "aggregation": 2.9120128601789474e-06,
  "network_info": 0.00604594498872757,
  "llm_extraction": 24.455971454037353,
  "data_cleaning": 5.96360769122839e-05,
  "neo4j_injection": 0.35287938197143376,
  "embedding_time": 0,
  "indexing_time": 0.003816418000496924,
  "graph_injection_time": 0.348728853976354,
  "acs_metrics": {
    "node_count": 443,
    "relationship_count": 1318,
    "density": 0.0067,
    "avg_degree": 5.9503,
    "avg_unique_neighbors": 5.8871,
    "global_efficiency": 0.3192,
    "avg_path_length": 2.6796,
    "avg_degree_centrality": 0.0135,
    "max_degree_centrality": 0.5543,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0259,
    "degree_assortativity": -0.2107,
    "graph_robustness": 0.849,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2482,
    "weakly_connected_components": 50,
    "largest_wcc_size": 394,
    "pagerank_top10_percent": 6.72,
    "louvain_communities": 60,
    "louvain_modularity": 0.4125,
    "label_entropy": 1.5,
    "computational_time": 0.5582617049803957
  },
  "retrieval_queries": []
}
2025-11-30 21:26:52,373 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:26:52,373 - src.pipeline.kg_builder - INFO - Batch 47 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 24.46s, Clean: 0.00s, Neo4j: 0.35s, ACS: 0.56s
2025-11-30 21:26:52,373 - src.pipeline.kg_builder - INFO - Batch 47 completed in 25.38s
Processing KG batches:  65%|██████▌   | 47/72 [19:55<11:31, 27.65s/it]2025-11-30 21:26:52,373 - src.pipeline.kg_builder - INFO - Processing batch 48/72 (3 items)
2025-11-30 21:26:52,373 - src.pipeline.kg_builder - DEBUG - Batch 48 current_video_time: 11:53-11:58
2025-11-30 21:26:52,380 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 443
- Total Relationships: 389
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:26:52,381 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:26:52,381 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_0 ~241 words, content: Time: 11:43-11:48 Content: The video captures a scene in a laboratory or workshop setting, focusing on a scientific experiment involving fluid transfer. The camera is...
2025-11-30 21:26:52,381 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_1 ~226 words, content: plastic bag containing small components, and a glass rod. The overall impression is that of an active workspace where an experiment is in progress. Time:...
2025-11-30 21:26:52,381 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_2 ~233 words, content: **Final Scene (Frames 4-5):** The camera settles on a clear view of the experiment. A glass beaker is positioned on a white, electronic device, which...
2025-11-30 21:26:52,381 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_3 ~168 words, content: , which is part of a setup that appears to be a gas delivery system. The camera angle shifts slightly, providing a broader view of...
2025-11-30 21:26:52,401 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:26:52,489 - src.components.pre_llm_injector - DEBUG - Found 224 existing chunk embeddings for similarity lookup
2025-11-30 21:26:52,537 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3', '0.841'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_4', '0.814')]
2025-11-30 21:26:52,539 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_4 via source_chunk_ids
2025-11-30 21:26:52,539 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3
2025-11-30 21:26:52,539 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:26:52,555 - src.components.pre_llm_injector - DEBUG - Limited Person from 127 to 2 external connections
2025-11-30 21:26:52,555 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 130 total -> 5 (internal: 1, external: 4)
2025-11-30 21:26:52,555 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[USES]->(Pipette / ID: 40_2), (Person / ID: 0_0)-[WORKS_AT]->(Countertop / ID: 1_0), (Person / ID: 0_0)-[WEARS]->(Nitrile_Gloves / ID: 13_0), (Pipette / ID: 40_2)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Pipette / ID: 40_2)-[DISPENSES]->(Mass Of Liquid / ID: 15_1)
2025-11-30 21:26:52,555 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_1', '0.748'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_0', '0.747')]
2025-11-30 21:26:52,555 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_3', '0.668'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_39_1', '0.658')]
2025-11-30 21:26:52,555 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3', '0.841'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4', '0.799')]
2025-11-30 21:26:52,555 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_4', '0.814'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3', '0.791')]
2025-11-30 21:26:52,555 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:26:52,556 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_0) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:26:53,510 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:26:53,510 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:26:53,511 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_1) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:26:54,890 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:26:54,890 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:26:54,891 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_2) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:26:56,332 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:26:56,332 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:26:56,333 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_3) (~168 words) with timeout=5.0s retries=3
2025-11-30 21:26:57,414 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:26:57,415 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:26:57,415 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-30 21:26:57,415 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 5.03s
2025-11-30 21:26:57,415 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 21:26:57,415 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[USES]->(Pipette / ID: 40_2), (Person / ID: 0_0)-[WORKS_AT]->(Countertop / ID: 1_0), (Person / ID: 0_0)-[WEARS]->(Nitrile_Gloves / ID: 13_0), (Pipette / ID: 40_2)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Pipette / ID: 40_2)-[DISPENSES]->(Mass Of Liquid / ID: 15_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["47_0"]}, {"head": "Pump", "relation": "Connected To", "tail": "Tube", "source_chunks": ["47_0"]}, {"head": "Tube", "relation": "Inserted Into", "tail": "Container", "source_chunks": ["47_0"]}, {"head": "Container", "relation": "Contains", "tail": "Water", "source_chunks": ["47_0"]}, {"head": "Workbench", "relation": "Holds", "tail": "Pump", "source_chunks": ["47_0"]}, {"head": "Workbench", "relation": "Holds", "tail": "Beaker", "source_chunks": ["47_0"]}, {"head": "Plastic Bag", "relation": "Contains", "tail": "Small Components", "source_chunks": ["47_1"]}, {"head": "Glass Rod", "relation": "Is Located In", "tail": "Plastic Bag", "source_chunks": ["47_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Clear Plastic Container", "source_chunks": ["47_1"]}, {"head": "Clear Plastic Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["47_1"]}, {"head": "Blue Apparatus", "relation": "Is Connected To", "tail": "Long Translucent Tube", "source_chunks": ["47_1"]}, {"head": "Long Translucent Tube", "relation": "Is Submerged In", "tail": "Liquid", "source_chunks": ["47_1"]}, {"head": "Beaker", "relation": "Is On", "tail": "Magnetic_Stirrer", "source_chunks": ["47_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Foamy_Substance", "source_chunks": ["47_2"]}, {"head": "Tube", "relation": "Is Inserted Into", "tail": "Beaker", "source_chunks": ["47_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:26:57,416 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~364 words, ~473 tokens)
2025-11-30 21:26:57,416 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:27:09,866 - src.components.global_refiner - DEBUG - LLM call completed in 12.45s
2025-11-30 21:27:09,866 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Tube', 'Transfers', 'Liquid', ['47_0']], ['Pump', 'Connected To', 'Tube', ['47_0']], ['Tube', 'Inserted Into', 'Container', ['47_0']], ['Container', 'Contains', 'Water', ['47_0']], ['Workbench', 'Holds', 'Pump', ['47_0']], ['Workbench', 'Holds', 'Beaker', ['47_0']], ['Plastic Bag', 'Contains', 'Small Components', ['47_1']], ['Glass Rod', 'Is Located In', 'Plastic Bag', ['47_1']], ['Lab Bench', 'Contains', 'Clear Plastic Container', ['47_1']], ['Clear Plastic Container', 'Contains', 'Liquid', ['47_1']], ['Blue Apparatus', 'Is Connected To', 'Long Translucent Tube', ['47_1']], ['Long Translucent Tube', 'Is Submerged In', 'Liquid', ['47_1']], ['Beaker', 'Is On', 'Magnetic_Stirrer', ['47_2']], ['Beaker', 'Contains', 'Foamy_Substance', ['47_2']], ['Tube', 'Is Inserted Into', 'Beaker', ['47_2']]] inter_chunk_relations=[['Workbench', 'Holds', 'Countertop', ['47_0']], ['Beaker', 'Is On', 'Countertop', ['47_2']], ['Tube', 'Transfers', 'Mass Of Liquid', ['47_0']], ['Pump', 'Connected To', 'Pipette', ['47_0']], ['Container', 'Contains', 'Mass Of Liquid', ['47_0']]] merge_instructions=[{'local': 'Nitrile_Gloves', 'existing': 'Nitrile Gloves', 'existing_id': '13_0'}, {'local': 'Pipette', 'existing': 'Pipette', 'existing_id': '40_2'}, {'local': 'Person', 'existing': 'Person', 'existing_id': '0_0'}, {'local': 'Countertop', 'existing': 'Countertop', 'existing_id': '1_0'}] prune_instructions=[{'entity': 'Tube'}, {'head': 'Pump', 'relation': 'Connected To', 'tail': 'Tube'}, {'head': 'Tube', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Container', 'relation': 'Contains', 'tail': 'Water'}]
2025-11-30 21:27:09,867 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Tube', 'Transfers', 'Liquid', ['47_0']], ['Pump', 'Connected To', 'Tube', ['47_0']], ['Tube', 'Inserted Into', 'Container', ['47_0']]]
2025-11-30 21:27:09,867 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Workbench', 'Holds', 'Countertop', ['47_0']], ['Beaker', 'Is On', 'Countertop', ['47_2']], ['Tube', 'Transfers', 'Mass Of Liquid', ['47_0']]]
2025-11-30 21:27:09,867 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Nitrile_Gloves', 'existing': 'Nitrile Gloves', 'existing_id': '13_0'}, {'local': 'Pipette', 'existing': 'Pipette', 'existing_id': '40_2'}, {'local': 'Person', 'existing': 'Person', 'existing_id': '0_0'}]
2025-11-30 21:27:09,867 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'entity': 'Tube'}, {'head': 'Pump', 'relation': 'Connected To', 'tail': 'Tube'}, {'head': 'Tube', 'relation': 'Transfers', 'tail': 'Liquid'}]
2025-11-30 21:27:09,867 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Nitrile_Gloves', 'existing': 'Nitrile Gloves', 'existing_id': '13_0'}, {'local': 'Pipette', 'existing': 'Pipette', 'existing_id': '40_2'}, {'local': 'Person', 'existing': 'Person', 'existing_id': '0_0'}, {'local': 'Countertop', 'existing': 'Countertop', 'existing_id': '1_0'}]
2025-11-30 21:27:09,867 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'entity': 'Tube'}, {'head': 'Pump', 'relation': 'Connected To', 'tail': 'Tube'}, {'head': 'Tube', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Container', 'relation': 'Contains', 'tail': 'Water'}]
2025-11-30 21:27:09,867 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 12.45s, LLM: 12.45s)
2025-11-30 21:27:09,867 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 12.45s
2025-11-30 21:27:09,867 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:27:09,867 - src.pipeline.kg_builder - INFO - Pushing batch 48/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:27:09,868 - src.components.neo4j_handler - INFO - Adding 20 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:27:10,021 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=456, relationships=409
2025-11-30 21:27:10,021 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:27:10,021 - src.components.neo4j_handler - DEBUG - APOC merge successful: Nitrile_Gloves -> Nitrile Gloves
2025-11-30 21:27:10,021 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Pipette -> Pipette
2025-11-30 21:27:10,021 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Person -> Person
2025-11-30 21:27:10,021 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Countertop -> Countertop
2025-11-30 21:27:10,021 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:27:10,023 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Tube
2025-11-30 21:27:10,024 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Pump -[Connected To]-> Tube
2025-11-30 21:27:10,024 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Tube -[Transfers]-> Liquid
2025-11-30 21:27:10,025 - src.components.neo4j_handler - DEBUG - Pruned relationship: Container -[Contains]-> Water
2025-11-30 21:27:10,025 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:27:10,026 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Workbench -[Holds]-> Countertop
2025-11-30 21:27:10,027 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Is On]-> Countertop
2025-11-30 21:27:10,028 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Tube -[Transfers]-> Mass Of Liquid
2025-11-30 21:27:10,029 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Pump -[Connected To]-> Pipette
2025-11-30 21:27:10,030 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Container -[Contains]-> Mass Of Liquid
2025-11-30 21:27:10,030 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:27:10,035 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=455, relationships=403
2025-11-30 21:27:10,036 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:27:10,036 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:27:10,036 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:27:10,036 - src.components.neo4j_handler - INFO - Batch injected in 0.17s (triplets: 0.17s, indexes: 0.00s)
2025-11-30 21:27:10,037 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 228, 'with_embedding': 228, 'linked_chunks': 178}
2025-11-30 21:27:10,037 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:27:10,121 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 455 nodes
2025-11-30 21:27:10,336 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 405 nodes
2025-11-30 21:27:10,577 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 455, 'relationship_count': 1352, 'density': 0.0065, 'avg_degree': 5.9429, 'avg_unique_neighbors': 5.8769, 'global_efficiency': 0.3153, 'avg_path_length': 2.7269, 'avg_degree_centrality': 0.0131, 'max_degree_centrality': 0.5396, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0239, 'degree_assortativity': -0.2057, 'graph_robustness': 0.8047, 'diameter_estimate': 6, 'clustering_coefficient': 0.2498, 'weakly_connected_components': 51, 'largest_wcc_size': 405, 'pagerank_top10_percent': 6.7, 'louvain_communities': 62, 'louvain_modularity': 0.4268, 'label_entropy': 1.5, 'computational_time': 0.5396264379378408}
2025-11-30 21:27:10,577 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 47, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509230.5776873, 'total_time': 18.20421020500362, 'aggregation': 2.811080776154995e-06, 'network_info': 0.007072763983160257, 'llm_extraction': 17.486885122954845, 'data_cleaning': 4.352803807705641e-05, 'neo4j_injection': 0.1689659160329029, 'embedding_time': 0, 'indexing_time': 0.0011690329993143678, 'graph_injection_time': 0.16741838492453098, 'acs_metrics': {'node_count': 455, 'relationship_count': 1352, 'density': 0.0065, 'avg_degree': 5.9429, 'avg_unique_neighbors': 5.8769, 'global_efficiency': 0.3153, 'avg_path_length': 2.7269, 'avg_degree_centrality': 0.0131, 'max_degree_centrality': 0.5396, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0239, 'degree_assortativity': -0.2057, 'graph_robustness': 0.8047, 'diameter_estimate': 6, 'clustering_coefficient': 0.2498, 'weakly_connected_components': 51, 'largest_wcc_size': 405, 'pagerank_top10_percent': 6.7, 'louvain_communities': 62, 'louvain_modularity': 0.4268, 'label_entropy': 1.5, 'computational_time': 0.5396264379378408}, 'retrieval_queries': []}
2025-11-30 21:27:10,577 - src.pipeline.kg_builder - DEBUG - Batch 47 metrics: {
  "batch_idx": 47,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509230.5776873,
  "total_time": 18.20421020500362,
  "aggregation": 2.811080776154995e-06,
  "network_info": 0.007072763983160257,
  "llm_extraction": 17.486885122954845,
  "data_cleaning": 4.352803807705641e-05,
  "neo4j_injection": 0.1689659160329029,
  "embedding_time": 0,
  "indexing_time": 0.0011690329993143678,
  "graph_injection_time": 0.16741838492453098,
  "acs_metrics": {
    "node_count": 455,
    "relationship_count": 1352,
    "density": 0.0065,
    "avg_degree": 5.9429,
    "avg_unique_neighbors": 5.8769,
    "global_efficiency": 0.3153,
    "avg_path_length": 2.7269,
    "avg_degree_centrality": 0.0131,
    "max_degree_centrality": 0.5396,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0239,
    "degree_assortativity": -0.2057,
    "graph_robustness": 0.8047,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.2498,
    "weakly_connected_components": 51,
    "largest_wcc_size": 405,
    "pagerank_top10_percent": 6.7,
    "louvain_communities": 62,
    "louvain_modularity": 0.4268,
    "label_entropy": 1.5,
    "computational_time": 0.5396264379378408
  },
  "retrieval_queries": []
}
2025-11-30 21:27:10,578 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:27:10,578 - src.pipeline.kg_builder - INFO - Batch 48 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 17.49s, Clean: 0.00s, Neo4j: 0.17s, ACS: 0.54s
2025-11-30 21:27:10,578 - src.pipeline.kg_builder - INFO - Batch 48 completed in 18.20s
Processing KG batches:  67%|██████▋   | 48/72 [20:13<09:55, 24.82s/it]2025-11-30 21:27:10,578 - src.pipeline.kg_builder - INFO - Processing batch 49/72 (3 items)
2025-11-30 21:27:10,578 - src.pipeline.kg_builder - DEBUG - Batch 49 current_video_time: 12:08-12:13
2025-11-30 21:27:10,584 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 455
- Total Relationships: 403
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:27:10,585 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:27:10,585 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_48_0 ~247 words, content: Time: 11:58-12:03 Content: The video sequence captures a scientific experiment being conducted in a laboratory setting. The scene is set on a black laboratory bench,...
2025-11-30 21:27:10,585 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_48_1 ~241 words, content: a well-equipped laboratory. - The video captures the process of a scientific experiment, with the equipment and materials being used to conduct the experiment. The...
2025-11-30 21:27:10,585 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_48_2 ~227 words, content: rer, a blue stand holds a metal rod, which is part of a larger apparatus, possibly for titration or another measurement. Other items on the...
2025-11-30 21:27:10,585 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_48_3 ~132 words, content: next stage of the process. The flexible tube, which was initially in the flask, is now shown extending across the lab bench. It is being...
2025-11-30 21:27:10,605 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:27:10,693 - src.components.pre_llm_injector - DEBUG - Found 228 existing chunk embeddings for similarity lookup
2025-11-30 21:27:10,741 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_3', '0.835'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_5', '0.786')]
2025-11-30 21:27:10,743 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_5 via source_chunk_ids
2025-11-30 21:27:10,743 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_3 via source_chunk_ids
2025-11-30 21:27:10,743 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_2', '0.716'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_1', '0.655')]
2025-11-30 21:27:10,743 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_3', '0.658'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_3', '0.628')]
2025-11-30 21:27:10,743 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_13_5', '0.786'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_3', '0.646')]
2025-11-30 21:27:10,743 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_3', '0.835'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_2', '0.759')]
2025-11-30 21:27:10,743 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:27:10,744 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_48_0) (~247 words) with timeout=5.0s retries=3
2025-11-30 21:27:11,924 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:27:11,924 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:27:11,924 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_48_1) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:27:13,317 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:27:13,317 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:27:13,318 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_48_2) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:27:14,777 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:27:14,777 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:27:14,778 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_48_3) (~132 words) with timeout=5.0s retries=3
2025-11-30 21:27:15,973 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:27:15,973 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:27:15,973 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-30 21:27:15,973 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 5.39s
2025-11-30 21:27:15,974 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 21:27:15,974 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.

RULE: If CONTEXT SUBGRAPHS is empty or says "No subgraph context available", set "inter_chunk_relations", "merge_instructions", and "prune_instructions" to []. ONLY add to "new_triplets" from NEW CANDIDATES. DO NOT invent IDs, entities, or relations—stick to provided data. For merges/links, match EXACT entity names/IDs from CONTEXT only.

### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
No subgraph context available
No existing entities or relations.

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Laboratory Bench", "relation": "Contains", "tail": "Clear Plastic Container", "source_chunks": ["48_0"]}, {"head": "Clear Plastic Container", "relation": "Contains", "tail": "Water", "source_chunks": ["48_0"]}, {"head": "Water", "relation": "Is Connected To", "tail": "Transparent Tube", "source_chunks": ["48_0"]}, {"head": "Transparent Tube", "relation": "Is Connected To", "tail": "Equipment", "source_chunks": ["48_0"]}, {"head": "Equipment", "relation": "Has", "tail": "Digital Display", "source_chunks": ["48_0"]}, {"head": "Digital Display", "relation": "Indicates", "tail": "Stirring Activity", "source_chunks": ["48_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Equipment", "source_chunks": ["48_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Materials", "source_chunks": ["48_1"]}, {"head": "Erlenmeyer Flask", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["48_1"]}, {"head": "Magnetic Stirrer", "relation": "Is Part Of", "tail": "Digital Hot Plate", "source_chunks": ["48_1"]}, {"head": "Digital Hot Plate", "relation": "Displays", "tail": "Temperature", "source_chunks": ["48_1"]}, {"head": "Glass Tube", "relation": "Is Connected To", "tail": "Erlenmeyer Flask", "source_chunks": ["48_1"]}, {"head": "Glass Flask", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["48_2"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["48_2"]}, {"head": "Magnetic Stirrer", "relation": "Is Operating", "tail": "Glass Flask", "source_chunks": ["48_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:27:15,974 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~388 words, ~504 tokens)
2025-11-30 21:27:15,974 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:27:22,850 - src.components.global_refiner - DEBUG - LLM call completed in 6.88s
2025-11-30 21:27:22,851 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Laboratory Bench', 'Contains', 'Clear Plastic Container', ['48_0']], ['Clear Plastic Container', 'Contains', 'Water', ['48_0']], ['Water', 'Is Connected To', 'Transparent Tube', ['48_0']], ['Transparent Tube', 'Is Connected To', 'Equipment', ['48_0']], ['Equipment', 'Has', 'Digital Display', ['48_0']], ['Digital Display', 'Indicates', 'Stirring Activity', ['48_0']], ['Laboratory', 'Contains', 'Equipment', ['48_1']], ['Laboratory', 'Contains', 'Materials', ['48_1']], ['Erlenmeyer Flask', 'Is On', 'Magnetic Stirrer', ['48_1']], ['Magnetic Stirrer', 'Is Part Of', 'Digital Hot Plate', ['48_1']], ['Digital Hot Plate', 'Displays', 'Temperature', ['48_1']], ['Glass Tube', 'Is Connected To', 'Erlenmeyer Flask', ['48_1']], ['Glass Flask', 'Contains', 'Clear Liquid', ['48_2']], ['Glass Flask', 'Is On', 'Magnetic Stirrer', ['48_2']], ['Magnetic Stirrer', 'Is Operating', 'Glass Flask', ['48_2']]] inter_chunk_relations=[] merge_instructions=[] prune_instructions=[]
2025-11-30 21:27:22,851 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Laboratory Bench', 'Contains', 'Clear Plastic Container', ['48_0']], ['Clear Plastic Container', 'Contains', 'Water', ['48_0']], ['Water', 'Is Connected To', 'Transparent Tube', ['48_0']]]
2025-11-30 21:27:22,851 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=0, sample=[]
2025-11-30 21:27:22,851 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=0, sample=[]
2025-11-30 21:27:22,851 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=0, sample=[]
2025-11-30 21:27:22,851 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 15 triplets (total: 6.88s, LLM: 6.88s)
2025-11-30 21:27:22,851 - src.pipeline.kg_builder - INFO - Global refinement: 15 triplets in 6.88s
2025-11-30 21:27:22,851 - src.pipeline.kg_builder - INFO - Using 15 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:27:22,851 - src.pipeline.kg_builder - INFO - Pushing batch 49/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:27:22,851 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:27:23,020 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=469, relationships=417
2025-11-30 21:27:23,021 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:27:23,026 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=469, relationships=417
2025-11-30 21:27:23,027 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:27:23,027 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:27:23,027 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:27:23,027 - src.components.neo4j_handler - INFO - Batch injected in 0.18s (triplets: 0.17s, indexes: 0.00s)
2025-11-30 21:27:23,028 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 232, 'with_embedding': 232, 'linked_chunks': 181}
2025-11-30 21:27:23,028 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:27:23,115 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 469 nodes
2025-11-30 21:27:23,354 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 418 nodes
2025-11-30 21:27:23,623 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 469, 'relationship_count': 1384, 'density': 0.0063, 'avg_degree': 5.9019, 'avg_unique_neighbors': 5.8337, 'global_efficiency': 0.3101, 'avg_path_length': 2.7967, 'avg_degree_centrality': 0.0126, 'max_degree_centrality': 0.5235, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0369, 'degree_assortativity': -0.1948, 'graph_robustness': 0.8071, 'diameter_estimate': 7, 'clustering_coefficient': 0.2517, 'weakly_connected_components': 52, 'largest_wcc_size': 418, 'pagerank_top10_percent': 6.76, 'louvain_communities': 63, 'louvain_modularity': 0.4304, 'label_entropy': 1.5, 'computational_time': 0.595149868982844}
2025-11-30 21:27:23,623 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 48, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509243.6239707, 'total_time': 13.045096707995981, 'aggregation': 2.9489165171980858e-06, 'network_info': 0.005777621059678495, 'llm_extraction': 12.266834975103848, 'data_cleaning': 3.42419371008873e-05, 'neo4j_injection': 0.17567802302073687, 'embedding_time': 0, 'indexing_time': 0.0012044080067425966, 'graph_injection_time': 0.17413377296179533, 'acs_metrics': {'node_count': 469, 'relationship_count': 1384, 'density': 0.0063, 'avg_degree': 5.9019, 'avg_unique_neighbors': 5.8337, 'global_efficiency': 0.3101, 'avg_path_length': 2.7967, 'avg_degree_centrality': 0.0126, 'max_degree_centrality': 0.5235, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0369, 'degree_assortativity': -0.1948, 'graph_robustness': 0.8071, 'diameter_estimate': 7, 'clustering_coefficient': 0.2517, 'weakly_connected_components': 52, 'largest_wcc_size': 418, 'pagerank_top10_percent': 6.76, 'louvain_communities': 63, 'louvain_modularity': 0.4304, 'label_entropy': 1.5, 'computational_time': 0.595149868982844}, 'retrieval_queries': []}
2025-11-30 21:27:23,624 - src.pipeline.kg_builder - DEBUG - Batch 48 metrics: {
  "batch_idx": 48,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509243.6239707,
  "total_time": 13.045096707995981,
  "aggregation": 2.9489165171980858e-06,
  "network_info": 0.005777621059678495,
  "llm_extraction": 12.266834975103848,
  "data_cleaning": 3.42419371008873e-05,
  "neo4j_injection": 0.17567802302073687,
  "embedding_time": 0,
  "indexing_time": 0.0012044080067425966,
  "graph_injection_time": 0.17413377296179533,
  "acs_metrics": {
    "node_count": 469,
    "relationship_count": 1384,
    "density": 0.0063,
    "avg_degree": 5.9019,
    "avg_unique_neighbors": 5.8337,
    "global_efficiency": 0.3101,
    "avg_path_length": 2.7967,
    "avg_degree_centrality": 0.0126,
    "max_degree_centrality": 0.5235,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0369,
    "degree_assortativity": -0.1948,
    "graph_robustness": 0.8071,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.2517,
    "weakly_connected_components": 52,
    "largest_wcc_size": 418,
    "pagerank_top10_percent": 6.76,
    "louvain_communities": 63,
    "louvain_modularity": 0.4304,
    "label_entropy": 1.5,
    "computational_time": 0.595149868982844
  },
  "retrieval_queries": []
}
2025-11-30 21:27:23,625 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:27:23,625 - src.pipeline.kg_builder - INFO - Batch 49 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 12.27s, Clean: 0.00s, Neo4j: 0.18s, ACS: 0.60s
2025-11-30 21:27:23,625 - src.pipeline.kg_builder - INFO - Batch 49 completed in 13.05s
Processing KG batches:  68%|██████▊   | 49/72 [20:26<08:09, 21.29s/it]2025-11-30 21:27:23,625 - src.pipeline.kg_builder - INFO - Processing batch 50/72 (3 items)
2025-11-30 21:27:23,625 - src.pipeline.kg_builder - DEBUG - Batch 50 current_video_time: 12:23-12:28
2025-11-30 21:27:23,631 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 469
- Total Relationships: 417
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:27:23,632 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:27:23,632 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_49_0 ~245 words, content: Time: 12:13-12:18 Content: The video captures a sequence of events in a laboratory setting, focusing on a scientific experiment involving a chemical reaction or a...
2025-11-30 21:27:23,632 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_49_1 ~244 words, content: water. This suggests that the experiment involves a chemical reaction or a process that produces a gas or a liquid that needs to be collected...
2025-11-30 21:27:23,632 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_49_2 ~244 words, content: , a digital device with a control panel, is actively stirring the contents of the flask. The digital display on this device shows a reading...
2025-11-30 21:27:23,632 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_49_3 ~207 words, content: captures a continuous process in a laboratory setting, focusing on a chemical experiment involving a reflux or distillation setup. The camera's perspective shifts slightly across...
2025-11-30 21:27:23,632 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_49_4 ~206 words, content: In the background, there are white **cabinets** and a **glass-enclosed cabinet** (a fume hood or a storage cabinet) with various items on shelves. - The...
2025-11-30 21:27:23,632 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_49_5 ~54 words, content: shows a laboratory experiment where a chemical reaction is being conducted in a round-bottom flask. The setup is designed to heat the mixture, vaporize a...
2025-11-30 21:27:23,652 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:27:23,746 - src.components.pre_llm_injector - DEBUG - Found 232 existing chunk embeddings for similarity lookup
2025-11-30 21:27:23,821 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_0', '0.798'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_3', '0.790')]
2025-11-30 21:27:23,823 - src.components.pre_llm_injector - DEBUG - Found 5 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_0
2025-11-30 21:27:23,823 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:27:23,823 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_3
2025-11-30 21:27:23,823 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:27:23,848 - src.components.pre_llm_injector - DEBUG - Limited Person from 127 to 2 external connections
2025-11-30 21:27:23,848 - src.components.pre_llm_injector - DEBUG - Limited Lab from 5 to 2 external connections
2025-11-30 21:27:23,848 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 136 total -> 8 (internal: 3, external: 5)
2025-11-30 21:27:23,848 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[OBSERVES]->(Background_Person / ID: 29_0), (Background_Person / ID: 29_0)-[STANDS]->(With_Arms_Crossed / ID: 29_0), (Lab / ID: 29_0)-[CONTAINS]->(Fire_Extinguisher / ID: 29_0), (Person / ID: 0_0)-[MEASURES]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[PLACES]->(Container / ID: 4_1), (Lab_Room / ID: 29_1)-[CONTAINS]->(Fire_Extinguisher / ID: 29_0), (Lab / ID: 29_0)-[CONTAINS]->(Glass Tube / ID: 33_1), (Lab / ID: 29_0)-[CONTAINS]->(White Cabinet / ID: 31_1)
2025-11-30 21:27:23,852 - src.components.pre_llm_injector - DEBUG - Limited Person from 127 to 2 external connections
2025-11-30 21:27:23,852 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 128 total -> 3 (internal: 1, external: 2)
2025-11-30 21:27:23,852 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(Smartphone / ID: 0_0), (Person / ID: 0_0)-[POURS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[CHECKS]->(Meniscus / ID: 30_0)
2025-11-30 21:27:23,852 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.747'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_0', '0.740')]
2025-11-30 21:27:23,853 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_3', '0.773'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_1', '0.769')]
2025-11-30 21:27:23,853 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_0', '0.798'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_3', '0.790')]
2025-11-30 21:27:23,853 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_0', '0.636'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2', '0.613')]
2025-11-30 21:27:23,853 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_2', '0.737'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_38_3', '0.654')]
2025-11-30 21:27:23,853 - src.components.pre_llm_injector - DEBUG - Chunk 5 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_3', '0.765'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3', '0.762')]
2025-11-30 21:27:23,853 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:27:23,853 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_49_0) (~245 words) with timeout=5.0s retries=3
2025-11-30 21:27:24,950 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:27:24,950 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:27:24,950 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_49_1) (~244 words) with timeout=5.0s retries=3
2025-11-30 21:27:26,112 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:27:26,112 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:27:26,112 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_49_2) (~244 words) with timeout=5.0s retries=3
2025-11-30 21:27:27,127 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:27:27,127 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:27:27,127 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_49_3) (~207 words) with timeout=5.0s retries=3
2025-11-30 21:27:28,944 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:27:28,944 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:27:28,945 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_49_4) (~206 words) with timeout=5.0s retries=3
2025-11-30 21:27:30,011 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:27:30,011 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:27:30,011 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_49_5) (~54 words) with timeout=5.0s retries=3
2025-11-30 21:27:31,287 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 5 (attempt 1)
2025-11-30 21:27:31,287 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 6 triplets
2025-11-30 21:27:31,287 - src.components.pre_llm_injector - INFO - Extracted 34 local triplets from 6 chunks
2025-11-30 21:27:31,287 - src.pipeline.kg_builder - INFO - Pre-extraction: 34 triplets in 7.66s
2025-11-30 21:27:31,288 - src.components.global_refiner - INFO - Capping refinement input: 34 → 15 triplets
2025-11-30 21:27:31,288 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[OBSERVES]->(Background_Person / ID: 29_0), (Background_Person / ID: 29_0)-[STANDS]->(With_Arms_Crossed / ID: 29_0), (Lab / ID: 29_0)-[CONTAINS]->(Fire_Extinguisher / ID: 29_0), (Person / ID: 0_0)-[MEASURES]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[PLACES]->(Container / ID: 4_1), (Lab_Room / ID: 29_1)-[CONTAINS]->(Fire_Extinguisher / ID: 29_0), (Lab / ID: 29_0)-[CONTAINS]->(Glass Tube / ID: 33_1), (Lab / ID: 29_0)-[CONTAINS]->(White Cabinet / ID: 31_1)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[HOLDS]->(Smartphone / ID: 0_0), (Person / ID: 0_0)-[POURS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[CHECKS]->(Meniscus / ID: 30_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Laboratory Table", "relation": "Contains", "tail": "Equipment", "source_chunks": ["49_0"]}, {"head": "Equipment", "relation": "Includes", "tail": "Plastic Container", "source_chunks": ["49_0"]}, {"head": "Plastic Container", "relation": "Contains", "tail": "Water", "source_chunks": ["49_0", "49_1"]}, {"head": "Apparatus", "relation": "Includes", "tail": "Blue Stand", "source_chunks": ["49_0"]}, {"head": "Blue Stand", "relation": "Supports", "tail": "Metal Rod", "source_chunks": ["49_0"]}, {"head": "Glass Container", "relation": "Connected To", "tail": "Tube", "source_chunks": ["49_0"]}, {"head": "Glass Container", "relation": "Is Connected To", "tail": "Tube", "source_chunks": ["49_1"]}, {"head": "Tube", "relation": "Leads To", "tail": "Plastic Container", "source_chunks": ["49_1"]}, {"head": "Glass Container", "relation": "Produces", "tail": "Foam", "source_chunks": ["49_1"]}, {"head": "Foam", "relation": "Is Generated In", "tail": "Glass Container", "source_chunks": ["49_1"]}, {"head": "Digital Device", "relation": "Stirs", "tail": "Glass Container", "source_chunks": ["49_1"]}, {"head": "Digital Device", "relation": "Stirs", "tail": "Flask", "source_chunks": ["49_2"]}, {"head": "Digital Device", "relation": "Displays", "tail": "Time", "source_chunks": ["49_2"]}, {"head": "Flask", "relation": "Produces", "tail": "Foam", "source_chunks": ["49_2"]}, {"head": "Tube", "relation": "Connects", "tail": "Flask", "source_chunks": ["49_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:27:31,288 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~407 words, ~529 tokens)
2025-11-30 21:27:31,288 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:27:43,566 - src.components.global_refiner - DEBUG - LLM call completed in 12.28s
2025-11-30 21:27:43,566 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Laboratory Table', 'Contains', 'Equipment', ['49_0']], ['Equipment', 'Includes', 'Plastic Container', ['49_0']], ['Plastic Container', 'Contains', 'Water', ['49_0', '49_1']], ['Apparatus', 'Includes', 'Blue Stand', ['49_0']], ['Blue Stand', 'Supports', 'Metal Rod', ['49_0']], ['Glass Container', 'Connected To', 'Tube', ['49_0']], ['Glass Container', 'Is Connected To', 'Tube', ['49_1']], ['Tube', 'Leads To', 'Plastic Container', ['49_1']], ['Glass Container', 'Produces', 'Foam', ['49_1']], ['Foam', 'Is Generated In', 'Glass Container', ['49_1']], ['Digital Device', 'Stirs', 'Glass Container', ['49_1']], ['Digital Device', 'Stirs', 'Flask', ['49_2']], ['Digital Device', 'Displays', 'Time', ['49_2']], ['Flask', 'Produces', 'Foam', ['49_2']], ['Tube', 'Connects', 'Flask', ['49_2']]] inter_chunk_relations=[['Laboratory Table', 'Contains', 'Lab_Room', ['49_0']], ['Equipment', 'Includes', 'Lab', ['49_0']], ['Plastic Container', 'Contains', 'Container', ['49_0']], ['Glass Container', 'Connected To', 'Glass Tube', ['49_0']], ['Digital Device', 'Stirs', 'Mass Of Liquid', ['49_1']]] merge_instructions=[{'local': 'Glass Container', 'existing': 'Glass Tube', 'existing_id': '33_1'}, {'local': 'Digital Device', 'existing': 'Smartphone', 'existing_id': '0_0'}, {'local': 'Apparatus', 'existing': 'Lab', 'existing_id': '29_0'}, {'local': 'Blue Stand', 'existing': 'With_Arms_Crossed', 'existing_id': '29_0'}] prune_instructions=[{'entity': 'Apparatus'}, {'head': 'Person', 'relation': 'OBSERVES', 'tail': 'Background_Person'}, {'head': 'Person', 'relation': 'MEASURES', 'tail': 'Mass Of Liquid'}, {'head': 'Person', 'relation': 'PLACES', 'tail': 'Container'}]
2025-11-30 21:27:43,566 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Laboratory Table', 'Contains', 'Equipment', ['49_0']], ['Equipment', 'Includes', 'Plastic Container', ['49_0']], ['Plastic Container', 'Contains', 'Water', ['49_0', '49_1']]]
2025-11-30 21:27:43,566 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Laboratory Table', 'Contains', 'Lab_Room', ['49_0']], ['Equipment', 'Includes', 'Lab', ['49_0']], ['Plastic Container', 'Contains', 'Container', ['49_0']]]
2025-11-30 21:27:43,566 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Glass Container', 'existing': 'Glass Tube', 'existing_id': '33_1'}, {'local': 'Digital Device', 'existing': 'Smartphone', 'existing_id': '0_0'}, {'local': 'Apparatus', 'existing': 'Lab', 'existing_id': '29_0'}]
2025-11-30 21:27:43,566 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'entity': 'Apparatus'}, {'head': 'Person', 'relation': 'OBSERVES', 'tail': 'Background_Person'}, {'head': 'Person', 'relation': 'MEASURES', 'tail': 'Mass Of Liquid'}]
2025-11-30 21:27:43,567 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Glass Container', 'existing': 'Glass Tube', 'existing_id': '33_1'}, {'local': 'Digital Device', 'existing': 'Smartphone', 'existing_id': '0_0'}, {'local': 'Apparatus', 'existing': 'Lab', 'existing_id': '29_0'}, {'local': 'Blue Stand', 'existing': 'With_Arms_Crossed', 'existing_id': '29_0'}]
2025-11-30 21:27:43,567 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'entity': 'Apparatus'}, {'head': 'Person', 'relation': 'OBSERVES', 'tail': 'Background_Person'}, {'head': 'Person', 'relation': 'MEASURES', 'tail': 'Mass Of Liquid'}, {'head': 'Person', 'relation': 'PLACES', 'tail': 'Container'}]
2025-11-30 21:27:43,567 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 12.28s, LLM: 12.28s)
2025-11-30 21:27:43,567 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 12.28s
2025-11-30 21:27:43,567 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:27:43,567 - src.pipeline.kg_builder - INFO - Pushing batch 50/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:27:43,567 - src.components.neo4j_handler - INFO - Adding 20 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:27:43,861 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=482, relationships=436
2025-11-30 21:27:43,861 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:27:43,862 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass Container -> Glass Tube
2025-11-30 21:27:43,865 - src.components.neo4j_handler - DEBUG - APOC merge successful: Digital Device -> Smartphone
2025-11-30 21:27:43,868 - src.components.neo4j_handler - DEBUG - APOC merge successful: Apparatus -> Lab
2025-11-30 21:27:43,871 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue Stand -> With_Arms_Crossed
2025-11-30 21:27:43,871 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:27:43,875 - src.components.neo4j_handler - DEBUG - No matching entity found to prune: Apparatus
2025-11-30 21:27:43,876 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[OBSERVES]-> Background_Person
2025-11-30 21:27:43,903 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[MEASURES]-> Mass Of Liquid
2025-11-30 21:27:43,904 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[PLACES]-> Container
2025-11-30 21:27:43,904 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:27:43,906 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Laboratory Table -[Contains]-> Lab_Room
2025-11-30 21:27:43,909 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Equipment -[Includes]-> Lab
2025-11-30 21:27:43,912 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Plastic Container -[Contains]-> Container
2025-11-30 21:27:43,937 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Glass Container -[Connected To]-> Glass Tube
2025-11-30 21:27:43,964 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Digital Device -[Stirs]-> Mass Of Liquid
2025-11-30 21:27:43,965 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:27:43,972 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=478, relationships=433
2025-11-30 21:27:43,975 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:27:43,975 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:27:43,975 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:27:43,975 - src.components.neo4j_handler - INFO - Batch injected in 0.41s (triplets: 0.41s, indexes: 0.00s)
2025-11-30 21:27:43,977 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 238, 'with_embedding': 238, 'linked_chunks': 184}
2025-11-30 21:27:43,978 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:27:44,068 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 478 nodes
2025-11-30 21:27:44,315 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 424 nodes
2025-11-30 21:27:44,595 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 478, 'relationship_count': 1424, 'density': 0.0062, 'avg_degree': 5.9582, 'avg_unique_neighbors': 5.8828, 'global_efficiency': 0.3059, 'avg_path_length': 2.8069, 'avg_degree_centrality': 0.0125, 'max_degree_centrality': 0.5115, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0225, 'degree_assortativity': -0.1874, 'graph_robustness': 0.8146, 'diameter_estimate': 7, 'clustering_coefficient': 0.2486, 'weakly_connected_components': 55, 'largest_wcc_size': 424, 'pagerank_top10_percent': 6.65, 'louvain_communities': 66, 'louvain_modularity': 0.4234, 'label_entropy': 1.5, 'computational_time': 0.6171957099577412}
2025-11-30 21:27:44,595 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 49, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509264.595531, 'total_time': 20.970343381981365, 'aggregation': 2.8529902920126915e-06, 'network_info': 0.006248256075195968, 'llm_extraction': 19.935424536000937, 'data_cleaning': 1.5595927834510803e-05, 'neo4j_injection': 0.40886650199536234, 'embedding_time': 0, 'indexing_time': 0.0036332550225779414, 'graph_injection_time': 0.4050167138921097, 'acs_metrics': {'node_count': 478, 'relationship_count': 1424, 'density': 0.0062, 'avg_degree': 5.9582, 'avg_unique_neighbors': 5.8828, 'global_efficiency': 0.3059, 'avg_path_length': 2.8069, 'avg_degree_centrality': 0.0125, 'max_degree_centrality': 0.5115, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0225, 'degree_assortativity': -0.1874, 'graph_robustness': 0.8146, 'diameter_estimate': 7, 'clustering_coefficient': 0.2486, 'weakly_connected_components': 55, 'largest_wcc_size': 424, 'pagerank_top10_percent': 6.65, 'louvain_communities': 66, 'louvain_modularity': 0.4234, 'label_entropy': 1.5, 'computational_time': 0.6171957099577412}, 'retrieval_queries': []}
2025-11-30 21:27:44,595 - src.pipeline.kg_builder - DEBUG - Batch 49 metrics: {
  "batch_idx": 49,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509264.595531,
  "total_time": 20.970343381981365,
  "aggregation": 2.8529902920126915e-06,
  "network_info": 0.006248256075195968,
  "llm_extraction": 19.935424536000937,
  "data_cleaning": 1.5595927834510803e-05,
  "neo4j_injection": 0.40886650199536234,
  "embedding_time": 0,
  "indexing_time": 0.0036332550225779414,
  "graph_injection_time": 0.4050167138921097,
  "acs_metrics": {
    "node_count": 478,
    "relationship_count": 1424,
    "density": 0.0062,
    "avg_degree": 5.9582,
    "avg_unique_neighbors": 5.8828,
    "global_efficiency": 0.3059,
    "avg_path_length": 2.8069,
    "avg_degree_centrality": 0.0125,
    "max_degree_centrality": 0.5115,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0225,
    "degree_assortativity": -0.1874,
    "graph_robustness": 0.8146,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.2486,
    "weakly_connected_components": 55,
    "largest_wcc_size": 424,
    "pagerank_top10_percent": 6.65,
    "louvain_communities": 66,
    "louvain_modularity": 0.4234,
    "label_entropy": 1.5,
    "computational_time": 0.6171957099577412
  },
  "retrieval_queries": []
}
2025-11-30 21:27:44,596 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:27:44,596 - src.pipeline.kg_builder - INFO - Batch 50 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.94s, Clean: 0.00s, Neo4j: 0.41s, ACS: 0.62s
2025-11-30 21:27:44,596 - src.pipeline.kg_builder - INFO - Batch 50 completed in 20.97s
Processing KG batches:  69%|██████▉   | 50/72 [20:47<07:46, 21.19s/it]2025-11-30 21:27:44,596 - src.pipeline.kg_builder - INFO - Processing batch 51/72 (3 items)
2025-11-30 21:27:44,596 - src.pipeline.kg_builder - DEBUG - Batch 51 current_video_time: 12:38-12:43
2025-11-30 21:27:44,605 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 478
- Total Relationships: 433
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:27:44,605 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:27:44,606 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_50_0 ~234 words, content: Time: 12:28-12:33 Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a procedure on a black lab bench. The...
2025-11-30 21:27:44,606 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_50_1 ~240 words, content: guide the tube, ensuring it is properly positioned within the container. The surrounding environment is a laboratory setting. To the left, there is a blue...
2025-11-30 21:27:44,606 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_50_2 ~24 words, content:  a glass cylinder holding pens and tools. The overall action appears to be the transfer of liquid or the setup for a chemical process.
2025-11-30 21:27:44,626 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:27:44,713 - src.components.pre_llm_injector - DEBUG - Found 238 existing chunk embeddings for similarity lookup
2025-11-30 21:27:44,752 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_1', '0.804'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_1', '0.799')]
2025-11-30 21:27:44,754 - src.components.pre_llm_injector - DEBUG - Found 5 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_1
2025-11-30 21:27:44,754 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:27:44,754 - src.components.pre_llm_injector - DEBUG - Found 7 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_1
2025-11-30 21:27:44,754 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:27:44,777 - src.components.pre_llm_injector - DEBUG - Limited Person from 121 to 2 external connections
2025-11-30 21:27:44,777 - src.components.pre_llm_injector - DEBUG - Limited Graduated Cylinder from 4 to 2 external connections
2025-11-30 21:27:44,777 - src.components.pre_llm_injector - DEBUG - Limited Pipette from 3 to 2 external connections
2025-11-30 21:27:44,777 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 132 total -> 10 (internal: 4, external: 6)
2025-11-30 21:27:44,778 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[USES]->(Pipette / ID: 40_2), (Person / ID: 0_0)-[OBSERVES]->(Graduated Cylinder / ID: 41_1), (Person / ID: 0_0)-[HOLDS]->(Graduated Cylinder / ID: 41_1), (Person / ID: 0_0)-[PERFORMS]->(Precise Liquid Transfer / ID: 41_1), (Person / ID: 0_0)-[LOOKS_AT]->(Meniscus / ID: 30_0), (Person / ID: 0_0)-[USES]->(White Cylindrical Device / ID: 45_2), (Mass Of Liquid / ID: 15_1)-[ENTERS]->(Graduated Cylinder / ID: 41_1), (Graduated Cylinder / ID: 41_1)-[CONTAINS]->(Mass Of Liquid / ID: 15_1), (Pipette / ID: 40_2)-[DISPENSES]->(Mass Of Liquid / ID: 15_1), (Pipette / ID: 40_2)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1)
2025-11-30 21:27:44,784 - src.components.pre_llm_injector - DEBUG - Limited Equipment from 13 to 2 external connections
2025-11-30 21:27:44,784 - src.components.pre_llm_injector - DEBUG - Limited Person from 115 to 2 external connections
2025-11-30 21:27:44,784 - src.components.pre_llm_injector - DEBUG - Limited Laboratory from 6 to 2 external connections
2025-11-30 21:27:44,784 - src.components.pre_llm_injector - DEBUG - Limited Digital Balance from 12 to 2 external connections
2025-11-30 21:27:44,784 - src.components.pre_llm_injector - DEBUG - Limited Burette from 4 to 2 external connections
2025-11-30 21:27:44,784 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 163 total -> 23 (internal: 13, external: 10)
2025-11-30 21:27:44,784 - src.components.pre_llm_injector - DEBUG - Subgraph: (Laboratory / ID: 0_1)-[CONTAINS]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[TARES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[HANDLES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Digital Balance / ID: 16_1)-[IS_VISIBLE_IN_BACKGROUND]->(Laboratory / ID: 0_1), (Burette / ID: 4_2)-[IS_VISIBLE_IN_BACKGROUND]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[HOLDS]->(Gloves / ID: 30_2), (Person / ID: 0_0)-[USES]->(Gloves / ID: 30_2), (Person / ID: 0_0)-[ADJUSTS]->(Burette / ID: 4_2), (Person / ID: 0_0)-[HANDLES]->(Burette / ID: 4_2), (Person / ID: 0_0)-[HOLDS]->(Burette / ID: 4_2), (Person / ID: 0_0)-[CONTROLS]->(Burette / ID: 4_2), (Person / ID: 0_0)-[USES]->(Digital Balance / ID: 16_1), (Countertop / ID: 1_0)-[CONTAINS]->(Equipment / ID: 1_0), (Laboratory_Glassware / ID: 4_2)-[IS_PLACED_ON]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[HANDLES]->(Liquid_In_Small_Container / ID: 5_0), (Person / ID: 0_0)-[HOLDS]->(Glass_Pipette / ID: 26_2), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance / ID: 36_2), (Camera / ID: 0_1)-[PULLS_BACK]->(Laboratory / ID: 0_1), (Digital Balance / ID: 16_1)-[DISPLAYS]->(56.30 / ID: 26_1), (Digital Balance / ID: 16_1)-[MEASURES]->(Mass / ID: 9_2), (Burette / ID: 4_2)-[CONTAINS]->(Chemical Substance / ID: 10_0), (Burette / ID: 4_2)-[IS_ABOVE]->(Volumetric Flask / ID: 18_1)
2025-11-30 21:27:44,784 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_24_2', '0.562'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_3', '0.470')]
2025-11-30 21:27:44,784 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_1', '0.804'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_1', '0.799')]
2025-11-30 21:27:44,784 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_2', '0.760'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_4', '0.742')]
2025-11-30 21:27:44,784 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:27:44,784 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_50_0) (~234 words) with timeout=5.0s retries=3
2025-11-30 21:27:46,467 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:27:46,467 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:27:46,467 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_50_1) (~240 words) with timeout=5.0s retries=3
2025-11-30 21:27:47,372 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:27:47,372 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:27:47,372 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_50_2) (~24 words) with timeout=5.0s retries=3
2025-11-30 21:27:48,491 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:27:48,491 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:27:48,491 - src.components.pre_llm_injector - INFO - Extracted 18 local triplets from 3 chunks
2025-11-30 21:27:48,492 - src.pipeline.kg_builder - INFO - Pre-extraction: 18 triplets in 3.89s
2025-11-30 21:27:48,492 - src.components.global_refiner - INFO - Capping refinement input: 18 → 15 triplets
2025-11-30 21:27:48,492 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[USES]->(Pipette / ID: 40_2), (Person / ID: 0_0)-[OBSERVES]->(Graduated Cylinder / ID: 41_1), (Person / ID: 0_0)-[HOLDS]->(Graduated Cylinder / ID: 41_1), (Person / ID: 0_0)-[PERFORMS]->(Precise Liquid Transfer / ID: 41_1), (Person / ID: 0_0)-[LOOKS_AT]->(Meniscus / ID: 30_0), (Person / ID: 0_0)-[USES]->(White Cylindrical Device / ID: 45_2), (Mass Of Liquid / ID: 15_1)-[ENTERS]->(Graduated Cylinder / ID: 41_1), (Graduated Cylinder / ID: 41_1)-[CONTAINS]->(Mass Of Liquid / ID: 15_1), (Pipette / ID: 40_2)-[DISPENSES]->(Mass Of Liquid / ID: 15_1), (Pipette / ID: 40_2)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1)
Subgraph_2: Subgraph: (Laboratory / ID: 0_1)-[CONTAINS]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[TARES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[HANDLES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Digital Balance / ID: 16_1)-[IS_VISIBLE_IN_BACKGROUND]->(Laboratory / ID: 0_1), (Burette / ID: 4_2)-[IS_VISIBLE_IN_BACKGROUND]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[HOLDS]->(Gloves / ID: 30_2), (Person / ID: 0_0)-[USES]->(Gloves / ID: 30_2), (Person / ID: 0_0)-[ADJUSTS]->(Burette / ID: 4_2), (Person / ID: 0_0)-[HANDLES]->(Burette / ID: 4_2), (Person / ID: 0_0)-[HOLDS]->(Burette / ID: 4_2), (Person / ID: 0_0)-[CONTROLS]->(Burette / ID: 4_2), (Person / ID: 0_0)-[USES]->(Digital Balance / ID: 16_1), (Countertop / ID: 1_0)-[CONTAINS]->(Equipment / ID: 1_0), (Laboratory_Glassware / ID: 4_2)-[IS_PLACED_ON]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[HANDLES]->(Liquid_In_Small_Container / ID: 5_0), (Person / ID: 0_0)-[HOLDS]->(Glass_Pipette / ID: 26_2), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance / ID: 36_2), (Camera / ID: 0_1)-[PULLS_BACK]->(Laboratory / ID: 0_1), (Digital Balance / ID: 16_1)-[DISPLAYS]->(56.30 / ID: 26_1), (Digital Balance / ID: 16_1)-[MEASURES]->(Mass / ID: 9_2), (Burette / ID: 4_2)-[CONTAINS]->(Chemical Substance / ID: 10_0), (Burette / ID: 4_2)-[IS_ABOVE]->(Volumetric Flask / ID: 18_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["50_0"]}, {"head": "Person", "relation": "Manipulates", "tail": "Translucent_Tube", "source_chunks": ["50_0"]}, {"head": "Translucent_Tube", "relation": "Is Connected To", "tail": "Equipment", "source_chunks": ["50_0"]}, {"head": "Translucent_Tube", "relation": "Is Inserted Into", "tail": "Clear_Plastic_Container", "source_chunks": ["50_0"]}, {"head": "Clear_Plastic_Container", "relation": "Is Inside", "tail": "White_Plastic_Measuring_Jug", "source_chunks": ["50_0"]}, {"head": "Person", "relation": "Uses", "tail": "Both_Hands", "source_chunks": ["50_0"]}, {"head": "Person", "relation": "Holds", "tail": "Tube", "source_chunks": ["50_1"]}, {"head": "Person", "relation": "Holds", "tail": "Container", "source_chunks": ["50_1"]}, {"head": "Tube", "relation": "Is Inserted Into", "tail": "Container", "source_chunks": ["50_1"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["50_1"]}, {"head": "Watch", "relation": "Has Color", "tail": "Gold", "source_chunks": ["50_1"]}, {"head": "Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["50_1"]}, {"head": "Glass Cylinder", "relation": "Holds", "tail": "Pens And Tools", "source_chunks": ["50_2"]}, {"head": "Glass Cylinder", "relation": "Contains", "tail": "Liquid", "source_chunks": ["50_2"]}, {"head": "Person", "relation": "Performs", "tail": "Transfer Of Liquid", "source_chunks": ["50_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:27:48,492 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~569 words, ~740 tokens)
2025-11-30 21:27:48,492 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:28:13,126 - src.components.global_refiner - DEBUG - LLM call completed in 24.63s
2025-11-30 21:28:13,126 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['50_0']], ['Person', 'Manipulates', 'Translucent_Tube', ['50_0']], ['Translucent_Tube', 'Is Connected To', 'Equipment', ['50_0']], ['Translucent_Tube', 'Is Inserted Into', 'Clear_Plastic_Container', ['50_0']], ['Clear_Plastic_Container', 'Is Inside', 'White_Plastic_Measuring_Jug', ['50_0']], ['Person', 'Uses', 'Both_Hands', ['50_0']], ['Person', 'Holds', 'Tube', ['50_1']], ['Person', 'Holds', 'Container', ['50_1']], ['Tube', 'Is Inserted Into', 'Container', ['50_1']], ['Person', 'Wears', 'Watch', ['50_1']], ['Watch', 'Has Color', 'Gold', ['50_1']], ['Container', 'Contains', 'Liquid', ['50_1']], ['Glass Cylinder', 'Holds', 'Pens And Tools', ['50_2']], ['Glass Cylinder', 'Contains', 'Liquid', ['50_2']], ['Person', 'Performs', 'Transfer Of Liquid', ['50_2']]] inter_chunk_relations=[['Translucent_Tube', 'Is Connected To', 'Equipment', ['50_0']], ['Translucent_Tube', 'Is Inserted Into', 'Clear_Plastic_Container', ['50_0']], ['Clear_Plastic_Container', 'Is Inside', 'White_Plastic_Measuring_Jug', ['50_0']], ['Person', 'Holds', 'Tube', ['50_1']], ['Person', 'Holds', 'Container', ['50_1']], ['Tube', 'Is Inserted Into', 'Container', ['50_1']], ['Person', 'Wears', 'Watch', ['50_1']], ['Watch', 'Has Color', 'Gold', ['50_1']], ['Container', 'Contains', 'Liquid', ['50_1']], ['Glass Cylinder', 'Holds', 'Pens And Tools', ['50_2']], ['Glass Cylinder', 'Contains', 'Liquid', ['50_2']], ['Person', 'Performs', 'Transfer Of Liquid', ['50_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Gloves', 'existing_id': '30_2'}, {'local': 'Translucent_Tube', 'existing': 'Pipette', 'existing_id': '40_2'}, {'local': 'Clear_Plastic_Container', 'existing': 'Graduated Cylinder', 'existing_id': '41_1'}, {'local': 'White_Plastic_Measuring_Jug', 'existing': 'Equipment', 'existing_id': '1_0'}, {'local': 'Both_Hands', 'existing': 'Person', 'existing_id': '0_0'}, {'local': 'Tube', 'existing': 'Pipette', 'existing_id': '40_2'}, {'local': 'Container', 'existing': 'Graduated Cylinder', 'existing_id': '41_1'}, {'local': 'Watch', 'existing': 'Digital Balance', 'existing_id': '16_1'}, {'local': 'Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Glass Cylinder', 'existing': 'Graduated Cylinder', 'existing_id': '41_1'}, {'local': 'Transfer Of Liquid', 'existing': 'Precise Liquid Transfer', 'existing_id': '41_1'}] prune_instructions=[{'entity': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Translucent_Tube', 'relation': 'Is Connected To', 'tail': 'Equipment'}, {'head': 'Translucent_Tube', 'relation': 'Is Inserted Into', 'tail': 'Clear_Plastic_Container'}, {'head': 'Clear_Plastic_Container', 'relation': 'Is Inside', 'tail': 'White_Plastic_Measuring_Jug'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Both_Hands'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Tube'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Container'}, {'head': 'Tube', 'relation': 'Is Inserted Into', 'tail': 'Container'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Watch'}, {'head': 'Watch', 'relation': 'Has Color', 'tail': 'Gold'}, {'head': 'Container', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Glass Cylinder', 'relation': 'Holds', 'tail': 'Pens And Tools'}, {'head': 'Glass Cylinder', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Performs', 'tail': 'Transfer Of Liquid'}]
2025-11-30 21:28:13,126 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['50_0']], ['Person', 'Manipulates', 'Translucent_Tube', ['50_0']], ['Translucent_Tube', 'Is Connected To', 'Equipment', ['50_0']]]
2025-11-30 21:28:13,126 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=12, sample=[['Translucent_Tube', 'Is Connected To', 'Equipment', ['50_0']], ['Translucent_Tube', 'Is Inserted Into', 'Clear_Plastic_Container', ['50_0']], ['Clear_Plastic_Container', 'Is Inside', 'White_Plastic_Measuring_Jug', ['50_0']]]
2025-11-30 21:28:13,126 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=11, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Gloves', 'existing_id': '30_2'}, {'local': 'Translucent_Tube', 'existing': 'Pipette', 'existing_id': '40_2'}, {'local': 'Clear_Plastic_Container', 'existing': 'Graduated Cylinder', 'existing_id': '41_1'}]
2025-11-30 21:28:13,126 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=15, sample=[{'entity': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Translucent_Tube', 'relation': 'Is Connected To', 'tail': 'Equipment'}]
2025-11-30 21:28:13,126 - src.components.global_refiner - INFO - LLM suggested 11 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Gloves', 'existing_id': '30_2'}, {'local': 'Translucent_Tube', 'existing': 'Pipette', 'existing_id': '40_2'}, {'local': 'Clear_Plastic_Container', 'existing': 'Graduated Cylinder', 'existing_id': '41_1'}, {'local': 'White_Plastic_Measuring_Jug', 'existing': 'Equipment', 'existing_id': '1_0'}, {'local': 'Both_Hands', 'existing': 'Person', 'existing_id': '0_0'}, {'local': 'Tube', 'existing': 'Pipette', 'existing_id': '40_2'}, {'local': 'Container', 'existing': 'Graduated Cylinder', 'existing_id': '41_1'}, {'local': 'Watch', 'existing': 'Digital Balance', 'existing_id': '16_1'}, {'local': 'Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Glass Cylinder', 'existing': 'Graduated Cylinder', 'existing_id': '41_1'}, {'local': 'Transfer Of Liquid', 'existing': 'Precise Liquid Transfer', 'existing_id': '41_1'}]
2025-11-30 21:28:13,126 - src.components.global_refiner - INFO - LLM suggested 15 triplets to prune: [{'entity': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Translucent_Tube', 'relation': 'Is Connected To', 'tail': 'Equipment'}, {'head': 'Translucent_Tube', 'relation': 'Is Inserted Into', 'tail': 'Clear_Plastic_Container'}, {'head': 'Clear_Plastic_Container', 'relation': 'Is Inside', 'tail': 'White_Plastic_Measuring_Jug'}, {'head': 'Person', 'relation': 'Uses', 'tail': 'Both_Hands'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Tube'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Container'}, {'head': 'Tube', 'relation': 'Is Inserted Into', 'tail': 'Container'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Watch'}, {'head': 'Watch', 'relation': 'Has Color', 'tail': 'Gold'}, {'head': 'Container', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Glass Cylinder', 'relation': 'Holds', 'tail': 'Pens And Tools'}, {'head': 'Glass Cylinder', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Person', 'relation': 'Performs', 'tail': 'Transfer Of Liquid'}]
2025-11-30 21:28:13,126 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 27 triplets (total: 24.63s, LLM: 24.63s)
2025-11-30 21:28:13,126 - src.pipeline.kg_builder - INFO - Global refinement: 27 triplets in 24.63s
2025-11-30 21:28:13,127 - src.pipeline.kg_builder - INFO - Using 27 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:28:13,127 - src.pipeline.kg_builder - INFO - Pushing batch 51/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:28:13,127 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:28:13,316 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=489, relationships=446
2025-11-30 21:28:13,316 - src.components.neo4j_handler - INFO - Applying 11 merge instructions
2025-11-30 21:28:13,317 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Gloves
2025-11-30 21:28:13,322 - src.components.neo4j_handler - DEBUG - APOC merge successful: Translucent_Tube -> Pipette
2025-11-30 21:28:13,326 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear_Plastic_Container -> Graduated Cylinder
2025-11-30 21:28:13,330 - src.components.neo4j_handler - DEBUG - APOC merge successful: White_Plastic_Measuring_Jug -> Equipment
2025-11-30 21:28:13,334 - src.components.neo4j_handler - DEBUG - APOC merge successful: Both_Hands -> Person
2025-11-30 21:28:13,342 - src.components.neo4j_handler - DEBUG - APOC merge successful: Tube -> Pipette
2025-11-30 21:28:13,346 - src.components.neo4j_handler - DEBUG - APOC merge successful: Container -> Graduated Cylinder
2025-11-30 21:28:13,352 - src.components.neo4j_handler - DEBUG - APOC merge successful: Watch -> Digital Balance
2025-11-30 21:28:13,357 - src.components.neo4j_handler - DEBUG - APOC merge successful: Liquid -> Mass Of Liquid
2025-11-30 21:28:13,362 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass Cylinder -> Graduated Cylinder
2025-11-30 21:28:13,366 - src.components.neo4j_handler - DEBUG - APOC merge successful: Transfer Of Liquid -> Precise Liquid Transfer
2025-11-30 21:28:13,366 - src.components.neo4j_handler - INFO - Applying 15 prune instructions
2025-11-30 21:28:13,370 - src.components.neo4j_handler - DEBUG - No matching entity found to prune: Blue_Nitrile_Gloves
2025-11-30 21:28:13,371 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:28:13,392 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Translucent_Tube -[Is Connected To]-> Equipment
2025-11-30 21:28:13,416 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Translucent_Tube -[Is Inserted Into]-> Clear_Plastic_Container
2025-11-30 21:28:13,417 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Clear_Plastic_Container -[Is Inside]-> White_Plastic_Measuring_Jug
2025-11-30 21:28:13,418 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Uses]-> Both_Hands
2025-11-30 21:28:13,418 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Tube
2025-11-30 21:28:13,419 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Container
2025-11-30 21:28:13,439 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Tube -[Is Inserted Into]-> Container
2025-11-30 21:28:13,440 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Watch
2025-11-30 21:28:13,460 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Watch -[Has Color]-> Gold
2025-11-30 21:28:13,462 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Container -[Contains]-> Liquid
2025-11-30 21:28:13,462 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Glass Cylinder -[Holds]-> Pens And Tools
2025-11-30 21:28:13,463 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Glass Cylinder -[Contains]-> Liquid
2025-11-30 21:28:13,463 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Performs]-> Transfer Of Liquid
2025-11-30 21:28:13,463 - src.components.neo4j_handler - INFO - Applying 12 inter-chunk relations
2025-11-30 21:28:13,484 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Translucent_Tube -[Is Connected To]-> Equipment
2025-11-30 21:28:13,485 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Translucent_Tube -[Is Inserted Into]-> Clear_Plastic_Container
2025-11-30 21:28:13,486 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Clear_Plastic_Container -[Is Inside]-> White_Plastic_Measuring_Jug
2025-11-30 21:28:13,486 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Tube
2025-11-30 21:28:13,487 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Container
2025-11-30 21:28:13,487 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Tube -[Is Inserted Into]-> Container
2025-11-30 21:28:13,488 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Watch
2025-11-30 21:28:13,489 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Watch -[Has Color]-> Gold
2025-11-30 21:28:13,489 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Container -[Contains]-> Liquid
2025-11-30 21:28:13,489 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Glass Cylinder -[Holds]-> Pens And Tools
2025-11-30 21:28:13,490 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Glass Cylinder -[Contains]-> Liquid
2025-11-30 21:28:13,490 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Performs]-> Transfer Of Liquid
2025-11-30 21:28:13,491 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:28:13,496 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=478, relationships=446
2025-11-30 21:28:13,497 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:28:13,497 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:28:13,497 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:28:13,497 - src.components.neo4j_handler - INFO - Batch injected in 0.37s (triplets: 0.37s, indexes: 0.00s)
2025-11-30 21:28:13,499 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 241, 'with_embedding': 241, 'linked_chunks': 187}
2025-11-30 21:28:13,499 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:28:13,589 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 478 nodes
2025-11-30 21:28:13,830 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 424 nodes
2025-11-30 21:28:14,096 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 478, 'relationship_count': 1434, 'density': 0.0063, 'avg_degree': 6.0, 'avg_unique_neighbors': 5.9121, 'global_efficiency': 0.3069, 'avg_path_length': 2.7937, 'avg_degree_centrality': 0.0126, 'max_degree_centrality': 0.5136, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0426, 'degree_assortativity': -0.1672, 'graph_robustness': 0.8682, 'diameter_estimate': 7, 'clustering_coefficient': 0.2539, 'weakly_connected_components': 55, 'largest_wcc_size': 424, 'pagerank_top10_percent': 6.63, 'louvain_communities': 66, 'louvain_modularity': 0.4199, 'label_entropy': 1.5, 'computational_time': 0.5968933529220521}
2025-11-30 21:28:14,096 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 50, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509294.0962956, 'total_time': 29.499406088027172, 'aggregation': 2.9739458113908768e-06, 'network_info': 0.008703688043169677, 'llm_extraction': 28.52127606095746, 'data_cleaning': 1.5649013221263885e-05, 'neo4j_injection': 0.37079163000453264, 'embedding_time': 0, 'indexing_time': 0.0017523659626021981, 'graph_injection_time': 0.36883957404643297, 'acs_metrics': {'node_count': 478, 'relationship_count': 1434, 'density': 0.0063, 'avg_degree': 6.0, 'avg_unique_neighbors': 5.9121, 'global_efficiency': 0.3069, 'avg_path_length': 2.7937, 'avg_degree_centrality': 0.0126, 'max_degree_centrality': 0.5136, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0426, 'degree_assortativity': -0.1672, 'graph_robustness': 0.8682, 'diameter_estimate': 7, 'clustering_coefficient': 0.2539, 'weakly_connected_components': 55, 'largest_wcc_size': 424, 'pagerank_top10_percent': 6.63, 'louvain_communities': 66, 'louvain_modularity': 0.4199, 'label_entropy': 1.5, 'computational_time': 0.5968933529220521}, 'retrieval_queries': []}
2025-11-30 21:28:14,096 - src.pipeline.kg_builder - DEBUG - Batch 50 metrics: {
  "batch_idx": 50,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509294.0962956,
  "total_time": 29.499406088027172,
  "aggregation": 2.9739458113908768e-06,
  "network_info": 0.008703688043169677,
  "llm_extraction": 28.52127606095746,
  "data_cleaning": 1.5649013221263885e-05,
  "neo4j_injection": 0.37079163000453264,
  "embedding_time": 0,
  "indexing_time": 0.0017523659626021981,
  "graph_injection_time": 0.36883957404643297,
  "acs_metrics": {
    "node_count": 478,
    "relationship_count": 1434,
    "density": 0.0063,
    "avg_degree": 6.0,
    "avg_unique_neighbors": 5.9121,
    "global_efficiency": 0.3069,
    "avg_path_length": 2.7937,
    "avg_degree_centrality": 0.0126,
    "max_degree_centrality": 0.5136,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0426,
    "degree_assortativity": -0.1672,
    "graph_robustness": 0.8682,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.2539,
    "weakly_connected_components": 55,
    "largest_wcc_size": 424,
    "pagerank_top10_percent": 6.63,
    "louvain_communities": 66,
    "louvain_modularity": 0.4199,
    "label_entropy": 1.5,
    "computational_time": 0.5968933529220521
  },
  "retrieval_queries": []
}
2025-11-30 21:28:14,097 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:28:14,097 - src.pipeline.kg_builder - INFO - Batch 51 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 28.52s, Clean: 0.00s, Neo4j: 0.37s, ACS: 0.60s
2025-11-30 21:28:14,097 - src.pipeline.kg_builder - INFO - Batch 51 completed in 29.50s
Processing KG batches:  71%|███████   | 51/72 [21:17<08:17, 23.68s/it]2025-11-30 21:28:14,097 - src.pipeline.kg_builder - INFO - Processing batch 52/72 (3 items)
2025-11-30 21:28:14,097 - src.pipeline.kg_builder - DEBUG - Batch 52 current_video_time: 12:53-12:58
2025-11-30 21:28:14,104 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 478
- Total Relationships: 446
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:28:14,104 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:28:14,104 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_51_0 ~232 words, content: Time: 12:43-12:48 Content: The video captures a close-up, first-person view of a laboratory procedure being performed on a black countertop. The central action involves a...
2025-11-30 21:28:14,104 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_51_1 ~227 words, content: a controlled scientific or medical procedure. The focus is on the precise transfer of a substance, likely a reagent or a sample, into a container...
2025-11-30 21:28:14,104 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_51_2 ~241 words, content: view of a person's hands, protected by blue nitrile gloves. The person is holding a long, flexible, translucent tube. They are carefully inserting the end...
2025-11-30 21:28:14,104 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_51_3 ~121 words, content: system. The person's hands are still engaged, ensuring the tube is properly positioned. The background shows a well-equipped laboratory with white cabinets, shelves filled with...
2025-11-30 21:28:14,124 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:28:14,219 - src.components.pre_llm_injector - DEBUG - Found 241 existing chunk embeddings for similarity lookup
2025-11-30 21:28:14,270 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_5', '0.872'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.841')]
2025-11-30 21:28:14,272 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_5 via source_chunk_ids
2025-11-30 21:28:14,273 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3 via source_chunk_ids
2025-11-30 21:28:14,273 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_3', '0.822'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_3', '0.811')]
2025-11-30 21:28:14,273 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_3', '0.832'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_0', '0.804')]
2025-11-30 21:28:14,273 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_24_2', '0.577'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_2', '0.571')]
2025-11-30 21:28:14,273 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_5', '0.872'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.841')]
2025-11-30 21:28:14,273 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:28:14,273 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_51_0) (~232 words) with timeout=5.0s retries=3
2025-11-30 21:28:15,627 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:28:15,627 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:28:15,627 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_51_1) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:28:16,978 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:28:16,978 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:28:16,978 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_51_2) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:28:18,660 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:28:18,660 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:28:18,660 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_51_3) (~121 words) with timeout=5.0s retries=3
2025-11-30 21:28:19,625 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:28:19,625 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:28:19,626 - src.components.pre_llm_injector - INFO - Extracted 20 local triplets from 4 chunks
2025-11-30 21:28:19,626 - src.pipeline.kg_builder - INFO - Pre-extraction: 20 triplets in 5.52s
2025-11-30 21:28:19,626 - src.components.global_refiner - INFO - Capping refinement input: 20 → 15 triplets
2025-11-30 21:28:19,626 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.

RULE: If CONTEXT SUBGRAPHS is empty or says "No subgraph context available", set "inter_chunk_relations", "merge_instructions", and "prune_instructions" to []. ONLY add to "new_triplets" from NEW CANDIDATES. DO NOT invent IDs, entities, or relations—stick to provided data. For merges/links, match EXACT entity names/IDs from CONTEXT only.

### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
No subgraph context available
No existing entities or relations.

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["51_0", "51_1", "51_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Beaker", "source_chunks": ["51_0", "51_1"]}, {"head": "Person", "relation": "Uses", "tail": "Translucent_Tube", "source_chunks": ["51_0"]}, {"head": "Translucent_Tube", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["51_0"]}, {"head": "Clear_Liquid", "relation": "Flows Into", "tail": "Glass_Beaker", "source_chunks": ["51_0"]}, {"head": "Person", "relation": "Holds", "tail": "Watch", "source_chunks": ["51_0", "51_1"]}, {"head": "Person", "relation": "Uses", "tail": "Flexible_Tube", "source_chunks": ["51_1"]}, {"head": "Flexible_Tube", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["51_1"]}, {"head": "Clear_Liquid", "relation": "Is Transferred To", "tail": "Glass_Beaker", "source_chunks": ["51_1"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["51_2"]}, {"head": "Translucent_Tube", "relation": "Is Inserted Into", "tail": "Clear_Plastic_Container", "source_chunks": ["51_2"]}, {"head": "Clear_Plastic_Container", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["51_2"]}, {"head": "Translucent_Tube", "relation": "Connects To", "tail": "Yellow_Apparatus", "source_chunks": ["51_2"]}, {"head": "Yellow_Apparatus", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["51_2"]}, {"head": "Person", "relation": "Handles", "tail": "Tube", "source_chunks": ["51_3"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:28:19,627 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~362 words, ~471 tokens)
2025-11-30 21:28:19,627 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:28:27,538 - src.components.global_refiner - DEBUG - LLM call completed in 7.91s
2025-11-30 21:28:27,538 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['51_0', '51_1', '51_2']], ['Person', 'Holds', 'Glass_Beaker', ['51_0', '51_1']], ['Person', 'Uses', 'Translucent_Tube', ['51_0']], ['Translucent_Tube', 'Transfers', 'Clear_Liquid', ['51_0']], ['Clear_Liquid', 'Flows Into', 'Glass_Beaker', ['51_0']], ['Person', 'Holds', 'Watch', ['51_0', '51_1']], ['Person', 'Uses', 'Flexible_Tube', ['51_1']], ['Flexible_Tube', 'Transfers', 'Clear_Liquid', ['51_1']], ['Clear_Liquid', 'Is Transferred To', 'Glass_Beaker', ['51_1']], ['Person', 'Holds', 'Translucent_Tube', ['51_2']], ['Translucent_Tube', 'Is Inserted Into', 'Clear_Plastic_Container', ['51_2']], ['Clear_Plastic_Container', 'Contains', 'Clear_Liquid', ['51_2']], ['Translucent_Tube', 'Connects To', 'Yellow_Apparatus', ['51_2']], ['Yellow_Apparatus', 'Holds', 'Translucent_Tube', ['51_2']], ['Person', 'Handles', 'Tube', ['51_3']]] inter_chunk_relations=[] merge_instructions=[] prune_instructions=[]
2025-11-30 21:28:27,538 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['51_0', '51_1', '51_2']], ['Person', 'Holds', 'Glass_Beaker', ['51_0', '51_1']], ['Person', 'Uses', 'Translucent_Tube', ['51_0']]]
2025-11-30 21:28:27,538 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=0, sample=[]
2025-11-30 21:28:27,538 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=0, sample=[]
2025-11-30 21:28:27,538 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=0, sample=[]
2025-11-30 21:28:27,538 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 15 triplets (total: 7.91s, LLM: 7.91s)
2025-11-30 21:28:27,538 - src.pipeline.kg_builder - INFO - Global refinement: 15 triplets in 7.91s
2025-11-30 21:28:27,538 - src.pipeline.kg_builder - INFO - Using 15 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:28:27,538 - src.pipeline.kg_builder - INFO - Pushing batch 52/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:28:27,539 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:28:27,671 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=490, relationships=461
2025-11-30 21:28:27,671 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:28:27,676 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=490, relationships=461
2025-11-30 21:28:27,677 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:28:27,677 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:28:27,677 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:28:27,677 - src.components.neo4j_handler - INFO - Batch injected in 0.14s (triplets: 0.14s, indexes: 0.00s)
2025-11-30 21:28:27,678 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 245, 'with_embedding': 245, 'linked_chunks': 191}
2025-11-30 21:28:27,678 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:28:27,780 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 490 nodes
2025-11-30 21:28:28,040 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 436 nodes
2025-11-30 21:28:28,327 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 490, 'relationship_count': 1467, 'density': 0.0061, 'avg_degree': 5.9878, 'avg_unique_neighbors': 5.898, 'global_efficiency': 0.3095, 'avg_path_length': 2.7858, 'avg_degree_centrality': 0.0122, 'max_degree_centrality': 0.5215, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0475, 'degree_assortativity': -0.172, 'graph_robustness': 0.8589, 'diameter_estimate': 7, 'clustering_coefficient': 0.2552, 'weakly_connected_components': 55, 'largest_wcc_size': 436, 'pagerank_top10_percent': 6.44, 'louvain_communities': 67, 'louvain_modularity': 0.4312, 'label_entropy': 1.5, 'computational_time': 0.6491440120153129}
2025-11-30 21:28:28,328 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 51, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509308.328091, 'total_time': 14.230577916954644, 'aggregation': 3.288034349679947e-06, 'network_info': 0.006642060005106032, 'llm_extraction': 13.43452042201534, 'data_cleaning': 2.6489957235753536e-05, 'neo4j_injection': 0.1386860649799928, 'embedding_time': 0, 'indexing_time': 0.001228237058967352, 'graph_injection_time': 0.13717811403330415, 'acs_metrics': {'node_count': 490, 'relationship_count': 1467, 'density': 0.0061, 'avg_degree': 5.9878, 'avg_unique_neighbors': 5.898, 'global_efficiency': 0.3095, 'avg_path_length': 2.7858, 'avg_degree_centrality': 0.0122, 'max_degree_centrality': 0.5215, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0475, 'degree_assortativity': -0.172, 'graph_robustness': 0.8589, 'diameter_estimate': 7, 'clustering_coefficient': 0.2552, 'weakly_connected_components': 55, 'largest_wcc_size': 436, 'pagerank_top10_percent': 6.44, 'louvain_communities': 67, 'louvain_modularity': 0.4312, 'label_entropy': 1.5, 'computational_time': 0.6491440120153129}, 'retrieval_queries': []}
2025-11-30 21:28:28,328 - src.pipeline.kg_builder - DEBUG - Batch 51 metrics: {
  "batch_idx": 51,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509308.328091,
  "total_time": 14.230577916954644,
  "aggregation": 3.288034349679947e-06,
  "network_info": 0.006642060005106032,
  "llm_extraction": 13.43452042201534,
  "data_cleaning": 2.6489957235753536e-05,
  "neo4j_injection": 0.1386860649799928,
  "embedding_time": 0,
  "indexing_time": 0.001228237058967352,
  "graph_injection_time": 0.13717811403330415,
  "acs_metrics": {
    "node_count": 490,
    "relationship_count": 1467,
    "density": 0.0061,
    "avg_degree": 5.9878,
    "avg_unique_neighbors": 5.898,
    "global_efficiency": 0.3095,
    "avg_path_length": 2.7858,
    "avg_degree_centrality": 0.0122,
    "max_degree_centrality": 0.5215,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0475,
    "degree_assortativity": -0.172,
    "graph_robustness": 0.8589,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.2552,
    "weakly_connected_components": 55,
    "largest_wcc_size": 436,
    "pagerank_top10_percent": 6.44,
    "louvain_communities": 67,
    "louvain_modularity": 0.4312,
    "label_entropy": 1.5,
    "computational_time": 0.6491440120153129
  },
  "retrieval_queries": []
}
2025-11-30 21:28:28,329 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:28:28,329 - src.pipeline.kg_builder - INFO - Batch 52 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 13.43s, Clean: 0.00s, Neo4j: 0.14s, ACS: 0.65s
2025-11-30 21:28:28,329 - src.pipeline.kg_builder - INFO - Batch 52 completed in 14.23s
Processing KG batches:  72%|███████▏  | 52/72 [21:31<06:56, 20.85s/it]2025-11-30 21:28:28,329 - src.pipeline.kg_builder - INFO - Processing batch 53/72 (3 items)
2025-11-30 21:28:28,329 - src.pipeline.kg_builder - DEBUG - Batch 53 current_video_time: 13:08-13:13
2025-11-30 21:28:28,336 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 490
- Total Relationships: 461
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:28:28,336 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:28:28,336 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_52_0 ~241 words, content: Time: 12:58-13:03 Content: The video captures a sequence of actions in a laboratory setting, focusing on a person performing a procedure involving a long, flexible...
2025-11-30 21:28:28,336 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_52_1 ~240 words, content: are several power outlets, a glass beaker with pens and tools, a green bag of wipes, and a container with cotton balls. The background shows...
2025-11-30 21:28:28,336 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_52_2 ~207 words, content: with various items, including a blue foam block, a roll of tape, electrical cords, a glass beaker holding pens and scissors, a container of cotton...
2025-11-30 21:28:28,357 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:28:28,444 - src.components.pre_llm_injector - DEBUG - Found 245 existing chunk embeddings for similarity lookup
2025-11-30 21:28:28,483 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_4', '0.701'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_48_3', '0.701')]
2025-11-30 21:28:28,485 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_4
2025-11-30 21:28:28,485 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:28:28,486 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_48_3 via source_chunk_ids
2025-11-30 21:28:28,502 - src.components.pre_llm_injector - DEBUG - Limited Person from 131 to 2 external connections
2025-11-30 21:28:28,502 - src.components.pre_llm_injector - DEBUG - Limited Vial from 7 to 2 external connections
2025-11-30 21:28:28,502 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 144 total -> 10 (internal: 6, external: 4)
2025-11-30 21:28:28,503 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(Vial / ID: 34_2), (Person / ID: 0_0)-[HOLDS]->(Vial / ID: 34_2), (Person / ID: 0_0)-[HOLDS]->(Vial / ID: 34_2), (Person / ID: 0_0)-[HANDLES]->(Vial / ID: 34_2), (Person / ID: 0_0)-[PLACES]->(Vial / ID: 34_2), (Person / ID: 0_0)-[USES]->(Person / ID: 0_0), (Person / ID: 0_0)-[HOLDS]->(Translucent_Tube / ID: 51_0), (Person / ID: 0_0)-[TRANSFERS]->(Chemical Substance / ID: 10_0), (Lab Bench / ID: 2_1)-[CONTAINS]->(Vial / ID: 34_2), (Vial / ID: 34_2)-[IS_PLACED_ON]->(Balance / ID: 36_2)
2025-11-30 21:28:28,503 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_3', '0.555'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_2', '0.550')]
2025-11-30 21:28:28,503 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.566'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_0', '0.561')]
2025-11-30 21:28:28,503 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_4', '0.701'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_48_3', '0.701')]
2025-11-30 21:28:28,503 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:28:28,503 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_52_0) (~241 words) with timeout=5.0s retries=3
2025-11-30 21:28:30,184 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:28:30,184 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:28:30,185 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_52_1) (~240 words) with timeout=5.0s retries=3
2025-11-30 21:28:31,454 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:28:31,455 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:28:31,455 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_52_2) (~207 words) with timeout=5.0s retries=3
2025-11-30 21:28:36,461 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 21:28:38,154 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 2)
2025-11-30 21:28:38,154 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:28:38,154 - src.components.pre_llm_injector - INFO - Extracted 16 local triplets from 3 chunks
2025-11-30 21:28:38,154 - src.pipeline.kg_builder - INFO - Pre-extraction: 16 triplets in 9.82s
2025-11-30 21:28:38,154 - src.components.global_refiner - INFO - Capping refinement input: 16 → 15 triplets
2025-11-30 21:28:38,154 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[HOLDS]->(Vial / ID: 34_2), (Person / ID: 0_0)-[HOLDS]->(Vial / ID: 34_2), (Person / ID: 0_0)-[HOLDS]->(Vial / ID: 34_2), (Person / ID: 0_0)-[HANDLES]->(Vial / ID: 34_2), (Person / ID: 0_0)-[PLACES]->(Vial / ID: 34_2), (Person / ID: 0_0)-[USES]->(Person / ID: 0_0), (Person / ID: 0_0)-[HOLDS]->(Translucent_Tube / ID: 51_0), (Person / ID: 0_0)-[TRANSFERS]->(Chemical Substance / ID: 10_0), (Lab Bench / ID: 2_1)-[CONTAINS]->(Vial / ID: 34_2), (Vial / ID: 34_2)-[IS_PLACED_ON]->(Balance / ID: 36_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["52_0", "52_1"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["52_0", "52_1"]}, {"head": "Translucent_Tube", "relation": "Is Connected To", "tail": "Yellow_Apparatus", "source_chunks": ["52_0"]}, {"head": "Yellow_Apparatus", "relation": "Is Mounted On", "tail": "Metal_Stand", "source_chunks": ["52_0"]}, {"head": "Person", "relation": "Guides", "tail": "Translucent_Tube", "source_chunks": ["52_0"]}, {"head": "Translucent_Tube", "relation": "Is Inserted Into", "tail": "Clear_Plastic_Container", "source_chunks": ["52_0"]}, {"head": "Person", "relation": "Holds", "tail": "Clear_Plastic_Container", "source_chunks": ["52_1"]}, {"head": "Person", "relation": "Uses", "tail": "Metal_Stand", "source_chunks": ["52_1"]}, {"head": "Person", "relation": "Uses", "tail": "Yellow_Clamp", "source_chunks": ["52_1"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Clear_Plastic_Container", "source_chunks": ["52_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["52_2"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent Tube", "source_chunks": ["52_2"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Beaker", "source_chunks": ["52_2"]}, {"head": "Translucent Tube", "relation": "Transfers", "tail": "Clear Liquid", "source_chunks": ["52_2"]}, {"head": "Glass Beaker", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["52_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:28:38,154 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~388 words, ~504 tokens)
2025-11-30 21:28:38,154 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:30:00,776 - src.components.global_refiner - ERROR - Instruction-based refinement failed after 82.62s: Could not parse response content as the length limit was reached - CompletionUsage(completion_tokens=4000, prompt_tokens=1191, total_tokens=5191, completion_tokens_details=None, prompt_tokens_details=None)
2025-11-30 21:30:00,776 - src.components.global_refiner - INFO - Using fallback deduplication: 15 → 15 triplets
2025-11-30 21:30:00,777 - src.pipeline.kg_builder - INFO - Global refinement: 15 triplets in 82.62s
2025-11-30 21:30:00,777 - src.pipeline.kg_builder - INFO - Using 15 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:30:00,777 - src.pipeline.kg_builder - INFO - Pushing batch 53/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:30:00,777 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:30:00,966 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=495, relationships=473
2025-11-30 21:30:00,967 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:30:00,975 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=495, relationships=473
2025-11-30 21:30:00,978 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:30:00,978 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:30:00,978 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:30:00,978 - src.components.neo4j_handler - INFO - Batch injected in 0.20s (triplets: 0.20s, indexes: 0.00s)
2025-11-30 21:30:00,981 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 248, 'with_embedding': 248, 'linked_chunks': 194}
2025-11-30 21:30:00,981 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:30:01,057 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 495 nodes
2025-11-30 21:30:01,318 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 441 nodes
2025-11-30 21:30:01,606 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 495, 'relationship_count': 1495, 'density': 0.0061, 'avg_degree': 6.0404, 'avg_unique_neighbors': 5.9515, 'global_efficiency': 0.3132, 'avg_path_length': 2.7542, 'avg_degree_centrality': 0.0122, 'max_degree_centrality': 0.5344, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0343, 'degree_assortativity': -0.1788, 'graph_robustness': 0.8635, 'diameter_estimate': 7, 'clustering_coefficient': 0.2536, 'weakly_connected_components': 55, 'largest_wcc_size': 441, 'pagerank_top10_percent': 6.38, 'louvain_communities': 69, 'louvain_modularity': 0.4284, 'label_entropy': 1.5, 'computational_time': 0.6246910729678348}
2025-11-30 21:30:01,606 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 52, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509401.6062891, 'total_time': 93.27694649994373, 'aggregation': 2.7689384296536446e-06, 'network_info': 0.007009629043750465, 'llm_extraction': 92.4405025189044, 'data_cleaning': 1.3557029888033867e-05, 'neo4j_injection': 0.2015681469347328, 'embedding_time': 0, 'indexing_time': 0.00341771706007421, 'graph_injection_time': 0.19795315095689148, 'acs_metrics': {'node_count': 495, 'relationship_count': 1495, 'density': 0.0061, 'avg_degree': 6.0404, 'avg_unique_neighbors': 5.9515, 'global_efficiency': 0.3132, 'avg_path_length': 2.7542, 'avg_degree_centrality': 0.0122, 'max_degree_centrality': 0.5344, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0343, 'degree_assortativity': -0.1788, 'graph_robustness': 0.8635, 'diameter_estimate': 7, 'clustering_coefficient': 0.2536, 'weakly_connected_components': 55, 'largest_wcc_size': 441, 'pagerank_top10_percent': 6.38, 'louvain_communities': 69, 'louvain_modularity': 0.4284, 'label_entropy': 1.5, 'computational_time': 0.6246910729678348}, 'retrieval_queries': []}
2025-11-30 21:30:01,606 - src.pipeline.kg_builder - DEBUG - Batch 52 metrics: {
  "batch_idx": 52,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509401.6062891,
  "total_time": 93.27694649994373,
  "aggregation": 2.7689384296536446e-06,
  "network_info": 0.007009629043750465,
  "llm_extraction": 92.4405025189044,
  "data_cleaning": 1.3557029888033867e-05,
  "neo4j_injection": 0.2015681469347328,
  "embedding_time": 0,
  "indexing_time": 0.00341771706007421,
  "graph_injection_time": 0.19795315095689148,
  "acs_metrics": {
    "node_count": 495,
    "relationship_count": 1495,
    "density": 0.0061,
    "avg_degree": 6.0404,
    "avg_unique_neighbors": 5.9515,
    "global_efficiency": 0.3132,
    "avg_path_length": 2.7542,
    "avg_degree_centrality": 0.0122,
    "max_degree_centrality": 0.5344,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0343,
    "degree_assortativity": -0.1788,
    "graph_robustness": 0.8635,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.2536,
    "weakly_connected_components": 55,
    "largest_wcc_size": 441,
    "pagerank_top10_percent": 6.38,
    "louvain_communities": 69,
    "louvain_modularity": 0.4284,
    "label_entropy": 1.5,
    "computational_time": 0.6246910729678348
  },
  "retrieval_queries": []
}
2025-11-30 21:30:01,607 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:30:01,607 - src.pipeline.kg_builder - INFO - Batch 53 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 92.44s, Clean: 0.00s, Neo4j: 0.20s, ACS: 0.62s
2025-11-30 21:30:01,607 - src.pipeline.kg_builder - INFO - Batch 53 completed in 93.28s
Processing KG batches:  74%|███████▎  | 53/72 [23:04<13:28, 42.58s/it]2025-11-30 21:30:01,607 - src.pipeline.kg_builder - INFO - Processing batch 54/72 (3 items)
2025-11-30 21:30:01,607 - src.pipeline.kg_builder - DEBUG - Batch 54 current_video_time: 13:23-13:28
2025-11-30 21:30:01,615 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 495
- Total Relationships: 473
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:30:01,616 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:30:01,616 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_53_0 ~226 words, content: Time: 13:13-13:18 Content: The video shows a person conducting a laboratory procedure, likely a rinsing or washing step, from a first-person perspective. The individual, wearing...
2025-11-30 21:30:01,616 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_53_1 ~225 words, content: , the video captures a precise laboratory technique where a glass container is being rinsed or washed using a liquid transfer method, resulting in a...
2025-11-30 21:30:01,616 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_53_2 ~227 words, content: . The person in the foreground continues to hold the white tube, which is now positioned over the large jug. The workbench is cluttered with...
2025-11-30 21:30:01,636 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:30:01,727 - src.components.pre_llm_injector - DEBUG - Found 248 existing chunk embeddings for similarity lookup
2025-11-30 21:30:01,767 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_3', '0.850'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_4', '0.844')]
2025-11-30 21:30:01,770 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_4
2025-11-30 21:30:01,770 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:30:01,770 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_3 via source_chunk_ids
2025-11-30 21:30:01,788 - src.components.pre_llm_injector - DEBUG - Limited Person from 138 to 2 external connections
2025-11-30 21:30:01,788 - src.components.pre_llm_injector - DEBUG - Limited Vial from 7 to 2 external connections
2025-11-30 21:30:01,788 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 151 total -> 10 (internal: 6, external: 4)
2025-11-30 21:30:01,788 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(Vial / ID: 34_2), (Person / ID: 0_0)-[HOLDS]->(Vial / ID: 34_2), (Person / ID: 0_0)-[HOLDS]->(Vial / ID: 34_2), (Person / ID: 0_0)-[HANDLES]->(Vial / ID: 34_2), (Person / ID: 0_0)-[PLACES]->(Vial / ID: 34_2), (Person / ID: 0_0)-[USES]->(Person / ID: 0_0), (Person / ID: 0_0)-[HOLDS]->(Watch / ID: 51_0), (Person / ID: 0_0)-[ADDS_LIQUID_TO]->(Liquid_In_Small_Container / ID: 5_0), (Mass Of Liquid / ID: 15_1)-[IS_TRANSFERRED_TO]->(Vial / ID: 34_2), (Lab Bench / ID: 2_1)-[CONTAINS]->(Vial / ID: 34_2)
2025-11-30 21:30:01,788 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_2', '0.700'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_1', '0.648')]
2025-11-30 21:30:01,788 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_0', '0.769'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_4', '0.744')]
2025-11-30 21:30:01,788 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_3', '0.850'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_44_4', '0.844')]
2025-11-30 21:30:01,788 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:30:01,789 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_53_0) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:30:03,167 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:30:03,168 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:30:03,168 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_53_1) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:30:04,549 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:30:04,549 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:30:04,550 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_53_2) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:30:05,717 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:30:05,717 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:30:05,717 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 3 chunks
2025-11-30 21:30:05,717 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 4.10s
2025-11-30 21:30:05,718 - src.components.global_refiner - INFO - Capping refinement input: 17 → 15 triplets
2025-11-30 21:30:05,718 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[HOLDS]->(Vial / ID: 34_2), (Person / ID: 0_0)-[HOLDS]->(Vial / ID: 34_2), (Person / ID: 0_0)-[HOLDS]->(Vial / ID: 34_2), (Person / ID: 0_0)-[HANDLES]->(Vial / ID: 34_2), (Person / ID: 0_0)-[PLACES]->(Vial / ID: 34_2), (Person / ID: 0_0)-[USES]->(Person / ID: 0_0), (Person / ID: 0_0)-[HOLDS]->(Watch / ID: 51_0), (Person / ID: 0_0)-[ADDS_LIQUID_TO]->(Liquid_In_Small_Container / ID: 5_0), (Mass Of Liquid / ID: 15_1)-[IS_TRANSFERRED_TO]->(Vial / ID: 34_2), (Lab Bench / ID: 2_1)-[CONTAINS]->(Vial / ID: 34_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["53_0", "53_1"]}, {"head": "Person", "relation": "Holds", "tail": "Flexible_Tube", "source_chunks": ["53_0"]}, {"head": "Flexible_Tube", "relation": "Is Inserted Into", "tail": "Beaker", "source_chunks": ["53_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Container", "source_chunks": ["53_0"]}, {"head": "Glass_Container", "relation": "Is Submerged In", "tail": "Beaker", "source_chunks": ["53_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["53_0"]}, {"head": "Person", "relation": "Holds", "tail": "White_Flexible_Tube", "source_chunks": ["53_1"]}, {"head": "Person", "relation": "Manipulates", "tail": "Large_Translucent_Container", "source_chunks": ["53_1"]}, {"head": "Person", "relation": "Wears", "tail": "Black_Watch", "source_chunks": ["53_1"]}, {"head": "Person", "relation": "Holds", "tail": "Small_Clear_Container", "source_chunks": ["53_1"]}, {"head": "Person", "relation": "Interacts With", "tail": "Cloudy_Liquid", "source_chunks": ["53_1"]}, {"head": "Person", "relation": "Holds", "tail": "White Tube", "source_chunks": ["53_2"]}, {"head": "White Tube", "relation": "Is Positioned Over", "tail": "Large Jug", "source_chunks": ["53_2"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["53_2"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Glass Beaker", "source_chunks": ["53_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:30:05,718 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~386 words, ~502 tokens)
2025-11-30 21:30:05,718 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:30:24,690 - src.components.global_refiner - DEBUG - LLM call completed in 18.97s
2025-11-30 21:30:24,690 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['53_0']], ['Person', 'Holds', 'Flexible_Tube', ['53_0']], ['Flexible_Tube', 'Is Inserted Into', 'Beaker', ['53_0']], ['Person', 'Holds', 'Glass_Container', ['53_0']], ['Glass_Container', 'Is Submerged In', 'Beaker', ['53_0']], ['Beaker', 'Contains', 'Clear_Liquid', ['53_0']], ['Person', 'Wears', 'Black_Watch', ['53_1']], ['Person', 'Holds', 'White_Flexible_Tube', ['53_1']], ['Person', 'Manipulates', 'Large_Translucent_Container', ['53_1']], ['Person', 'Holds', 'Small_Clear_Container', ['53_1']], ['Person', 'Interacts With', 'Cloudy_Liquid', ['53_1']], ['Person', 'Holds', 'White Tube', ['53_2']], ['White Tube', 'Is Positioned Over', 'Large Jug', ['53_2']], ['Person', 'Uses', 'Pipette', ['53_2']], ['Lab Bench', 'Contains', 'Glass Beaker', ['53_2']]] inter_chunk_relations=[['Person', 'Holds', 'Vial', ['53_0']], ['Person', 'Holds', 'Vial', ['53_1']], ['Person', 'Holds', 'Vial', ['53_2']], ['Person', 'Holds', 'Vial', ['53_0']], ['Person', 'Holds', 'Vial', ['53_1']], ['Person', 'Holds', 'Vial', ['53_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Black_Watch', 'existing': 'Watch', 'existing_id': '51_0'}, {'local': 'Flexible_Tube', 'existing': 'Tube', 'existing_id': '51_0'}, {'local': 'White_Flexible_Tube', 'existing': 'Tube', 'existing_id': '51_0'}, {'local': 'White Tube', 'existing': 'Tube', 'existing_id': '51_0'}, {'local': 'Small_Clear_Container', 'existing': 'Vial', 'existing_id': '34_2'}, {'local': 'Large_Translucent_Container', 'existing': 'Beaker', 'existing_id': '2_1'}, {'local': 'Glass Beaker', 'existing': 'Beaker', 'existing_id': '2_1'}, {'local': 'Clear_Liquid', 'existing': 'Liquid', 'existing_id': '5_0'}, {'local': 'Cloudy_Liquid', 'existing': 'Liquid', 'existing_id': '5_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}]
2025-11-30 21:30:24,690 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['53_0']], ['Person', 'Holds', 'Flexible_Tube', ['53_0']], ['Flexible_Tube', 'Is Inserted Into', 'Beaker', ['53_0']]]
2025-11-30 21:30:24,690 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=6, sample=[['Person', 'Holds', 'Vial', ['53_0']], ['Person', 'Holds', 'Vial', ['53_1']], ['Person', 'Holds', 'Vial', ['53_2']]]
2025-11-30 21:30:24,690 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=10, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Black_Watch', 'existing': 'Watch', 'existing_id': '51_0'}, {'local': 'Flexible_Tube', 'existing': 'Tube', 'existing_id': '51_0'}]
2025-11-30 21:30:24,690 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=10, sample=[{'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}]
2025-11-30 21:30:24,691 - src.components.global_refiner - INFO - LLM suggested 10 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Black_Watch', 'existing': 'Watch', 'existing_id': '51_0'}, {'local': 'Flexible_Tube', 'existing': 'Tube', 'existing_id': '51_0'}, {'local': 'White_Flexible_Tube', 'existing': 'Tube', 'existing_id': '51_0'}, {'local': 'White Tube', 'existing': 'Tube', 'existing_id': '51_0'}, {'local': 'Small_Clear_Container', 'existing': 'Vial', 'existing_id': '34_2'}, {'local': 'Large_Translucent_Container', 'existing': 'Beaker', 'existing_id': '2_1'}, {'local': 'Glass Beaker', 'existing': 'Beaker', 'existing_id': '2_1'}, {'local': 'Clear_Liquid', 'existing': 'Liquid', 'existing_id': '5_0'}, {'local': 'Cloudy_Liquid', 'existing': 'Liquid', 'existing_id': '5_0'}]
2025-11-30 21:30:24,691 - src.components.global_refiner - INFO - LLM suggested 10 triplets to prune: [{'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}]
2025-11-30 21:30:24,691 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 21 triplets (total: 18.97s, LLM: 18.97s)
2025-11-30 21:30:24,691 - src.pipeline.kg_builder - INFO - Global refinement: 21 triplets in 18.97s
2025-11-30 21:30:24,691 - src.pipeline.kg_builder - INFO - Using 21 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:30:24,691 - src.pipeline.kg_builder - INFO - Pushing batch 54/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:30:24,691 - src.components.neo4j_handler - INFO - Adding 16 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:30:24,902 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=505, relationships=485
2025-11-30 21:30:24,902 - src.components.neo4j_handler - INFO - Applying 10 merge instructions
2025-11-30 21:30:24,903 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Glove
2025-11-30 21:30:24,908 - src.components.neo4j_handler - DEBUG - APOC merge successful: Black_Watch -> Watch
2025-11-30 21:30:24,912 - src.components.neo4j_handler - DEBUG - APOC merge successful: Flexible_Tube -> Tube
2025-11-30 21:30:24,916 - src.components.neo4j_handler - DEBUG - APOC merge successful: White_Flexible_Tube -> Tube
2025-11-30 21:30:24,920 - src.components.neo4j_handler - DEBUG - APOC merge successful: White Tube -> Tube
2025-11-30 21:30:24,924 - src.components.neo4j_handler - DEBUG - APOC merge successful: Small_Clear_Container -> Vial
2025-11-30 21:30:24,928 - src.components.neo4j_handler - DEBUG - APOC merge successful: Large_Translucent_Container -> Beaker
2025-11-30 21:30:24,932 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass Beaker -> Beaker
2025-11-30 21:30:24,936 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear_Liquid -> Liquid
2025-11-30 21:30:24,938 - src.components.neo4j_handler - DEBUG - APOC merge successful: Cloudy_Liquid -> Liquid
2025-11-30 21:30:24,938 - src.components.neo4j_handler - INFO - Applying 10 prune instructions
2025-11-30 21:30:24,940 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Vial
2025-11-30 21:30:24,941 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Vial
2025-11-30 21:30:24,942 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Vial
2025-11-30 21:30:24,943 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Vial
2025-11-30 21:30:24,944 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Vial
2025-11-30 21:30:24,944 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Vial
2025-11-30 21:30:24,945 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Vial
2025-11-30 21:30:24,946 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Vial
2025-11-30 21:30:24,947 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Vial
2025-11-30 21:30:24,947 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Vial
2025-11-30 21:30:24,947 - src.components.neo4j_handler - INFO - Applying 6 inter-chunk relations
2025-11-30 21:30:24,949 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Vial
2025-11-30 21:30:24,951 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Vial
2025-11-30 21:30:24,953 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Vial
2025-11-30 21:30:24,954 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Vial
2025-11-30 21:30:24,955 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Vial
2025-11-30 21:30:24,956 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Vial
2025-11-30 21:30:24,957 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:30:24,964 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=497, relationships=482
2025-11-30 21:30:24,965 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:30:24,965 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:30:24,965 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:30:24,965 - src.components.neo4j_handler - INFO - Batch injected in 0.27s (triplets: 0.27s, indexes: 0.00s)
2025-11-30 21:30:24,967 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 251, 'with_embedding': 251, 'linked_chunks': 197}
2025-11-30 21:30:24,967 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:30:25,106 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 497 nodes
2025-11-30 21:30:25,377 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 443 nodes
2025-11-30 21:30:25,678 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 497, 'relationship_count': 1516, 'density': 0.0061, 'avg_degree': 6.1006, 'avg_unique_neighbors': 6.0121, 'global_efficiency': 0.3139, 'avg_path_length': 2.7488, 'avg_degree_centrality': 0.0123, 'max_degree_centrality': 0.5363, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.038, 'degree_assortativity': -0.1751, 'graph_robustness': 0.8232, 'diameter_estimate': 7, 'clustering_coefficient': 0.2537, 'weakly_connected_components': 55, 'largest_wcc_size': 443, 'pagerank_top10_percent': 6.36, 'louvain_communities': 66, 'louvain_modularity': 0.4293, 'label_entropy': 1.5, 'computational_time': 0.7107104320311919}
2025-11-30 21:30:25,678 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 53, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509425.678294, 'total_time': 24.070731627987698, 'aggregation': 2.609100192785263e-06, 'network_info': 0.008315633982419968, 'llm_extraction': 23.07530862407293, 'data_cleaning': 3.9240927435457706e-05, 'neo4j_injection': 0.27448333508800715, 'embedding_time': 0, 'indexing_time': 0.001530444948002696, 'graph_injection_time': 0.27262572501786053, 'acs_metrics': {'node_count': 497, 'relationship_count': 1516, 'density': 0.0061, 'avg_degree': 6.1006, 'avg_unique_neighbors': 6.0121, 'global_efficiency': 0.3139, 'avg_path_length': 2.7488, 'avg_degree_centrality': 0.0123, 'max_degree_centrality': 0.5363, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.038, 'degree_assortativity': -0.1751, 'graph_robustness': 0.8232, 'diameter_estimate': 7, 'clustering_coefficient': 0.2537, 'weakly_connected_components': 55, 'largest_wcc_size': 443, 'pagerank_top10_percent': 6.36, 'louvain_communities': 66, 'louvain_modularity': 0.4293, 'label_entropy': 1.5, 'computational_time': 0.7107104320311919}, 'retrieval_queries': []}
2025-11-30 21:30:25,678 - src.pipeline.kg_builder - DEBUG - Batch 53 metrics: {
  "batch_idx": 53,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509425.678294,
  "total_time": 24.070731627987698,
  "aggregation": 2.609100192785263e-06,
  "network_info": 0.008315633982419968,
  "llm_extraction": 23.07530862407293,
  "data_cleaning": 3.9240927435457706e-05,
  "neo4j_injection": 0.27448333508800715,
  "embedding_time": 0,
  "indexing_time": 0.001530444948002696,
  "graph_injection_time": 0.27262572501786053,
  "acs_metrics": {
    "node_count": 497,
    "relationship_count": 1516,
    "density": 0.0061,
    "avg_degree": 6.1006,
    "avg_unique_neighbors": 6.0121,
    "global_efficiency": 0.3139,
    "avg_path_length": 2.7488,
    "avg_degree_centrality": 0.0123,
    "max_degree_centrality": 0.5363,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.038,
    "degree_assortativity": -0.1751,
    "graph_robustness": 0.8232,
    "diameter_estimate": 7,
    "clustering_coefficient": 0.2537,
    "weakly_connected_components": 55,
    "largest_wcc_size": 443,
    "pagerank_top10_percent": 6.36,
    "louvain_communities": 66,
    "louvain_modularity": 0.4293,
    "label_entropy": 1.5,
    "computational_time": 0.7107104320311919
  },
  "retrieval_queries": []
}
2025-11-30 21:30:25,679 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:30:25,679 - src.pipeline.kg_builder - INFO - Batch 54 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 23.08s, Clean: 0.00s, Neo4j: 0.27s, ACS: 0.71s
2025-11-30 21:30:25,679 - src.pipeline.kg_builder - INFO - Batch 54 completed in 24.07s
Processing KG batches:  75%|███████▌  | 54/72 [23:28<11:06, 37.03s/it]2025-11-30 21:30:25,679 - src.pipeline.kg_builder - INFO - Processing batch 55/72 (3 items)
2025-11-30 21:30:25,679 - src.pipeline.kg_builder - DEBUG - Batch 55 current_video_time: 13:38-13:43
2025-11-30 21:30:25,690 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 497
- Total Relationships: 482
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:30:25,691 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:30:25,691 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_54_0 ~227 words, content: Time: 13:28-13:33 Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a procedure on a black lab bench. The...
2025-11-30 21:30:25,691 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_54_1 ~225 words, content: with their right hand and a long, translucent pipette with their left. They are carefully inserting the pipette into the beaker, which contains a clear...
2025-11-30 21:30:25,691 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_54_2 ~236 words, content: first-person perspective. A person wearing blue nitrile gloves is holding a long, flexible, translucent tube. They are carefully inserting this tube into a large, clear...
2025-11-30 21:30:25,691 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_54_3 ~77 words, content: a stand. The tube is being used to transfer the white liquid from the beaker into a glass container that is on the white stirrer....
2025-11-30 21:30:25,711 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:30:25,805 - src.components.pre_llm_injector - DEBUG - Found 251 existing chunk embeddings for similarity lookup
2025-11-30 21:30:25,859 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_0', '0.870'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_1', '0.835')]
2025-11-30 21:30:25,861 - src.components.pre_llm_injector - DEBUG - Found 5 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_0
2025-11-30 21:30:25,861 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:30:25,862 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_1
2025-11-30 21:30:25,862 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:30:25,894 - src.components.pre_llm_injector - DEBUG - Limited Person from 145 to 2 external connections
2025-11-30 21:30:25,894 - src.components.pre_llm_injector - DEBUG - Limited Lab from 13 to 2 external connections
2025-11-30 21:30:25,894 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 166 total -> 12 (internal: 6, external: 6)
2025-11-30 21:30:25,894 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[USES]->(Lab / ID: 29_0), (Person / ID: 0_0)-[ADJUSTS]->(Lab / ID: 29_0), (Lab / ID: 29_0)-[CONTAINS]->(Fire_Extinguisher / ID: 29_0), (Background_Person / ID: 29_0)-[STANDS]->(With_Arms_Crossed / ID: 29_0), (Lab / ID: 29_0)-[INCLUDES]->(With_Arms_Crossed / ID: 29_0), (Person / ID: 0_0)-[USES]->(Person / ID: 0_0), (Person / ID: 0_0)-[HANDLES]->(Glass Tube / ID: 33_1), (Person / ID: 0_0)-[HOLDS]->(Translucent Tube / ID: 52_2), (Lab / ID: 29_0)-[CONTAINS]->(Balance / ID: 36_2), (Lab / ID: 29_0)-[CONTAINS]->(White Cabinet / ID: 31_1), (Lab_Room / ID: 29_1)-[CONTAINS]->(Fire_Extinguisher / ID: 29_0), (With_Arms_Crossed / ID: 29_0)-[SUPPORTS]->(Metal Rod / ID: 49_0)
2025-11-30 21:30:25,899 - src.components.pre_llm_injector - DEBUG - Limited Person from 147 to 2 external connections
2025-11-30 21:30:25,899 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 148 total -> 3 (internal: 1, external: 2)
2025-11-30 21:30:25,899 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[USES]->(Person / ID: 0_0), (Person / ID: 0_0)-[WALKS_PAST]->(Laboratory_Equipment / ID: 14_2), (Person / ID: 0_0)-[ADDS_LIQUID_TO]->(Liquid_In_Small_Container / ID: 5_0)
2025-11-30 21:30:25,899 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_3', '0.478'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_0', '0.421')]
2025-11-30 21:30:25,899 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_0', '0.870'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.827')]
2025-11-30 21:30:25,899 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_1', '0.835'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_4', '0.711')]
2025-11-30 21:30:25,899 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_4', '0.819'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_4', '0.788')]
2025-11-30 21:30:25,899 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:30:25,900 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_54_0) (~227 words) with timeout=5.0s retries=3
2025-11-30 21:30:27,289 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:30:27,289 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:30:27,290 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_54_1) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:30:28,280 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:30:28,280 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:30:28,281 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_54_2) (~236 words) with timeout=5.0s retries=3
2025-11-30 21:30:29,718 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:30:29,718 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:30:29,718 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_54_3) (~77 words) with timeout=5.0s retries=3
2025-11-30 21:30:30,723 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:30:30,724 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:30:30,724 - src.components.pre_llm_injector - INFO - Extracted 21 local triplets from 4 chunks
2025-11-30 21:30:30,724 - src.pipeline.kg_builder - INFO - Pre-extraction: 21 triplets in 5.03s
2025-11-30 21:30:30,724 - src.components.global_refiner - INFO - Capping refinement input: 21 → 15 triplets
2025-11-30 21:30:30,725 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[USES]->(Lab / ID: 29_0), (Person / ID: 0_0)-[ADJUSTS]->(Lab / ID: 29_0), (Lab / ID: 29_0)-[CONTAINS]->(Fire_Extinguisher / ID: 29_0), (Background_Person / ID: 29_0)-[STANDS]->(With_Arms_Crossed / ID: 29_0), (Lab / ID: 29_0)-[INCLUDES]->(With_Arms_Crossed / ID: 29_0), (Person / ID: 0_0)-[USES]->(Person / ID: 0_0), (Person / ID: 0_0)-[HANDLES]->(Glass Tube / ID: 33_1), (Person / ID: 0_0)-[HOLDS]->(Translucent Tube / ID: 52_2), (Lab / ID: 29_0)-[CONTAINS]->(Balance / ID: 36_2), (Lab / ID: 29_0)-[CONTAINS]->(White Cabinet / ID: 31_1), (Lab_Room / ID: 29_1)-[CONTAINS]->(Fire_Extinguisher / ID: 29_0), (With_Arms_Crossed / ID: 29_0)-[SUPPORTS]->(Metal Rod / ID: 49_0)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[USES]->(Person / ID: 0_0), (Person / ID: 0_0)-[WALKS_PAST]->(Laboratory_Equipment / ID: 14_2), (Person / ID: 0_0)-[ADDS_LIQUID_TO]->(Liquid_In_Small_Container / ID: 5_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["54_0", "54_2"]}, {"head": "Person", "relation": "Holds", "tail": "Clear_Plastic_Container", "source_chunks": ["54_0"]}, {"head": "Person", "relation": "Holds", "tail": "Long_Translucent_Pipette", "source_chunks": ["54_0"]}, {"head": "Person", "relation": "Performs", "tail": "Procedure", "source_chunks": ["54_0"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Clear_Plastic_Container", "source_chunks": ["54_0"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Long_Translucent_Pipette", "source_chunks": ["54_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["54_1"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["54_1", "54_2"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["54_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["54_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["54_1", "54_3"]}, {"head": "Lab Table", "relation": "Contains", "tail": "Beaker", "source_chunks": ["54_1"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["54_2"]}, {"head": "Translucent_Tube", "relation": "Is Inserted Into", "tail": "Beaker", "source_chunks": ["54_2"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudy_White_Liquid", "source_chunks": ["54_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:30:30,725 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~417 words, ~542 tokens)
2025-11-30 21:30:30,725 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:30:52,132 - src.components.global_refiner - DEBUG - LLM call completed in 21.41s
2025-11-30 21:30:52,132 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['54_0', '54_2']], ['Person', 'Holds', 'Clear_Plastic_Container', ['54_0']], ['Person', 'Holds', 'Long_Translucent_Pipette', ['54_0']], ['Person', 'Performs', 'Procedure', ['54_0']], ['Lab_Bench', 'Contains', 'Clear_Plastic_Container', ['54_0']], ['Lab_Bench', 'Contains', 'Long_Translucent_Pipette', ['54_0']], ['Person', 'Holds', 'Pipette', ['54_1']], ['Person', 'Holds', 'Beaker', ['54_1', '54_2']], ['Pipette', 'Transfers', 'Liquid', ['54_1']], ['Person', 'Uses', 'Pipette', ['54_1']], ['Beaker', 'Contains', 'Liquid', ['54_1', '54_3']], ['Lab Table', 'Contains', 'Beaker', ['54_1']], ['Person', 'Holds', 'Translucent_Tube', ['54_2']], ['Translucent_Tube', 'Is Inserted Into', 'Beaker', ['54_2']], ['Beaker', 'Contains', 'Cloudy_White_Liquid', ['54_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['54_0', '54_2']], ['Person', 'Holds', 'Clear_Plastic_Container', ['54_0']], ['Person', 'Holds', 'Long_Translucent_Pipette', ['54_0']], ['Person', 'Performs', 'Procedure', ['54_0']], ['Lab_Bench', 'Contains', 'Clear_Plastic_Container', ['54_0']], ['Lab_Bench', 'Contains', 'Long_Translucent_Pipette', ['54_0']], ['Person', 'Holds', 'Pipette', ['54_1']], ['Person', 'Holds', 'Beaker', ['54_1', '54_2']], ['Pipette', 'Transfers', 'Liquid', ['54_1']], ['Person', 'Uses', 'Pipette', ['54_1']], ['Beaker', 'Contains', 'Liquid', ['54_1', '54_3']], ['Lab Table', 'Contains', 'Beaker', ['54_1']], ['Person', 'Holds', 'Translucent_Tube', ['54_2']], ['Translucent_Tube', 'Is Inserted Into', 'Beaker', ['54_2']], ['Beaker', 'Contains', 'Cloudy_White_Liquid', ['54_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}, {'local': 'Pipette', 'existing': 'Long_Translucent_Pipette', 'existing_id': '54_0'}, {'local': 'Translucent_Tube', 'existing': 'Glass Tube', 'existing_id': '33_1'}, {'local': 'Beaker', 'existing': 'Liquid_In_Small_Container', 'existing_id': '5_0'}] prune_instructions=[{'head': 'Person', 'relation': 'USES', 'tail': 'Person'}, {'head': 'Person', 'relation': 'HANDLES', 'tail': 'Glass Tube'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Translucent Tube'}, {'head': 'Lab', 'relation': 'CONTAINS', 'tail': 'Fire_Extinguisher'}, {'head': 'Lab', 'relation': 'CONTAINS', 'tail': 'Balance'}, {'head': 'Lab', 'relation': 'CONTAINS', 'tail': 'White Cabinet'}, {'head': 'Lab_Room', 'relation': 'CONTAINS', 'tail': 'Fire_Extinguisher'}, {'head': 'With_Arms_Crossed', 'relation': 'SUPPORTS', 'tail': 'Metal Rod'}, {'head': 'Person', 'relation': 'WALKS_PAST', 'tail': 'Laboratory_Equipment'}, {'head': 'Person', 'relation': 'ADDS_LIQUID_TO', 'tail': 'Liquid_In_Small_Container'}]
2025-11-30 21:30:52,132 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['54_0', '54_2']], ['Person', 'Holds', 'Clear_Plastic_Container', ['54_0']], ['Person', 'Holds', 'Long_Translucent_Pipette', ['54_0']]]
2025-11-30 21:30:52,132 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['54_0', '54_2']], ['Person', 'Holds', 'Clear_Plastic_Container', ['54_0']], ['Person', 'Holds', 'Long_Translucent_Pipette', ['54_0']]]
2025-11-30 21:30:52,132 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}, {'local': 'Pipette', 'existing': 'Long_Translucent_Pipette', 'existing_id': '54_0'}, {'local': 'Translucent_Tube', 'existing': 'Glass Tube', 'existing_id': '33_1'}]
2025-11-30 21:30:52,132 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=10, sample=[{'head': 'Person', 'relation': 'USES', 'tail': 'Person'}, {'head': 'Person', 'relation': 'HANDLES', 'tail': 'Glass Tube'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Translucent Tube'}]
2025-11-30 21:30:52,132 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_3'}, {'local': 'Pipette', 'existing': 'Long_Translucent_Pipette', 'existing_id': '54_0'}, {'local': 'Translucent_Tube', 'existing': 'Glass Tube', 'existing_id': '33_1'}, {'local': 'Beaker', 'existing': 'Liquid_In_Small_Container', 'existing_id': '5_0'}]
2025-11-30 21:30:52,132 - src.components.global_refiner - INFO - LLM suggested 10 triplets to prune: [{'head': 'Person', 'relation': 'USES', 'tail': 'Person'}, {'head': 'Person', 'relation': 'HANDLES', 'tail': 'Glass Tube'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Translucent Tube'}, {'head': 'Lab', 'relation': 'CONTAINS', 'tail': 'Fire_Extinguisher'}, {'head': 'Lab', 'relation': 'CONTAINS', 'tail': 'Balance'}, {'head': 'Lab', 'relation': 'CONTAINS', 'tail': 'White Cabinet'}, {'head': 'Lab_Room', 'relation': 'CONTAINS', 'tail': 'Fire_Extinguisher'}, {'head': 'With_Arms_Crossed', 'relation': 'SUPPORTS', 'tail': 'Metal Rod'}, {'head': 'Person', 'relation': 'WALKS_PAST', 'tail': 'Laboratory_Equipment'}, {'head': 'Person', 'relation': 'ADDS_LIQUID_TO', 'tail': 'Liquid_In_Small_Container'}]
2025-11-30 21:30:52,132 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 30 triplets (total: 21.41s, LLM: 21.41s)
2025-11-30 21:30:52,132 - src.pipeline.kg_builder - INFO - Global refinement: 30 triplets in 21.41s
2025-11-30 21:30:52,132 - src.pipeline.kg_builder - INFO - Using 30 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:30:52,132 - src.pipeline.kg_builder - INFO - Pushing batch 55/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:30:52,133 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:30:52,332 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=506, relationships=490
2025-11-30 21:30:52,332 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:30:52,333 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Nitrile Gloves
2025-11-30 21:30:52,338 - src.components.neo4j_handler - DEBUG - APOC merge successful: Pipette -> Long_Translucent_Pipette
2025-11-30 21:30:52,342 - src.components.neo4j_handler - DEBUG - APOC merge successful: Translucent_Tube -> Glass Tube
2025-11-30 21:30:52,345 - src.components.neo4j_handler - DEBUG - APOC merge successful: Beaker -> Liquid_In_Small_Container
2025-11-30 21:30:52,346 - src.components.neo4j_handler - INFO - Applying 10 prune instructions
2025-11-30 21:30:52,353 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[USES]-> Person
2025-11-30 21:30:52,355 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[HANDLES]-> Glass Tube
2025-11-30 21:30:52,357 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[HOLDS]-> Translucent Tube
2025-11-30 21:30:52,359 - src.components.neo4j_handler - DEBUG - Pruned relationship: Lab -[CONTAINS]-> Fire_Extinguisher
2025-11-30 21:30:52,360 - src.components.neo4j_handler - DEBUG - Pruned relationship: Lab -[CONTAINS]-> Balance
2025-11-30 21:30:52,363 - src.components.neo4j_handler - DEBUG - Pruned relationship: Lab -[CONTAINS]-> White Cabinet
2025-11-30 21:30:52,364 - src.components.neo4j_handler - DEBUG - Pruned relationship: Lab_Room -[CONTAINS]-> Fire_Extinguisher
2025-11-30 21:30:52,390 - src.components.neo4j_handler - DEBUG - Pruned relationship: With_Arms_Crossed -[SUPPORTS]-> Metal Rod
2025-11-30 21:30:52,414 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[WALKS_PAST]-> Laboratory_Equipment
2025-11-30 21:30:52,441 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[ADDS_LIQUID_TO]-> Liquid_In_Small_Container
2025-11-30 21:30:52,441 - src.components.neo4j_handler - INFO - Applying 15 inter-chunk relations
2025-11-30 21:30:52,442 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:30:52,444 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Clear_Plastic_Container
2025-11-30 21:30:52,446 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Long_Translucent_Pipette
2025-11-30 21:30:52,447 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Performs]-> Procedure
2025-11-30 21:30:52,449 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab_Bench -[Contains]-> Clear_Plastic_Container
2025-11-30 21:30:52,451 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab_Bench -[Contains]-> Long_Translucent_Pipette
2025-11-30 21:30:52,452 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Pipette
2025-11-30 21:30:52,453 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Beaker
2025-11-30 21:30:52,454 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Pipette -[Transfers]-> Liquid
2025-11-30 21:30:52,454 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Uses]-> Pipette
2025-11-30 21:30:52,455 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Contains]-> Liquid
2025-11-30 21:30:52,455 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Lab Table -[Contains]-> Beaker
2025-11-30 21:30:52,456 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Translucent_Tube
2025-11-30 21:30:52,476 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Translucent_Tube -[Is Inserted Into]-> Beaker
2025-11-30 21:30:52,477 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Contains]-> Cloudy_White_Liquid
2025-11-30 21:30:52,478 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:30:52,483 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=502, relationships=480
2025-11-30 21:30:52,485 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:30:52,485 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:30:52,486 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:30:52,486 - src.components.neo4j_handler - INFO - Batch injected in 0.35s (triplets: 0.35s, indexes: 0.00s)
2025-11-30 21:30:52,487 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 255, 'with_embedding': 255, 'linked_chunks': 201}
2025-11-30 21:30:52,487 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:30:52,526 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:30:52,795 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 448 nodes
2025-11-30 21:30:52,825 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 502, 'relationship_count': 1525, 'density': 0.0061, 'avg_degree': 6.0757, 'avg_unique_neighbors': 5.992, 'global_efficiency': 0.2996, 'avg_path_length': 2.75, 'avg_degree_centrality': 0.0121, 'max_degree_centrality': 0.5269, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0355, 'degree_assortativity': -0.1748, 'graph_robustness': 0.8433, 'diameter_estimate': 50, 'clustering_coefficient': 0.2535, 'weakly_connected_components': 55, 'largest_wcc_size': 448, 'pagerank_top10_percent': 6.31, 'louvain_communities': 65, 'louvain_modularity': 0.4247, 'label_entropy': 1.4999, 'computational_time': 0.3387301890179515}
2025-11-30 21:30:52,826 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 54, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509452.8260949, 'total_time': 27.146491692052223, 'aggregation': 2.7599744498729706e-06, 'network_info': 0.011033114045858383, 'llm_extraction': 26.442034400999546, 'data_cleaning': 3.8672005757689476e-05, 'neo4j_injection': 0.35315603704657406, 'embedding_time': 0, 'indexing_time': 0.002251056954264641, 'graph_injection_time': 0.35061523597687483, 'acs_metrics': {'node_count': 502, 'relationship_count': 1525, 'density': 0.0061, 'avg_degree': 6.0757, 'avg_unique_neighbors': 5.992, 'global_efficiency': 0.2996, 'avg_path_length': 2.75, 'avg_degree_centrality': 0.0121, 'max_degree_centrality': 0.5269, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0355, 'degree_assortativity': -0.1748, 'graph_robustness': 0.8433, 'diameter_estimate': 50, 'clustering_coefficient': 0.2535, 'weakly_connected_components': 55, 'largest_wcc_size': 448, 'pagerank_top10_percent': 6.31, 'louvain_communities': 65, 'louvain_modularity': 0.4247, 'label_entropy': 1.4999, 'computational_time': 0.3387301890179515}, 'retrieval_queries': []}
2025-11-30 21:30:52,826 - src.pipeline.kg_builder - DEBUG - Batch 54 metrics: {
  "batch_idx": 54,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509452.8260949,
  "total_time": 27.146491692052223,
  "aggregation": 2.7599744498729706e-06,
  "network_info": 0.011033114045858383,
  "llm_extraction": 26.442034400999546,
  "data_cleaning": 3.8672005757689476e-05,
  "neo4j_injection": 0.35315603704657406,
  "embedding_time": 0,
  "indexing_time": 0.002251056954264641,
  "graph_injection_time": 0.35061523597687483,
  "acs_metrics": {
    "node_count": 502,
    "relationship_count": 1525,
    "density": 0.0061,
    "avg_degree": 6.0757,
    "avg_unique_neighbors": 5.992,
    "global_efficiency": 0.2996,
    "avg_path_length": 2.75,
    "avg_degree_centrality": 0.0121,
    "max_degree_centrality": 0.5269,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0355,
    "degree_assortativity": -0.1748,
    "graph_robustness": 0.8433,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2535,
    "weakly_connected_components": 55,
    "largest_wcc_size": 448,
    "pagerank_top10_percent": 6.31,
    "louvain_communities": 65,
    "louvain_modularity": 0.4247,
    "label_entropy": 1.4999,
    "computational_time": 0.3387301890179515
  },
  "retrieval_queries": []
}
2025-11-30 21:30:52,827 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:30:52,827 - src.pipeline.kg_builder - INFO - Batch 55 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 26.44s, Clean: 0.00s, Neo4j: 0.35s, ACS: 0.34s
2025-11-30 21:30:52,827 - src.pipeline.kg_builder - INFO - Batch 55 completed in 27.15s
Processing KG batches:  76%|███████▋  | 55/72 [23:55<09:39, 34.06s/it]2025-11-30 21:30:52,827 - src.pipeline.kg_builder - INFO - Processing batch 56/72 (3 items)
2025-11-30 21:30:52,827 - src.pipeline.kg_builder - DEBUG - Batch 56 current_video_time: 13:53-13:58
2025-11-30 21:30:52,833 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 502
- Total Relationships: 480
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:30:52,833 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:30:52,833 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_55_0 ~233 words, content: Time: 13:43-13:48 Content: The sequence of images captures a laboratory procedure involving the transfer of a liquid using a pipette. The setting is a well-equipped...
2025-11-30 21:30:52,833 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_55_1 ~243 words, content: Content: The video sequence captures a scientific experiment being conducted in a laboratory setting. The scene begins with a close-up view of a person's hands,...
2025-11-30 21:30:52,833 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_55_2 ~222 words, content: is one of focused concentration, with the individual fully engaged in the task at hand. The video effectively conveys the meticulous nature of laboratory work,...
2025-11-30 21:30:52,833 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_55_3 ~115 words, content: lab environment, including the glass cabinet and other equipment, remains visible, providing context for the experiment. - **Introduction of the Scientist (Frame 4):** A person...
2025-11-30 21:30:52,853 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:30:52,949 - src.components.pre_llm_injector - DEBUG - Found 255 existing chunk embeddings for similarity lookup
2025-11-30 21:30:53,006 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_0', '0.872'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.839')]
2025-11-30 21:30:53,008 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0
2025-11-30 21:30:53,008 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:30:53,008 - src.components.pre_llm_injector - DEBUG - Found 6 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_0
2025-11-30 21:30:53,008 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:30:53,042 - src.components.pre_llm_injector - DEBUG - Limited Person from 145 to 2 external connections
2025-11-30 21:30:53,042 - src.components.pre_llm_injector - DEBUG - Limited Smartphone from 4 to 2 external connections
2025-11-30 21:30:53,042 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 153 total -> 8 (internal: 2, external: 6)
2025-11-30 21:30:53,042 - src.components.pre_llm_injector - DEBUG - Subgraph: (Laboratory Table / ID: 0_0)-[CONTAINS]->(Red-Capped Bottle / ID: 0_0), (Person / ID: 0_0)-[HOLDS]->(Smartphone / ID: 0_0), (Person / ID: 0_0)-[WEARS]->(Blue Glove / ID: 33_0), (Person / ID: 0_0)-[HOLDS]->(Liquid_In_Small_Container / ID: 5_0), (Laboratory Table / ID: 0_0)-[CONTAINS]->(Lab_Room / ID: 29_1), (Laboratory Table / ID: 0_0)-[CONTAINS]->(Equipment / ID: 1_0), (Smartphone / ID: 0_0)-[STIRS]->(Mass Of Liquid / ID: 15_1), (Smartphone / ID: 0_0)-[STIRS]->(Glass Tube / ID: 33_1)
2025-11-30 21:30:53,045 - src.components.pre_llm_injector - DEBUG - Limited Person from 145 to 2 external connections
2025-11-30 21:30:53,045 - src.components.pre_llm_injector - DEBUG - Limited Magnetic_Stirrer from 14 to 2 external connections
2025-11-30 21:30:53,045 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 160 total -> 5 (internal: 1, external: 4)
2025-11-30 21:30:53,045 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[INTERACTS_WITH]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[CHECKS]->(Meniscus / ID: 30_0), (Person / ID: 0_0)-[USES]->(White Cylindrical Device / ID: 45_2), (Magnetic_Stirrer / ID: 4_2)-[MIXES]->(Contents / ID: 36_1), (Liquid_In_Small_Container / ID: 5_0)-[IS_ON]->(Magnetic_Stirrer / ID: 4_2)
2025-11-30 21:30:53,045 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_0_0', '0.872'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_4', '0.681')]
2025-11-30 21:30:53,045 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_1', '0.656'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_22_0', '0.629')]
2025-11-30 21:30:53,045 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.839'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.751')]
2025-11-30 21:30:53,045 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_33_4', '0.802'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_2', '0.778')]
2025-11-30 21:30:53,045 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:30:53,046 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_55_0) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:30:54,319 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:30:54,319 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:30:54,319 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_55_1) (~243 words) with timeout=5.0s retries=3
2025-11-30 21:30:55,755 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:30:55,755 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:30:55,756 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_55_2) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:30:57,079 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:30:57,079 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:30:57,079 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_55_3) (~115 words) with timeout=5.0s retries=3
2025-11-30 21:30:58,219 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:30:58,220 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:30:58,220 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 4 chunks
2025-11-30 21:30:58,220 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 5.39s
2025-11-30 21:30:58,220 - src.components.global_refiner - INFO - Capping refinement input: 22 → 15 triplets
2025-11-30 21:30:58,221 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Laboratory Table / ID: 0_0)-[CONTAINS]->(Red-Capped Bottle / ID: 0_0), (Person / ID: 0_0)-[HOLDS]->(Smartphone / ID: 0_0), (Person / ID: 0_0)-[WEARS]->(Blue Glove / ID: 33_0), (Person / ID: 0_0)-[HOLDS]->(Liquid_In_Small_Container / ID: 5_0), (Laboratory Table / ID: 0_0)-[CONTAINS]->(Lab_Room / ID: 29_1), (Laboratory Table / ID: 0_0)-[CONTAINS]->(Equipment / ID: 1_0), (Smartphone / ID: 0_0)-[STIRS]->(Mass Of Liquid / ID: 15_1), (Smartphone / ID: 0_0)-[STIRS]->(Glass Tube / ID: 33_1)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[INTERACTS_WITH]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[CHECKS]->(Meniscus / ID: 30_0), (Person / ID: 0_0)-[USES]->(White Cylindrical Device / ID: 45_2), (Magnetic_Stirrer / ID: 4_2)-[MIXES]->(Contents / ID: 36_1), (Liquid_In_Small_Container / ID: 5_0)-[IS_ON]->(Magnetic_Stirrer / ID: 4_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["55_0", "55_1", "55_2"]}, {"head": "Person", "relation": "Wears", "tail": "Watch", "source_chunks": ["55_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["55_0"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["55_0"]}, {"head": "Liquid", "relation": "Is In", "tail": "Glass_Beaker", "source_chunks": ["55_0"]}, {"head": "Glass_Beaker", "relation": "Is On", "tail": "Magnetic_Stirrer", "source_chunks": ["55_0"]}, {"head": "Person", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["55_1"]}, {"head": "Liquid", "relation": "Is In", "tail": "Glass_Flask", "source_chunks": ["55_1"]}, {"head": "Glass_Flask", "relation": "Is On", "tail": "Magnetic_Stirrer", "source_chunks": ["55_1"]}, {"head": "Magnetic_Stirrer", "relation": "Rotates", "tail": "Stir_Bar", "source_chunks": ["55_1"]}, {"head": "Glass_Flask", "relation": "Contains", "tail": "Liquid", "source_chunks": ["55_1"]}, {"head": "Person", "relation": "Holds", "tail": "Container", "source_chunks": ["55_2"]}, {"head": "Container", "relation": "Contains", "tail": "Substance", "source_chunks": ["55_2"]}, {"head": "Glass_Flask", "relation": "Is On", "tail": "Magnetic_Stirrer", "source_chunks": ["55_2"]}, {"head": "Magnetic_Stirrer", "relation": "Mixes", "tail": "Contents", "source_chunks": ["55_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:30:58,221 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~410 words, ~533 tokens)
2025-11-30 21:30:58,221 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:31:12,593 - src.components.global_refiner - DEBUG - LLM call completed in 14.37s
2025-11-30 21:31:12,593 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['55_0', '55_1', '55_2']], ['Person', 'Wears', 'Watch', ['55_0']], ['Person', 'Uses', 'Pipette', ['55_0']], ['Pipette', 'Transfers', 'Liquid', ['55_0']], ['Liquid', 'Is In', 'Glass_Beaker', ['55_0']], ['Glass_Beaker', 'Is On', 'Magnetic_Stirrer', ['55_0']], ['Person', 'Transfers', 'Liquid', ['55_1']], ['Liquid', 'Is In', 'Glass_Flask', ['55_1']], ['Glass_Flask', 'Is On', 'Magnetic_Stirrer', ['55_1']], ['Magnetic_Stirrer', 'Rotates', 'Stir_Bar', ['55_1']], ['Glass_Flask', 'Contains', 'Liquid', ['55_1']], ['Person', 'Holds', 'Container', ['55_2']], ['Container', 'Contains', 'Substance', ['55_2']], ['Glass_Flask', 'Is On', 'Magnetic_Stirrer', ['55_2']], ['Magnetic_Stirrer', 'Mixes', 'Contents', ['55_2']]] inter_chunk_relations=[['Glass_Beaker', 'Is On', 'Magnetic_Stirrer', ['55_0']], ['Glass_Flask', 'Is On', 'Magnetic_Stirrer', ['55_1', '55_2']], ['Magnetic_Stirrer', 'Mixes', 'Contents', ['55_2']], ['Person', 'Uses', 'White Cylindrical Device', ['55_0']], ['Person', 'Checks', 'Meniscus', ['55_0']], ['Person', 'Interacts With', 'Magnetic_Stirrer', ['55_0']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '33_0'}, {'local': 'Pipette', 'existing': 'Equipment', 'existing_id': '1_0'}, {'local': 'Glass_Beaker', 'existing': 'Liquid_In_Small_Container', 'existing_id': '5_0'}, {'local': 'Glass_Flask', 'existing': 'Liquid_In_Small_Container', 'existing_id': '5_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Liquid_In_Small_Container'}, {'head': 'Smartphone', 'relation': 'STIRS', 'tail': 'Mass Of Liquid'}, {'head': 'Smartphone', 'relation': 'STIRS', 'tail': 'Glass Tube'}]
2025-11-30 21:31:12,594 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['55_0', '55_1', '55_2']], ['Person', 'Wears', 'Watch', ['55_0']], ['Person', 'Uses', 'Pipette', ['55_0']]]
2025-11-30 21:31:12,594 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=6, sample=[['Glass_Beaker', 'Is On', 'Magnetic_Stirrer', ['55_0']], ['Glass_Flask', 'Is On', 'Magnetic_Stirrer', ['55_1', '55_2']], ['Magnetic_Stirrer', 'Mixes', 'Contents', ['55_2']]]
2025-11-30 21:31:12,594 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '33_0'}, {'local': 'Pipette', 'existing': 'Equipment', 'existing_id': '1_0'}, {'local': 'Glass_Beaker', 'existing': 'Liquid_In_Small_Container', 'existing_id': '5_0'}]
2025-11-30 21:31:12,594 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Liquid_In_Small_Container'}, {'head': 'Smartphone', 'relation': 'STIRS', 'tail': 'Mass Of Liquid'}]
2025-11-30 21:31:12,594 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '33_0'}, {'local': 'Pipette', 'existing': 'Equipment', 'existing_id': '1_0'}, {'local': 'Glass_Beaker', 'existing': 'Liquid_In_Small_Container', 'existing_id': '5_0'}, {'local': 'Glass_Flask', 'existing': 'Liquid_In_Small_Container', 'existing_id': '5_0'}]
2025-11-30 21:31:12,594 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Liquid_In_Small_Container'}, {'head': 'Smartphone', 'relation': 'STIRS', 'tail': 'Mass Of Liquid'}, {'head': 'Smartphone', 'relation': 'STIRS', 'tail': 'Glass Tube'}]
2025-11-30 21:31:12,594 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 21 triplets (total: 14.37s, LLM: 14.37s)
2025-11-30 21:31:12,594 - src.pipeline.kg_builder - INFO - Global refinement: 21 triplets in 14.37s
2025-11-30 21:31:12,594 - src.pipeline.kg_builder - INFO - Using 21 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:31:12,594 - src.pipeline.kg_builder - INFO - Pushing batch 56/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:31:12,594 - src.components.neo4j_handler - INFO - Adding 17 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:31:12,766 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=511, relationships=491
2025-11-30 21:31:12,766 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:31:12,766 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Glove
2025-11-30 21:31:12,771 - src.components.neo4j_handler - DEBUG - APOC merge successful: Pipette -> Equipment
2025-11-30 21:31:12,775 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass_Beaker -> Liquid_In_Small_Container
2025-11-30 21:31:12,780 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass_Flask -> Liquid_In_Small_Container
2025-11-30 21:31:12,780 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:31:12,786 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Glove
2025-11-30 21:31:12,788 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Liquid_In_Small_Container
2025-11-30 21:31:12,790 - src.components.neo4j_handler - DEBUG - Pruned relationship: Smartphone -[STIRS]-> Mass Of Liquid
2025-11-30 21:31:12,791 - src.components.neo4j_handler - DEBUG - Pruned relationship: Smartphone -[STIRS]-> Glass Tube
2025-11-30 21:31:12,791 - src.components.neo4j_handler - INFO - Applying 6 inter-chunk relations
2025-11-30 21:31:12,792 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Glass_Beaker -[Is On]-> Magnetic_Stirrer
2025-11-30 21:31:12,824 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Glass_Flask -[Is On]-> Magnetic_Stirrer
2025-11-30 21:31:12,856 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Magnetic_Stirrer -[Mixes]-> Contents
2025-11-30 21:31:12,857 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> White Cylindrical Device
2025-11-30 21:31:12,859 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Checks]-> Meniscus
2025-11-30 21:31:12,861 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Interacts With]-> Magnetic_Stirrer
2025-11-30 21:31:12,862 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:31:12,867 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=507, relationships=481
2025-11-30 21:31:12,869 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:31:12,869 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:31:12,869 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:31:12,869 - src.components.neo4j_handler - INFO - Batch injected in 0.27s (triplets: 0.27s, indexes: 0.00s)
2025-11-30 21:31:12,870 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 259, 'with_embedding': 259, 'linked_chunks': 204}
2025-11-30 21:31:12,870 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:31:12,928 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:31:13,218 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 452 nodes
2025-11-30 21:31:13,248 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 507, 'relationship_count': 1544, 'density': 0.006, 'avg_degree': 6.0907, 'avg_unique_neighbors': 6.0, 'global_efficiency': 0.3174, 'avg_path_length': 2.7486, 'avg_degree_centrality': 0.012, 'max_degree_centrality': 0.5257, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0469, 'degree_assortativity': -0.1747, 'graph_robustness': 0.8653, 'diameter_estimate': 50, 'clustering_coefficient': 0.254, 'weakly_connected_components': 56, 'largest_wcc_size': 452, 'pagerank_top10_percent': 6.23, 'louvain_communities': 69, 'louvain_modularity': 0.4031, 'label_entropy': 1.4998, 'computational_time': 0.3777020969428122}
2025-11-30 21:31:13,248 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 55, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509473.2484496, 'total_time': 20.42097468895372, 'aggregation': 2.8060749173164368e-06, 'network_info': 0.00546797108836472, 'llm_extraction': 19.761451981030405, 'data_cleaning': 3.8180965930223465e-05, 'neo4j_injection': 0.27476257598027587, 'embedding_time': 0, 'indexing_time': 0.001598430098965764, 'graph_injection_time': 0.27280887798406184, 'acs_metrics': {'node_count': 507, 'relationship_count': 1544, 'density': 0.006, 'avg_degree': 6.0907, 'avg_unique_neighbors': 6.0, 'global_efficiency': 0.3174, 'avg_path_length': 2.7486, 'avg_degree_centrality': 0.012, 'max_degree_centrality': 0.5257, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0469, 'degree_assortativity': -0.1747, 'graph_robustness': 0.8653, 'diameter_estimate': 50, 'clustering_coefficient': 0.254, 'weakly_connected_components': 56, 'largest_wcc_size': 452, 'pagerank_top10_percent': 6.23, 'louvain_communities': 69, 'louvain_modularity': 0.4031, 'label_entropy': 1.4998, 'computational_time': 0.3777020969428122}, 'retrieval_queries': []}
2025-11-30 21:31:13,248 - src.pipeline.kg_builder - DEBUG - Batch 55 metrics: {
  "batch_idx": 55,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509473.2484496,
  "total_time": 20.42097468895372,
  "aggregation": 2.8060749173164368e-06,
  "network_info": 0.00546797108836472,
  "llm_extraction": 19.761451981030405,
  "data_cleaning": 3.8180965930223465e-05,
  "neo4j_injection": 0.27476257598027587,
  "embedding_time": 0,
  "indexing_time": 0.001598430098965764,
  "graph_injection_time": 0.27280887798406184,
  "acs_metrics": {
    "node_count": 507,
    "relationship_count": 1544,
    "density": 0.006,
    "avg_degree": 6.0907,
    "avg_unique_neighbors": 6.0,
    "global_efficiency": 0.3174,
    "avg_path_length": 2.7486,
    "avg_degree_centrality": 0.012,
    "max_degree_centrality": 0.5257,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0469,
    "degree_assortativity": -0.1747,
    "graph_robustness": 0.8653,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.254,
    "weakly_connected_components": 56,
    "largest_wcc_size": 452,
    "pagerank_top10_percent": 6.23,
    "louvain_communities": 69,
    "louvain_modularity": 0.4031,
    "label_entropy": 1.4998,
    "computational_time": 0.3777020969428122
  },
  "retrieval_queries": []
}
2025-11-30 21:31:13,249 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:31:13,249 - src.pipeline.kg_builder - INFO - Batch 56 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 19.76s, Clean: 0.00s, Neo4j: 0.27s, ACS: 0.38s
2025-11-30 21:31:13,249 - src.pipeline.kg_builder - INFO - Batch 56 completed in 20.42s
Processing KG batches:  78%|███████▊  | 56/72 [24:16<07:59, 29.97s/it]2025-11-30 21:31:13,249 - src.pipeline.kg_builder - INFO - Processing batch 57/72 (3 items)
2025-11-30 21:31:13,249 - src.pipeline.kg_builder - DEBUG - Batch 57 current_video_time: 14:07-14:12
2025-11-30 21:31:13,255 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 507
- Total Relationships: 481
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:31:13,256 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:31:13,256 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_56_0 ~236 words, content: Time: 13:58-14:03 Content: The video captures a sequence of actions in a laboratory setting, focusing on a chemical experiment. The scene is set on a...
2025-11-30 21:31:13,256 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_56_1 ~223 words, content: , likely the preparation of a chemical solution or the initiation of a reaction that requires controlled conditions, such as heating and reflux. The person's...
2025-11-30 21:31:13,256 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_56_2 ~238 words, content: a closer, first-person perspective, showing a person's hands wearing blue nitrile gloves. The person is actively handling a white plastic beaker. The long tube from...
2025-11-30 21:31:13,256 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_56_3 ~255 words, content: with a clamp is visible to the left. - The second frame provides a closer view of the container and the tube. The person's hand...
2025-11-30 21:31:13,256 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_56_4 ~21 words, content:  is using a yellow apparatus with multiple tubes and clamps. The lab is well-equipped with various pieces of equipment and supplies.
2025-11-30 21:31:13,276 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:31:13,374 - src.components.pre_llm_injector - DEBUG - Found 259 existing chunk embeddings for similarity lookup
2025-11-30 21:31:13,442 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_1', '0.872'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_1', '0.725')]
2025-11-30 21:31:13,444 - src.components.pre_llm_injector - DEBUG - Found 4 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_1
2025-11-30 21:31:13,444 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:31:13,445 - src.components.pre_llm_injector - DEBUG - Found 4 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_1
2025-11-30 21:31:13,445 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:31:13,477 - src.components.pre_llm_injector - DEBUG - Limited Person from 142 to 2 external connections
2025-11-30 21:31:13,477 - src.components.pre_llm_injector - DEBUG - Limited Laboratory from 9 to 2 external connections
2025-11-30 21:31:13,477 - src.components.pre_llm_injector - DEBUG - Limited Balance Scale Enclosure from 3 to 2 external connections
2025-11-30 21:31:13,477 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 155 total -> 7 (internal: 0, external: 7)
2025-11-30 21:31:13,477 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(Clear_Plastic_Container / ID: 51_2), (Person / ID: 0_0)-[PLACES]->(Vial / ID: 34_2), (Laboratory / ID: 0_1)-[CONTAINS]->(Materials / ID: 48_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance_Scale / ID: 0_1), (Equipment / ID: 1_0)-[CONTAINS]->(General Reagent / ID: 6_1), (Balance Scale Enclosure / ID: 6_1)-[DISPLAYS]->(20.20 / ID: 9_0), (Balance Scale Enclosure / ID: 6_1)-[DISPLAYS]->(20.23 / ID: 9_0)
2025-11-30 21:31:13,480 - src.components.pre_llm_injector - DEBUG - Limited Person from 135 to 2 external connections
2025-11-30 21:31:13,480 - src.components.pre_llm_injector - DEBUG - Limited Graduated Cylinder from 13 to 2 external connections
2025-11-30 21:31:13,480 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 155 total -> 11 (internal: 7, external: 4)
2025-11-30 21:31:13,480 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[MAKES]->(Final Adjustments / ID: 42_1), (Person / ID: 0_0)-[HOLDS]->(Graduated Cylinder / ID: 41_1), (Person / ID: 0_0)-[CLOSES]->(Graduated Cylinder / ID: 41_1), (Person / ID: 0_0)-[OBSERVES]->(Graduated Cylinder / ID: 41_1), (Person / ID: 0_0)-[HOLDS]->(Graduated Cylinder / ID: 41_1), (Person / ID: 0_0)-[WEARS]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[WEARS]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[MANIPULATES]->(Liquid_In_Small_Container / ID: 5_0), (Person / ID: 0_0)-[USES]->(Metal_Stand / ID: 46_1), (Graduated Cylinder / ID: 41_1)-[HOLDS]->(Pens And Tools / ID: 50_2), (Graduated Cylinder / ID: 41_1)-[CONTAINS]->(Mass Of Liquid / ID: 15_1)
2025-11-30 21:31:13,480 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_1', '0.725'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_1', '0.656')]
2025-11-30 21:31:13,480 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_22_0', '0.680'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_2', '0.672')]
2025-11-30 21:31:13,480 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_1', '0.872'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_53_0', '0.707')]
2025-11-30 21:31:13,480 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_3', '0.658'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_9_2', '0.637')]
2025-11-30 21:31:13,480 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_3', '0.687'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3', '0.666')]
2025-11-30 21:31:13,480 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:31:13,481 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_56_0) (~236 words) with timeout=5.0s retries=3
2025-11-30 21:31:14,876 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:31:14,876 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:31:14,876 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_56_1) (~223 words) with timeout=5.0s retries=3
2025-11-30 21:31:16,382 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:31:16,382 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:31:16,382 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_56_2) (~238 words) with timeout=5.0s retries=3
2025-11-30 21:31:17,891 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:31:17,891 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:31:17,891 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_56_3) (~255 words) with timeout=5.0s retries=3
2025-11-30 21:31:19,015 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:31:19,015 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:31:19,015 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_56_4) (~21 words) with timeout=5.0s retries=3
2025-11-30 21:31:20,112 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:31:20,112 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:31:20,112 - src.components.pre_llm_injector - INFO - Extracted 29 local triplets from 5 chunks
2025-11-30 21:31:20,112 - src.pipeline.kg_builder - INFO - Pre-extraction: 29 triplets in 6.86s
2025-11-30 21:31:20,113 - src.components.global_refiner - INFO - Capping refinement input: 29 → 15 triplets
2025-11-30 21:31:20,113 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[HOLDS]->(Clear_Plastic_Container / ID: 51_2), (Person / ID: 0_0)-[PLACES]->(Vial / ID: 34_2), (Laboratory / ID: 0_1)-[CONTAINS]->(Materials / ID: 48_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Balance_Scale / ID: 0_1), (Equipment / ID: 1_0)-[CONTAINS]->(General Reagent / ID: 6_1), (Balance Scale Enclosure / ID: 6_1)-[DISPLAYS]->(20.20 / ID: 9_0), (Balance Scale Enclosure / ID: 6_1)-[DISPLAYS]->(20.23 / ID: 9_0)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[MAKES]->(Final Adjustments / ID: 42_1), (Person / ID: 0_0)-[HOLDS]->(Graduated Cylinder / ID: 41_1), (Person / ID: 0_0)-[CLOSES]->(Graduated Cylinder / ID: 41_1), (Person / ID: 0_0)-[OBSERVES]->(Graduated Cylinder / ID: 41_1), (Person / ID: 0_0)-[HOLDS]->(Graduated Cylinder / ID: 41_1), (Person / ID: 0_0)-[WEARS]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[WEARS]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[MANIPULATES]->(Liquid_In_Small_Container / ID: 5_0), (Person / ID: 0_0)-[USES]->(Metal_Stand / ID: 46_1), (Graduated Cylinder / ID: 41_1)-[HOLDS]->(Pens And Tools / ID: 50_2), (Graduated Cylinder / ID: 41_1)-[CONTAINS]->(Mass Of Liquid / ID: 15_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["56_0"]}, {"head": "Person", "relation": "Pours", "tail": "Clear Liquid", "source_chunks": ["56_0"]}, {"head": "Clear Liquid", "relation": "Flows Into", "tail": "Translucent Container", "source_chunks": ["56_0"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Heated Magnetic Stirrer", "source_chunks": ["56_0"]}, {"head": "Reflux Condenser", "relation": "Is Above", "tail": "Glass Flask", "source_chunks": ["56_0"]}, {"head": "Glass Flask", "relation": "Is Connected To", "tail": "Reflux Condenser", "source_chunks": ["56_0"]}, {"head": "Person", "relation": "Wears", "tail": "Gloves", "source_chunks": ["56_1"]}, {"head": "Reaction Apparatus", "relation": "Contains", "tail": "Round_Bottom_Flask", "source_chunks": ["56_1"]}, {"head": "Round_Bottom_Flask", "relation": "Is Connected To", "tail": "Schlenk_Line", "source_chunks": ["56_1"]}, {"head": "Magnetic_Stirrer", "relation": "Is On", "tail": "Hot_Plate", "source_chunks": ["56_1"]}, {"head": "Lab_Table", "relation": "Contains", "tail": "Reaction_Apparatus", "source_chunks": ["56_1"]}, {"head": "Person", "relation": "Performs", "tail": "Scientific_Procedure", "source_chunks": ["56_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["56_2"]}, {"head": "Person", "relation": "Holds", "tail": "White_Plastic_Beaker", "source_chunks": ["56_2"]}, {"head": "Long_Tube", "relation": "Delivers", "tail": "Liquid", "source_chunks": ["56_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:31:20,113 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~469 words, ~610 tokens)
2025-11-30 21:31:20,113 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:31:37,178 - src.components.global_refiner - DEBUG - LLM call completed in 17.07s
2025-11-30 21:31:37,178 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue Nitrile Gloves', ['56_0']], ['Person', 'Pours', 'Clear Liquid', ['56_0']], ['Clear Liquid', 'Flows Into', 'Translucent Container', ['56_0']], ['Glass Flask', 'Is On', 'Heated Magnetic Stirrer', ['56_0']], ['Reflux Condenser', 'Is Above', 'Glass Flask', ['56_0']], ['Glass Flask', 'Is Connected To', 'Reflux Condenser', ['56_0']], ['Person', 'Wears', 'Gloves', ['56_1']], ['Reaction Apparatus', 'Contains', 'Round_Bottom_Flask', ['56_1']], ['Round_Bottom_Flask', 'Is Connected To', 'Schlenk_Line', ['56_1']], ['Magnetic_Stirrer', 'Is On', 'Hot_Plate', ['56_1']], ['Lab_Table', 'Contains', 'Reaction_Apparatus', ['56_1']], ['Person', 'Performs', 'Scientific_Procedure', ['56_1']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['56_2']], ['Person', 'Holds', 'White_Plastic_Beaker', ['56_2']], ['Long_Tube', 'Delivers', 'Liquid', ['56_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue Nitrile Gloves', ['56_0']], ['Person', 'Wears', 'Blue Nitrile Gloves', ['56_2']], ['Person', 'Wears', 'Blue Nitrile Gloves', ['56_1']], ['Person', 'Holds', 'White_Plastic_Beaker', ['56_2']], ['Person', 'Pours', 'Clear Liquid', ['56_0']], ['Clear Liquid', 'Flows Into', 'Translucent Container', ['56_0']], ['Glass Flask', 'Is On', 'Heated Magnetic Stirrer', ['56_0']], ['Reflux Condenser', 'Is Above', 'Glass Flask', ['56_0']], ['Glass Flask', 'Is Connected To', 'Reflux Condenser', ['56_0']], ['Reaction Apparatus', 'Contains', 'Round_Bottom_Flask', ['56_1']], ['Round_Bottom_Flask', 'Is Connected To', 'Schlenk_Line', ['56_1']], ['Magnetic_Stirrer', 'Is On', 'Hot_Plate', ['56_1']], ['Lab_Table', 'Contains', 'Reaction_Apparatus', ['56_1']], ['Person', 'Performs', 'Scientific_Procedure', ['56_1']], ['Long_Tube', 'Delivers', 'Liquid', ['56_2']]] merge_instructions=[{'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '40_0'}, {'local': 'Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '40_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '40_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}]
2025-11-30 21:31:37,179 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue Nitrile Gloves', ['56_0']], ['Person', 'Pours', 'Clear Liquid', ['56_0']], ['Clear Liquid', 'Flows Into', 'Translucent Container', ['56_0']]]
2025-11-30 21:31:37,179 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=15, sample=[['Person', 'Wears', 'Blue Nitrile Gloves', ['56_0']], ['Person', 'Wears', 'Blue Nitrile Gloves', ['56_2']], ['Person', 'Wears', 'Blue Nitrile Gloves', ['56_1']]]
2025-11-30 21:31:37,179 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=3, sample=[{'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '40_0'}, {'local': 'Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '40_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '40_0'}]
2025-11-30 21:31:37,179 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=2, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}]
2025-11-30 21:31:37,179 - src.components.global_refiner - INFO - LLM suggested 3 entity merges: [{'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '40_0'}, {'local': 'Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '40_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '40_0'}]
2025-11-30 21:31:37,179 - src.components.global_refiner - INFO - LLM suggested 2 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}]
2025-11-30 21:31:37,179 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 30 triplets (total: 17.07s, LLM: 17.07s)
2025-11-30 21:31:37,179 - src.pipeline.kg_builder - INFO - Global refinement: 30 triplets in 17.07s
2025-11-30 21:31:37,179 - src.pipeline.kg_builder - INFO - Using 30 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:31:37,179 - src.pipeline.kg_builder - INFO - Pushing batch 57/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:31:37,179 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:31:37,312 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=525, relationships=494
2025-11-30 21:31:37,312 - src.components.neo4j_handler - INFO - Applying 3 merge instructions
2025-11-30 21:31:37,313 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue Nitrile Gloves -> Blue Nitrile Gloves
2025-11-30 21:31:37,313 - src.components.neo4j_handler - DEBUG - APOC merge successful: Gloves -> Blue Nitrile Gloves
2025-11-30 21:31:37,316 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Nitrile Gloves
2025-11-30 21:31:37,316 - src.components.neo4j_handler - INFO - Applying 2 prune instructions
2025-11-30 21:31:37,319 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Gloves
2025-11-30 21:31:37,320 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:31:37,320 - src.components.neo4j_handler - INFO - Applying 15 inter-chunk relations
2025-11-30 21:31:37,321 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue Nitrile Gloves
2025-11-30 21:31:37,323 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue Nitrile Gloves
2025-11-30 21:31:37,324 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue Nitrile Gloves
2025-11-30 21:31:37,325 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> White_Plastic_Beaker
2025-11-30 21:31:37,326 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Pours]-> Clear Liquid
2025-11-30 21:31:37,352 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Clear Liquid -[Flows Into]-> Translucent Container
2025-11-30 21:31:37,354 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Glass Flask -[Is On]-> Heated Magnetic Stirrer
2025-11-30 21:31:37,381 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Reflux Condenser -[Is Above]-> Glass Flask
2025-11-30 21:31:37,383 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Glass Flask -[Is Connected To]-> Reflux Condenser
2025-11-30 21:31:37,384 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Reaction Apparatus -[Contains]-> Round_Bottom_Flask
2025-11-30 21:31:37,385 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Round_Bottom_Flask -[Is Connected To]-> Schlenk_Line
2025-11-30 21:31:37,387 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Magnetic_Stirrer -[Is On]-> Hot_Plate
2025-11-30 21:31:37,388 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab_Table -[Contains]-> Reaction_Apparatus
2025-11-30 21:31:37,390 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Performs]-> Scientific_Procedure
2025-11-30 21:31:37,416 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Long_Tube -[Delivers]-> Liquid
2025-11-30 21:31:37,417 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:31:37,423 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=523, relationships=494
2025-11-30 21:31:37,426 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:31:37,426 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:31:37,426 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:31:37,426 - src.components.neo4j_handler - INFO - Batch injected in 0.25s (triplets: 0.24s, indexes: 0.00s)
2025-11-30 21:31:37,430 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 264, 'with_embedding': 264, 'linked_chunks': 207}
2025-11-30 21:31:37,430 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:31:37,471 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:31:37,757 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 466 nodes
2025-11-30 21:31:37,787 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 523, 'relationship_count': 1576, 'density': 0.0058, 'avg_degree': 6.0268, 'avg_unique_neighbors': 5.935, 'global_efficiency': 0.2985, 'avg_path_length': 2.7627, 'avg_degree_centrality': 0.0115, 'max_degree_centrality': 0.5192, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0468, 'degree_assortativity': -0.1718, 'graph_robustness': 0.8198, 'diameter_estimate': 50, 'clustering_coefficient': 0.2577, 'weakly_connected_components': 58, 'largest_wcc_size': 466, 'pagerank_top10_percent': 6.42, 'louvain_communities': 68, 'louvain_modularity': 0.4242, 'label_entropy': 1.5, 'computational_time': 0.3570280970307067}
2025-11-30 21:31:37,787 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 56, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509497.7874918, 'total_time': 24.53770012303721, 'aggregation': 3.002001903951168e-06, 'network_info': 0.006006596959196031, 'llm_extraction': 23.92332565493416, 'data_cleaning': 2.3644999600946903e-05, 'neo4j_injection': 0.2476310619385913, 'embedding_time': 0, 'indexing_time': 0.003513338975608349, 'graph_injection_time': 0.24384592403657734, 'acs_metrics': {'node_count': 523, 'relationship_count': 1576, 'density': 0.0058, 'avg_degree': 6.0268, 'avg_unique_neighbors': 5.935, 'global_efficiency': 0.2985, 'avg_path_length': 2.7627, 'avg_degree_centrality': 0.0115, 'max_degree_centrality': 0.5192, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0468, 'degree_assortativity': -0.1718, 'graph_robustness': 0.8198, 'diameter_estimate': 50, 'clustering_coefficient': 0.2577, 'weakly_connected_components': 58, 'largest_wcc_size': 466, 'pagerank_top10_percent': 6.42, 'louvain_communities': 68, 'louvain_modularity': 0.4242, 'label_entropy': 1.5, 'computational_time': 0.3570280970307067}, 'retrieval_queries': []}
2025-11-30 21:31:37,787 - src.pipeline.kg_builder - DEBUG - Batch 56 metrics: {
  "batch_idx": 56,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509497.7874918,
  "total_time": 24.53770012303721,
  "aggregation": 3.002001903951168e-06,
  "network_info": 0.006006596959196031,
  "llm_extraction": 23.92332565493416,
  "data_cleaning": 2.3644999600946903e-05,
  "neo4j_injection": 0.2476310619385913,
  "embedding_time": 0,
  "indexing_time": 0.003513338975608349,
  "graph_injection_time": 0.24384592403657734,
  "acs_metrics": {
    "node_count": 523,
    "relationship_count": 1576,
    "density": 0.0058,
    "avg_degree": 6.0268,
    "avg_unique_neighbors": 5.935,
    "global_efficiency": 0.2985,
    "avg_path_length": 2.7627,
    "avg_degree_centrality": 0.0115,
    "max_degree_centrality": 0.5192,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0468,
    "degree_assortativity": -0.1718,
    "graph_robustness": 0.8198,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2577,
    "weakly_connected_components": 58,
    "largest_wcc_size": 466,
    "pagerank_top10_percent": 6.42,
    "louvain_communities": 68,
    "louvain_modularity": 0.4242,
    "label_entropy": 1.5,
    "computational_time": 0.3570280970307067
  },
  "retrieval_queries": []
}
2025-11-30 21:31:37,788 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:31:37,788 - src.pipeline.kg_builder - INFO - Batch 57 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 23.92s, Clean: 0.00s, Neo4j: 0.25s, ACS: 0.36s
2025-11-30 21:31:37,788 - src.pipeline.kg_builder - INFO - Batch 57 completed in 24.54s
Processing KG batches:  79%|███████▉  | 57/72 [24:40<07:05, 28.34s/it]2025-11-30 21:31:37,788 - src.pipeline.kg_builder - INFO - Processing batch 58/72 (3 items)
2025-11-30 21:31:37,789 - src.pipeline.kg_builder - DEBUG - Batch 58 current_video_time: 14:22-14:27
2025-11-30 21:31:37,795 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 523
- Total Relationships: 494
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:31:37,795 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:31:37,795 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_57_0 ~238 words, content: Time: 14:12-14:17 Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a procedure on a black lab bench. The...
2025-11-30 21:31:37,795 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_57_1 ~229 words, content: The laboratory environment is well-equipped, with various pieces of equipment and supplies visible in the background. The person's actions are methodical and precise, indicating a...
2025-11-30 21:31:37,795 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_57_2 ~235 words, content: yellow, multi-way manifold (a Schlenk line). This manifold is mounted on a metal stand and is used to control the flow of inert gas (like...
2025-11-30 21:31:37,795 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_57_3 ~94 words, content: to transfer liquid from the white container into a glass flask. The flask is being held by the person's hand, and the tube is being...
2025-11-30 21:31:37,815 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:31:37,913 - src.components.pre_llm_injector - DEBUG - Found 264 existing chunk embeddings for similarity lookup
2025-11-30 21:31:37,973 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_4', '0.828'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3', '0.827')]
2025-11-30 21:31:37,975 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_4 via source_chunk_ids
2025-11-30 21:31:37,975 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3
2025-11-30 21:31:37,975 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:31:37,977 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 1 total -> 1 (internal: 0, external: 1)
2025-11-30 21:31:37,977 - src.components.pre_llm_injector - DEBUG - Subgraph: (Laboratory_Glassware / ID: 4_2)-[ENSURES]->(Accurate_Transfer / ID: 16_3)
2025-11-30 21:31:37,977 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_36_1', '0.756'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_55_2', '0.747')]
2025-11-30 21:31:37,977 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_43_4', '0.786'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_1', '0.776')]
2025-11-30 21:31:37,977 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.673'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_49_0', '0.669')]
2025-11-30 21:31:37,977 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_4', '0.828'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_16_3', '0.827')]
2025-11-30 21:31:37,977 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:31:37,977 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_57_0) (~238 words) with timeout=5.0s retries=3
2025-11-30 21:31:39,253 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:31:39,254 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:31:39,254 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_57_1) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:31:40,704 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:31:40,704 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:31:40,704 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_57_2) (~235 words) with timeout=5.0s retries=3
2025-11-30 21:31:44,883 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:31:44,883 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:31:44,883 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_57_3) (~94 words) with timeout=5.0s retries=3
2025-11-30 21:31:46,124 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:31:46,124 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:31:46,124 - src.components.pre_llm_injector - INFO - Extracted 21 local triplets from 4 chunks
2025-11-30 21:31:46,124 - src.pipeline.kg_builder - INFO - Pre-extraction: 21 triplets in 8.33s
2025-11-30 21:31:46,125 - src.components.global_refiner - INFO - Capping refinement input: 21 → 15 triplets
2025-11-30 21:31:46,125 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Laboratory_Glassware / ID: 4_2)-[ENSURES]->(Accurate_Transfer / ID: 16_3)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["57_0", "57_1"]}, {"head": "Person", "relation": "Handles", "tail": "Flexible_Tube", "source_chunks": ["57_0"]}, {"head": "Flexible_Tube", "relation": "Is Connected To", "tail": "Vacuum_System", "source_chunks": ["57_0"]}, {"head": "Flexible_Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["57_0", "57_1"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["57_0"]}, {"head": "Flask", "relation": "Is On", "tail": "Balance_Scale", "source_chunks": ["57_0"]}, {"head": "Person", "relation": "Holds", "tail": "Flexible_Tube", "source_chunks": ["57_1", "57_2"]}, {"head": "Liquid", "relation": "Is Transferred To", "tail": "Glass_Flask", "source_chunks": ["57_1"]}, {"head": "Glass_Flask", "relation": "Is On", "tail": "Magnetic_Stirrer", "source_chunks": ["57_1"]}, {"head": "Magnetic_Stirrer", "relation": "Is On", "tail": "Black_Lab_Bench", "source_chunks": ["57_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Glove", "source_chunks": ["57_2"]}, {"head": "Flexible_Tube", "relation": "Connects To", "tail": "Glass_Flask", "source_chunks": ["57_2"]}, {"head": "Glass_Flask", "relation": "Is Held By", "tail": "Clamp", "source_chunks": ["57_2"]}, {"head": "Clamp", "relation": "Is Attached To", "tail": "Metal_Stand", "source_chunks": ["57_2"]}, {"head": "Metal_Stand", "relation": "Supports", "tail": "Schlenk_Line_Manifold", "source_chunks": ["57_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:31:46,125 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~322 words, ~419 tokens)
2025-11-30 21:31:46,125 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:32:00,178 - src.components.global_refiner - DEBUG - LLM call completed in 14.05s
2025-11-30 21:32:00,178 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['57_0', '57_1']], ['Person', 'Handles', 'Flexible_Tube', ['57_0']], ['Flexible_Tube', 'Is Connected To', 'Vacuum_System', ['57_0']], ['Flexible_Tube', 'Transfers', 'Liquid', ['57_0', '57_1']], ['Person', 'Uses', 'Pipette', ['57_0']], ['Flask', 'Is On', 'Balance_Scale', ['57_0']], ['Person', 'Holds', 'Flexible_Tube', ['57_1', '57_2']], ['Liquid', 'Is Transferred To', 'Glass_Flask', ['57_1']], ['Glass_Flask', 'Is On', 'Magnetic_Stirrer', ['57_1']], ['Magnetic_Stirrer', 'Is On', 'Black_Lab_Bench', ['57_1']], ['Person', 'Wears', 'Blue_Glove', ['57_2']], ['Flexible_Tube', 'Connects To', 'Glass_Flask', ['57_2']], ['Glass_Flask', 'Is Held By', 'Clamp', ['57_2']], ['Clamp', 'Is Attached To', 'Metal_Stand', ['57_2']], ['Metal_Stand', 'Supports', 'Schlenk_Line_Manifold', ['57_2']]] inter_chunk_relations=[['Flexible_Tube', 'Transfers', 'Liquid', ['57_0', '57_1']], ['Glass_Flask', 'Is On', 'Magnetic_Stirrer', ['57_1']], ['Magnetic_Stirrer', 'Is On', 'Black_Lab_Bench', ['57_1']], ['Flexible_Tube', 'Connects To', 'Glass_Flask', ['57_2']], ['Glass_Flask', 'Is Held By', 'Clamp', ['57_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Glove', 'existing_id': '0_3'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Flexible_Tube', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Liquid', 'relation': 'Is Transferred To', 'tail': 'Glass_Flask'}, {'head': 'Glass_Flask', 'relation': 'Is On', 'tail': 'Magnetic_Stirrer'}, {'head': 'Magnetic_Stirrer', 'relation': 'Is On', 'tail': 'Black_Lab_Bench'}]
2025-11-30 21:32:00,178 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['57_0', '57_1']], ['Person', 'Handles', 'Flexible_Tube', ['57_0']], ['Flexible_Tube', 'Is Connected To', 'Vacuum_System', ['57_0']]]
2025-11-30 21:32:00,178 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Flexible_Tube', 'Transfers', 'Liquid', ['57_0', '57_1']], ['Glass_Flask', 'Is On', 'Magnetic_Stirrer', ['57_1']], ['Magnetic_Stirrer', 'Is On', 'Black_Lab_Bench', ['57_1']]]
2025-11-30 21:32:00,178 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=1, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Glove', 'existing_id': '0_3'}]
2025-11-30 21:32:00,178 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=6, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Flexible_Tube', 'relation': 'Transfers', 'tail': 'Liquid'}]
2025-11-30 21:32:00,178 - src.components.global_refiner - INFO - LLM suggested 1 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Glove', 'existing_id': '0_3'}]
2025-11-30 21:32:00,179 - src.components.global_refiner - INFO - LLM suggested 6 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Flexible_Tube', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Liquid', 'relation': 'Is Transferred To', 'tail': 'Glass_Flask'}, {'head': 'Glass_Flask', 'relation': 'Is On', 'tail': 'Magnetic_Stirrer'}, {'head': 'Magnetic_Stirrer', 'relation': 'Is On', 'tail': 'Black_Lab_Bench'}]
2025-11-30 21:32:00,179 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 14.05s, LLM: 14.05s)
2025-11-30 21:32:00,179 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 14.05s
2025-11-30 21:32:00,179 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:32:00,179 - src.pipeline.kg_builder - INFO - Pushing batch 58/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:32:00,179 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:32:00,344 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=535, relationships=509
2025-11-30 21:32:00,344 - src.components.neo4j_handler - INFO - Applying 1 merge instructions
2025-11-30 21:32:00,344 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue_Glove
2025-11-30 21:32:00,344 - src.components.neo4j_handler - INFO - Applying 6 prune instructions
2025-11-30 21:32:00,350 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue_Glove
2025-11-30 21:32:00,350 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:32:00,351 - src.components.neo4j_handler - DEBUG - Pruned relationship: Flexible_Tube -[Transfers]-> Liquid
2025-11-30 21:32:00,353 - src.components.neo4j_handler - DEBUG - Pruned relationship: Liquid -[Is Transferred To]-> Glass_Flask
2025-11-30 21:32:00,355 - src.components.neo4j_handler - DEBUG - Pruned relationship: Glass_Flask -[Is On]-> Magnetic_Stirrer
2025-11-30 21:32:00,356 - src.components.neo4j_handler - DEBUG - Pruned relationship: Magnetic_Stirrer -[Is On]-> Black_Lab_Bench
2025-11-30 21:32:00,356 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:32:00,382 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Flexible_Tube -[Transfers]-> Liquid
2025-11-30 21:32:00,384 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Glass_Flask -[Is On]-> Magnetic_Stirrer
2025-11-30 21:32:00,386 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Magnetic_Stirrer -[Is On]-> Black_Lab_Bench
2025-11-30 21:32:00,412 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Flexible_Tube -[Connects To]-> Glass_Flask
2025-11-30 21:32:00,414 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Glass_Flask -[Is Held By]-> Clamp
2025-11-30 21:32:00,415 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:32:00,421 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=534, relationships=506
2025-11-30 21:32:00,422 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:32:00,422 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:32:00,423 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:32:00,423 - src.components.neo4j_handler - INFO - Batch injected in 0.24s (triplets: 0.24s, indexes: 0.00s)
2025-11-30 21:32:00,425 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 268, 'with_embedding': 268, 'linked_chunks': 210}
2025-11-30 21:32:00,425 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:32:00,483 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:32:00,785 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 476 nodes
2025-11-30 21:32:00,815 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 534, 'relationship_count': 1609, 'density': 0.0057, 'avg_degree': 6.0262, 'avg_unique_neighbors': 5.9363, 'global_efficiency': 0.2983, 'avg_path_length': 2.7671, 'avg_degree_centrality': 0.0113, 'max_degree_centrality': 0.5178, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.046, 'degree_assortativity': -0.1709, 'graph_robustness': 0.8179, 'diameter_estimate': 50, 'clustering_coefficient': 0.2571, 'weakly_connected_components': 59, 'largest_wcc_size': 476, 'pagerank_top10_percent': 6.28, 'louvain_communities': 71, 'louvain_modularity': 0.4245, 'label_entropy': 1.5, 'computational_time': 0.38988658192101866}
2025-11-30 21:32:00,815 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 57, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509520.8152103, 'total_time': 23.0262155829696, 'aggregation': 2.9739458113908768e-06, 'network_info': 0.0059135149931535125, 'llm_extraction': 22.3840476059122, 'data_cleaning': 1.801189500838518e-05, 'neo4j_injection': 0.24437148799188435, 'embedding_time': 0, 'indexing_time': 0.002177678979933262, 'graph_injection_time': 0.24194146506488323, 'acs_metrics': {'node_count': 534, 'relationship_count': 1609, 'density': 0.0057, 'avg_degree': 6.0262, 'avg_unique_neighbors': 5.9363, 'global_efficiency': 0.2983, 'avg_path_length': 2.7671, 'avg_degree_centrality': 0.0113, 'max_degree_centrality': 0.5178, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.046, 'degree_assortativity': -0.1709, 'graph_robustness': 0.8179, 'diameter_estimate': 50, 'clustering_coefficient': 0.2571, 'weakly_connected_components': 59, 'largest_wcc_size': 476, 'pagerank_top10_percent': 6.28, 'louvain_communities': 71, 'louvain_modularity': 0.4245, 'label_entropy': 1.5, 'computational_time': 0.38988658192101866}, 'retrieval_queries': []}
2025-11-30 21:32:00,815 - src.pipeline.kg_builder - DEBUG - Batch 57 metrics: {
  "batch_idx": 57,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509520.8152103,
  "total_time": 23.0262155829696,
  "aggregation": 2.9739458113908768e-06,
  "network_info": 0.0059135149931535125,
  "llm_extraction": 22.3840476059122,
  "data_cleaning": 1.801189500838518e-05,
  "neo4j_injection": 0.24437148799188435,
  "embedding_time": 0,
  "indexing_time": 0.002177678979933262,
  "graph_injection_time": 0.24194146506488323,
  "acs_metrics": {
    "node_count": 534,
    "relationship_count": 1609,
    "density": 0.0057,
    "avg_degree": 6.0262,
    "avg_unique_neighbors": 5.9363,
    "global_efficiency": 0.2983,
    "avg_path_length": 2.7671,
    "avg_degree_centrality": 0.0113,
    "max_degree_centrality": 0.5178,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.046,
    "degree_assortativity": -0.1709,
    "graph_robustness": 0.8179,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2571,
    "weakly_connected_components": 59,
    "largest_wcc_size": 476,
    "pagerank_top10_percent": 6.28,
    "louvain_communities": 71,
    "louvain_modularity": 0.4245,
    "label_entropy": 1.5,
    "computational_time": 0.38988658192101866
  },
  "retrieval_queries": []
}
2025-11-30 21:32:00,816 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:32:00,816 - src.pipeline.kg_builder - INFO - Batch 58 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 22.38s, Clean: 0.00s, Neo4j: 0.24s, ACS: 0.39s
2025-11-30 21:32:00,816 - src.pipeline.kg_builder - INFO - Batch 58 completed in 23.03s
Processing KG batches:  81%|████████  | 58/72 [25:03<06:14, 26.75s/it]2025-11-30 21:32:00,816 - src.pipeline.kg_builder - INFO - Processing batch 59/72 (3 items)
2025-11-30 21:32:00,816 - src.pipeline.kg_builder - DEBUG - Batch 59 current_video_time: 14:37-14:42
2025-11-30 21:32:00,822 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 534
- Total Relationships: 506
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:32:00,823 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:32:00,823 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_58_0 ~223 words, content: Time: 14:27-14:32 Content: The video shows a person conducting a laboratory procedure, likely a rinsing or washing step, from a first-person perspective. The scene is...
2025-11-30 21:32:00,823 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_58_1 ~222 words, content: methodical and controlled process, such as preparing a solution or cleaning glassware. Time: 14:32-14:37 Content: The video begins with a close-up view of a laboratory...
2025-11-30 21:32:00,823 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_58_2 ~145 words, content: on a black laboratory bench. On the bench, a complex experimental setup is in progress. A long, flexible, translucent tube is connected to a yellow...
2025-11-30 21:32:00,843 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:32:00,940 - src.components.pre_llm_injector - DEBUG - Found 268 existing chunk embeddings for similarity lookup
2025-11-30 21:32:00,984 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.870'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_51_3', '0.864')]
2025-11-30 21:32:00,986 - src.components.pre_llm_injector - DEBUG - Found 2 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_51_3
2025-11-30 21:32:00,986 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:32:00,986 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3 via source_chunk_ids
2025-11-30 21:32:01,006 - src.components.pre_llm_injector - DEBUG - Limited Person from 144 to 2 external connections
2025-11-30 21:32:01,006 - src.components.pre_llm_injector - DEBUG - Limited Tube from 3 to 2 external connections
2025-11-30 21:32:01,006 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 152 total -> 9 (internal: 5, external: 4)
2025-11-30 21:32:01,006 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HANDLES]->(Tube / ID: 51_3), (Person / ID: 0_0)-[HOLDS]->(Tube / ID: 51_3), (Person / ID: 0_0)-[HOLDS]->(Tube / ID: 51_3), (Person / ID: 0_0)-[USES]->(Tube / ID: 51_3), (Person / ID: 0_0)-[HOLDS]->(Tube / ID: 51_3), (Person / ID: 0_0)-[USES]->(Glass_Pipette / ID: 26_2), (Person / ID: 0_0)-[TRANSFERS]->(Chemical Substance / ID: 10_0), (Tube / ID: 51_3)-[IS_INSERTED_INTO]->(Liquid_In_Small_Container / ID: 5_0), (Tube / ID: 51_3)-[IS_POSITIONED_OVER]->(Large Jug / ID: 53_2)
2025-11-30 21:32:01,006 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_4', '0.791'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_53_2', '0.782')]
2025-11-30 21:32:01,006 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_1', '0.841'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_1', '0.814')]
2025-11-30 21:32:01,006 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.870'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_51_3', '0.864')]
2025-11-30 21:32:01,006 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:32:01,006 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_58_0) (~223 words) with timeout=5.0s retries=3
2025-11-30 21:32:02,643 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:32:02,643 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:32:02,644 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_58_1) (~222 words) with timeout=5.0s retries=3
2025-11-30 21:32:03,799 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:32:03,799 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:32:03,800 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_58_2) (~145 words) with timeout=5.0s retries=3
2025-11-30 21:32:05,052 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:32:05,052 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:32:05,052 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 3 chunks
2025-11-30 21:32:05,052 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 4.23s
2025-11-30 21:32:05,053 - src.components.global_refiner - INFO - Capping refinement input: 17 → 15 triplets
2025-11-30 21:32:05,053 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[HANDLES]->(Tube / ID: 51_3), (Person / ID: 0_0)-[HOLDS]->(Tube / ID: 51_3), (Person / ID: 0_0)-[HOLDS]->(Tube / ID: 51_3), (Person / ID: 0_0)-[USES]->(Tube / ID: 51_3), (Person / ID: 0_0)-[HOLDS]->(Tube / ID: 51_3), (Person / ID: 0_0)-[USES]->(Glass_Pipette / ID: 26_2), (Person / ID: 0_0)-[TRANSFERS]->(Chemical Substance / ID: 10_0), (Tube / ID: 51_3)-[IS_INSERTED_INTO]->(Liquid_In_Small_Container / ID: 5_0), (Tube / ID: 51_3)-[IS_POSITIONED_OVER]->(Large Jug / ID: 53_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["58_0"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["58_0"]}, {"head": "Translucent_Tube", "relation": "Transfers", "tail": "Clear_Liquid", "source_chunks": ["58_0"]}, {"head": "Clear_Liquid", "relation": "Flows Into", "tail": "White_Plastic_Measuring_Jug", "source_chunks": ["58_0"]}, {"head": "White_Plastic_Measuring_Jug", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["58_0"]}, {"head": "Person", "relation": "Controls", "tail": "Flow_Of_Liquid", "source_chunks": ["58_0"]}, {"head": "Plastic Tube", "relation": "Dispenses", "tail": "Liquid", "source_chunks": ["58_1"]}, {"head": "Laboratory Bench", "relation": "Contains", "tail": "Measuring Cup", "source_chunks": ["58_1"]}, {"head": "Man", "relation": "Stands In", "tail": "Laboratory", "source_chunks": ["58_1"]}, {"head": "Man", "relation": "Wears", "tail": "Turtleneck Sweater", "source_chunks": ["58_1"]}, {"head": "Man", "relation": "Wears", "tail": "Jeans", "source_chunks": ["58_1"]}, {"head": "Laboratory Bench", "relation": "Contains", "tail": "Experimental Setup", "source_chunks": ["58_1", "58_2"]}, {"head": "Experimental Setup", "relation": "Includes", "tail": "Magnetic Stirrer", "source_chunks": ["58_2"]}, {"head": "Experimental Setup", "relation": "Includes", "tail": "Glass Flask", "source_chunks": ["58_2"]}, {"head": "Experimental Setup", "relation": "Includes", "tail": "Clear Plastic Beaker", "source_chunks": ["58_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:32:05,053 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~381 words, ~495 tokens)
2025-11-30 21:32:05,053 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:32:25,283 - src.components.global_refiner - DEBUG - LLM call completed in 20.23s
2025-11-30 21:32:25,284 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['58_0']], ['Person', 'Holds', 'Translucent_Tube', ['58_0']], ['Translucent_Tube', 'Transfers', 'Clear_Liquid', ['58_0']], ['Clear_Liquid', 'Flows Into', 'White_Plastic_Measuring_Jug', ['58_0']], ['White_Plastic_Measuring_Jug', 'Contains', 'Clear_Liquid', ['58_0']], ['Person', 'Controls', 'Flow_Of_Liquid', ['58_0']], ['Plastic Tube', 'Dispenses', 'Liquid', ['58_1']], ['Laboratory Bench', 'Contains', 'Measuring Cup', ['58_1']], ['Man', 'Stands In', 'Laboratory', ['58_1']], ['Man', 'Wears', 'Turtleneck Sweater', ['58_1']], ['Man', 'Wears', 'Jeans', ['58_1']], ['Laboratory Bench', 'Contains', 'Experimental Setup', ['58_1']], ['Experimental Setup', 'Includes', 'Magnetic Stirrer', ['58_2']], ['Experimental Setup', 'Includes', 'Glass Flask', ['58_2']], ['Experimental Setup', 'Includes', 'Clear Plastic Beaker', ['58_2']]] inter_chunk_relations=[['Translucent_Tube', 'Transfers', 'Clear_Liquid', ['58_0']], ['Clear_Liquid', 'Flows Into', 'White_Plastic_Measuring_Jug', ['58_0']], ['White_Plastic_Measuring_Jug', 'Contains', 'Clear_Liquid', ['58_0']], ['Person', 'Controls', 'Flow_Of_Liquid', ['58_0']], ['Plastic Tube', 'Dispenses', 'Liquid', ['58_1']], ['Laboratory Bench', 'Contains', 'Measuring Cup', ['58_1']], ['Man', 'Stands In', 'Laboratory', ['58_1']], ['Man', 'Wears', 'Turtleneck Sweater', ['58_1']], ['Man', 'Wears', 'Jeans', ['58_1']], ['Laboratory Bench', 'Contains', 'Experimental Setup', ['58_1']], ['Experimental Setup', 'Includes', 'Magnetic Stirrer', ['58_2']], ['Experimental Setup', 'Includes', 'Glass Flask', ['58_2']], ['Experimental Setup', 'Includes', 'Clear Plastic Beaker', ['58_2']]] merge_instructions=[{'local': 'Translucent_Tube', 'existing': 'Tube', 'existing_id': '51_3'}, {'local': 'Clear_Liquid', 'existing': 'Chemical Substance', 'existing_id': '10_0'}, {'local': 'White_Plastic_Measuring_Jug', 'existing': 'Large Jug', 'existing_id': '53_2'}, {'local': 'Plastic Tube', 'existing': 'Tube', 'existing_id': '51_3'}, {'local': 'Laboratory Bench', 'existing': 'Laboratory', 'existing_id': '0_0'}, {'local': 'Experimental Setup', 'existing': 'Laboratory', 'existing_id': '0_0'}, {'local': 'Magnetic Stirrer', 'existing': 'Laboratory', 'existing_id': '0_0'}, {'local': 'Glass Flask', 'existing': 'Laboratory', 'existing_id': '0_0'}, {'local': 'Clear Plastic Beaker', 'existing': 'Laboratory', 'existing_id': '0_0'}] prune_instructions=[{'head': 'Person', 'relation': 'HOLDS', 'tail': 'Tube'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Tube'}, {'head': 'Person', 'relation': 'HANDLES', 'tail': 'Tube'}, {'head': 'Person', 'relation': 'TRANSFERS', 'tail': 'Chemical Substance'}, {'head': 'Tube', 'relation': 'IS_INSERTED_INTO', 'tail': 'Liquid_In_Small_Container'}, {'head': 'Tube', 'relation': 'IS_POSITIONED_OVER', 'tail': 'Large Jug'}]
2025-11-30 21:32:25,284 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['58_0']], ['Person', 'Holds', 'Translucent_Tube', ['58_0']], ['Translucent_Tube', 'Transfers', 'Clear_Liquid', ['58_0']]]
2025-11-30 21:32:25,284 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=13, sample=[['Translucent_Tube', 'Transfers', 'Clear_Liquid', ['58_0']], ['Clear_Liquid', 'Flows Into', 'White_Plastic_Measuring_Jug', ['58_0']], ['White_Plastic_Measuring_Jug', 'Contains', 'Clear_Liquid', ['58_0']]]
2025-11-30 21:32:25,284 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=9, sample=[{'local': 'Translucent_Tube', 'existing': 'Tube', 'existing_id': '51_3'}, {'local': 'Clear_Liquid', 'existing': 'Chemical Substance', 'existing_id': '10_0'}, {'local': 'White_Plastic_Measuring_Jug', 'existing': 'Large Jug', 'existing_id': '53_2'}]
2025-11-30 21:32:25,284 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=6, sample=[{'head': 'Person', 'relation': 'HOLDS', 'tail': 'Tube'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Tube'}, {'head': 'Person', 'relation': 'HANDLES', 'tail': 'Tube'}]
2025-11-30 21:32:25,284 - src.components.global_refiner - INFO - LLM suggested 9 entity merges: [{'local': 'Translucent_Tube', 'existing': 'Tube', 'existing_id': '51_3'}, {'local': 'Clear_Liquid', 'existing': 'Chemical Substance', 'existing_id': '10_0'}, {'local': 'White_Plastic_Measuring_Jug', 'existing': 'Large Jug', 'existing_id': '53_2'}, {'local': 'Plastic Tube', 'existing': 'Tube', 'existing_id': '51_3'}, {'local': 'Laboratory Bench', 'existing': 'Laboratory', 'existing_id': '0_0'}, {'local': 'Experimental Setup', 'existing': 'Laboratory', 'existing_id': '0_0'}, {'local': 'Magnetic Stirrer', 'existing': 'Laboratory', 'existing_id': '0_0'}, {'local': 'Glass Flask', 'existing': 'Laboratory', 'existing_id': '0_0'}, {'local': 'Clear Plastic Beaker', 'existing': 'Laboratory', 'existing_id': '0_0'}]
2025-11-30 21:32:25,284 - src.components.global_refiner - INFO - LLM suggested 6 triplets to prune: [{'head': 'Person', 'relation': 'HOLDS', 'tail': 'Tube'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Tube'}, {'head': 'Person', 'relation': 'HANDLES', 'tail': 'Tube'}, {'head': 'Person', 'relation': 'TRANSFERS', 'tail': 'Chemical Substance'}, {'head': 'Tube', 'relation': 'IS_INSERTED_INTO', 'tail': 'Liquid_In_Small_Container'}, {'head': 'Tube', 'relation': 'IS_POSITIONED_OVER', 'tail': 'Large Jug'}]
2025-11-30 21:32:25,284 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 28 triplets (total: 20.23s, LLM: 20.23s)
2025-11-30 21:32:25,284 - src.pipeline.kg_builder - INFO - Global refinement: 28 triplets in 20.23s
2025-11-30 21:32:25,284 - src.pipeline.kg_builder - INFO - Using 28 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:32:25,284 - src.pipeline.kg_builder - INFO - Pushing batch 59/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:32:25,285 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:32:25,441 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=546, relationships=521
2025-11-30 21:32:25,441 - src.components.neo4j_handler - INFO - Applying 9 merge instructions
2025-11-30 21:32:25,442 - src.components.neo4j_handler - DEBUG - APOC merge successful: Translucent_Tube -> Tube
2025-11-30 21:32:25,449 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear_Liquid -> Chemical Substance
2025-11-30 21:32:25,456 - src.components.neo4j_handler - DEBUG - APOC merge successful: White_Plastic_Measuring_Jug -> Large Jug
2025-11-30 21:32:25,460 - src.components.neo4j_handler - DEBUG - APOC merge successful: Plastic Tube -> Tube
2025-11-30 21:32:25,464 - src.components.neo4j_handler - DEBUG - APOC merge successful: Laboratory Bench -> Laboratory
2025-11-30 21:32:25,468 - src.components.neo4j_handler - DEBUG - APOC merge successful: Experimental Setup -> Laboratory
2025-11-30 21:32:25,471 - src.components.neo4j_handler - DEBUG - APOC merge successful: Magnetic Stirrer -> Laboratory
2025-11-30 21:32:25,475 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass Flask -> Laboratory
2025-11-30 21:32:25,479 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear Plastic Beaker -> Laboratory
2025-11-30 21:32:25,479 - src.components.neo4j_handler - INFO - Applying 6 prune instructions
2025-11-30 21:32:25,485 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[HOLDS]-> Tube
2025-11-30 21:32:25,487 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[USES]-> Tube
2025-11-30 21:32:25,488 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[HANDLES]-> Tube
2025-11-30 21:32:25,490 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[TRANSFERS]-> Chemical Substance
2025-11-30 21:32:25,517 - src.components.neo4j_handler - DEBUG - Pruned relationship: Tube -[IS_INSERTED_INTO]-> Liquid_In_Small_Container
2025-11-30 21:32:25,544 - src.components.neo4j_handler - DEBUG - Pruned relationship: Tube -[IS_POSITIONED_OVER]-> Large Jug
2025-11-30 21:32:25,544 - src.components.neo4j_handler - INFO - Applying 13 inter-chunk relations
2025-11-30 21:32:25,547 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Translucent_Tube -[Transfers]-> Clear_Liquid
2025-11-30 21:32:25,549 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Clear_Liquid -[Flows Into]-> White_Plastic_Measuring_Jug
2025-11-30 21:32:25,551 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: White_Plastic_Measuring_Jug -[Contains]-> Clear_Liquid
2025-11-30 21:32:25,554 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Controls]-> Flow_Of_Liquid
2025-11-30 21:32:25,555 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Plastic Tube -[Dispenses]-> Liquid
2025-11-30 21:32:25,556 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Laboratory Bench -[Contains]-> Measuring Cup
2025-11-30 21:32:25,558 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Man -[Stands In]-> Laboratory
2025-11-30 21:32:25,561 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Man -[Wears]-> Turtleneck Sweater
2025-11-30 21:32:25,563 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Man -[Wears]-> Jeans
2025-11-30 21:32:25,564 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Laboratory Bench -[Contains]-> Experimental Setup
2025-11-30 21:32:25,565 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Experimental Setup -[Includes]-> Magnetic Stirrer
2025-11-30 21:32:25,565 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Experimental Setup -[Includes]-> Glass Flask
2025-11-30 21:32:25,566 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Experimental Setup -[Includes]-> Clear Plastic Beaker
2025-11-30 21:32:25,566 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:32:25,571 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=537, relationships=510
2025-11-30 21:32:25,574 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:32:25,574 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:32:25,574 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:32:25,574 - src.components.neo4j_handler - INFO - Batch injected in 0.29s (triplets: 0.29s, indexes: 0.00s)
2025-11-30 21:32:25,575 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 271, 'with_embedding': 271, 'linked_chunks': 213}
2025-11-30 21:32:25,575 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:32:25,617 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:32:25,921 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 479 nodes
2025-11-30 21:32:25,952 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 537, 'relationship_count': 1625, 'density': 0.0056, 'avg_degree': 6.0521, 'avg_unique_neighbors': 5.959, 'global_efficiency': 0.2929, 'avg_path_length': 2.7569, 'avg_degree_centrality': 0.0113, 'max_degree_centrality': 0.5187, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0281, 'degree_assortativity': -0.1768, 'graph_robustness': 0.8, 'diameter_estimate': 50, 'clustering_coefficient': 0.2575, 'weakly_connected_components': 59, 'largest_wcc_size': 479, 'pagerank_top10_percent': 6.08, 'louvain_communities': 71, 'louvain_modularity': 0.413, 'label_entropy': 1.5, 'computational_time': 0.3773207659833133}
2025-11-30 21:32:25,953 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 58, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509545.9530747, 'total_time': 25.136315378942527, 'aggregation': 2.8960639610886574e-06, 'network_info': 0.0059670929331332445, 'llm_extraction': 24.461935898056254, 'data_cleaning': 4.226900637149811e-05, 'neo4j_injection': 0.28953651094343513, 'embedding_time': 0, 'indexing_time': 0.0024402510607615113, 'graph_injection_time': 0.2867483380250633, 'acs_metrics': {'node_count': 537, 'relationship_count': 1625, 'density': 0.0056, 'avg_degree': 6.0521, 'avg_unique_neighbors': 5.959, 'global_efficiency': 0.2929, 'avg_path_length': 2.7569, 'avg_degree_centrality': 0.0113, 'max_degree_centrality': 0.5187, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0281, 'degree_assortativity': -0.1768, 'graph_robustness': 0.8, 'diameter_estimate': 50, 'clustering_coefficient': 0.2575, 'weakly_connected_components': 59, 'largest_wcc_size': 479, 'pagerank_top10_percent': 6.08, 'louvain_communities': 71, 'louvain_modularity': 0.413, 'label_entropy': 1.5, 'computational_time': 0.3773207659833133}, 'retrieval_queries': []}
2025-11-30 21:32:25,953 - src.pipeline.kg_builder - DEBUG - Batch 58 metrics: {
  "batch_idx": 58,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509545.9530747,
  "total_time": 25.136315378942527,
  "aggregation": 2.8960639610886574e-06,
  "network_info": 0.0059670929331332445,
  "llm_extraction": 24.461935898056254,
  "data_cleaning": 4.226900637149811e-05,
  "neo4j_injection": 0.28953651094343513,
  "embedding_time": 0,
  "indexing_time": 0.0024402510607615113,
  "graph_injection_time": 0.2867483380250633,
  "acs_metrics": {
    "node_count": 537,
    "relationship_count": 1625,
    "density": 0.0056,
    "avg_degree": 6.0521,
    "avg_unique_neighbors": 5.959,
    "global_efficiency": 0.2929,
    "avg_path_length": 2.7569,
    "avg_degree_centrality": 0.0113,
    "max_degree_centrality": 0.5187,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0281,
    "degree_assortativity": -0.1768,
    "graph_robustness": 0.8,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2575,
    "weakly_connected_components": 59,
    "largest_wcc_size": 479,
    "pagerank_top10_percent": 6.08,
    "louvain_communities": 71,
    "louvain_modularity": 0.413,
    "label_entropy": 1.5,
    "computational_time": 0.3773207659833133
  },
  "retrieval_queries": []
}
2025-11-30 21:32:25,954 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:32:25,954 - src.pipeline.kg_builder - INFO - Batch 59 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 24.46s, Clean: 0.00s, Neo4j: 0.29s, ACS: 0.38s
2025-11-30 21:32:25,954 - src.pipeline.kg_builder - INFO - Batch 59 completed in 25.14s
Processing KG batches:  82%|████████▏ | 59/72 [25:28<05:41, 26.26s/it]2025-11-30 21:32:25,954 - src.pipeline.kg_builder - INFO - Processing batch 60/72 (3 items)
2025-11-30 21:32:25,954 - src.pipeline.kg_builder - DEBUG - Batch 60 current_video_time: 14:52-14:57
2025-11-30 21:32:25,961 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 537
- Total Relationships: 510
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:32:25,961 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:32:25,961 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_0 ~238 words, content: Time: 14:42-14:47 Content: The video shows a laboratory setting where a scientific procedure is in progress. The central focus is a long, flexible tube, which...
2025-11-30 21:32:25,962 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_1 ~239 words, content: 52 Content: The video sequence captures a scientific experiment being conducted in a laboratory setting. The scene is set on a black laboratory bench, which...
2025-11-30 21:32:25,962 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_2 ~236 words, content: aker via the long tube. The liquid is being added slowly and steadily, indicating a controlled process. The entire setup is designed to ensure a...
2025-11-30 21:32:25,962 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_3 ~219 words, content: apparatus featuring a yellow, multi-armed clamp holding several tubes and a long, flexible tube. This entire assembly is mounted on a metal stand. The background...
2025-11-30 21:32:25,962 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_4 ~89 words, content: View (Frame 5):** The camera focuses on the end of the long, flexible tube, which is submerged in a white plastic beaker filled with a...
2025-11-30 21:32:25,982 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:32:26,083 - src.components.pre_llm_injector - DEBUG - Found 271 existing chunk embeddings for similarity lookup
2025-11-30 21:32:26,156 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_57_3', '0.822'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_53_2', '0.818')]
2025-11-30 21:32:26,158 - src.components.pre_llm_injector - DEBUG - Found 3 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_53_2
2025-11-30 21:32:26,158 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:32:26,158 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_57_3 via source_chunk_ids
2025-11-30 21:32:26,177 - src.components.pre_llm_injector - DEBUG - Limited Person from 143 to 2 external connections
2025-11-30 21:32:26,177 - src.components.pre_llm_injector - DEBUG - Limited Lab Bench from 7 to 2 external connections
2025-11-30 21:32:26,177 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 152 total -> 6 (internal: 0, external: 6)
2025-11-30 21:32:26,177 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[OPENS]->(Glass_Draft_Shield / ID: 7_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Magnetic_Stirrer / ID: 4_2), (Document / ID: 0_2)-[IS_ON]->(Lab Bench / ID: 2_1), (Lab Bench / ID: 2_1)-[CONTAINS]->(Glass_Volumetric_Flask / ID: 29_2), (Large Jug / ID: 53_2)-[CONTAINS]->(Chemical Substance / ID: 10_0), (Chemical Substance / ID: 10_0)-[FLOWS_INTO]->(Large Jug / ID: 53_2)
2025-11-30 21:32:26,177 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_2', '0.731'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_1', '0.731')]
2025-11-30 21:32:26,177 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_55_2', '0.798'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.777')]
2025-11-30 21:32:26,177 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_2', '0.747'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.737')]
2025-11-30 21:32:26,177 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_2', '0.756'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.734')]
2025-11-30 21:32:26,177 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_57_3', '0.822'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_53_2', '0.818')]
2025-11-30 21:32:26,177 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:32:26,178 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_0) (~238 words) with timeout=5.0s retries=3
2025-11-30 21:32:27,503 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:32:27,503 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:32:27,504 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_1) (~239 words) with timeout=5.0s retries=3
2025-11-30 21:32:28,898 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:32:28,898 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:32:28,898 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_2) (~236 words) with timeout=5.0s retries=3
2025-11-30 21:32:30,022 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:32:30,023 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:32:30,023 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_3) (~219 words) with timeout=5.0s retries=3
2025-11-30 21:32:31,149 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:32:31,149 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:32:31,149 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_4) (~89 words) with timeout=5.0s retries=3
2025-11-30 21:32:32,333 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:32:32,333 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:32:32,333 - src.components.pre_llm_injector - INFO - Extracted 29 local triplets from 5 chunks
2025-11-30 21:32:32,333 - src.pipeline.kg_builder - INFO - Pre-extraction: 29 triplets in 6.37s
2025-11-30 21:32:32,333 - src.components.global_refiner - INFO - Capping refinement input: 29 → 15 triplets
2025-11-30 21:32:32,333 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[OPENS]->(Glass_Draft_Shield / ID: 7_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Magnetic_Stirrer / ID: 4_2), (Document / ID: 0_2)-[IS_ON]->(Lab Bench / ID: 2_1), (Lab Bench / ID: 2_1)-[CONTAINS]->(Glass_Volumetric_Flask / ID: 29_2), (Large Jug / ID: 53_2)-[CONTAINS]->(Chemical Substance / ID: 10_0), (Chemical Substance / ID: 10_0)-[FLOWS_INTO]->(Large Jug / ID: 53_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Vacuum Filtration Setup", "relation": "Contains", "tail": "Flexible Tube", "source_chunks": ["59_0"]}, {"head": "Flexible Tube", "relation": "Connects", "tail": "Blue Stand", "source_chunks": ["59_0"]}, {"head": "Flexible Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["59_0"]}, {"head": "Liquid", "relation": "Flows Into", "tail": "White Plastic Beaker", "source_chunks": ["59_0"]}, {"head": "White Plastic Beaker", "relation": "Rests On", "tail": "Laboratory Table", "source_chunks": ["59_0"]}, {"head": "Laboratory Table", "relation": "Holds", "tail": "Container With Red Liquid", "source_chunks": ["59_0"]}, {"head": "Tube", "relation": "Connects", "tail": "Beaker", "source_chunks": ["59_1"]}, {"head": "Beaker", "relation": "Rests On", "tail": "Magnetic_Stirrer", "source_chunks": ["59_1"]}, {"head": "Magnetic_Stirrer", "relation": "Supports", "tail": "Glass_Flask", "source_chunks": ["59_1"]}, {"head": "Glass_Flask", "relation": "Is Held By", "tail": "Clamp", "source_chunks": ["59_1"]}, {"head": "Clamp", "relation": "Is Part Of", "tail": "Metal_Stand", "source_chunks": ["59_1"]}, {"head": "Person", "relation": "Observes", "tail": "Experiment", "source_chunks": ["59_1", "59_2"]}, {"head": "Flask", "relation": "Is Connected To", "tail": "Apparatus", "source_chunks": ["59_2"]}, {"head": "Apparatus", "relation": "Contains", "tail": "Long Tube", "source_chunks": ["59_2"]}, {"head": "Liquid", "relation": "Is Added To", "tail": "Flask", "source_chunks": ["59_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:32:32,333 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~376 words, ~489 tokens)
2025-11-30 21:32:32,333 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:32:49,443 - src.components.global_refiner - DEBUG - LLM call completed in 17.11s
2025-11-30 21:32:49,444 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Vacuum Filtration Setup', 'Contains', 'Flexible Tube', ['59_0']], ['Flexible Tube', 'Connects', 'Blue Stand', ['59_0']], ['Flexible Tube', 'Transfers', 'Liquid', ['59_0']], ['Liquid', 'Flows Into', 'White Plastic Beaker', ['59_0']], ['White Plastic Beaker', 'Rests On', 'Laboratory Table', ['59_0']], ['Laboratory Table', 'Holds', 'Container With Red Liquid', ['59_0']], ['Tube', 'Connects', 'Beaker', ['59_1']], ['Beaker', 'Rests On', 'Magnetic_Stirrer', ['59_1']], ['Magnetic_Stirrer', 'Supports', 'Glass_Flask', ['59_1']], ['Glass_Flask', 'Is Held By', 'Clamp', ['59_1']], ['Clamp', 'Is Part Of', 'Metal_Stand', ['59_1']], ['Person', 'Observes', 'Experiment', ['59_1', '59_2']], ['Flask', 'Is Connected To', 'Apparatus', ['59_2']], ['Apparatus', 'Contains', 'Long Tube', ['59_2']], ['Liquid', 'Is Added To', 'Flask', ['59_2']]] inter_chunk_relations=[['White Plastic Beaker', 'Rests On', 'Laboratory Table', ['59_0']], ['Laboratory Table', 'Holds', 'Container With Red Liquid', ['59_0']], ['Beaker', 'Rests On', 'Magnetic_Stirrer', ['59_1']], ['Magnetic_Stirrer', 'Supports', 'Glass_Flask', ['59_1']], ['Glass_Flask', 'Is Held By', 'Clamp', ['59_1']], ['Clamp', 'Is Part Of', 'Metal_Stand', ['59_1']], ['Person', 'Observes', 'Experiment', ['59_1', '59_2']], ['Flask', 'Is Connected To', 'Apparatus', ['59_2']], ['Apparatus', 'Contains', 'Long Tube', ['59_2']], ['Liquid', 'Is Added To', 'Flask', ['59_2']]] merge_instructions=[{'local': 'Tube', 'existing': 'Flexible Tube', 'existing_id': '7_0'}, {'local': 'Flask', 'existing': 'Glass_Flask', 'existing_id': '29_2'}, {'local': 'Beaker', 'existing': 'White Plastic Beaker', 'existing_id': '53_2'}, {'local': 'Apparatus', 'existing': 'Vacuum Filtration Setup', 'existing_id': '7_0'}] prune_instructions=[{'entity': 'Large Jug'}, {'head': 'Person', 'relation': 'OPENS', 'tail': 'Glass_Draft_Shield'}, {'head': 'Person', 'relation': 'INTERACTS_WITH', 'tail': 'Magnetic_Stirrer'}, {'head': 'Document', 'relation': 'IS_ON', 'tail': 'Lab Bench'}, {'head': 'Lab Bench', 'relation': 'CONTAINS', 'tail': 'Glass_Volumetric_Flask'}, {'head': 'Large Jug', 'relation': 'CONTAINS', 'tail': 'Chemical Substance'}, {'head': 'Chemical Substance', 'relation': 'FLOWS_INTO', 'tail': 'Large Jug'}]
2025-11-30 21:32:49,444 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Vacuum Filtration Setup', 'Contains', 'Flexible Tube', ['59_0']], ['Flexible Tube', 'Connects', 'Blue Stand', ['59_0']], ['Flexible Tube', 'Transfers', 'Liquid', ['59_0']]]
2025-11-30 21:32:49,444 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=10, sample=[['White Plastic Beaker', 'Rests On', 'Laboratory Table', ['59_0']], ['Laboratory Table', 'Holds', 'Container With Red Liquid', ['59_0']], ['Beaker', 'Rests On', 'Magnetic_Stirrer', ['59_1']]]
2025-11-30 21:32:49,444 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Tube', 'existing': 'Flexible Tube', 'existing_id': '7_0'}, {'local': 'Flask', 'existing': 'Glass_Flask', 'existing_id': '29_2'}, {'local': 'Beaker', 'existing': 'White Plastic Beaker', 'existing_id': '53_2'}]
2025-11-30 21:32:49,444 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=7, sample=[{'entity': 'Large Jug'}, {'head': 'Person', 'relation': 'OPENS', 'tail': 'Glass_Draft_Shield'}, {'head': 'Person', 'relation': 'INTERACTS_WITH', 'tail': 'Magnetic_Stirrer'}]
2025-11-30 21:32:49,444 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Tube', 'existing': 'Flexible Tube', 'existing_id': '7_0'}, {'local': 'Flask', 'existing': 'Glass_Flask', 'existing_id': '29_2'}, {'local': 'Beaker', 'existing': 'White Plastic Beaker', 'existing_id': '53_2'}, {'local': 'Apparatus', 'existing': 'Vacuum Filtration Setup', 'existing_id': '7_0'}]
2025-11-30 21:32:49,444 - src.components.global_refiner - INFO - LLM suggested 7 triplets to prune: [{'entity': 'Large Jug'}, {'head': 'Person', 'relation': 'OPENS', 'tail': 'Glass_Draft_Shield'}, {'head': 'Person', 'relation': 'INTERACTS_WITH', 'tail': 'Magnetic_Stirrer'}, {'head': 'Document', 'relation': 'IS_ON', 'tail': 'Lab Bench'}, {'head': 'Lab Bench', 'relation': 'CONTAINS', 'tail': 'Glass_Volumetric_Flask'}, {'head': 'Large Jug', 'relation': 'CONTAINS', 'tail': 'Chemical Substance'}, {'head': 'Chemical Substance', 'relation': 'FLOWS_INTO', 'tail': 'Large Jug'}]
2025-11-30 21:32:49,444 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 25 triplets (total: 17.11s, LLM: 17.11s)
2025-11-30 21:32:49,444 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 17.11s
2025-11-30 21:32:49,444 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:32:49,444 - src.pipeline.kg_builder - INFO - Pushing batch 60/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:32:49,444 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:32:49,637 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=549, relationships=524
2025-11-30 21:32:49,637 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:32:49,637 - src.components.neo4j_handler - DEBUG - APOC merge successful: Tube -> Flexible Tube
2025-11-30 21:32:49,641 - src.components.neo4j_handler - DEBUG - APOC merge successful: Flask -> Glass_Flask
2025-11-30 21:32:49,644 - src.components.neo4j_handler - DEBUG - APOC merge successful: Beaker -> White Plastic Beaker
2025-11-30 21:32:49,647 - src.components.neo4j_handler - DEBUG - APOC merge successful: Apparatus -> Vacuum Filtration Setup
2025-11-30 21:32:49,647 - src.components.neo4j_handler - INFO - Applying 7 prune instructions
2025-11-30 21:32:49,651 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Large Jug
2025-11-30 21:32:49,652 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[OPENS]-> Glass_Draft_Shield
2025-11-30 21:32:49,655 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[INTERACTS_WITH]-> Magnetic_Stirrer
2025-11-30 21:32:49,656 - src.components.neo4j_handler - DEBUG - Pruned relationship: Document -[IS_ON]-> Lab Bench
2025-11-30 21:32:49,657 - src.components.neo4j_handler - DEBUG - Pruned relationship: Lab Bench -[CONTAINS]-> Glass_Volumetric_Flask
2025-11-30 21:32:49,658 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Large Jug -[CONTAINS]-> Chemical Substance
2025-11-30 21:32:49,684 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Chemical Substance -[FLOWS_INTO]-> Large Jug
2025-11-30 21:32:49,684 - src.components.neo4j_handler - INFO - Applying 10 inter-chunk relations
2025-11-30 21:32:49,686 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: White Plastic Beaker -[Rests On]-> Laboratory Table
2025-11-30 21:32:49,687 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Laboratory Table -[Holds]-> Container With Red Liquid
2025-11-30 21:32:49,688 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Beaker -[Rests On]-> Magnetic_Stirrer
2025-11-30 21:32:49,720 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Magnetic_Stirrer -[Supports]-> Glass_Flask
2025-11-30 21:32:49,722 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Glass_Flask -[Is Held By]-> Clamp
2025-11-30 21:32:49,724 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Clamp -[Is Part Of]-> Metal_Stand
2025-11-30 21:32:49,751 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Observes]-> Experiment
2025-11-30 21:32:49,777 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Flask -[Is Connected To]-> Apparatus
2025-11-30 21:32:49,778 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Apparatus -[Contains]-> Long Tube
2025-11-30 21:32:49,780 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Liquid -[Is Added To]-> Flask
2025-11-30 21:32:49,780 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:32:49,785 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=544, relationships=518
2025-11-30 21:32:49,787 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:32:49,787 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:32:49,787 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:32:49,787 - src.components.neo4j_handler - INFO - Batch injected in 0.34s (triplets: 0.34s, indexes: 0.00s)
2025-11-30 21:32:49,790 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 276, 'with_embedding': 276, 'linked_chunks': 216}
2025-11-30 21:32:49,790 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:32:49,853 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:32:50,171 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 484 nodes
2025-11-30 21:32:50,204 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 544, 'relationship_count': 1650, 'density': 0.0056, 'avg_degree': 6.0662, 'avg_unique_neighbors': 5.9743, 'global_efficiency': 0.2942, 'avg_path_length': 2.767, 'avg_degree_centrality': 0.0112, 'max_degree_centrality': 0.5138, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0607, 'degree_assortativity': -0.175, 'graph_robustness': 0.8164, 'diameter_estimate': 50, 'clustering_coefficient': 0.2563, 'weakly_connected_components': 61, 'largest_wcc_size': 484, 'pagerank_top10_percent': 6.01, 'louvain_communities': 74, 'louvain_modularity': 0.4263, 'label_entropy': 1.4999, 'computational_time': 0.41380496392957866}
2025-11-30 21:32:50,204 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 59, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509570.2047179, 'total_time': 24.250229657976888, 'aggregation': 4.161032848060131e-06, 'network_info': 0.006859277025796473, 'llm_extraction': 23.482788784895092, 'data_cleaning': 1.497205812484026e-05, 'neo4j_injection': 0.3436929030576721, 'embedding_time': 0, 'indexing_time': 0.002410255023278296, 'graph_injection_time': 0.34108898299746215, 'acs_metrics': {'node_count': 544, 'relationship_count': 1650, 'density': 0.0056, 'avg_degree': 6.0662, 'avg_unique_neighbors': 5.9743, 'global_efficiency': 0.2942, 'avg_path_length': 2.767, 'avg_degree_centrality': 0.0112, 'max_degree_centrality': 0.5138, 'avg_betweenness_centrality': 0.0006, 'max_betweenness_centrality': 0.0607, 'degree_assortativity': -0.175, 'graph_robustness': 0.8164, 'diameter_estimate': 50, 'clustering_coefficient': 0.2563, 'weakly_connected_components': 61, 'largest_wcc_size': 484, 'pagerank_top10_percent': 6.01, 'louvain_communities': 74, 'louvain_modularity': 0.4263, 'label_entropy': 1.4999, 'computational_time': 0.41380496392957866}, 'retrieval_queries': []}
2025-11-30 21:32:50,204 - src.pipeline.kg_builder - DEBUG - Batch 59 metrics: {
  "batch_idx": 59,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509570.2047179,
  "total_time": 24.250229657976888,
  "aggregation": 4.161032848060131e-06,
  "network_info": 0.006859277025796473,
  "llm_extraction": 23.482788784895092,
  "data_cleaning": 1.497205812484026e-05,
  "neo4j_injection": 0.3436929030576721,
  "embedding_time": 0,
  "indexing_time": 0.002410255023278296,
  "graph_injection_time": 0.34108898299746215,
  "acs_metrics": {
    "node_count": 544,
    "relationship_count": 1650,
    "density": 0.0056,
    "avg_degree": 6.0662,
    "avg_unique_neighbors": 5.9743,
    "global_efficiency": 0.2942,
    "avg_path_length": 2.767,
    "avg_degree_centrality": 0.0112,
    "max_degree_centrality": 0.5138,
    "avg_betweenness_centrality": 0.0006,
    "max_betweenness_centrality": 0.0607,
    "degree_assortativity": -0.175,
    "graph_robustness": 0.8164,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2563,
    "weakly_connected_components": 61,
    "largest_wcc_size": 484,
    "pagerank_top10_percent": 6.01,
    "louvain_communities": 74,
    "louvain_modularity": 0.4263,
    "label_entropy": 1.4999,
    "computational_time": 0.41380496392957866
  },
  "retrieval_queries": []
}
2025-11-30 21:32:50,205 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:32:50,205 - src.pipeline.kg_builder - INFO - Batch 60 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 23.48s, Clean: 0.00s, Neo4j: 0.34s, ACS: 0.41s
2025-11-30 21:32:50,205 - src.pipeline.kg_builder - INFO - Batch 60 completed in 24.25s
Processing KG batches:  83%|████████▎ | 60/72 [25:53<05:07, 25.66s/it]2025-11-30 21:32:50,206 - src.pipeline.kg_builder - INFO - Processing batch 61/72 (3 items)
2025-11-30 21:32:50,206 - src.pipeline.kg_builder - DEBUG - Batch 61 current_video_time: 15:07-15:12
2025-11-30 21:32:50,212 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 544
- Total Relationships: 518
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:32:50,213 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:32:50,213 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_60_0 ~232 words, content: Time: 14:57-15:02 Content: The video sequence captures a scientific procedure, likely a chemical experiment or a sample preparation process, taking place in a laboratory setting....
2025-11-30 21:32:50,213 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_60_1 ~235 words, content: . - **Frame 4:** The person continues to handle the tube, ensuring it is properly aligned. The liquid is being transferred from the beaker into...
2025-11-30 21:32:50,213 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_60_2 ~234 words, content: or transferring a solution. - **Frame 2:** The person adjusts the tube, which is now forming a large loop. The apparatus is positioned on a...
2025-11-30 21:32:50,213 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_60_3 ~108 words, content: flexible, transparent tube, which appears to be a pipette or a transfer tube. The person is carefully manipulating the tube, ensuring it is properly positioned...
2025-11-30 21:32:50,233 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:32:50,338 - src.components.pre_llm_injector - DEBUG - Found 276 existing chunk embeddings for similarity lookup
2025-11-30 21:32:50,399 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_2', '0.804'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_4', '0.773')]
2025-11-30 21:32:50,401 - src.components.pre_llm_injector - DEBUG - Found 4 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_2
2025-11-30 21:32:50,401 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:32:50,402 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_4 via source_chunk_ids
2025-11-30 21:32:50,421 - src.components.pre_llm_injector - DEBUG - Limited Person from 134 to 2 external connections
2025-11-30 21:32:50,421 - src.components.pre_llm_injector - DEBUG - Limited Digital Balance from 13 to 2 external connections
2025-11-30 21:32:50,421 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 157 total -> 14 (internal: 9, external: 5)
2025-11-30 21:32:50,421 - src.components.pre_llm_injector - DEBUG - Subgraph: (Digital Balance / ID: 16_1)-[DISPLAYS]->(0.000 G / ID: 37_0), (Person / ID: 0_0)-[WEARS]->(Digital Balance / ID: 16_1), (Person / ID: 0_0)-[USES]->(Digital Balance / ID: 16_1), (Person / ID: 0_0)-[WEARS]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[WEARS]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[WEARS]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[WEARS]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[HOLDS]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[USES]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[USES]->(Wash_Bottle / ID: 11_1), (Person / ID: 0_0)-[HOLDS]->(Test Tube / ID: 2_0), (Digital Balance / ID: 16_1)-[DISPLAYS]->(80.15 G / ID: 10_0), (Liquid_In_Small_Container / ID: 5_0)-[IS_HELD_OVER]->(Digital Balance / ID: 16_1), (Mettler Toledo / ID: 31_1)-[DISPLAYS]->(0.000 G / ID: 37_0)
2025-11-30 21:32:50,421 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_2', '0.804'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_4', '0.773')]
2025-11-30 21:32:50,421 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.649'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_3', '0.628')]
2025-11-30 21:32:50,422 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_1', '0.657'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_2', '0.632')]
2025-11-30 21:32:50,422 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_3', '0.747'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_53_2', '0.722')]
2025-11-30 21:32:50,422 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:32:50,422 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_60_0) (~232 words) with timeout=5.0s retries=3
2025-11-30 21:32:51,794 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:32:51,794 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:32:51,794 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_60_1) (~235 words) with timeout=5.0s retries=3
2025-11-30 21:32:52,743 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:32:52,743 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:32:52,743 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_60_2) (~234 words) with timeout=5.0s retries=3
2025-11-30 21:32:53,787 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:32:53,787 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:32:53,787 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_60_3) (~108 words) with timeout=5.0s retries=3
2025-11-30 21:32:54,809 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:32:54,809 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:32:54,810 - src.components.pre_llm_injector - INFO - Extracted 20 local triplets from 4 chunks
2025-11-30 21:32:54,810 - src.pipeline.kg_builder - INFO - Pre-extraction: 20 triplets in 4.60s
2025-11-30 21:32:54,810 - src.components.global_refiner - INFO - Capping refinement input: 20 → 15 triplets
2025-11-30 21:32:54,810 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Digital Balance / ID: 16_1)-[DISPLAYS]->(0.000 G / ID: 37_0), (Person / ID: 0_0)-[WEARS]->(Digital Balance / ID: 16_1), (Person / ID: 0_0)-[USES]->(Digital Balance / ID: 16_1), (Person / ID: 0_0)-[WEARS]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[WEARS]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[WEARS]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[WEARS]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[HOLDS]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[USES]->(Blue Nitrile Gloves / ID: 40_0), (Person / ID: 0_0)-[USES]->(Wash_Bottle / ID: 11_1), (Person / ID: 0_0)-[HOLDS]->(Test Tube / ID: 2_0), (Digital Balance / ID: 16_1)-[DISPLAYS]->(80.15 G / ID: 10_0), (Liquid_In_Small_Container / ID: 5_0)-[IS_HELD_OVER]->(Digital Balance / ID: 16_1), (Mettler Toledo / ID: 31_1)-[DISPLAYS]->(0.000 G / ID: 37_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["60_0", "60_2"]}, {"head": "Person", "relation": "Holds", "tail": "Transparent_Tube", "source_chunks": ["60_0"]}, {"head": "Transparent_Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["60_0"]}, {"head": "Liquid", "relation": "Flows Into", "tail": "White_Plastic_Container", "source_chunks": ["60_0"]}, {"head": "Equipment", "relation": "Mounted On", "tail": "Metal_Stand", "source_chunks": ["60_0"]}, {"head": "Metal_Stand", "relation": "Supports", "tail": "Yellow_And_Blue_Apparatus", "source_chunks": ["60_0"]}, {"head": "Person", "relation": "Holds", "tail": "Tube", "source_chunks": ["60_1", "60_2"]}, {"head": "Tube", "relation": "Connects", "tail": "Beaker", "source_chunks": ["60_1"]}, {"head": "Tube", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["60_1", "60_2", "60_3"]}, {"head": "Person", "relation": "Wears", "tail": "Gloves", "source_chunks": ["60_1"]}, {"head": "Person", "relation": "Manipulates", "tail": "Apparatus", "source_chunks": ["60_1"]}, {"head": "Apparatus", "relation": "Contains", "tail": "Liquid", "source_chunks": ["60_1"]}, {"head": "Tube", "relation": "Connects", "tail": "Flask", "source_chunks": ["60_2"]}, {"head": "Flask", "relation": "Receives", "tail": "Liquid", "source_chunks": ["60_2"]}, {"head": "Apparatus", "relation": "Contains", "tail": "Beaker", "source_chunks": ["60_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:32:54,810 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~426 words, ~554 tokens)
2025-11-30 21:32:54,811 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:33:15,555 - src.components.global_refiner - DEBUG - LLM call completed in 20.74s
2025-11-30 21:33:15,556 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['60_0', '60_2']], ['Person', 'Holds', 'Transparent_Tube', ['60_0']], ['Transparent_Tube', 'Transfers', 'Liquid', ['60_0']], ['Liquid', 'Flows Into', 'White_Plastic_Container', ['60_0']], ['Equipment', 'Mounted On', 'Metal_Stand', ['60_0']], ['Metal_Stand', 'Supports', 'Yellow_And_Blue_Apparatus', ['60_0']], ['Person', 'Holds', 'Tube', ['60_1', '60_2']], ['Tube', 'Connects', 'Beaker', ['60_1']], ['Tube', 'Transfers', 'Liquid', ['60_1', '60_2', '60_3']], ['Person', 'Wears', 'Gloves', ['60_1']], ['Person', 'Manipulates', 'Apparatus', ['60_1']], ['Apparatus', 'Contains', 'Liquid', ['60_1']], ['Tube', 'Connects', 'Flask', ['60_2']], ['Flask', 'Receives', 'Liquid', ['60_2']], ['Apparatus', 'Contains', 'Beaker', ['60_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue Nitrile Gloves', ['60_0', '60_2']], ['Person', 'Holds', 'Test Tube', ['60_0']], ['Liquid', 'Flows Into', 'White Plastic Container', ['60_0']], ['Equipment', 'Mounted On', 'Metal Stand', ['60_0']], ['Metal Stand', 'Supports', 'Yellow And Blue Apparatus', ['60_0']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '40_0'}, {'local': 'Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '40_0'}, {'local': 'Transparent_Tube', 'existing': 'Test Tube', 'existing_id': '2_0'}, {'local': 'Tube', 'existing': 'Test Tube', 'existing_id': '2_0'}] prune_instructions=[{'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Wash_Bottle'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Test Tube'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Wash_Bottle'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Test Tube'}]
2025-11-30 21:33:15,556 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['60_0', '60_2']], ['Person', 'Holds', 'Transparent_Tube', ['60_0']], ['Transparent_Tube', 'Transfers', 'Liquid', ['60_0']]]
2025-11-30 21:33:15,556 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Person', 'Wears', 'Blue Nitrile Gloves', ['60_0', '60_2']], ['Person', 'Holds', 'Test Tube', ['60_0']], ['Liquid', 'Flows Into', 'White Plastic Container', ['60_0']]]
2025-11-30 21:33:15,556 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '40_0'}, {'local': 'Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '40_0'}, {'local': 'Transparent_Tube', 'existing': 'Test Tube', 'existing_id': '2_0'}]
2025-11-30 21:33:15,556 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=18, sample=[{'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}]
2025-11-30 21:33:15,556 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '40_0'}, {'local': 'Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '40_0'}, {'local': 'Transparent_Tube', 'existing': 'Test Tube', 'existing_id': '2_0'}, {'local': 'Tube', 'existing': 'Test Tube', 'existing_id': '2_0'}]
2025-11-30 21:33:15,556 - src.components.global_refiner - INFO - LLM suggested 18 triplets to prune: [{'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Wash_Bottle'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Test Tube'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Person', 'relation': 'USES', 'tail': 'Wash_Bottle'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Test Tube'}]
2025-11-30 21:33:15,556 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 20.75s, LLM: 20.74s)
2025-11-30 21:33:15,556 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 20.75s
2025-11-30 21:33:15,556 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:33:15,556 - src.pipeline.kg_builder - INFO - Pushing batch 61/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:33:15,556 - src.components.neo4j_handler - INFO - Adding 20 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:33:15,787 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=558, relationships=535
2025-11-30 21:33:15,787 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:33:15,788 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Nitrile Gloves
2025-11-30 21:33:15,792 - src.components.neo4j_handler - DEBUG - APOC merge successful: Gloves -> Blue Nitrile Gloves
2025-11-30 21:33:15,796 - src.components.neo4j_handler - DEBUG - APOC merge successful: Transparent_Tube -> Test Tube
2025-11-30 21:33:15,800 - src.components.neo4j_handler - DEBUG - APOC merge successful: Tube -> Test Tube
2025-11-30 21:33:15,800 - src.components.neo4j_handler - INFO - Applying 18 prune instructions
2025-11-30 21:33:15,804 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[WEARS]-> Blue Nitrile Gloves
2025-11-30 21:33:15,805 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[WEARS]-> Blue Nitrile Gloves
2025-11-30 21:33:15,806 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[WEARS]-> Blue Nitrile Gloves
2025-11-30 21:33:15,807 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[WEARS]-> Blue Nitrile Gloves
2025-11-30 21:33:15,808 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[WEARS]-> Blue Nitrile Gloves
2025-11-30 21:33:15,809 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[HOLDS]-> Blue Nitrile Gloves
2025-11-30 21:33:15,811 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[USES]-> Blue Nitrile Gloves
2025-11-30 21:33:15,813 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[USES]-> Wash_Bottle
2025-11-30 21:33:15,816 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[HOLDS]-> Test Tube
2025-11-30 21:33:15,817 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[WEARS]-> Blue Nitrile Gloves
2025-11-30 21:33:15,818 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[WEARS]-> Blue Nitrile Gloves
2025-11-30 21:33:15,819 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[WEARS]-> Blue Nitrile Gloves
2025-11-30 21:33:15,819 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[WEARS]-> Blue Nitrile Gloves
2025-11-30 21:33:15,820 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[WEARS]-> Blue Nitrile Gloves
2025-11-30 21:33:15,820 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[HOLDS]-> Blue Nitrile Gloves
2025-11-30 21:33:15,820 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[USES]-> Blue Nitrile Gloves
2025-11-30 21:33:15,821 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[USES]-> Wash_Bottle
2025-11-30 21:33:15,821 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[HOLDS]-> Test Tube
2025-11-30 21:33:15,821 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:33:15,822 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue Nitrile Gloves
2025-11-30 21:33:15,824 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Test Tube
2025-11-30 21:33:15,851 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Liquid -[Flows Into]-> White Plastic Container
2025-11-30 21:33:15,877 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Equipment -[Mounted On]-> Metal Stand
2025-11-30 21:33:15,879 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Metal Stand -[Supports]-> Yellow And Blue Apparatus
2025-11-30 21:33:15,880 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:33:15,887 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=554, relationships=525
2025-11-30 21:33:15,889 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:33:15,889 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:33:15,889 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:33:15,889 - src.components.neo4j_handler - INFO - Batch injected in 0.33s (triplets: 0.33s, indexes: 0.00s)
2025-11-30 21:33:15,890 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 280, 'with_embedding': 280, 'linked_chunks': 220}
2025-11-30 21:33:15,890 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:33:15,982 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:33:16,304 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 494 nodes
2025-11-30 21:33:16,336 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 554, 'relationship_count': 1687, 'density': 0.0055, 'avg_degree': 6.0903, 'avg_unique_neighbors': 6.0, 'global_efficiency': 0.2933, 'avg_path_length': 2.775, 'avg_degree_centrality': 0.011, 'max_degree_centrality': 0.5081, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0357, 'degree_assortativity': -0.169, 'graph_robustness': 0.8441, 'diameter_estimate': 50, 'clustering_coefficient': 0.2572, 'weakly_connected_components': 61, 'largest_wcc_size': 494, 'pagerank_top10_percent': 6.13, 'louvain_communities': 73, 'louvain_modularity': 0.4166, 'label_entropy': 1.5, 'computational_time': 0.4458134819287807}
2025-11-30 21:33:16,336 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 60, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509596.3365474, 'total_time': 26.13050684297923, 'aggregation': 4.0809391066432e-06, 'network_info': 0.006682291976176202, 'llm_extraction': 25.343569790013134, 'data_cleaning': 2.0397012121975422e-05, 'neo4j_injection': 0.3328775139525533, 'embedding_time': 0, 'indexing_time': 0.002264045993797481, 'graph_injection_time': 0.33038246200885624, 'acs_metrics': {'node_count': 554, 'relationship_count': 1687, 'density': 0.0055, 'avg_degree': 6.0903, 'avg_unique_neighbors': 6.0, 'global_efficiency': 0.2933, 'avg_path_length': 2.775, 'avg_degree_centrality': 0.011, 'max_degree_centrality': 0.5081, 'avg_betweenness_centrality': 0.0005, 'max_betweenness_centrality': 0.0357, 'degree_assortativity': -0.169, 'graph_robustness': 0.8441, 'diameter_estimate': 50, 'clustering_coefficient': 0.2572, 'weakly_connected_components': 61, 'largest_wcc_size': 494, 'pagerank_top10_percent': 6.13, 'louvain_communities': 73, 'louvain_modularity': 0.4166, 'label_entropy': 1.5, 'computational_time': 0.4458134819287807}, 'retrieval_queries': []}
2025-11-30 21:33:16,336 - src.pipeline.kg_builder - DEBUG - Batch 60 metrics: {
  "batch_idx": 60,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509596.3365474,
  "total_time": 26.13050684297923,
  "aggregation": 4.0809391066432e-06,
  "network_info": 0.006682291976176202,
  "llm_extraction": 25.343569790013134,
  "data_cleaning": 2.0397012121975422e-05,
  "neo4j_injection": 0.3328775139525533,
  "embedding_time": 0,
  "indexing_time": 0.002264045993797481,
  "graph_injection_time": 0.33038246200885624,
  "acs_metrics": {
    "node_count": 554,
    "relationship_count": 1687,
    "density": 0.0055,
    "avg_degree": 6.0903,
    "avg_unique_neighbors": 6.0,
    "global_efficiency": 0.2933,
    "avg_path_length": 2.775,
    "avg_degree_centrality": 0.011,
    "max_degree_centrality": 0.5081,
    "avg_betweenness_centrality": 0.0005,
    "max_betweenness_centrality": 0.0357,
    "degree_assortativity": -0.169,
    "graph_robustness": 0.8441,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2572,
    "weakly_connected_components": 61,
    "largest_wcc_size": 494,
    "pagerank_top10_percent": 6.13,
    "louvain_communities": 73,
    "louvain_modularity": 0.4166,
    "label_entropy": 1.5,
    "computational_time": 0.4458134819287807
  },
  "retrieval_queries": []
}
2025-11-30 21:33:16,337 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:33:16,337 - src.pipeline.kg_builder - INFO - Batch 61 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 25.34s, Clean: 0.00s, Neo4j: 0.33s, ACS: 0.45s
2025-11-30 21:33:16,337 - src.pipeline.kg_builder - INFO - Batch 61 completed in 26.13s
Processing KG batches:  85%|████████▍ | 61/72 [26:19<04:43, 25.80s/it]2025-11-30 21:33:16,337 - src.pipeline.kg_builder - INFO - Processing batch 62/72 (3 items)
2025-11-30 21:33:16,337 - src.pipeline.kg_builder - DEBUG - Batch 62 current_video_time: 15:22-15:27
2025-11-30 21:33:16,345 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 554
- Total Relationships: 525
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:33:16,345 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:33:16,346 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_61_0 ~217 words, content: Time: 15:12-15:17 Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a procedure on a black lab bench. The...
2025-11-30 21:33:16,346 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_61_1 ~232 words, content: . Time: 15:17-15:22 Content: The video sequence captures a scientific procedure, likely a chemical experiment, taking place on a laboratory bench. The frames show a...
2025-11-30 21:33:16,346 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_61_2 ~239 words, content: pieces of equipment and glassware in the background. In summary, the video shows a chemical reaction that produces a gas. The gas is being collected...
2025-11-30 21:33:16,346 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_61_3 ~33 words, content: different perspectives of the experiment. In the final frame, a person with dark, curly hair is seen sitting at the bench, observing the experiment. The...
2025-11-30 21:33:16,366 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:33:16,467 - src.components.pre_llm_injector - DEBUG - Found 280 existing chunk embeddings for similarity lookup
2025-11-30 21:33:16,526 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.823'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_3', '0.822')]
2025-11-30 21:33:16,528 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_3 via source_chunk_ids
2025-11-30 21:33:16,529 - src.components.pre_llm_injector - DEBUG - Found 4 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1
2025-11-30 21:33:16,529 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:33:16,549 - src.components.pre_llm_injector - DEBUG - Limited Person from 132 to 2 external connections
2025-11-30 21:33:16,549 - src.components.pre_llm_injector - DEBUG - Limited Magnetic_Stirrer from 20 to 2 external connections
2025-11-30 21:33:16,549 - src.components.pre_llm_injector - DEBUG - Limited Equipment from 18 to 2 external connections
2025-11-30 21:33:16,549 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 176 total -> 12 (internal: 5, external: 7)
2025-11-30 21:33:16,549 - src.components.pre_llm_injector - DEBUG - Subgraph: (Equipment / ID: 1_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[HANDLES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[TARES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[USES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[HANDLES]->(Small Container / ID: 31_0), (Person / ID: 0_0)-[HOLDS]->(Reagent_Vial / ID: 27_0), (Liquid_In_Small_Container / ID: 5_0)-[IS_ON]->(Magnetic_Stirrer / ID: 4_2), (Magnetic_Stirrer / ID: 4_2)-[CONTAINS]->(Liquid_In_Small_Container / ID: 5_0), (Mass Of Liquid / ID: 15_1)-[IS_PART_OF]->(Chemical_Solution / ID: 5_1), (Equipment / ID: 1_0)-[INCLUDES]->(Lab / ID: 29_0), (Equipment / ID: 1_0)-[CONTAINS]->(General Reagent / ID: 6_1)
2025-11-30 21:33:16,549 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_51_1', '0.814'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_19_1', '0.802')]
2025-11-30 21:33:16,549 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.823'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_3', '0.822')]
2025-11-30 21:33:16,549 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_1', '0.796'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_3', '0.793')]
2025-11-30 21:33:16,549 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_3', '0.775'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.764')]
2025-11-30 21:33:16,549 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:33:16,549 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_61_0) (~217 words) with timeout=5.0s retries=3
2025-11-30 21:33:17,998 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:33:17,998 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:33:17,998 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_61_1) (~232 words) with timeout=5.0s retries=3
2025-11-30 21:33:19,057 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:33:19,058 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:33:19,058 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_61_2) (~239 words) with timeout=5.0s retries=3
2025-11-30 21:33:20,281 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:33:20,282 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:33:20,282 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_61_3) (~33 words) with timeout=5.0s retries=3
2025-11-30 21:33:21,132 - src.components.pre_llm_injector - DEBUG - Extracted 5 triplets from chunk 3 (attempt 1)
2025-11-30 21:33:21,132 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 5 triplets
2025-11-30 21:33:21,132 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 4 chunks
2025-11-30 21:33:21,132 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 4.79s
2025-11-30 21:33:21,132 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 21:33:21,132 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Equipment / ID: 1_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[HANDLES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[TARES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[USES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[HANDLES]->(Small Container / ID: 31_0), (Person / ID: 0_0)-[HOLDS]->(Reagent_Vial / ID: 27_0), (Liquid_In_Small_Container / ID: 5_0)-[IS_ON]->(Magnetic_Stirrer / ID: 4_2), (Magnetic_Stirrer / ID: 4_2)-[CONTAINS]->(Liquid_In_Small_Container / ID: 5_0), (Mass Of Liquid / ID: 15_1)-[IS_PART_OF]->(Chemical_Solution / ID: 5_1), (Equipment / ID: 1_0)-[INCLUDES]->(Lab / ID: 29_0), (Equipment / ID: 1_0)-[CONTAINS]->(General Reagent / ID: 6_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["61_0"]}, {"head": "Person", "relation": "Holds", "tail": "Translucent_Tube", "source_chunks": ["61_0"]}, {"head": "Translucent_Tube", "relation": "Is Inserted Into", "tail": "Measuring_Cup", "source_chunks": ["61_0"]}, {"head": "Measuring_Cup", "relation": "Contains", "tail": "Transparent_Liquid", "source_chunks": ["61_0"]}, {"head": "Person", "relation": "Uses", "tail": "Blue_Device", "source_chunks": ["61_0"]}, {"head": "Lab_Bench", "relation": "Contains", "tail": "Glass_Beaker", "source_chunks": ["61_0"]}, {"head": "Camera", "relation": "Captures", "tail": "Scientific Procedure", "source_chunks": ["61_1"]}, {"head": "Plastic Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["61_1"]}, {"head": "Tube", "relation": "Delivers", "tail": "Substance", "source_chunks": ["61_1"]}, {"head": "Inverted Beaker", "relation": "Collects", "tail": "Gas", "source_chunks": ["61_1"]}, {"head": "Tube", "relation": "Connects", "tail": "Electronic Device", "source_chunks": ["61_1"]}, {"head": "Laboratory Bench", "relation": "Holds", "tail": "Experiment Setup", "source_chunks": ["61_1"]}, {"head": "Glass Flask", "relation": "Is Heated On", "tail": "Magnetic Stirrer", "source_chunks": ["61_2"]}, {"head": "Magnetic Stirrer", "relation": "Is On", "tail": "Blue Base", "source_chunks": ["61_2"]}, {"head": "Tube", "relation": "Connects", "tail": "Glass Flask", "source_chunks": ["61_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:33:21,132 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~404 words, ~525 tokens)
2025-11-30 21:33:21,132 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:33:44,834 - src.components.global_refiner - DEBUG - LLM call completed in 23.70s
2025-11-30 21:33:44,834 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['61_0']], ['Person', 'Holds', 'Translucent_Tube', ['61_0']], ['Translucent_Tube', 'Is Inserted Into', 'Measuring_Cup', ['61_0']], ['Measuring_Cup', 'Contains', 'Transparent_Liquid', ['61_0']], ['Person', 'Uses', 'Blue_Device', ['61_0']], ['Lab_Bench', 'Contains', 'Glass_Beaker', ['61_0']], ['Camera', 'Captures', 'Scientific Procedure', ['61_1']], ['Plastic Container', 'Contains', 'Liquid', ['61_1']], ['Tube', 'Delivers', 'Substance', ['61_1']], ['Inverted Beaker', 'Collects', 'Gas', ['61_1']], ['Tube', 'Connects', 'Electronic Device', ['61_1']], ['Laboratory Bench', 'Holds', 'Experiment Setup', ['61_1']], ['Glass Flask', 'Is Heated On', 'Magnetic Stirrer', ['61_2']], ['Magnetic Stirrer', 'Is On', 'Blue Base', ['61_2']], ['Tube', 'Connects', 'Glass Flask', ['61_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['61_0']], ['Person', 'Holds', 'Translucent_Tube', ['61_0']], ['Translucent_Tube', 'Is Inserted Into', 'Measuring_Cup', ['61_0']], ['Measuring_Cup', 'Contains', 'Transparent_Liquid', ['61_0']], ['Person', 'Uses', 'Blue_Device', ['61_0']], ['Lab_Bench', 'Contains', 'Glass_Beaker', ['61_0']], ['Camera', 'Captures', 'Scientific Procedure', ['61_1']], ['Plastic Container', 'Contains', 'Liquid', ['61_1']], ['Tube', 'Delivers', 'Substance', ['61_1']], ['Inverted Beaker', 'Collects', 'Gas', ['61_1']], ['Tube', 'Connects', 'Electronic Device', ['61_1']], ['Laboratory Bench', 'Holds', 'Experiment Setup', ['61_1']], ['Glass Flask', 'Is Heated On', 'Magnetic Stirrer', ['61_2']], ['Magnetic Stirrer', 'Is On', 'Blue Base', ['61_2']], ['Tube', 'Connects', 'Glass Flask', ['61_2']]] merge_instructions=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_0'}, {'local': 'Translucent_Tube', 'existing': 'Translucent_Tube', 'existing_id': '0_0'}, {'local': 'Measuring_Cup', 'existing': 'Measuring_Cup', 'existing_id': '0_0'}, {'local': 'Blue_Device', 'existing': 'Blue_Device', 'existing_id': '0_0'}, {'local': 'Lab_Bench', 'existing': 'Lab_Bench', 'existing_id': '0_0'}, {'local': 'Camera', 'existing': 'Camera', 'existing_id': '0_0'}, {'local': 'Plastic Container', 'existing': 'Plastic Container', 'existing_id': '0_0'}, {'local': 'Tube', 'existing': 'Tube', 'existing_id': '0_0'}, {'local': 'Inverted Beaker', 'existing': 'Inverted Beaker', 'existing_id': '0_0'}, {'local': 'Electronic Device', 'existing': 'Electronic Device', 'existing_id': '0_0'}, {'local': 'Laboratory Bench', 'existing': 'Laboratory Bench', 'existing_id': '0_0'}, {'local': 'Glass Flask', 'existing': 'Glass Flask', 'existing_id': '0_0'}, {'local': 'Magnetic Stirrer', 'existing': 'Magnetic Stirrer', 'existing_id': '4_2'}, {'local': 'Blue Base', 'existing': 'Blue Base', 'existing_id': '0_0'}] prune_instructions=[{'entity': 'Blue_Nitrile_Gloves'}, {'entity': 'Translucent_Tube'}, {'entity': 'Measuring_Cup'}, {'entity': 'Blue_Device'}, {'entity': 'Lab_Bench'}, {'entity': 'Camera'}, {'entity': 'Plastic Container'}, {'entity': 'Tube'}, {'entity': 'Inverted Beaker'}, {'entity': 'Electronic Device'}, {'entity': 'Laboratory Bench'}, {'entity': 'Glass Flask'}, {'entity': 'Magnetic Stirrer'}, {'entity': 'Blue Base'}]
2025-11-30 21:33:44,834 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['61_0']], ['Person', 'Holds', 'Translucent_Tube', ['61_0']], ['Translucent_Tube', 'Is Inserted Into', 'Measuring_Cup', ['61_0']]]
2025-11-30 21:33:44,834 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['61_0']], ['Person', 'Holds', 'Translucent_Tube', ['61_0']], ['Translucent_Tube', 'Is Inserted Into', 'Measuring_Cup', ['61_0']]]
2025-11-30 21:33:44,834 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=14, sample=[{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_0'}, {'local': 'Translucent_Tube', 'existing': 'Translucent_Tube', 'existing_id': '0_0'}, {'local': 'Measuring_Cup', 'existing': 'Measuring_Cup', 'existing_id': '0_0'}]
2025-11-30 21:33:44,834 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=14, sample=[{'entity': 'Blue_Nitrile_Gloves'}, {'entity': 'Translucent_Tube'}, {'entity': 'Measuring_Cup'}]
2025-11-30 21:33:44,834 - src.components.global_refiner - INFO - LLM suggested 14 entity merges: [{'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue_Nitrile_Gloves', 'existing_id': '0_0'}, {'local': 'Translucent_Tube', 'existing': 'Translucent_Tube', 'existing_id': '0_0'}, {'local': 'Measuring_Cup', 'existing': 'Measuring_Cup', 'existing_id': '0_0'}, {'local': 'Blue_Device', 'existing': 'Blue_Device', 'existing_id': '0_0'}, {'local': 'Lab_Bench', 'existing': 'Lab_Bench', 'existing_id': '0_0'}, {'local': 'Camera', 'existing': 'Camera', 'existing_id': '0_0'}, {'local': 'Plastic Container', 'existing': 'Plastic Container', 'existing_id': '0_0'}, {'local': 'Tube', 'existing': 'Tube', 'existing_id': '0_0'}, {'local': 'Inverted Beaker', 'existing': 'Inverted Beaker', 'existing_id': '0_0'}, {'local': 'Electronic Device', 'existing': 'Electronic Device', 'existing_id': '0_0'}, {'local': 'Laboratory Bench', 'existing': 'Laboratory Bench', 'existing_id': '0_0'}, {'local': 'Glass Flask', 'existing': 'Glass Flask', 'existing_id': '0_0'}, {'local': 'Magnetic Stirrer', 'existing': 'Magnetic Stirrer', 'existing_id': '4_2'}, {'local': 'Blue Base', 'existing': 'Blue Base', 'existing_id': '0_0'}]
2025-11-30 21:33:44,834 - src.components.global_refiner - INFO - LLM suggested 14 triplets to prune: [{'entity': 'Blue_Nitrile_Gloves'}, {'entity': 'Translucent_Tube'}, {'entity': 'Measuring_Cup'}, {'entity': 'Blue_Device'}, {'entity': 'Lab_Bench'}, {'entity': 'Camera'}, {'entity': 'Plastic Container'}, {'entity': 'Tube'}, {'entity': 'Inverted Beaker'}, {'entity': 'Electronic Device'}, {'entity': 'Laboratory Bench'}, {'entity': 'Glass Flask'}, {'entity': 'Magnetic Stirrer'}, {'entity': 'Blue Base'}]
2025-11-30 21:33:44,834 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 30 triplets (total: 23.70s, LLM: 23.70s)
2025-11-30 21:33:44,834 - src.pipeline.kg_builder - INFO - Global refinement: 30 triplets in 23.70s
2025-11-30 21:33:44,834 - src.pipeline.kg_builder - INFO - Using 30 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:33:44,835 - src.pipeline.kg_builder - INFO - Pushing batch 62/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:33:44,835 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:33:45,019 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=574, relationships=540
2025-11-30 21:33:45,019 - src.components.neo4j_handler - INFO - Applying 14 merge instructions
2025-11-30 21:33:45,019 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue_Nitrile_Gloves -> Blue_Nitrile_Gloves
2025-11-30 21:33:45,019 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Translucent_Tube -> Translucent_Tube
2025-11-30 21:33:45,019 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Measuring_Cup -> Measuring_Cup
2025-11-30 21:33:45,019 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue_Device -> Blue_Device
2025-11-30 21:33:45,019 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Lab_Bench -> Lab_Bench
2025-11-30 21:33:45,019 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Camera -> Camera
2025-11-30 21:33:45,019 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Plastic Container -> Plastic Container
2025-11-30 21:33:45,019 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Tube -> Tube
2025-11-30 21:33:45,019 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Inverted Beaker -> Inverted Beaker
2025-11-30 21:33:45,019 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Electronic Device -> Electronic Device
2025-11-30 21:33:45,019 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Laboratory Bench -> Laboratory Bench
2025-11-30 21:33:45,020 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Glass Flask -> Glass Flask
2025-11-30 21:33:45,020 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Magnetic Stirrer -> Magnetic Stirrer
2025-11-30 21:33:45,020 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue Base -> Blue Base
2025-11-30 21:33:45,020 - src.components.neo4j_handler - INFO - Applying 14 prune instructions
2025-11-30 21:33:45,022 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Blue_Nitrile_Gloves
2025-11-30 21:33:45,024 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Translucent_Tube
2025-11-30 21:33:45,025 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Measuring_Cup
2025-11-30 21:33:45,027 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Blue_Device
2025-11-30 21:33:45,029 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Lab_Bench
2025-11-30 21:33:45,031 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Camera
2025-11-30 21:33:45,032 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Plastic Container
2025-11-30 21:33:45,034 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Tube
2025-11-30 21:33:45,035 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Inverted Beaker
2025-11-30 21:33:45,036 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Electronic Device
2025-11-30 21:33:45,038 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Laboratory Bench
2025-11-30 21:33:45,040 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Glass Flask
2025-11-30 21:33:45,041 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Magnetic Stirrer
2025-11-30 21:33:45,043 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Blue Base
2025-11-30 21:33:45,043 - src.components.neo4j_handler - INFO - Applying 15 inter-chunk relations
2025-11-30 21:33:45,044 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:33:45,044 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Translucent_Tube
2025-11-30 21:33:45,045 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Translucent_Tube -[Is Inserted Into]-> Measuring_Cup
2025-11-30 21:33:45,045 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Measuring_Cup -[Contains]-> Transparent_Liquid
2025-11-30 21:33:45,046 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Uses]-> Blue_Device
2025-11-30 21:33:45,047 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Lab_Bench -[Contains]-> Glass_Beaker
2025-11-30 21:33:45,077 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Camera -[Captures]-> Scientific Procedure
2025-11-30 21:33:45,078 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Plastic Container -[Contains]-> Liquid
2025-11-30 21:33:45,079 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Tube -[Delivers]-> Substance
2025-11-30 21:33:45,106 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Inverted Beaker -[Collects]-> Gas
2025-11-30 21:33:45,131 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Tube -[Connects]-> Electronic Device
2025-11-30 21:33:45,133 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Laboratory Bench -[Holds]-> Experiment Setup
2025-11-30 21:33:45,161 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Glass Flask -[Is Heated On]-> Magnetic Stirrer
2025-11-30 21:33:45,162 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Magnetic Stirrer -[Is On]-> Blue Base
2025-11-30 21:33:45,163 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Tube -[Connects]-> Glass Flask
2025-11-30 21:33:45,163 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:33:45,168 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=560, relationships=508
2025-11-30 21:33:45,170 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:33:45,170 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:33:45,170 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:33:45,170 - src.components.neo4j_handler - INFO - Batch injected in 0.34s (triplets: 0.33s, indexes: 0.00s)
2025-11-30 21:33:45,171 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 284, 'with_embedding': 284, 'linked_chunks': 222}
2025-11-30 21:33:45,171 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:33:45,236 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:33:45,556 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 498 nodes
2025-11-30 21:33:45,588 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 560, 'relationship_count': 1663, 'density': 0.0053, 'avg_degree': 5.9393, 'avg_unique_neighbors': 5.8536, 'global_efficiency': 0.3035, 'avg_path_length': 2.8001, 'avg_degree_centrality': 0.0106, 'max_degree_centrality': 0.5027, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0354, 'degree_assortativity': -0.1704, 'graph_robustness': 0.8208, 'diameter_estimate': 50, 'clustering_coefficient': 0.2513, 'weakly_connected_components': 63, 'largest_wcc_size': 498, 'pagerank_top10_percent': 6.11, 'louvain_communities': 76, 'louvain_modularity': 0.4209, 'label_entropy': 1.4999, 'computational_time': 0.416906459024176}
2025-11-30 21:33:45,589 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 61, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509625.589059, 'total_time': 29.251095606945455, 'aggregation': 3.3279648050665855e-06, 'network_info': 0.007383177988231182, 'llm_extraction': 28.489432406029664, 'data_cleaning': 4.262593574821949e-05, 'neo4j_injection': 0.3357114690588787, 'embedding_time': 0, 'indexing_time': 0.0018400331027805805, 'graph_injection_time': 0.3334735039388761, 'acs_metrics': {'node_count': 560, 'relationship_count': 1663, 'density': 0.0053, 'avg_degree': 5.9393, 'avg_unique_neighbors': 5.8536, 'global_efficiency': 0.3035, 'avg_path_length': 2.8001, 'avg_degree_centrality': 0.0106, 'max_degree_centrality': 0.5027, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0354, 'degree_assortativity': -0.1704, 'graph_robustness': 0.8208, 'diameter_estimate': 50, 'clustering_coefficient': 0.2513, 'weakly_connected_components': 63, 'largest_wcc_size': 498, 'pagerank_top10_percent': 6.11, 'louvain_communities': 76, 'louvain_modularity': 0.4209, 'label_entropy': 1.4999, 'computational_time': 0.416906459024176}, 'retrieval_queries': []}
2025-11-30 21:33:45,589 - src.pipeline.kg_builder - DEBUG - Batch 61 metrics: {
  "batch_idx": 61,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509625.589059,
  "total_time": 29.251095606945455,
  "aggregation": 3.3279648050665855e-06,
  "network_info": 0.007383177988231182,
  "llm_extraction": 28.489432406029664,
  "data_cleaning": 4.262593574821949e-05,
  "neo4j_injection": 0.3357114690588787,
  "embedding_time": 0,
  "indexing_time": 0.0018400331027805805,
  "graph_injection_time": 0.3334735039388761,
  "acs_metrics": {
    "node_count": 560,
    "relationship_count": 1663,
    "density": 0.0053,
    "avg_degree": 5.9393,
    "avg_unique_neighbors": 5.8536,
    "global_efficiency": 0.3035,
    "avg_path_length": 2.8001,
    "avg_degree_centrality": 0.0106,
    "max_degree_centrality": 0.5027,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0354,
    "degree_assortativity": -0.1704,
    "graph_robustness": 0.8208,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2513,
    "weakly_connected_components": 63,
    "largest_wcc_size": 498,
    "pagerank_top10_percent": 6.11,
    "louvain_communities": 76,
    "louvain_modularity": 0.4209,
    "label_entropy": 1.4999,
    "computational_time": 0.416906459024176
  },
  "retrieval_queries": []
}
2025-11-30 21:33:45,590 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:33:45,590 - src.pipeline.kg_builder - INFO - Batch 62 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 28.49s, Clean: 0.00s, Neo4j: 0.34s, ACS: 0.42s
2025-11-30 21:33:45,590 - src.pipeline.kg_builder - INFO - Batch 62 completed in 29.25s
Processing KG batches:  86%|████████▌ | 62/72 [26:48<04:28, 26.84s/it]2025-11-30 21:33:45,590 - src.pipeline.kg_builder - INFO - Processing batch 63/72 (3 items)
2025-11-30 21:33:45,590 - src.pipeline.kg_builder - DEBUG - Batch 63 current_video_time: 15:37-15:42
2025-11-30 21:33:45,596 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 560
- Total Relationships: 508
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:33:45,596 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:33:45,596 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_62_0 ~225 words, content: Time: 15:27-15:32 Content: The video sequence captures a scientific experiment being conducted in a laboratory setting. The scene is set in a well-equipped lab with...
2025-11-30 21:33:45,596 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_62_1 ~231 words, content: , showing the entire experimental setup. The person is still present, observing the experiment. The lab environment remains consistent, with the focus on the ongoing...
2025-11-30 21:33:45,596 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_62_2 ~220 words, content: Frame (4):** The camera then shifts to include a person in the frame. A man with long, dark, curly hair, wearing a light-colored sweater and...
2025-11-30 21:33:45,596 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_62_3 ~144 words, content: smile directed at the camera, suggesting a moment of happiness or satisfaction. - **Fourth Frame:** The person turns their head to their right, away from...
2025-11-30 21:33:45,616 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:33:45,722 - src.components.pre_llm_injector - DEBUG - Found 284 existing chunk embeddings for similarity lookup
2025-11-30 21:33:45,784 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_1', '0.905'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_0', '0.899')]
2025-11-30 21:33:45,786 - src.components.pre_llm_injector - DEBUG - Found 3 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_1
2025-11-30 21:33:45,786 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:33:45,786 - src.components.pre_llm_injector - DEBUG - Found 5 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_0
2025-11-30 21:33:45,786 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:33:45,821 - src.components.pre_llm_injector - DEBUG - Limited Person from 129 to 2 external connections
2025-11-30 21:33:45,821 - src.components.pre_llm_injector - DEBUG - Limited Mass Of Liquid from 62 to 2 external connections
2025-11-30 21:33:45,821 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 197 total -> 10 (internal: 6, external: 4)
2025-11-30 21:33:45,822 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(Glass_Vial / ID: 45_0), (Person / ID: 0_0)-[HOLDS]->(Aluminum_Foil / ID: 45_0), (Person / ID: 0_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[ADDS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[POURS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[PERFORMS]->(Procedure / ID: 54_0), (Person / ID: 0_0)-[ADDS]->(Solid_Substance / ID: 11_2), (Graduated Cylinder / ID: 41_1)-[CONTAINS]->(Mass Of Liquid / ID: 15_1), (Mass Of Liquid / ID: 15_1)-[IS_TRANSFERRED_TO]->(Laboratory_Glassware / ID: 4_2)
2025-11-30 21:33:45,823 - src.components.pre_llm_injector - DEBUG - Limited Person from 134 to 2 external connections
2025-11-30 21:33:45,823 - src.components.pre_llm_injector - DEBUG - Limited Lab Bench from 4 to 2 external connections
2025-11-30 21:33:45,823 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 140 total -> 6 (internal: 2, external: 4)
2025-11-30 21:33:45,823 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[FILLS_OUT]->(Chemistry Experiment Report / ID: 2_1), (Chemistry Experiment Report / ID: 2_1)-[IS_LAID_ON]->(Lab Bench / ID: 2_1), (Person / ID: 0_0)-[HOLDS]->(Clear_Plastic_Container / ID: 51_2), (Person / ID: 0_0)-[HOLDS]->(Glass_Volumetric_Flask / ID: 29_2), (Lab Bench / ID: 2_1)-[CONTAINS]->(Clear Plastic Container / ID: 47_1), (Lab Bench / ID: 2_1)-[CONTAINS]->(Liquid_In_Small_Container / ID: 5_0)
2025-11-30 21:33:45,823 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_1', '0.905'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_0', '0.899')]
2025-11-30 21:33:45,823 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.698'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2', '0.686')]
2025-11-30 21:33:45,824 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.709'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_3_3', '0.704')]
2025-11-30 21:33:45,824 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_4', '0.741'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_28_4', '0.730')]
2025-11-30 21:33:45,824 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:33:45,824 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_62_0) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:33:47,028 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:33:47,028 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:33:47,028 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_62_1) (~231 words) with timeout=5.0s retries=3
2025-11-30 21:33:48,413 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:33:48,414 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:33:48,414 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_62_2) (~220 words) with timeout=5.0s retries=3
2025-11-30 21:33:49,363 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:33:49,363 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:33:49,364 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_62_3) (~144 words) with timeout=5.0s retries=3
2025-11-30 21:33:50,536 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:33:50,536 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:33:50,537 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-30 21:33:50,537 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 4.94s
2025-11-30 21:33:50,537 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 21:33:50,537 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[HOLDS]->(Glass_Vial / ID: 45_0), (Person / ID: 0_0)-[HOLDS]->(Aluminum_Foil / ID: 45_0), (Person / ID: 0_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[ADDS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[POURS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[PERFORMS]->(Procedure / ID: 54_0), (Person / ID: 0_0)-[ADDS]->(Solid_Substance / ID: 11_2), (Graduated Cylinder / ID: 41_1)-[CONTAINS]->(Mass Of Liquid / ID: 15_1), (Mass Of Liquid / ID: 15_1)-[IS_TRANSFERRED_TO]->(Laboratory_Glassware / ID: 4_2)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[FILLS_OUT]->(Chemistry Experiment Report / ID: 2_1), (Chemistry Experiment Report / ID: 2_1)-[IS_LAID_ON]->(Lab Bench / ID: 2_1), (Person / ID: 0_0)-[HOLDS]->(Clear_Plastic_Container / ID: 51_2), (Person / ID: 0_0)-[HOLDS]->(Glass_Volumetric_Flask / ID: 29_2), (Lab Bench / ID: 2_1)-[CONTAINS]->(Clear Plastic Container / ID: 47_1), (Lab Bench / ID: 2_1)-[CONTAINS]->(Liquid_In_Small_Container / ID: 5_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Sits At", "tail": "Lab Bench", "source_chunks": ["62_0"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Glass Flask", "source_chunks": ["62_0"]}, {"head": "Glass Flask", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["62_0"]}, {"head": "Magnetic Stirrer", "relation": "Mixes", "tail": "Liquid", "source_chunks": ["62_0"]}, {"head": "Liquid", "relation": "Is In", "tail": "Glass Flask", "source_chunks": ["62_0"]}, {"head": "Glass Flask", "relation": "Connected To", "tail": "Flexible Tube", "source_chunks": ["62_0"]}, {"head": "Scientist", "relation": "Conducts", "tail": "Experiment", "source_chunks": ["62_1"]}, {"head": "Experiment", "relation": "Involves", "tail": "Vacuum Filtration Setup", "source_chunks": ["62_1"]}, {"head": "Vacuum Filtration Setup", "relation": "Includes", "tail": "Glass Flask", "source_chunks": ["62_1"]}, {"head": "Vacuum Filtration Setup", "relation": "Includes", "tail": "Magnetic Stirrer", "source_chunks": ["62_1"]}, {"head": "Vacuum Filtration Setup", "relation": "Includes", "tail": "Beaker", "source_chunks": ["62_1"]}, {"head": "Scientist", "relation": "Observes", "tail": "Experiment", "source_chunks": ["62_1"]}, {"head": "Person", "relation": "Wears", "tail": "Sweater", "source_chunks": ["62_2"]}, {"head": "Person", "relation": "Wears", "tail": "Jeans", "source_chunks": ["62_2"]}, {"head": "Person", "relation": "Sits On", "tail": "Floor", "source_chunks": ["62_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:33:50,537 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~460 words, ~598 tokens)
2025-11-30 21:33:50,538 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:34:07,886 - src.components.global_refiner - DEBUG - LLM call completed in 17.35s
2025-11-30 21:34:07,886 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Sits At', 'Lab Bench', ['62_0']], ['Lab Bench', 'Contains', 'Glass Flask', ['62_0']], ['Glass Flask', 'Is On', 'Magnetic Stirrer', ['62_0']], ['Magnetic Stirrer', 'Mixes', 'Liquid', ['62_0']], ['Liquid', 'Is In', 'Glass Flask', ['62_0']], ['Glass Flask', 'Connected To', 'Flexible Tube', ['62_0']], ['Scientist', 'Conducts', 'Experiment', ['62_1']], ['Experiment', 'Involves', 'Vacuum Filtration Setup', ['62_1']], ['Vacuum Filtration Setup', 'Includes', 'Glass Flask', ['62_1']], ['Vacuum Filtration Setup', 'Includes', 'Magnetic Stirrer', ['62_1']], ['Vacuum Filtration Setup', 'Includes', 'Beaker', ['62_1']], ['Scientist', 'Observes', 'Experiment', ['62_1']], ['Person', 'Wears', 'Sweater', ['62_2']], ['Person', 'Wears', 'Jeans', ['62_2']], ['Person', 'Sits On', 'Floor', ['62_2']]] inter_chunk_relations=[['Person', 'Sits At', 'Lab Bench', ['62_0']], ['Lab Bench', 'Contains', 'Glass Flask', ['62_0']], ['Glass Flask', 'Is On', 'Magnetic Stirrer', ['62_0']], ['Magnetic Stirrer', 'Mixes', 'Liquid', ['62_0']], ['Liquid', 'Is In', 'Glass Flask', ['62_0']], ['Glass Flask', 'Connected To', 'Flexible Tube', ['62_0']], ['Scientist', 'Conducts', 'Experiment', ['62_1']], ['Experiment', 'Involves', 'Vacuum Filtration Setup', ['62_1']], ['Vacuum Filtration Setup', 'Includes', 'Glass Flask', ['62_1']], ['Vacuum Filtration Setup', 'Includes', 'Magnetic Stirrer', ['62_1']], ['Vacuum Filtration Setup', 'Includes', 'Beaker', ['62_1']], ['Scientist', 'Observes', 'Experiment', ['62_1']], ['Person', 'Wears', 'Sweater', ['62_2']], ['Person', 'Wears', 'Jeans', ['62_2']], ['Person', 'Sits On', 'Floor', ['62_2']]] merge_instructions=[{'local': 'Scientist', 'existing': 'Person', 'existing_id': '0_0'}, {'local': 'Glass Flask', 'existing': 'Glass_Vial', 'existing_id': '45_0'}, {'local': 'Vacuum Filtration Setup', 'existing': 'Procedure', 'existing_id': '54_0'}, {'local': 'Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}] prune_instructions=[{'head': 'Person', 'relation': 'HOLDS', 'tail': 'Clear_Plastic_Container'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Glass_Volumetric_Flask'}, {'head': 'Lab Bench', 'relation': 'Contains', 'tail': 'Clear Plastic Container'}, {'head': 'Lab Bench', 'relation': 'Contains', 'tail': 'Liquid_In_Small_Container'}]
2025-11-30 21:34:07,886 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Sits At', 'Lab Bench', ['62_0']], ['Lab Bench', 'Contains', 'Glass Flask', ['62_0']], ['Glass Flask', 'Is On', 'Magnetic Stirrer', ['62_0']]]
2025-11-30 21:34:07,886 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=15, sample=[['Person', 'Sits At', 'Lab Bench', ['62_0']], ['Lab Bench', 'Contains', 'Glass Flask', ['62_0']], ['Glass Flask', 'Is On', 'Magnetic Stirrer', ['62_0']]]
2025-11-30 21:34:07,886 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Scientist', 'existing': 'Person', 'existing_id': '0_0'}, {'local': 'Glass Flask', 'existing': 'Glass_Vial', 'existing_id': '45_0'}, {'local': 'Vacuum Filtration Setup', 'existing': 'Procedure', 'existing_id': '54_0'}]
2025-11-30 21:34:07,886 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=4, sample=[{'head': 'Person', 'relation': 'HOLDS', 'tail': 'Clear_Plastic_Container'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Glass_Volumetric_Flask'}, {'head': 'Lab Bench', 'relation': 'Contains', 'tail': 'Clear Plastic Container'}]
2025-11-30 21:34:07,886 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Scientist', 'existing': 'Person', 'existing_id': '0_0'}, {'local': 'Glass Flask', 'existing': 'Glass_Vial', 'existing_id': '45_0'}, {'local': 'Vacuum Filtration Setup', 'existing': 'Procedure', 'existing_id': '54_0'}, {'local': 'Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}]
2025-11-30 21:34:07,886 - src.components.global_refiner - INFO - LLM suggested 4 triplets to prune: [{'head': 'Person', 'relation': 'HOLDS', 'tail': 'Clear_Plastic_Container'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Glass_Volumetric_Flask'}, {'head': 'Lab Bench', 'relation': 'Contains', 'tail': 'Clear Plastic Container'}, {'head': 'Lab Bench', 'relation': 'Contains', 'tail': 'Liquid_In_Small_Container'}]
2025-11-30 21:34:07,886 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 30 triplets (total: 17.35s, LLM: 17.35s)
2025-11-30 21:34:07,886 - src.pipeline.kg_builder - INFO - Global refinement: 30 triplets in 17.35s
2025-11-30 21:34:07,886 - src.pipeline.kg_builder - INFO - Using 30 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:34:07,886 - src.pipeline.kg_builder - INFO - Pushing batch 63/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:34:07,887 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:34:08,114 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=569, relationships=522
2025-11-30 21:34:08,115 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:34:08,116 - src.components.neo4j_handler - DEBUG - APOC merge successful: Scientist -> Person
2025-11-30 21:34:08,124 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass Flask -> Glass_Vial
2025-11-30 21:34:08,127 - src.components.neo4j_handler - DEBUG - APOC merge successful: Vacuum Filtration Setup -> Procedure
2025-11-30 21:34:08,132 - src.components.neo4j_handler - DEBUG - APOC merge successful: Liquid -> Mass Of Liquid
2025-11-30 21:34:08,132 - src.components.neo4j_handler - INFO - Applying 4 prune instructions
2025-11-30 21:34:08,138 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[HOLDS]-> Clear_Plastic_Container
2025-11-30 21:34:08,140 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[HOLDS]-> Glass_Volumetric_Flask
2025-11-30 21:34:08,142 - src.components.neo4j_handler - DEBUG - Pruned relationship: Lab Bench -[Contains]-> Clear Plastic Container
2025-11-30 21:34:08,144 - src.components.neo4j_handler - DEBUG - Pruned relationship: Lab Bench -[Contains]-> Liquid_In_Small_Container
2025-11-30 21:34:08,144 - src.components.neo4j_handler - INFO - Applying 15 inter-chunk relations
2025-11-30 21:34:08,176 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Sits At]-> Lab Bench
2025-11-30 21:34:08,177 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Lab Bench -[Contains]-> Glass Flask
2025-11-30 21:34:08,179 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Glass Flask -[Is On]-> Magnetic Stirrer
2025-11-30 21:34:08,180 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Magnetic Stirrer -[Mixes]-> Liquid
2025-11-30 21:34:08,208 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Liquid -[Is In]-> Glass Flask
2025-11-30 21:34:08,234 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Glass Flask -[Connected To]-> Flexible Tube
2025-11-30 21:34:08,259 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Scientist -[Conducts]-> Experiment
2025-11-30 21:34:08,284 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Experiment -[Involves]-> Vacuum Filtration Setup
2025-11-30 21:34:08,285 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Vacuum Filtration Setup -[Includes]-> Glass Flask
2025-11-30 21:34:08,286 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Vacuum Filtration Setup -[Includes]-> Magnetic Stirrer
2025-11-30 21:34:08,304 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Vacuum Filtration Setup -[Includes]-> Beaker
2025-11-30 21:34:08,305 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Scientist -[Observes]-> Experiment
2025-11-30 21:34:08,310 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Sweater
2025-11-30 21:34:08,311 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Jeans
2025-11-30 21:34:08,340 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Sits On]-> Floor
2025-11-30 21:34:08,341 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:34:08,348 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=565, relationships=515
2025-11-30 21:34:08,353 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:34:08,353 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:34:08,354 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:34:08,354 - src.components.neo4j_handler - INFO - Batch injected in 0.47s (triplets: 0.46s, indexes: 0.01s)
2025-11-30 21:34:08,357 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 288, 'with_embedding': 288, 'linked_chunks': 225}
2025-11-30 21:34:08,357 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:34:08,421 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:34:08,487 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 502
2025-11-30 21:34:08,518 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 565, 'relationship_count': 1681, 'density': 0.0053, 'avg_degree': 5.9504, 'avg_unique_neighbors': 5.869, 'global_efficiency': 0.308, 'avg_path_length': 2.7694, 'avg_degree_centrality': 0.0106, 'max_degree_centrality': 0.5035, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0333, 'degree_assortativity': -0.1613, 'graph_robustness': 0.699, 'diameter_estimate': 50, 'clustering_coefficient': 0.2524, 'weakly_connected_components': 64, 'largest_wcc_size': 502, 'pagerank_top10_percent': 6.18, 'louvain_communities': 75, 'louvain_modularity': 0.4234, 'label_entropy': 1.4999, 'computational_time': 0.16035851696506143}
2025-11-30 21:34:08,518 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 62, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509648.518219, 'total_time': 22.927797422045842, 'aggregation': 2.9889633879065514e-06, 'network_info': 0.005738793988712132, 'llm_extraction': 22.290533897001296, 'data_cleaning': 1.6222940757870674e-05, 'neo4j_injection': 0.46746694995090365, 'embedding_time': 0, 'indexing_time': 0.006049957009963691, 'graph_injection_time': 0.4612193900393322, 'acs_metrics': {'node_count': 565, 'relationship_count': 1681, 'density': 0.0053, 'avg_degree': 5.9504, 'avg_unique_neighbors': 5.869, 'global_efficiency': 0.308, 'avg_path_length': 2.7694, 'avg_degree_centrality': 0.0106, 'max_degree_centrality': 0.5035, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0333, 'degree_assortativity': -0.1613, 'graph_robustness': 0.699, 'diameter_estimate': 50, 'clustering_coefficient': 0.2524, 'weakly_connected_components': 64, 'largest_wcc_size': 502, 'pagerank_top10_percent': 6.18, 'louvain_communities': 75, 'louvain_modularity': 0.4234, 'label_entropy': 1.4999, 'computational_time': 0.16035851696506143}, 'retrieval_queries': []}
2025-11-30 21:34:08,518 - src.pipeline.kg_builder - DEBUG - Batch 62 metrics: {
  "batch_idx": 62,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509648.518219,
  "total_time": 22.927797422045842,
  "aggregation": 2.9889633879065514e-06,
  "network_info": 0.005738793988712132,
  "llm_extraction": 22.290533897001296,
  "data_cleaning": 1.6222940757870674e-05,
  "neo4j_injection": 0.46746694995090365,
  "embedding_time": 0,
  "indexing_time": 0.006049957009963691,
  "graph_injection_time": 0.4612193900393322,
  "acs_metrics": {
    "node_count": 565,
    "relationship_count": 1681,
    "density": 0.0053,
    "avg_degree": 5.9504,
    "avg_unique_neighbors": 5.869,
    "global_efficiency": 0.308,
    "avg_path_length": 2.7694,
    "avg_degree_centrality": 0.0106,
    "max_degree_centrality": 0.5035,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0333,
    "degree_assortativity": -0.1613,
    "graph_robustness": 0.699,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2524,
    "weakly_connected_components": 64,
    "largest_wcc_size": 502,
    "pagerank_top10_percent": 6.18,
    "louvain_communities": 75,
    "louvain_modularity": 0.4234,
    "label_entropy": 1.4999,
    "computational_time": 0.16035851696506143
  },
  "retrieval_queries": []
}
2025-11-30 21:34:08,519 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:34:08,519 - src.pipeline.kg_builder - INFO - Batch 63 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 22.29s, Clean: 0.00s, Neo4j: 0.47s, ACS: 0.16s
2025-11-30 21:34:08,519 - src.pipeline.kg_builder - INFO - Batch 63 completed in 22.93s
Processing KG batches:  88%|████████▊ | 63/72 [27:11<03:50, 25.66s/it]2025-11-30 21:34:08,519 - src.pipeline.kg_builder - INFO - Processing batch 64/72 (3 items)
2025-11-30 21:34:08,519 - src.pipeline.kg_builder - DEBUG - Batch 64 current_video_time: 15:52-15:57
2025-11-30 21:34:08,526 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 565
- Total Relationships: 515
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:34:08,526 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:34:08,526 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_63_0 ~216 words, content: Time: 15:42-15:47 Content: The video captures a scene in a well-equipped laboratory, focusing on a scientific experiment in progress. The sequence of frames provides a...
2025-11-30 21:34:08,526 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_63_1 ~216 words, content: stand** holds a glass tube, which is connected by a long, flexible tube to a **beaker** filled with a clear liquid. This setup is typical...
2025-11-30 21:34:08,526 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_63_2 ~230 words, content: showing a person interacting with the environment and equipment. - The first frame provides a wide view of a laboratory. A black countertop is set...
2025-11-30 21:34:08,526 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_63_3 ~246 words, content: :52-15:57 Content: The video sequence captures a scientific experiment or procedure taking place in a laboratory setting. The frames show a person, likely a scientist...
2025-11-30 21:34:08,546 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:34:08,656 - src.components.pre_llm_injector - DEBUG - Found 288 existing chunk embeddings for similarity lookup
2025-11-30 21:34:08,718 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_0', '0.922'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_1', '0.914')]
2025-11-30 21:34:08,720 - src.components.pre_llm_injector - DEBUG - Found 3 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_1
2025-11-30 21:34:08,720 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:34:08,720 - src.components.pre_llm_injector - DEBUG - Found 5 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_0
2025-11-30 21:34:08,720 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:34:08,755 - src.components.pre_llm_injector - DEBUG - Limited Person from 134 to 2 external connections
2025-11-30 21:34:08,756 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 139 total -> 7 (internal: 3, external: 4)
2025-11-30 21:34:08,756 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[FILLS_OUT]->(Chemistry Experiment Report / ID: 2_1), (Person / ID: 0_0)-[SITS_AT]->(Lab Bench / ID: 2_1), (Chemistry Experiment Report / ID: 2_1)-[IS_LAID_ON]->(Lab Bench / ID: 2_1), (Person / ID: 0_0)-[POURS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[PREPARES_TO_PLACE]->(Beaker On Balance / ID: 13_1), (Lab Bench / ID: 2_1)-[CONTAINS]->(Vial / ID: 34_2), (Lab Bench / ID: 2_1)-[CONTAINS]->(Glass_Vial / ID: 45_0)
2025-11-30 21:34:08,758 - src.components.pre_llm_injector - DEBUG - Limited Person from 129 to 2 external connections
2025-11-30 21:34:08,758 - src.components.pre_llm_injector - DEBUG - Limited Mass Of Liquid from 81 to 2 external connections
2025-11-30 21:34:08,758 - src.components.pre_llm_injector - DEBUG - Limited Glass_Vial from 4 to 2 external connections
2025-11-30 21:34:08,758 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 222 total -> 14 (internal: 8, external: 6)
2025-11-30 21:34:08,758 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HOLDS]->(Aluminum_Foil / ID: 45_0), (Person / ID: 0_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[ADDS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[POURS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[HOLDS]->(Glass_Vial / ID: 45_0), (Mass Of Liquid / ID: 15_1)-[IS_IN]->(Glass_Vial / ID: 45_0), (Person / ID: 0_0)-[PLACES]->(Aluminum Foil / ID: 3_2), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Graduated_Cylinder / ID: 38_0)-[CONTAINS]->(Mass Of Liquid / ID: 15_1), (Mass Of Liquid / ID: 15_1)-[FLOWS_INTO]->(White Plastic Beaker / ID: 59_0), (Lab Bench / ID: 2_1)-[CONTAINS]->(Glass_Vial / ID: 45_0), (Glass_Vial / ID: 45_0)-[CONNECTED_TO]->(Flexible Tube / ID: 34_0)
2025-11-30 21:34:08,759 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_60_2', '0.875'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_1', '0.662')]
2025-11-30 21:34:08,759 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_62_1', '0.857'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_17_2', '0.715')]
2025-11-30 21:34:08,759 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_0', '0.922'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_1', '0.914')]
2025-11-30 21:34:08,759 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_37_4', '0.845'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2', '0.812')]
2025-11-30 21:34:08,759 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:34:08,759 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_63_0) (~216 words) with timeout=5.0s retries=3
2025-11-30 21:34:09,941 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:34:09,941 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:34:09,942 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_63_1) (~216 words) with timeout=5.0s retries=3
2025-11-30 21:34:11,148 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:34:11,148 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:34:11,149 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_63_2) (~230 words) with timeout=5.0s retries=3
2025-11-30 21:34:12,108 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:34:12,109 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:34:12,109 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_63_3) (~246 words) with timeout=5.0s retries=3
2025-11-30 21:34:13,341 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:34:13,341 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:34:13,341 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-30 21:34:13,341 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 4.82s
2025-11-30 21:34:13,341 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 21:34:13,341 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[FILLS_OUT]->(Chemistry Experiment Report / ID: 2_1), (Person / ID: 0_0)-[SITS_AT]->(Lab Bench / ID: 2_1), (Chemistry Experiment Report / ID: 2_1)-[IS_LAID_ON]->(Lab Bench / ID: 2_1), (Person / ID: 0_0)-[POURS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[PREPARES_TO_PLACE]->(Beaker On Balance / ID: 13_1), (Lab Bench / ID: 2_1)-[CONTAINS]->(Vial / ID: 34_2), (Lab Bench / ID: 2_1)-[CONTAINS]->(Glass_Vial / ID: 45_0)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[HOLDS]->(Aluminum_Foil / ID: 45_0), (Person / ID: 0_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[TRANSFERS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[ADDS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[POURS]->(Mass Of Liquid / ID: 15_1), (Person / ID: 0_0)-[HOLDS]->(Glass_Vial / ID: 45_0), (Mass Of Liquid / ID: 15_1)-[IS_IN]->(Glass_Vial / ID: 45_0), (Person / ID: 0_0)-[PLACES]->(Aluminum Foil / ID: 3_2), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Graduated_Cylinder / ID: 38_0)-[CONTAINS]->(Mass Of Liquid / ID: 15_1), (Mass Of Liquid / ID: 15_1)-[FLOWS_INTO]->(White Plastic Beaker / ID: 59_0), (Lab Bench / ID: 2_1)-[CONTAINS]->(Glass_Vial / ID: 45_0), (Glass_Vial / ID: 45_0)-[CONNECTED_TO]->(Flexible Tube / ID: 34_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Stands In", "tail": "Laboratory", "source_chunks": ["63_0"]}, {"head": "Person", "relation": "Smiles At", "tail": "Camera", "source_chunks": ["63_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Glass_Cabinets", "source_chunks": ["63_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Balance_Scale", "source_chunks": ["63_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Magnetic_Stirrer", "source_chunks": ["63_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Hot_Plate", "source_chunks": ["63_0"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Tube", "source_chunks": ["63_1"]}, {"head": "Glass Tube", "relation": "Connected To", "tail": "Beaker", "source_chunks": ["63_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["63_1"]}, {"head": "Apparatus", "relation": "Used For", "tail": "Reflux", "source_chunks": ["63_1"]}, {"head": "Apparatus", "relation": "Used For", "tail": "Distillation", "source_chunks": ["63_1"]}, {"head": "Lab Bench", "relation": "Supports", "tail": "Apparatus", "source_chunks": ["63_1"]}, {"head": "Person", "relation": "Enters", "tail": "Laboratory", "source_chunks": ["63_2"]}, {"head": "Person", "relation": "Holds", "tail": "Smartphone", "source_chunks": ["63_2"]}, {"head": "Person", "relation": "Walks", "tail": "Laboratory", "source_chunks": ["63_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:34:13,341 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~491 words, ~638 tokens)
2025-11-30 21:34:13,341 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:34:26,462 - src.components.global_refiner - DEBUG - LLM call completed in 13.12s
2025-11-30 21:34:26,463 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Stands In', 'Laboratory', ['63_0']], ['Person', 'Smiles At', 'Camera', ['63_0']], ['Laboratory', 'Contains', 'Glass_Cabinets', ['63_0']], ['Laboratory', 'Contains', 'Balance_Scale', ['63_0']], ['Laboratory', 'Contains', 'Magnetic_Stirrer', ['63_0']], ['Laboratory', 'Contains', 'Hot_Plate', ['63_0']], ['Person', 'Holds', 'Glass Tube', ['63_1']], ['Glass Tube', 'Connected To', 'Beaker', ['63_1']], ['Beaker', 'Contains', 'Clear Liquid', ['63_1']], ['Apparatus', 'Used For', 'Reflux', ['63_1']], ['Apparatus', 'Used For', 'Distillation', ['63_1']], ['Lab Bench', 'Supports', 'Apparatus', ['63_1']], ['Person', 'Enters', 'Laboratory', ['63_2']], ['Person', 'Holds', 'Smartphone', ['63_2']], ['Person', 'Walks', 'Laboratory', ['63_2']]] inter_chunk_relations=[['Person', 'Stands In', 'Laboratory', ['63_0']], ['Person', 'Enters', 'Laboratory', ['63_2']], ['Person', 'Walks', 'Laboratory', ['63_2']], ['Apparatus', 'Used For', 'Reflux', ['63_1']], ['Apparatus', 'Used For', 'Distillation', ['63_1']], ['Lab Bench', 'Supports', 'Apparatus', ['63_1']]] merge_instructions=[{'local': 'Glass Tube', 'existing': 'Flexible Tube', 'existing_id': '34_0'}, {'local': 'Clear Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Apparatus', 'existing': 'Equipment', 'existing_id': '1_0'}] prune_instructions=[{'head': 'Person', 'relation': 'POURS', 'tail': 'Mass Of Liquid'}, {'head': 'Person', 'relation': 'TRANSFERS', 'tail': 'Mass Of Liquid'}, {'head': 'Person', 'relation': 'ADDS', 'tail': 'Mass Of Liquid'}, {'head': 'Mass Of Liquid', 'relation': 'IS_IN', 'tail': 'Glass_Vial'}, {'head': 'Mass Of Liquid', 'relation': 'FLOWS_INTO', 'tail': 'White Plastic Beaker'}]
2025-11-30 21:34:26,463 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Stands In', 'Laboratory', ['63_0']], ['Person', 'Smiles At', 'Camera', ['63_0']], ['Laboratory', 'Contains', 'Glass_Cabinets', ['63_0']]]
2025-11-30 21:34:26,463 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=6, sample=[['Person', 'Stands In', 'Laboratory', ['63_0']], ['Person', 'Enters', 'Laboratory', ['63_2']], ['Person', 'Walks', 'Laboratory', ['63_2']]]
2025-11-30 21:34:26,463 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=3, sample=[{'local': 'Glass Tube', 'existing': 'Flexible Tube', 'existing_id': '34_0'}, {'local': 'Clear Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Apparatus', 'existing': 'Equipment', 'existing_id': '1_0'}]
2025-11-30 21:34:26,463 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=5, sample=[{'head': 'Person', 'relation': 'POURS', 'tail': 'Mass Of Liquid'}, {'head': 'Person', 'relation': 'TRANSFERS', 'tail': 'Mass Of Liquid'}, {'head': 'Person', 'relation': 'ADDS', 'tail': 'Mass Of Liquid'}]
2025-11-30 21:34:26,463 - src.components.global_refiner - INFO - LLM suggested 3 entity merges: [{'local': 'Glass Tube', 'existing': 'Flexible Tube', 'existing_id': '34_0'}, {'local': 'Clear Liquid', 'existing': 'Mass Of Liquid', 'existing_id': '15_1'}, {'local': 'Apparatus', 'existing': 'Equipment', 'existing_id': '1_0'}]
2025-11-30 21:34:26,463 - src.components.global_refiner - INFO - LLM suggested 5 triplets to prune: [{'head': 'Person', 'relation': 'POURS', 'tail': 'Mass Of Liquid'}, {'head': 'Person', 'relation': 'TRANSFERS', 'tail': 'Mass Of Liquid'}, {'head': 'Person', 'relation': 'ADDS', 'tail': 'Mass Of Liquid'}, {'head': 'Mass Of Liquid', 'relation': 'IS_IN', 'tail': 'Glass_Vial'}, {'head': 'Mass Of Liquid', 'relation': 'FLOWS_INTO', 'tail': 'White Plastic Beaker'}]
2025-11-30 21:34:26,463 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 21 triplets (total: 13.12s, LLM: 13.12s)
2025-11-30 21:34:26,463 - src.pipeline.kg_builder - INFO - Global refinement: 21 triplets in 13.12s
2025-11-30 21:34:26,463 - src.pipeline.kg_builder - INFO - Using 21 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:34:26,463 - src.pipeline.kg_builder - INFO - Pushing batch 64/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:34:26,463 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:34:26,592 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=573, relationships=527
2025-11-30 21:34:26,592 - src.components.neo4j_handler - INFO - Applying 3 merge instructions
2025-11-30 21:34:26,593 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glass Tube -> Flexible Tube
2025-11-30 21:34:26,596 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear Liquid -> Mass Of Liquid
2025-11-30 21:34:26,600 - src.components.neo4j_handler - DEBUG - APOC merge successful: Apparatus -> Equipment
2025-11-30 21:34:26,600 - src.components.neo4j_handler - INFO - Applying 5 prune instructions
2025-11-30 21:34:26,609 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[POURS]-> Mass Of Liquid
2025-11-30 21:34:26,610 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[TRANSFERS]-> Mass Of Liquid
2025-11-30 21:34:26,611 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[ADDS]-> Mass Of Liquid
2025-11-30 21:34:26,634 - src.components.neo4j_handler - DEBUG - Pruned relationship: Mass Of Liquid -[IS_IN]-> Glass_Vial
2025-11-30 21:34:26,655 - src.components.neo4j_handler - DEBUG - Pruned relationship: Mass Of Liquid -[FLOWS_INTO]-> White Plastic Beaker
2025-11-30 21:34:26,655 - src.components.neo4j_handler - INFO - Applying 6 inter-chunk relations
2025-11-30 21:34:26,658 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Stands In]-> Laboratory
2025-11-30 21:34:26,684 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Enters]-> Laboratory
2025-11-30 21:34:26,710 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Walks]-> Laboratory
2025-11-30 21:34:26,735 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Apparatus -[Used For]-> Reflux
2025-11-30 21:34:26,759 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Apparatus -[Used For]-> Distillation
2025-11-30 21:34:26,784 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Lab Bench -[Supports]-> Apparatus
2025-11-30 21:34:26,787 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:34:26,797 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=570, relationships=519
2025-11-30 21:34:26,800 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:34:26,800 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:34:26,801 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:34:26,801 - src.components.neo4j_handler - INFO - Batch injected in 0.34s (triplets: 0.33s, indexes: 0.00s)
2025-11-30 21:34:26,803 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 292, 'with_embedding': 292, 'linked_chunks': 228}
2025-11-30 21:34:26,804 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:34:26,868 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:34:26,940 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 506
2025-11-30 21:34:26,972 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 570, 'relationship_count': 1701, 'density': 0.0052, 'avg_degree': 5.9684, 'avg_unique_neighbors': 5.8877, 'global_efficiency': 0.3062, 'avg_path_length': 2.745, 'avg_degree_centrality': 0.0105, 'max_degree_centrality': 0.5026, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0473, 'degree_assortativity': -0.1715, 'graph_robustness': 0.8372, 'diameter_estimate': 50, 'clustering_coefficient': 0.2509, 'weakly_connected_components': 65, 'largest_wcc_size': 506, 'pagerank_top10_percent': 6.13, 'louvain_communities': 77, 'louvain_modularity': 0.4185, 'label_entropy': 1.4998, 'computational_time': 0.16844544699415565}
2025-11-30 21:34:26,972 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 63, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509666.9726892, 'total_time': 18.453067183028907, 'aggregation': 2.7619535103440285e-06, 'network_info': 0.006512000923976302, 'llm_extraction': 17.937400790047832, 'data_cleaning': 2.814503386616707e-05, 'neo4j_injection': 0.3377073450246826, 'embedding_time': 0, 'indexing_time': 0.004142745980061591, 'graph_injection_time': 0.3332240569870919, 'acs_metrics': {'node_count': 570, 'relationship_count': 1701, 'density': 0.0052, 'avg_degree': 5.9684, 'avg_unique_neighbors': 5.8877, 'global_efficiency': 0.3062, 'avg_path_length': 2.745, 'avg_degree_centrality': 0.0105, 'max_degree_centrality': 0.5026, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0473, 'degree_assortativity': -0.1715, 'graph_robustness': 0.8372, 'diameter_estimate': 50, 'clustering_coefficient': 0.2509, 'weakly_connected_components': 65, 'largest_wcc_size': 506, 'pagerank_top10_percent': 6.13, 'louvain_communities': 77, 'louvain_modularity': 0.4185, 'label_entropy': 1.4998, 'computational_time': 0.16844544699415565}, 'retrieval_queries': []}
2025-11-30 21:34:26,972 - src.pipeline.kg_builder - DEBUG - Batch 63 metrics: {
  "batch_idx": 63,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509666.9726892,
  "total_time": 18.453067183028907,
  "aggregation": 2.7619535103440285e-06,
  "network_info": 0.006512000923976302,
  "llm_extraction": 17.937400790047832,
  "data_cleaning": 2.814503386616707e-05,
  "neo4j_injection": 0.3377073450246826,
  "embedding_time": 0,
  "indexing_time": 0.004142745980061591,
  "graph_injection_time": 0.3332240569870919,
  "acs_metrics": {
    "node_count": 570,
    "relationship_count": 1701,
    "density": 0.0052,
    "avg_degree": 5.9684,
    "avg_unique_neighbors": 5.8877,
    "global_efficiency": 0.3062,
    "avg_path_length": 2.745,
    "avg_degree_centrality": 0.0105,
    "max_degree_centrality": 0.5026,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0473,
    "degree_assortativity": -0.1715,
    "graph_robustness": 0.8372,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2509,
    "weakly_connected_components": 65,
    "largest_wcc_size": 506,
    "pagerank_top10_percent": 6.13,
    "louvain_communities": 77,
    "louvain_modularity": 0.4185,
    "label_entropy": 1.4998,
    "computational_time": 0.16844544699415565
  },
  "retrieval_queries": []
}
2025-11-30 21:34:26,973 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:34:26,974 - src.pipeline.kg_builder - INFO - Batch 64 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 17.94s, Clean: 0.00s, Neo4j: 0.34s, ACS: 0.17s
2025-11-30 21:34:26,974 - src.pipeline.kg_builder - INFO - Batch 64 completed in 18.45s
Processing KG batches:  89%|████████▉ | 64/72 [27:29<03:08, 23.50s/it]2025-11-30 21:34:26,974 - src.pipeline.kg_builder - INFO - Processing batch 65/72 (3 items)
2025-11-30 21:34:26,974 - src.pipeline.kg_builder - DEBUG - Batch 65 current_video_time: 16:07-16:12
2025-11-30 21:34:26,980 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 570
- Total Relationships: 519
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:34:26,981 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:34:26,981 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_64_0 ~240 words, content: Time: 15:57-16:02 Content: The video sequence captures a scientific procedure being performed in a laboratory setting. The scene is focused on a workbench where a...
2025-11-30 21:34:26,981 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_64_1 ~240 words, content: with various pieces of equipment and materials. - **Initial Setup:** The video begins with a close-up view of a laboratory bench. A clear, flexible tube...
2025-11-30 21:34:26,981 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_64_2 ~233 words, content: tube is seen extending from the stirrer into the beaker, suggesting that the liquid is being mixed or stirred as it is added. - **Final...
2025-11-30 21:34:26,981 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_64_3 ~149 words, content: rod, likely a stir bar or a probe, is inserted into the liquid. The surrounding area is cluttered with various laboratory equipment, including a digital...
2025-11-30 21:34:27,001 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:34:27,108 - src.components.pre_llm_injector - DEBUG - Found 292 existing chunk embeddings for similarity lookup
2025-11-30 21:34:27,173 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_3', '0.824'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_3', '0.823')]
2025-11-30 21:34:27,175 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_3
2025-11-30 21:34:27,175 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:34:27,175 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_3 via source_chunk_ids
2025-11-30 21:34:27,194 - src.components.pre_llm_injector - DEBUG - Limited Person from 134 to 2 external connections
2025-11-30 21:34:27,194 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 134 total -> 2 (internal: 0, external: 2)
2025-11-30 21:34:27,194 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[HANDLES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[ADJUSTS]->(Lab / ID: 29_0)
2025-11-30 21:34:27,194 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_0', '0.577'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_63_0', '0.558')]
2025-11-30 21:34:27,194 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_61_1', '0.818'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_0', '0.796')]
2025-11-30 21:34:27,194 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_4', '0.777'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_54_3', '0.757')]
2025-11-30 21:34:27,194 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_3', '0.824'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_20_3', '0.823')]
2025-11-30 21:34:27,194 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:34:27,194 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_64_0) (~240 words) with timeout=5.0s retries=3
2025-11-30 21:34:28,685 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:34:28,685 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:34:28,685 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_64_1) (~240 words) with timeout=5.0s retries=3
2025-11-30 21:34:29,749 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:34:29,750 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:34:29,750 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_64_2) (~233 words) with timeout=5.0s retries=3
2025-11-30 21:34:31,006 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:34:31,006 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:34:31,006 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_64_3) (~149 words) with timeout=5.0s retries=3
2025-11-30 21:34:32,278 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:34:32,278 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:34:32,279 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 4 chunks
2025-11-30 21:34:32,279 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 5.30s
2025-11-30 21:34:32,279 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 21:34:32,279 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[HANDLES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[ADJUSTS]->(Lab / ID: 29_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["64_0"]}, {"head": "Person", "relation": "Holds", "tail": "Flexible_Tube", "source_chunks": ["64_0"]}, {"head": "Flexible_Tube", "relation": "Is Inserted Into", "tail": "Clear_Plastic_Container", "source_chunks": ["64_0"]}, {"head": "Clear_Plastic_Container", "relation": "Contains", "tail": "Liquid", "source_chunks": ["64_0"]}, {"head": "Laboratory_Bench", "relation": "Supports", "tail": "Clear_Plastic_Container", "source_chunks": ["64_0"]}, {"head": "Person", "relation": "Performs", "tail": "Scientific_Procedure", "source_chunks": ["64_0"]}, {"head": "Tube", "relation": "Extends From", "tail": "Container", "source_chunks": ["64_1"]}, {"head": "Tube", "relation": "Transfers Liquid To", "tail": "Beaker", "source_chunks": ["64_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["64_1"]}, {"head": "Lab_Bench", "relation": "Holds", "tail": "Beaker", "source_chunks": ["64_1"]}, {"head": "Lab_Bench", "relation": "Holds", "tail": "Container", "source_chunks": ["64_1"]}, {"head": "Container", "relation": "Holds", "tail": "Liquid", "source_chunks": ["64_1"]}, {"head": "Tube", "relation": "Extends Into", "tail": "Beaker", "source_chunks": ["64_2"]}, {"head": "Stirrer", "relation": "Stirs", "tail": "Liquid", "source_chunks": ["64_2"]}, {"head": "Tube", "relation": "Connects", "tail": "Stirrer", "source_chunks": ["64_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:34:32,280 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~320 words, ~416 tokens)
2025-11-30 21:34:32,280 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:34:48,475 - src.components.global_refiner - DEBUG - LLM call completed in 16.20s
2025-11-30 21:34:48,475 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['64_0']], ['Person', 'Holds', 'Flexible_Tube', ['64_0']], ['Flexible_Tube', 'Is Inserted Into', 'Clear_Plastic_Container', ['64_0']], ['Clear_Plastic_Container', 'Contains', 'Liquid', ['64_0']], ['Laboratory_Bench', 'Supports', 'Clear_Plastic_Container', ['64_0']], ['Person', 'Performs', 'Scientific_Procedure', ['64_0']], ['Tube', 'Extends From', 'Container', ['64_1']], ['Tube', 'Transfers Liquid To', 'Beaker', ['64_1']], ['Beaker', 'Contains', 'Liquid', ['64_1']], ['Lab_Bench', 'Holds', 'Beaker', ['64_1']], ['Lab_Bench', 'Holds', 'Container', ['64_1']], ['Container', 'Holds', 'Liquid', ['64_1']], ['Tube', 'Extends Into', 'Beaker', ['64_2']], ['Stirrer', 'Stirs', 'Liquid', ['64_2']], ['Tube', 'Connects', 'Stirrer', ['64_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['64_0']], ['Person', 'Holds', 'Flexible_Tube', ['64_0']], ['Flexible_Tube', 'Is Inserted Into', 'Clear_Plastic_Container', ['64_0']], ['Clear_Plastic_Container', 'Contains', 'Liquid', ['64_0']], ['Laboratory_Bench', 'Supports', 'Clear_Plastic_Container', ['64_0']], ['Person', 'Performs', 'Scientific_Procedure', ['64_0']], ['Tube', 'Extends From', 'Container', ['64_1']], ['Tube', 'Transfers Liquid To', 'Beaker', ['64_1']], ['Beaker', 'Contains', 'Liquid', ['64_1']], ['Lab_Bench', 'Holds', 'Beaker', ['64_1']], ['Lab_Bench', 'Holds', 'Container', ['64_1']], ['Container', 'Holds', 'Liquid', ['64_1']], ['Tube', 'Extends Into', 'Beaker', ['64_2']], ['Stirrer', 'Stirs', 'Liquid', ['64_2']], ['Tube', 'Connects', 'Stirrer', ['64_2']]] merge_instructions=[{'local': 'Flexible_Tube', 'existing': 'Tube', 'existing_id': '1_0'}, {'local': 'Clear_Plastic_Container', 'existing': 'Container', 'existing_id': '29_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Laboratory_Bench', 'existing': 'Lab', 'existing_id': '29_0'}] prune_instructions=[{'head': 'Person', 'relation': 'HANDLES', 'tail': 'Equipment'}, {'head': 'Person', 'relation': 'ADJUSTS', 'tail': 'Lab'}]
2025-11-30 21:34:48,475 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['64_0']], ['Person', 'Holds', 'Flexible_Tube', ['64_0']], ['Flexible_Tube', 'Is Inserted Into', 'Clear_Plastic_Container', ['64_0']]]
2025-11-30 21:34:48,475 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=15, sample=[['Person', 'Wears', 'Blue_Nitrile_Gloves', ['64_0']], ['Person', 'Holds', 'Flexible_Tube', ['64_0']], ['Flexible_Tube', 'Is Inserted Into', 'Clear_Plastic_Container', ['64_0']]]
2025-11-30 21:34:48,475 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Flexible_Tube', 'existing': 'Tube', 'existing_id': '1_0'}, {'local': 'Clear_Plastic_Container', 'existing': 'Container', 'existing_id': '29_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}]
2025-11-30 21:34:48,476 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=2, sample=[{'head': 'Person', 'relation': 'HANDLES', 'tail': 'Equipment'}, {'head': 'Person', 'relation': 'ADJUSTS', 'tail': 'Lab'}]
2025-11-30 21:34:48,476 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Flexible_Tube', 'existing': 'Tube', 'existing_id': '1_0'}, {'local': 'Clear_Plastic_Container', 'existing': 'Container', 'existing_id': '29_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Laboratory_Bench', 'existing': 'Lab', 'existing_id': '29_0'}]
2025-11-30 21:34:48,476 - src.components.global_refiner - INFO - LLM suggested 2 triplets to prune: [{'head': 'Person', 'relation': 'HANDLES', 'tail': 'Equipment'}, {'head': 'Person', 'relation': 'ADJUSTS', 'tail': 'Lab'}]
2025-11-30 21:34:48,476 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 30 triplets (total: 16.20s, LLM: 16.20s)
2025-11-30 21:34:48,476 - src.pipeline.kg_builder - INFO - Global refinement: 30 triplets in 16.20s
2025-11-30 21:34:48,476 - src.pipeline.kg_builder - INFO - Using 30 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:34:48,476 - src.pipeline.kg_builder - INFO - Pushing batch 65/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:34:48,476 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:34:48,648 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=578, relationships=532
2025-11-30 21:34:48,649 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 21:34:48,649 - src.components.neo4j_handler - DEBUG - APOC merge successful: Flexible_Tube -> Tube
2025-11-30 21:34:48,653 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear_Plastic_Container -> Container
2025-11-30 21:34:48,656 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Glove
2025-11-30 21:34:48,659 - src.components.neo4j_handler - DEBUG - APOC merge successful: Laboratory_Bench -> Lab
2025-11-30 21:34:48,659 - src.components.neo4j_handler - INFO - Applying 2 prune instructions
2025-11-30 21:34:48,664 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[HANDLES]-> Equipment
2025-11-30 21:34:48,665 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[ADJUSTS]-> Lab
2025-11-30 21:34:48,665 - src.components.neo4j_handler - INFO - Applying 15 inter-chunk relations
2025-11-30 21:34:48,666 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:34:48,667 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Flexible_Tube
2025-11-30 21:34:48,668 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Flexible_Tube -[Is Inserted Into]-> Clear_Plastic_Container
2025-11-30 21:34:48,669 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Clear_Plastic_Container -[Contains]-> Liquid
2025-11-30 21:34:48,670 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Laboratory_Bench -[Supports]-> Clear_Plastic_Container
2025-11-30 21:34:48,671 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Performs]-> Scientific_Procedure
2025-11-30 21:34:48,702 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Tube -[Extends From]-> Container
2025-11-30 21:34:48,704 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Tube -[Transfers Liquid To]-> Beaker
2025-11-30 21:34:48,706 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Contains]-> Liquid
2025-11-30 21:34:48,708 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab_Bench -[Holds]-> Beaker
2025-11-30 21:34:48,709 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab_Bench -[Holds]-> Container
2025-11-30 21:34:48,710 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Container -[Holds]-> Liquid
2025-11-30 21:34:48,737 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Tube -[Extends Into]-> Beaker
2025-11-30 21:34:48,739 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Stirrer -[Stirs]-> Liquid
2025-11-30 21:34:48,767 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Tube -[Connects]-> Stirrer
2025-11-30 21:34:48,768 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:34:48,774 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=574, relationships=530
2025-11-30 21:34:48,775 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:34:48,776 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:34:48,776 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:34:48,776 - src.components.neo4j_handler - INFO - Batch injected in 0.30s (triplets: 0.30s, indexes: 0.00s)
2025-11-30 21:34:48,778 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 296, 'with_embedding': 296, 'linked_chunks': 231}
2025-11-30 21:34:48,778 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:34:48,844 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:34:48,916 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 509
2025-11-30 21:34:48,948 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 574, 'relationship_count': 1727, 'density': 0.0053, 'avg_degree': 6.0174, 'avg_unique_neighbors': 5.9373, 'global_efficiency': 0.2991, 'avg_path_length': 2.7257, 'avg_degree_centrality': 0.0105, 'max_degree_centrality': 0.5026, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0431, 'degree_assortativity': -0.1683, 'graph_robustness': 0.8622, 'diameter_estimate': 50, 'clustering_coefficient': 0.2515, 'weakly_connected_components': 66, 'largest_wcc_size': 509, 'pagerank_top10_percent': 6.01, 'louvain_communities': 79, 'louvain_modularity': 0.4096, 'label_entropy': 1.4996, 'computational_time': 0.16997778497170657}
2025-11-30 21:34:48,948 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 64, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509688.9488683, 'total_time': 21.97472377109807, 'aggregation': 3.022025339305401e-06, 'network_info': 0.006416701013222337, 'llm_extraction': 21.495585623080842, 'data_cleaning': 4.1669001802802086e-05, 'neo4j_injection': 0.29988877195864916, 'embedding_time': 0, 'indexing_time': 0.0016684309812262654, 'graph_injection_time': 0.2978847600752488, 'acs_metrics': {'node_count': 574, 'relationship_count': 1727, 'density': 0.0053, 'avg_degree': 6.0174, 'avg_unique_neighbors': 5.9373, 'global_efficiency': 0.2991, 'avg_path_length': 2.7257, 'avg_degree_centrality': 0.0105, 'max_degree_centrality': 0.5026, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0431, 'degree_assortativity': -0.1683, 'graph_robustness': 0.8622, 'diameter_estimate': 50, 'clustering_coefficient': 0.2515, 'weakly_connected_components': 66, 'largest_wcc_size': 509, 'pagerank_top10_percent': 6.01, 'louvain_communities': 79, 'louvain_modularity': 0.4096, 'label_entropy': 1.4996, 'computational_time': 0.16997778497170657}, 'retrieval_queries': []}
2025-11-30 21:34:48,948 - src.pipeline.kg_builder - DEBUG - Batch 64 metrics: {
  "batch_idx": 64,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509688.9488683,
  "total_time": 21.97472377109807,
  "aggregation": 3.022025339305401e-06,
  "network_info": 0.006416701013222337,
  "llm_extraction": 21.495585623080842,
  "data_cleaning": 4.1669001802802086e-05,
  "neo4j_injection": 0.29988877195864916,
  "embedding_time": 0,
  "indexing_time": 0.0016684309812262654,
  "graph_injection_time": 0.2978847600752488,
  "acs_metrics": {
    "node_count": 574,
    "relationship_count": 1727,
    "density": 0.0053,
    "avg_degree": 6.0174,
    "avg_unique_neighbors": 5.9373,
    "global_efficiency": 0.2991,
    "avg_path_length": 2.7257,
    "avg_degree_centrality": 0.0105,
    "max_degree_centrality": 0.5026,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0431,
    "degree_assortativity": -0.1683,
    "graph_robustness": 0.8622,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2515,
    "weakly_connected_components": 66,
    "largest_wcc_size": 509,
    "pagerank_top10_percent": 6.01,
    "louvain_communities": 79,
    "louvain_modularity": 0.4096,
    "label_entropy": 1.4996,
    "computational_time": 0.16997778497170657
  },
  "retrieval_queries": []
}
2025-11-30 21:34:48,950 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:34:48,950 - src.pipeline.kg_builder - INFO - Batch 65 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 21.50s, Clean: 0.00s, Neo4j: 0.30s, ACS: 0.17s
2025-11-30 21:34:48,950 - src.pipeline.kg_builder - INFO - Batch 65 completed in 21.97s
Processing KG batches:  90%|█████████ | 65/72 [27:51<02:41, 23.04s/it]2025-11-30 21:34:48,950 - src.pipeline.kg_builder - INFO - Processing batch 66/72 (3 items)
2025-11-30 21:34:48,950 - src.pipeline.kg_builder - DEBUG - Batch 66 current_video_time: 16:22-16:27
2025-11-30 21:34:48,957 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 574
- Total Relationships: 530
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:34:48,957 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:34:48,957 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_65_0 ~238 words, content: Time: 16:12-16:17 Content: The video sequence captures a scientific experiment taking place in a laboratory setting. The scene begins with a person, who has curly...
2025-11-30 21:34:48,957 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_65_1 ~239 words, content: of the equipment. The overall atmosphere of the video suggests a scientific experiment or a demonstration of a chemical process, with the person in the...
2025-11-30 21:34:48,957 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_65_2 ~161 words, content: Content: The video shows a person in a laboratory setting, wearing blue nitrile gloves, performing a procedure on a black countertop. The central action involves...
2025-11-30 21:34:48,977 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:34:49,082 - src.components.pre_llm_injector - DEBUG - Found 296 existing chunk embeddings for similarity lookup
2025-11-30 21:34:49,133 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_56_1', '0.895'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_0', '0.851')]
2025-11-30 21:34:49,134 - src.components.pre_llm_injector - DEBUG - Found 9 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_56_1
2025-11-30 21:34:49,134 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:34:49,135 - src.components.pre_llm_injector - DEBUG - Found 5 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_0
2025-11-30 21:34:49,135 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:34:49,170 - src.components.pre_llm_injector - DEBUG - Limited Person from 132 to 2 external connections
2025-11-30 21:34:49,170 - src.components.pre_llm_injector - DEBUG - Limited Magnetic_Stirrer from 21 to 2 external connections
2025-11-30 21:34:49,170 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 159 total -> 10 (internal: 5, external: 5)
2025-11-30 21:34:49,171 - src.components.pre_llm_injector - DEBUG - Subgraph: (Reaction Apparatus / ID: 56_1)-[CONTAINS]->(Round_Bottom_Flask / ID: 56_1), (Round_Bottom_Flask / ID: 56_1)-[IS_CONNECTED_TO]->(Schlenk_Line / ID: 56_1), (Magnetic_Stirrer / ID: 4_2)-[IS_ON]->(Hot_Plate / ID: 56_1), (Lab_Table / ID: 56_1)-[CONTAINS]->(Reaction_Apparatus / ID: 56_1), (Person / ID: 0_0)-[PERFORMS]->(Scientific_Procedure / ID: 56_1), (Person / ID: 0_0)-[WEARS]->(Blue Glove / ID: 33_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Balance_Scale / ID: 0_1), (Magnetic_Stirrer / ID: 4_2)-[SUPPORTS]->(Glass_Flask / ID: 57_1), (Liquid_In_Small_Container / ID: 5_0)-[IS_CONNECTED_TO]->(Magnetic_Stirrer / ID: 4_2), (Laboratory / ID: 0_1)-[CONTAINS]->(Hot_Plate / ID: 56_1)
2025-11-30 21:34:49,172 - src.components.pre_llm_injector - DEBUG - Limited Person from 132 to 2 external connections
2025-11-30 21:34:49,172 - src.components.pre_llm_injector - DEBUG - Limited Lab from 16 to 2 external connections
2025-11-30 21:34:49,172 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 151 total -> 7 (internal: 3, external: 4)
2025-11-30 21:34:49,173 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[USES]->(Lab / ID: 29_0), (Lab / ID: 29_0)-[INCLUDES]->(With_Arms_Crossed / ID: 29_0), (Background_Person / ID: 29_0)-[STANDS]->(With_Arms_Crossed / ID: 29_0), (Person / ID: 0_0)-[HANDLES]->(Vial / ID: 34_2), (Person / ID: 0_0)-[HOLDS]->(Glass_Rod / ID: 4_1), (Balance / ID: 36_2)-[IS_ON]->(Lab / ID: 29_0), (Lab / ID: 29_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2)
2025-11-30 21:34:49,173 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_29_0', '0.851'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_54_1', '0.797')]
2025-11-30 21:34:49,173 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_56_1', '0.895'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_1', '0.708')]
2025-11-30 21:34:49,173 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_3', '0.832'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_4_4', '0.813')]
2025-11-30 21:34:49,173 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:34:49,173 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_65_0) (~238 words) with timeout=5.0s retries=3
2025-11-30 21:34:50,264 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:34:50,264 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:34:50,264 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_65_1) (~239 words) with timeout=5.0s retries=3
2025-11-30 21:34:51,479 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:34:51,479 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:34:51,479 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_65_2) (~161 words) with timeout=5.0s retries=3
2025-11-30 21:34:53,048 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:34:53,048 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:34:53,048 - src.components.pre_llm_injector - INFO - Extracted 17 local triplets from 3 chunks
2025-11-30 21:34:53,048 - src.pipeline.kg_builder - INFO - Pre-extraction: 17 triplets in 4.09s
2025-11-30 21:34:53,048 - src.components.global_refiner - INFO - Capping refinement input: 17 → 15 triplets
2025-11-30 21:34:53,048 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Reaction Apparatus / ID: 56_1)-[CONTAINS]->(Round_Bottom_Flask / ID: 56_1), (Round_Bottom_Flask / ID: 56_1)-[IS_CONNECTED_TO]->(Schlenk_Line / ID: 56_1), (Magnetic_Stirrer / ID: 4_2)-[IS_ON]->(Hot_Plate / ID: 56_1), (Lab_Table / ID: 56_1)-[CONTAINS]->(Reaction_Apparatus / ID: 56_1), (Person / ID: 0_0)-[PERFORMS]->(Scientific_Procedure / ID: 56_1), (Person / ID: 0_0)-[WEARS]->(Blue Glove / ID: 33_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Balance_Scale / ID: 0_1), (Magnetic_Stirrer / ID: 4_2)-[SUPPORTS]->(Glass_Flask / ID: 57_1), (Liquid_In_Small_Container / ID: 5_0)-[IS_CONNECTED_TO]->(Magnetic_Stirrer / ID: 4_2), (Laboratory / ID: 0_1)-[CONTAINS]->(Hot_Plate / ID: 56_1)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[USES]->(Lab / ID: 29_0), (Lab / ID: 29_0)-[INCLUDES]->(With_Arms_Crossed / ID: 29_0), (Background_Person / ID: 29_0)-[STANDS]->(With_Arms_Crossed / ID: 29_0), (Person / ID: 0_0)-[HANDLES]->(Vial / ID: 34_2), (Person / ID: 0_0)-[HOLDS]->(Glass_Rod / ID: 4_1), (Balance / ID: 36_2)-[IS_ON]->(Lab / ID: 29_0), (Lab / ID: 29_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Beige Sweater", "source_chunks": ["65_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["65_0"]}, {"head": "Person", "relation": "Handles", "tail": "Transparent Container", "source_chunks": ["65_0"]}, {"head": "Transparent Container", "relation": "Contains", "tail": "Clear Liquid", "source_chunks": ["65_0"]}, {"head": "Person", "relation": "Uses", "tail": "Glass Funnel", "source_chunks": ["65_0"]}, {"head": "Laboratory Bench", "relation": "Contains", "tail": "Beaker", "source_chunks": ["65_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Gloves", "source_chunks": ["65_1", "65_2"]}, {"head": "Person", "relation": "Wears", "tail": "Black_Watch", "source_chunks": ["65_1"]}, {"head": "Person", "relation": "Manipulates", "tail": "Transparent_Container", "source_chunks": ["65_1"]}, {"head": "Transparent_Container", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["65_1"]}, {"head": "Transparent_Container", "relation": "Contains", "tail": "White_Substance", "source_chunks": ["65_1"]}, {"head": "Laboratory_Table", "relation": "Supports", "tail": "Transparent_Container", "source_chunks": ["65_1"]}, {"head": "Person", "relation": "Performs", "tail": "Procedure", "source_chunks": ["65_2"]}, {"head": "Person", "relation": "Holds", "tail": "Test_Tube_Or_Small_Flask", "source_chunks": ["65_2"]}, {"head": "Test_Tube_Or_Small_Flask", "relation": "Is Submerged In", "tail": "Beaker", "source_chunks": ["65_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:34:53,048 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~433 words, ~563 tokens)
2025-11-30 21:34:53,048 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:35:17,757 - src.components.global_refiner - DEBUG - LLM call completed in 24.71s
2025-11-30 21:35:17,758 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Beige Sweater', ['65_0']], ['Person', 'Wears', 'Blue Gloves', ['65_0']], ['Person', 'Handles', 'Transparent Container', ['65_0']], ['Transparent Container', 'Contains', 'Clear Liquid', ['65_0']], ['Person', 'Uses', 'Glass Funnel', ['65_0']], ['Laboratory Bench', 'Contains', 'Beaker', ['65_0']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['65_1', '65_2']], ['Person', 'Wears', 'Black_Watch', ['65_1']], ['Person', 'Manipulates', 'Transparent_Container', ['65_1']], ['Transparent_Container', 'Contains', 'Clear_Liquid', ['65_1']], ['Transparent_Container', 'Contains', 'White_Substance', ['65_1']], ['Laboratory_Table', 'Supports', 'Transparent_Container', ['65_1']], ['Person', 'Performs', 'Procedure', ['65_2']], ['Person', 'Holds', 'Test_Tube_Or_Small_Flask', ['65_2']], ['Test_Tube_Or_Small_Flask', 'Is Submerged In', 'Beaker', ['65_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue Glove', ['65_0']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['65_1', '65_2']], ['Transparent Container', 'Contains', 'Clear Liquid', ['65_0']], ['Transparent Container', 'Contains', 'Clear_Liquid', ['65_1']], ['Laboratory Bench', 'Contains', 'Beaker', ['65_0']], ['Laboratory_Table', 'Supports', 'Transparent_Container', ['65_1']], ['Person', 'Performs', 'Scientific_Procedure', ['65_2']], ['Test_Tube_Or_Small_Flask', 'Is Submerged In', 'Beaker', ['65_2']]] merge_instructions=[{'local': 'Blue Gloves', 'existing': 'Blue Glove', 'existing_id': '33_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '33_0'}, {'local': 'Transparent Container', 'existing': 'Glass_Flask', 'existing_id': '57_1'}, {'local': 'Clear Liquid', 'existing': 'Liquid_In_Small_Container', 'existing_id': '5_0'}, {'local': 'Clear_Liquid', 'existing': 'Liquid_In_Small_Container', 'existing_id': '5_0'}, {'local': 'White_Substance', 'existing': 'Liquid_In_Small_Container', 'existing_id': '5_0'}, {'local': 'Laboratory Bench', 'existing': 'Lab_Table', 'existing_id': '56_1'}, {'local': 'Laboratory_Table', 'existing': 'Lab_Table', 'existing_id': '56_1'}, {'local': 'Test_Tube_Or_Small_Flask', 'existing': 'Round_Bottom_Flask', 'existing_id': '56_1'}, {'local': 'Beaker', 'existing': 'Round_Bottom_Flask', 'existing_id': '56_1'}] prune_instructions=[{'entity': 'Beige Sweater'}, {'entity': 'Glass Funnel'}, {'entity': 'Transparent Container'}, {'entity': 'Clear Liquid'}, {'entity': 'Clear_Liquid'}, {'entity': 'White_Substance'}, {'entity': 'Laboratory Bench'}, {'entity': 'Laboratory_Table'}, {'entity': 'Test_Tube_Or_Small_Flask'}, {'entity': 'Beaker'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Beige Sweater'}, {'head': 'Person', 'relation': 'Handles', 'tail': 'Transparent Container'}, {'head': 'Person', 'relation': 'Manipulates', 'tail': 'Transparent_Container'}, {'head': 'Transparent Container', 'relation': 'Contains', 'tail': 'Clear Liquid'}, {'head': 'Transparent Container', 'relation': 'Contains', 'tail': 'White_Substance'}, {'head': 'Laboratory Bench', 'relation': 'Contains', 'tail': 'Beaker'}, {'head': 'Laboratory_Table', 'relation': 'Supports', 'tail': 'Transparent_Container'}, {'head': 'Person', 'relation': 'Performs', 'tail': 'Procedure'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Test_Tube_Or_Small_Flask'}, {'head': 'Test_Tube_Or_Small_Flask', 'relation': 'Is Submerged In', 'tail': 'Beaker'}]
2025-11-30 21:35:17,758 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Beige Sweater', ['65_0']], ['Person', 'Wears', 'Blue Gloves', ['65_0']], ['Person', 'Handles', 'Transparent Container', ['65_0']]]
2025-11-30 21:35:17,758 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=8, sample=[['Person', 'Wears', 'Blue Glove', ['65_0']], ['Person', 'Wears', 'Blue_Nitrile_Gloves', ['65_1', '65_2']], ['Transparent Container', 'Contains', 'Clear Liquid', ['65_0']]]
2025-11-30 21:35:17,758 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=10, sample=[{'local': 'Blue Gloves', 'existing': 'Blue Glove', 'existing_id': '33_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '33_0'}, {'local': 'Transparent Container', 'existing': 'Glass_Flask', 'existing_id': '57_1'}]
2025-11-30 21:35:17,758 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=22, sample=[{'entity': 'Beige Sweater'}, {'entity': 'Glass Funnel'}, {'entity': 'Transparent Container'}]
2025-11-30 21:35:17,758 - src.components.global_refiner - INFO - LLM suggested 10 entity merges: [{'local': 'Blue Gloves', 'existing': 'Blue Glove', 'existing_id': '33_0'}, {'local': 'Blue_Nitrile_Gloves', 'existing': 'Blue Glove', 'existing_id': '33_0'}, {'local': 'Transparent Container', 'existing': 'Glass_Flask', 'existing_id': '57_1'}, {'local': 'Clear Liquid', 'existing': 'Liquid_In_Small_Container', 'existing_id': '5_0'}, {'local': 'Clear_Liquid', 'existing': 'Liquid_In_Small_Container', 'existing_id': '5_0'}, {'local': 'White_Substance', 'existing': 'Liquid_In_Small_Container', 'existing_id': '5_0'}, {'local': 'Laboratory Bench', 'existing': 'Lab_Table', 'existing_id': '56_1'}, {'local': 'Laboratory_Table', 'existing': 'Lab_Table', 'existing_id': '56_1'}, {'local': 'Test_Tube_Or_Small_Flask', 'existing': 'Round_Bottom_Flask', 'existing_id': '56_1'}, {'local': 'Beaker', 'existing': 'Round_Bottom_Flask', 'existing_id': '56_1'}]
2025-11-30 21:35:17,758 - src.components.global_refiner - INFO - LLM suggested 22 triplets to prune: [{'entity': 'Beige Sweater'}, {'entity': 'Glass Funnel'}, {'entity': 'Transparent Container'}, {'entity': 'Clear Liquid'}, {'entity': 'Clear_Liquid'}, {'entity': 'White_Substance'}, {'entity': 'Laboratory Bench'}, {'entity': 'Laboratory_Table'}, {'entity': 'Test_Tube_Or_Small_Flask'}, {'entity': 'Beaker'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Gloves'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Beige Sweater'}, {'head': 'Person', 'relation': 'Handles', 'tail': 'Transparent Container'}, {'head': 'Person', 'relation': 'Manipulates', 'tail': 'Transparent_Container'}, {'head': 'Transparent Container', 'relation': 'Contains', 'tail': 'Clear Liquid'}, {'head': 'Transparent Container', 'relation': 'Contains', 'tail': 'White_Substance'}, {'head': 'Laboratory Bench', 'relation': 'Contains', 'tail': 'Beaker'}, {'head': 'Laboratory_Table', 'relation': 'Supports', 'tail': 'Transparent_Container'}, {'head': 'Person', 'relation': 'Performs', 'tail': 'Procedure'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Test_Tube_Or_Small_Flask'}, {'head': 'Test_Tube_Or_Small_Flask', 'relation': 'Is Submerged In', 'tail': 'Beaker'}]
2025-11-30 21:35:17,758 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 23 triplets (total: 24.71s, LLM: 24.71s)
2025-11-30 21:35:17,758 - src.pipeline.kg_builder - INFO - Global refinement: 23 triplets in 24.71s
2025-11-30 21:35:17,758 - src.pipeline.kg_builder - INFO - Using 23 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:35:17,758 - src.pipeline.kg_builder - INFO - Pushing batch 66/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:35:17,759 - src.components.neo4j_handler - INFO - Adding 18 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:35:17,915 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=588, relationships=543
2025-11-30 21:35:17,916 - src.components.neo4j_handler - INFO - Applying 10 merge instructions
2025-11-30 21:35:17,916 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue Gloves -> Blue Glove
2025-11-30 21:35:17,921 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Gloves -> Blue Glove
2025-11-30 21:35:17,924 - src.components.neo4j_handler - DEBUG - APOC merge successful: Transparent Container -> Glass_Flask
2025-11-30 21:35:17,928 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear Liquid -> Liquid_In_Small_Container
2025-11-30 21:35:17,932 - src.components.neo4j_handler - DEBUG - APOC merge successful: Clear_Liquid -> Liquid_In_Small_Container
2025-11-30 21:35:17,936 - src.components.neo4j_handler - DEBUG - APOC merge successful: White_Substance -> Liquid_In_Small_Container
2025-11-30 21:35:17,941 - src.components.neo4j_handler - DEBUG - APOC merge successful: Laboratory Bench -> Lab_Table
2025-11-30 21:35:17,944 - src.components.neo4j_handler - DEBUG - APOC merge successful: Laboratory_Table -> Lab_Table
2025-11-30 21:35:17,948 - src.components.neo4j_handler - DEBUG - APOC merge successful: Test_Tube_Or_Small_Flask -> Round_Bottom_Flask
2025-11-30 21:35:17,952 - src.components.neo4j_handler - DEBUG - APOC merge successful: Beaker -> Round_Bottom_Flask
2025-11-30 21:35:17,952 - src.components.neo4j_handler - INFO - Applying 22 prune instructions
2025-11-30 21:35:17,958 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Beige Sweater
2025-11-30 21:35:17,961 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Glass Funnel
2025-11-30 21:35:17,962 - src.components.neo4j_handler - DEBUG - No matching entity found to prune: Transparent Container
2025-11-30 21:35:17,964 - src.components.neo4j_handler - DEBUG - No matching entity found to prune: Clear Liquid
2025-11-30 21:35:17,966 - src.components.neo4j_handler - DEBUG - No matching entity found to prune: Clear_Liquid
2025-11-30 21:35:17,967 - src.components.neo4j_handler - DEBUG - No matching entity found to prune: White_Substance
2025-11-30 21:35:17,968 - src.components.neo4j_handler - DEBUG - No matching entity found to prune: Laboratory Bench
2025-11-30 21:35:17,969 - src.components.neo4j_handler - DEBUG - No matching entity found to prune: Laboratory_Table
2025-11-30 21:35:17,970 - src.components.neo4j_handler - DEBUG - No matching entity found to prune: Test_Tube_Or_Small_Flask
2025-11-30 21:35:17,970 - src.components.neo4j_handler - DEBUG - No matching entity found to prune: Beaker
2025-11-30 21:35:17,971 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue Gloves
2025-11-30 21:35:17,972 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:35:17,972 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Beige Sweater
2025-11-30 21:35:17,973 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Handles]-> Transparent Container
2025-11-30 21:35:18,000 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Manipulates]-> Transparent_Container
2025-11-30 21:35:18,002 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Transparent Container -[Contains]-> Clear Liquid
2025-11-30 21:35:18,003 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Transparent Container -[Contains]-> White_Substance
2025-11-30 21:35:18,005 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Laboratory Bench -[Contains]-> Beaker
2025-11-30 21:35:18,029 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Laboratory_Table -[Supports]-> Transparent_Container
2025-11-30 21:35:18,032 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Performs]-> Procedure
2025-11-30 21:35:18,034 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Test_Tube_Or_Small_Flask
2025-11-30 21:35:18,056 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Test_Tube_Or_Small_Flask -[Is Submerged In]-> Beaker
2025-11-30 21:35:18,056 - src.components.neo4j_handler - INFO - Applying 8 inter-chunk relations
2025-11-30 21:35:18,059 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue Glove
2025-11-30 21:35:18,060 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue_Nitrile_Gloves
2025-11-30 21:35:18,061 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Transparent Container -[Contains]-> Clear Liquid
2025-11-30 21:35:18,062 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Transparent Container -[Contains]-> Clear_Liquid
2025-11-30 21:35:18,062 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Laboratory Bench -[Contains]-> Beaker
2025-11-30 21:35:18,063 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Laboratory_Table -[Supports]-> Transparent_Container
2025-11-30 21:35:18,064 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Performs]-> Scientific_Procedure
2025-11-30 21:35:18,089 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Test_Tube_Or_Small_Flask -[Is Submerged In]-> Beaker
2025-11-30 21:35:18,091 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:35:18,098 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=576, relationships=539
2025-11-30 21:35:18,101 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:35:18,101 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:35:18,102 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:35:18,102 - src.components.neo4j_handler - INFO - Batch injected in 0.34s (triplets: 0.34s, indexes: 0.00s)
2025-11-30 21:35:18,105 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 299, 'with_embedding': 299, 'linked_chunks': 234}
2025-11-30 21:35:18,105 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:35:18,149 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:35:18,219 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 511
2025-11-30 21:35:18,250 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 576, 'relationship_count': 1748, 'density': 0.0053, 'avg_degree': 6.0694, 'avg_unique_neighbors': 5.9861, 'global_efficiency': 0.2961, 'avg_path_length': 2.7644, 'avg_degree_centrality': 0.0106, 'max_degree_centrality': 0.5061, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.037, 'degree_assortativity': -0.1673, 'graph_robustness': 0.8867, 'diameter_estimate': 50, 'clustering_coefficient': 0.2514, 'weakly_connected_components': 66, 'largest_wcc_size': 511, 'pagerank_top10_percent': 5.83, 'louvain_communities': 77, 'louvain_modularity': 0.4132, 'label_entropy': 1.4995, 'computational_time': 0.14520572195760906}
2025-11-30 21:35:18,250 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 65, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509718.2507095, 'total_time': 29.300210187095217, 'aggregation': 2.504093572497368e-06, 'network_info': 0.00639334402512759, 'llm_extraction': 28.80174424010329, 'data_cleaning': 3.913091495633125e-05, 'neo4j_injection': 0.3440052290679887, 'embedding_time': 0, 'indexing_time': 0.004651185008697212, 'graph_injection_time': 0.33902326493989676, 'acs_metrics': {'node_count': 576, 'relationship_count': 1748, 'density': 0.0053, 'avg_degree': 6.0694, 'avg_unique_neighbors': 5.9861, 'global_efficiency': 0.2961, 'avg_path_length': 2.7644, 'avg_degree_centrality': 0.0106, 'max_degree_centrality': 0.5061, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.037, 'degree_assortativity': -0.1673, 'graph_robustness': 0.8867, 'diameter_estimate': 50, 'clustering_coefficient': 0.2514, 'weakly_connected_components': 66, 'largest_wcc_size': 511, 'pagerank_top10_percent': 5.83, 'louvain_communities': 77, 'louvain_modularity': 0.4132, 'label_entropy': 1.4995, 'computational_time': 0.14520572195760906}, 'retrieval_queries': []}
2025-11-30 21:35:18,250 - src.pipeline.kg_builder - DEBUG - Batch 65 metrics: {
  "batch_idx": 65,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509718.2507095,
  "total_time": 29.300210187095217,
  "aggregation": 2.504093572497368e-06,
  "network_info": 0.00639334402512759,
  "llm_extraction": 28.80174424010329,
  "data_cleaning": 3.913091495633125e-05,
  "neo4j_injection": 0.3440052290679887,
  "embedding_time": 0,
  "indexing_time": 0.004651185008697212,
  "graph_injection_time": 0.33902326493989676,
  "acs_metrics": {
    "node_count": 576,
    "relationship_count": 1748,
    "density": 0.0053,
    "avg_degree": 6.0694,
    "avg_unique_neighbors": 5.9861,
    "global_efficiency": 0.2961,
    "avg_path_length": 2.7644,
    "avg_degree_centrality": 0.0106,
    "max_degree_centrality": 0.5061,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.037,
    "degree_assortativity": -0.1673,
    "graph_robustness": 0.8867,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2514,
    "weakly_connected_components": 66,
    "largest_wcc_size": 511,
    "pagerank_top10_percent": 5.83,
    "louvain_communities": 77,
    "louvain_modularity": 0.4132,
    "label_entropy": 1.4995,
    "computational_time": 0.14520572195760906
  },
  "retrieval_queries": []
}
2025-11-30 21:35:18,251 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:35:18,252 - src.pipeline.kg_builder - INFO - Batch 66 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 28.80s, Clean: 0.00s, Neo4j: 0.34s, ACS: 0.15s
2025-11-30 21:35:18,252 - src.pipeline.kg_builder - INFO - Batch 66 completed in 29.30s
Processing KG batches:  92%|█████████▏| 66/72 [28:21<02:29, 24.92s/it]2025-11-30 21:35:18,252 - src.pipeline.kg_builder - INFO - Processing batch 67/72 (3 items)
2025-11-30 21:35:18,252 - src.pipeline.kg_builder - DEBUG - Batch 67 current_video_time: 16:37-16:42
2025-11-30 21:35:18,259 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 576
- Total Relationships: 539
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:35:18,259 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:35:18,259 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_66_0 ~229 words, content: Time: 16:27-16:32 Content: The video captures a sequence of actions in a laboratory setting, focusing on a person conducting a chemical experiment. The scene is...
2025-11-30 21:35:18,259 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_66_1 ~232 words, content: The central activity involves a glass beaker, which contains a dark, cylindrical object, likely a sample or a filter. This beaker is placed on a...
2025-11-30 21:35:18,259 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_66_2 ~229 words, content: with the camera panning to the right, revealing more of the laboratory environment, including a blue base with a metal rod, which could be part...
2025-11-30 21:35:18,259 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_66_3 ~225 words, content: providing a wider view of the lab bench. The digital scale is now clearly identifiable as a "DUA" model. A person's hand, wearing a blue...
2025-11-30 21:35:18,259 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_66_4 ~81 words, content: a blue base, a roll of black tape, and other laboratory items. In summary, the video shows a laboratory experiment where a substance is being...
2025-11-30 21:35:18,279 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:35:18,390 - src.components.pre_llm_injector - DEBUG - Found 299 existing chunk embeddings for similarity lookup
2025-11-30 21:35:18,472 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2', '0.881'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_4', '0.867')]
2025-11-30 21:35:18,474 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_4
2025-11-30 21:35:18,474 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:35:18,474 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2
2025-11-30 21:35:18,474 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:35:18,508 - src.components.pre_llm_injector - DEBUG - Limited Person from 135 to 2 external connections
2025-11-30 21:35:18,508 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 135 total -> 2 (internal: 0, external: 2)
2025-11-30 21:35:18,508 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[PERFORMS]->(Scientific_Procedure / ID: 56_1), (Person / ID: 0_0)-[USES]->(Long_Translucent_Pipette / ID: 54_0)
2025-11-30 21:35:18,511 - src.components.pre_llm_injector - DEBUG - Limited Person from 135 to 2 external connections
2025-11-30 21:35:18,511 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 135 total -> 2 (internal: 0, external: 2)
2025-11-30 21:35:18,511 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[MANIPULATES]->(Long_Translucent_Pipette / ID: 54_0), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2)
2025-11-30 21:35:18,511 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.739'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_39_1', '0.726')]
2025-11-30 21:35:18,511 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_42_2', '0.820'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.781')]
2025-11-30 21:35:18,511 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_55_2', '0.690'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_1', '0.673')]
2025-11-30 21:35:18,511 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_18_3', '0.748'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_2', '0.741')]
2025-11-30 21:35:18,511 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_8_2', '0.881'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_21_4', '0.867')]
2025-11-30 21:35:18,511 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:35:18,511 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_66_0) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:35:19,601 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:35:19,601 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:35:19,601 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_66_1) (~232 words) with timeout=5.0s retries=3
2025-11-30 21:35:21,320 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:35:21,320 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:35:21,321 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_66_2) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:35:22,652 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:35:22,652 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:35:22,652 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_66_3) (~225 words) with timeout=5.0s retries=3
2025-11-30 21:35:24,142 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:35:24,142 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:35:24,143 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_66_4) (~81 words) with timeout=5.0s retries=3
2025-11-30 21:35:25,279 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:35:25,279 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:35:25,279 - src.components.pre_llm_injector - INFO - Extracted 27 local triplets from 5 chunks
2025-11-30 21:35:25,279 - src.pipeline.kg_builder - INFO - Pre-extraction: 27 triplets in 7.02s
2025-11-30 21:35:25,279 - src.components.global_refiner - INFO - Capping refinement input: 27 → 15 triplets
2025-11-30 21:35:25,279 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[PERFORMS]->(Scientific_Procedure / ID: 56_1), (Person / ID: 0_0)-[USES]->(Long_Translucent_Pipette / ID: 54_0)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[MANIPULATES]->(Long_Translucent_Pipette / ID: 54_0), (Person / ID: 0_0)-[HANDLES]->(Laboratory_Glassware / ID: 4_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["66_0"]}, {"head": "Person", "relation": "Holds", "tail": "Pipette", "source_chunks": ["66_0"]}, {"head": "Pipette", "relation": "Transfers", "tail": "Liquid", "source_chunks": ["66_0"]}, {"head": "Liquid", "relation": "Is In", "tail": "Transparent Container", "source_chunks": ["66_0"]}, {"head": "Transparent Container", "relation": "Is On", "tail": "Black Countertop", "source_chunks": ["66_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["66_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Dark_Cylindrical_Object", "source_chunks": ["66_1", "66_2"]}, {"head": "Beaker", "relation": "Placed On", "tail": "Magnetic_Stirrer_Or_Heating_Plate", "source_chunks": ["66_1"]}, {"head": "Magnetic_Stirrer_Or_Heating_Plate", "relation": "Placed On", "tail": "Digital_Scale", "source_chunks": ["66_1"]}, {"head": "Digital_Scale", "relation": "Displays", "tail": "0970", "source_chunks": ["66_1", "66_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["66_1"]}, {"head": "Beaker", "relation": "Connected To", "tail": "White_Tube_Or_Rod", "source_chunks": ["66_1"]}, {"head": "Camera", "relation": "Pans To", "tail": "Right", "source_chunks": ["66_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Beaker", "source_chunks": ["66_2", "66_4"]}, {"head": "Digital_Scale", "relation": "Is On", "tail": "Stirrer_Or_Heating_Plate", "source_chunks": ["66_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:35:25,279 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~344 words, ~447 tokens)
2025-11-30 21:35:25,279 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:35:49,772 - src.components.global_refiner - DEBUG - LLM call completed in 24.49s
2025-11-30 21:35:49,772 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue Gloves', ['66_0']], ['Person', 'Holds', 'Pipette', ['66_0']], ['Pipette', 'Transfers', 'Liquid', ['66_0']], ['Liquid', 'Is In', 'Transparent Container', ['66_0']], ['Transparent Container', 'Is On', 'Black Countertop', ['66_0']], ['Beaker', 'Contains', 'Liquid', ['66_0']], ['Beaker', 'Contains', 'Dark_Cylindrical_Object', ['66_1', '66_2']], ['Beaker', 'Placed On', 'Magnetic_Stirrer_Or_Heating_Plate', ['66_1']], ['Magnetic_Stirrer_Or_Heating_Plate', 'Placed On', 'Digital_Scale', ['66_1']], ['Digital_Scale', 'Displays', '0970', ['66_1', '66_2']], ['Person', 'Wears', 'Blue_Nitrile_Glove', ['66_1']], ['Beaker', 'Connected To', 'White_Tube_Or_Rod', ['66_1']], ['Camera', 'Pans To', 'Right', ['66_2']], ['Laboratory', 'Contains', 'Beaker', ['66_2', '66_4']], ['Digital_Scale', 'Is On', 'Magnetic_Stirrer_Or_Heating_Plate', ['66_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue Gloves', ['66_0']], ['Person', 'Holds', 'Pipette', ['66_0']], ['Pipette', 'Transfers', 'Liquid', ['66_0']], ['Liquid', 'Is In', 'Transparent Container', ['66_0']], ['Transparent Container', 'Is On', 'Black Countertop', ['66_0']], ['Beaker', 'Contains', 'Liquid', ['66_0']], ['Beaker', 'Contains', 'Dark_Cylindrical_Object', ['66_1', '66_2']], ['Beaker', 'Placed On', 'Magnetic_Stirrer_Or_Heating_Plate', ['66_1']], ['Magnetic_Stirrer_Or_Heating_Plate', 'Placed On', 'Digital_Scale', ['66_1']], ['Digital_Scale', 'Displays', '0970', ['66_1', '66_2']], ['Person', 'Wears', 'Blue_Nitrile_Glove', ['66_1']], ['Beaker', 'Connected To', 'White_Tube_Or_Rod', ['66_1']], ['Camera', 'Pans To', 'Right', ['66_2']], ['Laboratory', 'Contains', 'Beaker', ['66_2', '66_4']], ['Digital_Scale', 'Is On', 'Magnetic_Stirrer_Or_Heating_Plate', ['66_2']]] merge_instructions=[{'local': 'Blue Gloves', 'existing': 'Blue Gloves', 'existing_id': '0_0'}, {'local': 'Pipette', 'existing': 'Long_Translucent_Pipette', 'existing_id': '54_0'}, {'local': 'Blue_Nitrile_Glove', 'existing': 'Blue Gloves', 'existing_id': '0_0'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Pipette'}, {'head': 'Pipette', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Liquid', 'relation': 'Is In', 'tail': 'Transparent Container'}, {'head': 'Transparent Container', 'relation': 'Is On', 'tail': 'Black Countertop'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Dark_Cylindrical_Object'}, {'head': 'Beaker', 'relation': 'Placed On', 'tail': 'Magnetic_Stirrer_Or_Heating_Plate'}, {'head': 'Magnetic_Stirrer_Or_Heating_Plate', 'relation': 'Placed On', 'tail': 'Digital_Scale'}, {'head': 'Digital_Scale', 'relation': 'Displays', 'tail': '0970'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Glove'}, {'head': 'Beaker', 'relation': 'Connected To', 'tail': 'White_Tube_Or_Rod'}, {'head': 'Camera', 'relation': 'Pans To', 'tail': 'Right'}, {'head': 'Laboratory', 'relation': 'Contains', 'tail': 'Beaker'}, {'head': 'Digital_Scale', 'relation': 'Is On', 'tail': 'Magnetic_Stirrer_Or_Heating_Plate'}]
2025-11-30 21:35:49,772 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue Gloves', ['66_0']], ['Person', 'Holds', 'Pipette', ['66_0']], ['Pipette', 'Transfers', 'Liquid', ['66_0']]]
2025-11-30 21:35:49,772 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=15, sample=[['Person', 'Wears', 'Blue Gloves', ['66_0']], ['Person', 'Holds', 'Pipette', ['66_0']], ['Pipette', 'Transfers', 'Liquid', ['66_0']]]
2025-11-30 21:35:49,772 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=3, sample=[{'local': 'Blue Gloves', 'existing': 'Blue Gloves', 'existing_id': '0_0'}, {'local': 'Pipette', 'existing': 'Long_Translucent_Pipette', 'existing_id': '54_0'}, {'local': 'Blue_Nitrile_Glove', 'existing': 'Blue Gloves', 'existing_id': '0_0'}]
2025-11-30 21:35:49,772 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=15, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Pipette'}, {'head': 'Pipette', 'relation': 'Transfers', 'tail': 'Liquid'}]
2025-11-30 21:35:49,772 - src.components.global_refiner - INFO - LLM suggested 3 entity merges: [{'local': 'Blue Gloves', 'existing': 'Blue Gloves', 'existing_id': '0_0'}, {'local': 'Pipette', 'existing': 'Long_Translucent_Pipette', 'existing_id': '54_0'}, {'local': 'Blue_Nitrile_Glove', 'existing': 'Blue Gloves', 'existing_id': '0_0'}]
2025-11-30 21:35:49,772 - src.components.global_refiner - INFO - LLM suggested 15 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Gloves'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Pipette'}, {'head': 'Pipette', 'relation': 'Transfers', 'tail': 'Liquid'}, {'head': 'Liquid', 'relation': 'Is In', 'tail': 'Transparent Container'}, {'head': 'Transparent Container', 'relation': 'Is On', 'tail': 'Black Countertop'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Liquid'}, {'head': 'Beaker', 'relation': 'Contains', 'tail': 'Dark_Cylindrical_Object'}, {'head': 'Beaker', 'relation': 'Placed On', 'tail': 'Magnetic_Stirrer_Or_Heating_Plate'}, {'head': 'Magnetic_Stirrer_Or_Heating_Plate', 'relation': 'Placed On', 'tail': 'Digital_Scale'}, {'head': 'Digital_Scale', 'relation': 'Displays', 'tail': '0970'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Glove'}, {'head': 'Beaker', 'relation': 'Connected To', 'tail': 'White_Tube_Or_Rod'}, {'head': 'Camera', 'relation': 'Pans To', 'tail': 'Right'}, {'head': 'Laboratory', 'relation': 'Contains', 'tail': 'Beaker'}, {'head': 'Digital_Scale', 'relation': 'Is On', 'tail': 'Magnetic_Stirrer_Or_Heating_Plate'}]
2025-11-30 21:35:49,772 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 30 triplets (total: 24.49s, LLM: 24.49s)
2025-11-30 21:35:49,772 - src.pipeline.kg_builder - INFO - Global refinement: 30 triplets in 24.49s
2025-11-30 21:35:49,772 - src.pipeline.kg_builder - INFO - Using 30 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:35:49,772 - src.pipeline.kg_builder - INFO - Pushing batch 67/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:35:49,772 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:35:49,963 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=591, relationships=554
2025-11-30 21:35:49,963 - src.components.neo4j_handler - INFO - Applying 3 merge instructions
2025-11-30 21:35:49,963 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue Gloves -> Blue Gloves
2025-11-30 21:35:49,964 - src.components.neo4j_handler - DEBUG - APOC merge successful: Pipette -> Long_Translucent_Pipette
2025-11-30 21:35:49,968 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Glove -> Blue Gloves
2025-11-30 21:35:49,968 - src.components.neo4j_handler - INFO - Applying 15 prune instructions
2025-11-30 21:35:49,972 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Gloves
2025-11-30 21:35:49,973 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Holds]-> Pipette
2025-11-30 21:35:49,974 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Pipette -[Transfers]-> Liquid
2025-11-30 21:35:49,996 - src.components.neo4j_handler - DEBUG - Pruned relationship: Liquid -[Is In]-> Transparent Container
2025-11-30 21:35:49,997 - src.components.neo4j_handler - DEBUG - Pruned relationship: Transparent Container -[Is On]-> Black Countertop
2025-11-30 21:35:50,001 - src.components.neo4j_handler - DEBUG - Pruned relationship: Beaker -[Contains]-> Liquid
2025-11-30 21:35:50,002 - src.components.neo4j_handler - DEBUG - Pruned relationship: Beaker -[Contains]-> Dark_Cylindrical_Object
2025-11-30 21:35:50,004 - src.components.neo4j_handler - DEBUG - Pruned relationship: Beaker -[Placed On]-> Magnetic_Stirrer_Or_Heating_Plate
2025-11-30 21:35:50,029 - src.components.neo4j_handler - DEBUG - Pruned relationship: Magnetic_Stirrer_Or_Heating_Plate -[Placed On]-> Digital_Scale
2025-11-30 21:35:50,032 - src.components.neo4j_handler - DEBUG - Pruned relationship: Digital_Scale -[Displays]-> 0970
2025-11-30 21:35:50,033 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Glove
2025-11-30 21:35:50,056 - src.components.neo4j_handler - DEBUG - Pruned relationship: Beaker -[Connected To]-> White_Tube_Or_Rod
2025-11-30 21:35:50,077 - src.components.neo4j_handler - DEBUG - Pruned relationship: Camera -[Pans To]-> Right
2025-11-30 21:35:50,080 - src.components.neo4j_handler - DEBUG - Pruned relationship: Laboratory -[Contains]-> Beaker
2025-11-30 21:35:50,082 - src.components.neo4j_handler - DEBUG - Pruned relationship: Digital_Scale -[Is On]-> Magnetic_Stirrer_Or_Heating_Plate
2025-11-30 21:35:50,083 - src.components.neo4j_handler - INFO - Applying 15 inter-chunk relations
2025-11-30 21:35:50,084 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue Gloves
2025-11-30 21:35:50,085 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Holds]-> Pipette
2025-11-30 21:35:50,086 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Pipette -[Transfers]-> Liquid
2025-11-30 21:35:50,087 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Liquid -[Is In]-> Transparent Container
2025-11-30 21:35:50,088 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Transparent Container -[Is On]-> Black Countertop
2025-11-30 21:35:50,091 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Contains]-> Liquid
2025-11-30 21:35:50,092 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Contains]-> Dark_Cylindrical_Object
2025-11-30 21:35:50,094 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Placed On]-> Magnetic_Stirrer_Or_Heating_Plate
2025-11-30 21:35:50,121 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Magnetic_Stirrer_Or_Heating_Plate -[Placed On]-> Digital_Scale
2025-11-30 21:35:50,124 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital_Scale -[Displays]-> 0970
2025-11-30 21:35:50,126 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue_Nitrile_Glove
2025-11-30 21:35:50,128 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Connected To]-> White_Tube_Or_Rod
2025-11-30 21:35:50,155 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Camera -[Pans To]-> Right
2025-11-30 21:35:50,159 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Laboratory -[Contains]-> Beaker
2025-11-30 21:35:50,161 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Digital_Scale -[Is On]-> Magnetic_Stirrer_Or_Heating_Plate
2025-11-30 21:35:50,162 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:35:50,167 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=589, relationships=553
2025-11-30 21:35:50,170 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:35:50,170 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:35:50,170 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:35:50,170 - src.components.neo4j_handler - INFO - Batch injected in 0.40s (triplets: 0.40s, indexes: 0.00s)
2025-11-30 21:35:50,172 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 304, 'with_embedding': 304, 'linked_chunks': 238}
2025-11-30 21:35:50,172 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:35:50,271 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:35:50,345 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 523
2025-11-30 21:35:50,378 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 589, 'relationship_count': 1785, 'density': 0.0052, 'avg_degree': 6.0611, 'avg_unique_neighbors': 5.9762, 'global_efficiency': 0.2876, 'avg_path_length': 2.7495, 'avg_degree_centrality': 0.0103, 'max_degree_centrality': 0.4983, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0319, 'degree_assortativity': -0.1622, 'graph_robustness': 0.898, 'diameter_estimate': 50, 'clustering_coefficient': 0.2514, 'weakly_connected_components': 67, 'largest_wcc_size': 523, 'pagerank_top10_percent': 5.67, 'louvain_communities': 78, 'louvain_modularity': 0.4178, 'label_entropy': 1.4996, 'computational_time': 0.20650534401647747}
2025-11-30 21:35:50,378 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 66, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509750.378922, 'total_time': 32.1268142220797, 'aggregation': 2.349959686398506e-06, 'network_info': 0.007105537923052907, 'llm_extraction': 31.513256473932415, 'data_cleaning': 2.7681002393364906e-05, 'neo4j_injection': 0.39823513198643923, 'embedding_time': 0, 'indexing_time': 0.0029781359480693936, 'graph_injection_time': 0.3950111570302397, 'acs_metrics': {'node_count': 589, 'relationship_count': 1785, 'density': 0.0052, 'avg_degree': 6.0611, 'avg_unique_neighbors': 5.9762, 'global_efficiency': 0.2876, 'avg_path_length': 2.7495, 'avg_degree_centrality': 0.0103, 'max_degree_centrality': 0.4983, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0319, 'degree_assortativity': -0.1622, 'graph_robustness': 0.898, 'diameter_estimate': 50, 'clustering_coefficient': 0.2514, 'weakly_connected_components': 67, 'largest_wcc_size': 523, 'pagerank_top10_percent': 5.67, 'louvain_communities': 78, 'louvain_modularity': 0.4178, 'label_entropy': 1.4996, 'computational_time': 0.20650534401647747}, 'retrieval_queries': []}
2025-11-30 21:35:50,379 - src.pipeline.kg_builder - DEBUG - Batch 66 metrics: {
  "batch_idx": 66,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509750.378922,
  "total_time": 32.1268142220797,
  "aggregation": 2.349959686398506e-06,
  "network_info": 0.007105537923052907,
  "llm_extraction": 31.513256473932415,
  "data_cleaning": 2.7681002393364906e-05,
  "neo4j_injection": 0.39823513198643923,
  "embedding_time": 0,
  "indexing_time": 0.0029781359480693936,
  "graph_injection_time": 0.3950111570302397,
  "acs_metrics": {
    "node_count": 589,
    "relationship_count": 1785,
    "density": 0.0052,
    "avg_degree": 6.0611,
    "avg_unique_neighbors": 5.9762,
    "global_efficiency": 0.2876,
    "avg_path_length": 2.7495,
    "avg_degree_centrality": 0.0103,
    "max_degree_centrality": 0.4983,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0319,
    "degree_assortativity": -0.1622,
    "graph_robustness": 0.898,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2514,
    "weakly_connected_components": 67,
    "largest_wcc_size": 523,
    "pagerank_top10_percent": 5.67,
    "louvain_communities": 78,
    "louvain_modularity": 0.4178,
    "label_entropy": 1.4996,
    "computational_time": 0.20650534401647747
  },
  "retrieval_queries": []
}
2025-11-30 21:35:50,380 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:35:50,380 - src.pipeline.kg_builder - INFO - Batch 67 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 31.51s, Clean: 0.00s, Neo4j: 0.40s, ACS: 0.21s
2025-11-30 21:35:50,380 - src.pipeline.kg_builder - INFO - Batch 67 completed in 32.13s
Processing KG batches:  93%|█████████▎| 67/72 [28:53<02:15, 27.08s/it]2025-11-30 21:35:50,380 - src.pipeline.kg_builder - INFO - Processing batch 68/72 (3 items)
2025-11-30 21:35:50,380 - src.pipeline.kg_builder - DEBUG - Batch 68 current_video_time: 16:52-16:57
2025-11-30 21:35:50,387 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 589
- Total Relationships: 553
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:35:50,387 - src.components.pre_llm_injector - DEBUG - Split content into 3 chunks (chunk_size=296, overlap=16)
2025-11-30 21:35:50,387 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_67_0 ~234 words, content: Time: 16:42-16:47 Content: The video shows a scientific experiment taking place in a laboratory setting. A person wearing blue gloves is using a pipette to...
2025-11-30 21:35:50,387 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_67_1 ~237 words, content: a solution. The laboratory environment is visible in the background, featuring a white wall, a door, and a shelf with various items, including cardboard boxes...
2025-11-30 21:35:50,387 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_67_2 ~35 words, content: The final frame provides a wider view of the laboratory, highlighting the equipment and the organized workspace. The overall atmosphere is one of focused scientific...
2025-11-30 21:35:50,407 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:35:50,514 - src.components.pre_llm_injector - DEBUG - Found 304 existing chunk embeddings for similarity lookup
2025-11-30 21:35:50,564 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.823'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.811')]
2025-11-30 21:35:50,566 - src.components.pre_llm_injector - DEBUG - Found 4 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1
2025-11-30 21:35:50,566 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:35:50,567 - src.components.pre_llm_injector - DEBUG - Found 3 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2
2025-11-30 21:35:50,567 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:35:50,604 - src.components.pre_llm_injector - DEBUG - Limited Person from 133 to 2 external connections
2025-11-30 21:35:50,604 - src.components.pre_llm_injector - DEBUG - Limited Magnetic_Stirrer from 21 to 2 external connections
2025-11-30 21:35:50,604 - src.components.pre_llm_injector - DEBUG - Limited Equipment from 22 to 2 external connections
2025-11-30 21:35:50,604 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 182 total -> 12 (internal: 5, external: 7)
2025-11-30 21:35:50,605 - src.components.pre_llm_injector - DEBUG - Subgraph: (Equipment / ID: 1_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[TARES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[USES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[MANIPULATES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[MANIPULATES]->(Liquid_In_Small_Container / ID: 5_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Balance_Scale / ID: 0_1), (Magnetic_Stirrer / ID: 4_2)-[IS_ON]->(Hot_Plate / ID: 56_1), (Lab / ID: 29_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2), (Mass Of Liquid / ID: 15_1)-[IS_PART_OF]->(Chemical_Solution / ID: 5_1), (Graduated Cylinder / ID: 41_1)-[IS_INSIDE]->(Equipment / ID: 1_0), (Equipment / ID: 1_0)-[CONTAINS]->(General Reagent / ID: 6_1)
2025-11-30 21:35:50,606 - src.components.pre_llm_injector - DEBUG - Limited Person from 137 to 2 external connections
2025-11-30 21:35:50,606 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 137 total -> 2 (internal: 0, external: 2)
2025-11-30 21:35:50,607 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[LOOKS_AT]->(Meniscus / ID: 30_0), (Person / ID: 0_0)-[WEARS]->(Black_Watch / ID: 65_1)
2025-11-30 21:35:50,607 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_6_2', '0.811'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_12_1', '0.791')]
2025-11-30 21:35:50,607 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.823'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_61_1', '0.792')]
2025-11-30 21:35:50,607 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_2', '0.787'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.785')]
2025-11-30 21:35:50,607 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:35:50,607 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_67_0) (~234 words) with timeout=5.0s retries=3
2025-11-30 21:35:51,776 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:35:51,776 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:35:51,776 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_67_1) (~237 words) with timeout=5.0s retries=3
2025-11-30 21:35:52,928 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:35:52,928 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:35:52,929 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_67_2) (~35 words) with timeout=5.0s retries=3
2025-11-30 21:35:53,964 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:35:53,964 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:35:53,964 - src.components.pre_llm_injector - INFO - Extracted 18 local triplets from 3 chunks
2025-11-30 21:35:53,964 - src.pipeline.kg_builder - INFO - Pre-extraction: 18 triplets in 3.58s
2025-11-30 21:35:53,964 - src.components.global_refiner - INFO - Capping refinement input: 18 → 15 triplets
2025-11-30 21:35:53,964 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Equipment / ID: 1_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2), (Person / ID: 0_0)-[TARES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[USES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[MANIPULATES]->(Equipment / ID: 1_0), (Person / ID: 0_0)-[MANIPULATES]->(Liquid_In_Small_Container / ID: 5_0), (Person / ID: 0_0)-[INTERACTS_WITH]->(Balance_Scale / ID: 0_1), (Magnetic_Stirrer / ID: 4_2)-[IS_ON]->(Hot_Plate / ID: 56_1), (Lab / ID: 29_0)-[CONTAINS]->(Magnetic_Stirrer / ID: 4_2), (Mass Of Liquid / ID: 15_1)-[IS_PART_OF]->(Chemical_Solution / ID: 5_1), (Graduated Cylinder / ID: 41_1)-[IS_INSIDE]->(Equipment / ID: 1_0), (Equipment / ID: 1_0)-[CONTAINS]->(General Reagent / ID: 6_1)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[LOOKS_AT]->(Meniscus / ID: 30_0), (Person / ID: 0_0)-[WEARS]->(Black_Watch / ID: 65_1)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue Gloves", "source_chunks": ["67_0"]}, {"head": "Person", "relation": "Uses", "tail": "Pipette", "source_chunks": ["67_0"]}, {"head": "Pipette", "relation": "Adds", "tail": "Clear Liquid", "source_chunks": ["67_0"]}, {"head": "Clear Liquid", "relation": "Is Added To", "tail": "Beaker", "source_chunks": ["67_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudy Liquid", "source_chunks": ["67_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "White Precipitate", "source_chunks": ["67_0"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Beaker", "source_chunks": ["67_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudy_Liquid", "source_chunks": ["67_1"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Glove", "source_chunks": ["67_1"]}, {"head": "Person", "relation": "Handles", "tail": "Beaker", "source_chunks": ["67_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["67_1"]}, {"head": "Magnetic_Stirrer", "relation": "Contains", "tail": "Liquid", "source_chunks": ["67_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Equipment", "source_chunks": ["67_2"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Workspace", "source_chunks": ["67_2"]}, {"head": "Workspace", "relation": "Is", "tail": "Organized", "source_chunks": ["67_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:35:53,965 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~411 words, ~534 tokens)
2025-11-30 21:35:53,965 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:36:03,845 - src.components.global_refiner - DEBUG - LLM call completed in 9.88s
2025-11-30 21:36:03,845 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue Gloves', ['67_0']], ['Person', 'Uses', 'Pipette', ['67_0']], ['Pipette', 'Adds', 'Clear Liquid', ['67_0']], ['Clear Liquid', 'Is Added To', 'Beaker', ['67_0']], ['Beaker', 'Contains', 'Cloudy Liquid', ['67_0']], ['Beaker', 'Contains', 'White Precipitate', ['67_0']], ['Laboratory', 'Contains', 'Beaker', ['67_1']], ['Beaker', 'Contains', 'Cloudy_Liquid', ['67_1']], ['Person', 'Wears', 'Blue_Glove', ['67_1']], ['Person', 'Handles', 'Beaker', ['67_1']], ['Beaker', 'Contains', 'Liquid', ['67_1']], ['Magnetic_Stirrer', 'Contains', 'Liquid', ['67_1']], ['Laboratory', 'Contains', 'Equipment', ['67_2']], ['Laboratory', 'Contains', 'Workspace', ['67_2']], ['Workspace', 'Is', 'Organized', ['67_2']]] inter_chunk_relations=[['Beaker', 'Contains', 'Cloudy Liquid', ['67_0']], ['Beaker', 'Contains', 'White Precipitate', ['67_0']], ['Beaker', 'Contains', 'Cloudy_Liquid', ['67_1']], ['Beaker', 'Contains', 'Liquid', ['67_1']], ['Magnetic_Stirrer', 'Contains', 'Liquid', ['67_1']]] merge_instructions=[{'local': 'Blue Gloves', 'existing': 'Blue_Glove', 'existing_id': '0_3'}, {'local': 'Blue_Glove', 'existing': 'Blue Gloves', 'existing_id': '0_3'}] prune_instructions=[{'entity': 'Blue Gloves'}, {'entity': 'Blue_Glove'}]
2025-11-30 21:36:03,845 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue Gloves', ['67_0']], ['Person', 'Uses', 'Pipette', ['67_0']], ['Pipette', 'Adds', 'Clear Liquid', ['67_0']]]
2025-11-30 21:36:03,846 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Beaker', 'Contains', 'Cloudy Liquid', ['67_0']], ['Beaker', 'Contains', 'White Precipitate', ['67_0']], ['Beaker', 'Contains', 'Cloudy_Liquid', ['67_1']]]
2025-11-30 21:36:03,846 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=2, sample=[{'local': 'Blue Gloves', 'existing': 'Blue_Glove', 'existing_id': '0_3'}, {'local': 'Blue_Glove', 'existing': 'Blue Gloves', 'existing_id': '0_3'}]
2025-11-30 21:36:03,846 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=2, sample=[{'entity': 'Blue Gloves'}, {'entity': 'Blue_Glove'}]
2025-11-30 21:36:03,846 - src.components.global_refiner - INFO - LLM suggested 2 entity merges: [{'local': 'Blue Gloves', 'existing': 'Blue_Glove', 'existing_id': '0_3'}, {'local': 'Blue_Glove', 'existing': 'Blue Gloves', 'existing_id': '0_3'}]
2025-11-30 21:36:03,846 - src.components.global_refiner - INFO - LLM suggested 2 triplets to prune: [{'entity': 'Blue Gloves'}, {'entity': 'Blue_Glove'}]
2025-11-30 21:36:03,846 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 9.88s, LLM: 9.88s)
2025-11-30 21:36:03,846 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 9.88s
2025-11-30 21:36:03,846 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:36:03,846 - src.pipeline.kg_builder - INFO - Pushing batch 68/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:36:03,846 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:36:03,992 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=598, relationships=564
2025-11-30 21:36:03,992 - src.components.neo4j_handler - INFO - Applying 2 merge instructions
2025-11-30 21:36:03,992 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue Gloves -> Blue_Glove
2025-11-30 21:36:03,996 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Glove -> Blue Gloves
2025-11-30 21:36:03,996 - src.components.neo4j_handler - INFO - Applying 2 prune instructions
2025-11-30 21:36:03,997 - src.components.neo4j_handler - DEBUG - No matching entity found to prune: Blue Gloves
2025-11-30 21:36:03,999 - src.components.neo4j_handler - DEBUG - Pruned entity and all its relationships: Blue_Glove
2025-11-30 21:36:03,999 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:36:04,000 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Contains]-> Cloudy Liquid
2025-11-30 21:36:04,002 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Contains]-> White Precipitate
2025-11-30 21:36:04,003 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Contains]-> Cloudy_Liquid
2025-11-30 21:36:04,004 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Beaker -[Contains]-> Liquid
2025-11-30 21:36:04,006 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Magnetic_Stirrer -[Contains]-> Liquid
2025-11-30 21:36:04,006 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:36:04,011 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=596, relationships=562
2025-11-30 21:36:04,012 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:36:04,012 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:36:04,012 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:36:04,012 - src.components.neo4j_handler - INFO - Batch injected in 0.17s (triplets: 0.16s, indexes: 0.00s)
2025-11-30 21:36:04,013 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 307, 'with_embedding': 307, 'linked_chunks': 241}
2025-11-30 21:36:04,013 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:36:04,081 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:36:04,158 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 530
2025-11-30 21:36:04,192 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 596, 'relationship_count': 1805, 'density': 0.0051, 'avg_degree': 6.057, 'avg_unique_neighbors': 5.9732, 'global_efficiency': 0.2826, 'avg_path_length': 2.7558, 'avg_degree_centrality': 0.0102, 'max_degree_centrality': 0.4975, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0361, 'degree_assortativity': -0.1576, 'graph_robustness': 0.8881, 'diameter_estimate': 50, 'clustering_coefficient': 0.2535, 'weakly_connected_components': 67, 'largest_wcc_size': 530, 'pagerank_top10_percent': 5.59, 'louvain_communities': 78, 'louvain_modularity': 0.417, 'label_entropy': 1.4997, 'computational_time': 0.17880766408052295}
2025-11-30 21:36:04,192 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 67, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509764.192955, 'total_time': 13.812554591917433, 'aggregation': 2.763001248240471e-06, 'network_info': 0.006584177957847714, 'llm_extraction': 13.459271574974991, 'data_cleaning': 3.380200359970331e-05, 'neo4j_injection': 0.16624385199975222, 'embedding_time': 0, 'indexing_time': 0.001153324032202363, 'graph_injection_time': 0.16473072092048824, 'acs_metrics': {'node_count': 596, 'relationship_count': 1805, 'density': 0.0051, 'avg_degree': 6.057, 'avg_unique_neighbors': 5.9732, 'global_efficiency': 0.2826, 'avg_path_length': 2.7558, 'avg_degree_centrality': 0.0102, 'max_degree_centrality': 0.4975, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0361, 'degree_assortativity': -0.1576, 'graph_robustness': 0.8881, 'diameter_estimate': 50, 'clustering_coefficient': 0.2535, 'weakly_connected_components': 67, 'largest_wcc_size': 530, 'pagerank_top10_percent': 5.59, 'louvain_communities': 78, 'louvain_modularity': 0.417, 'label_entropy': 1.4997, 'computational_time': 0.17880766408052295}, 'retrieval_queries': []}
2025-11-30 21:36:04,193 - src.pipeline.kg_builder - DEBUG - Batch 67 metrics: {
  "batch_idx": 67,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509764.192955,
  "total_time": 13.812554591917433,
  "aggregation": 2.763001248240471e-06,
  "network_info": 0.006584177957847714,
  "llm_extraction": 13.459271574974991,
  "data_cleaning": 3.380200359970331e-05,
  "neo4j_injection": 0.16624385199975222,
  "embedding_time": 0,
  "indexing_time": 0.001153324032202363,
  "graph_injection_time": 0.16473072092048824,
  "acs_metrics": {
    "node_count": 596,
    "relationship_count": 1805,
    "density": 0.0051,
    "avg_degree": 6.057,
    "avg_unique_neighbors": 5.9732,
    "global_efficiency": 0.2826,
    "avg_path_length": 2.7558,
    "avg_degree_centrality": 0.0102,
    "max_degree_centrality": 0.4975,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0361,
    "degree_assortativity": -0.1576,
    "graph_robustness": 0.8881,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2535,
    "weakly_connected_components": 67,
    "largest_wcc_size": 530,
    "pagerank_top10_percent": 5.59,
    "louvain_communities": 78,
    "louvain_modularity": 0.417,
    "label_entropy": 1.4997,
    "computational_time": 0.17880766408052295
  },
  "retrieval_queries": []
}
2025-11-30 21:36:04,194 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:36:04,194 - src.pipeline.kg_builder - INFO - Batch 68 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 13.46s, Clean: 0.00s, Neo4j: 0.17s, ACS: 0.18s
2025-11-30 21:36:04,194 - src.pipeline.kg_builder - INFO - Batch 68 completed in 13.81s
Processing KG batches:  94%|█████████▍| 68/72 [29:07<01:32, 23.10s/it]2025-11-30 21:36:04,194 - src.pipeline.kg_builder - INFO - Processing batch 69/72 (3 items)
2025-11-30 21:36:04,194 - src.pipeline.kg_builder - DEBUG - Batch 69 current_video_time: 17:07-17:12
2025-11-30 21:36:04,201 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 596
- Total Relationships: 562
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:36:04,202 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 21:36:04,202 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_68_0 ~234 words, content: Time: 16:57-17:02 Content: The video sequence captures a series of events in a laboratory setting, focusing on a scientific experiment involving a magnetic stirrer and...
2025-11-30 21:36:04,202 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_68_1 ~243 words, content: warning label. The person's hand is carefully manipulating the beaker, suggesting they are conducting a precise experiment. - **Frame 4:** The camera returns to a...
2025-11-30 21:36:04,202 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_68_2 ~228 words, content: supplies, and the person appears to be focused on their task. Time: 17:02-17:07 Content: The video captures a sequence of events in a laboratory setting,...
2025-11-30 21:36:04,202 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_68_3 ~232 words, content: . In summary, the video shows a person conducting a chemical experiment in a laboratory. The experiment involves mixing a substance in a beaker using...
2025-11-30 21:36:04,202 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_68_4 ~125 words, content: in the laboratory. He appears to be observing the experiment. His presence suggests that he might be a researcher or a student conducting the experiment....
2025-11-30 21:36:04,222 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:36:04,333 - src.components.pre_llm_injector - DEBUG - Found 307 existing chunk embeddings for similarity lookup
2025-11-30 21:36:04,419 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_3', '0.961'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_0', '0.791')]
2025-11-30 21:36:04,421 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_3 via source_chunk_ids
2025-11-30 21:36:04,421 - src.components.pre_llm_injector - DEBUG - Found 5 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_0
2025-11-30 21:36:04,421 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:36:04,425 - src.components.pre_llm_injector - DEBUG - Limited Countertop from 3 to 2 external connections
2025-11-30 21:36:04,425 - src.components.pre_llm_injector - DEBUG - Limited Mass Of Liquid from 85 to 2 external connections
2025-11-30 21:36:04,425 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 95 total -> 11 (internal: 2, external: 9)
2025-11-30 21:36:04,425 - src.components.pre_llm_injector - DEBUG - Subgraph: (Workbench / ID: 1_1)-[HOLDS]->(Countertop / ID: 1_0), (Workbench / ID: 1_1)-[HOLDS]->(Pump / ID: 47_0), (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1), (Workbench / ID: 1_1)-[HOLDS]->(Liquid_In_Small_Container / ID: 5_0), (Liquid_In_Small_Container / ID: 5_0)-[IS_ON]->(Countertop / ID: 1_0), (Countertop / ID: 1_0)-[CONTAINS]->(Equipment / ID: 1_0), (Graduated Cylinder / ID: 41_1)-[RECEIVES]->(Mass Of Liquid / ID: 15_1), (Glass_Volumetric_Flask / ID: 29_2)-[CONTAINS]->(Mass Of Liquid / ID: 15_1), (Clear Plastic Container / ID: 47_1)-[CONTAINS]->(Water / ID: 47_0), (Water / ID: 47_0)-[IS_CONNECTED_TO]->(Transparent Tube / ID: 48_0), (Pump / ID: 47_0)-[CONNECTED_TO]->(Long_Translucent_Pipette / ID: 54_0)
2025-11-30 21:36:04,425 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_31_2', '0.772'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_34_0', '0.640')]
2025-11-30 21:36:04,425 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_10_3', '0.961'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_54_0', '0.474')]
2025-11-30 21:36:04,425 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_46_1', '0.760'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_2', '0.740')]
2025-11-30 21:36:04,425 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_47_0', '0.791'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_49_0', '0.710')]
2025-11-30 21:36:04,425 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_51_3', '0.733'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.724')]
2025-11-30 21:36:04,425 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:36:04,425 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_68_0) (~234 words) with timeout=5.0s retries=3
2025-11-30 21:36:05,532 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:36:05,532 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:36:05,532 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_68_1) (~243 words) with timeout=5.0s retries=3
2025-11-30 21:36:06,778 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:36:06,778 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:36:06,779 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_68_2) (~228 words) with timeout=5.0s retries=3
2025-11-30 21:36:07,926 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:36:07,926 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:36:07,926 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_68_3) (~232 words) with timeout=5.0s retries=3
2025-11-30 21:36:09,005 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:36:09,008 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:36:09,009 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_68_4) (~125 words) with timeout=5.0s retries=3
2025-11-30 21:36:09,940 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:36:09,940 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:36:09,940 - src.components.pre_llm_injector - INFO - Extracted 27 local triplets from 5 chunks
2025-11-30 21:36:09,941 - src.pipeline.kg_builder - INFO - Pre-extraction: 27 triplets in 5.74s
2025-11-30 21:36:09,941 - src.components.global_refiner - INFO - Capping refinement input: 27 → 15 triplets
2025-11-30 21:36:09,941 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Workbench / ID: 1_1)-[HOLDS]->(Countertop / ID: 1_0), (Workbench / ID: 1_1)-[HOLDS]->(Pump / ID: 47_0), (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 0_1), (Workbench / ID: 1_1)-[HOLDS]->(Liquid_In_Small_Container / ID: 5_0), (Liquid_In_Small_Container / ID: 5_0)-[IS_ON]->(Countertop / ID: 1_0), (Countertop / ID: 1_0)-[CONTAINS]->(Equipment / ID: 1_0), (Graduated Cylinder / ID: 41_1)-[RECEIVES]->(Mass Of Liquid / ID: 15_1), (Glass_Volumetric_Flask / ID: 29_2)-[CONTAINS]->(Mass Of Liquid / ID: 15_1), (Clear Plastic Container / ID: 47_1)-[CONTAINS]->(Water / ID: 47_0), (Water / ID: 47_0)-[IS_CONNECTED_TO]->(Transparent Tube / ID: 48_0), (Pump / ID: 47_0)-[CONNECTED_TO]->(Long_Translucent_Pipette / ID: 54_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Beige Sweater", "source_chunks": ["68_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Jeans", "source_chunks": ["68_0"]}, {"head": "Person", "relation": "Holds", "tail": "White Object", "source_chunks": ["68_0"]}, {"head": "Person", "relation": "Interacts With", "tail": "Magnetic Stirrer", "source_chunks": ["68_0"]}, {"head": "Hand", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["68_0"]}, {"head": "Hand", "relation": "Holds", "tail": "Beaker", "source_chunks": ["68_0"]}, {"head": "Person", "relation": "Manipulates", "tail": "Beaker", "source_chunks": ["68_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["68_1", "68_3"]}, {"head": "Magnetic Stirrer", "relation": "Stirs", "tail": "Liquid", "source_chunks": ["68_1"]}, {"head": "Person", "relation": "Interacts With", "tail": "Laboratory Equipment", "source_chunks": ["68_1"]}, {"head": "Laboratory Equipment", "relation": "Includes", "tail": "Magnetic Stirrer", "source_chunks": ["68_1"]}, {"head": "Magnetic Stirrer", "relation": "Is Connected To", "tail": "Power Source", "source_chunks": ["68_1"]}, {"head": "Lab Workstation", "relation": "Contains", "tail": "Magnetic Stirrer", "source_chunks": ["68_2"]}, {"head": "Magnetic Stirrer", "relation": "Mixes", "tail": "Liquid", "source_chunks": ["68_2"]}, {"head": "Liquid", "relation": "Connected To", "tail": "Beaker", "source_chunks": ["68_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:36:09,941 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~405 words, ~526 tokens)
2025-11-30 21:36:09,941 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:36:19,988 - src.components.global_refiner - DEBUG - LLM call completed in 10.05s
2025-11-30 21:36:19,988 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Beige Sweater', ['68_0']], ['Person', 'Wears', 'Blue Jeans', ['68_0']], ['Person', 'Holds', 'White Object', ['68_0']], ['Person', 'Interacts With', 'Magnetic Stirrer', ['68_0']], ['Hand', 'Wears', 'Blue Glove', ['68_0']], ['Hand', 'Holds', 'Beaker', ['68_0']], ['Person', 'Manipulates', 'Beaker', ['68_1']], ['Beaker', 'Contains', 'Liquid', ['68_1', '68_3']], ['Magnetic Stirrer', 'Stirs', 'Liquid', ['68_1']], ['Person', 'Interacts With', 'Laboratory Equipment', ['68_1']], ['Laboratory Equipment', 'Includes', 'Magnetic Stirrer', ['68_1']], ['Magnetic Stirrer', 'Is Connected To', 'Power Source', ['68_1']], ['Lab Workstation', 'Contains', 'Magnetic Stirrer', ['68_2']], ['Magnetic Stirrer', 'Mixes', 'Liquid', ['68_2']], ['Liquid', 'Connected To', 'Beaker', ['68_2']]] inter_chunk_relations=[['Person', 'Interacts With', 'Magnetic Stirrer', ['68_0']], ['Hand', 'Holds', 'Beaker', ['68_0']], ['Magnetic Stirrer', 'Stirs', 'Liquid', ['68_1']], ['Magnetic Stirrer', 'Is Connected To', 'Power Source', ['68_1']], ['Lab Workstation', 'Contains', 'Magnetic Stirrer', ['68_2']]] merge_instructions=[{'local': 'Blue Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}]
2025-11-30 21:36:19,988 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Beige Sweater', ['68_0']], ['Person', 'Wears', 'Blue Jeans', ['68_0']], ['Person', 'Holds', 'White Object', ['68_0']]]
2025-11-30 21:36:19,988 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Person', 'Interacts With', 'Magnetic Stirrer', ['68_0']], ['Hand', 'Holds', 'Beaker', ['68_0']], ['Magnetic Stirrer', 'Stirs', 'Liquid', ['68_1']]]
2025-11-30 21:36:19,988 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=1, sample=[{'local': 'Blue Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}]
2025-11-30 21:36:19,988 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=1, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}]
2025-11-30 21:36:19,988 - src.components.global_refiner - INFO - LLM suggested 1 entity merges: [{'local': 'Blue Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}]
2025-11-30 21:36:19,988 - src.components.global_refiner - INFO - LLM suggested 1 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'No Glove'}]
2025-11-30 21:36:19,988 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 10.05s, LLM: 10.05s)
2025-11-30 21:36:19,988 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 10.05s
2025-11-30 21:36:19,988 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:36:19,988 - src.pipeline.kg_builder - INFO - Pushing batch 69/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:36:19,988 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:36:20,154 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=605, relationships=576
2025-11-30 21:36:20,154 - src.components.neo4j_handler - INFO - Applying 1 merge instructions
2025-11-30 21:36:20,154 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue Glove -> Blue Glove
2025-11-30 21:36:20,155 - src.components.neo4j_handler - INFO - Applying 1 prune instructions
2025-11-30 21:36:20,155 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> No Glove
2025-11-30 21:36:20,155 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 21:36:20,156 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Interacts With]-> Magnetic Stirrer
2025-11-30 21:36:20,158 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Hand -[Holds]-> Beaker
2025-11-30 21:36:20,185 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Magnetic Stirrer -[Stirs]-> Liquid
2025-11-30 21:36:20,187 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Magnetic Stirrer -[Is Connected To]-> Power Source
2025-11-30 21:36:20,188 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab Workstation -[Contains]-> Magnetic Stirrer
2025-11-30 21:36:20,189 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:36:20,194 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=605, relationships=576
2025-11-30 21:36:20,195 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:36:20,195 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:36:20,195 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:36:20,195 - src.components.neo4j_handler - INFO - Batch injected in 0.21s (triplets: 0.21s, indexes: 0.00s)
2025-11-30 21:36:20,196 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 312, 'with_embedding': 312, 'linked_chunks': 245}
2025-11-30 21:36:20,196 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:36:20,266 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:36:20,343 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 538
2025-11-30 21:36:20,380 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 605, 'relationship_count': 1837, 'density': 0.005, 'avg_degree': 6.0727, 'avg_unique_neighbors': 5.9868, 'global_efficiency': 0.2806, 'avg_path_length': 2.7511, 'avg_degree_centrality': 0.0101, 'max_degree_centrality': 0.5017, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0344, 'degree_assortativity': -0.1599, 'graph_robustness': 0.8884, 'diameter_estimate': 50, 'clustering_coefficient': 0.2557, 'weakly_connected_components': 68, 'largest_wcc_size': 538, 'pagerank_top10_percent': 5.49, 'louvain_communities': 79, 'louvain_modularity': 0.423, 'label_entropy': 1.4996, 'computational_time': 0.1830443519866094}
2025-11-30 21:36:20,380 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 68, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509780.380254, 'total_time': 16.18579915293958, 'aggregation': 4.1800085455179214e-06, 'network_info': 0.0070496510015800595, 'llm_extraction': 15.78676088701468, 'data_cleaning': 1.51490094140172e-05, 'neo4j_injection': 0.20723255793564022, 'embedding_time': 0, 'indexing_time': 0.0011157109402120113, 'graph_injection_time': 0.20592727104667574, 'acs_metrics': {'node_count': 605, 'relationship_count': 1837, 'density': 0.005, 'avg_degree': 6.0727, 'avg_unique_neighbors': 5.9868, 'global_efficiency': 0.2806, 'avg_path_length': 2.7511, 'avg_degree_centrality': 0.0101, 'max_degree_centrality': 0.5017, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0344, 'degree_assortativity': -0.1599, 'graph_robustness': 0.8884, 'diameter_estimate': 50, 'clustering_coefficient': 0.2557, 'weakly_connected_components': 68, 'largest_wcc_size': 538, 'pagerank_top10_percent': 5.49, 'louvain_communities': 79, 'louvain_modularity': 0.423, 'label_entropy': 1.4996, 'computational_time': 0.1830443519866094}, 'retrieval_queries': []}
2025-11-30 21:36:20,380 - src.pipeline.kg_builder - DEBUG - Batch 68 metrics: {
  "batch_idx": 68,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509780.380254,
  "total_time": 16.18579915293958,
  "aggregation": 4.1800085455179214e-06,
  "network_info": 0.0070496510015800595,
  "llm_extraction": 15.78676088701468,
  "data_cleaning": 1.51490094140172e-05,
  "neo4j_injection": 0.20723255793564022,
  "embedding_time": 0,
  "indexing_time": 0.0011157109402120113,
  "graph_injection_time": 0.20592727104667574,
  "acs_metrics": {
    "node_count": 605,
    "relationship_count": 1837,
    "density": 0.005,
    "avg_degree": 6.0727,
    "avg_unique_neighbors": 5.9868,
    "global_efficiency": 0.2806,
    "avg_path_length": 2.7511,
    "avg_degree_centrality": 0.0101,
    "max_degree_centrality": 0.5017,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0344,
    "degree_assortativity": -0.1599,
    "graph_robustness": 0.8884,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2557,
    "weakly_connected_components": 68,
    "largest_wcc_size": 538,
    "pagerank_top10_percent": 5.49,
    "louvain_communities": 79,
    "louvain_modularity": 0.423,
    "label_entropy": 1.4996,
    "computational_time": 0.1830443519866094
  },
  "retrieval_queries": []
}
2025-11-30 21:36:20,381 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:36:20,381 - src.pipeline.kg_builder - INFO - Batch 69 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 15.79s, Clean: 0.00s, Neo4j: 0.21s, ACS: 0.18s
2025-11-30 21:36:20,381 - src.pipeline.kg_builder - INFO - Batch 69 completed in 16.19s
Processing KG batches:  96%|█████████▌| 69/72 [29:23<01:03, 21.03s/it]2025-11-30 21:36:20,381 - src.pipeline.kg_builder - INFO - Processing batch 70/72 (3 items)
2025-11-30 21:36:20,381 - src.pipeline.kg_builder - DEBUG - Batch 70 current_video_time: 17:22-17:27
2025-11-30 21:36:20,388 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 605
- Total Relationships: 576
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:36:20,388 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:36:20,388 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_69_0 ~226 words, content: Time: 17:12-17:17 Content: The video sequence captures a scene within a laboratory, focusing on a scientific experiment in progress. The setting is a well-equipped lab...
2025-11-30 21:36:20,388 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_69_1 ~230 words, content: are methodical and suggest a controlled experiment. - **Initial Setup:** The scene is a laboratory with a black countertop. A person wearing a blue nitrile...
2025-11-30 21:36:20,389 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_69_2 ~216 words, content: The camera angle changes slightly, providing a closer view of the person's hand as they adjust the flask in the beaker. The focus remains on...
2025-11-30 21:36:20,389 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_69_3 ~97 words, content: fully immersed. - **Final State:** The vial is now completely submerged in the liquid. The hand remains in the beaker, holding the vial in place....
2025-11-30 21:36:20,409 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:36:20,520 - src.components.pre_llm_injector - DEBUG - Found 312 existing chunk embeddings for similarity lookup
2025-11-30 21:36:20,590 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3', '0.770'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_65_2', '0.770')]
2025-11-30 21:36:20,592 - src.components.pre_llm_injector - DEBUG - Found 1 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3
2025-11-30 21:36:20,592 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:36:20,592 - src.components.pre_llm_injector - DEBUG - Found 3 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_65_2
2025-11-30 21:36:20,592 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:36:20,628 - src.components.pre_llm_injector - DEBUG - Limited Person from 144 to 2 external connections
2025-11-30 21:36:20,628 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 144 total -> 2 (internal: 0, external: 2)
2025-11-30 21:36:20,628 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[REMOVES]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HOLDS]->(Long White Flexible Tube / ID: 45_2)
2025-11-30 21:36:20,632 - src.components.pre_llm_injector - DEBUG - Limited Person from 143 to 2 external connections
2025-11-30 21:36:20,632 - src.components.pre_llm_injector - DEBUG - Limited Procedure from 7 to 2 external connections
2025-11-30 21:36:20,632 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 151 total -> 5 (internal: 1, external: 4)
2025-11-30 21:36:20,632 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[PERFORMS]->(Scientific_Procedure / ID: 56_1), (Person / ID: 0_0)-[WEARS]->(Beige Sweater / ID: 68_0), (Person / ID: 0_0)-[WRITES_ON]->(Document / ID: 0_2), (Procedure / ID: 54_0)-[INCLUDES]->(Round_Bottom_Flask / ID: 56_1), (Procedure / ID: 54_0)-[CONTAINS]->(Long Tube / ID: 59_2)
2025-11-30 21:36:20,632 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_23_1', '0.753'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_67_2', '0.742')]
2025-11-30 21:36:20,632 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_27_0', '0.732'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_11_3', '0.704')]
2025-11-30 21:36:20,633 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_40_3', '0.695'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.693')]
2025-11-30 21:36:20,633 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_41_3', '0.770'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_65_2', '0.770')]
2025-11-30 21:36:20,633 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:36:20,633 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_69_0) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:36:21,628 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:36:21,628 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:36:21,628 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_69_1) (~230 words) with timeout=5.0s retries=3
2025-11-30 21:36:23,284 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:36:23,285 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:36:23,285 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_69_2) (~216 words) with timeout=5.0s retries=3
2025-11-30 21:36:24,406 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:36:24,406 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:36:24,407 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_69_3) (~97 words) with timeout=5.0s retries=3
2025-11-30 21:36:25,494 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:36:25,495 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:36:25,495 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 4 chunks
2025-11-30 21:36:25,495 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 5.11s
2025-11-30 21:36:25,495 - src.components.global_refiner - INFO - Capping refinement input: 22 → 15 triplets
2025-11-30 21:36:25,495 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[REMOVES]->(Bottle / ID: 1_1), (Person / ID: 0_0)-[HOLDS]->(Long White Flexible Tube / ID: 45_2)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[PERFORMS]->(Scientific_Procedure / ID: 56_1), (Person / ID: 0_0)-[WEARS]->(Beige Sweater / ID: 68_0), (Person / ID: 0_0)-[WRITES_ON]->(Document / ID: 0_2), (Procedure / ID: 54_0)-[INCLUDES]->(Round_Bottom_Flask / ID: 56_1), (Procedure / ID: 54_0)-[CONTAINS]->(Long Tube / ID: 59_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue Glove", "source_chunks": ["69_0"]}, {"head": "Person", "relation": "Handles", "tail": "Container", "source_chunks": ["69_0"]}, {"head": "Container", "relation": "Contains", "tail": "Substance", "source_chunks": ["69_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Substance", "source_chunks": ["69_0"]}, {"head": "Person", "relation": "Adds", "tail": "Substance", "source_chunks": ["69_0"]}, {"head": "Beaker", "relation": "Is Part Of", "tail": "Apparatus", "source_chunks": ["69_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["69_1"]}, {"head": "Person", "relation": "Holds", "tail": "Round_Bottom_Flask", "source_chunks": ["69_1"]}, {"head": "Round_Bottom_Flask", "relation": "Is Connected To", "tail": "Flexible_Tube", "source_chunks": ["69_1"]}, {"head": "Flexible_Tube", "relation": "Leads To", "tail": "Clear_Plastic_Beaker", "source_chunks": ["69_1"]}, {"head": "Clear_Plastic_Beaker", "relation": "Contains", "tail": "Clear_Liquid", "source_chunks": ["69_1"]}, {"head": "Lab_Table", "relation": "Contains", "tail": "Magnetic_Stirrer", "source_chunks": ["69_1"]}, {"head": "Person", "relation": "Wears", "tail": "Glove", "source_chunks": ["69_2"]}, {"head": "Person", "relation": "Holds", "tail": "Vial", "source_chunks": ["69_2"]}, {"head": "Vial", "relation": "Is Lowered Into", "tail": "Beaker", "source_chunks": ["69_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:36:25,495 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~364 words, ~473 tokens)
2025-11-30 21:36:25,495 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:36:43,674 - src.components.global_refiner - DEBUG - LLM call completed in 18.18s
2025-11-30 21:36:43,675 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue Glove', ['69_0']], ['Person', 'Handles', 'Container', ['69_0']], ['Container', 'Contains', 'Substance', ['69_0']], ['Beaker', 'Contains', 'Substance', ['69_0']], ['Person', 'Adds', 'Substance', ['69_0']], ['Beaker', 'Is Part Of', 'Apparatus', ['69_0']], ['Person', 'Wears', 'Blue_Nitrile_Glove', ['69_1']], ['Person', 'Holds', 'Round_Bottom_Flask', ['69_1']], ['Round_Bottom_Flask', 'Is Connected To', 'Flexible_Tube', ['69_1']], ['Flexible_Tube', 'Leads To', 'Clear_Plastic_Beaker', ['69_1']], ['Clear_Plastic_Beaker', 'Contains', 'Clear_Liquid', ['69_1']], ['Lab_Table', 'Contains', 'Magnetic_Stirrer', ['69_1']], ['Person', 'Wears', 'Glove', ['69_2']], ['Person', 'Holds', 'Vial', ['69_2']], ['Vial', 'Is Lowered Into', 'Beaker', ['69_2']]] inter_chunk_relations=[['Person', 'Wears', 'Blue Glove', ['69_0']], ['Person', 'Wears', 'Blue_Nitrile_Glove', ['69_1']], ['Person', 'Wears', 'Glove', ['69_2']], ['Person', 'Holds', 'Round_Bottom_Flask', ['69_1']], ['Round_Bottom_Flask', 'Is Connected To', 'Flexible_Tube', ['69_1']], ['Flexible_Tube', 'Leads To', 'Clear_Plastic_Beaker', ['69_1']], ['Clear_Plastic_Beaker', 'Contains', 'Clear_Liquid', ['69_1']], ['Lab_Table', 'Contains', 'Magnetic_Stirrer', ['69_1']], ['Person', 'Holds', 'Vial', ['69_2']], ['Vial', 'Is Lowered Into', 'Beaker', ['69_2']]] merge_instructions=[{'local': 'Blue Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue_Nitrile_Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Glove'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Round_Bottom_Flask'}, {'head': 'Round_Bottom_Flask', 'relation': 'Is Connected To', 'tail': 'Flexible_Tube'}, {'head': 'Flexible_Tube', 'relation': 'Leads To', 'tail': 'Clear_Plastic_Beaker'}, {'head': 'Clear_Plastic_Beaker', 'relation': 'Contains', 'tail': 'Clear_Liquid'}, {'head': 'Lab_Table', 'relation': 'Contains', 'tail': 'Magnetic_Stirrer'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Vial', 'relation': 'Is Lowered Into', 'tail': 'Beaker'}]
2025-11-30 21:36:43,675 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue Glove', ['69_0']], ['Person', 'Handles', 'Container', ['69_0']], ['Container', 'Contains', 'Substance', ['69_0']]]
2025-11-30 21:36:43,675 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=10, sample=[['Person', 'Wears', 'Blue Glove', ['69_0']], ['Person', 'Wears', 'Blue_Nitrile_Glove', ['69_1']], ['Person', 'Wears', 'Glove', ['69_2']]]
2025-11-30 21:36:43,675 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=3, sample=[{'local': 'Blue Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue_Nitrile_Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}]
2025-11-30 21:36:43,675 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=10, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Glove'}]
2025-11-30 21:36:43,675 - src.components.global_refiner - INFO - LLM suggested 3 entity merges: [{'local': 'Blue Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Blue_Nitrile_Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}, {'local': 'Glove', 'existing': 'Blue Glove', 'existing_id': '0_3'}]
2025-11-30 21:36:43,675 - src.components.global_refiner - INFO - LLM suggested 10 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue_Nitrile_Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Glove'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Round_Bottom_Flask'}, {'head': 'Round_Bottom_Flask', 'relation': 'Is Connected To', 'tail': 'Flexible_Tube'}, {'head': 'Flexible_Tube', 'relation': 'Leads To', 'tail': 'Clear_Plastic_Beaker'}, {'head': 'Clear_Plastic_Beaker', 'relation': 'Contains', 'tail': 'Clear_Liquid'}, {'head': 'Lab_Table', 'relation': 'Contains', 'tail': 'Magnetic_Stirrer'}, {'head': 'Person', 'relation': 'Holds', 'tail': 'Vial'}, {'head': 'Vial', 'relation': 'Is Lowered Into', 'tail': 'Beaker'}]
2025-11-30 21:36:43,675 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 25 triplets (total: 18.18s, LLM: 18.18s)
2025-11-30 21:36:43,675 - src.pipeline.kg_builder - INFO - Global refinement: 25 triplets in 18.18s
2025-11-30 21:36:43,675 - src.pipeline.kg_builder - INFO - Using 25 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:36:43,675 - src.pipeline.kg_builder - INFO - Pushing batch 70/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:36:43,676 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:36:43,855 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=615, relationships=587
2025-11-30 21:36:43,855 - src.components.neo4j_handler - INFO - Applying 3 merge instructions
2025-11-30 21:36:43,855 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue Glove -> Blue Glove
2025-11-30 21:36:43,855 - src.components.neo4j_handler - DEBUG - APOC merge successful: Blue_Nitrile_Glove -> Blue Glove
2025-11-30 21:36:43,860 - src.components.neo4j_handler - DEBUG - APOC merge successful: Glove -> Blue Glove
2025-11-30 21:36:43,860 - src.components.neo4j_handler - INFO - Applying 10 prune instructions
2025-11-30 21:36:43,865 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Glove
2025-11-30 21:36:43,866 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Blue_Nitrile_Glove
2025-11-30 21:36:43,867 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Person -[Wears]-> Glove
2025-11-30 21:36:43,868 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Round_Bottom_Flask
2025-11-30 21:36:43,869 - src.components.neo4j_handler - DEBUG - Pruned relationship: Round_Bottom_Flask -[Is Connected To]-> Flexible_Tube
2025-11-30 21:36:43,896 - src.components.neo4j_handler - DEBUG - Pruned relationship: Flexible_Tube -[Leads To]-> Clear_Plastic_Beaker
2025-11-30 21:36:43,897 - src.components.neo4j_handler - DEBUG - Pruned relationship: Clear_Plastic_Beaker -[Contains]-> Clear_Liquid
2025-11-30 21:36:43,899 - src.components.neo4j_handler - DEBUG - Pruned relationship: Lab_Table -[Contains]-> Magnetic_Stirrer
2025-11-30 21:36:43,901 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Holds]-> Vial
2025-11-30 21:36:43,922 - src.components.neo4j_handler - DEBUG - Pruned relationship: Vial -[Is Lowered Into]-> Beaker
2025-11-30 21:36:43,922 - src.components.neo4j_handler - INFO - Applying 10 inter-chunk relations
2025-11-30 21:36:43,923 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Wears]-> Blue Glove
2025-11-30 21:36:43,924 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Blue_Nitrile_Glove
2025-11-30 21:36:43,925 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Person -[Wears]-> Glove
2025-11-30 21:36:43,926 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Round_Bottom_Flask
2025-11-30 21:36:43,928 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Round_Bottom_Flask -[Is Connected To]-> Flexible_Tube
2025-11-30 21:36:43,954 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Flexible_Tube -[Leads To]-> Clear_Plastic_Beaker
2025-11-30 21:36:43,956 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Clear_Plastic_Beaker -[Contains]-> Clear_Liquid
2025-11-30 21:36:43,958 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Lab_Table -[Contains]-> Magnetic_Stirrer
2025-11-30 21:36:43,960 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Holds]-> Vial
2025-11-30 21:36:43,986 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Vial -[Is Lowered Into]-> Beaker
2025-11-30 21:36:43,988 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:36:43,993 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=613, relationships=583
2025-11-30 21:36:43,994 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:36:43,994 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:36:43,995 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:36:43,995 - src.components.neo4j_handler - INFO - Batch injected in 0.32s (triplets: 0.32s, indexes: 0.00s)
2025-11-30 21:36:43,997 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 316, 'with_embedding': 316, 'linked_chunks': 248}
2025-11-30 21:36:43,997 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:36:44,067 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:36:44,146 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 545
2025-11-30 21:36:44,182 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 613, 'relationship_count': 1863, 'density': 0.005, 'avg_degree': 6.0783, 'avg_unique_neighbors': 5.9935, 'global_efficiency': 0.2835, 'avg_path_length': 2.7511, 'avg_degree_centrality': 0.0099, 'max_degree_centrality': 0.5016, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0361, 'degree_assortativity': -0.1587, 'graph_robustness': 0.8776, 'diameter_estimate': 50, 'clustering_coefficient': 0.2563, 'weakly_connected_components': 69, 'largest_wcc_size': 545, 'pagerank_top10_percent': 5.39, 'louvain_communities': 81, 'louvain_modularity': 0.4173, 'label_entropy': 1.4997, 'computational_time': 0.18500106502324343}
2025-11-30 21:36:44,182 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 69, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509804.1824386, 'total_time': 23.800624310038984, 'aggregation': 3.41096892952919e-06, 'network_info': 0.006536985049024224, 'llm_extraction': 23.287296707043424, 'data_cleaning': 4.044501110911369e-05, 'neo4j_injection': 0.3194297750014812, 'embedding_time': 0, 'indexing_time': 0.001817904063500464, 'graph_injection_time': 0.3172362810000777, 'acs_metrics': {'node_count': 613, 'relationship_count': 1863, 'density': 0.005, 'avg_degree': 6.0783, 'avg_unique_neighbors': 5.9935, 'global_efficiency': 0.2835, 'avg_path_length': 2.7511, 'avg_degree_centrality': 0.0099, 'max_degree_centrality': 0.5016, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0361, 'degree_assortativity': -0.1587, 'graph_robustness': 0.8776, 'diameter_estimate': 50, 'clustering_coefficient': 0.2563, 'weakly_connected_components': 69, 'largest_wcc_size': 545, 'pagerank_top10_percent': 5.39, 'louvain_communities': 81, 'louvain_modularity': 0.4173, 'label_entropy': 1.4997, 'computational_time': 0.18500106502324343}, 'retrieval_queries': []}
2025-11-30 21:36:44,182 - src.pipeline.kg_builder - DEBUG - Batch 69 metrics: {
  "batch_idx": 69,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509804.1824386,
  "total_time": 23.800624310038984,
  "aggregation": 3.41096892952919e-06,
  "network_info": 0.006536985049024224,
  "llm_extraction": 23.287296707043424,
  "data_cleaning": 4.044501110911369e-05,
  "neo4j_injection": 0.3194297750014812,
  "embedding_time": 0,
  "indexing_time": 0.001817904063500464,
  "graph_injection_time": 0.3172362810000777,
  "acs_metrics": {
    "node_count": 613,
    "relationship_count": 1863,
    "density": 0.005,
    "avg_degree": 6.0783,
    "avg_unique_neighbors": 5.9935,
    "global_efficiency": 0.2835,
    "avg_path_length": 2.7511,
    "avg_degree_centrality": 0.0099,
    "max_degree_centrality": 0.5016,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0361,
    "degree_assortativity": -0.1587,
    "graph_robustness": 0.8776,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2563,
    "weakly_connected_components": 69,
    "largest_wcc_size": 545,
    "pagerank_top10_percent": 5.39,
    "louvain_communities": 81,
    "louvain_modularity": 0.4173,
    "label_entropy": 1.4997,
    "computational_time": 0.18500106502324343
  },
  "retrieval_queries": []
}
2025-11-30 21:36:44,183 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:36:44,183 - src.pipeline.kg_builder - INFO - Batch 70 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 23.29s, Clean: 0.00s, Neo4j: 0.32s, ACS: 0.19s
2025-11-30 21:36:44,183 - src.pipeline.kg_builder - INFO - Batch 70 completed in 23.80s
Processing KG batches:  97%|█████████▋| 70/72 [29:47<00:43, 21.86s/it]2025-11-30 21:36:44,183 - src.pipeline.kg_builder - INFO - Processing batch 71/72 (3 items)
2025-11-30 21:36:44,183 - src.pipeline.kg_builder - DEBUG - Batch 71 current_video_time: 17:37-17:42
2025-11-30 21:36:44,190 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 613
- Total Relationships: 583
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:36:44,191 - src.components.pre_llm_injector - DEBUG - Split content into 6 chunks (chunk_size=296, overlap=16)
2025-11-30 21:36:44,191 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_70_0 ~224 words, content: Time: 17:27-17:32 Content: The sequence of frames captures a scientific experiment being conducted in a laboratory setting. The overall process involves preparing a solution and...
2025-11-30 21:36:44,191 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_70_1 ~237 words, content: is visible inside it. The white tube is now positioned to deliver a substance into this beaker. To the left, a Mettler Toledo analytical balance...
2025-11-30 21:36:44,191 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_70_2 ~216 words, content: shown is a step in a larger chemical synthesis or analysis. Time: 17:32-17:37 Content: The video captures a sequence of laboratory activities, likely a chemical...
2025-11-30 21:36:44,191 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_70_3 ~232 words, content: the camera as it moves from the close-up of the experiment to a broader view of the lab. - **Final Scene (Frame 4):** The camera...
2025-11-30 21:36:44,191 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_70_4 ~234 words, content: a chemical reaction is occurring, possibly the formation of a precipitate or a phase change. - **Continuation of the Process:** In the fourth frame, the...
2025-11-30 21:36:44,191 - src.components.pre_llm_injector - DEBUG - Chunk[5] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_70_5 ~22 words, content:  from clear to cloudy white. The final frame shows this experiment in the context of a larger laboratory setup with other equipment.
2025-11-30 21:36:44,211 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:36:44,330 - src.components.pre_llm_injector - DEBUG - Found 316 existing chunk embeddings for similarity lookup
2025-11-30 21:36:44,431 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.804'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_1', '0.797')]
2025-11-30 21:36:44,433 - src.components.pre_llm_injector - DEBUG - Found 7 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_1
2025-11-30 21:36:44,433 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:36:44,434 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3 via source_chunk_ids
2025-11-30 21:36:44,455 - src.components.pre_llm_injector - DEBUG - Limited Person from 141 to 2 external connections
2025-11-30 21:36:44,455 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 148 total -> 9 (internal: 4, external: 5)
2025-11-30 21:36:44,455 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[PERFORMS]->(Task / ID: 45_1), (Person / ID: 0_0)-[HOLDS]->(Glass_Component / ID: 45_1), (Laboratory_Environment / ID: 45_1)-[CONTAINS]->(Black_Countertop / ID: 45_1), (Person / ID: 0_0)-[WEARS]->(Blue Glove / ID: 33_0), (Person / ID: 0_0)-[CONDUCTS]->(Experiment / ID: 35_2), (Person / ID: 0_0)-[HANDLES]->(Test Tube / ID: 2_0), (Liquid_In_Small_Container / ID: 5_0)-[IS_ON]->(White_Tray / ID: 45_1), (Glass_Component / ID: 45_1)-[IS_CONNECTED_TO]->(Liquid_In_Small_Container / ID: 5_0), (Hand / ID: 10_1)-[WEARS]->(Blue Glove / ID: 33_0)
2025-11-30 21:36:44,455 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_45_1', '0.797'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.630')]
2025-11-30 21:36:44,455 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.787'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_66_1', '0.777')]
2025-11-30 21:36:44,455 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_59_1', '0.626'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_25_2', '0.620')]
2025-11-30 21:36:44,455 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_63_0', '0.627'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_60_2', '0.602')]
2025-11-30 21:36:44,455 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_68_2', '0.749'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_35_2', '0.744')]
2025-11-30 21:36:44,455 - src.components.pre_llm_injector - DEBUG - Chunk 5 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_2_3', '0.804'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_1_4', '0.778')]
2025-11-30 21:36:44,455 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:36:44,455 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_70_0) (~224 words) with timeout=5.0s retries=3
2025-11-30 21:36:45,800 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:36:45,801 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:36:45,801 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_70_1) (~237 words) with timeout=5.0s retries=3
2025-11-30 21:36:47,080 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:36:47,080 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:36:47,081 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_70_2) (~216 words) with timeout=5.0s retries=3
2025-11-30 21:36:48,373 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:36:48,373 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:36:48,373 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_70_3) (~232 words) with timeout=5.0s retries=3
2025-11-30 21:36:49,623 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:36:49,624 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:36:49,624 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_70_4) (~234 words) with timeout=5.0s retries=3
2025-11-30 21:36:50,899 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 21:36:50,899 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 21:36:50,899 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 5 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_70_5) (~22 words) with timeout=5.0s retries=3
2025-11-30 21:36:51,721 - src.components.pre_llm_injector - DEBUG - Extracted 4 triplets from chunk 5 (attempt 1)
2025-11-30 21:36:51,721 - src.components.pre_llm_injector - DEBUG - Chunk 5 returned 4 triplets
2025-11-30 21:36:51,721 - src.components.pre_llm_injector - INFO - Extracted 29 local triplets from 6 chunks
2025-11-30 21:36:51,721 - src.pipeline.kg_builder - INFO - Pre-extraction: 29 triplets in 7.53s
2025-11-30 21:36:51,723 - src.components.global_refiner - INFO - Capping refinement input: 29 → 15 triplets
2025-11-30 21:36:51,723 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[PERFORMS]->(Task / ID: 45_1), (Person / ID: 0_0)-[HOLDS]->(Glass_Component / ID: 45_1), (Laboratory_Environment / ID: 45_1)-[CONTAINS]->(Black_Countertop / ID: 45_1), (Person / ID: 0_0)-[WEARS]->(Blue Glove / ID: 33_0), (Person / ID: 0_0)-[CONDUCTS]->(Experiment / ID: 35_2), (Person / ID: 0_0)-[HANDLES]->(Test Tube / ID: 2_0), (Liquid_In_Small_Container / ID: 5_0)-[IS_ON]->(White_Tray / ID: 45_1), (Glass_Component / ID: 45_1)-[IS_CONNECTED_TO]->(Liquid_In_Small_Container / ID: 5_0), (Hand / ID: 10_1)-[WEARS]->(Blue Glove / ID: 33_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue_Nitrile_Glove", "source_chunks": ["70_0"]}, {"head": "Person", "relation": "Holds", "tail": "Beaker", "source_chunks": ["70_0", "70_3", "70_4"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudy_Liquid", "source_chunks": ["70_0", "70_3"]}, {"head": "Beaker", "relation": "Contains", "tail": "Magnetic_Stir_Bar", "source_chunks": ["70_0", "70_2"]}, {"head": "Beaker", "relation": "Is On", "tail": "Magnetic_Stirrer", "source_chunks": ["70_0"]}, {"head": "Tube", "relation": "Is Inserted Into", "tail": "Beaker", "source_chunks": ["70_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Solution", "source_chunks": ["70_1"]}, {"head": "Magnetic Stirrer", "relation": "Interacts With", "tail": "Beaker", "source_chunks": ["70_1"]}, {"head": "White Tube", "relation": "Delivers", "tail": "Substance", "source_chunks": ["70_1"]}, {"head": "Analytical Balance", "relation": "Measures", "tail": "Chemicals", "source_chunks": ["70_1"]}, {"head": "Pipette", "relation": "Lies On", "tail": "Lab Table", "source_chunks": ["70_1"]}, {"head": "Solution", "relation": "Is Stirred By", "tail": "Magnetic Stirrer", "source_chunks": ["70_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["70_2", "70_4"]}, {"head": "Person", "relation": "Holds", "tail": "Glass_Rod", "source_chunks": ["70_2"]}, {"head": "Digital_Balance", "relation": "Displays", "tail": "0.970", "source_chunks": ["70_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:36:51,723 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~383 words, ~498 tokens)
2025-11-30 21:36:51,723 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:38:14,757 - src.components.global_refiner - ERROR - Instruction-based refinement failed after 83.03s: Could not parse response content as the length limit was reached - CompletionUsage(completion_tokens=4000, prompt_tokens=1183, total_tokens=5183, completion_tokens_details=None, prompt_tokens_details=None)
2025-11-30 21:38:14,757 - src.components.global_refiner - INFO - Using fallback deduplication: 15 → 15 triplets
2025-11-30 21:38:14,757 - src.pipeline.kg_builder - INFO - Global refinement: 15 triplets in 83.03s
2025-11-30 21:38:14,757 - src.pipeline.kg_builder - INFO - Using 15 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:38:14,757 - src.pipeline.kg_builder - INFO - Pushing batch 71/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:38:14,758 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 21:38:14,956 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=623, relationships=595
2025-11-30 21:38:14,957 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:38:14,964 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=623, relationships=595
2025-11-30 21:38:14,967 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:38:14,967 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:38:14,967 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:38:14,968 - src.components.neo4j_handler - INFO - Batch injected in 0.21s (triplets: 0.21s, indexes: 0.00s)
2025-11-30 21:38:14,969 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 322, 'with_embedding': 322, 'linked_chunks': 253}
2025-11-30 21:38:14,969 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:38:15,018 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:38:15,093 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 554
2025-11-30 21:38:15,128 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 623, 'relationship_count': 1903, 'density': 0.0049, 'avg_degree': 6.1091, 'avg_unique_neighbors': 6.0257, 'global_efficiency': 0.283, 'avg_path_length': 2.7597, 'avg_degree_centrality': 0.0098, 'max_degree_centrality': 0.5016, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0348, 'degree_assortativity': -0.1606, 'graph_robustness': 0.8697, 'diameter_estimate': 50, 'clustering_coefficient': 0.2557, 'weakly_connected_components': 70, 'largest_wcc_size': 554, 'pagerank_top10_percent': 5.3, 'louvain_communities': 80, 'louvain_modularity': 0.4246, 'label_entropy': 1.4996, 'computational_time': 0.1596115349093452}
2025-11-30 21:38:15,129 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 70, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509895.129005, 'total_time': 90.94503958709538, 'aggregation': 3.5139964893460274e-06, 'network_info': 0.0067051430232822895, 'llm_extraction': 90.56701746594626, 'data_cleaning': 1.8984079360961914e-05, 'neo4j_injection': 0.21015062602236867, 'embedding_time': 0, 'indexing_time': 0.0039318399503827095, 'graph_injection_time': 0.20599262800533324, 'acs_metrics': {'node_count': 623, 'relationship_count': 1903, 'density': 0.0049, 'avg_degree': 6.1091, 'avg_unique_neighbors': 6.0257, 'global_efficiency': 0.283, 'avg_path_length': 2.7597, 'avg_degree_centrality': 0.0098, 'max_degree_centrality': 0.5016, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.0348, 'degree_assortativity': -0.1606, 'graph_robustness': 0.8697, 'diameter_estimate': 50, 'clustering_coefficient': 0.2557, 'weakly_connected_components': 70, 'largest_wcc_size': 554, 'pagerank_top10_percent': 5.3, 'louvain_communities': 80, 'louvain_modularity': 0.4246, 'label_entropy': 1.4996, 'computational_time': 0.1596115349093452}, 'retrieval_queries': []}
2025-11-30 21:38:15,129 - src.pipeline.kg_builder - DEBUG - Batch 70 metrics: {
  "batch_idx": 70,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509895.129005,
  "total_time": 90.94503958709538,
  "aggregation": 3.5139964893460274e-06,
  "network_info": 0.0067051430232822895,
  "llm_extraction": 90.56701746594626,
  "data_cleaning": 1.8984079360961914e-05,
  "neo4j_injection": 0.21015062602236867,
  "embedding_time": 0,
  "indexing_time": 0.0039318399503827095,
  "graph_injection_time": 0.20599262800533324,
  "acs_metrics": {
    "node_count": 623,
    "relationship_count": 1903,
    "density": 0.0049,
    "avg_degree": 6.1091,
    "avg_unique_neighbors": 6.0257,
    "global_efficiency": 0.283,
    "avg_path_length": 2.7597,
    "avg_degree_centrality": 0.0098,
    "max_degree_centrality": 0.5016,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.0348,
    "degree_assortativity": -0.1606,
    "graph_robustness": 0.8697,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2557,
    "weakly_connected_components": 70,
    "largest_wcc_size": 554,
    "pagerank_top10_percent": 5.3,
    "louvain_communities": 80,
    "louvain_modularity": 0.4246,
    "label_entropy": 1.4996,
    "computational_time": 0.1596115349093452
  },
  "retrieval_queries": []
}
2025-11-30 21:38:15,130 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:38:15,130 - src.pipeline.kg_builder - INFO - Batch 71 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 90.57s, Clean: 0.00s, Neo4j: 0.21s, ACS: 0.16s
2025-11-30 21:38:15,130 - src.pipeline.kg_builder - INFO - Batch 71 completed in 90.95s
Processing KG batches:  99%|█████████▊| 71/72 [31:18<00:42, 42.59s/it]2025-11-30 21:38:15,130 - src.pipeline.kg_builder - INFO - Processing batch 72/72 (2 items)
2025-11-30 21:38:15,130 - src.pipeline.kg_builder - DEBUG - Batch 72 current_video_time: 17:47-17:52
2025-11-30 21:38:15,136 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 623
- Total Relationships: 595
- Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9

This information provides context about the current state of the knowledge graph.

2025-11-30 21:38:15,137 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 21:38:15,137 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_71_0 ~228 words, content: Time: 17:42-17:47 Content: The video sequence captures a scientific experiment taking place in a laboratory setting. The scene is set on a black laboratory bench,...
2025-11-30 21:38:15,137 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_71_1 ~229 words, content: of the Process (Frame 4):** The camera angle changes slightly, but the focus remains on the beaker with the cloudy liquid. The person's hand continues...
2025-11-30 21:38:15,137 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_71_2 ~226 words, content: actively mixing a liquid in a glass beaker, which is held in place by a clamp. To the right, a blue stand holds a magnetic...
2025-11-30 21:38:15,137 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_71_3 ~157 words, content: seen extending over the stirrer, and the clamp holding the beaker is visible. The blue stand with the magnetic stir bar is in the foreground....
2025-11-30 21:38:15,158 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 21:38:15,272 - src.components.pre_llm_injector - DEBUG - Found 322 existing chunk embeddings for similarity lookup
2025-11-30 21:38:15,345 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_4', '0.831'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_70_1', '0.829')]
2025-11-30 21:38:15,348 - src.components.pre_llm_injector - DEBUG - Found 9 entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_70_1
2025-11-30 21:38:15,348 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 21:38:15,348 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_4 via source_chunk_ids
2025-11-30 21:38:15,351 - src.components.pre_llm_injector - DEBUG - Limited Lab Table from 7 to 2 external connections
2025-11-30 21:38:15,351 - src.components.pre_llm_injector - DEBUG - Limited Beaker from 19 to 2 external connections
2025-11-30 21:38:15,351 - src.components.pre_llm_injector - DEBUG - Limited Magnetic Stirrer from 9 to 2 external connections
2025-11-30 21:38:15,351 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 50 total -> 21 (internal: 7, external: 14)
2025-11-30 21:38:15,351 - src.components.pre_llm_injector - DEBUG - Subgraph: (Pipette / ID: 67_0)-[LIES_ON]->(Lab Table / ID: 17_2), (Beaker / ID: 66_0)-[CONTAINS]->(Solution / ID: 28_1), (Analytical Balance / ID: 42_0)-[MEASURES]->(Chemicals / ID: 36_1), (White Tube / ID: 70_1)-[DELIVERS]->(Substance / ID: 55_2), (Beaker / ID: 66_0)-[CONTAINS]->(Substance / ID: 55_2), (Solution / ID: 28_1)-[IS_STIRRED_BY]->(Magnetic Stirrer / ID: 62_0), (Magnetic Stirrer / ID: 62_0)-[INTERACTS_WITH]->(Beaker / ID: 66_0), (Lab Table / ID: 17_2)-[CONTAINS]->(Pen / ID: 25_1), (Volumetric Flask / ID: 18_1)-[IS_POSITIONED_ON]->(Lab Table / ID: 17_2), (Beaker / ID: 66_0)-[PLACED_ON]->(Magnetic_Stirrer_Or_Heating_Plate / ID: 66_1), (Beaker / ID: 66_0)-[CONTAINS]->(White Precipitate / ID: 67_0), (Magnetic_Stirrer / ID: 4_2)-[MIXES]->(Solution / ID: 28_1), (Laboratory_Glassware / ID: 4_2)-[CONTAINS]->(Solution / ID: 28_1), (Person / ID: 0_0)-[HANDLES]->(Chemicals / ID: 36_1), (Graduated Cylinder / ID: 41_1)-[RESTS_ON]->(Analytical Balance / ID: 42_0), (Laboratory Equipment / ID: 1_1)-[INCLUDES]->(Magnetic Stirrer / ID: 62_0), (Magnetic Stirrer / ID: 62_0)-[MIXES]->(Liquid / ID: 64_0), (Person / ID: 0_0)-[ADDS]->(Substance / ID: 55_2), (Container / ID: 55_2)-[CONTAINS]->(Substance / ID: 55_2), (Person / ID: 0_0)-[USES]->(Pipette / ID: 67_0), (Pipette / ID: 67_0)-[ADDS]->(Clear Liquid / ID: 67_0)
2025-11-30 21:38:15,351 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_26_0', '0.752'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_61_1', '0.747')]
2025-11-30 21:38:15,351 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_70_1', '0.829'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_5_1', '0.773')]
2025-11-30 21:38:15,352 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_55_2', '0.773'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_64_1', '0.759')]
2025-11-30 21:38:15,352 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_30_4', '0.831'), ('4fd0a841-a1f1-4bee-9359-4a5982bc3df9_64_3', '0.816')]
2025-11-30 21:38:15,352 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 21:38:15,352 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_71_0) (~228 words) with timeout=5.0s retries=3
2025-11-30 21:38:16,591 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 21:38:16,591 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 21:38:16,591 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_71_1) (~229 words) with timeout=5.0s retries=3
2025-11-30 21:38:17,708 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 21:38:17,709 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 21:38:17,709 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_71_2) (~226 words) with timeout=5.0s retries=3
2025-11-30 21:38:18,899 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 21:38:18,899 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 21:38:18,900 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=4fd0a841-a1f1-4bee-9359-4a5982bc3df9_71_3) (~157 words) with timeout=5.0s retries=3
2025-11-30 21:38:20,051 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 21:38:20,051 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 21:38:20,051 - src.components.pre_llm_injector - INFO - Extracted 22 local triplets from 4 chunks
2025-11-30 21:38:20,051 - src.pipeline.kg_builder - INFO - Pre-extraction: 22 triplets in 4.92s
2025-11-30 21:38:20,055 - src.components.global_refiner - INFO - Capping refinement input: 22 → 15 triplets
2025-11-30 21:38:20,055 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Pipette / ID: 67_0)-[LIES_ON]->(Lab Table / ID: 17_2), (Beaker / ID: 66_0)-[CONTAINS]->(Solution / ID: 28_1), (Analytical Balance / ID: 42_0)-[MEASURES]->(Chemicals / ID: 36_1), (White Tube / ID: 70_1)-[DELIVERS]->(Substance / ID: 55_2), (Beaker / ID: 66_0)-[CONTAINS]->(Substance / ID: 55_2), (Solution / ID: 28_1)-[IS_STIRRED_BY]->(Magnetic Stirrer / ID: 62_0), (Magnetic Stirrer / ID: 62_0)-[INTERACTS_WITH]->(Beaker / ID: 66_0), (Lab Table / ID: 17_2)-[CONTAINS]->(Pen / ID: 25_1), (Volumetric Flask / ID: 18_1)-[IS_POSITIONED_ON]->(Lab Table / ID: 17_2), (Beaker / ID: 66_0)-[PLACED_ON]->(Magnetic_Stirrer_Or_Heating_Plate / ID: 66_1), (Beaker / ID: 66_0)-[CONTAINS]->(White Precipitate / ID: 67_0), (Magnetic_Stirrer / ID: 4_2)-[MIXES]->(Solution / ID: 28_1), (Laboratory_Glassware / ID: 4_2)-[CONTAINS]->(Solution / ID: 28_1), (Person / ID: 0_0)-[HANDLES]->(Chemicals / ID: 36_1), (Graduated Cylinder / ID: 41_1)-[RESTS_ON]->(Analytical Balance / ID: 42_0), (Laboratory Equipment / ID: 1_1)-[INCLUDES]->(Magnetic Stirrer / ID: 62_0), (Magnetic Stirrer / ID: 62_0)-[MIXES]->(Liquid / ID: 64_0), (Person / ID: 0_0)-[ADDS]->(Substance / ID: 55_2), (Container / ID: 55_2)-[CONTAINS]->(Substance / ID: 55_2), (Person / ID: 0_0)-[USES]->(Pipette / ID: 67_0), (Pipette / ID: 67_0)-[ADDS]->(Clear Liquid / ID: 67_0)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Beaker", "relation": "Is On", "tail": "Magnetic Stirrer", "source_chunks": ["71_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Cloudy Liquid", "source_chunks": ["71_0", "71_1"]}, {"head": "Person", "relation": "Holds", "tail": "Flexible Tube", "source_chunks": ["71_0"]}, {"head": "Flexible Tube", "relation": "Is Inserted Into", "tail": "Beaker", "source_chunks": ["71_0"]}, {"head": "Beaker", "relation": "Contains", "tail": "Glass Tube", "source_chunks": ["71_0"]}, {"head": "Blue Stand", "relation": "Holds", "tail": "Metal Rod", "source_chunks": ["71_0"]}, {"head": "Person", "relation": "Holds", "tail": "Tube", "source_chunks": ["71_1"]}, {"head": "Magnetic Stirrer", "relation": "Operates", "tail": "Beaker", "source_chunks": ["71_1"]}, {"head": "Beaker", "relation": "Contains", "tail": "Liquid", "source_chunks": ["71_1", "71_2"]}, {"head": "Tube", "relation": "Contains", "tail": "Substance", "source_chunks": ["71_1"]}, {"head": "Lab Environment", "relation": "Contains", "tail": "High-Voltage Warning Sign", "source_chunks": ["71_1"]}, {"head": "Person", "relation": "Holds", "tail": "Glass Beaker", "source_chunks": ["71_2"]}, {"head": "Magnetic Stirrer", "relation": "Holds", "tail": "Beaker", "source_chunks": ["71_2"]}, {"head": "Beaker", "relation": "Is Held By", "tail": "Clamp", "source_chunks": ["71_2"]}, {"head": "Long Tube", "relation": "Extends To", "tail": "Beaker", "source_chunks": ["71_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 21:38:20,055 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~484 words, ~629 tokens)
2025-11-30 21:38:20,055 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 21:39:42,704 - src.components.global_refiner - ERROR - Instruction-based refinement failed after 82.65s: Could not parse response content as the length limit was reached - CompletionUsage(completion_tokens=4000, prompt_tokens=1517, total_tokens=5517, completion_tokens_details=None, prompt_tokens_details=None)
2025-11-30 21:39:42,704 - src.components.global_refiner - INFO - Using fallback deduplication: 15 → 15 triplets
2025-11-30 21:39:42,704 - src.pipeline.kg_builder - INFO - Global refinement: 15 triplets in 82.65s
2025-11-30 21:39:42,704 - src.pipeline.kg_builder - INFO - Using 15 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 21:39:42,704 - src.pipeline.kg_builder - INFO - Pushing batch 72/72 to graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:39:42,704 - src.components.neo4j_handler - INFO - Adding 15 triplets + 2 chunks to graph (hybrid mode)
2025-11-30 21:39:42,838 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=630, relationships=606
2025-11-30 21:39:42,839 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 21:39:42,843 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=630, relationships=606
2025-11-30 21:39:42,844 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 21:39:42,844 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 21:39:42,845 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 21:39:42,845 - src.components.neo4j_handler - INFO - Batch injected in 0.14s (triplets: 0.14s, indexes: 0.00s)
2025-11-30 21:39:42,846 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 326, 'with_embedding': 326, 'linked_chunks': 256}
2025-11-30 21:39:42,846 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 21:39:42,921 - src.pipeline.acs_automata - DEBUG - Computed approximate global_efficiency with 100 samples
2025-11-30 21:39:43,000 - src.pipeline.acs_automata - DEBUG - Computed approximate avg_path_length with 100 samples on component size 560
2025-11-30 21:39:43,036 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 630, 'relationship_count': 1936, 'density': 0.0049, 'avg_degree': 6.146, 'avg_unique_neighbors': 6.0603, 'global_efficiency': 0.2827, 'avg_path_length': 2.7447, 'avg_degree_centrality': 0.0098, 'max_degree_centrality': 0.5024, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0329, 'degree_assortativity': -0.1617, 'graph_robustness': 0.8657, 'diameter_estimate': 50, 'clustering_coefficient': 0.2551, 'weakly_connected_components': 71, 'largest_wcc_size': 560, 'pagerank_top10_percent': 5.23, 'louvain_communities': 83, 'louvain_modularity': 0.4254, 'label_entropy': 1.4996, 'computational_time': 0.1901809109840542}
2025-11-30 21:39:43,036 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 71, 'run_uuid': '4fd0a841-a1f1-4bee-9359-4a5982bc3df9', 'timestamp': 1764509983.0369163, 'total_time': 87.90641557693016, 'aggregation': 2.435990609228611e-06, 'network_info': 0.006331343902274966, 'llm_extraction': 87.56736876897048, 'data_cleaning': 1.6362988390028477e-05, 'neo4j_injection': 0.14088396402075887, 'embedding_time': 0, 'indexing_time': 0.0012436360120773315, 'graph_injection_time': 0.13940709899179637, 'acs_metrics': {'node_count': 630, 'relationship_count': 1936, 'density': 0.0049, 'avg_degree': 6.146, 'avg_unique_neighbors': 6.0603, 'global_efficiency': 0.2827, 'avg_path_length': 2.7447, 'avg_degree_centrality': 0.0098, 'max_degree_centrality': 0.5024, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0329, 'degree_assortativity': -0.1617, 'graph_robustness': 0.8657, 'diameter_estimate': 50, 'clustering_coefficient': 0.2551, 'weakly_connected_components': 71, 'largest_wcc_size': 560, 'pagerank_top10_percent': 5.23, 'louvain_communities': 83, 'louvain_modularity': 0.4254, 'label_entropy': 1.4996, 'computational_time': 0.1901809109840542}, 'retrieval_queries': []}
2025-11-30 21:39:43,037 - src.pipeline.kg_builder - DEBUG - Batch 71 metrics: {
  "batch_idx": 71,
  "run_uuid": "4fd0a841-a1f1-4bee-9359-4a5982bc3df9",
  "timestamp": 1764509983.0369163,
  "total_time": 87.90641557693016,
  "aggregation": 2.435990609228611e-06,
  "network_info": 0.006331343902274966,
  "llm_extraction": 87.56736876897048,
  "data_cleaning": 1.6362988390028477e-05,
  "neo4j_injection": 0.14088396402075887,
  "embedding_time": 0,
  "indexing_time": 0.0012436360120773315,
  "graph_injection_time": 0.13940709899179637,
  "acs_metrics": {
    "node_count": 630,
    "relationship_count": 1936,
    "density": 0.0049,
    "avg_degree": 6.146,
    "avg_unique_neighbors": 6.0603,
    "global_efficiency": 0.2827,
    "avg_path_length": 2.7447,
    "avg_degree_centrality": 0.0098,
    "max_degree_centrality": 0.5024,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0329,
    "degree_assortativity": -0.1617,
    "graph_robustness": 0.8657,
    "diameter_estimate": 50,
    "clustering_coefficient": 0.2551,
    "weakly_connected_components": 71,
    "largest_wcc_size": 560,
    "pagerank_top10_percent": 5.23,
    "louvain_communities": 83,
    "louvain_modularity": 0.4254,
    "label_entropy": 1.4996,
    "computational_time": 0.1901809109840542
  },
  "retrieval_queries": []
}
2025-11-30 21:39:43,038 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/4fd0a841-a1f1-4bee-9359-4a5982bc3df9_batch_metrics_kg.json
2025-11-30 21:39:43,038 - src.pipeline.kg_builder - INFO - Batch 72 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 87.57s, Clean: 0.00s, Neo4j: 0.14s, ACS: 0.19s
2025-11-30 21:39:43,038 - src.pipeline.kg_builder - INFO - Batch 72 completed in 87.91s
Processing KG batches: 100%|██████████| 72/72 [32:45<00:00, 56.18s/it]2025-11-30 21:39:43,040 - src.core.metrics - INFO - Metrics saved to: metrics/kg_4fd0a841-a1f1-4bee-9359-4a5982bc3df9.json
2025-11-30 21:39:43,040 - src.pipeline.kg_builder - INFO - Knowledge graph construction completed successfully!
2025-11-30 21:39:43,040 - src.pipeline.kg_builder - INFO - Graph UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
2025-11-30 21:39:43,040 - src.pipeline.kg_builder - INFO - Total batches processed: 72
2025-11-30 21:39:43,040 - src.pipeline.kg_builder - INFO - Hierarchical extraction enabled: chunk_size=296, parallel=2
Processing KG batches: 100%|██████████| 72/72 [32:45<00:00, 27.31s/it]
2025-11-30 21:39:43,040 - __main__ - INFO - Knowledge graph construction completed with UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
Knowledge graph construction completed with UUID: 4fd0a841-a1f1-4bee-9359-4a5982bc3df9
