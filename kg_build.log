nohup: ignoring input
2025-11-30 20:44:29,761 - __main__ - INFO - Loading configuration from: config/base_config.yaml
2025-11-30 20:44:29,763 - __main__ - INFO - Building knowledge graph from: /home/viture-ai/Documents/Real-Time-Brain-Inspired-Video-Memory/data/outputs/vlm_output.json
2025-11-30 20:44:29,853 - src.components.neo4j_handler - INFO - Initialized Neo4j handler for run UUID: c8c45bc2-8c60-42ab-8f57-fd160d91db75
2025-11-30 20:44:29,874 - src.components.llm_injector - INFO - Initialized LLMInjector (chunking: True)
2025-11-30 20:44:29,983 - src.components.pre_llm_injector - INFO - Initialized PreLLMInjector: chunk_size=296, overlap=16, parallel=2, max_triplets_per_chunk=6, subgraph_extraction=True
2025-11-30 20:44:29,984 - src.components.global_refiner - INFO - Initialized GlobalRefiner with max_tokens=4000
2025-11-30 20:44:29,984 - src.pipeline.kg_builder - INFO - Initialized KG Builder with run UUID: c8c45bc2-8c60-42ab-8f57-fd160d91db75 (hierarchical extraction: True)
2025-11-30 20:44:29,984 - src.pipeline.kg_builder - INFO - Starting knowledge graph construction from: /home/viture-ai/Documents/Real-Time-Brain-Inspired-Video-Memory/data/outputs/vlm_output.json
2025-11-30 20:44:29,985 - src.pipeline.kg_builder - INFO - Reset logs directory: /home/viture-ai/Documents/Real-Time-Brain-Inspired-Video-Memory/logs
Processing KG batches:   0%|          | 0/72 [00:00<?, ?it/s]2025-11-30 20:44:29,987 - src.pipeline.kg_builder - INFO - Processing batch 1/72 (3 items)
2025-11-30 20:44:29,987 - src.pipeline.kg_builder - DEBUG - Batch 1 current_video_time: 00:09-00:14
2025-11-30 20:44:30,039 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 0
- Total Relationships: 0
- Graph UUID: c8c45bc2-8c60-42ab-8f57-fd160d91db75

This information provides context about the current state of the knowledge graph.

2025-11-30 20:44:30,040 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 20:44:30,040 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_0 ~221 words, content: Time: 00:00-00:04 Content: The video sequence captures a scene within a laboratory environment, focusing on a person and their interaction with the surroundings. - **Initial...
2025-11-30 20:44:30,040 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_1 ~237 words, content: , looking directly at it. They are still holding the smartphone. The laboratory setting remains consistent, with the glass cabinet, the door, and the equipment...
2025-11-30 20:44:30,040 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_2 ~196 words, content: up as if to show it. - In the final frame, the man is still holding the paper and looking at the camera. The man...
2025-11-30 20:44:30,040 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_3 ~181 words, content: This indicates the document is a report for a chemistry experiment, possibly using augmented reality technology. The person holding the paper is wearing a blue...
2025-11-30 20:44:30,061 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 20:44:30,169 - src.components.pre_llm_injector - DEBUG - Found 0 existing chunk embeddings for similarity lookup
2025-11-30 20:44:30,169 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : []
2025-11-30 20:44:30,170 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: none (no existing chunks to compare)
2025-11-30 20:44:30,170 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: none (no existing chunks to compare)
2025-11-30 20:44:30,170 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: none (no existing chunks to compare)
2025-11-30 20:44:30,170 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: none (no existing chunks to compare)
2025-11-30 20:44:30,170 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 20:44:30,170 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_0) (~221 words) with timeout=5.0s retries=3
2025-11-30 20:44:31,274 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 20:44:31,274 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 20:44:31,274 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_1) (~237 words) with timeout=5.0s retries=3
2025-11-30 20:44:34,167 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 20:44:34,167 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 20:44:34,167 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_2) (~196 words) with timeout=5.0s retries=3
2025-11-30 20:44:39,174 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 20:44:40,904 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 2)
2025-11-30 20:44:40,904 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 20:44:40,905 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_3) (~181 words) with timeout=5.0s retries=3
2025-11-30 20:44:41,964 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 20:44:41,965 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 20:44:41,965 - src.components.pre_llm_injector - INFO - Extracted 19 local triplets from 4 chunks
2025-11-30 20:44:41,965 - src.pipeline.kg_builder - INFO - Pre-extraction: 19 triplets in 11.93s
2025-11-30 20:44:41,965 - src.components.global_refiner - INFO - Capping refinement input: 19 → 15 triplets
2025-11-30 20:44:41,966 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.

RULE: If CONTEXT SUBGRAPHS is empty or says "No subgraph context available", set "inter_chunk_relations", "merge_instructions", and "prune_instructions" to []. ONLY add to "new_triplets" from NEW CANDIDATES. DO NOT invent IDs, entities, or relations—stick to provided data. For merges/links, match EXACT entity names/IDs from CONTEXT only.

### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
No subgraph context available
No existing entities or relations.

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Cream-Colored Sweater", "source_chunks": ["0_0", "0_2"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Jeans", "source_chunks": ["0_0", "0_1", "0_2"]}, {"head": "Person", "relation": "Holds", "tail": "Smartphone", "source_chunks": ["0_0", "0_1"]}, {"head": "Person", "relation": "Stands Near", "tail": "Laboratory Table", "source_chunks": ["0_0"]}, {"head": "Laboratory Table", "relation": "Contains", "tail": "Precision Balance", "source_chunks": ["0_0"]}, {"head": "Precision Balance", "relation": "Contains", "tail": "Weighing Pan", "source_chunks": ["0_0"]}, {"head": "Person", "relation": "Wears", "tail": "Beige Sweater", "source_chunks": ["0_1"]}, {"head": "Person", "relation": "Stands In", "tail": "Laboratory", "source_chunks": ["0_1"]}, {"head": "Person", "relation": "Interacts With", "tail": "Equipment", "source_chunks": ["0_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Glass Cabinet", "source_chunks": ["0_1"]}, {"head": "Person", "relation": "Holds", "tail": "Document", "source_chunks": ["0_2"]}, {"head": "Person", "relation": "Stands", "tail": "Left Side Of Frame", "source_chunks": ["0_2"]}, {"head": "Document", "relation": "Has Title", "tail": "Ar Glasses Training Chemistry Experiment Report (Simplified Version)", "source_chunks": ["0_2"]}, {"head": "Document", "relation": "Is About", "tail": "Chemistry Experiment", "source_chunks": ["0_2", "0_3"]}, {"head": "Document", "relation": "Is On", "tail": "Lab Table", "source_chunks": ["0_3"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 20:44:41,966 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~384 words, ~499 tokens)
2025-11-30 20:44:41,966 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 20:44:48,896 - src.components.global_refiner - DEBUG - LLM call completed in 6.93s
2025-11-30 20:44:48,896 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Cream-Colored Sweater', ['0_0', '0_2']], ['Person', 'Wears', 'Blue Jeans', ['0_0', '0_1', '0_2']], ['Person', 'Holds', 'Smartphone', ['0_0', '0_1']], ['Person', 'Stands Near', 'Laboratory Table', ['0_0']], ['Laboratory Table', 'Contains', 'Precision Balance', ['0_0']], ['Precision Balance', 'Contains', 'Weighing Pan', ['0_0']], ['Person', 'Wears', 'Beige Sweater', ['0_1']], ['Person', 'Stands In', 'Laboratory', ['0_1']], ['Person', 'Interacts With', 'Equipment', ['0_1']], ['Laboratory', 'Contains', 'Glass Cabinet', ['0_1']], ['Person', 'Holds', 'Document', ['0_2']], ['Person', 'Stands', 'Left Side Of Frame', ['0_2']], ['Document', 'Has Title', 'Ar Glasses Training Chemistry Experiment Report (Simplified Version)', ['0_2']], ['Document', 'Is About', 'Chemistry Experiment', ['0_2', '0_3']], ['Document', 'Is On', 'Lab Table', ['0_3']]] inter_chunk_relations=[] merge_instructions=[] prune_instructions=[]
2025-11-30 20:44:48,896 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Cream-Colored Sweater', ['0_0', '0_2']], ['Person', 'Wears', 'Blue Jeans', ['0_0', '0_1', '0_2']], ['Person', 'Holds', 'Smartphone', ['0_0', '0_1']]]
2025-11-30 20:44:48,896 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=0, sample=[]
2025-11-30 20:44:48,896 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=0, sample=[]
2025-11-30 20:44:48,896 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=0, sample=[]
2025-11-30 20:44:48,896 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 15 triplets (total: 6.93s, LLM: 6.93s)
2025-11-30 20:44:48,896 - src.pipeline.kg_builder - INFO - Global refinement: 15 triplets in 6.93s
2025-11-30 20:44:48,896 - src.pipeline.kg_builder - INFO - Using 15 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 20:44:48,896 - src.pipeline.kg_builder - INFO - Pushing batch 1/72 to graph UUID: c8c45bc2-8c60-42ab-8f57-fd160d91db75
2025-11-30 20:44:48,896 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 20:44:49,123 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=20, relationships=15
2025-11-30 20:44:49,124 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 20:44:49,131 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=20, relationships=15
2025-11-30 20:44:49,133 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 20:44:49,133 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 20:44:49,133 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 20:44:49,133 - src.components.neo4j_handler - INFO - Batch injected in 0.24s (triplets: 0.24s, indexes: 0.00s)
2025-11-30 20:44:49,134 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 4, 'with_embedding': 4, 'linked_chunks': 4}
2025-11-30 20:44:49,134 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 20:44:49,138 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 20 nodes
2025-11-30 20:44:49,138 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 20 nodes
2025-11-30 20:44:49,143 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 20, 'relationship_count': 39, 'density': 0.1026, 'avg_degree': 3.9, 'avg_unique_neighbors': 3.9, 'global_efficiency': 0.5368, 'avg_path_length': 2.2263, 'avg_degree_centrality': 0.2053, 'max_degree_centrality': 0.6316, 'avg_betweenness_centrality': 0.0013, 'max_betweenness_centrality': 0.0117, 'degree_assortativity': -0.5069, 'graph_robustness': 0.641, 'diameter_estimate': 4, 'clustering_coefficient': 0.3389, 'weakly_connected_components': 1, 'largest_wcc_size': 20, 'pagerank_top10_percent': 70.37, 'louvain_communities': 3, 'louvain_modularity': 0.3764, 'label_entropy': 1.361, 'computational_time': 0.00864244601689279}
2025-11-30 20:44:49,143 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 0, 'run_uuid': 'c8c45bc2-8c60-42ab-8f57-fd160d91db75', 'timestamp': 1764506689.1437223, 'total_time': 19.15655227995012, 'aggregation': 2.891058102250099e-06, 'network_info': 0.05249882396310568, 'llm_extraction': 18.856535722035915, 'data_cleaning': 1.6300007700920105e-05, 'neo4j_injection': 0.23757320002187043, 'embedding_time': 0, 'indexing_time': 0.002280644024722278, 'graph_injection_time': 0.2351528740255162, 'acs_metrics': {'node_count': 20, 'relationship_count': 39, 'density': 0.1026, 'avg_degree': 3.9, 'avg_unique_neighbors': 3.9, 'global_efficiency': 0.5368, 'avg_path_length': 2.2263, 'avg_degree_centrality': 0.2053, 'max_degree_centrality': 0.6316, 'avg_betweenness_centrality': 0.0013, 'max_betweenness_centrality': 0.0117, 'degree_assortativity': -0.5069, 'graph_robustness': 0.641, 'diameter_estimate': 4, 'clustering_coefficient': 0.3389, 'weakly_connected_components': 1, 'largest_wcc_size': 20, 'pagerank_top10_percent': 70.37, 'louvain_communities': 3, 'louvain_modularity': 0.3764, 'label_entropy': 1.361, 'computational_time': 0.00864244601689279}, 'retrieval_queries': []}
2025-11-30 20:44:49,143 - src.pipeline.kg_builder - DEBUG - Batch 0 metrics: {
  "batch_idx": 0,
  "run_uuid": "c8c45bc2-8c60-42ab-8f57-fd160d91db75",
  "timestamp": 1764506689.1437223,
  "total_time": 19.15655227995012,
  "aggregation": 2.891058102250099e-06,
  "network_info": 0.05249882396310568,
  "llm_extraction": 18.856535722035915,
  "data_cleaning": 1.6300007700920105e-05,
  "neo4j_injection": 0.23757320002187043,
  "embedding_time": 0,
  "indexing_time": 0.002280644024722278,
  "graph_injection_time": 0.2351528740255162,
  "acs_metrics": {
    "node_count": 20,
    "relationship_count": 39,
    "density": 0.1026,
    "avg_degree": 3.9,
    "avg_unique_neighbors": 3.9,
    "global_efficiency": 0.5368,
    "avg_path_length": 2.2263,
    "avg_degree_centrality": 0.2053,
    "max_degree_centrality": 0.6316,
    "avg_betweenness_centrality": 0.0013,
    "max_betweenness_centrality": 0.0117,
    "degree_assortativity": -0.5069,
    "graph_robustness": 0.641,
    "diameter_estimate": 4,
    "clustering_coefficient": 0.3389,
    "weakly_connected_components": 1,
    "largest_wcc_size": 20,
    "pagerank_top10_percent": 70.37,
    "louvain_communities": 3,
    "louvain_modularity": 0.3764,
    "label_entropy": 1.361,
    "computational_time": 0.00864244601689279
  },
  "retrieval_queries": []
}
2025-11-30 20:44:49,144 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c8c45bc2-8c60-42ab-8f57-fd160d91db75_batch_metrics_kg.json
2025-11-30 20:44:49,144 - src.pipeline.kg_builder - INFO - Batch 1 timings - Agg: 0.00s, NetInfo: 0.05s, LLM: 18.86s, Clean: 0.00s, Neo4j: 0.24s, ACS: 0.01s
2025-11-30 20:44:49,144 - src.pipeline.kg_builder - INFO - Batch 1 completed in 19.16s
Processing KG batches:   1%|▏         | 1/72 [00:19<22:40, 19.16s/it]2025-11-30 20:44:49,144 - src.pipeline.kg_builder - INFO - Processing batch 2/72 (3 items)
2025-11-30 20:44:49,144 - src.pipeline.kg_builder - DEBUG - Batch 2 current_video_time: 00:24-00:29
2025-11-30 20:44:49,150 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 20
- Total Relationships: 15
- Graph UUID: c8c45bc2-8c60-42ab-8f57-fd160d91db75

This information provides context about the current state of the knowledge graph.

2025-11-30 20:44:49,151 - src.components.pre_llm_injector - DEBUG - Split content into 5 chunks (chunk_size=296, overlap=16)
2025-11-30 20:44:49,151 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_0 ~221 words, content: Time: 00:14-00:19 Content: The video sequence captures a scene within a laboratory or research facility, focusing on a person and their surroundings. The camera's movement...
2025-11-30 20:44:49,151 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_1 ~200 words, content: , possibly a balance or a sample holder. The background shows more of the lab's white cabinetry and a stack of cardboard boxes. The overall...
2025-11-30 20:44:49,151 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_2 ~195 words, content: and components, including a syringe, a small container, and a pen. To the left, a tall, white, glass-fronted cabinet is open, revealing shelves stocked with...
2025-11-30 20:44:49,151 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_3 ~215 words, content: 学实验报告 (简版)" (AR Glasses Training Chemistry Experiment Report (Brief Version)). This document appears to be a guide for the experiment, which involves the synthesis of...
2025-11-30 20:44:49,151 - src.components.pre_llm_injector - DEBUG - Chunk[4] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_4 ~91 words, content: data. The use of AR glasses suggests that the experiment is being conducted as part of a training program, where the user can see instructions...
2025-11-30 20:44:49,178 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 20:44:49,206 - src.components.pre_llm_injector - DEBUG - Found 4 existing chunk embeddings for similarity lookup
2025-11-30 20:44:49,208 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_3', '0.639'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_1', '0.625')]
2025-11-30 20:44:49,209 - src.components.pre_llm_injector - DEBUG - Found 3 entities linked to chunk_id=c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_3
2025-11-30 20:44:49,209 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 20:44:49,210 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 4 total -> 4 (internal: 2, external: 2)
2025-11-30 20:44:49,210 - src.components.pre_llm_injector - DEBUG - Subgraph: (Document / ID: 0_2)-[IS_ABOUT]->(Chemistry Experiment / ID: 0_2), (Document / ID: 0_2)-[IS_ON]->(Lab Table / ID: 0_3), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Document / ID: 0_2)-[HAS_TITLE]->(Ar Glasses Training Chemistry Experiment Report (Simplified Version) / ID: 0_2)
2025-11-30 20:44:49,253 - src.components.pre_llm_injector - DEBUG - Found 7 entities linked to chunk_id=c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_1
2025-11-30 20:44:49,253 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 20:44:49,254 - src.components.pre_llm_injector - DEBUG - Limited Person from 4 to 2 external connections
2025-11-30 20:44:49,254 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 10 total -> 8 (internal: 6, external: 2)
2025-11-30 20:44:49,254 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[WEARS]->(Blue Jeans / ID: 0_0), (Person / ID: 0_0)-[HOLDS]->(Smartphone / ID: 0_0), (Person / ID: 0_0)-[WEARS]->(Beige Sweater / ID: 0_1), (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Glass Cabinet / ID: 0_1), (Person / ID: 0_0)-[WEARS]->(Cream-Colored Sweater / ID: 0_0), (Person / ID: 0_0)-[STANDS]->(Left Side Of Frame / ID: 0_2)
2025-11-30 20:44:49,254 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_0', '0.516'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_1', '0.500')]
2025-11-30 20:44:49,254 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_1', '0.623'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_3', '0.617')]
2025-11-30 20:44:49,254 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_2', '0.439'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_1', '0.409')]
2025-11-30 20:44:49,254 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_3', '0.607'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_1', '0.551')]
2025-11-30 20:44:49,254 - src.components.pre_llm_injector - DEBUG - Chunk 4 top similar chunks: [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_3', '0.639'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_1', '0.625')]
2025-11-30 20:44:49,254 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 20:44:49,254 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_0) (~221 words) with timeout=5.0s retries=3
2025-11-30 20:44:50,480 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 20:44:50,481 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 20:44:50,481 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_1) (~200 words) with timeout=5.0s retries=3
2025-11-30 20:44:51,630 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 20:44:51,630 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 20:44:51,630 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_2) (~195 words) with timeout=5.0s retries=3
2025-11-30 20:44:56,637 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 1/4), retrying...
2025-11-30 20:45:02,143 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 2/4), retrying...
2025-11-30 20:45:08,149 - src.components.pre_llm_injector - WARNING - Chunk 2 timed out after 5.0s (attempt 3/4), retrying...
2025-11-30 20:45:14,657 - src.components.pre_llm_injector - WARNING - ⚠️ Chunk 2 TIMED OUT after 5.0s on final attempt. Skipping.
2025-11-30 20:45:14,657 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 0 triplets
2025-11-30 20:45:14,657 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_3) (~215 words) with timeout=5.0s retries=3
2025-11-30 20:45:15,977 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 20:45:15,978 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 20:45:15,978 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 4 (ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_4) (~91 words) with timeout=5.0s retries=3
2025-11-30 20:45:17,134 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 4 (attempt 1)
2025-11-30 20:45:17,134 - src.components.pre_llm_injector - DEBUG - Chunk 4 returned 6 triplets
2025-11-30 20:45:17,134 - src.components.pre_llm_injector - INFO - Extracted 24 local triplets from 5 chunks
2025-11-30 20:45:17,134 - src.pipeline.kg_builder - INFO - Pre-extraction: 24 triplets in 27.98s
2025-11-30 20:45:17,134 - src.components.global_refiner - INFO - Capping refinement input: 24 → 15 triplets
2025-11-30 20:45:17,135 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Document / ID: 0_2)-[IS_ABOUT]->(Chemistry Experiment / ID: 0_2), (Document / ID: 0_2)-[IS_ON]->(Lab Table / ID: 0_3), (Person / ID: 0_0)-[HOLDS]->(Document / ID: 0_2), (Document / ID: 0_2)-[HAS_TITLE]->(Ar Glasses Training Chemistry Experiment Report (Simplified Version) / ID: 0_2)
Subgraph_2: Subgraph: (Person / ID: 0_0)-[WEARS]->(Blue Jeans / ID: 0_0), (Person / ID: 0_0)-[HOLDS]->(Smartphone / ID: 0_0), (Person / ID: 0_0)-[WEARS]->(Beige Sweater / ID: 0_1), (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Person / ID: 0_0)-[INTERACTS_WITH]->(Equipment / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Glass Cabinet / ID: 0_1), (Person / ID: 0_0)-[WEARS]->(Cream-Colored Sweater / ID: 0_0), (Person / ID: 0_0)-[STANDS]->(Left Side Of Frame / ID: 0_2)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Turtleneck_Sweater", "source_chunks": ["1_0"]}, {"head": "Person", "relation": "Wears", "tail": "Jeans", "source_chunks": ["1_0"]}, {"head": "Person", "relation": "Stands", "tail": "In_Laboratory", "source_chunks": ["1_0"]}, {"head": "Camera", "relation": "Pans", "tail": "To_The_Right", "source_chunks": ["1_0"]}, {"head": "Camera", "relation": "Reveals", "tail": "Laboratory_Counter", "source_chunks": ["1_0"]}, {"head": "Laboratory_Counter", "relation": "Contains", "tail": "White_Bottle_With_Red_Cap", "source_chunks": ["1_0"]}, {"head": "Person", "relation": "Stands In", "tail": "Laboratory", "source_chunks": ["1_1"]}, {"head": "Laboratory", "relation": "Contains", "tail": "Workbench", "source_chunks": ["1_1"]}, {"head": "Workbench", "relation": "Holds", "tail": "Bottle", "source_chunks": ["1_1"]}, {"head": "Workbench", "relation": "Holds", "tail": "Paper", "source_chunks": ["1_1"]}, {"head": "Workbench", "relation": "Holds", "tail": "Apparatus", "source_chunks": ["1_1"]}, {"head": "Apparatus", "relation": "Is Type Of", "tail": "Reaction_Chamber", "source_chunks": ["1_1"]}, {"head": "Person", "relation": "Uses", "tail": "Ar_Glasses", "source_chunks": ["1_3"]}, {"head": "Person", "relation": "Writes On", "tail": "Experiment_Report", "source_chunks": ["1_3"]}, {"head": "Experiment_Report", "relation": "Contains", "tail": "Data", "source_chunks": ["1_3"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 20:45:17,135 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~406 words, ~528 tokens)
2025-11-30 20:45:17,135 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 20:45:34,240 - src.components.global_refiner - DEBUG - LLM call completed in 17.11s
2025-11-30 20:45:34,240 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Turtleneck_Sweater', ['1_0']], ['Person', 'Wears', 'Jeans', ['1_0']], ['Person', 'Stands', 'In_Laboratory', ['1_0']], ['Camera', 'Pans', 'To_The_Right', ['1_0']], ['Camera', 'Reveals', 'Laboratory_Counter', ['1_0']], ['Laboratory_Counter', 'Contains', 'White_Bottle_With_Red_Cap', ['1_0']], ['Person', 'Stands In', 'Laboratory', ['1_1']], ['Laboratory', 'Contains', 'Workbench', ['1_1']], ['Workbench', 'Holds', 'Bottle', ['1_1']], ['Workbench', 'Holds', 'Paper', ['1_1']], ['Workbench', 'Holds', 'Apparatus', ['1_1']], ['Apparatus', 'Is Type Of', 'Reaction_Chamber', ['1_1']], ['Person', 'Uses', 'Ar_Glasses', ['1_3']], ['Person', 'Writes On', 'Experiment_Report', ['1_3']], ['Experiment_Report', 'Contains', 'Data', ['1_3']]] inter_chunk_relations=[['Person', 'Stands In', 'Laboratory', ['1_1']], ['Laboratory', 'Contains', 'Workbench', ['1_1']], ['Workbench', 'Holds', 'Bottle', ['1_1']], ['Workbench', 'Holds', 'Paper', ['1_1']], ['Workbench', 'Holds', 'Apparatus', ['1_1']], ['Apparatus', 'Is Type Of', 'Reaction_Chamber', ['1_1']], ['Person', 'Uses', 'Ar_Glasses', ['1_3']], ['Person', 'Writes On', 'Experiment_Report', ['1_3']], ['Experiment_Report', 'Contains', 'Data', ['1_3']]] merge_instructions=[{'local': 'Turtleneck_Sweater', 'existing': 'Beige Sweater', 'existing_id': '0_1'}, {'local': 'Turtleneck_Sweater', 'existing': 'Cream-Colored Sweater', 'existing_id': '0_0'}, {'local': 'Jeans', 'existing': 'Blue Jeans', 'existing_id': '0_0'}] prune_instructions=[{'head': 'Person', 'relation': 'WEARS', 'tail': 'Cream-Colored Sweater'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Beige Sweater'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Jeans'}, {'head': 'Person', 'relation': 'STANDS', 'tail': 'Left Side Of Frame'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Smartphone'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Document'}, {'head': 'Document', 'relation': 'HAS_TITLE', 'tail': 'Ar Glasses Training Chemistry Experiment Report (Simplified Version)'}, {'head': 'Document', 'relation': 'IS_ABOUT', 'tail': 'Chemistry Experiment'}, {'head': 'Document', 'relation': 'IS_ON', 'tail': 'Lab Table'}, {'head': 'Laboratory', 'relation': 'CONTAINS', 'tail': 'Glass Cabinet'}, {'head': 'Person', 'relation': 'INTERACTS_WITH', 'tail': 'Equipment'}]
2025-11-30 20:45:34,241 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Turtleneck_Sweater', ['1_0']], ['Person', 'Wears', 'Jeans', ['1_0']], ['Person', 'Stands', 'In_Laboratory', ['1_0']]]
2025-11-30 20:45:34,241 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=9, sample=[['Person', 'Stands In', 'Laboratory', ['1_1']], ['Laboratory', 'Contains', 'Workbench', ['1_1']], ['Workbench', 'Holds', 'Bottle', ['1_1']]]
2025-11-30 20:45:34,241 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=3, sample=[{'local': 'Turtleneck_Sweater', 'existing': 'Beige Sweater', 'existing_id': '0_1'}, {'local': 'Turtleneck_Sweater', 'existing': 'Cream-Colored Sweater', 'existing_id': '0_0'}, {'local': 'Jeans', 'existing': 'Blue Jeans', 'existing_id': '0_0'}]
2025-11-30 20:45:34,241 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=11, sample=[{'head': 'Person', 'relation': 'WEARS', 'tail': 'Cream-Colored Sweater'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Beige Sweater'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Jeans'}]
2025-11-30 20:45:34,241 - src.components.global_refiner - INFO - LLM suggested 3 entity merges: [{'local': 'Turtleneck_Sweater', 'existing': 'Beige Sweater', 'existing_id': '0_1'}, {'local': 'Turtleneck_Sweater', 'existing': 'Cream-Colored Sweater', 'existing_id': '0_0'}, {'local': 'Jeans', 'existing': 'Blue Jeans', 'existing_id': '0_0'}]
2025-11-30 20:45:34,241 - src.components.global_refiner - INFO - LLM suggested 11 triplets to prune: [{'head': 'Person', 'relation': 'WEARS', 'tail': 'Cream-Colored Sweater'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Beige Sweater'}, {'head': 'Person', 'relation': 'WEARS', 'tail': 'Blue Jeans'}, {'head': 'Person', 'relation': 'STANDS', 'tail': 'Left Side Of Frame'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Smartphone'}, {'head': 'Person', 'relation': 'HOLDS', 'tail': 'Document'}, {'head': 'Document', 'relation': 'HAS_TITLE', 'tail': 'Ar Glasses Training Chemistry Experiment Report (Simplified Version)'}, {'head': 'Document', 'relation': 'IS_ABOUT', 'tail': 'Chemistry Experiment'}, {'head': 'Document', 'relation': 'IS_ON', 'tail': 'Lab Table'}, {'head': 'Laboratory', 'relation': 'CONTAINS', 'tail': 'Glass Cabinet'}, {'head': 'Person', 'relation': 'INTERACTS_WITH', 'tail': 'Equipment'}]
2025-11-30 20:45:34,241 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 24 triplets (total: 17.11s, LLM: 17.11s)
2025-11-30 20:45:34,241 - src.pipeline.kg_builder - INFO - Global refinement: 24 triplets in 17.11s
2025-11-30 20:45:34,241 - src.pipeline.kg_builder - INFO - Using 24 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 20:45:34,241 - src.pipeline.kg_builder - INFO - Pushing batch 2/72 to graph UUID: c8c45bc2-8c60-42ab-8f57-fd160d91db75
2025-11-30 20:45:34,241 - src.components.neo4j_handler - INFO - Adding 15 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 20:45:34,462 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=40, relationships=29
2025-11-30 20:45:34,462 - src.components.neo4j_handler - INFO - Applying 3 merge instructions
2025-11-30 20:45:34,463 - src.components.neo4j_handler - DEBUG - APOC merge successful: Turtleneck_Sweater -> Beige Sweater
2025-11-30 20:45:34,469 - src.components.neo4j_handler - DEBUG - APOC merge successful: Turtleneck_Sweater -> Cream-Colored Sweater
2025-11-30 20:45:34,470 - src.components.neo4j_handler - DEBUG - APOC merge successful: Jeans -> Blue Jeans
2025-11-30 20:45:34,470 - src.components.neo4j_handler - INFO - Applying 11 prune instructions
2025-11-30 20:45:34,475 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[WEARS]-> Cream-Colored Sweater
2025-11-30 20:45:34,477 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[WEARS]-> Beige Sweater
2025-11-30 20:45:34,479 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[WEARS]-> Blue Jeans
2025-11-30 20:45:34,506 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[STANDS]-> Left Side Of Frame
2025-11-30 20:45:34,509 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[HOLDS]-> Smartphone
2025-11-30 20:45:34,510 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[HOLDS]-> Document
2025-11-30 20:45:34,536 - src.components.neo4j_handler - DEBUG - Pruned relationship: Document -[HAS_TITLE]-> Ar Glasses Training Chemistry Experiment Report (Simplified Version)
2025-11-30 20:45:34,564 - src.components.neo4j_handler - DEBUG - Pruned relationship: Document -[IS_ABOUT]-> Chemistry Experiment
2025-11-30 20:45:34,566 - src.components.neo4j_handler - DEBUG - Pruned relationship: Document -[IS_ON]-> Lab Table
2025-11-30 20:45:34,568 - src.components.neo4j_handler - DEBUG - Pruned relationship: Laboratory -[CONTAINS]-> Glass Cabinet
2025-11-30 20:45:34,588 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[INTERACTS_WITH]-> Equipment
2025-11-30 20:45:34,588 - src.components.neo4j_handler - INFO - Applying 9 inter-chunk relations
2025-11-30 20:45:34,590 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Stands In]-> Laboratory
2025-11-30 20:45:34,592 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Laboratory -[Contains]-> Workbench
2025-11-30 20:45:34,593 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Workbench -[Holds]-> Bottle
2025-11-30 20:45:34,595 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Workbench -[Holds]-> Paper
2025-11-30 20:45:34,597 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Workbench -[Holds]-> Apparatus
2025-11-30 20:45:34,623 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Apparatus -[Is Type Of]-> Reaction_Chamber
2025-11-30 20:45:34,625 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Uses]-> Ar_Glasses
2025-11-30 20:45:34,650 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[Writes On]-> Experiment_Report
2025-11-30 20:45:34,652 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Experiment_Report -[Contains]-> Data
2025-11-30 20:45:34,653 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 20:45:34,659 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=38, relationships=16
2025-11-30 20:45:34,662 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 20:45:34,662 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 20:45:34,662 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 20:45:34,662 - src.components.neo4j_handler - INFO - Batch injected in 0.42s (triplets: 0.42s, indexes: 0.00s)
2025-11-30 20:45:34,663 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 9, 'with_embedding': 9, 'linked_chunks': 7}
2025-11-30 20:45:34,663 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 20:45:34,665 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 38 nodes
2025-11-30 20:45:34,667 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 36 nodes
2025-11-30 20:45:34,671 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 38, 'relationship_count': 59, 'density': 0.042, 'avg_degree': 3.1053, 'avg_unique_neighbors': 3.1053, 'global_efficiency': 0.3583, 'avg_path_length': 3.0349, 'avg_degree_centrality': 0.0839, 'max_degree_centrality': 0.2973, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.006, 'degree_assortativity': -0.2207, 'graph_robustness': 0.8983, 'diameter_estimate': 6, 'clustering_coefficient': 0.1991, 'weakly_connected_components': 3, 'largest_wcc_size': 36, 'pagerank_top10_percent': 53.48, 'louvain_communities': 7, 'louvain_modularity': 0.5747, 'label_entropy': 1.3949, 'computational_time': 0.0084669099887833}
2025-11-30 20:45:34,671 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 1, 'run_uuid': 'c8c45bc2-8c60-42ab-8f57-fd160d91db75', 'timestamp': 1764506734.6719673, 'total_time': 45.52769669692498, 'aggregation': 4.510977305471897e-06, 'network_info': 0.0064727760618552566, 'llm_extraction': 45.09059847309254, 'data_cleaning': 3.911205567419529e-05, 'neo4j_injection': 0.4209541720338166, 'embedding_time': 0, 'indexing_time': 0.003053952008485794, 'graph_injection_time': 0.4175991480005905, 'acs_metrics': {'node_count': 38, 'relationship_count': 59, 'density': 0.042, 'avg_degree': 3.1053, 'avg_unique_neighbors': 3.1053, 'global_efficiency': 0.3583, 'avg_path_length': 3.0349, 'avg_degree_centrality': 0.0839, 'max_degree_centrality': 0.2973, 'avg_betweenness_centrality': 0.0004, 'max_betweenness_centrality': 0.006, 'degree_assortativity': -0.2207, 'graph_robustness': 0.8983, 'diameter_estimate': 6, 'clustering_coefficient': 0.1991, 'weakly_connected_components': 3, 'largest_wcc_size': 36, 'pagerank_top10_percent': 53.48, 'louvain_communities': 7, 'louvain_modularity': 0.5747, 'label_entropy': 1.3949, 'computational_time': 0.0084669099887833}, 'retrieval_queries': []}
2025-11-30 20:45:34,672 - src.pipeline.kg_builder - DEBUG - Batch 1 metrics: {
  "batch_idx": 1,
  "run_uuid": "c8c45bc2-8c60-42ab-8f57-fd160d91db75",
  "timestamp": 1764506734.6719673,
  "total_time": 45.52769669692498,
  "aggregation": 4.510977305471897e-06,
  "network_info": 0.0064727760618552566,
  "llm_extraction": 45.09059847309254,
  "data_cleaning": 3.911205567419529e-05,
  "neo4j_injection": 0.4209541720338166,
  "embedding_time": 0,
  "indexing_time": 0.003053952008485794,
  "graph_injection_time": 0.4175991480005905,
  "acs_metrics": {
    "node_count": 38,
    "relationship_count": 59,
    "density": 0.042,
    "avg_degree": 3.1053,
    "avg_unique_neighbors": 3.1053,
    "global_efficiency": 0.3583,
    "avg_path_length": 3.0349,
    "avg_degree_centrality": 0.0839,
    "max_degree_centrality": 0.2973,
    "avg_betweenness_centrality": 0.0004,
    "max_betweenness_centrality": 0.006,
    "degree_assortativity": -0.2207,
    "graph_robustness": 0.8983,
    "diameter_estimate": 6,
    "clustering_coefficient": 0.1991,
    "weakly_connected_components": 3,
    "largest_wcc_size": 36,
    "pagerank_top10_percent": 53.48,
    "louvain_communities": 7,
    "louvain_modularity": 0.5747,
    "label_entropy": 1.3949,
    "computational_time": 0.0084669099887833
  },
  "retrieval_queries": []
}
2025-11-30 20:45:34,672 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c8c45bc2-8c60-42ab-8f57-fd160d91db75_batch_metrics_kg.json
2025-11-30 20:45:34,672 - src.pipeline.kg_builder - INFO - Batch 2 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 45.09s, Clean: 0.00s, Neo4j: 0.42s, ACS: 0.01s
2025-11-30 20:45:34,672 - src.pipeline.kg_builder - INFO - Batch 2 completed in 45.53s
Processing KG batches:   3%|▎         | 2/72 [01:04<40:26, 34.67s/it]2025-11-30 20:45:34,672 - src.pipeline.kg_builder - INFO - Processing batch 3/72 (3 items)
2025-11-30 20:45:34,672 - src.pipeline.kg_builder - DEBUG - Batch 3 current_video_time: 00:39-00:44
2025-11-30 20:45:34,678 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 38
- Total Relationships: 16
- Graph UUID: c8c45bc2-8c60-42ab-8f57-fd160d91db75

This information provides context about the current state of the knowledge graph.

2025-11-30 20:45:34,679 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 20:45:34,679 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_2_0 ~177 words, content: Time: 00:29-00:34 Content: The video captures a scene in a laboratory setting where a person is conducting a chemistry experiment. The central focus is on...
2025-11-30 20:45:34,679 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_2_1 ~205 words, content: or the product of the reaction. - A white, circular device with multiple holes, possibly a multi-well plate or a component of the experimental setup....
2025-11-30 20:45:34,679 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_2_2 ~204 words, content: the report, which is laid out on the table. The report details an experiment to produce hydrogen gas by reacting aluminum with sodium hydroxide. The...
2025-11-30 20:45:34,679 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_2_3 ~193 words, content: , protected by a blue nitrile glove, as they write on a printed document titled "AR 眼镜训练用化学实验报告 (简版)" (AR Glasses Training Chemistry Experiment Report -...
2025-11-30 20:45:34,699 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 20:45:34,728 - src.components.pre_llm_injector - DEBUG - Found 9 existing chunk embeddings for similarity lookup
2025-11-30 20:45:34,730 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_4', '0.792'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_1', '0.730')]
2025-11-30 20:45:34,731 - src.components.pre_llm_injector - DEBUG - Found 7 entities linked to chunk_id=c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_1
2025-11-30 20:45:34,731 - src.components.pre_llm_injector - DEBUG - Using max_connection_subgraph limit: 2
2025-11-30 20:45:34,732 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_4 via source_chunk_ids
2025-11-30 20:45:34,733 - src.components.pre_llm_injector - DEBUG - Limited Person from 4 to 2 external connections
2025-11-30 20:45:34,733 - src.components.pre_llm_injector - DEBUG - Subgraph connection limiting: 10 total -> 8 (internal: 6, external: 2)
2025-11-30 20:45:34,733 - src.components.pre_llm_injector - DEBUG - Subgraph: (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Workbench / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Bottle / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Apparatus / ID: 1_1), (Apparatus / ID: 1_1)-[IS_TYPE_OF]->(Reaction_Chamber / ID: 1_1), (Person / ID: 0_0)-[STANDS_NEAR]->(Laboratory Table / ID: 0_0), (Person / ID: 0_0)-[WRITES_ON]->(Experiment_Report / ID: 1_3)
2025-11-30 20:45:34,733 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_1', '0.730'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_4', '0.662')]
2025-11-30 20:45:34,733 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_3', '0.554'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_3', '0.504')]
2025-11-30 20:45:34,733 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_1', '0.513'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_4', '0.513')]
2025-11-30 20:45:34,733 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_4', '0.792'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_0_3', '0.715')]
2025-11-30 20:45:34,733 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 20:45:34,733 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_2_0) (~177 words) with timeout=5.0s retries=3
2025-11-30 20:45:35,861 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 20:45:35,861 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 20:45:35,861 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_2_1) (~205 words) with timeout=5.0s retries=3
2025-11-30 20:45:37,255 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 1 (attempt 1)
2025-11-30 20:45:37,255 - src.components.pre_llm_injector - DEBUG - Chunk 1 returned 6 triplets
2025-11-30 20:45:37,256 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 2 (ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_2_2) (~204 words) with timeout=5.0s retries=3
2025-11-30 20:45:38,324 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 2 (attempt 1)
2025-11-30 20:45:38,325 - src.components.pre_llm_injector - DEBUG - Chunk 2 returned 6 triplets
2025-11-30 20:45:38,325 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 3 (ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_2_3) (~193 words) with timeout=5.0s retries=3
2025-11-30 20:45:39,438 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 3 (attempt 1)
2025-11-30 20:45:39,438 - src.components.pre_llm_injector - DEBUG - Chunk 3 returned 6 triplets
2025-11-30 20:45:39,438 - src.components.pre_llm_injector - INFO - Extracted 23 local triplets from 4 chunks
2025-11-30 20:45:39,438 - src.pipeline.kg_builder - INFO - Pre-extraction: 23 triplets in 4.76s
2025-11-30 20:45:39,438 - src.components.global_refiner - INFO - Capping refinement input: 23 → 15 triplets
2025-11-30 20:45:39,438 - src.components.global_refiner - DEBUG - Instruction-based refinement full input prompt: Human: 
Perform advanced knowledge graph refinement by strictly executing the required operations.



### CONTEXT SUBGRAPHS (Relevant Existing Knowledge):
Subgraph_1: Subgraph: (Person / ID: 0_0)-[STANDS_IN]->(Laboratory / ID: 0_1), (Laboratory / ID: 0_1)-[CONTAINS]->(Workbench / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Bottle / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Paper / ID: 1_1), (Workbench / ID: 1_1)-[HOLDS]->(Apparatus / ID: 1_1), (Apparatus / ID: 1_1)-[IS_TYPE_OF]->(Reaction_Chamber / ID: 1_1), (Person / ID: 0_0)-[STANDS_NEAR]->(Laboratory Table / ID: 0_0), (Person / ID: 0_0)-[WRITES_ON]->(Experiment_Report / ID: 1_3)

### NEW CANDIDATES (From Current Extraction Batch):
[{"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Glove", "source_chunks": ["2_0", "2_2"]}, {"head": "Person", "relation": "Holds", "tail": "White Marker", "source_chunks": ["2_0"]}, {"head": "Person", "relation": "Writes On", "tail": "Document", "source_chunks": ["2_0"]}, {"head": "Document", "relation": "Contains", "tail": "Chemical Equation", "source_chunks": ["2_0"]}, {"head": "Document", "relation": "Contains", "tail": "Measured Volume", "source_chunks": ["2_0"]}, {"head": "Test Tube", "relation": "Is On", "tail": "Laboratory Table", "source_chunks": ["2_0"]}, {"head": "Person", "relation": "Wears", "tail": "Blue Nitrile Gloves", "source_chunks": ["2_1"]}, {"head": "Person", "relation": "Fills Out", "tail": "Chemistry Experiment Report", "source_chunks": ["2_1"]}, {"head": "Chemistry Experiment Report", "relation": "Is Laid On", "tail": "Lab Bench", "source_chunks": ["2_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "White Circular Device", "source_chunks": ["2_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Black Elongated Case", "source_chunks": ["2_1"]}, {"head": "Lab Bench", "relation": "Contains", "tail": "Roll Of Tape", "source_chunks": ["2_1"]}, {"head": "Person", "relation": "Writes On", "tail": "Report", "source_chunks": ["2_2"]}, {"head": "Report", "relation": "Contains", "tail": "Experiment Purpose", "source_chunks": ["2_2"]}, {"head": "Report", "relation": "Contains", "tail": "Experiment Principle", "source_chunks": ["2_2"]}]

### STRICT OUTPUT FORMAT:
Return ONLY a single JSON object with these 4 keys. No extra text.

OUTPUT SPECIFICATIONS:
1. "new_triplets" (max 10): New facts NOT in CONTEXT. Format: [[Head, Relation, Tail, [SourceIndices]], ...] - Prioritize actions/interactions; drop duplicates/redundants.
2. "inter_chunk_relations" (max 5): Links NEW → CONTEXT entities. Format: [[NewHead, Relation, ExistingTail, [SourceIndices]], ...] - ExistingTail must EXACTLY match CONTEXT entity name/ID.
3. "merge_instructions" (max 4): Merge semantic duplicates. Format: [{"local": LocalName, "existing": ExistingName, "existing_id": ExistingID}, ...] - Verify ID exactness from CONTEXT.
4. "prune_instructions" (max 4): Remove conflicts/refutations. Format: Either {"entity": EntityName} or {"head": HeadName, "relation": RelationName, "tail": TailName}.

### EXAMPLES:
Merge: "merge_instructions": [{"local": "Nitrile Glove", "existing": "Blue Glove", "existing_id": "0_3"}]
Link: "inter_chunk_relations": [["Document", "Is On", "Laboratory Table", [2_3]]] // Tail matches CONTEXT "Laboratory Table"
Prune: "prune_instructions": [
  {"entity": "Incorrect Entity"},  // Delete entity and all its relationships
  {"head": "Person", "relation": "Wears", "tail": "No Glove"}  // Delete specific relationship
]

JSON OUTPUT:

2025-11-30 20:45:39,438 - src.components.global_refiner - DEBUG - Instruction-based refining 15 triplets (prompt ~389 words, ~506 tokens)
2025-11-30 20:45:39,439 - src.components.global_refiner - DEBUG - Starting instruction-based refinement LLM call...
2025-11-30 20:45:52,895 - src.components.global_refiner - DEBUG - LLM call completed in 13.46s
2025-11-30 20:45:52,895 - src.components.global_refiner - DEBUG - Instruction-based refinement raw LLM output: new_triplets=[['Person', 'Wears', 'Blue Nitrile Glove', ['2_0', '2_2']], ['Person', 'Holds', 'White Marker', ['2_0']], ['Person', 'Writes On', 'Document', ['2_0']], ['Document', 'Contains', 'Chemical Equation', ['2_0']], ['Document', 'Contains', 'Measured Volume', ['2_0']], ['Test Tube', 'Is On', 'Laboratory Table', ['2_0']], ['Person', 'Wears', 'Blue Nitrile Gloves', ['2_1']], ['Person', 'Fills Out', 'Chemistry Experiment Report', ['2_1']], ['Chemistry Experiment Report', 'Is Laid On', 'Lab Bench', ['2_1']], ['Lab Bench', 'Contains', 'White Circular Device', ['2_1']], ['Lab Bench', 'Contains', 'Black Elongated Case', ['2_1']], ['Lab Bench', 'Contains', 'Roll Of Tape', ['2_1']], ['Person', 'Writes On', 'Report', ['2_2']], ['Report', 'Contains', 'Experiment Purpose', ['2_2']], ['Report', 'Contains', 'Experiment Principle', ['2_2']]] inter_chunk_relations=[['Person', 'STANDS_NEAR', 'Laboratory Table', ['2_0']], ['Person', 'WRITES_ON', 'Experiment_Report', ['2_0']], ['Document', 'Is Laid On', 'Lab Bench', ['2_1']], ['Report', 'Is Laid On', 'Lab Bench', ['2_2']], ['Document', 'Is On', 'Laboratory Table', ['2_0']]] merge_instructions=[{'local': 'Blue Nitrile Glove', 'existing': 'Blue Nitrile Glove', 'existing_id': '0_0'}, {'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_0'}, {'local': 'Document', 'existing': 'Experiment_Report', 'existing_id': '1_3'}, {'local': 'Report', 'existing': 'Experiment_Report', 'existing_id': '1_3'}] prune_instructions=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Document', 'relation': 'Contains', 'tail': 'Chemical Equation'}, {'head': 'Document', 'relation': 'Contains', 'tail': 'Measured Volume'}, {'head': 'Report', 'relation': 'Contains', 'tail': 'Experiment Purpose'}, {'head': 'Report', 'relation': 'Contains', 'tail': 'Experiment Principle'}]
2025-11-30 20:45:52,895 - src.components.global_refiner - DEBUG - Instruction result 'new_triplets': count=15, sample=[['Person', 'Wears', 'Blue Nitrile Glove', ['2_0', '2_2']], ['Person', 'Holds', 'White Marker', ['2_0']], ['Person', 'Writes On', 'Document', ['2_0']]]
2025-11-30 20:45:52,895 - src.components.global_refiner - DEBUG - Instruction result 'inter_chunk_relations': count=5, sample=[['Person', 'STANDS_NEAR', 'Laboratory Table', ['2_0']], ['Person', 'WRITES_ON', 'Experiment_Report', ['2_0']], ['Document', 'Is Laid On', 'Lab Bench', ['2_1']]]
2025-11-30 20:45:52,895 - src.components.global_refiner - DEBUG - Instruction result 'merge_instructions': count=4, sample=[{'local': 'Blue Nitrile Glove', 'existing': 'Blue Nitrile Glove', 'existing_id': '0_0'}, {'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_0'}, {'local': 'Document', 'existing': 'Experiment_Report', 'existing_id': '1_3'}]
2025-11-30 20:45:52,895 - src.components.global_refiner - DEBUG - Instruction result 'prune_instructions': count=6, sample=[{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Document', 'relation': 'Contains', 'tail': 'Chemical Equation'}]
2025-11-30 20:45:52,895 - src.components.global_refiner - INFO - LLM suggested 4 entity merges: [{'local': 'Blue Nitrile Glove', 'existing': 'Blue Nitrile Glove', 'existing_id': '0_0'}, {'local': 'Blue Nitrile Gloves', 'existing': 'Blue Nitrile Gloves', 'existing_id': '0_0'}, {'local': 'Document', 'existing': 'Experiment_Report', 'existing_id': '1_3'}, {'local': 'Report', 'existing': 'Experiment_Report', 'existing_id': '1_3'}]
2025-11-30 20:45:52,895 - src.components.global_refiner - INFO - LLM suggested 6 triplets to prune: [{'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Glove'}, {'head': 'Person', 'relation': 'Wears', 'tail': 'Blue Nitrile Gloves'}, {'head': 'Document', 'relation': 'Contains', 'tail': 'Chemical Equation'}, {'head': 'Document', 'relation': 'Contains', 'tail': 'Measured Volume'}, {'head': 'Report', 'relation': 'Contains', 'tail': 'Experiment Purpose'}, {'head': 'Report', 'relation': 'Contains', 'tail': 'Experiment Principle'}]
2025-11-30 20:45:52,895 - src.components.global_refiner - INFO - Instruction-based refinement complete: 15 → 20 triplets (total: 13.46s, LLM: 13.46s)
2025-11-30 20:45:52,895 - src.pipeline.kg_builder - INFO - Global refinement: 20 triplets in 13.46s
2025-11-30 20:45:52,896 - src.pipeline.kg_builder - INFO - Using 20 refined triplets (skipped redundant final LLM enrichment)
2025-11-30 20:45:52,896 - src.pipeline.kg_builder - INFO - Pushing batch 3/72 to graph UUID: c8c45bc2-8c60-42ab-8f57-fd160d91db75
2025-11-30 20:45:52,896 - src.components.neo4j_handler - INFO - Adding 20 triplets + 3 chunks to graph (hybrid mode)
2025-11-30 20:45:53,085 - src.components.neo4j_handler - DEBUG - Graph counts before operations: nodes=56, relationships=34
2025-11-30 20:45:53,085 - src.components.neo4j_handler - INFO - Applying 4 merge instructions
2025-11-30 20:45:53,085 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue Nitrile Glove -> Blue Nitrile Glove
2025-11-30 20:45:53,085 - src.components.neo4j_handler - DEBUG - Skipping self-merge: Blue Nitrile Gloves -> Blue Nitrile Gloves
2025-11-30 20:45:53,085 - src.components.neo4j_handler - DEBUG - APOC merge successful: Document -> Experiment_Report
2025-11-30 20:45:53,089 - src.components.neo4j_handler - DEBUG - APOC merge successful: Report -> Experiment_Report
2025-11-30 20:45:53,089 - src.components.neo4j_handler - INFO - Applying 6 prune instructions
2025-11-30 20:45:53,093 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Nitrile Glove
2025-11-30 20:45:53,094 - src.components.neo4j_handler - DEBUG - Pruned relationship: Person -[Wears]-> Blue Nitrile Gloves
2025-11-30 20:45:53,094 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Document -[Contains]-> Chemical Equation
2025-11-30 20:45:53,095 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Document -[Contains]-> Measured Volume
2025-11-30 20:45:53,095 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Report -[Contains]-> Experiment Purpose
2025-11-30 20:45:53,098 - src.components.neo4j_handler - DEBUG - No matching relationship found to prune: Report -[Contains]-> Experiment Principle
2025-11-30 20:45:53,098 - src.components.neo4j_handler - INFO - Applying 5 inter-chunk relations
2025-11-30 20:45:53,127 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[STANDS_NEAR]-> Laboratory Table
2025-11-30 20:45:53,129 - src.components.neo4j_handler - DEBUG - Created inter-chunk relation: Person -[WRITES_ON]-> Experiment_Report
2025-11-30 20:45:53,149 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Document -[Is Laid On]-> Lab Bench
2025-11-30 20:45:53,151 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Report -[Is Laid On]-> Lab Bench
2025-11-30 20:45:53,152 - src.components.neo4j_handler - DEBUG - No inter-chunk relation created: Document -[Is On]-> Laboratory Table
2025-11-30 20:45:53,153 - src.components.neo4j_handler - DEBUG - Skipping deletion of isolated Chunk nodes to preserve vector-searchable chunks
2025-11-30 20:45:53,158 - src.components.neo4j_handler - DEBUG - Graph counts after operations: nodes=54, relationships=32
2025-11-30 20:45:53,160 - src.components.neo4j_handler - INFO - Created fulltext index for entity search
2025-11-30 20:45:53,160 - src.components.neo4j_handler - INFO - Created graph indexes
2025-11-30 20:45:53,160 - src.components.neo4j_handler - INFO - Verified/created graph indexes
2025-11-30 20:45:53,160 - src.components.neo4j_handler - INFO - Batch injected in 0.26s (triplets: 0.26s, indexes: 0.00s)
2025-11-30 20:45:53,161 - src.pipeline.kg_builder - INFO - Chunk node counts: {'total_chunks': 13, 'with_embedding': 13, 'linked_chunks': 10}
2025-11-30 20:45:53,161 - src.pipeline.acs_automata - INFO - Computing network science metrics using NetworkX...
2025-11-30 20:45:53,166 - src.pipeline.acs_automata - DEBUG - Computed exact global_efficiency on 54 nodes
2025-11-30 20:45:53,169 - src.pipeline.acs_automata - DEBUG - Computed exact avg_path_length on component with 51 nodes
2025-11-30 20:45:53,176 - src.pipeline.acs_automata - INFO - Network metrics computed: {'node_count': 54, 'relationship_count': 94, 'density': 0.0328, 'avg_degree': 3.4815, 'avg_unique_neighbors': 3.4815, 'global_efficiency': 0.3533, 'avg_path_length': 2.9263, 'avg_degree_centrality': 0.0657, 'max_degree_centrality': 0.3019, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0036, 'degree_assortativity': -0.3016, 'graph_robustness': 0.7766, 'diameter_estimate': 5, 'clustering_coefficient': 0.2326, 'weakly_connected_components': 4, 'largest_wcc_size': 51, 'pagerank_top10_percent': 46.59, 'louvain_communities': 10, 'louvain_modularity': 0.5381, 'label_entropy': 1.3981, 'computational_time': 0.014812604989856482}
2025-11-30 20:45:53,176 - src.core.metrics - DEBUG - Added batch metrics: {'batch_idx': 2, 'run_uuid': 'c8c45bc2-8c60-42ab-8f57-fd160d91db75', 'timestamp': 1764506753.1764348, 'total_time': 18.50401200109627, 'aggregation': 3.947061486542225e-06, 'network_info': 0.006259977002628148, 'llm_extraction': 18.21716419700533, 'data_cleaning': 4.646193701773882e-05, 'neo4j_injection': 0.2644219819922, 'embedding_time': 0, 'indexing_time': 0.002126286970451474, 'graph_injection_time': 0.2619460339192301, 'acs_metrics': {'node_count': 54, 'relationship_count': 94, 'density': 0.0328, 'avg_degree': 3.4815, 'avg_unique_neighbors': 3.4815, 'global_efficiency': 0.3533, 'avg_path_length': 2.9263, 'avg_degree_centrality': 0.0657, 'max_degree_centrality': 0.3019, 'avg_betweenness_centrality': 0.0003, 'max_betweenness_centrality': 0.0036, 'degree_assortativity': -0.3016, 'graph_robustness': 0.7766, 'diameter_estimate': 5, 'clustering_coefficient': 0.2326, 'weakly_connected_components': 4, 'largest_wcc_size': 51, 'pagerank_top10_percent': 46.59, 'louvain_communities': 10, 'louvain_modularity': 0.5381, 'label_entropy': 1.3981, 'computational_time': 0.014812604989856482}, 'retrieval_queries': []}
2025-11-30 20:45:53,176 - src.pipeline.kg_builder - DEBUG - Batch 2 metrics: {
  "batch_idx": 2,
  "run_uuid": "c8c45bc2-8c60-42ab-8f57-fd160d91db75",
  "timestamp": 1764506753.1764348,
  "total_time": 18.50401200109627,
  "aggregation": 3.947061486542225e-06,
  "network_info": 0.006259977002628148,
  "llm_extraction": 18.21716419700533,
  "data_cleaning": 4.646193701773882e-05,
  "neo4j_injection": 0.2644219819922,
  "embedding_time": 0,
  "indexing_time": 0.002126286970451474,
  "graph_injection_time": 0.2619460339192301,
  "acs_metrics": {
    "node_count": 54,
    "relationship_count": 94,
    "density": 0.0328,
    "avg_degree": 3.4815,
    "avg_unique_neighbors": 3.4815,
    "global_efficiency": 0.3533,
    "avg_path_length": 2.9263,
    "avg_degree_centrality": 0.0657,
    "max_degree_centrality": 0.3019,
    "avg_betweenness_centrality": 0.0003,
    "max_betweenness_centrality": 0.0036,
    "degree_assortativity": -0.3016,
    "graph_robustness": 0.7766,
    "diameter_estimate": 5,
    "clustering_coefficient": 0.2326,
    "weakly_connected_components": 4,
    "largest_wcc_size": 51,
    "pagerank_top10_percent": 46.59,
    "louvain_communities": 10,
    "louvain_modularity": 0.5381,
    "label_entropy": 1.3981,
    "computational_time": 0.014812604989856482
  },
  "retrieval_queries": []
}
2025-11-30 20:45:53,176 - src.pipeline.kg_builder - DEBUG - Saved batch network metrics to: metrics/c8c45bc2-8c60-42ab-8f57-fd160d91db75_batch_metrics_kg.json
2025-11-30 20:45:53,176 - src.pipeline.kg_builder - INFO - Batch 3 timings - Agg: 0.00s, NetInfo: 0.01s, LLM: 18.22s, Clean: 0.00s, Neo4j: 0.26s, ACS: 0.01s
2025-11-30 20:45:53,176 - src.pipeline.kg_builder - INFO - Batch 3 completed in 18.50s
Processing KG batches:   4%|▍         | 3/72 [01:23<31:22, 27.29s/it]2025-11-30 20:45:53,177 - src.pipeline.kg_builder - INFO - Processing batch 4/72 (3 items)
2025-11-30 20:45:53,177 - src.pipeline.kg_builder - DEBUG - Batch 4 current_video_time: 00:54-00:59
2025-11-30 20:45:53,182 - src.components.network_info - DEBUG - Network info: 
Current Graph Statistics:
- Total Nodes: 54
- Total Relationships: 32
- Graph UUID: c8c45bc2-8c60-42ab-8f57-fd160d91db75

This information provides context about the current state of the knowledge graph.

2025-11-30 20:45:53,183 - src.components.pre_llm_injector - DEBUG - Split content into 4 chunks (chunk_size=296, overlap=16)
2025-11-30 20:45:53,183 - src.components.pre_llm_injector - DEBUG - Chunk[0] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_3_0 ~186 words, content: Time: 00:44-00:49 Content: The video sequence captures a person conducting a chemistry experiment in a laboratory setting, focusing on the preparation and documentation of a...
2025-11-30 20:45:53,183 - src.components.pre_llm_injector - DEBUG - Chunk[1] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_3_1 ~240 words, content: to a wider, slightly elevated view of the laboratory. This broader shot reveals more of the workspace, including a power strip with multiple plugs, a...
2025-11-30 20:45:53,183 - src.components.pre_llm_injector - DEBUG - Chunk[2] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_3_2 ~241 words, content: , and a yellow box. A person wearing blue gloves is seen handling a piece of aluminum foil, which is likely being used to cover...
2025-11-30 20:45:53,183 - src.components.pre_llm_injector - DEBUG - Chunk[3] ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_3_3 ~164 words, content: :59 Content: The video sequence captures a person preparing to conduct a precise measurement in a laboratory setting. The scene is set in a well-equipped...
2025-11-30 20:45:53,209 - src.components.pre_llm_injector - DEBUG - Starting chunk embedding tasks...
2025-11-30 20:45:53,244 - src.components.pre_llm_injector - DEBUG - Found 13 existing chunk embeddings for similarity lookup
2025-11-30 20:45:53,247 - src.components.pre_llm_injector - DEBUG - FINAL SIMILARITY LIST : [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_4', '0.798'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_2_3', '0.784')]
2025-11-30 20:45:53,248 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=c8c45bc2-8c60-42ab-8f57-fd160d91db75_2_3 via source_chunk_ids
2025-11-30 20:45:53,249 - src.components.pre_llm_injector - DEBUG - No entities linked to chunk_id=c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_4 via source_chunk_ids
2025-11-30 20:45:53,249 - src.components.pre_llm_injector - DEBUG - Chunk 0 top similar chunks: [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_2_3', '0.728'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_4', '0.699')]
2025-11-30 20:45:53,249 - src.components.pre_llm_injector - DEBUG - Chunk 1 top similar chunks: [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_2_3', '0.648'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_4', '0.632')]
2025-11-30 20:45:53,249 - src.components.pre_llm_injector - DEBUG - Chunk 2 top similar chunks: [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_2_3', '0.620'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_4', '0.608')]
2025-11-30 20:45:53,249 - src.components.pre_llm_injector - DEBUG - Chunk 3 top similar chunks: [('c8c45bc2-8c60-42ab-8f57-fd160d91db75_1_4', '0.798'), ('c8c45bc2-8c60-42ab-8f57-fd160d91db75_2_3', '0.784')]
2025-11-30 20:45:53,249 - src.components.pre_llm_injector - DEBUG - Using serial LLM extraction with similarity (batch_llm_parallelism=false)
2025-11-30 20:45:53,249 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 0 (ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_3_0) (~186 words) with timeout=5.0s retries=3
2025-11-30 20:45:54,934 - src.components.pre_llm_injector - DEBUG - Extracted 6 triplets from chunk 0 (attempt 1)
2025-11-30 20:45:54,934 - src.components.pre_llm_injector - DEBUG - Chunk 0 returned 6 triplets
2025-11-30 20:45:54,934 - src.components.pre_llm_injector - DEBUG - Calling LLM on chunk 1 (ID=c8c45bc2-8c60-42ab-8f57-fd160d91db75_3_1) (~240 words) with timeout=5.0s retries=3
